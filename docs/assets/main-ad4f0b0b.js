(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))v(x);new MutationObserver(x=>{for(const M of x)if(M.type==="childList")for(const I of M.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&v(I)}).observe(document,{childList:!0,subtree:!0});function s(x){const M={};return x.integrity&&(M.integrity=x.integrity),x.referrerPolicy&&(M.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?M.credentials="include":x.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function v(x){if(x.ep)return;x.ep=!0;const M=s(x);fetch(x.href,M)}})();(function(u){function a(g,b){const D=Object.create(null),L=g.split(",");for(let Y=0;Y<L.length;Y++)D[L[Y]]=!0;return b?Y=>!!D[Y.toLowerCase()]:Y=>!!D[Y]}const s={1:"TEXT",2:"CLASS",4:"STYLE",8:"PROPS",16:"FULL_PROPS",32:"HYDRATE_EVENTS",64:"STABLE_FRAGMENT",128:"KEYED_FRAGMENT",256:"UNKEYED_FRAGMENT",512:"NEED_PATCH",1024:"DYNAMIC_SLOTS",2048:"DEV_ROOT_FRAGMENT",[-1]:"HOISTED",[-2]:"BAIL"},v={1:"STABLE",2:"DYNAMIC",3:"FORWARDED"},M=a("Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt"),I=2;function B(g,b=0,D=g.length){let L=g.split(/(\r?\n)/);const Y=L.filter((Me,De)=>De%2===1);L=L.filter((Me,De)=>De%2===0);let ne=0;const be=[];for(let Me=0;Me<L.length;Me++)if(ne+=L[Me].length+(Y[Me]&&Y[Me].length||0),ne>=b){for(let De=Me-I;De<=Me+I||D>ne;De++){if(De<0||De>=L.length)continue;const je=De+1;be.push(`${je}${" ".repeat(Math.max(3-String(je).length,0))}|  ${L[De]}`);const st=L[De].length,nt=Y[De]&&Y[De].length||0;if(De===Me){const ot=b-(ne-(st+nt)),Vt=Math.max(1,D>ne?st-ot:D-b);be.push("   |  "+" ".repeat(ot)+"^".repeat(Vt))}else if(De>Me){if(D>ne){const ot=Math.max(Math.min(D-ne,st),1);be.push("   |  "+"^".repeat(ot))}ne+=st+nt}}break}return be.join(`
`)}const j=a("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function te(g){return!!g||g===""}function Z(g){if(Nt(g)){const b={};for(let D=0;D<g.length;D++){const L=g[D],Y=sn(L)?se(L):Z(L);if(Y)for(const ne in Y)b[ne]=Y[ne]}return b}else{if(sn(g))return g;if(Un(g))return g}}const oe=/;(?![^(]*\))/g,le=/:(.+)/;function se(g){const b={};return g.split(oe).forEach(D=>{if(D){const L=D.split(le);L.length>1&&(b[L[0].trim()]=L[1].trim())}}),b}function ve(g){let b="";if(sn(g))b=g;else if(Nt(g))for(let D=0;D<g.length;D++){const L=ve(g[D]);L&&(b+=L+" ")}else if(Un(g))for(const D in g)g[D]&&(b+=D+" ");return b.trim()}function ce(g){if(!g)return null;let{class:b,style:D}=g;return b&&!sn(b)&&(g.class=ve(b)),D&&(g.style=Z(D)),g}const K="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",X="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistanceLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",W="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",_e=a(K),ge=a(X),Ae=a(W);function ee(g,b){if(g.length!==b.length)return!1;let D=!0;for(let L=0;D&&L<g.length;L++)D=$(g[L],b[L]);return D}function $(g,b){if(g===b)return!0;let D=ft(g),L=ft(b);if(D||L)return D&&L?g.getTime()===b.getTime():!1;if(D=Nt(g),L=Nt(b),D||L)return D&&L?ee(g,b):!1;if(D=Un(g),L=Un(b),D||L){if(!D||!L)return!1;const Y=Object.keys(g).length,ne=Object.keys(b).length;if(Y!==ne)return!1;for(const be in g){const Me=g.hasOwnProperty(be),De=b.hasOwnProperty(be);if(Me&&!De||!Me&&De||!$(g[be],b[be]))return!1}}return String(g)===String(b)}function ae(g,b){return g.findIndex(D=>$(D,b))}const Re=g=>g==null?"":Nt(g)||Un(g)&&(g.toString===Xe||!bt(g.toString))?JSON.stringify(g,pe,2):String(g),pe=(g,b)=>b&&b.__v_isRef?pe(g,b.value):Qt(b)?{[`Map(${b.size})`]:[...b.entries()].reduce((D,[L,Y])=>(D[`${L} =>`]=Y,D),{})}:Qe(b)?{[`Set(${b.size})`]:[...b.values()]}:Un(b)&&!Nt(b)&&!dn(b)?String(b):b,he=Object.freeze({}),we=Object.freeze([]),Ce=()=>{},Ne=()=>!1,Ze=/^on[^a-z]/,Ye=g=>Ze.test(g),it=g=>g.startsWith("onUpdate:"),_t=Object.assign,At=(g,b)=>{const D=g.indexOf(b);D>-1&&g.splice(D,1)},vt=Object.prototype.hasOwnProperty,ut=(g,b)=>vt.call(g,b),Nt=Array.isArray,Qt=g=>Xt(g)==="[object Map]",Qe=g=>Xt(g)==="[object Set]",ft=g=>g instanceof Date,bt=g=>typeof g=="function",sn=g=>typeof g=="string",bn=g=>typeof g=="symbol",Un=g=>g!==null&&typeof g=="object",pi=g=>Un(g)&&bt(g.then)&&bt(g.catch),Xe=Object.prototype.toString,Xt=g=>Xe.call(g),tn=g=>Xt(g).slice(8,-1),dn=g=>Xt(g)==="[object Object]",pn=g=>sn(g)&&g!=="NaN"&&g[0]!=="-"&&""+parseInt(g,10)===g,Pn=a(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Cn=g=>{const b=Object.create(null);return D=>b[D]||(b[D]=g(D))},vn=/-(\w)/g,In=Cn(g=>g.replace(vn,(b,D)=>D?D.toUpperCase():"")),Fn=/\B([A-Z])/g,Hn=Cn(g=>g.replace(Fn,"-$1").toLowerCase()),fe=Cn(g=>g.charAt(0).toUpperCase()+g.slice(1)),Se=Cn(g=>g?`on${fe(g)}`:""),Ve=(g,b)=>!Object.is(g,b),We=(g,b)=>{for(let D=0;D<g.length;D++)g[D](b)},pt=(g,b,D)=>{Object.defineProperty(g,b,{configurable:!0,enumerable:!1,value:D})},It=g=>{const b=parseFloat(g);return isNaN(b)?g:b};let $t;const nn=()=>$t||($t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ht(g,...b){console.warn(`[Vue warn] ${g}`,...b)}let Wn;const Ln=[];class Qn{constructor(b=!1){this.active=!0,this.effects=[],this.cleanups=[],!b&&Wn&&(this.parent=Wn,this.index=(Wn.scopes||(Wn.scopes=[])).push(this)-1)}run(b){if(this.active)try{return this.on(),b()}finally{this.off()}else Ht("cannot run an inactive effect scope.")}on(){this.active&&(Ln.push(this),Wn=this)}off(){this.active&&(Ln.pop(),Wn=Ln[Ln.length-1])}stop(b){if(this.active){if(this.effects.forEach(D=>D.stop()),this.cleanups.forEach(D=>D()),this.scopes&&this.scopes.forEach(D=>D.stop(!0)),this.parent&&!b){const D=this.parent.scopes.pop();D&&D!==this&&(this.parent.scopes[this.index]=D,D.index=this.index)}this.active=!1}}}function Nn(g){return new Qn(g)}function Zn(g,b){b=b||Wn,b&&b.active&&b.effects.push(g)}function Qi(){return Wn}function Mr(g){Wn?Wn.cleanups.push(g):Ht("onScopeDispose() is called when there is no active effect scope to be associated with.")}const ze=g=>{const b=new Set(g);return b.w=0,b.n=0,b},yi=g=>(g.w&jr)>0,On=g=>(g.n&jr)>0,si=({deps:g})=>{if(g.length)for(let b=0;b<g.length;b++)g[b].w|=jr},di=g=>{const{deps:b}=g;if(b.length){let D=0;for(let L=0;L<b.length;L++){const Y=b[L];yi(Y)&&!On(Y)?Y.delete(g):b[D++]=Y,Y.w&=~jr,Y.n&=~jr}b.length=D}},Mi=new WeakMap;let is=0,jr=1;const Xr=30,cs=[];let ys;const Zr=Symbol("iterate"),za=Symbol("Map key iterate");class uo{constructor(b,D=null,L){this.fn=b,this.scheduler=D,this.active=!0,this.deps=[],Zn(this,L)}run(){if(!this.active)return this.fn();if(!cs.length||!cs.includes(this))try{return cs.push(ys=this),Ma(),jr=1<<++is,is<=Xr?si(this):sa(this),this.fn()}finally{is<=Xr&&di(this),jr=1<<--is,Lo(),cs.pop();const b=cs.length;ys=b>0?cs[b-1]:void 0}}stop(){this.active&&(sa(this),this.onStop&&this.onStop(),this.active=!1)}}function sa(g){const{deps:b}=g;if(b.length){for(let D=0;D<b.length;D++)b[D].delete(g);b.length=0}}function oa(g,b){g.effect&&(g=g.effect.fn);const D=new uo(g);b&&(_t(D,b),b.scope&&Zn(D,b.scope)),(!b||!b.lazy)&&D.run();const L=D.run.bind(D);return L.effect=D,L}function Oo(g){g.effect.stop()}let Bo=!0;const Hl=[];function ja(){Hl.push(Bo),Bo=!1}function Ma(){Hl.push(Bo),Bo=!0}function Lo(){const g=Hl.pop();Bo=g===void 0?!0:g}function Pt(g,b,D){if(!wn())return;let L=Mi.get(g);L||Mi.set(g,L=new Map);let Y=L.get(D);Y||L.set(D,Y=ze()),Vn(Y,{effect:ys,target:g,type:b,key:D})}function wn(){return Bo&&ys!==void 0}function Vn(g,b){let D=!1;is<=Xr?On(g)||(g.n|=jr,D=!yi(g)):D=!g.has(ys),D&&(g.add(ys),ys.deps.push(g),ys.onTrack&&ys.onTrack(Object.assign({effect:ys},b)))}function un(g,b,D,L,Y,ne){const be=Mi.get(g);if(!be)return;let Me=[];if(b==="clear")Me=[...be.values()];else if(D==="length"&&Nt(g))be.forEach((je,st)=>{(st==="length"||st>=L)&&Me.push(je)});else switch(D!==void 0&&Me.push(be.get(D)),b){case"add":Nt(g)?pn(D)&&Me.push(be.get("length")):(Me.push(be.get(Zr)),Qt(g)&&Me.push(be.get(za)));break;case"delete":Nt(g)||(Me.push(be.get(Zr)),Qt(g)&&Me.push(be.get(za)));break;case"set":Qt(g)&&Me.push(be.get(Zr));break}const De={target:g,type:b,key:D,newValue:L,oldValue:Y,oldTarget:ne};if(Me.length===1)Me[0]&&Gn(Me[0],De);else{const je=[];for(const st of Me)st&&je.push(...st);Gn(ze(je),De)}}function Gn(g,b){for(const D of Nt(g)?g:[...g])(D!==ys||D.allowRecurse)&&(D.onTrigger&&D.onTrigger(_t({effect:D},b)),D.scheduler?D.scheduler():D.run())}const Yi=a("__proto__,__v_isRef,__isVue"),ji=new Set(Object.getOwnPropertyNames(Symbol).map(g=>Symbol[g]).filter(bn)),Er=ct(),ir=ct(!1,!0),Yn=ct(!0),er=ct(!0,!0),Pe=Le();function Le(){const g={};return["includes","indexOf","lastIndexOf"].forEach(b=>{g[b]=function(...D){const L=Nr(this);for(let ne=0,be=this.length;ne<be;ne++)Pt(L,"get",ne+"");const Y=L[b](...D);return Y===-1||Y===!1?L[b](...D.map(Nr)):Y}}),["push","pop","shift","unshift","splice"].forEach(b=>{g[b]=function(...D){ja();const L=Nr(this)[b].apply(this,D);return Lo(),L}}),g}function ct(g=!1,b=!1){return function(L,Y,ne){if(Y==="__v_isReactive")return!g;if(Y==="__v_isReadonly")return g;if(Y==="__v_isShallow")return b;if(Y==="__v_raw"&&ne===(g?b?vr:$s:b?oo:rr).get(L))return L;const be=Nt(L);if(!g&&be&&ut(Pe,Y))return Reflect.get(Pe,Y,ne);const Me=Reflect.get(L,Y,ne);return(bn(Y)?ji.has(Y):Yi(Y))||(g||Pt(L,"get",Y),b)?Me:ao(Me)?!be||!pn(Y)?Me.value:Me:Un(Me)?g?Wl(Me):Is(Me):Me}}const ht=Lt(),Ke=Lt(!0);function Lt(g=!1){return function(D,L,Y,ne){let be=D[L];if(Wr(be)&&ao(be)&&!ao(Y))return!1;if(!g&&!Wr(Y)&&(Gu(Y)||(Y=Nr(Y),be=Nr(be)),!Nt(D)&&ao(be)&&!ao(Y)))return be.value=Y,!0;const Me=Nt(D)&&pn(L)?Number(L)<D.length:ut(D,L),De=Reflect.set(D,L,Y,ne);return D===Nr(ne)&&(Me?Ve(Y,be)&&un(D,"set",L,Y,be):un(D,"add",L,Y)),De}}function dt(g,b){const D=ut(g,b),L=g[b],Y=Reflect.deleteProperty(g,b);return Y&&D&&un(g,"delete",b,void 0,L),Y}function Wt(g,b){const D=Reflect.has(g,b);return(!bn(b)||!ji.has(b))&&Pt(g,"has",b),D}function rn(g){return Pt(g,"iterate",Nt(g)?"length":Zr),Reflect.ownKeys(g)}const on={get:Er,set:ht,deleteProperty:dt,has:Wt,ownKeys:rn},gn={get:Yn,set(g,b){return console.warn(`Set operation on key "${String(b)}" failed: target is readonly.`,g),!0},deleteProperty(g,b){return console.warn(`Delete operation on key "${String(b)}" failed: target is readonly.`,g),!0}},Xn=_t({},on,{get:ir,set:Ke}),an=_t({},gn,{get:er}),ui=g=>g,Ai=g=>Reflect.getPrototypeOf(g);function Bn(g,b,D=!1,L=!1){g=g.__v_raw;const Y=Nr(g),ne=Nr(b);b!==ne&&!D&&Pt(Y,"get",b),!D&&Pt(Y,"get",ne);const{has:be}=Ai(Y),Me=L?ui:D?gh:qp;if(be.call(Y,b))return Me(g.get(b));if(be.call(Y,ne))return Me(g.get(ne));g!==Y&&g.get(b)}function Kn(g,b=!1){const D=this.__v_raw,L=Nr(D),Y=Nr(g);return g!==Y&&!b&&Pt(L,"has",g),!b&&Pt(L,"has",Y),g===Y?D.has(g):D.has(g)||D.has(Y)}function Mn(g,b=!1){return g=g.__v_raw,!b&&Pt(Nr(g),"iterate",Zr),Reflect.get(g,"size",g)}function Ci(g){g=Nr(g);const b=Nr(this);return Ai(b).has.call(b,g)||(b.add(g),un(b,"add",g,g)),this}function Hi(g,b){b=Nr(b);const D=Nr(this),{has:L,get:Y}=Ai(D);let ne=L.call(D,g);ne?br(D,L,g):(g=Nr(g),ne=L.call(D,g));const be=Y.call(D,g);return D.set(g,b),ne?Ve(b,be)&&un(D,"set",g,b,be):un(D,"add",g,b),this}function cr(g){const b=Nr(this),{has:D,get:L}=Ai(b);let Y=D.call(b,g);Y?br(b,D,g):(g=Nr(g),Y=D.call(b,g));const ne=L?L.call(b,g):void 0,be=b.delete(g);return Y&&un(b,"delete",g,void 0,ne),be}function Ki(){const g=Nr(this),b=g.size!==0,D=Qt(g)?new Map(g):new Set(g),L=g.clear();return b&&un(g,"clear",void 0,void 0,D),L}function ni(g,b){return function(L,Y){const ne=this,be=ne.__v_raw,Me=Nr(be),De=b?ui:g?gh:qp;return!g&&Pt(Me,"iterate",Zr),be.forEach((je,st)=>L.call(Y,De(je),De(st),ne))}}function Wi(g,b,D){return function(...L){const Y=this.__v_raw,ne=Nr(Y),be=Qt(ne),Me=g==="entries"||g===Symbol.iterator&&be,De=g==="keys"&&be,je=Y[g](...L),st=D?ui:b?gh:qp;return!b&&Pt(ne,"iterate",De?za:Zr),{next(){const{value:nt,done:ot}=je.next();return ot?{value:nt,done:ot}:{value:Me?[st(nt[0]),st(nt[1])]:st(nt),done:ot}},[Symbol.iterator](){return this}}}}function Ir(g){return function(...b){{const D=b[0]?`on key "${b[0]}" `:"";console.warn(`${fe(g)} operation ${D}failed: target is readonly.`,Nr(this))}return g==="delete"?!1:this}}function Ar(){const g={get(ne){return Bn(this,ne)},get size(){return Mn(this)},has:Kn,add:Ci,set:Hi,delete:cr,clear:Ki,forEach:ni(!1,!1)},b={get(ne){return Bn(this,ne,!1,!0)},get size(){return Mn(this)},has:Kn,add:Ci,set:Hi,delete:cr,clear:Ki,forEach:ni(!1,!0)},D={get(ne){return Bn(this,ne,!0)},get size(){return Mn(this,!0)},has(ne){return Kn.call(this,ne,!0)},add:Ir("add"),set:Ir("set"),delete:Ir("delete"),clear:Ir("clear"),forEach:ni(!0,!1)},L={get(ne){return Bn(this,ne,!0,!0)},get size(){return Mn(this,!0)},has(ne){return Kn.call(this,ne,!0)},add:Ir("add"),set:Ir("set"),delete:Ir("delete"),clear:Ir("clear"),forEach:ni(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(ne=>{g[ne]=Wi(ne,!1,!1),D[ne]=Wi(ne,!0,!1),b[ne]=Wi(ne,!1,!0),L[ne]=Wi(ne,!0,!0)}),[g,D,b,L]}const[_s,bo,Ms,Ks]=Ar();function so(g,b){const D=b?g?Ks:Ms:g?bo:_s;return(L,Y,ne)=>Y==="__v_isReactive"?!g:Y==="__v_isReadonly"?g:Y==="__v_raw"?L:Reflect.get(ut(D,Y)&&Y in L?D:L,Y,ne)}const Zi={get:so(!1,!1)},As={get:so(!1,!0)},Ri={get:so(!0,!1)},No={get:so(!0,!0)};function br(g,b,D){const L=Nr(D);if(L!==D&&b.call(g,L)){const Y=tn(g);console.warn(`Reactive ${Y} contains both the raw and reactive versions of the same object${Y==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}const rr=new WeakMap,oo=new WeakMap,$s=new WeakMap,vr=new WeakMap;function Ta(g){switch(g){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function xr(g){return g.__v_skip||!Object.isExtensible(g)?0:Ta(tn(g))}function Is(g){return Wr(g)?g:zc(g,!1,on,Zi,rr)}function Vu(g){return zc(g,!1,Xn,As,oo)}function Wl(g){return zc(g,!0,gn,Ri,$s)}function fu(g){return zc(g,!0,an,No,vr)}function zc(g,b,D,L,Y){if(!Un(g))return console.warn(`value cannot be made reactive: ${String(g)}`),g;if(g.__v_raw&&!(b&&g.__v_isReactive))return g;const ne=Y.get(g);if(ne)return ne;const be=xr(g);if(be===0)return g;const Me=new Proxy(g,be===2?L:D);return Y.set(g,Me),Me}function Va(g){return Wr(g)?Va(g.__v_raw):!!(g&&g.__v_isReactive)}function Wr(g){return!!(g&&g.__v_isReadonly)}function Gu(g){return!!(g&&g.__v_isShallow)}function Ts(g){return Va(g)||Wr(g)}function Nr(g){const b=g&&g.__v_raw;return b?Nr(b):g}function Ga(g){return pt(g,"__v_skip",!0),g}const qp=g=>Un(g)?Is(g):g,gh=g=>Un(g)?Wl(g):g;function Jd(g){wn()&&(g=Nr(g),g.dep||(g.dep=ze()),Vn(g.dep,{target:g,type:"get",key:"value"}))}function Js(g,b){g=Nr(g),g.dep&&Gn(g.dep,{target:g,type:"set",key:"value",newValue:b})}function ao(g){return!!(g&&g.__v_isRef===!0)}function ud(g){return _h(g,!1)}function xg(g){return _h(g,!0)}function _h(g,b){return ao(g)?g:new Hu(g,b)}class Hu{constructor(b,D){this.__v_isShallow=D,this.dep=void 0,this.__v_isRef=!0,this._rawValue=D?b:Nr(b),this._value=D?b:qp(b)}get value(){return Jd(this),this._value}set value(b){b=this.__v_isShallow?b:Nr(b),Ve(b,this._rawValue)&&(this._rawValue=b,this._value=this.__v_isShallow?b:qp(b),Js(this,b))}}function Xp(g){Js(g,g.value)}function wg(g){return ao(g)?g.value:g}const vh={get:(g,b,D)=>wg(Reflect.get(g,b,D)),set:(g,b,D,L)=>{const Y=g[b];return ao(Y)&&!ao(D)?(Y.value=D,!0):Reflect.set(g,b,D,L)}};function fs(g){return Va(g)?g:new Proxy(g,vh)}class Eg{constructor(b){this.dep=void 0,this.__v_isRef=!0;const{get:D,set:L}=b(()=>Jd(this),()=>Js(this));this._get=D,this._set=L}get value(){return this._get()}set value(b){this._set(b)}}function qf(g){return new Eg(g)}function Zd(g){Ts(g)||console.warn("toRefs() expects a reactive object but received a plain one.");const b=Nt(g)?new Array(g.length):{};for(const D in g)b[D]=Yp(g,D);return b}class ep{constructor(b,D,L){this._object=b,this._key=D,this._defaultValue=L,this.__v_isRef=!0}get value(){const b=this._object[this._key];return b===void 0?this._defaultValue:b}set value(b){this._object[this._key]=b}}function Yp(g,b,D){const L=g[b];return ao(L)?L:new ep(g,b,D)}class Sg{constructor(b,D,L,Y){this._setter=D,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new uo(b,()=>{this._dirty||(this._dirty=!0,Js(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!Y,this.__v_isReadonly=L}get value(){const b=Nr(this);return Jd(b),(b._dirty||!b._cacheable)&&(b._dirty=!1,b._value=b.effect.run()),b._value}set value(b){this._setter(b)}}function Xf(g,b,D=!1){let L,Y;const ne=bt(g);ne?(L=g,Y=()=>{console.warn("Write operation failed: computed value is readonly")}):(L=g.get,Y=g.set);const be=new Sg(L,Y,ne||!Y,D);return b&&!D&&(be.effect.onTrack=b.onTrack,be.effect.onTrigger=b.onTrigger),be}const sl=[];function qs(g){sl.push(g)}function tp(){sl.pop()}function ei(g,...b){ja();const D=sl.length?sl[sl.length-1].component:null,L=D&&D.appContext.config.warnHandler,Y=uc();if(L)kr(L,D,11,[g+b.join(""),D&&D.proxy,Y.map(({vnode:ne})=>`at <${ff(D,ne.type)}>`).join(`
`),Y]);else{const ne=[`[Vue warn]: ${g}`,...b];Y.length&&ne.push(`
`,...Cl(Y)),console.warn(...ne)}Lo()}function uc(){let g=sl[sl.length-1];if(!g)return[];const b=[];for(;g;){const D=b[0];D&&D.vnode===g?D.recurseCount++:b.push({vnode:g,recurseCount:0});const L=g.component&&g.component.parent;g=L&&L.vnode}return b}function Cl(g){const b=[];return g.forEach((D,L)=>{b.push(...L===0?[]:[`
`],...xo(D))}),b}function xo({vnode:g,recurseCount:b}){const D=b>0?`... (${b} recursive calls)`:"",L=g.component?g.component.parent==null:!1,Y=` at <${ff(g.component,g.type,L)}`,ne=">"+D;return g.props?[Y,...np(g.props),ne]:[Y+ne]}function np(g){const b=[],D=Object.keys(g);return D.slice(0,3).forEach(L=>{b.push(...yh(L,g[L]))}),D.length>3&&b.push(" ..."),b}function yh(g,b,D){return sn(b)?(b=JSON.stringify(b),D?b:[`${g}=${b}`]):typeof b=="number"||typeof b=="boolean"||b==null?D?b:[`${g}=${b}`]:ao(b)?(b=yh(g,Nr(b.value),!0),D?b:[`${g}=Ref<`,b,">"]):bt(b)?[`${g}=fn${b.name?`<${b.name}>`:""}`]:(b=Nr(b),D?b:[`${g}=`,b])}const Wu={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush. This is likely a Vue internals bug. Please open an issue at https://new-issue.vuejs.org/?repo=vuejs/core"};function kr(g,b,D,L){let Y;try{Y=L?g(...L):g()}catch(ne){aa(ne,b,D)}return Y}function qo(g,b,D,L){if(bt(g)){const ne=kr(g,b,D,L);return ne&&pi(ne)&&ne.catch(be=>{aa(be,b,D)}),ne}const Y=[];for(let ne=0;ne<g.length;ne++)Y.push(qo(g[ne],b,D,L));return Y}function aa(g,b,D,L=!0){const Y=b?b.vnode:null;if(b){let ne=b.parent;const be=b.proxy,Me=Wu[D];for(;ne;){const je=ne.ec;if(je){for(let st=0;st<je.length;st++)if(je[st](g,be,Me)===!1)return}ne=ne.parent}const De=b.appContext.config.errorHandler;if(De){kr(De,null,10,[g,be,Me]);return}}rs(g,D,Y,L)}function rs(g,b,D,L=!0){{const Y=Wu[b];if(D&&qs(D),ei(`Unhandled error${Y?` during execution of ${Y}`:""}`),D&&tp(),L)throw g;console.error(g)}}let ip=!1,li=!1;const Ji=[];let Gs=0;const hd=[];let Ah=null,ol=0;const hc=[];let Ha=null,dc=0;const Rl=Promise.resolve();let Il=null,Yf=null;const rv=100;function Kp(g){const b=Il||Rl;return g?b.then(this?g.bind(this):g):b}function Kf(g){let b=Gs+1,D=Ji.length;for(;b<D;){const L=b+D>>>1;va(Ji[L])<g?b=L+1:D=L}return b}function Wa(g){(!Ji.length||!Ji.includes(g,ip&&g.allowRecurse?Gs+1:Gs))&&g!==Yf&&(g.id==null?Ji.push(g):Ji.splice(Kf(g.id),0,g),bh())}function bh(){!ip&&!li&&(li=!0,Il=Rl.then(pc))}function $p(g){const b=Ji.indexOf(g);b>Gs&&Ji.splice(b,1)}function mu(g,b,D,L){Nt(g)?D.push(...g):(!b||!b.includes(g,g.allowRecurse?L+1:L))&&D.push(g),bh()}function $f(g){mu(g,Ah,hd,ol)}function dd(g){mu(g,Ha,hc,dc)}function Us(g,b=null){if(hd.length){for(Yf=b,Ah=[...new Set(hd)],hd.length=0,g=g||new Map,ol=0;ol<Ah.length;ol++)jc(g,Ah[ol])||Ah[ol]();Ah=null,ol=0,Yf=null,Us(g,b)}}function Vr(g){if(hc.length){const b=[...new Set(hc)];if(hc.length=0,Ha){Ha.push(...b);return}for(Ha=b,g=g||new Map,Ha.sort((D,L)=>va(D)-va(L)),dc=0;dc<Ha.length;dc++)jc(g,Ha[dc])||Ha[dc]();Ha=null,dc=0}}const va=g=>g.id==null?1/0:g.id;function pc(g){li=!1,ip=!0,g=g||new Map,Us(g),Ji.sort((D,L)=>va(D)-va(L));const b=D=>jc(g,D);try{for(Gs=0;Gs<Ji.length;Gs++){const D=Ji[Gs];if(D&&D.active!==!1){if(b(D))continue;kr(D,null,14)}}}finally{Gs=0,Ji.length=0,Vr(g),ip=!1,Il=null,(Ji.length||hd.length||hc.length)&&pc(g)}}function jc(g,b){if(!g.has(b))g.set(b,1);else{const D=g.get(b);if(D>rv){const L=b.ownerInstance,Y=L&&kh(L.type);return ei(`Maximum recursive updates exceeded${Y?` in component <${Y}>`:""}. This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function.`),!0}else g.set(b,D+1)}}let ko=!1;const rp=new Set;nn().__VUE_HMR_RUNTIME__={createRecord:gc(pd),rerender:gc(Ql),reload:gc(fc)};const gu=new Map;function Pl(g){const b=g.type.__hmrId;let D=gu.get(b);D||(pd(b,g.type),D=gu.get(b)),D.instances.add(g)}function zt(g){gu.get(g.type.__hmrId).instances.delete(g)}function pd(g,b){return gu.has(g)?!1:(gu.set(g,{initialDef:_u(b),instances:new Set}),!0)}function _u(g){return dm(g)?g.__vccOpts:g}function Ql(g,b){const D=gu.get(g);D&&(D.initialDef.render=b,[...D.instances].forEach(L=>{b&&(L.render=b,_u(L.type).render=b),L.renderCache=[],ko=!0,L.update(),ko=!1}))}function fc(g,b){const D=gu.get(g);if(!D)return;b=_u(b),mc(D.initialDef,b);const L=[...D.instances];for(const Y of L){const ne=_u(Y.type);rp.has(ne)||(ne!==D.initialDef&&mc(ne,b),rp.add(ne)),Y.appContext.optionsCache.delete(Y.type),Y.ceReload?(rp.add(ne),Y.ceReload(b.styles),rp.delete(ne)):Y.parent?(Wa(Y.parent.update),Y.parent.type.__asyncLoader&&Y.parent.ceReload&&Y.parent.ceReload(b.styles)):Y.appContext.reload?Y.appContext.reload():typeof window<"u"?window.location.reload():console.warn("[HMR] Root or manually mounted instance modified. Full reload required.")}dd(()=>{for(const Y of L)rp.delete(_u(Y.type))})}function mc(g,b){_t(g,b);for(const D in g)D!=="__file"&&!(D in b)&&delete g[D]}function gc(g){return(b,D)=>{try{return g(b,D)}catch(L){console.error(L),console.warn("[HMR] Something went wrong during Vue component hot-reload. Full reload required.")}}}let vu=[],xh=!1;function Qa(g,...b){u.devtools?u.devtools.emit(g,...b):xh||vu.push({event:g,args:b})}function Vc(g,b){var D,L;u.devtools=g,u.devtools?(u.devtools.enabled=!0,vu.forEach(({event:Y,args:ne})=>u.devtools.emit(Y,...ne)),vu=[]):typeof window<"u"&&window.HTMLElement&&!(!((L=(D=window.navigator)===null||D===void 0?void 0:D.userAgent)===null||L===void 0)&&L.includes("jsdom"))?((b.__VUE_DEVTOOLS_HOOK_REPLAY__=b.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(ne=>{Vc(ne,b)}),setTimeout(()=>{u.devtools||(b.__VUE_DEVTOOLS_HOOK_REPLAY__=null,xh=!0,vu=[])},3e3)):(xh=!0,vu=[])}function Gc(g,b){Qa("app:init",g,b,{Fragment:Vo,Text:wc,Comment:Xs,Static:Ba})}function yu(g){Qa("app:unmount",g)}const wh=Hc("component:added"),Eh=Hc("component:updated"),Jf=Hc("component:removed");function Hc(g){return b=>{Qa(g,b.appContext.app,b.uid,b.parent?b.parent.uid:void 0,b)}}const Jp=ss("perf:start"),sv=ss("perf:end");function ss(g){return(b,D,L)=>{Qa(g,b.appContext.app,b.uid,b,D,L)}}function Xo(g,b,D){Qa("component:emit",g.appContext.app,g,b,D)}function la(g,b,...D){const L=g.vnode.props||he;{const{emitsOptions:st,propsOptions:[nt]}=g;if(st)if(!(b in st))(!nt||!(Se(b)in nt))&&ei(`Component emitted event "${b}" but it is neither declared in the emits option nor as an "${Se(b)}" prop.`);else{const ot=st[b];bt(ot)&&(ot(...D)||ei(`Invalid event arguments: event validation failed for event "${b}".`))}}let Y=D;const ne=b.startsWith("update:"),be=ne&&b.slice(7);if(be&&be in L){const st=`${be==="modelValue"?"model":be}Modifiers`,{number:nt,trim:ot}=L[st]||he;ot?Y=D.map(Vt=>Vt.trim()):nt&&(Y=D.map(It))}Xo(g,b,Y);{const st=b.toLowerCase();st!==b&&L[Se(st)]&&ei(`Event "${st}" is emitted in component ${ff(g,g.type)} but the handler is registered for "${b}". Note that HTML attributes are case-insensitive and you cannot use v-on to listen to camelCase events when using in-DOM templates. You should probably use "${Hn(b)}" instead of "${b}".`)}let Me,De=L[Me=Se(b)]||L[Me=Se(In(b))];!De&&ne&&(De=L[Me=Se(Hn(b))]),De&&qo(De,g,6,Y);const je=L[Me+"Once"];if(je){if(!g.emitted)g.emitted={};else if(g.emitted[Me])return;g.emitted[Me]=!0,qo(je,g,6,Y)}}function al(g,b,D=!1){const L=b.emitsCache,Y=L.get(g);if(Y!==void 0)return Y;const ne=g.emits;let be={},Me=!1;if(!bt(g)){const De=je=>{const st=al(je,b,!0);st&&(Me=!0,_t(be,st))};!D&&b.mixins.length&&b.mixins.forEach(De),g.extends&&De(g.extends),g.mixins&&g.mixins.forEach(De)}return!ne&&!Me?(L.set(g,null),null):(Nt(ne)?ne.forEach(De=>be[De]=null):_t(be,ne),L.set(g,be),be)}function Au(g,b){return!g||!Ye(b)?!1:(b=b.slice(2).replace(/Once$/,""),ut(g,b[0].toLowerCase()+b.slice(1))||ut(g,Hn(b))||ut(g,b))}let Zs=null,_c=null;function fd(g){const b=Zs;return Zs=g,_c=g&&g.type.__scopeId||null,b}function sp(g){_c=g}function op(){_c=null}const Sh=g=>Gr;function Gr(g,b=Zs,D){if(!b||g._n)return g;const L=(...Y)=>{L._d&&om(-1);const ne=fd(b),be=g(...Y);return fd(ne),L._d&&om(1),Eh(b),be};return L._n=!0,L._c=!0,L._d=!0,L}let bu=!1;function ya(){bu=!0}function Hs(g){const{type:b,vnode:D,proxy:L,withProxy:Y,props:ne,propsOptions:[be],slots:Me,attrs:De,emit:je,render:st,renderCache:nt,data:ot,setupState:Vt,ctx:Jt,inheritAttrs:en}=g;let Yt,ln;const et=fd(g);bu=!1;try{if(D.shapeFlag&4){const Ut=Y||L;Yt=ul(st.call(Ut,Ut,nt,ne,Vt,ot,Jt)),ln=De}else{const Ut=b;De===ne&&ya(),Yt=ul(Ut.length>1?Ut(ne,{get attrs(){return ya(),De},slots:Me,emit:je}):Ut(ne,null)),ln=b.props?De:ca(De)}}catch(Ut){lf.length=0,aa(Ut,g,1),Yt=go(Xs)}let $e=Yt,Gt;if(Yt.patchFlag>0&&Yt.patchFlag&2048&&([$e,Gt]=md(Yt)),ln&&en!==!1){const Ut=Object.keys(ln),{shapeFlag:yt}=$e;if(Ut.length){if(yt&7)be&&Ut.some(it)&&(ln=ua(ln,be)),$e=eh($e,ln);else if(!bu&&$e.type!==Xs){const wt=Object.keys(De),qe=[],Ct=[];for(let Dt=0,hn=wt.length;Dt<hn;Dt++){const Kt=wt[Dt];Ye(Kt)?it(Kt)||qe.push(Kt[2].toLowerCase()+Kt.slice(3)):Ct.push(Kt)}Ct.length&&ei(`Extraneous non-props attributes (${Ct.join(", ")}) were passed to component but could not be automatically inherited because component renders fragment or text root nodes.`),qe.length&&ei(`Extraneous non-emits event listeners (${qe.join(", ")}) were passed to component but could not be automatically inherited because component renders fragment or text root nodes. If the listener is intended to be a component custom event listener only, declare it using the "emits" option.`)}}}return D.dirs&&(Zf($e)||ei("Runtime directive used on component with non-element root node. The directives will not function as intended."),$e.dirs=$e.dirs?$e.dirs.concat(D.dirs):D.dirs),D.transition&&(Zf($e)||ei("Component inside <Transition> renders non-element root node that cannot be animated."),$e.transition=D.transition),Gt?Gt($e):Yt=$e,fd(et),Yt}const md=g=>{const b=g.children,D=g.dynamicChildren,L=Uo(b);if(!L)return[g,void 0];const Y=b.indexOf(L),ne=D?D.indexOf(L):-1,be=Me=>{b[Y]=Me,D&&(ne>-1?D[ne]=Me:Me.patchFlag>0&&(g.dynamicChildren=[...D,Me]))};return[ul(L),be]};function Uo(g){let b;for(let D=0;D<g.length;D++){const L=g[D];if(Bh(L)){if(L.type!==Xs||L.children==="v-if"){if(b)return;b=L}}else return}return b}const ca=g=>{let b;for(const D in g)(D==="class"||D==="style"||Ye(D))&&((b||(b={}))[D]=g[D]);return b},ua=(g,b)=>{const D={};for(const L in g)(!it(L)||!(L.slice(9)in b))&&(D[L]=g[L]);return D},Zf=g=>g.shapeFlag&7||g.type===Xs;function Zp(g,b,D){const{props:L,children:Y,component:ne}=g,{props:be,children:Me,patchFlag:De}=b,je=ne.emitsOptions;if((Y||Me)&&ko||b.dirs||b.transition)return!0;if(D&&De>=0){if(De&1024)return!0;if(De&16)return L?Mh(L,be,je):!!be;if(De&8){const st=b.dynamicProps;for(let nt=0;nt<st.length;nt++){const ot=st[nt];if(be[ot]!==L[ot]&&!Au(je,ot))return!0}}}else return(Y||Me)&&(!Me||!Me.$stable)?!0:L===be?!1:L?be?Mh(L,be,je):!0:!!be;return!1}function Mh(g,b,D){const L=Object.keys(b);if(L.length!==Object.keys(g).length)return!0;for(let Y=0;Y<L.length;Y++){const ne=L[Y];if(b[ne]!==g[ne]&&!Au(D,ne))return!0}return!1}function Th({vnode:g,parent:b},D){for(;b&&b.subTree===g;)(g=b.vnode).el=D,b=b.parent}const em=g=>g.__isSuspense,xu={name:"Suspense",__isSuspense:!0,process(g,b,D,L,Y,ne,be,Me,De,je){g==null?ll(b,D,L,Y,ne,be,Me,De,je):qa(g,b,D,L,Y,be,Me,De,je)},hydrate:ef,create:Qu,normalize:tf};function wo(g,b){const D=g.props&&g.props[b];bt(D)&&D()}function ll(g,b,D,L,Y,ne,be,Me,De){const{p:je,o:{createElement:st}}=De,nt=st("div"),ot=g.suspense=Qu(g,Y,L,b,nt,D,ne,be,Me,De);je(null,ot.pendingBranch=g.ssContent,nt,null,L,ot,ne,be),ot.deps>0?(wo(g,"onPending"),wo(g,"onFallback"),je(null,g.ssFallback,b,D,L,null,ne,be),Qc(ot,g.ssFallback)):ot.resolve()}function qa(g,b,D,L,Y,ne,be,Me,{p:De,um:je,o:{createElement:st}}){const nt=b.suspense=g.suspense;nt.vnode=b,b.el=g.el;const ot=b.ssContent,Vt=b.ssFallback,{activeBranch:Jt,pendingBranch:en,isInFallback:Yt,isHydrating:ln}=nt;if(en)nt.pendingBranch=ot,to(ot,en)?(De(en,ot,nt.hiddenContainer,null,Y,nt,ne,be,Me),nt.deps<=0?nt.resolve():Yt&&(De(Jt,Vt,D,L,Y,null,ne,be,Me),Qc(nt,Vt))):(nt.pendingId++,ln?(nt.isHydrating=!1,nt.activeBranch=en):je(en,Y,nt),nt.deps=0,nt.effects.length=0,nt.hiddenContainer=st("div"),Yt?(De(null,ot,nt.hiddenContainer,null,Y,nt,ne,be,Me),nt.deps<=0?nt.resolve():(De(Jt,Vt,D,L,Y,null,ne,be,Me),Qc(nt,Vt))):Jt&&to(ot,Jt)?(De(Jt,ot,D,L,Y,nt,ne,be,Me),nt.resolve(!0)):(De(null,ot,nt.hiddenContainer,null,Y,nt,ne,be,Me),nt.deps<=0&&nt.resolve()));else if(Jt&&to(ot,Jt))De(Jt,ot,D,L,Y,nt,ne,be,Me),Qc(nt,ot);else if(wo(b,"onPending"),nt.pendingBranch=ot,nt.pendingId++,De(null,ot,nt.hiddenContainer,null,Y,nt,ne,be,Me),nt.deps<=0)nt.resolve();else{const{timeout:et,pendingId:$e}=nt;et>0?setTimeout(()=>{nt.pendingId===$e&&nt.fallback(Vt)},et):et===0&&nt.fallback(Vt)}}let Wc=!1;function Qu(g,b,D,L,Y,ne,be,Me,De,je,st=!1){Wc||(Wc=!0,console[console.info?"info":"log"]("<Suspense> is an experimental feature and its API will likely change."));const{p:nt,m:ot,um:Vt,n:Jt,o:{parentNode:en,remove:Yt}}=je,ln=It(g.props&&g.props.timeout),et={vnode:g,parent:b,parentComponent:D,isSVG:be,container:L,hiddenContainer:Y,anchor:ne,deps:0,pendingId:0,timeout:typeof ln=="number"?ln:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:st,isUnmounted:!1,effects:[],resolve($e=!1){{if(!$e&&!et.pendingBranch)throw new Error("suspense.resolve() is called without a pending branch.");if(et.isUnmounted)throw new Error("suspense.resolve() is called on an already unmounted suspense boundary.")}const{vnode:Gt,activeBranch:Ut,pendingBranch:yt,pendingId:wt,effects:qe,parentComponent:Ct,container:Dt}=et;if(et.isHydrating)et.isHydrating=!1;else if(!$e){const yn=Ut&&yt.transition&&yt.transition.mode==="out-in";yn&&(Ut.transition.afterLeave=()=>{wt===et.pendingId&&ot(yt,Dt,ii,0)});let{anchor:ii}=et;Ut&&(ii=Jt(Ut),Vt(Ut,Ct,et,!0)),yn||ot(yt,Dt,ii,0)}Qc(et,yt),et.pendingBranch=null,et.isInFallback=!1;let hn=et.parent,Kt=!1;for(;hn;){if(hn.pendingBranch){hn.effects.push(...qe),Kt=!0;break}hn=hn.parent}Kt||dd(qe),et.effects=[],wo(Gt,"onResolve")},fallback($e){if(!et.pendingBranch)return;const{vnode:Gt,activeBranch:Ut,parentComponent:yt,container:wt,isSVG:qe}=et;wo(Gt,"onFallback");const Ct=Jt(Ut),Dt=()=>{et.isInFallback&&(nt(null,$e,wt,Ct,yt,null,qe,Me,De),Qc(et,$e))},hn=$e.transition&&$e.transition.mode==="out-in";hn&&(Ut.transition.afterLeave=Dt),et.isInFallback=!0,Vt(Ut,yt,null,!0),hn||Dt()},move($e,Gt,Ut){et.activeBranch&&ot(et.activeBranch,$e,Gt,Ut),et.container=$e},next(){return et.activeBranch&&Jt(et.activeBranch)},registerDep($e,Gt){const Ut=!!et.pendingBranch;Ut&&et.deps++;const yt=$e.vnode.el;$e.asyncDep.catch(wt=>{aa(wt,$e,0)}).then(wt=>{if($e.isUnmounted||et.isUnmounted||et.pendingId!==$e.suspenseId)return;$e.asyncResolved=!0;const{vnode:qe}=$e;qs(qe),jg($e,wt,!1),yt&&(qe.el=yt);const Ct=!yt&&$e.subTree.el;Gt($e,qe,en(yt||$e.subTree.el),yt?null:Jt($e.subTree),et,be,De),Ct&&Yt(Ct),Th($e,qe.el),tp(),Ut&&--et.deps===0&&et.resolve()})},unmount($e,Gt){et.isUnmounted=!0,et.activeBranch&&Vt(et.activeBranch,D,$e,Gt),et.pendingBranch&&Vt(et.pendingBranch,D,$e,Gt)}};return et}function ef(g,b,D,L,Y,ne,be,Me,De){const je=b.suspense=Qu(b,L,D,g.parentNode,document.createElement("div"),null,Y,ne,be,Me,!0),st=De(g,je.pendingBranch=b.ssContent,D,je,ne,be);return je.deps===0&&je.resolve(),st}function tf(g){const{shapeFlag:b,children:D}=g,L=b&32;g.ssContent=wu(L?D.default:D),g.ssFallback=L?wu(D.fallback):go(Xs)}function wu(g){let b;if(bt(g)){const D=mo&&g._c;D&&(g._d=!1,Oh()),g=g(),D&&(g._d=!0,b=Go,fo())}if(Nt(g)){const D=Uo(g);D||ei("<Suspense> slots expect a single root node."),g=D}return g=ul(g),b&&!g.dynamicChildren&&(g.dynamicChildren=b.filter(D=>D!==g)),g}function Ch(g,b){b&&b.pendingBranch?Nt(g)?b.effects.push(...g):b.effects.push(g):dd(g)}function Qc(g,b){g.activeBranch=b;const{vnode:D,parentComponent:L}=g,Y=D.el=b.el;L&&L.subTree===D&&(L.vnode.el=Y,Th(L,Y))}function bs(g,b){if(!$o)ei("provide() can only be used inside setup().");else{let D=$o.provides;const L=$o.parent&&$o.parent.provides;L===D&&(D=$o.provides=Object.create(L)),D[g]=b}}function Ca(g,b,D=!1){const L=$o||Zs;if(L){const Y=L.parent==null?L.vnode.appContext&&L.vnode.appContext.provides:L.parent.provides;if(Y&&g in Y)return Y[g];if(arguments.length>1)return D&&bt(b)?b.call(L.proxy):b;ei(`injection "${String(g)}" not found.`)}else ei("inject() can only be used inside setup() or functional components.")}function Ra(g,b){return Ac(g,null,b)}function Eu(g,b){return Ac(g,null,Object.assign(b||{},{flush:"post"}))}function qc(g,b){return Ac(g,null,Object.assign(b||{},{flush:"sync"}))}const vc={};function yc(g,b,D){return bt(b)||ei("`watch(fn, options?)` signature has been moved to a separate API. Use `watchEffect(fn, options?)` instead. `watch` now only supports `watch(source, cb, options?) signature."),Ac(g,b,D)}function Ac(g,b,{immediate:D,deep:L,flush:Y,onTrack:ne,onTrigger:be}=he){b||(D!==void 0&&ei('watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.'),L!==void 0&&ei('watch() "deep" option is only respected when using the watch(source, callback, options?) signature.'));const Me=et=>{ei("Invalid watch source: ",et,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},De=$o;let je,st=!1,nt=!1;if(ao(g)?(je=()=>g.value,st=Gu(g)):Va(g)?(je=()=>g,L=!0):Nt(g)?(nt=!0,st=g.some(Va),je=()=>g.map(et=>{if(ao(et))return et.value;if(Va(et))return ql(et);if(bt(et))return kr(et,De,2);Me(et)})):bt(g)?b?je=()=>kr(g,De,2):je=()=>{if(!(De&&De.isUnmounted))return ot&&ot(),qo(g,De,3,[Vt])}:(je=Ce,Me(g)),b&&L){const et=je;je=()=>ql(et())}let ot,Vt=et=>{ot=ln.onStop=()=>{kr(et,De,4)}},Jt=nt?[]:vc;const en=()=>{if(ln.active)if(b){const et=ln.run();(L||st||(nt?et.some(($e,Gt)=>Ve($e,Jt[Gt])):Ve(et,Jt)))&&(ot&&ot(),qo(b,De,3,[et,Jt===vc?void 0:Jt,Vt]),Jt=et)}else ln.run()};en.allowRecurse=!!b;let Yt;Y==="sync"?Yt=en:Y==="post"?Yt=()=>Oa(en,De&&De.suspense):Yt=()=>{!De||De.isMounted?$f(en):en()};const ln=new uo(je,Yt);return ln.onTrack=ne,ln.onTrigger=be,b?D?en():Jt=ln.run():Y==="post"?Oa(ln.run.bind(ln),De&&De.suspense):ln.run(),()=>{ln.stop(),De&&De.scope&&At(De.scope.effects,ln)}}function gd(g,b,D){const L=this.proxy,Y=sn(g)?g.includes(".")?qu(L,g):()=>L[g]:g.bind(L,L);let ne;bt(b)?ne=b:(ne=b.handler,D=b);const be=$o;Nh(this);const Me=Ac(Y,ne.bind(L),D);return be?Nh(be):Td(),Me}function qu(g,b){const D=b.split(".");return()=>{let L=g;for(let Y=0;Y<D.length&&L;Y++)L=L[D[Y]];return L}}function ql(g,b){if(!Un(g)||g.__v_skip||(b=b||new Set,b.has(g)))return g;if(b.add(g),ao(g))ql(g.value,b);else if(Nt(g))for(let D=0;D<g.length;D++)ql(g[D],b);else if(Qe(g)||Qt(g))g.forEach(D=>{ql(D,b)});else if(dn(g))for(const D in g)ql(g[D],b);return g}function _d(){const g={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Aa(()=>{g.isMounted=!0}),Xu(()=>{g.isUnmounting=!0}),g}const Cs=[Function,Array],da={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Cs,onEnter:Cs,onAfterEnter:Cs,onEnterCancelled:Cs,onBeforeLeave:Cs,onLeave:Cs,onAfterLeave:Cs,onLeaveCancelled:Cs,onBeforeAppear:Cs,onAppear:Cs,onAfterAppear:Cs,onAppearCancelled:Cs},setup(g,{slots:b}){const D=Lh(),L=_d();let Y;return()=>{const ne=b.default&&Fi(b.default(),!0);if(!ne||!ne.length)return;ne.length>1&&ei("<transition> can only be used on a single element or component. Use <transition-group> for lists.");const be=Nr(g),{mode:Me}=be;Me&&Me!=="in-out"&&Me!=="out-in"&&Me!=="default"&&ei(`invalid <transition> mode: ${Me}`);const De=ne[0];if(L.isLeaving)return Fo(De);const je=bc(De);if(!je)return Fo(De);const st=Rh(je,be,L,D);Xc(je,st);const nt=D.subTree,ot=nt&&bc(nt);let Vt=!1;const{getTransitionKey:Jt}=je.type;if(Jt){const en=Jt();Y===void 0?Y=en:en!==Y&&(Y=en,Vt=!0)}if(ot&&ot.type!==Xs&&(!to(je,ot)||Vt)){const en=Rh(ot,be,L,D);if(Xc(ot,en),Me==="out-in")return L.isLeaving=!0,en.afterLeave=()=>{L.isLeaving=!1,D.update()},Fo(De);Me==="in-out"&&je.type!==Xs&&(en.delayLeave=(Yt,ln,et)=>{const $e=lp(L,ot);$e[String(ot.key)]=ot,Yt._leaveCb=()=>{ln(),Yt._leaveCb=void 0,delete st.delayedLeave},st.delayedLeave=et})}return De}}};function lp(g,b){const{leavingVNodes:D}=g;let L=D.get(b.type);return L||(L=Object.create(null),D.set(b.type,L)),L}function Rh(g,b,D,L){const{appear:Y,mode:ne,persisted:be=!1,onBeforeEnter:Me,onEnter:De,onAfterEnter:je,onEnterCancelled:st,onBeforeLeave:nt,onLeave:ot,onAfterLeave:Vt,onLeaveCancelled:Jt,onBeforeAppear:en,onAppear:Yt,onAfterAppear:ln,onAppearCancelled:et}=b,$e=String(g.key),Gt=lp(D,g),Ut=(wt,qe)=>{wt&&qo(wt,L,9,qe)},yt={mode:ne,persisted:be,beforeEnter(wt){let qe=Me;if(!D.isMounted)if(Y)qe=en||Me;else return;wt._leaveCb&&wt._leaveCb(!0);const Ct=Gt[$e];Ct&&to(g,Ct)&&Ct.el._leaveCb&&Ct.el._leaveCb(),Ut(qe,[wt])},enter(wt){let qe=De,Ct=je,Dt=st;if(!D.isMounted)if(Y)qe=Yt||De,Ct=ln||je,Dt=et||st;else return;let hn=!1;const Kt=wt._enterCb=yn=>{hn||(hn=!0,yn?Ut(Dt,[wt]):Ut(Ct,[wt]),yt.delayedLeave&&yt.delayedLeave(),wt._enterCb=void 0)};qe?(qe(wt,Kt),qe.length<=1&&Kt()):Kt()},leave(wt,qe){const Ct=String(g.key);if(wt._enterCb&&wt._enterCb(!0),D.isUnmounting)return qe();Ut(nt,[wt]);let Dt=!1;const hn=wt._leaveCb=Kt=>{Dt||(Dt=!0,qe(),Kt?Ut(Jt,[wt]):Ut(Vt,[wt]),wt._leaveCb=void 0,Gt[Ct]===g&&delete Gt[Ct])};Gt[Ct]=g,ot?(ot(wt,hn),ot.length<=1&&hn()):hn()},clone(wt){return Rh(wt,b,D,L)}};return yt}function Fo(g){if(zo(g))return g=eh(g),g.children=null,g}function bc(g){return zo(g)?g.children?g.children[0]:void 0:g}function Xc(g,b){g.shapeFlag&6&&g.component?Xc(g.component.subTree,b):g.shapeFlag&128?(g.ssContent.transition=b.clone(g.ssContent),g.ssFallback.transition=b.clone(g.ssFallback)):g.transition=b}function Fi(g,b=!1){let D=[],L=0;for(let Y=0;Y<g.length;Y++){const ne=g[Y];ne.type===Vo?(ne.patchFlag&128&&L++,D=D.concat(Fi(ne.children,b))):(b||ne.type!==Xs)&&D.push(ne)}if(L>1)for(let Y=0;Y<D.length;Y++)D[Y].patchFlag=-2;return D}function Ls(g){return bt(g)?{setup:g,name:g.name}:g}const Ia=g=>!!g.type.__asyncLoader;function ho(g){bt(g)&&(g={loader:g});const{loader:b,loadingComponent:D,errorComponent:L,delay:Y=200,timeout:ne,suspensible:be=!0,onError:Me}=g;let De=null,je,st=0;const nt=()=>(st++,De=null,ot()),ot=()=>{let Vt;return De||(Vt=De=b().catch(Jt=>{if(Jt=Jt instanceof Error?Jt:new Error(String(Jt)),Me)return new Promise((en,Yt)=>{Me(Jt,()=>en(nt()),()=>Yt(Jt),st+1)});throw Jt}).then(Jt=>{if(Vt!==De&&De)return De;if(Jt||ei("Async component loader resolved to undefined. If you are using retry(), make sure to return its return value."),Jt&&(Jt.__esModule||Jt[Symbol.toStringTag]==="Module")&&(Jt=Jt.default),Jt&&!Un(Jt)&&!bt(Jt))throw new Error(`Invalid async component load result: ${Jt}`);return je=Jt,Jt}))};return Ls({name:"AsyncComponentWrapper",__asyncLoader:ot,get __asyncResolved(){return je},setup(){const Vt=$o;if(je)return()=>po(je,Vt);const Jt=et=>{De=null,aa(et,Vt,13,!L)};if(be&&Vt.suspense)return ot().then(et=>()=>po(et,Vt)).catch(et=>(Jt(et),()=>L?go(L,{error:et}):null));const en=ud(!1),Yt=ud(),ln=ud(!!Y);return Y&&setTimeout(()=>{ln.value=!1},Y),ne!=null&&setTimeout(()=>{if(!en.value&&!Yt.value){const et=new Error(`Async component timed out after ${ne}ms.`);Jt(et),Yt.value=et}},ne),ot().then(()=>{en.value=!0,Vt.parent&&zo(Vt.parent.vnode)&&Wa(Vt.parent.update)}).catch(et=>{Jt(et),Yt.value=et}),()=>{if(en.value&&je)return po(je,Vt);if(Yt.value&&L)return go(L,{error:Yt.value});if(D&&!ln.value)return go(D)}}})}function po(g,{vnode:{ref:b,props:D,children:L}}){const Y=go(g,D,L);return Y.ref=b,Y}const zo=g=>g.type.__isKeepAlive,Mg={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(g,{slots:b}){const D=Lh(),L=D.ctx;if(!L.renderer)return b.default;const Y=new Map,ne=new Set;let be=null;D.__v_cache=Y;const Me=D.suspense,{renderer:{p:De,m:je,um:st,o:{createElement:nt}}}=L,ot=nt("div");L.activate=(et,$e,Gt,Ut,yt)=>{const wt=et.component;je(et,$e,Gt,0,Me),De(wt.vnode,et,$e,Gt,wt,Me,Ut,et.slotScopeIds,yt),Oa(()=>{wt.isDeactivated=!1,wt.a&&We(wt.a);const qe=et.props&&et.props.onVnodeMounted;qe&&Kl(qe,wt.parent,et)},Me),wh(wt)},L.deactivate=et=>{const $e=et.component;je(et,ot,null,1,Me),Oa(()=>{$e.da&&We($e.da);const Gt=et.props&&et.props.onVnodeUnmounted;Gt&&Kl(Gt,$e.parent,et),$e.isDeactivated=!0},Me),wh($e)};function Vt(et){rf(et),st(et,D,Me,!0)}function Jt(et){Y.forEach(($e,Gt)=>{const Ut=kh($e.type);Ut&&(!et||!et(Ut))&&en(Gt)})}function en(et){const $e=Y.get(et);!be||$e.type!==be.type?Vt($e):be&&rf(be),Y.delete(et),ne.delete(et)}yc(()=>[g.include,g.exclude],([et,$e])=>{et&&Jt(Gt=>ws(et,Gt)),$e&&Jt(Gt=>!ws($e,Gt))},{flush:"post",deep:!0});let Yt=null;const ln=()=>{Yt!=null&&Y.set(Yt,Xl(D.subTree))};return Aa(ln),cp(ln),Xu(()=>{Y.forEach(et=>{const{subTree:$e,suspense:Gt}=D,Ut=Xl($e);if(et.type===Ut.type){rf(Ut);const yt=Ut.component.da;yt&&Oa(yt,Gt);return}Vt(et)})}),()=>{if(Yt=null,!b.default)return null;const et=b.default(),$e=et[0];if(et.length>1)return ei("KeepAlive should contain exactly one component child."),be=null,et;if(!Bh($e)||!($e.shapeFlag&4)&&!($e.shapeFlag&128))return be=null,$e;let Gt=Xl($e);const Ut=Gt.type,yt=kh(Ia(Gt)?Gt.type.__asyncResolved||{}:Ut),{include:wt,exclude:qe,max:Ct}=g;if(wt&&(!yt||!ws(wt,yt))||qe&&yt&&ws(qe,yt))return be=Gt,$e;const Dt=Gt.key==null?Ut:Gt.key,hn=Y.get(Dt);return Gt.el&&(Gt=eh(Gt),$e.shapeFlag&128&&($e.ssContent=Gt)),Yt=Dt,hn?(Gt.el=hn.el,Gt.component=hn.component,Gt.transition&&Xc(Gt,Gt.transition),Gt.shapeFlag|=512,ne.delete(Dt),ne.add(Dt)):(ne.add(Dt),Ct&&ne.size>parseInt(Ct,10)&&en(ne.values().next().value)),Gt.shapeFlag|=256,be=Gt,$e}}};function ws(g,b){return Nt(g)?g.some(D=>ws(D,b)):sn(g)?g.split(",").includes(b):g.test?g.test(b):!1}function vd(g,b){nf(g,"a",b)}function Ns(g,b){nf(g,"da",b)}function nf(g,b,D=$o){const L=g.__wdc||(g.__wdc=()=>{let Y=D;for(;Y;){if(Y.isDeactivated)return;Y=Y.parent}return g()});if(Ih(b,L,D),D){let Y=D.parent;for(;Y&&Y.parent;)zo(Y.parent.vnode)&&ov(L,b,D,Y),Y=Y.parent}}function ov(g,b,D,L){const Y=Ih(b,g,L,!0);pa(()=>{At(L[b],Y)},D)}function rf(g){let b=g.shapeFlag;b&256&&(b-=256),b&512&&(b-=512),g.shapeFlag=b}function Xl(g){return g.shapeFlag&128?g.ssContent:g}function Ih(g,b,D=$o,L=!1){if(D){const Y=D[g]||(D[g]=[]),ne=b.__weh||(b.__weh=(...be)=>{if(D.isUnmounted)return;ja(),Nh(D);const Me=qo(b,D,g,be);return Td(),Lo(),Me});return L?Y.unshift(ne):Y.push(ne),ne}else{const Y=Se(Wu[g].replace(/ hook$/,""));ei(`${Y} is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.`)}}const Yc=g=>(b,D=$o)=>(!zg||g==="sp")&&Ih(g,b,D),Ph=Yc("bm"),Aa=Yc("m"),tr=Yc("bu"),cp=Yc("u"),Xu=Yc("bum"),pa=Yc("um"),sf=Yc("sp"),ie=Yc("rtg"),T=Yc("rtc");function F(g,b=$o){Ih("ec",g,b)}function de(){const g=Object.create(null);return(b,D)=>{g[D]?ei(`${b} property "${D}" is already defined in ${g[D]}.`):g[D]=b}}let Fe=!0;function Mt(g){const b=zi(g),D=g.proxy,L=g.ctx;Fe=!1,b.beforeCreate&&Tn(b.beforeCreate,g,"bc");const{data:Y,computed:ne,methods:be,watch:Me,provide:De,inject:je,created:st,beforeMount:nt,mounted:ot,beforeUpdate:Vt,updated:Jt,activated:en,deactivated:Yt,beforeDestroy:ln,beforeUnmount:et,destroyed:$e,unmounted:Gt,render:Ut,renderTracked:yt,renderTriggered:wt,errorCaptured:qe,serverPrefetch:Ct,expose:Dt,inheritAttrs:hn,components:Kt,directives:yn,filters:ii}=b,Ui=de();{const[ci]=g.propsOptions;if(ci)for(const Ii in ci)Ui("Props",Ii)}if(je&&kt(je,L,Ui,g.appContext.config.unwrapInjectedRef),be)for(const ci in be){const Ii=be[ci];bt(Ii)?(Object.defineProperty(L,ci,{value:Ii.bind(D),configurable:!0,enumerable:!0,writable:!0}),Ui("Methods",ci)):ei(`Method "${ci}" has type "${typeof Ii}" in the component definition. Did you reference the function correctly?`)}if(Y){bt(Y)||ei("The data option must be a function. Plain object usage is no longer supported.");const ci=Y.call(D,D);if(pi(ci)&&ei("data() returned a Promise - note data() cannot be async; If you intend to perform data fetching before component renders, use async setup() + <Suspense>."),!Un(ci))ei("data() should return an object.");else{g.data=Is(ci);for(const Ii in ci)Ui("Data",Ii),Ii[0]!=="$"&&Ii[0]!=="_"&&Object.defineProperty(L,Ii,{configurable:!0,enumerable:!0,get:()=>ci[Ii],set:Ce})}}if(Fe=!0,ne)for(const ci in ne){const Ii=ne[ci],$i=bt(Ii)?Ii.bind(D,D):bt(Ii.get)?Ii.get.bind(D,D):Ce;$i===Ce&&ei(`Computed property "${ci}" has no getter.`);const sr=!bt(Ii)&&bt(Ii.set)?Ii.set.bind(D):()=>{ei(`Write operation failed: computed property "${ci}" is readonly.`)},xs=pm({get:$i,set:sr});Object.defineProperty(L,ci,{enumerable:!0,configurable:!0,get:()=>xs.value,set:yo=>xs.value=yo}),Ui("Computed",ci)}if(Me)for(const ci in Me)gi(Me[ci],L,D,ci);if(De){const ci=bt(De)?De.call(D):De;Reflect.ownKeys(ci).forEach(Ii=>{bs(Ii,ci[Ii])})}st&&Tn(st,g,"c");function Bi(ci,Ii){Nt(Ii)?Ii.forEach($i=>ci($i.bind(D))):Ii&&ci(Ii.bind(D))}if(Bi(Ph,nt),Bi(Aa,ot),Bi(tr,Vt),Bi(cp,Jt),Bi(vd,en),Bi(Ns,Yt),Bi(F,qe),Bi(T,yt),Bi(ie,wt),Bi(Xu,et),Bi(pa,Gt),Bi(sf,Ct),Nt(Dt))if(Dt.length){const ci=g.exposed||(g.exposed={});Dt.forEach(Ii=>{Object.defineProperty(ci,Ii,{get:()=>D[Ii],set:$i=>D[Ii]=$i})})}else g.exposed||(g.exposed={});Ut&&g.render===Ce&&(g.render=Ut),hn!=null&&(g.inheritAttrs=hn),Kt&&(g.components=Kt),yn&&(g.directives=yn)}function kt(g,b,D=Ce,L=!1){Nt(g)&&(g=Dl(g));for(const Y in g){const ne=g[Y];let be;Un(ne)?"default"in ne?be=Ca(ne.from||Y,ne.default,!0):be=Ca(ne.from||Y):be=Ca(ne),ao(be)?L?Object.defineProperty(b,Y,{enumerable:!0,configurable:!0,get:()=>be.value,set:Me=>be.value=Me}):(ei(`injected property "${Y}" is a ref and will be auto-unwrapped and no longer needs \`.value\` in the next minor release. To opt-in to the new behavior now, set \`app.config.unwrapInjectedRef = true\` (this config is temporary and will not be needed in the future.)`),b[Y]=be):b[Y]=be,D("Inject",Y)}}function Tn(g,b,D){qo(Nt(g)?g.map(L=>L.bind(b.proxy)):g.bind(b.proxy),b,D)}function gi(g,b,D,L){const Y=L.includes(".")?qu(D,L):()=>D[L];if(sn(g)){const ne=b[g];bt(ne)?yc(Y,ne):ei(`Invalid watch handler specified by key "${g}"`,ne)}else if(bt(g))yc(Y,g.bind(D));else if(Un(g))if(Nt(g))g.forEach(ne=>gi(ne,b,D,L));else{const ne=bt(g.handler)?g.handler.bind(D):b[g.handler];bt(ne)?yc(Y,ne,g):ei(`Invalid watch handler specified by key "${g.handler}"`,ne)}else ei(`Invalid watch option: "${L}"`,g)}function zi(g){const b=g.type,{mixins:D,extends:L}=b,{mixins:Y,optionsCache:ne,config:{optionMergeStrategies:be}}=g.appContext,Me=ne.get(b);let De;return Me?De=Me:!Y.length&&!D&&!L?De=b:(De={},Y.length&&Y.forEach(je=>Tr(De,je,be,!0)),Tr(De,b,be)),ne.set(b,De),De}function Tr(g,b,D,L=!1){const{mixins:Y,extends:ne}=b;ne&&Tr(g,ne,D,!0),Y&&Y.forEach(be=>Tr(g,be,D,!0));for(const be in b)if(L&&be==="expose")ei('"expose" option is ignored when declared in mixins or extends. It should only be declared in the base component itself.');else{const Me=eo[be]||D&&D[be];g[be]=Me?Me(g[be],b[be]):b[be]}return g}const eo={data:Xa,props:xc,emits:xc,methods:xc,computed:xc,beforeCreate:jo,created:jo,beforeMount:jo,mounted:jo,beforeUpdate:jo,updated:jo,beforeDestroy:jo,beforeUnmount:jo,destroyed:jo,unmounted:jo,activated:jo,deactivated:jo,errorCaptured:jo,serverPrefetch:jo,components:xc,directives:xc,watch:tm,provide:Xa,inject:Yo};function Xa(g,b){return b?g?function(){return _t(bt(g)?g.call(this,this):g,bt(b)?b.call(this,this):b)}:b:g}function Yo(g,b){return xc(Dl(g),Dl(b))}function Dl(g){if(Nt(g)){const b={};for(let D=0;D<g.length;D++)b[g[D]]=g[D];return b}return g}function jo(g,b){return g?[...new Set([].concat(g,b))]:b}function xc(g,b){return g?_t(_t(Object.create(null),g),b):b}function tm(g,b){if(!g)return b;if(!b)return g;const D=_t(Object.create(null),g);for(const L in b)D[L]=jo(g[L],b[L]);return D}function yd(g,b,D,L=!1){const Y={},ne={};pt(ne,Ng,1),g.propsDefaults=Object.create(null),Ad(g,b,Y,ne);for(const be in g.propsOptions[0])be in Y||(Y[be]=void 0);av(b||{},Y,g),D?g.props=L?Y:Vu(Y):g.type.props?g.props=Y:g.props=ne,g.attrs=ne}function up(g,b,D,L){const{props:Y,attrs:ne,vnode:{patchFlag:be}}=g,Me=Nr(Y),[De]=g.propsOptions;let je=!1;if(!(g.type.__hmrId||g.parent&&g.parent.type.__hmrId)&&(L||be>0)&&!(be&16)){if(be&8){const st=g.vnode.dynamicProps;for(let nt=0;nt<st.length;nt++){let ot=st[nt];const Vt=b[ot];if(De)if(ut(ne,ot))Vt!==ne[ot]&&(ne[ot]=Vt,je=!0);else{const Jt=In(ot);Y[Jt]=bd(De,Me,Jt,Vt,g,!1)}else Vt!==ne[ot]&&(ne[ot]=Vt,je=!0)}}}else{Ad(g,b,Y,ne)&&(je=!0);let st;for(const nt in Me)(!b||!ut(b,nt)&&((st=Hn(nt))===nt||!ut(b,st)))&&(De?D&&(D[nt]!==void 0||D[st]!==void 0)&&(Y[nt]=bd(De,Me,nt,void 0,g,!0)):delete Y[nt]);if(ne!==Me)for(const nt in ne)(!b||!ut(b,nt))&&(delete ne[nt],je=!0)}je&&un(g,"set","$attrs"),av(b||{},Y,g)}function Ad(g,b,D,L){const[Y,ne]=g.propsOptions;let be=!1,Me;if(b)for(let De in b){if(Pn(De))continue;const je=b[De];let st;Y&&ut(Y,st=In(De))?!ne||!ne.includes(st)?D[st]=je:(Me||(Me={}))[st]=je:Au(g.emitsOptions,De)||(!(De in L)||je!==L[De])&&(L[De]=je,be=!0)}if(ne){const De=Nr(D),je=Me||he;for(let st=0;st<ne.length;st++){const nt=ne[st];D[nt]=bd(Y,De,nt,je[nt],g,!ut(je,nt))}}return be}function bd(g,b,D,L,Y,ne){const be=g[D];if(be!=null){const Me=ut(be,"default");if(Me&&L===void 0){const De=be.default;if(be.type!==Function&&bt(De)){const{propsDefaults:je}=Y;D in je?L=je[D]:(Nh(Y),L=je[D]=De.call(null,b),Td())}else L=De}be[0]&&(ne&&!Me?L=!1:be[1]&&(L===""||L===Hn(D))&&(L=!0))}return L}function Ko(g,b,D=!1){const L=b.propsCache,Y=L.get(g);if(Y)return Y;const ne=g.props,be={},Me=[];let De=!1;if(!bt(g)){const st=nt=>{De=!0;const[ot,Vt]=Ko(nt,b,!0);_t(be,ot),Vt&&Me.push(...Vt)};!D&&b.mixins.length&&b.mixins.forEach(st),g.extends&&st(g.extends),g.mixins&&g.mixins.forEach(st)}if(!ne&&!De)return L.set(g,we),we;if(Nt(ne))for(let st=0;st<ne.length;st++){sn(ne[st])||ei("props must be strings when using array syntax.",ne[st]);const nt=In(ne[st]);Tg(nt)&&(be[nt]=he)}else if(ne){Un(ne)||ei("invalid props options",ne);for(const st in ne){const nt=In(st);if(Tg(nt)){const ot=ne[st],Vt=be[nt]=Nt(ot)||bt(ot)?{type:ot}:ot;if(Vt){const Jt=Pa(Boolean,Vt.type),en=Pa(String,Vt.type);Vt[0]=Jt>-1,Vt[1]=en<0||Jt<en,(Jt>-1||ut(Vt,"default"))&&Me.push(nt)}}}}const je=[be,Me];return L.set(g,je),je}function Tg(g){return g[0]!=="$"?!0:(ei(`Invalid prop name: "${g}" is a reserved property.`),!1)}function Yu(g){const b=g&&g.toString().match(/^\s*function (\w+)/);return b?b[1]:g===null?"null":""}function cl(g,b){return Yu(g)===Yu(b)}function Pa(g,b){return Nt(b)?b.findIndex(D=>cl(D,g)):bt(b)&&cl(b,g)?0:-1}function av(g,b,D){const L=Nr(b),Y=D.propsOptions[0];for(const ne in Y){let be=Y[ne];be!=null&&T0(ne,L[ne],be,!ut(g,ne)&&!ut(g,Hn(ne)))}}function T0(g,b,D,L){const{type:Y,required:ne,validator:be}=D;if(ne&&L){ei('Missing required prop: "'+g+'"');return}if(!(b==null&&!D.required)){if(Y!=null&&Y!==!0){let Me=!1;const De=Nt(Y)?Y:[Y],je=[];for(let st=0;st<De.length&&!Me;st++){const{valid:nt,expectedType:ot}=Cg(b,De[st]);je.push(ot||""),Me=nt}if(!Me){ei(Eo(g,b,je));return}}be&&!be(b)&&ei('Invalid prop: custom validator check failed for prop "'+g+'".')}}const Su=a("String,Number,Boolean,Function,Symbol,BigInt");function Cg(g,b){let D;const L=Yu(b);if(Su(L)){const Y=typeof g;D=Y===L.toLowerCase(),!D&&Y==="object"&&(D=g instanceof b)}else L==="Object"?D=Un(g):L==="Array"?D=Nt(g):L==="null"?D=g===null:D=g instanceof b;return{valid:D,expectedType:L}}function Eo(g,b,D){let L=`Invalid prop: type check failed for prop "${g}". Expected ${D.map(fe).join(" | ")}`;const Y=D[0],ne=tn(b),be=Mu(b,Y),Me=Mu(b,ne);return D.length===1&&Rg(Y)&&!xd(Y,ne)&&(L+=` with value ${be}`),L+=`, got ${ne} `,Rg(ne)&&(L+=`with value ${Me}.`),L}function Mu(g,b){return b==="String"?`"${g}"`:b==="Number"?`${Number(g)}`:`${g}`}function Rg(g){return["string","number","boolean"].some(D=>g.toLowerCase()===D)}function xd(...g){return g.some(b=>b.toLowerCase()==="boolean")}const C0=g=>g[0]==="_"||g==="$stable",Ig=g=>Nt(g)?g.map(ul):[ul(g)],xb=(g,b,D)=>{const L=Gr((...Y)=>($o&&ei(`Slot "${g}" invoked outside of the render function: this will not track dependencies used in the slot. Invoke the slot function inside the render function instead.`),Ig(b(...Y))),D);return L._c=!1,L},Zy=(g,b,D)=>{const L=g._ctx;for(const Y in g){if(C0(Y))continue;const ne=g[Y];if(bt(ne))b[Y]=xb(Y,ne,L);else if(ne!=null){ei(`Non-function value encountered for slot "${Y}". Prefer function slots for better performance.`);const be=Ig(ne);b[Y]=()=>be}}},Ku=(g,b)=>{zo(g.vnode)||ei("Non-function value encountered for default slot. Prefer function slots for better performance.");const D=Ig(b);g.slots.default=()=>D},hp=(g,b)=>{if(g.vnode.shapeFlag&32){const D=b._;D?(g.slots=Nr(b),pt(b,"_",D)):Zy(b,g.slots={})}else g.slots={},b&&Ku(g,b);pt(g.slots,Ng,1)},lv=(g,b,D)=>{const{vnode:L,slots:Y}=g;let ne=!0,be=he;if(L.shapeFlag&32){const Me=b._;Me?ko?_t(Y,b):D&&Me===1?ne=!1:(_t(Y,b),!D&&Me===1&&delete Y._):(ne=!b.$stable,Zy(b,Y)),be=b}else b&&(Ku(g,b),be={default:1});if(ne)for(const Me in Y)!C0(Me)&&!(Me in be)&&delete Y[Me]},cv=a("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo");function R0(g){cv(g)&&ei("Do not use built-in directive ids as custom directive id: "+g)}function wb(g,b){const D=Zs;if(D===null)return ei("withDirectives can only be used inside render functions."),g;const L=D.proxy,Y=g.dirs||(g.dirs=[]);for(let ne=0;ne<b.length;ne++){let[be,Me,De,je=he]=b[ne];bt(be)&&(be={mounted:be,updated:be}),be.deep&&ql(Me),Y.push({dir:be,instance:L,value:Me,oldValue:void 0,arg:De,modifiers:je})}return g}function Da(g,b,D,L){const Y=g.dirs,ne=b&&b.dirs;for(let be=0;be<Y.length;be++){const Me=Y[be];ne&&(Me.oldValue=ne[be].value);let De=Me.dir[L];De&&(ja(),qo(De,D,8,[g.el,Me,g,b]),Lo())}}function os(){return{app:null,config:{isNativeTag:Ne,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Vi=0;function Ol(g,b){return function(L,Y=null){Y!=null&&!Un(Y)&&(ei("root props passed to app.mount() must be an object."),Y=null);const ne=os(),be=new Set;let Me=!1;const De=ne.app={_uid:Vi++,_component:L,_props:Y,_container:null,_context:ne,_instance:null,version:fm,get config(){return ne.config},set config(je){ei("app.config cannot be replaced. Modify individual options instead.")},use(je,...st){return be.has(je)?ei("Plugin has already been applied to target app."):je&&bt(je.install)?(be.add(je),je.install(De,...st)):bt(je)?(be.add(je),je(De,...st)):ei('A plugin must either be a function or an object with an "install" function.'),De},mixin(je){return ne.mixins.includes(je)?ei("Mixin has already been applied to target app"+(je.name?`: ${je.name}`:"")):ne.mixins.push(je),De},component(je,st){return gv(je,ne.config),st?(ne.components[je]&&ei(`Component "${je}" has already been registered in target app.`),ne.components[je]=st,De):ne.components[je]},directive(je,st){return R0(je),st?(ne.directives[je]&&ei(`Directive "${je}" has already been registered in target app.`),ne.directives[je]=st,De):ne.directives[je]},mount(je,st,nt){if(Me)ei("App has already been mounted.\nIf you want to remount the same app, move your app creation logic into a factory function and create fresh app instances for each mount - e.g. `const createMyApp = () => createApp(App)`");else{const ot=go(L,Y);return ot.appContext=ne,ne.reload=()=>{g(eh(ot),je,nt)},st&&b?b(ot,je):g(ot,je,nt),Me=!0,De._container=je,je.__vue_app__=De,De._instance=ot.component,Gc(De,fm),vv(ot.component)||ot.component.proxy}},unmount(){Me?(g(null,De._container),De._instance=null,yu(De),delete De._container.__vue_app__):ei("Cannot unmount an app that is not mounted.")},provide(je,st){return je in ne.provides&&ei(`App already provides property with key "${String(je)}". It will be overwritten with the new value.`),ne.provides[je]=st,De}};return De}}function dp(g,b,D,L,Y=!1){if(Nt(g)){g.forEach((ot,Vt)=>dp(ot,b&&(Nt(b)?b[Vt]:b),D,L,Y));return}if(Ia(L)&&!Y)return;const ne=L.shapeFlag&4?vv(L.component)||L.component.proxy:L.el,be=Y?null:ne,{i:Me,r:De}=g;if(!Me){ei("Missing ref owner context. ref cannot be used on hoisted vnodes. A vnode with ref must be created inside the render function.");return}const je=b&&b.r,st=Me.refs===he?Me.refs={}:Me.refs,nt=Me.setupState;if(je!=null&&je!==De&&(sn(je)?(st[je]=null,ut(nt,je)&&(nt[je]=null)):ao(je)&&(je.value=null)),bt(De))kr(De,Me,12,[be,st]);else{const ot=sn(De),Vt=ao(De);if(ot||Vt){const Jt=()=>{if(g.f){const en=ot?st[De]:De.value;Y?Nt(en)&&At(en,ne):Nt(en)?en.includes(ne)||en.push(ne):ot?st[De]=[ne]:(De.value=[ne],g.k&&(st[g.k]=De.value))}else ot?(st[De]=be,ut(nt,De)&&(nt[De]=be)):ao(De)?(De.value=be,g.k&&(st[g.k]=be)):ei("Invalid template ref type:",De,`(${typeof De})`)};be?(Jt.id=-1,Oa(Jt,D)):Jt()}else ei("Invalid template ref type:",De,`(${typeof De})`)}}let wd=!1;const fi=g=>/svg/.test(g.namespaceURI)&&g.tagName!=="foreignObject",Pg=g=>g.nodeType===8;function of(g){const{mt:b,p:D,o:{patchProp:L,nextSibling:Y,parentNode:ne,remove:be,insert:Me,createComment:De}}=g,je=(Yt,ln)=>{if(!ln.hasChildNodes()){ei("Attempting to hydrate existing markup but container is empty. Performing full mount instead."),D(null,Yt,ln),Vr();return}wd=!1,st(ln.firstChild,Yt,null,null,null),Vr(),wd&&console.error("Hydration completed but contains mismatches.")},st=(Yt,ln,et,$e,Gt,Ut=!1)=>{const yt=Pg(Yt)&&Yt.data==="[",wt=()=>Jt(Yt,ln,et,$e,Gt,yt),{type:qe,ref:Ct,shapeFlag:Dt}=ln,hn=Yt.nodeType;ln.el=Yt;let Kt=null;switch(qe){case wc:hn!==3?Kt=wt():(Yt.data!==ln.children&&(wd=!0,ei(`Hydration text mismatch:
- Client: ${JSON.stringify(Yt.data)}
- Server: ${JSON.stringify(ln.children)}`),Yt.data=ln.children),Kt=Y(Yt));break;case Xs:hn!==8||yt?Kt=wt():Kt=Y(Yt);break;case Ba:if(hn!==1)Kt=wt();else{Kt=Yt;const yn=!ln.children.length;for(let ii=0;ii<ln.staticCount;ii++)yn&&(ln.children+=Kt.outerHTML),ii===ln.staticCount-1&&(ln.anchor=Kt),Kt=Y(Kt);return Kt}break;case Vo:yt?Kt=Vt(Yt,ln,et,$e,Gt,Ut):Kt=wt();break;default:if(Dt&1)hn!==1||ln.type.toLowerCase()!==Yt.tagName.toLowerCase()?Kt=wt():Kt=nt(Yt,ln,et,$e,Gt,Ut);else if(Dt&6){ln.slotScopeIds=Gt;const yn=ne(Yt);if(b(ln,yn,null,et,$e,fi(yn),Ut),Kt=yt?en(Yt):Y(Yt),Ia(ln)){let ii;yt?(ii=go(Vo),ii.anchor=Kt?Kt.previousSibling:yn.lastChild):ii=Yt.nodeType===3?cf(""):go("div"),ii.el=Yt,ln.component.subTree=ii}}else Dt&64?hn!==8?Kt=wt():Kt=ln.type.hydrate(Yt,ln,et,$e,Gt,Ut,g,ot):Dt&128?Kt=ln.type.hydrate(Yt,ln,et,$e,fi(ne(Yt)),Gt,Ut,g,st):ei("Invalid HostVNode type:",qe,`(${typeof qe})`)}return Ct!=null&&dp(Ct,null,$e,ln),Kt},nt=(Yt,ln,et,$e,Gt,Ut)=>{Ut=Ut||!!ln.dynamicChildren;const{type:yt,props:wt,patchFlag:qe,shapeFlag:Ct,dirs:Dt}=ln,hn=yt==="input"&&Dt||yt==="option";if(hn||qe!==-1){if(Dt&&Da(ln,null,et,"created"),wt)if(hn||!Ut||qe&48)for(const yn in wt)(hn&&yn.endsWith("value")||Ye(yn)&&!Pn(yn))&&L(Yt,yn,null,wt[yn],!1,void 0,et);else wt.onClick&&L(Yt,"onClick",null,wt.onClick,!1,void 0,et);let Kt;if((Kt=wt&&wt.onVnodeBeforeMount)&&Kl(Kt,et,ln),Dt&&Da(ln,null,et,"beforeMount"),((Kt=wt&&wt.onVnodeMounted)||Dt)&&Ch(()=>{Kt&&Kl(Kt,et,ln),Dt&&Da(ln,null,et,"mounted")},$e),Ct&16&&!(wt&&(wt.innerHTML||wt.textContent))){let yn=ot(Yt.firstChild,ln,Yt,et,$e,Gt,Ut),ii=!1;for(;yn;){wd=!0,ii||(ei(`Hydration children mismatch in <${ln.type}>: server rendered element contains more child nodes than client vdom.`),ii=!0);const Ui=yn;yn=yn.nextSibling,be(Ui)}}else Ct&8&&Yt.textContent!==ln.children&&(wd=!0,ei(`Hydration text content mismatch in <${ln.type}>:
- Client: ${Yt.textContent}
- Server: ${ln.children}`),Yt.textContent=ln.children)}return Yt.nextSibling},ot=(Yt,ln,et,$e,Gt,Ut,yt)=>{yt=yt||!!ln.dynamicChildren;const wt=ln.children,qe=wt.length;let Ct=!1;for(let Dt=0;Dt<qe;Dt++){const hn=yt?wt[Dt]:wt[Dt]=ul(wt[Dt]);if(Yt)Yt=st(Yt,hn,$e,Gt,Ut,yt);else{if(hn.type===wc&&!hn.children)continue;wd=!0,Ct||(ei(`Hydration children mismatch in <${et.tagName.toLowerCase()}>: server rendered element contains fewer child nodes than client vdom.`),Ct=!0),D(null,hn,et,null,$e,Gt,fi(et),Ut)}}return Yt},Vt=(Yt,ln,et,$e,Gt,Ut)=>{const{slotScopeIds:yt}=ln;yt&&(Gt=Gt?Gt.concat(yt):yt);const wt=ne(Yt),qe=ot(Y(Yt),ln,wt,et,$e,Gt,Ut);return qe&&Pg(qe)&&qe.data==="]"?Y(ln.anchor=qe):(wd=!0,Me(ln.anchor=De("]"),wt,qe),qe)},Jt=(Yt,ln,et,$e,Gt,Ut)=>{if(wd=!0,ei(`Hydration node mismatch:
- Client vnode:`,ln.type,`
- Server rendered DOM:`,Yt,Yt.nodeType===3?"(text)":Pg(Yt)&&Yt.data==="["?"(start of fragment)":""),ln.el=null,Ut){const qe=en(Yt);for(;;){const Ct=Y(Yt);if(Ct&&Ct!==qe)be(Ct);else break}}const yt=Y(Yt),wt=ne(Yt);return be(Yt),D(null,ln,wt,yt,et,$e,fi(wt),Gt),yt},en=Yt=>{let ln=0;for(;Yt;)if(Yt=Y(Yt),Yt&&Pg(Yt)&&(Yt.data==="["&&ln++,Yt.data==="]")){if(ln===0)return Y(Yt);ln--}return Yt};return[je,st]}let Ed,Kc;function So(g,b){g.appContext.config.performance&&nm()&&Kc.mark(`vue-${b}-${g.uid}`),Jp(g,b,Ed?Kc.now():Date.now())}function $c(g,b){if(g.appContext.config.performance&&nm()){const D=`vue-${b}-${g.uid}`,L=D+":end";Kc.mark(L),Kc.measure(`<${ff(g,g.type)}> ${b}`,D,L),Kc.clearMarks(D),Kc.clearMarks(L)}sv(g,b,Ed?Kc.now():Date.now())}function nm(){return Ed!==void 0||(typeof window<"u"&&window.performance?(Ed=!0,Kc=window.performance):Ed=!1),Ed}const Oa=Ch;function Jc(g){return Bl(g)}function Dg(g){return Bl(g,of)}function Bl(g,b){const D=nn();D.__VUE__=!0,Vc(D.__VUE_DEVTOOLS_GLOBAL_HOOK__,D);const{insert:L,remove:Y,patchProp:ne,createElement:be,createText:Me,createComment:De,setText:je,setElementText:st,parentNode:nt,nextSibling:ot,setScopeId:Vt=Ce,cloneNode:Jt,insertStaticContent:en}=g,Yt=(qt,cn,$n,_i=null,hi=null,Di=null,qi=!1,wi=null,Li=ko?!1:!!cn.dynamicChildren)=>{if(qt===cn)return;qt&&!to(qt,cn)&&(_i=Vd(qt),ds(qt,hi,Di,!0),qt=null),cn.patchFlag===-2&&(Li=!1,cn.dynamicChildren=null);const{type:vi,ref:mr,shapeFlag:Tt}=cn;switch(vi){case wc:ln(qt,cn,$n,_i);break;case Xs:et(qt,cn,$n,_i);break;case Ba:qt==null?$e(cn,$n,_i,qi):Gt(qt,cn,$n,qi);break;case Vo:ii(qt,cn,$n,_i,hi,Di,qi,wi,Li);break;default:Tt&1?wt(qt,cn,$n,_i,hi,Di,qi,wi,Li):Tt&6?Ui(qt,cn,$n,_i,hi,Di,qi,wi,Li):Tt&64||Tt&128?vi.process(qt,cn,$n,_i,hi,Di,qi,wi,Li,Zh):ei("Invalid VNode type:",vi,`(${typeof vi})`)}mr!=null&&hi&&dp(mr,qt&&qt.ref,Di,cn||qt,!cn)},ln=(qt,cn,$n,_i)=>{if(qt==null)L(cn.el=Me(cn.children),$n,_i);else{const hi=cn.el=qt.el;cn.children!==qt.children&&je(hi,cn.children)}},et=(qt,cn,$n,_i)=>{qt==null?L(cn.el=De(cn.children||""),$n,_i):cn.el=qt.el},$e=(qt,cn,$n,_i)=>{[qt.el,qt.anchor]=en(qt.children,cn,$n,_i,qt.el,qt.anchor)},Gt=(qt,cn,$n,_i)=>{if(cn.children!==qt.children){const hi=ot(qt.anchor);yt(qt),[cn.el,cn.anchor]=en(cn.children,$n,hi,_i)}else cn.el=qt.el,cn.anchor=qt.anchor},Ut=({el:qt,anchor:cn},$n,_i)=>{let hi;for(;qt&&qt!==cn;)hi=ot(qt),L(qt,$n,_i),qt=hi;L(cn,$n,_i)},yt=({el:qt,anchor:cn})=>{let $n;for(;qt&&qt!==cn;)$n=ot(qt),Y(qt),qt=$n;Y(cn)},wt=(qt,cn,$n,_i,hi,Di,qi,wi,Li)=>{qi=qi||cn.type==="svg",qt==null?qe(cn,$n,_i,hi,Di,qi,wi,Li):hn(qt,cn,hi,Di,qi,wi,Li)},qe=(qt,cn,$n,_i,hi,Di,qi,wi)=>{let Li,vi;const{type:mr,props:Tt,shapeFlag:fn,transition:xn,patchFlag:Dn,dirs:ti}=qt;{if(Li=qt.el=be(qt.type,Di,Tt&&Tt.is,Tt),fn&8?st(Li,qt.children):fn&16&&Dt(qt.children,Li,null,_i,hi,Di&&mr!=="foreignObject",qi,wi),ti&&Da(qt,null,_i,"created"),Tt){for(const hr in Tt)hr!=="value"&&!Pn(hr)&&ne(Li,hr,null,Tt[hr],Di,qt.children,_i,hi,xl);"value"in Tt&&ne(Li,"value",null,Tt.value),(vi=Tt.onVnodeBeforeMount)&&Kl(vi,_i,qt)}Ct(Li,qt,qt.scopeId,qi,_i)}Object.defineProperty(Li,"__vnode",{value:qt,enumerable:!1}),Object.defineProperty(Li,"__vueParentComponent",{value:_i,enumerable:!1}),ti&&Da(qt,null,_i,"beforeMount");const Oi=(!hi||hi&&!hi.pendingBranch)&&xn&&!xn.persisted;Oi&&xn.beforeEnter(Li),L(Li,cn,$n),((vi=Tt&&Tt.onVnodeMounted)||Oi||ti)&&Oa(()=>{vi&&Kl(vi,_i,qt),Oi&&xn.enter(Li),ti&&Da(qt,null,_i,"mounted")},hi)},Ct=(qt,cn,$n,_i,hi)=>{if($n&&Vt(qt,$n),_i)for(let Di=0;Di<_i.length;Di++)Vt(qt,_i[Di]);if(hi){let Di=hi.subTree;if(Di.patchFlag>0&&Di.patchFlag&2048&&(Di=Uo(Di.children)||Di),cn===Di){const qi=hi.vnode;Ct(qt,qi,qi.scopeId,qi.slotScopeIds,hi.parent)}}},Dt=(qt,cn,$n,_i,hi,Di,qi,wi,Li=0)=>{for(let vi=Li;vi<qt.length;vi++){const mr=qt[vi]=wi?th(qt[vi]):ul(qt[vi]);Yt(null,mr,cn,$n,_i,hi,Di,qi,wi)}},hn=(qt,cn,$n,_i,hi,Di,qi)=>{const wi=cn.el=qt.el;let{patchFlag:Li,dynamicChildren:vi,dirs:mr}=cn;Li|=qt.patchFlag&16;const Tt=qt.props||he,fn=cn.props||he;let xn;$n&&Yl($n,!1),(xn=fn.onVnodeBeforeUpdate)&&Kl(xn,$n,cn,qt),mr&&Da(cn,qt,$n,"beforeUpdate"),$n&&Yl($n,!0),ko&&(Li=0,qi=!1,vi=null);const Dn=hi&&cn.type!=="foreignObject";if(vi?(Kt(qt.dynamicChildren,vi,wi,$n,_i,Dn,Di),$n&&$n.type.__hmrId&&af(qt,cn)):qi||sr(qt,cn,wi,null,$n,_i,Dn,Di,!1),Li>0){if(Li&16)yn(wi,cn,Tt,fn,$n,_i,hi);else if(Li&2&&Tt.class!==fn.class&&ne(wi,"class",null,fn.class,hi),Li&4&&ne(wi,"style",Tt.style,fn.style,hi),Li&8){const ti=cn.dynamicProps;for(let Oi=0;Oi<ti.length;Oi++){const hr=ti[Oi],gr=Tt[hr],es=fn[hr];(es!==gr||hr==="value")&&ne(wi,hr,gr,es,hi,qt.children,$n,_i,xl)}}Li&1&&qt.children!==cn.children&&st(wi,cn.children)}else!qi&&vi==null&&yn(wi,cn,Tt,fn,$n,_i,hi);((xn=fn.onVnodeUpdated)||mr)&&Oa(()=>{xn&&Kl(xn,$n,cn,qt),mr&&Da(cn,qt,$n,"updated")},_i)},Kt=(qt,cn,$n,_i,hi,Di,qi)=>{for(let wi=0;wi<cn.length;wi++){const Li=qt[wi],vi=cn[wi],mr=Li.el&&(Li.type===Vo||!to(Li,vi)||Li.shapeFlag&70)?nt(Li.el):$n;Yt(Li,vi,mr,null,_i,hi,Di,qi,!0)}},yn=(qt,cn,$n,_i,hi,Di,qi)=>{if($n!==_i){for(const wi in _i){if(Pn(wi))continue;const Li=_i[wi],vi=$n[wi];Li!==vi&&wi!=="value"&&ne(qt,wi,vi,Li,qi,cn.children,hi,Di,xl)}if($n!==he)for(const wi in $n)!Pn(wi)&&!(wi in _i)&&ne(qt,wi,$n[wi],null,qi,cn.children,hi,Di,xl);"value"in _i&&ne(qt,"value",$n.value,_i.value)}},ii=(qt,cn,$n,_i,hi,Di,qi,wi,Li)=>{const vi=cn.el=qt?qt.el:Me(""),mr=cn.anchor=qt?qt.anchor:Me("");let{patchFlag:Tt,dynamicChildren:fn,slotScopeIds:xn}=cn;ko&&(Tt=0,Li=!1,fn=null),xn&&(wi=wi?wi.concat(xn):xn),qt==null?(L(vi,$n,_i),L(mr,$n,_i),Dt(cn.children,$n,mr,hi,Di,qi,wi,Li)):Tt>0&&Tt&64&&fn&&qt.dynamicChildren?(Kt(qt.dynamicChildren,fn,$n,hi,Di,qi,wi),hi&&hi.type.__hmrId?af(qt,cn):(cn.key!=null||hi&&cn===hi.subTree)&&af(qt,cn,!0)):sr(qt,cn,$n,mr,hi,Di,qi,wi,Li)},Ui=(qt,cn,$n,_i,hi,Di,qi,wi,Li)=>{cn.slotScopeIds=wi,qt==null?cn.shapeFlag&512?hi.ctx.activate(cn,$n,_i,qi,Li):Bi(cn,$n,_i,hi,Di,qi,Li):ci(qt,cn,Li)},Bi=(qt,cn,$n,_i,hi,Di,qi)=>{const wi=qt.component=iA(qt,_i,hi);if(wi.type.__hmrId&&Pl(wi),qs(qt),So(wi,"mount"),zo(qt)&&(wi.ctx.renderer=Zh),So(wi,"init"),sA(wi),$c(wi,"init"),wi.asyncDep){if(hi&&hi.registerDep(wi,Ii),!qt.el){const Li=wi.subTree=go(Xs);et(null,Li,cn,$n)}return}Ii(wi,qt,cn,$n,hi,Di,qi),tp(),$c(wi,"mount")},ci=(qt,cn,$n)=>{const _i=cn.component=qt.component;if(Zp(qt,cn,$n))if(_i.asyncDep&&!_i.asyncResolved){qs(cn),$i(_i,cn,$n),tp();return}else _i.next=cn,$p(_i.update),_i.update();else cn.component=qt.component,cn.el=qt.el,_i.vnode=cn},Ii=(qt,cn,$n,_i,hi,Di,qi)=>{const wi=()=>{if(qt.isMounted){let{next:mr,bu:Tt,u:fn,parent:xn,vnode:Dn}=qt,ti=mr,Oi;qs(mr||qt.vnode),Yl(qt,!1),mr?(mr.el=Dn.el,$i(qt,mr,qi)):mr=Dn,Tt&&We(Tt),(Oi=mr.props&&mr.props.onVnodeBeforeUpdate)&&Kl(Oi,xn,mr,Dn),Yl(qt,!0),So(qt,"render");const hr=Hs(qt);$c(qt,"render");const gr=qt.subTree;qt.subTree=hr,So(qt,"patch"),Yt(gr,hr,nt(gr.el),Vd(gr),qt,hi,Di),$c(qt,"patch"),mr.el=hr.el,ti===null&&Th(qt,hr.el),fn&&Oa(fn,hi),(Oi=mr.props&&mr.props.onVnodeUpdated)&&Oa(()=>Kl(Oi,xn,mr,Dn),hi),Eh(qt),tp()}else{let mr;const{el:Tt,props:fn}=cn,{bm:xn,m:Dn,parent:ti}=qt,Oi=Ia(cn);if(Yl(qt,!1),xn&&We(xn),!Oi&&(mr=fn&&fn.onVnodeBeforeMount)&&Kl(mr,ti,cn),Yl(qt,!0),Tt&&D_){const hr=()=>{So(qt,"render"),qt.subTree=Hs(qt),$c(qt,"render"),So(qt,"hydrate"),D_(Tt,qt.subTree,qt,hi,null),$c(qt,"hydrate")};Oi?cn.type.__asyncLoader().then(()=>!qt.isUnmounted&&hr()):hr()}else{So(qt,"render");const hr=qt.subTree=Hs(qt);$c(qt,"render"),So(qt,"patch"),Yt(null,hr,$n,_i,qt,hi,Di),$c(qt,"patch"),cn.el=hr.el}if(Dn&&Oa(Dn,hi),!Oi&&(mr=fn&&fn.onVnodeMounted)){const hr=cn;Oa(()=>Kl(mr,ti,hr),hi)}cn.shapeFlag&256&&qt.a&&Oa(qt.a,hi),qt.isMounted=!0,wh(qt),cn=$n=_i=null}},Li=qt.effect=new uo(wi,()=>Wa(qt.update),qt.scope),vi=qt.update=Li.run.bind(Li);vi.id=qt.uid,Yl(qt,!0),Li.onTrack=qt.rtc?mr=>We(qt.rtc,mr):void 0,Li.onTrigger=qt.rtg?mr=>We(qt.rtg,mr):void 0,vi.ownerInstance=qt,vi()},$i=(qt,cn,$n)=>{cn.component=qt;const _i=qt.vnode.props;qt.vnode=cn,qt.next=null,up(qt,cn.props,_i,$n),lv(qt,cn.children,$n),ja(),Us(void 0,qt.update),Lo()},sr=(qt,cn,$n,_i,hi,Di,qi,wi,Li=!1)=>{const vi=qt&&qt.children,mr=qt?qt.shapeFlag:0,Tt=cn.children,{patchFlag:fn,shapeFlag:xn}=cn;if(fn>0){if(fn&128){yo(vi,Tt,$n,_i,hi,Di,qi,wi,Li);return}else if(fn&256){xs(vi,Tt,$n,_i,hi,Di,qi,wi,Li);return}}xn&8?(mr&16&&xl(vi,hi,Di),Tt!==vi&&st($n,Tt)):mr&16?xn&16?yo(vi,Tt,$n,_i,hi,Di,qi,wi,Li):xl(vi,hi,Di,!0):(mr&8&&st($n,""),xn&16&&Dt(Tt,$n,_i,hi,Di,qi,wi,Li))},xs=(qt,cn,$n,_i,hi,Di,qi,wi,Li)=>{qt=qt||we,cn=cn||we;const vi=qt.length,mr=cn.length,Tt=Math.min(vi,mr);let fn;for(fn=0;fn<Tt;fn++){const xn=cn[fn]=Li?th(cn[fn]):ul(cn[fn]);Yt(qt[fn],xn,$n,null,hi,Di,qi,wi,Li)}vi>mr?xl(qt,hi,Di,!0,!1,Tt):Dt(cn,$n,_i,hi,Di,qi,wi,Li,Tt)},yo=(qt,cn,$n,_i,hi,Di,qi,wi,Li)=>{let vi=0;const mr=cn.length;let Tt=qt.length-1,fn=mr-1;for(;vi<=Tt&&vi<=fn;){const xn=qt[vi],Dn=cn[vi]=Li?th(cn[vi]):ul(cn[vi]);if(to(xn,Dn))Yt(xn,Dn,$n,null,hi,Di,qi,wi,Li);else break;vi++}for(;vi<=Tt&&vi<=fn;){const xn=qt[Tt],Dn=cn[fn]=Li?th(cn[fn]):ul(cn[fn]);if(to(xn,Dn))Yt(xn,Dn,$n,null,hi,Di,qi,wi,Li);else break;Tt--,fn--}if(vi>Tt){if(vi<=fn){const xn=fn+1,Dn=xn<mr?cn[xn].el:_i;for(;vi<=fn;)Yt(null,cn[vi]=Li?th(cn[vi]):ul(cn[vi]),$n,Dn,hi,Di,qi,wi,Li),vi++}}else if(vi>fn)for(;vi<=Tt;)ds(qt[vi],hi,Di,!0),vi++;else{const xn=vi,Dn=vi,ti=new Map;for(vi=Dn;vi<=fn;vi++){const js=cn[vi]=Li?th(cn[vi]):ul(cn[vi]);js.key!=null&&(ti.has(js.key)&&ei("Duplicate keys found during update:",JSON.stringify(js.key),"Make sure keys are unique."),ti.set(js.key,vi))}let Oi,hr=0;const gr=fn-Dn+1;let es=!1,Bs=0;const as=new Array(gr);for(vi=0;vi<gr;vi++)as[vi]=0;for(vi=xn;vi<=Tt;vi++){const js=qt[vi];if(hr>=gr){ds(js,hi,Di,!0);continue}let co;if(js.key!=null)co=ti.get(js.key);else for(Oi=Dn;Oi<=fn;Oi++)if(as[Oi-Dn]===0&&to(js,cn[Oi])){co=Oi;break}co===void 0?ds(js,hi,Di,!0):(as[co-Dn]=vi+1,co>=Bs?Bs=co:es=!0,Yt(js,cn[co],$n,null,hi,Di,qi,wi,Li),hr++)}const vs=es?$u(as):we;for(Oi=vs.length-1,vi=gr-1;vi>=0;vi--){const js=Dn+vi,co=cn[js],ea=js+1<mr?cn[js+1].el:_i;as[vi]===0?Yt(null,co,$n,ea,hi,Di,qi,wi,Li):es&&(Oi<0||vi!==vs[Oi]?Pr(co,$n,ea,2):Oi--)}}},Pr=(qt,cn,$n,_i,hi=null)=>{const{el:Di,type:qi,transition:wi,children:Li,shapeFlag:vi}=qt;if(vi&6){Pr(qt.component.subTree,cn,$n,_i);return}if(vi&128){qt.suspense.move(cn,$n,_i);return}if(vi&64){qi.move(qt,cn,$n,Zh);return}if(qi===Vo){L(Di,cn,$n);for(let Tt=0;Tt<Li.length;Tt++)Pr(Li[Tt],cn,$n,_i);L(qt.anchor,cn,$n);return}if(qi===Ba){Ut(qt,cn,$n);return}if(_i!==2&&vi&1&&wi)if(_i===0)wi.beforeEnter(Di),L(Di,cn,$n),Oa(()=>wi.enter(Di),hi);else{const{leave:Tt,delayLeave:fn,afterLeave:xn}=wi,Dn=()=>L(Di,cn,$n),ti=()=>{Tt(Di,()=>{Dn(),xn&&xn()})};fn?fn(Di,Dn,ti):ti()}else L(Di,cn,$n)},ds=(qt,cn,$n,_i=!1,hi=!1)=>{const{type:Di,props:qi,ref:wi,children:Li,dynamicChildren:vi,shapeFlag:mr,patchFlag:Tt,dirs:fn}=qt;if(wi!=null&&dp(wi,null,$n,qt,!0),mr&256){cn.ctx.deactivate(qt);return}const xn=mr&1&&fn,Dn=!Ia(qt);let ti;if(Dn&&(ti=qi&&qi.onVnodeBeforeUnmount)&&Kl(ti,cn,qt),mr&6)Jn(qt.component,$n,_i);else{if(mr&128){qt.suspense.unmount($n,_i);return}xn&&Da(qt,null,cn,"beforeUnmount"),mr&64?qt.type.remove(qt,cn,$n,hi,Zh,_i):vi&&(Di!==Vo||Tt>0&&Tt&64)?xl(vi,cn,$n,!1,!0):(Di===Vo&&Tt&384||!hi&&mr&16)&&xl(Li,cn,$n),_i&&Ss(qt)}(Dn&&(ti=qi&&qi.onVnodeUnmounted)||xn)&&Oa(()=>{ti&&Kl(ti,cn,qt),xn&&Da(qt,null,cn,"unmounted")},$n)},Ss=qt=>{const{type:cn,el:$n,anchor:_i,transition:hi}=qt;if(cn===Vo){lu($n,_i);return}if(cn===Ba){yt(qt);return}const Di=()=>{Y($n),hi&&!hi.persisted&&hi.afterLeave&&hi.afterLeave()};if(qt.shapeFlag&1&&hi&&!hi.persisted){const{leave:qi,delayLeave:wi}=hi,Li=()=>qi($n,Di);wi?wi(qt.el,Di,Li):Li()}else Di()},lu=(qt,cn)=>{let $n;for(;qt!==cn;)$n=ot(qt),Y(qt),qt=$n;Y(cn)},Jn=(qt,cn,$n)=>{qt.type.__hmrId&&zt(qt);const{bum:_i,scope:hi,update:Di,subTree:qi,um:wi}=qt;_i&&We(_i),hi.stop(),Di&&(Di.active=!1,ds(qi,qt,cn,$n)),wi&&Oa(wi,cn),Oa(()=>{qt.isUnmounted=!0},cn),cn&&cn.pendingBranch&&!cn.isUnmounted&&qt.asyncDep&&!qt.asyncResolved&&qt.suspenseId===cn.pendingId&&(cn.deps--,cn.deps===0&&cn.resolve()),Jf(qt)},xl=(qt,cn,$n,_i=!1,hi=!1,Di=0)=>{for(let qi=Di;qi<qt.length;qi++)ds(qt[qi],cn,$n,_i,hi)},Vd=qt=>qt.shapeFlag&6?Vd(qt.component.subTree):qt.shapeFlag&128?qt.suspense.next():ot(qt.anchor||qt.el),wl=(qt,cn,$n)=>{qt==null?cn._vnode&&ds(cn._vnode,null,null,!0):Yt(cn._vnode||null,qt,cn,null,null,null,$n),Vr(),cn._vnode=qt},Zh={p:Yt,um:ds,m:Pr,r:Ss,mt:Bi,mc:Dt,pc:sr,pbc:Kt,n:Vd,o:g};let zp,D_;return b&&([zp,D_]=b(Zh)),{render:wl,hydrate:zp,createApp:Ol(wl,zp)}}function Yl({effect:g,update:b},D){g.allowRecurse=b.allowRecurse=D}function af(g,b,D=!1){const L=g.children,Y=b.children;if(Nt(L)&&Nt(Y))for(let ne=0;ne<L.length;ne++){const be=L[ne];let Me=Y[ne];Me.shapeFlag&1&&!Me.dynamicChildren&&((Me.patchFlag<=0||Me.patchFlag===32)&&(Me=Y[ne]=th(Y[ne]),Me.el=be.el),D||af(be,Me)),Me.type===Xs&&!Me.el&&(Me.el=be.el)}}function $u(g){const b=g.slice(),D=[0];let L,Y,ne,be,Me;const De=g.length;for(L=0;L<De;L++){const je=g[L];if(je!==0){if(Y=D[D.length-1],g[Y]<je){b[L]=Y,D.push(L);continue}for(ne=0,be=D.length-1;ne<be;)Me=ne+be>>1,g[D[Me]]<je?ne=Me+1:be=Me;je<g[D[ne]]&&(ne>0&&(b[L]=D[ne-1]),D[ne]=L)}}for(ne=D.length,be=D[ne-1];ne-- >0;)D[ne]=be,be=b[be];return D}const Sd=g=>g.__isTeleport,Dh=g=>g&&(g.disabled||g.disabled===""),Zc=g=>typeof SVGElement<"u"&&g instanceof SVGElement,pp=(g,b)=>{const D=g&&g.to;if(sn(D))if(b){const L=b(D);return L||ei(`Failed to locate Teleport target with selector "${D}". Note the target element must exist before the component is mounted - i.e. the target cannot be rendered by the component itself, and ideally should be outside of the entire Vue component tree.`),L}else return ei("Current renderer does not support string target for Teleports. (missing querySelector renderer option)"),null;else return!D&&!Dh(g)&&ei(`Invalid Teleport target: ${D}`),D},uv={__isTeleport:!0,process(g,b,D,L,Y,ne,be,Me,De,je){const{mc:st,pc:nt,pbc:ot,o:{insert:Vt,querySelector:Jt,createText:en,createComment:Yt}}=je,ln=Dh(b.props);let{shapeFlag:et,children:$e,dynamicChildren:Gt}=b;if(ko&&(De=!1,Gt=null),g==null){const Ut=b.el=Yt("teleport start"),yt=b.anchor=Yt("teleport end");Vt(Ut,D,L),Vt(yt,D,L);const wt=b.target=pp(b.props,Jt),qe=b.targetAnchor=en("");wt?(Vt(qe,wt),be=be||Zc(wt)):ln||ei("Invalid Teleport target on mount:",wt,`(${typeof wt})`);const Ct=(Dt,hn)=>{et&16&&st($e,Dt,hn,Y,ne,be,Me,De)};ln?Ct(D,yt):wt&&Ct(wt,qe)}else{b.el=g.el;const Ut=b.anchor=g.anchor,yt=b.target=g.target,wt=b.targetAnchor=g.targetAnchor,qe=Dh(g.props),Ct=qe?D:yt,Dt=qe?Ut:wt;if(be=be||Zc(yt),Gt?(ot(g.dynamicChildren,Gt,Ct,Y,ne,be,Me),af(g,b,!0)):De||nt(g,b,Ct,Dt,Y,ne,be,Me,!1),ln)qe||im(b,D,Ut,je,1);else if((b.props&&b.props.to)!==(g.props&&g.props.to)){const hn=b.target=pp(b.props,Jt);hn?im(b,hn,null,je,0):ei("Invalid Teleport target on update:",yt,`(${typeof yt})`)}else qe&&im(b,yt,wt,je,1)}},remove(g,b,D,L,{um:Y,o:{remove:ne}},be){const{shapeFlag:Me,children:De,anchor:je,targetAnchor:st,target:nt,props:ot}=g;if(nt&&ne(st),(be||!Dh(ot))&&(ne(je),Me&16))for(let Vt=0;Vt<De.length;Vt++){const Jt=De[Vt];Y(Jt,b,D,!0,!!Jt.dynamicChildren)}},move:im,hydrate:rm};function im(g,b,D,{o:{insert:L},m:Y},ne=2){ne===0&&L(g.targetAnchor,b,D);const{el:be,anchor:Me,shapeFlag:De,children:je,props:st}=g,nt=ne===2;if(nt&&L(be,b,D),(!nt||Dh(st))&&De&16)for(let ot=0;ot<je.length;ot++)Y(je[ot],b,D,2);nt&&L(Me,b,D)}function rm(g,b,D,L,Y,ne,{o:{nextSibling:be,parentNode:Me,querySelector:De}},je){const st=b.target=pp(b.props,De);if(st){const nt=st._lpa||st.firstChild;b.shapeFlag&16&&(Dh(b.props)?(b.anchor=je(be(g),b,Me(g),D,L,Y,ne),b.targetAnchor=nt):(b.anchor=be(g),b.targetAnchor=je(nt,b,st,D,L,Y,ne)),st._lpa=b.targetAnchor&&be(b.targetAnchor))}return b.anchor&&be(b.anchor)}const Og=uv,fp="components",eA="directives";function hv(g,b){return Bg(fp,g,!0,b)||g}const eu=Symbol();function Ju(g){return sn(g)?Bg(fp,g,!1)||g:g||eu}function sm(g){return Bg(eA,g)}function Bg(g,b,D=!0,L=!1){const Y=Zs||$o;if(Y){const ne=Y.type;if(g===fp){const Me=kh(ne);if(Me&&(Me===b||Me===In(b)||Me===fe(In(b))))return ne}const be=Lg(Y[g]||ne[g],b)||Lg(Y.appContext[g],b);if(!be&&L)return ne;if(D&&!be){const Me=g===fp?`
If this is a native custom element, make sure to exclude it from component resolution via compilerOptions.isCustomElement.`:"";ei(`Failed to resolve ${g.slice(0,-1)}: ${b}${Me}`)}return be}else ei(`resolve${fe(g.slice(0,-1))} can only be used in render() or setup().`)}function Lg(g,b){return g&&(g[b]||g[In(b)]||g[fe(In(b))])}const Vo=Symbol("Fragment"),wc=Symbol("Text"),Xs=Symbol("Comment"),Ba=Symbol("Static"),lf=[];let Go=null;function Oh(g=!1){lf.push(Go=g?null:[])}function fo(){lf.pop(),Go=lf[lf.length-1]||null}let mo=1;function om(g){mo+=g}function Md(g){return g.dynamicChildren=mo>0?Go||we:null,fo(),mo>0&&Go&&Go.push(g),g}function I0(g,b,D,L,Y,ne){return Md(D0(g,b,D,L,Y,ne,!0))}function dv(g,b,D,L,Y){return Md(go(g,b,D,L,Y,!0))}function Bh(g){return g?g.__v_isVNode===!0:!1}function to(g,b){return b.shapeFlag&6&&rp.has(b.type)?!1:g.type===b.type&&g.key===b.key}let Zu;function P0(g){Zu=g}const mp=(...g)=>kg(...Zu?Zu(g,Zs):g),Ng="__vInternal",Ec=({key:g})=>g??null,am=({ref:g,ref_key:b,ref_for:D})=>g!=null?sn(g)||ao(g)||bt(g)?{i:Zs,r:g,k:b,f:!!D}:g:null;function D0(g,b=null,D=null,L=0,Y=null,ne=g===Vo?0:1,be=!1,Me=!1){const De={__v_isVNode:!0,__v_skip:!0,type:g,props:b,key:b&&Ec(b),ref:b&&am(b),scopeId:_c,slotScopeIds:null,children:D,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:ne,patchFlag:L,dynamicProps:Y,dynamicChildren:null,appContext:null};return Me?(gp(De,D),ne&128&&g.normalize(De)):D&&(De.shapeFlag|=sn(D)?8:16),De.key!==De.key&&ei("VNode created with invalid key (NaN). VNode type:",De.type),mo>0&&!be&&Go&&(De.patchFlag>0||ne&6)&&De.patchFlag!==32&&Go.push(De),De}const go=mp;function kg(g,b=null,D=null,L=0,Y=null,ne=!1){if((!g||g===eu)&&(g||ei(`Invalid vnode type when creating vnode: ${g}.`),g=Xs),Bh(g)){const Me=eh(g,b,!0);return D&&gp(Me,D),Me}if(dm(g)&&(g=g.__vccOpts),b){b=O0(b);let{class:Me,style:De}=b;Me&&!sn(Me)&&(b.class=ve(Me)),Un(De)&&(Ts(De)&&!Nt(De)&&(De=_t({},De)),b.style=Z(De))}const be=sn(g)?1:em(g)?128:Sd(g)?64:Un(g)?4:bt(g)?2:0;return be&4&&Ts(g)&&(g=Nr(g),ei("Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`.",`
Component that was made reactive: `,g)),D0(g,b,D,L,Y,be,ne,!0)}function O0(g){return g?Ts(g)||Ng in g?_t({},g):g:null}function eh(g,b,D=!1){const{props:L,ref:Y,patchFlag:ne,children:be}=g,Me=b?lm(L||{},b):L;return{__v_isVNode:!0,__v_skip:!0,type:g.type,props:Me,key:Me&&Ec(Me),ref:b&&b.ref?D&&Y?Nt(Y)?Y.concat(am(b)):[Y,am(b)]:am(b):Y,scopeId:g.scopeId,slotScopeIds:g.slotScopeIds,children:ne===-1&&Nt(be)?be.map(B0):be,target:g.target,targetAnchor:g.targetAnchor,staticCount:g.staticCount,shapeFlag:g.shapeFlag,patchFlag:b&&g.type!==Vo?ne===-1?16:ne|16:ne,dynamicProps:g.dynamicProps,dynamicChildren:g.dynamicChildren,appContext:g.appContext,dirs:g.dirs,transition:g.transition,component:g.component,suspense:g.suspense,ssContent:g.ssContent&&eh(g.ssContent),ssFallback:g.ssFallback&&eh(g.ssFallback),el:g.el,anchor:g.anchor}}function B0(g){const b=eh(g);return Nt(g.children)&&(b.children=g.children.map(B0)),b}function cf(g=" ",b=0){return go(wc,null,g,b)}function tA(g,b){const D=go(Ba,null,g);return D.staticCount=b,D}function uf(g="",b=!1){return b?(Oh(),dv(Xs,null,g)):go(Xs,null,g)}function ul(g){return g==null||typeof g=="boolean"?go(Xs):Nt(g)?go(Vo,null,g.slice()):typeof g=="object"?th(g):go(wc,null,String(g))}function th(g){return g.el===null||g.memo?g:eh(g)}function gp(g,b){let D=0;const{shapeFlag:L}=g;if(b==null)b=null;else if(Nt(b))D=16;else if(typeof b=="object")if(L&65){const Y=b.default;Y&&(Y._c&&(Y._d=!1),gp(g,Y()),Y._c&&(Y._d=!0));return}else{D=32;const Y=b._;!Y&&!(Ng in b)?b._ctx=Zs:Y===3&&Zs&&(Zs.slots._===1?b._=1:(b._=2,g.patchFlag|=1024))}else bt(b)?(b={default:b,_ctx:Zs},D=32):(b=String(b),L&64?(D=16,b=[cf(b)]):D=8);g.children=b,g.shapeFlag|=D}function lm(...g){const b={};for(let D=0;D<g.length;D++){const L=g[D];for(const Y in L)if(Y==="class")b.class!==L.class&&(b.class=ve([b.class,L.class]));else if(Y==="style")b.style=Z([b.style,L.style]);else if(Ye(Y)){const ne=b[Y],be=L[Y];be&&ne!==be&&!(Nt(ne)&&ne.includes(be))&&(b[Y]=ne?[].concat(ne,be):be)}else Y!==""&&(b[Y]=L[Y])}return b}function Kl(g,b,D,L=null){qo(g,b,7,[D,L])}function nA(g,b,D,L){let Y;const ne=D&&D[L];if(Nt(g)||sn(g)){Y=new Array(g.length);for(let be=0,Me=g.length;be<Me;be++)Y[be]=b(g[be],be,void 0,ne&&ne[be])}else if(typeof g=="number"){if(!Number.isInteger(g))return ei(`The v-for range expect an integer value but got ${g}.`),[];Y=new Array(g);for(let be=0;be<g;be++)Y[be]=b(be+1,be,void 0,ne&&ne[be])}else if(Un(g))if(g[Symbol.iterator])Y=Array.from(g,(be,Me)=>b(be,Me,void 0,ne&&ne[Me]));else{const be=Object.keys(g);Y=new Array(be.length);for(let Me=0,De=be.length;Me<De;Me++){const je=be[Me];Y[Me]=b(g[je],je,Me,ne&&ne[Me])}}else Y=[];return D&&(D[L]=Y),Y}function pv(g,b){for(let D=0;D<b.length;D++){const L=b[D];if(Nt(L))for(let Y=0;Y<L.length;Y++)g[L[Y].name]=L[Y].fn;else L&&(g[L.name]=L.fn)}return g}function Ug(g,b,D={},L,Y){if(Zs.isCE)return go("slot",b==="default"?null:{name:b},L&&L());let ne=g[b];ne&&ne.length>1&&(ei("SSR-optimized slot function detected in a non-SSR-optimized render function. You need to mark this component with $dynamic-slots in the parent template."),ne=()=>[]),ne&&ne._c&&(ne._d=!1),Oh();const be=ne&&L0(ne(D)),Me=dv(Vo,{key:D.key||`_${b}`},be||(L?L():[]),be&&g._===1?64:-2);return!Y&&Me.scopeId&&(Me.slotScopeIds=[Me.scopeId+"-s"]),ne&&ne._c&&(ne._d=!0),Me}function L0(g){return g.some(b=>Bh(b)?!(b.type===Xs||b.type===Vo&&!L0(b.children)):!0)?g:null}function Fg(g){const b={};if(!Un(g))return ei("v-on with no argument expects an object value."),b;for(const D in g)b[Se(D)]=g[D];return b}const fv=g=>g?rA(g)?vv(g)||g.proxy:fv(g.parent):null,hf=_t(Object.create(null),{$:g=>g,$el:g=>g.vnode.el,$data:g=>g.data,$props:g=>fu(g.props),$attrs:g=>fu(g.attrs),$slots:g=>fu(g.slots),$refs:g=>fu(g.refs),$parent:g=>fv(g.parent),$root:g=>fv(g.root),$emit:g=>g.emit,$options:g=>zi(g),$forceUpdate:g=>()=>Wa(g.update),$nextTick:g=>Kp.bind(g.proxy),$watch:g=>gd.bind(g)}),cm={get({_:g},b){const{ctx:D,setupState:L,data:Y,props:ne,accessCache:be,type:Me,appContext:De}=g;if(b==="__isVue")return!0;if(L!==he&&L.__isScriptSetup&&ut(L,b))return L[b];let je;if(b[0]!=="$"){const Vt=be[b];if(Vt!==void 0)switch(Vt){case 1:return L[b];case 2:return Y[b];case 4:return D[b];case 3:return ne[b]}else{if(L!==he&&ut(L,b))return be[b]=1,L[b];if(Y!==he&&ut(Y,b))return be[b]=2,Y[b];if((je=g.propsOptions[0])&&ut(je,b))return be[b]=3,ne[b];if(D!==he&&ut(D,b))return be[b]=4,D[b];Fe&&(be[b]=0)}}const st=hf[b];let nt,ot;if(st)return b==="$attrs"&&(Pt(g,"get",b),ya()),st(g);if((nt=Me.__cssModules)&&(nt=nt[b]))return nt;if(D!==he&&ut(D,b))return be[b]=4,D[b];if(ot=De.config.globalProperties,ut(ot,b))return ot[b];Zs&&(!sn(b)||b.indexOf("__v")!==0)&&(Y!==he&&(b[0]==="$"||b[0]==="_")&&ut(Y,b)?ei(`Property ${JSON.stringify(b)} must be accessed via $data because it starts with a reserved character ("$" or "_") and is not proxied on the render context.`):g===Zs&&ei(`Property ${JSON.stringify(b)} was accessed during render but is not defined on instance.`))},set({_:g},b,D){const{data:L,setupState:Y,ctx:ne}=g;if(Y!==he&&ut(Y,b))Y[b]=D;else if(L!==he&&ut(L,b))L[b]=D;else if(ut(g.props,b))return ei(`Attempting to mutate prop "${b}". Props are readonly.`,g),!1;return b[0]==="$"&&b.slice(1)in g?(ei(`Attempting to mutate public property "${b}". Properties starting with $ are reserved and readonly.`,g),!1):(b in g.appContext.config.globalProperties?Object.defineProperty(ne,b,{enumerable:!0,configurable:!0,value:D}):ne[b]=D,!0)},has({_:{data:g,setupState:b,accessCache:D,ctx:L,appContext:Y,propsOptions:ne}},be){let Me;return!!D[be]||g!==he&&ut(g,be)||b!==he&&ut(b,be)||(Me=ne[0])&&ut(Me,be)||ut(L,be)||ut(hf,be)||ut(Y.config.globalProperties,be)}};cm.ownKeys=g=>(ei("Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead."),Reflect.ownKeys(g));const N0=_t({},cm,{get(g,b){if(b!==Symbol.unscopables)return cm.get(g,b,g)},has(g,b){const D=b[0]!=="_"&&!M(b);return!D&&cm.has(g,b)&&ei(`Property ${JSON.stringify(b)} should not start with _ which is a reserved prefix for Vue internals.`),D}});function k0(g){const b={};return Object.defineProperty(b,"_",{configurable:!0,enumerable:!1,get:()=>g}),Object.keys(hf).forEach(D=>{Object.defineProperty(b,D,{configurable:!0,enumerable:!1,get:()=>hf[D](g),set:Ce})}),b}function df(g){const{ctx:b,propsOptions:[D]}=g;D&&Object.keys(D).forEach(L=>{Object.defineProperty(b,L,{enumerable:!0,configurable:!0,get:()=>g.props[L],set:Ce})})}function Sc(g){const{ctx:b,setupState:D}=g;Object.keys(Nr(D)).forEach(L=>{if(!D.__isScriptSetup){if(L[0]==="$"||L[0]==="_"){ei(`setup() return property ${JSON.stringify(L)} should not start with "$" or "_" which are reserved prefixes for Vue internals.`);return}Object.defineProperty(b,L,{enumerable:!0,configurable:!0,get:()=>D[L],set:Ce})}})}const _p=os();let Mo=0;function iA(g,b,D){const L=g.type,Y=(b?b.appContext:g.appContext)||_p,ne={uid:Mo++,vnode:g,type:L,parent:b,appContext:Y,root:null,next:null,subTree:null,effect:null,update:null,scope:new Qn(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:b?b.provides:Object.create(Y.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ko(L,Y),emitsOptions:al(L,Y),emit:null,emitted:null,propsDefaults:he,inheritAttrs:L.inheritAttrs,ctx:he,data:he,props:he,attrs:he,slots:he,refs:he,setupState:he,setupContext:null,suspense:D,suspenseId:D?D.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return ne.ctx=k0(ne),ne.root=b?b.root:ne,ne.emit=la.bind(null,ne),g.ce&&g.ce(ne),ne}let $o=null;const Lh=()=>$o||Zs,Nh=g=>{$o=g,g.scope.on()},Td=()=>{$o&&$o.scope.off(),$o=null},mv=a("slot,component");function gv(g,b){const D=b.isNativeTag||Ne;(mv(g)||D(g))&&ei("Do not use built-in or reserved HTML elements as component id: "+g)}function rA(g){return g.vnode.shapeFlag&4}let zg=!1;function sA(g,b=!1){zg=b;const{props:D,children:L}=g.vnode,Y=rA(g);yd(g,D,Y,b),hp(g,L);const ne=Y?Eb(g,b):void 0;return zg=!1,ne}function Eb(g,b){const D=g.type;{if(D.name&&gv(D.name,g.appContext.config),D.components){const Y=Object.keys(D.components);for(let ne=0;ne<Y.length;ne++)gv(Y[ne],g.appContext.config)}if(D.directives){const Y=Object.keys(D.directives);for(let ne=0;ne<Y.length;ne++)R0(Y[ne])}D.compilerOptions&&Vg()&&ei('"compilerOptions" is only supported when using a build of Vue that includes the runtime compiler. Since you are using a runtime-only build, the options should be passed via your build tool config instead.')}g.accessCache=Object.create(null),g.proxy=Ga(new Proxy(g.ctx,cm)),df(g);const{setup:L}=D;if(L){const Y=g.setupContext=L.length>1?nh(g):null;Nh(g),ja();const ne=kr(L,g,0,[fu(g.props),Y]);if(Lo(),Td(),pi(ne)){if(ne.then(Td,Td),b)return ne.then(be=>{jg(g,be,b)}).catch(be=>{aa(be,g,0)});g.asyncDep=ne}else jg(g,ne,b)}else Gg(g,b)}function jg(g,b,D){bt(b)?g.render=b:Un(b)?(Bh(b)&&ei("setup() should not return VNodes directly - return a render function instead."),g.devtoolsRawSetupState=b,g.setupState=fs(b),Sc(g)):b!==void 0&&ei(`setup() should return an object. Received: ${b===null?"null":typeof b}`),Gg(g,D)}let vp,Ps;function _v(g){vp=g,Ps=b=>{b.render._rc&&(b.withProxy=new Proxy(b.ctx,N0))}}const Vg=()=>!vp;function Gg(g,b,D){const L=g.type;if(!g.render){if(!b&&vp&&!L.render){const Y=L.template;if(Y){So(g,"compile");const{isCustomElement:ne,compilerOptions:be}=g.appContext.config,{delimiters:Me,compilerOptions:De}=L,je=_t(_t({isCustomElement:ne,delimiters:Me},be),De);L.render=vp(Y,je),$c(g,"compile")}}g.render=L.render||Ce,Ps&&Ps(g)}Nh(g),ja(),Mt(g),Lo(),Td(),!L.render&&g.render===Ce&&!b&&(!vp&&L.template?ei('Component provided template option but runtime compilation is not supported in this build of Vue. Use "vue.global.js" instead.'):ei("Component is missing template or render function."))}function um(g){return new Proxy(g.attrs,{get(b,D){return ya(),Pt(g,"get","$attrs"),b[D]},set(){return ei("setupContext.attrs is readonly."),!1},deleteProperty(){return ei("setupContext.attrs is readonly."),!1}})}function nh(g){const b=L=>{g.exposed&&ei("expose() should be called only once per setup()."),g.exposed=L||{}};let D;return Object.freeze({get attrs(){return D||(D=um(g))},get slots(){return fu(g.slots)},get emit(){return(L,...Y)=>g.emit(L,...Y)},expose:b})}function vv(g){if(g.exposed)return g.exposeProxy||(g.exposeProxy=new Proxy(fs(Ga(g.exposed)),{get(b,D){if(D in b)return b[D];if(D in hf)return hf[D](g)}}))}const hm=/(?:^|[-_])(\w)/g,pf=g=>g.replace(hm,b=>b.toUpperCase()).replace(/[-_]/g,"");function kh(g){return bt(g)&&g.displayName||g.name}function ff(g,b,D=!1){let L=kh(b);if(!L&&b.__file){const Y=b.__file.match(/([^/\\]+)\.\w+$/);Y&&(L=Y[1])}if(!L&&g&&g.parent){const Y=ne=>{for(const be in ne)if(ne[be]===b)return be};L=Y(g.components||g.parent.type.components)||Y(g.appContext.components)}return L?pf(L):D?"App":"Anonymous"}function dm(g){return bt(g)&&"__vccOpts"in g}const pm=(g,b)=>Xf(g,b,zg),yv=g=>ei(`${g}() is a compiler-hint helper that is only usable inside <script setup> of a single file component. Its arguments should be compiled away and passing it at runtime has no effect.`);function Sb(){return yv("defineProps"),null}function oA(){return yv("defineEmits"),null}function aA(g){yv("defineExpose")}function us(g,b){return yv("withDefaults"),null}function Av(){return Ll().slots}function bv(){return Ll().attrs}function Ll(){const g=Lh();return g||ei("useContext() called without active instance."),g.setupContext||(g.setupContext=nh(g))}function Mb(g,b){const D=Nt(g)?g.reduce((L,Y)=>(L[Y]={},L),{}):g;for(const L in b){const Y=D[L];Y?Nt(Y)||bt(Y)?D[L]={type:Y,default:b[L]}:Y.default=b[L]:Y===null?D[L]={default:b[L]}:ei(`props default key "${L}" has no corresponding declaration.`)}return D}function lA(g,b){const D={};for(const L in g)b.includes(L)||Object.defineProperty(D,L,{enumerable:!0,get:()=>g[L]});return D}function yp(g){const b=Lh();b||ei("withAsyncContext called without active current instance. This is likely a bug.");let D=g();return Td(),pi(D)&&(D=D.catch(L=>{throw Nh(b),L})),[D,()=>Nh(b)]}function La(g,b,D){const L=arguments.length;return L===2?Un(b)&&!Nt(b)?Bh(b)?go(g,null,[b]):go(g,b):go(g,null,b):(L>3?D=Array.prototype.slice.call(arguments,2):L===3&&Bh(D)&&(D=[D]),go(g,b,D))}const Ws=Symbol("ssrContext"),U0=()=>{ei("useSSRContext() is not supported in the global build.")};function xv(){if(typeof window>"u")return;const g={style:"color:#3ba776"},b={style:"color:#0b1bc9"},D={style:"color:#b62e24"},L={style:"color:#9d288c"},Y={header(nt){return Un(nt)?nt.__isVue?["div",g,"VueInstance"]:ao(nt)?["div",{},["span",g,st(nt)],"<",Me(nt.value),">"]:Va(nt)?["div",{},["span",g,Gu(nt)?"ShallowReactive":"Reactive"],"<",Me(nt),`>${Wr(nt)?" (readonly)":""}`]:Wr(nt)?["div",{},["span",g,Gu(nt)?"ShallowReadonly":"Readonly"],"<",Me(nt),">"]:null:null},hasBody(nt){return nt&&nt.__isVue},body(nt){if(nt&&nt.__isVue)return["div",{},...ne(nt.$)]}};function ne(nt){const ot=[];nt.type.props&&nt.props&&ot.push(be("props",Nr(nt.props))),nt.setupState!==he&&ot.push(be("setup",nt.setupState)),nt.data!==he&&ot.push(be("data",Nr(nt.data)));const Vt=De(nt,"computed");Vt&&ot.push(be("computed",Vt));const Jt=De(nt,"inject");return Jt&&ot.push(be("injected",Jt)),ot.push(["div",{},["span",{style:L.style+";opacity:0.66"},"$ (internal): "],["object",{object:nt}]]),ot}function be(nt,ot){return ot=_t({},ot),Object.keys(ot).length?["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},nt],["div",{style:"padding-left:1.25em"},...Object.keys(ot).map(Vt=>["div",{},["span",L,Vt+": "],Me(ot[Vt],!1)])]]:["span",{}]}function Me(nt,ot=!0){return typeof nt=="number"?["span",b,nt]:typeof nt=="string"?["span",D,JSON.stringify(nt)]:typeof nt=="boolean"?["span",L,nt]:Un(nt)?["object",{object:ot?Nr(nt):nt}]:["span",D,String(nt)]}function De(nt,ot){const Vt=nt.type;if(bt(Vt))return;const Jt={};for(const en in nt.ctx)je(Vt,en,ot)&&(Jt[en]=nt.ctx[en]);return Jt}function je(nt,ot,Vt){const Jt=nt[Vt];if(Nt(Jt)&&Jt.includes(ot)||Un(Jt)&&ot in Jt||nt.extends&&je(nt.extends,ot,Vt)||nt.mixins&&nt.mixins.some(en=>je(en,ot,Vt)))return!0}function st(nt){return Gu(nt)?"ShallowRef":nt.effect?"ComputedRef":"Ref"}window.devtoolsFormatters?window.devtoolsFormatters.push(Y):window.devtoolsFormatters=[Y]}function Hg(g,b,D,L){const Y=D[L];if(Y&&wv(Y,g))return Y;const ne=b();return ne.memo=g.slice(),D[L]=ne}function wv(g,b){const D=g.memo;if(D.length!=b.length)return!1;for(let L=0;L<D.length;L++)if(D[L]!==b[L])return!1;return mo>0&&Go&&Go.push(g),!0}const fm="3.2.29",Ev=null,Tu=null,Mc=null,mm="http://www.w3.org/2000/svg",Tc=typeof document<"u"?document:null,cA=Tc&&Tc.createElement("template"),Uh={insert:(g,b,D)=>{b.insertBefore(g,D||null)},remove:g=>{const b=g.parentNode;b&&b.removeChild(g)},createElement:(g,b,D,L)=>{const Y=b?Tc.createElementNS(mm,g):Tc.createElement(g,D?{is:D}:void 0);return g==="select"&&L&&L.multiple!=null&&Y.setAttribute("multiple",L.multiple),Y},createText:g=>Tc.createTextNode(g),createComment:g=>Tc.createComment(g),setText:(g,b)=>{g.nodeValue=b},setElementText:(g,b)=>{g.textContent=b},parentNode:g=>g.parentNode,nextSibling:g=>g.nextSibling,querySelector:g=>Tc.querySelector(g),setScopeId(g,b){g.setAttribute(b,"")},cloneNode(g){const b=g.cloneNode(!0);return"_value"in g&&(b._value=g._value),b},insertStaticContent(g,b,D,L,Y,ne){const be=D?D.previousSibling:b.lastChild;if(Y&&(Y===ne||Y.nextSibling))for(;b.insertBefore(Y.cloneNode(!0),D),!(Y===ne||!(Y=Y.nextSibling)););else{cA.innerHTML=L?`<svg>${g}</svg>`:g;const Me=cA.content;if(L){const De=Me.firstChild;for(;De.firstChild;)Me.appendChild(De.firstChild);Me.removeChild(De)}b.insertBefore(Me,D)}return[be?be.nextSibling:b.firstChild,D?D.previousSibling:b.lastChild]}};function Sv(g,b,D){const L=g._vtc;L&&(b=(b?[b,...L]:[...L]).join(" ")),b==null?g.removeAttribute("class"):D?g.setAttribute("class",b):g.className=b}function F0(g,b,D){const L=g.style,Y=sn(D);if(D&&!Y){for(const ne in D)Wg(L,ne,D[ne]);if(b&&!sn(b))for(const ne in b)D[ne]==null&&Wg(L,ne,"")}else{const ne=L.display;Y?b!==D&&(L.cssText=D):b&&g.removeAttribute("style"),"_vod"in g&&(L.display=ne)}}const Mv=/\s*!important$/;function Wg(g,b,D){if(Nt(D))D.forEach(L=>Wg(g,b,L));else if(b.startsWith("--"))g.setProperty(b,D);else{const L=hA(g,b);Mv.test(D)?g.setProperty(Hn(L),D.replace(Mv,""),"important"):g[L]=D}}const uA=["Webkit","Moz","ms"],Tv={};function hA(g,b){const D=Tv[b];if(D)return D;let L=In(b);if(L!=="filter"&&L in g)return Tv[b]=L;L=fe(L);for(let Y=0;Y<uA.length;Y++){const ne=uA[Y]+L;if(ne in g)return Tv[b]=ne}return b}const Qg="http://www.w3.org/1999/xlink";function qg(g,b,D,L,Y){if(L&&b.startsWith("xlink:"))D==null?g.removeAttributeNS(Qg,b.slice(6,b.length)):g.setAttributeNS(Qg,b,D);else{const ne=j(b);D==null||ne&&!te(D)?g.removeAttribute(b):g.setAttribute(b,ne?"":D)}}function gm(g,b,D,L,Y,ne,be){if(b==="innerHTML"||b==="textContent"){L&&be(L,Y,ne),g[b]=D??"";return}if(b==="value"&&g.tagName!=="PROGRESS"&&!g.tagName.includes("-")){g._value=D;const Me=D??"";(g.value!==Me||g.tagName==="OPTION")&&(g.value=Me),D==null&&g.removeAttribute(b);return}if(D===""||D==null){const Me=typeof g[b];if(Me==="boolean"){g[b]=te(D);return}else if(D==null&&Me==="string"){g[b]="",g.removeAttribute(b);return}else if(Me==="number"){try{g[b]=0}catch{}g.removeAttribute(b);return}}try{g[b]=D}catch(Me){ei(`Failed setting prop "${b}" on <${g.tagName.toLowerCase()}>: value ${D} is invalid.`,Me)}}let Ap=Date.now,Ya=!1;if(typeof window<"u"){Ap()>document.createEvent("Event").timeStamp&&(Ap=()=>performance.now());const g=navigator.userAgent.match(/firefox\/(\d+)/i);Ya=!!(g&&Number(g[1])<=53)}let Nl=0;const Cv=Promise.resolve(),kl=()=>{Nl=0},hl=()=>Nl||(Cv.then(kl),Nl=Ap());function Ka(g,b,D,L){g.addEventListener(b,D,L)}function bp(g,b,D,L){g.removeEventListener(b,D,L)}function Na(g,b,D,L,Y=null){const ne=g._vei||(g._vei={}),be=ne[b];if(L&&be)be.value=L;else{const[Me,De]=dA(b);if(L){const je=ne[b]=vm(L,Y);Ka(g,Me,je,De)}else be&&(bp(g,Me,be,De),ne[b]=void 0)}}const _m=/(?:Once|Passive|Capture)$/;function dA(g){let b;if(_m.test(g)){b={};let D;for(;D=g.match(_m);)g=g.slice(0,g.length-D[0].length),b[D[0].toLowerCase()]=!0}return[Hn(g.slice(2)),b]}function vm(g,b){const D=L=>{const Y=L.timeStamp||Ap();(Ya||Y>=D.attached-1)&&qo(ym(L,D.value),b,5,[L])};return D.value=g,D.attached=hl(),D}function ym(g,b){if(Nt(b)){const D=g.stopImmediatePropagation;return g.stopImmediatePropagation=()=>{D.call(g),g._stopped=!0},b.map(L=>Y=>!Y._stopped&&L&&L(Y))}else return b}const dl=/^on[a-z]/,pl=(g,b,D,L,Y=!1,ne,be,Me,De)=>{b==="class"?Sv(g,L,Y):b==="style"?F0(g,D,L):Ye(b)?it(b)||Na(g,b,D,L,be):(b[0]==="."?(b=b.slice(1),!0):b[0]==="^"?(b=b.slice(1),!1):z0(g,b,L,Y))?gm(g,b,L,ne,be,Me,De):(b==="true-value"?g._trueValue=L:b==="false-value"&&(g._falseValue=L),qg(g,b,L,Y))};function z0(g,b,D,L){return L?!!(b==="innerHTML"||b==="textContent"||b in g&&dl.test(b)&&bt(D)):b==="spellcheck"||b==="draggable"||b==="form"||b==="list"&&g.tagName==="INPUT"||b==="type"&&g.tagName==="TEXTAREA"||dl.test(b)&&sn(D)?!1:b in g}function j0(g,b){const D=Ls(g);class L extends fl{constructor(ne){super(D,ne,b)}}return L.def=D,L}const mf=g=>j0(g,i_),xp=typeof HTMLElement<"u"?HTMLElement:class{};class fl extends xp{constructor(b,D={},L){super(),this._def=b,this._props=D,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&L?L(this._createVNode(),this.shadowRoot):(this.shadowRoot&&ei("Custom element has pre-rendered declarative shadow root but is not defined as hydratable. Use `defineSSRCustomElement`."),this.attachShadow({mode:"open"}))}connectedCallback(){this._connected=!0,this._instance||this._resolveDef()}disconnectedCallback(){this._connected=!1,Kp(()=>{this._connected||(Tp(null,this.shadowRoot),this._instance=null)})}_resolveDef(){if(this._resolved)return;this._resolved=!0;for(let L=0;L<this.attributes.length;L++)this._setAttr(this.attributes[L].name);new MutationObserver(L=>{for(const Y of L)this._setAttr(Y.attributeName)}).observe(this,{attributes:!0});const b=L=>{const{props:Y,styles:ne}=L,be=!Nt(Y),Me=Y?be?Object.keys(Y):Y:[];let De;if(be)for(const je in this._props){const st=Y[je];(st===Number||st&&st.type===Number)&&(this._props[je]=It(this._props[je]),(De||(De=Object.create(null)))[je]=!0)}this._numberProps=De;for(const je of Object.keys(this))je[0]!=="_"&&this._setProp(je,this[je],!0,!1);for(const je of Me.map(In))Object.defineProperty(this,je,{get(){return this._getProp(je)},set(st){this._setProp(je,st)}});this._applyStyles(ne),this._update()},D=this._def.__asyncLoader;D?D().then(b):b(this._def)}_setAttr(b){let D=this.getAttribute(b);this._numberProps&&this._numberProps[b]&&(D=It(D)),this._setProp(In(b),D,!1)}_getProp(b){return this._props[b]}_setProp(b,D,L=!0,Y=!0){D!==this._props[b]&&(this._props[b]=D,Y&&this._instance&&this._update(),L&&(D===!0?this.setAttribute(Hn(b),""):typeof D=="string"||typeof D=="number"?this.setAttribute(Hn(b),D+""):D||this.removeAttribute(Hn(b))))}_update(){Tp(this._createVNode(),this.shadowRoot)}_createVNode(){const b=go(this._def,_t({},this._props));return this._instance||(b.ce=D=>{this._instance=D,D.isCE=!0,D.ceReload=Y=>{this._styles&&(this._styles.forEach(ne=>this.shadowRoot.removeChild(ne)),this._styles.length=0),this._applyStyles(Y),this._def.__asyncLoader||(this._instance=null,this._update())},D.emit=(Y,...ne)=>{this.dispatchEvent(new CustomEvent(Y,{detail:ne}))};let L=this;for(;L=L&&(L.parentNode||L.host);)if(L instanceof fl){D.parent=L._instance;break}}),b}_applyStyles(b){b&&b.forEach(D=>{const L=document.createElement("style");L.textContent=D,this.shadowRoot.appendChild(L),(this._styles||(this._styles=[])).push(L)})}}function gf(g="$style"){return ei("useCssModule() is not supported in the global build."),he}function wp(g){const b=Lh();if(!b){ei("useCssVars is called without current active component instance.");return}const D=()=>ml(b.subTree,g(b.proxy));Eu(D),Aa(()=>{const L=new MutationObserver(D);L.observe(b.subTree.el.parentNode,{childList:!0}),pa(()=>L.disconnect())})}function ml(g,b){if(g.shapeFlag&128){const D=g.suspense;g=D.activeBranch,D.pendingBranch&&!D.isHydrating&&D.effects.push(()=>{ml(D.activeBranch,b)})}for(;g.component;)g=g.component.subTree;if(g.shapeFlag&1&&g.el)_f(g.el,b);else if(g.type===Vo)g.children.forEach(D=>ml(D,b));else if(g.type===Ba){let{el:D,anchor:L}=g;for(;D&&(_f(D,b),D!==L);)D=D.nextSibling}}function _f(g,b){if(g.nodeType===1){const D=g.style;for(const L in b)D.setProperty(`--${L}`,b[L])}}const Fh="transition",Xg="animation",Yg=(g,{slots:b})=>La(da,$a(g),b);Yg.displayName="Transition";const vf={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},pA=Yg.props=_t({},da.props,vf),zh=(g,b=[])=>{Nt(g)?g.forEach(D=>D(...b)):g&&g(...b)},Ep=g=>g?Nt(g)?g.some(b=>b.length>1):g.length>1:!1;function $a(g){const b={};for(const Kt in g)Kt in vf||(b[Kt]=g[Kt]);if(g.css===!1)return b;const{name:D="v",type:L,duration:Y,enterFromClass:ne=`${D}-enter-from`,enterActiveClass:be=`${D}-enter-active`,enterToClass:Me=`${D}-enter-to`,appearFromClass:De=ne,appearActiveClass:je=be,appearToClass:st=Me,leaveFromClass:nt=`${D}-leave-from`,leaveActiveClass:ot=`${D}-leave-active`,leaveToClass:Vt=`${D}-leave-to`}=g,Jt=Ds(Y),en=Jt&&Jt[0],Yt=Jt&&Jt[1],{onBeforeEnter:ln,onEnter:et,onEnterCancelled:$e,onLeave:Gt,onLeaveCancelled:Ut,onBeforeAppear:yt=ln,onAppear:wt=et,onAppearCancelled:qe=$e}=b,Ct=(Kt,yn,ii)=>{jh(Kt,yn?st:Me),jh(Kt,yn?je:be),ii&&ii()},Dt=(Kt,yn)=>{jh(Kt,Vt),jh(Kt,ot),yn&&yn()},hn=Kt=>(yn,ii)=>{const Ui=Kt?wt:et,Bi=()=>Ct(yn,Kt,ii);zh(Ui,[yn,Bi]),yf(()=>{jh(yn,Kt?De:ne),Cc(yn,Kt?st:Me),Ep(Ui)||Am(yn,L,en,Bi)})};return _t(b,{onBeforeEnter(Kt){zh(ln,[Kt]),Cc(Kt,ne),Cc(Kt,be)},onBeforeAppear(Kt){zh(yt,[Kt]),Cc(Kt,De),Cc(Kt,je)},onEnter:hn(!1),onAppear:hn(!0),onLeave(Kt,yn){const ii=()=>Dt(Kt,yn);Cc(Kt,nt),gl(),Cc(Kt,ot),yf(()=>{jh(Kt,nt),Cc(Kt,Vt),Ep(Gt)||Am(Kt,L,Yt,ii)}),zh(Gt,[Kt,ii])},onEnterCancelled(Kt){Ct(Kt,!1),zh($e,[Kt])},onAppearCancelled(Kt){Ct(Kt,!0),zh(qe,[Kt])},onLeaveCancelled(Kt){Dt(Kt),zh(Ut,[Kt])}})}function Ds(g){if(g==null)return null;if(Un(g))return[Cd(g.enter),Cd(g.leave)];{const b=Cd(g);return[b,b]}}function Cd(g){const b=It(g);return Fs(b),b}function Fs(g){typeof g!="number"?ei(`<transition> explicit duration is not a valid number - got ${JSON.stringify(g)}.`):isNaN(g)&&ei("<transition> explicit duration is NaN - the duration expression might be incorrect.")}function Cc(g,b){b.split(/\s+/).forEach(D=>D&&g.classList.add(D)),(g._vtc||(g._vtc=new Set)).add(b)}function jh(g,b){b.split(/\s+/).forEach(L=>L&&g.classList.remove(L));const{_vtc:D}=g;D&&(D.delete(b),D.size||(g._vtc=void 0))}function yf(g){requestAnimationFrame(()=>{requestAnimationFrame(g)})}let Cu=0;function Am(g,b,D,L){const Y=g._endId=++Cu,ne=()=>{Y===g._endId&&L()};if(D)return setTimeout(ne,D);const{type:be,timeout:Me,propCount:De}=Rd(g,b);if(!be)return L();const je=be+"end";let st=0;const nt=()=>{g.removeEventListener(je,ot),ne()},ot=Vt=>{Vt.target===g&&++st>=De&&nt()};setTimeout(()=>{st<De&&nt()},Me+1),g.addEventListener(je,ot)}function Rd(g,b){const D=window.getComputedStyle(g),L=Jt=>(D[Jt]||"").split(", "),Y=L(Fh+"Delay"),ne=L(Fh+"Duration"),be=Af(Y,ne),Me=L(Xg+"Delay"),De=L(Xg+"Duration"),je=Af(Me,De);let st=null,nt=0,ot=0;b===Fh?be>0&&(st=Fh,nt=be,ot=ne.length):b===Xg?je>0&&(st=Xg,nt=je,ot=De.length):(nt=Math.max(be,je),st=nt>0?be>je?Fh:Xg:null,ot=st?st===Fh?ne.length:De.length:0);const Vt=st===Fh&&/\b(transform|all)(,|$)/.test(D[Fh+"Property"]);return{type:st,timeout:nt,propCount:ot,hasTransform:Vt}}function Af(g,b){for(;g.length<b.length;)g=g.concat(g);return Math.max(...b.map((D,L)=>Kg(D)+Kg(g[L])))}function Kg(g){return Number(g.slice(0,-1).replace(",","."))*1e3}function gl(){return document.body.offsetHeight}const $g=new WeakMap,bm=new WeakMap,Jg={name:"TransitionGroup",props:_t({},pA,{tag:String,moveClass:String}),setup(g,{slots:b}){const D=Lh(),L=_d();let Y,ne;return cp(()=>{if(!Y.length)return;const be=g.moveClass||`${g.name||"v"}-move`;if(!Zg(Y[0].el,D.vnode.el,be))return;Y.forEach(xm),Y.forEach(Vh);const Me=Y.filter(V0);gl(),Me.forEach(De=>{const je=De.el,st=je.style;Cc(je,be),st.transform=st.webkitTransform=st.transitionDuration="";const nt=je._moveCb=ot=>{ot&&ot.target!==je||(!ot||/transform$/.test(ot.propertyName))&&(je.removeEventListener("transitionend",nt),je._moveCb=null,jh(je,be))};je.addEventListener("transitionend",nt)})}),()=>{const be=Nr(g),Me=$a(be);let De=be.tag||Vo;Y=ne,ne=b.default?Fi(b.default()):[];for(let je=0;je<ne.length;je++){const st=ne[je];st.key!=null?Xc(st,Rh(st,Me,L,D)):ei("<TransitionGroup> children must be keyed.")}if(Y)for(let je=0;je<Y.length;je++){const st=Y[je];Xc(st,Rh(st,Me,L,D)),$g.set(st,st.el.getBoundingClientRect())}return go(De,null,ne)}}};function xm(g){const b=g.el;b._moveCb&&b._moveCb(),b._enterCb&&b._enterCb()}function Vh(g){bm.set(g,g.el.getBoundingClientRect())}function V0(g){const b=$g.get(g),D=bm.get(g),L=b.left-D.left,Y=b.top-D.top;if(L||Y){const ne=g.el.style;return ne.transform=ne.webkitTransform=`translate(${L}px,${Y}px)`,ne.transitionDuration="0s",g}}function Zg(g,b,D){const L=g.cloneNode();g._vtc&&g._vtc.forEach(be=>{be.split(/\s+/).forEach(Me=>Me&&L.classList.remove(Me))}),D.split(/\s+/).forEach(be=>be&&L.classList.add(be)),L.style.display="none";const Y=b.nodeType===1?b:b.parentNode;Y.appendChild(L);const{hasTransform:ne}=Rd(L);return Y.removeChild(L),ne}const Ja=g=>{const b=g.props["onUpdate:modelValue"];return Nt(b)?D=>We(b,D):b};function G0(g){g.target.composing=!0}function e_(g){const b=g.target;b.composing&&(b.composing=!1,wm(b,"input"))}function wm(g,b){const D=document.createEvent("HTMLEvents");D.initEvent(b,!0,!0),g.dispatchEvent(D)}const Em={created(g,{modifiers:{lazy:b,trim:D,number:L}},Y){g._assign=Ja(Y);const ne=L||Y.props&&Y.props.type==="number";Ka(g,b?"change":"input",be=>{if(be.target.composing)return;let Me=g.value;D?Me=Me.trim():ne&&(Me=It(Me)),g._assign(Me)}),D&&Ka(g,"change",()=>{g.value=g.value.trim()}),b||(Ka(g,"compositionstart",G0),Ka(g,"compositionend",e_),Ka(g,"change",e_))},mounted(g,{value:b}){g.value=b??""},beforeUpdate(g,{value:b,modifiers:{lazy:D,trim:L,number:Y}},ne){if(g._assign=Ja(ne),g.composing||document.activeElement===g&&(D||L&&g.value.trim()===b||(Y||g.type==="number")&&It(g.value)===b))return;const be=b??"";g.value!==be&&(g.value=be)}},Sm={deep:!0,created(g,b,D){g._assign=Ja(D),Ka(g,"change",()=>{const L=g._modelValue,Y=Sp(g),ne=g.checked,be=g._assign;if(Nt(L)){const Me=ae(L,Y),De=Me!==-1;if(ne&&!De)be(L.concat(Y));else if(!ne&&De){const je=[...L];je.splice(Me,1),be(je)}}else if(Qe(L)){const Me=new Set(L);ne?Me.add(Y):Me.delete(Y),be(Me)}else be(Iv(g,ne))})},mounted:lo,beforeUpdate(g,b,D){g._assign=Ja(D),lo(g,b,D)}};function lo(g,{value:b,oldValue:D},L){g._modelValue=b,Nt(b)?g.checked=ae(b,L.props.value)>-1:Qe(b)?g.checked=b.has(L.props.value):b!==D&&(g.checked=$(b,Iv(g,!0)))}const Rv={created(g,{value:b},D){g.checked=$(b,D.props.value),g._assign=Ja(D),Ka(g,"change",()=>{g._assign(Sp(g))})},beforeUpdate(g,{value:b,oldValue:D},L){g._assign=Ja(L),b!==D&&(g.checked=$(b,L.props.value))}},t_={deep:!0,created(g,{value:b,modifiers:{number:D}},L){const Y=Qe(b);Ka(g,"change",()=>{const ne=Array.prototype.filter.call(g.options,be=>be.selected).map(be=>D?It(Sp(be)):Sp(be));g._assign(g.multiple?Y?new Set(ne):ne:ne[0])}),g._assign=Ja(L)},mounted(g,{value:b}){Mm(g,b)},beforeUpdate(g,b,D){g._assign=Ja(D)},updated(g,{value:b}){Mm(g,b)}};function Mm(g,b){const D=g.multiple;if(D&&!Nt(b)&&!Qe(b)){ei(`<select multiple v-model> expects an Array or Set value for its binding, but got ${Object.prototype.toString.call(b).slice(8,-1)}.`);return}for(let L=0,Y=g.options.length;L<Y;L++){const ne=g.options[L],be=Sp(ne);if(D)Nt(b)?ne.selected=ae(b,be)>-1:ne.selected=b.has(be);else if($(Sp(ne),b)){g.selectedIndex!==L&&(g.selectedIndex=L);return}}!D&&g.selectedIndex!==-1&&(g.selectedIndex=-1)}function Sp(g){return"_value"in g?g._value:g.value}function Iv(g,b){const D=b?"_trueValue":"_falseValue";return D in g?g[D]:b}const Tb={created(g,b,D){Pv(g,b,D,null,"created")},mounted(g,b,D){Pv(g,b,D,null,"mounted")},beforeUpdate(g,b,D,L){Pv(g,b,D,L,"beforeUpdate")},updated(g,b,D,L){Pv(g,b,D,L,"updated")}};function Pv(g,b,D,L,Y){let ne;switch(g.tagName){case"SELECT":ne=t_;break;case"TEXTAREA":ne=Em;break;default:switch(D.props&&D.props.type){case"checkbox":ne=Sm;break;case"radio":ne=Rv;break;default:ne=Em}}const be=ne[Y];be&&be(g,b,D,L)}const ih=["ctrl","shift","alt","meta"],Dv={stop:g=>g.stopPropagation(),prevent:g=>g.preventDefault(),self:g=>g.target!==g.currentTarget,ctrl:g=>!g.ctrlKey,shift:g=>!g.shiftKey,alt:g=>!g.altKey,meta:g=>!g.metaKey,left:g=>"button"in g&&g.button!==0,middle:g=>"button"in g&&g.button!==1,right:g=>"button"in g&&g.button!==2,exact:(g,b)=>ih.some(D=>g[`${D}Key`]&&!b.includes(D))},Ov=(g,b)=>(D,...L)=>{for(let Y=0;Y<b.length;Y++){const ne=Dv[b[Y]];if(ne&&ne(D,b))return}return g(D,...L)},H0={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Bv=(g,b)=>D=>{if(!("key"in D))return;const L=Hn(D.key);if(b.some(Y=>Y===L||H0[Y]===L))return g(D)},Lv={beforeMount(g,{value:b},{transition:D}){g._vod=g.style.display==="none"?"":g.style.display,D&&b?D.beforeEnter(g):Gh(g,b)},mounted(g,{value:b},{transition:D}){D&&b&&D.enter(g)},updated(g,{value:b,oldValue:D},{transition:L}){!b!=!D&&(L?b?(L.beforeEnter(g),Gh(g,!0),L.enter(g)):L.leave(g,()=>{Gh(g,!1)}):Gh(g,b))},beforeUnmount(g,{value:b}){Gh(g,b)}};function Gh(g,b){g.style.display=b?g._vod:"none"}const n_=_t({patchProp:pl},Uh);let Mp,bf=!1;function xf(){return Mp||(Mp=Jc(n_))}function Hh(){return Mp=bf?Mp:Dg(n_),bf=!0,Mp}const Tp=(...g)=>{xf().render(...g)},i_=(...g)=>{Hh().hydrate(...g)},Nv=(...g)=>{const b=xf().createApp(...g);wf(b),r_(b);const{mount:D}=b;return b.mount=L=>{const Y=Cm(L);if(!Y)return;const ne=b._component;!bt(ne)&&!ne.render&&!ne.template&&(ne.template=Y.innerHTML),Y.innerHTML="";const be=D(Y,!1,Y instanceof SVGElement);return Y instanceof Element&&(Y.removeAttribute("v-cloak"),Y.setAttribute("data-v-app","")),be},b},Tm=(...g)=>{const b=Hh().createApp(...g);wf(b),r_(b);const{mount:D}=b;return b.mount=L=>{const Y=Cm(L);if(Y)return D(Y,!0,Y instanceof SVGElement)},b};function wf(g){Object.defineProperty(g.config,"isNativeTag",{value:b=>_e(b)||ge(b),writable:!1})}function r_(g){if(Vg()){const b=g.config.isCustomElement;Object.defineProperty(g.config,"isCustomElement",{get(){return b},set(){ei("The `isCustomElement` config option is deprecated. Use `compilerOptions.isCustomElement` instead.")}});const D=g.config.compilerOptions,L='The `compilerOptions` config option is only respected when using a build of Vue.js that includes the runtime compiler (aka "full build"). Since you are using the runtime-only build, `compilerOptions` must be passed to `@vue/compiler-dom` in the build setup instead.\n- For vue-loader: pass it via vue-loader\'s `compilerOptions` loader option.\n- For vue-cli: see https://cli.vuejs.org/guide/webpack.html#modifying-options-of-a-loader\n- For vite: pass it via @vitejs/plugin-vue options. See https://github.com/vitejs/vite/tree/main/packages/plugin-vue#example-for-passing-options-to-vuecompiler-dom';Object.defineProperty(g.config,"compilerOptions",{get(){return ei(L),D},set(){ei(L)}})}}function Cm(g){if(sn(g)){const b=document.querySelector(g);return b||ei(`Failed to mount app: mount target selector "${g}" returned null.`),b}return window.ShadowRoot&&g instanceof window.ShadowRoot&&g.mode==="closed"&&ei('mounting on a ShadowRoot with `{mode: "closed"}` may lead to unpredictable bugs'),g}const kv=Ce;function mA(){console.info(`You are running a development build of Vue.
Make sure to use the production build (*.prod.js) when deploying for production.`),xv()}function Id(g){throw g}function Ru(g){console.warn(`[Vue warn] ${g.message}`)}function Os(g,b,D,L){const Y=(D||s_)[g]+(L||""),ne=new SyntaxError(String(Y));return ne.code=g,ne.loc=b,ne}const s_={0:"Illegal comment.",1:"CDATA section is allowed only in XML context.",2:"Duplicate attribute.",3:"End tag cannot have attributes.",4:"Illegal '/' in tags.",5:"Unexpected EOF in tag.",6:"Unexpected EOF in CDATA section.",7:"Unexpected EOF in comment.",8:"Unexpected EOF in script.",9:"Unexpected EOF in tag.",10:"Incorrectly closed comment.",11:"Incorrectly opened comment.",12:"Illegal tag name. Use '&lt;' to print '<'.",13:"Attribute value was expected.",14:"End tag name was expected.",15:"Whitespace was expected.",16:"Unexpected '<!--' in comment.",17:`Attribute name cannot contain U+0022 ("), U+0027 ('), and U+003C (<).`,18:"Unquoted attribute value cannot contain U+0022 (\"), U+0027 ('), U+003C (<), U+003D (=), and U+0060 (`).",19:"Attribute name cannot start with '='.",21:"'<?' is allowed only in XML context.",20:"Unexpected null character.",22:"Illegal '/' in tags.",23:"Invalid end tag.",24:"Element is missing end tag.",25:"Interpolation end sign was not found.",27:"End bracket for dynamic directive argument was not found. Note that dynamic directive argument cannot contain spaces.",26:"Legal directive name was expected.",28:"v-if/v-else-if is missing expression.",29:"v-if/else branches must use unique keys.",30:"v-else/v-else-if has no adjacent v-if or v-else-if.",31:"v-for is missing expression.",32:"v-for has invalid expression.",33:"<template v-for> key should be placed on the <template> tag.",34:"v-bind is missing expression.",35:"v-on is missing expression.",36:"Unexpected custom directive on <slot> outlet.",37:"Mixed v-slot usage on both the component and nested <template>.When there are multiple named slots, all slots should use <template> syntax to avoid scope ambiguity.",38:"Duplicate slot names found. ",39:"Extraneous children found when component already has explicitly named default slot. These children will be ignored.",40:"v-slot can only be used on components or <template> tags.",41:"v-model is missing expression.",42:"v-model value must be a valid JavaScript member expression.",43:"v-model cannot be used on v-for or v-slot scope variables because they are not writable.",44:"Error parsing JavaScript expression: ",45:"<KeepAlive> expects exactly one child component.",46:'"prefixIdentifiers" option is not supported in this build of compiler.',47:"ES module mode is not supported in this build of compiler.",48:'"cacheHandlers" option is only supported when the "prefixIdentifiers" option is enabled.',49:'"scopeId" option is only supported in module mode.',50:""},$l=Symbol("Fragment"),Rc=Symbol("Teleport"),rh=Symbol("Suspense"),Cp=Symbol("KeepAlive"),Rm=Symbol("BaseTransition"),Iu=Symbol("openBlock"),Ef=Symbol("createBlock"),Im=Symbol("createElementBlock"),o_=Symbol("createVNode"),Wh=Symbol("createElementVNode"),Sf=Symbol("createCommentVNode"),Qh=Symbol("createTextVNode"),Pm=Symbol("createStaticVNode"),Uv=Symbol("resolveComponent"),Fv=Symbol("resolveDynamicComponent"),a_=Symbol("resolveDirective"),Cb=Symbol("resolveFilter"),l_=Symbol("withDirectives"),zv=Symbol("renderList"),W0=Symbol("renderSlot"),jv=Symbol("createSlots"),c_=Symbol("toDisplayString"),sh=Symbol("mergeProps"),Q0=Symbol("normalizeClass"),no=Symbol("normalizeStyle"),Rp=Symbol("normalizeProps"),qh=Symbol("guardReactiveProps"),Mf=Symbol("toHandlers"),Tf=Symbol("camelize"),Dm=Symbol("capitalize"),Vv=Symbol("toHandlerKey"),Om=Symbol("setBlockTracking"),Cf=Symbol("pushScopeId"),Rf=Symbol("popScopeId"),Ic=Symbol("withCtx"),Bm=Symbol("unref"),u_=Symbol("isRef"),Pd=Symbol("withMemo"),gA=Symbol("isMemoSame"),Pu={[$l]:"Fragment",[Rc]:"Teleport",[rh]:"Suspense",[Cp]:"KeepAlive",[Rm]:"BaseTransition",[Iu]:"openBlock",[Ef]:"createBlock",[Im]:"createElementBlock",[o_]:"createVNode",[Wh]:"createElementVNode",[Sf]:"createCommentVNode",[Qh]:"createTextVNode",[Pm]:"createStaticVNode",[Uv]:"resolveComponent",[Fv]:"resolveDynamicComponent",[a_]:"resolveDirective",[Cb]:"resolveFilter",[l_]:"withDirectives",[zv]:"renderList",[W0]:"renderSlot",[jv]:"createSlots",[c_]:"toDisplayString",[sh]:"mergeProps",[Q0]:"normalizeClass",[no]:"normalizeStyle",[Rp]:"normalizeProps",[qh]:"guardReactiveProps",[Mf]:"toHandlers",[Tf]:"camelize",[Dm]:"capitalize",[Vv]:"toHandlerKey",[Om]:"setBlockTracking",[Cf]:"pushScopeId",[Rf]:"popScopeId",[Ic]:"withCtx",[Bm]:"unref",[u_]:"isRef",[Pd]:"withMemo",[gA]:"isMemoSame"};function Lm(g){Object.getOwnPropertySymbols(g).forEach(b=>{Pu[b]=g[b]})}const Za={source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}};function h_(g,b=Za){return{type:0,children:g,helpers:[],components:[],directives:[],hoists:[],imports:[],cached:0,temps:0,codegenNode:void 0,loc:b}}function oh(g,b,D,L,Y,ne,be,Me=!1,De=!1,je=!1,st=Za){return g&&(Me?(g.helper(Iu),g.helper(iu(g.inSSR,je))):g.helper(Co(g.inSSR,je)),be&&g.helper(l_)),{type:13,tag:b,props:D,children:L,patchFlag:Y,dynamicProps:ne,directives:be,isBlock:Me,disableTracking:De,isComponent:je,loc:st}}function Dd(g,b=Za){return{type:17,loc:b,elements:g}}function _l(g,b=Za){return{type:15,loc:b,properties:g}}function _o(g,b){return{type:16,loc:Za,key:sn(g)?Yr(g,!0):g,value:b}}function Yr(g,b=!1,D=Za,L=0){return{type:4,loc:D,content:g,isStatic:b,constType:b?3:L}}function Ul(g,b=Za){return{type:8,loc:b,children:g}}function Ho(g,b=[],D=Za){return{type:14,loc:D,callee:g,arguments:b}}function Ip(g,b=void 0,D=!1,L=!1,Y=Za){return{type:18,params:g,returns:b,newline:D,isSlot:L,loc:Y}}function Nm(g,b,D,L=!0){return{type:19,test:g,consequent:b,alternate:D,newline:L,loc:Za}}function If(g,b,D=!1){return{type:20,index:g,value:b,isVNode:D,loc:Za}}function To(g){return{type:21,body:g,loc:Za}}const Jl=g=>g.type===4&&g.isStatic,Jo=(g,b)=>g===b||g===Hn(b);function ks(g){if(Jo(g,"Teleport"))return Rc;if(Jo(g,"Suspense"))return rh;if(Jo(g,"KeepAlive"))return Cp;if(Jo(g,"BaseTransition"))return Rm}const km=/^\d|[^\$\w]/,Pp=g=>!km.test(g),_A=/[A-Za-z_$\xA0-\uFFFF]/,q0=/[\.\?\w$\xA0-\uFFFF]/,Du=/\s+[.[]\s*|\s*[.[]\s+/g,Pf=g=>{g=g.trim().replace(Du,be=>be.trim());let b=0,D=[],L=0,Y=0,ne=null;for(let be=0;be<g.length;be++){const Me=g.charAt(be);switch(b){case 0:if(Me==="[")D.push(b),b=1,L++;else if(Me==="(")D.push(b),b=2,Y++;else if(!(be===0?_A:q0).test(Me))return!1;break;case 1:Me==="'"||Me==='"'||Me==="`"?(D.push(b),b=3,ne=Me):Me==="["?L++:Me==="]"&&(--L||(b=D.pop()));break;case 2:if(Me==="'"||Me==='"'||Me==="`")D.push(b),b=3,ne=Me;else if(Me==="(")Y++;else if(Me===")"){if(be===g.length-1)return!1;--Y||(b=D.pop())}break;case 3:Me===ne&&(b=D.pop(),ne=null);break}}return!L&&!Y};function Od(g,b,D){const Y={source:g.source.slice(b,b+D),start:Yh(g.start,g.source,b),end:g.end};return D!=null&&(Y.end=Yh(g.start,g.source,b+D)),Y}function Yh(g,b,D=b.length){return tu(_t({},g),b,D)}function tu(g,b,D=b.length){let L=0,Y=-1;for(let ne=0;ne<D;ne++)b.charCodeAt(ne)===10&&(L++,Y=ne);return g.offset+=D,g.line+=L,g.column=Y===-1?g.column+D:D-Y,g}function Zl(g,b){if(!g)throw new Error(b||"unexpected compiler condition")}function vl(g,b,D=!1){for(let L=0;L<g.props.length;L++){const Y=g.props[L];if(Y.type===7&&(D||Y.exp)&&(sn(b)?Y.name===b:b.test(Y.name)))return Y}}function Kh(g,b,D=!1,L=!1){for(let Y=0;Y<g.props.length;Y++){const ne=g.props[Y];if(ne.type===6){if(D)continue;if(ne.name===b&&(ne.value||L))return ne}else if(ne.name==="bind"&&(ne.exp||L)&&Bd(ne.arg,b))return ne}}function Bd(g,b){return!!(g&&Jl(g)&&g.content===b)}function Um(g){return g.props.some(b=>b.type===7&&b.name==="bind"&&(!b.arg||b.arg.type!==4||!b.arg.isStatic))}function ba(g){return g.type===5||g.type===2}function nu(g){return g.type===7&&g.name==="slot"}function Pc(g){return g.type===1&&g.tagType===3}function $h(g){return g.type===1&&g.tagType===2}function Co(g,b){return g||b?o_:Wh}function iu(g,b){return g||b?Ef:Im}const Dp=new Set([Rp,qh]);function Ld(g,b=[]){if(g&&!sn(g)&&g.type===14){const D=g.callee;if(!sn(D)&&Dp.has(D))return Ld(g.arguments[0],b.concat(g))}return[g,b]}function ec(g,b,D){let L,Y=g.type===13?g.props:g.arguments[2],ne=[],be;if(Y&&!sn(Y)&&Y.type===14){const Me=Ld(Y);Y=Me[0],ne=Me[1],be=ne[ne.length-1]}if(Y==null||sn(Y))L=_l([b]);else if(Y.type===14){const Me=Y.arguments[0];!sn(Me)&&Me.type===15?Me.properties.unshift(b):Y.callee===Mf?L=Ho(D.helper(sh),[_l([b]),Y]):Y.arguments.unshift(_l([b])),!L&&(L=Y)}else if(Y.type===15){let Me=!1;if(b.key.type===4){const De=b.key.content;Me=Y.properties.some(je=>je.key.type===4&&je.key.content===De)}Me||Y.properties.unshift(b),L=Y}else L=Ho(D.helper(sh),[_l([b]),Y]),be&&be.callee===qh&&(be=ne[ne.length-2]);g.type===13?be?be.arguments[0]=L:g.props=L:be?be.arguments[0]=L:g.arguments[2]=L}function Fl(g,b){return`_${b}_${g.replace(/[^\w]/g,(D,L)=>D==="-"?"_":g.charCodeAt(L).toString())}`}function Jh(g){return g.type===14&&g.callee===Pd?g.arguments[1].returns:g}function yl(g,{helper:b,removeHelper:D,inSSR:L}){g.isBlock||(g.isBlock=!0,D(Co(L,g.isComponent)),b(Iu),b(iu(L,g.isComponent)))}const Gv={COMPILER_IS_ON_ELEMENT:{message:'Platform-native elements with "is" prop will no longer be treated as components in Vue 3 unless the "is" value is explicitly prefixed with "vue:".',link:"https://v3.vuejs.org/guide/migration/custom-elements-interop.html"},COMPILER_V_BIND_SYNC:{message:g=>`.sync modifier for v-bind has been removed. Use v-model with argument instead. \`v-bind:${g}.sync\` should be changed to \`v-model:${g}\`.`,link:"https://v3.vuejs.org/guide/migration/v-model.html"},COMPILER_V_BIND_PROP:{message:".prop modifier for v-bind has been removed and no longer necessary. Vue 3 will automatically set a binding as DOM property when appropriate."},COMPILER_V_BIND_OBJECT_ORDER:{message:'v-bind="obj" usage is now order sensitive and behaves like JavaScript object spread: it will now overwrite an existing non-mergeable attribute that appears before v-bind in the case of conflict. To retain 2.x behavior, move v-bind to make it the first attribute. You can also suppress this warning if the usage is intended.',link:"https://v3.vuejs.org/guide/migration/v-bind.html"},COMPILER_V_ON_NATIVE:{message:".native modifier for v-on has been removed as is no longer necessary.",link:"https://v3.vuejs.org/guide/migration/v-on-native-modifier-removed.html"},COMPILER_V_IF_V_FOR_PRECEDENCE:{message:"v-if / v-for precedence when used on the same element has changed in Vue 3: v-if now takes higher precedence and will no longer have access to v-for scope variables. It is best to avoid the ambiguity with <template> tags or use a computed property that filters v-for data source.",link:"https://v3.vuejs.org/guide/migration/v-if-v-for.html"},COMPILER_NATIVE_TEMPLATE:{message:"<template> with no special directives will render as a native template element instead of its inner content in Vue 3."},COMPILER_INLINE_TEMPLATE:{message:'"inline-template" has been removed in Vue 3.',link:"https://v3.vuejs.org/guide/migration/inline-template-attribute.html"},COMPILER_FILTER:{message:'filters have been removed in Vue 3. The "|" symbol will be treated as native JavaScript bitwise OR operator. Use method calls or computed properties instead.',link:"https://v3.vuejs.org/guide/migration/filters.html"}};function tc(g,b){const D=b.options?b.options.compatConfig:b.compatConfig,L=D&&D[g];return g==="MODE"?L||3:L}function Nd(g,b){const D=tc("MODE",b),L=tc(g,b);return D===3?L===!0:L!==!1}function Rb(g,b,D,...L){const Y=Nd(g,b);return Y&&Dc(g,b,D,...L),Y}function Dc(g,b,D,...L){if(tc(g,b)==="suppress-warning")return;const{message:ne,link:be}=Gv[g],Me=`(deprecation ${g}) ${typeof ne=="function"?ne(...L):ne}${be?`
  Details: ${be}`:""}`,De=new SyntaxError(Me);De.code=g,D&&(De.loc=D),b.onWarn(De)}const Hv=/&(gt|lt|amp|apos|quot);/g,ru={gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},Fm={delimiters:["{{","}}"],getNamespace:()=>0,getTextMode:()=>0,isVoidTag:Ne,isPreTag:Ne,isCustomElement:Ne,decodeEntities:g=>g.replace(Hv,(b,D)=>ru[D]),onError:Id,onWarn:Ru,comments:!0};function zm(g,b={}){const D=vA(g,b),L=Oc(D);return h_(Wv(D,0,[]),su(D,L))}function vA(g,b){const D=_t({},Fm);let L;for(L in b)D[L]=b[L]===void 0?Fm[L]:b[L];return{options:D,column:1,line:1,offset:0,originalSource:g,source:g,inPre:!1,inVPre:!1,onWarn:D.onWarn}}function Wv(g,b,D){const L=zl(D),Y=L?L.ns:0,ne=[];for(;!Gm(g,b,D);){const Me=g.source;let De;if(b===0||b===1){if(!g.inVPre&&ka(Me,g.options.delimiters[0]))De=AA(g,b);else if(b===0&&Me[0]==="<")if(Me.length===1)zs(g,5,1);else if(Me[1]==="!")ka(Me,"<!--")?De=d_(g):ka(Me,"<!DOCTYPE")?De=Bu(g):ka(Me,"<![CDATA[")?Y!==0?De=X0(g,D):(zs(g,1),De=Bu(g)):(zs(g,11),De=Bu(g));else if(Me[1]==="/")if(Me.length===2)zs(g,5,2);else if(Me[2]===">"){zs(g,14,2),Zo(g,3);continue}else if(/[a-z]/i.test(Me[2])){zs(g,23),Lu(g,1,L);continue}else zs(g,12,2),De=Bu(g);else/[a-z]/i.test(Me[1])?De=Qv(g,D):Me[1]==="?"?(zs(g,21,1),De=Bu(g)):zs(g,12,1)}if(De||(De=Nu(g,b)),Nt(De))for(let je=0;je<De.length;je++)Ou(ne,De[je]);else Ou(ne,De)}let be=!1;if(b!==2&&b!==1){const Me=g.options.whitespace!=="preserve";for(let De=0;De<ne.length;De++){const je=ne[De];if(!g.inPre&&je.type===2)if(/[^\t\r\n\f ]/.test(je.content))Me&&(je.content=je.content.replace(/[\t\r\n\f ]+/g," "));else{const st=ne[De-1],nt=ne[De+1];!st||!nt||Me&&(st.type===3||nt.type===3||st.type===1&&nt.type===1&&/[\r\n]/.test(je.content))?(be=!0,ne[De]=null):je.content=" "}else je.type===3&&!g.options.comments&&(be=!0,ne[De]=null)}if(g.inPre&&L&&g.options.isPreTag(L.tag)){const De=ne[0];De&&De.type===2&&(De.content=De.content.replace(/^\r?\n/,""))}}return be?ne.filter(Boolean):ne}function Ou(g,b){if(b.type===2){const D=zl(g);if(D&&D.type===2&&D.loc.end.offset===b.loc.start.offset){D.content+=b.content,D.loc.end=b.loc.end,D.loc.source+=b.loc.source;return}}g.push(b)}function X0(g,b){Zo(g,9);const D=Wv(g,3,b);return g.source.length===0?zs(g,6):Zo(g,3),D}function d_(g){const b=Oc(g);let D;const L=/--(\!)?>/.exec(g.source);if(!L)D=g.source.slice(4),Zo(g,g.source.length),zs(g,7);else{L.index<=3&&zs(g,0),L[1]&&zs(g,10),D=g.source.slice(4,L.index);const Y=g.source.slice(0,L.index);let ne=1,be=0;for(;(be=Y.indexOf("<!--",ne))!==-1;)Zo(g,be-ne+1),be+4<Y.length&&zs(g,16),ne=be+1;Zo(g,L.index+L[0].length-ne+1)}return{type:3,content:D,loc:su(g,b)}}function Bu(g){const b=Oc(g),D=g.source[1]==="?"?1:2;let L;const Y=g.source.indexOf(">");return Y===-1?(L=g.source.slice(D),Zo(g,g.source.length)):(L=g.source.slice(D,Y),Zo(g,Y+1)),{type:3,content:L,loc:su(g,b)}}function Qv(g,b){const D=g.inPre,L=g.inVPre,Y=zl(b),ne=Lu(g,0,Y),be=g.inPre&&!D,Me=g.inVPre&&!L;if(ne.isSelfClosing||g.options.isVoidTag(ne.tag))return be&&(g.inPre=!1),Me&&(g.inVPre=!1),ne;b.push(ne);const De=g.options.getTextMode(ne,Y),je=Wv(g,De,b);if(b.pop(),ne.children=je,Al(g.source,ne.tag))Lu(g,1,Y);else if(zs(g,24,0,ne.loc.start),g.source.length===0&&ne.tag.toLowerCase()==="script"){const st=je[0];st&&ka(st.loc.source,"<!--")&&zs(g,8)}return ne.loc=su(g,ne.loc.start),be&&(g.inPre=!1),Me&&(g.inVPre=!1),ne}const jm=a("if,else,else-if,for,slot");function Lu(g,b,D){const L=Oc(g),Y=/^<\/?([a-z][^\t\r\n\f />]*)/i.exec(g.source),ne=Y[1],be=g.options.getNamespace(ne,D);Zo(g,Y[0].length),Op(g);const Me=Oc(g),De=g.source;g.options.isPreTag(ne)&&(g.inPre=!0);let je=Y0(g,b);b===0&&!g.inVPre&&je.some(ot=>ot.type===7&&ot.name==="pre")&&(g.inVPre=!0,_t(g,Me),g.source=De,je=Y0(g,b).filter(ot=>ot.name!=="v-pre"));let st=!1;if(g.source.length===0?zs(g,9):(st=ka(g.source,"/>"),b===1&&st&&zs(g,4),Zo(g,st?2:1)),b===1)return;let nt=0;return g.inVPre||(ne==="slot"?nt=2:ne==="template"?je.some(ot=>ot.type===7&&jm(ot.name))&&(nt=3):yA(ne,je,g)&&(nt=1)),{type:1,ns:be,tag:ne,tagType:nt,props:je,isSelfClosing:st,children:[],loc:su(g,L),codegenNode:void 0}}function yA(g,b,D){const L=D.options;if(L.isCustomElement(g))return!1;if(g==="component"||/^[A-Z]/.test(g)||ks(g)||L.isBuiltInComponent&&L.isBuiltInComponent(g)||L.isNativeTag&&!L.isNativeTag(g))return!0;for(let Y=0;Y<b.length;Y++){const ne=b[Y];if(ne.type===6){if(ne.name==="is"&&ne.value&&ne.value.content.startsWith("vue:"))return!0}else{if(ne.name==="is")return!0;ne.name==="bind"&&Bd(ne.arg,"is")}}}function Y0(g,b){const D=[],L=new Set;for(;g.source.length>0&&!ka(g.source,">")&&!ka(g.source,"/>");){if(ka(g.source,"/")){zs(g,22),Zo(g,1),Op(g);continue}b===1&&zs(g,3);const Y=Vm(g,L);Y.type===6&&Y.value&&Y.name==="class"&&(Y.value.content=Y.value.content.replace(/\s+/g," ").trim()),b===0&&D.push(Y),/^[^\t\r\n\f />]/.test(g.source)&&zs(g,15),Op(g)}return D}function Vm(g,b){const D=Oc(g),Y=/^[^\t\r\n\f />][^\t\r\n\f />=]*/.exec(g.source)[0];b.has(Y)&&zs(g,2),b.add(Y),Y[0]==="="&&zs(g,19);{const Me=/["'<]/g;let De;for(;De=Me.exec(Y);)zs(g,17,De.index)}Zo(g,Y.length);let ne;/^[\t\r\n\f ]*=/.test(g.source)&&(Op(g),Zo(g,1),Op(g),ne=p_(g),ne||zs(g,13));const be=su(g,D);if(!g.inVPre&&/^(v-[A-Za-z0-9-]|:|\.|@|#)/.test(Y)){const Me=/(?:^v-([a-z0-9-]+))?(?:(?::|^\.|^@|^#)(\[[^\]]+\]|[^\.]+))?(.+)?$/i.exec(Y);let De=ka(Y,"."),je=Me[1]||(De||ka(Y,":")?"bind":ka(Y,"@")?"on":"slot"),st;if(Me[2]){const ot=je==="slot",Vt=Y.lastIndexOf(Me[2]),Jt=su(g,qv(g,D,Vt),qv(g,D,Vt+Me[2].length+(ot&&Me[3]||"").length));let en=Me[2],Yt=!0;en.startsWith("[")?(Yt=!1,en.endsWith("]")?en=en.slice(1,en.length-1):(zs(g,27),en=en.slice(1))):ot&&(en+=Me[3]||""),st={type:4,content:en,isStatic:Yt,constType:Yt?3:0,loc:Jt}}if(ne&&ne.isQuoted){const ot=ne.loc;ot.start.offset++,ot.start.column++,ot.end=Yh(ot.start,ne.content),ot.source=ot.source.slice(1,-1)}const nt=Me[3]?Me[3].slice(1).split("."):[];return De&&nt.push("prop"),{type:7,name:je,exp:ne&&{type:4,content:ne.content,isStatic:!1,constType:0,loc:ne.loc},arg:st,modifiers:nt,loc:be}}return!g.inVPre&&ka(Y,"v-")&&zs(g,26),{type:6,name:Y,value:ne&&{type:2,content:ne.content,loc:ne.loc},loc:be}}function p_(g){const b=Oc(g);let D;const L=g.source[0],Y=L==='"'||L==="'";if(Y){Zo(g,1);const ne=g.source.indexOf(L);ne===-1?D=f_(g,g.source.length,4):(D=f_(g,ne,4),Zo(g,1))}else{const ne=/^[^\t\r\n\f >]+/.exec(g.source);if(!ne)return;const be=/["'<=`]/g;let Me;for(;Me=be.exec(ne[0]);)zs(g,18,Me.index);D=f_(g,ne[0].length,4)}return{content:D,isQuoted:Y,loc:su(g,b)}}function AA(g,b){const[D,L]=g.options.delimiters,Y=g.source.indexOf(L,D.length);if(Y===-1){zs(g,25);return}const ne=Oc(g);Zo(g,D.length);const be=Oc(g),Me=Oc(g),De=Y-D.length,je=g.source.slice(0,De),st=f_(g,De,b),nt=st.trim(),ot=st.indexOf(nt);ot>0&&tu(be,je,ot);const Vt=De-(st.length-nt.length-ot);return tu(Me,je,Vt),Zo(g,L.length),{type:5,content:{type:4,isStatic:!1,constType:0,content:nt,loc:su(g,be,Me)},loc:su(g,ne)}}function Nu(g,b){const D=b===3?["]]>"]:["<",g.options.delimiters[0]];let L=g.source.length;for(let be=0;be<D.length;be++){const Me=g.source.indexOf(D[be],1);Me!==-1&&L>Me&&(L=Me)}const Y=Oc(g);return{type:2,content:f_(g,L,b),loc:su(g,Y)}}function f_(g,b,D){const L=g.source.slice(0,b);return Zo(g,b),D===2||D===3||!L.includes("&")?L:g.options.decodeEntities(L,D===4)}function Oc(g){const{column:b,line:D,offset:L}=g;return{column:b,line:D,offset:L}}function su(g,b,D){return D=D||Oc(g),{start:b,end:D,source:g.originalSource.slice(b.offset,D.offset)}}function zl(g){return g[g.length-1]}function ka(g,b){return g.startsWith(b)}function Zo(g,b){const{source:D}=g;tu(g,D,b),g.source=D.slice(b)}function Op(g){const b=/^[\t\r\n\f ]+/.exec(g.source);b&&Zo(g,b[0].length)}function qv(g,b,D){return Yh(b,g.originalSource.slice(b.offset,D),D)}function zs(g,b,D,L=Oc(g)){D&&(L.offset+=D,L.column+=D),g.options.onError(Os(b,{start:L,end:L,source:""}))}function Gm(g,b,D){const L=g.source;switch(b){case 0:if(ka(L,"</")){for(let Y=D.length-1;Y>=0;--Y)if(Al(L,D[Y].tag))return!0}break;case 1:case 2:{const Y=zl(D);if(Y&&Al(L,Y.tag))return!0;break}case 3:if(ka(L,"]]>"))return!0;break}return!L}function Al(g,b){return ka(g,"</")&&g.slice(2,2+b.length).toLowerCase()===b.toLowerCase()&&/[\t\r\n\f />]/.test(g[2+b.length]||">")}function bA(g,b){ou(g,b,m_(g,g.children[0]))}function m_(g,b){const{children:D}=g;return D.length===1&&b.type===1&&!$h(b)}function ou(g,b,D=!1){const{children:L}=g,Y=L.length;let ne=0;for(let be=0;be<L.length;be++){const Me=L[be];if(Me.type===1&&Me.tagType===0){const De=D?0:Bc(Me,b);if(De>0){if(De>=2){Me.codegenNode.patchFlag="-1 /* HOISTED */",Me.codegenNode=b.hoist(Me.codegenNode),ne++;continue}}else{const je=Me.codegenNode;if(je.type===13){const st=Kv(je);if((!st||st===512||st===1)&&K0(Me,b)>=2){const nt=Yv(Me);nt&&(je.props=b.hoist(nt))}je.dynamicProps&&(je.dynamicProps=b.hoist(je.dynamicProps))}}}else Me.type===12&&Bc(Me.content,b)>=2&&(Me.codegenNode=b.hoist(Me.codegenNode),ne++);if(Me.type===1){const De=Me.tagType===1;De&&b.scopes.vSlot++,ou(Me,b),De&&b.scopes.vSlot--}else if(Me.type===11)ou(Me,b,Me.children.length===1);else if(Me.type===9)for(let De=0;De<Me.branches.length;De++)ou(Me.branches[De],b,Me.branches[De].children.length===1)}ne&&b.transformHoist&&b.transformHoist(L,b,g),ne&&ne===Y&&g.type===1&&g.tagType===0&&g.codegenNode&&g.codegenNode.type===13&&Nt(g.codegenNode.children)&&(g.codegenNode.children=b.hoist(Dd(g.codegenNode.children)))}function Bc(g,b){const{constantCache:D}=b;switch(g.type){case 1:if(g.tagType!==0)return 0;const L=D.get(g);if(L!==void 0)return L;const Y=g.codegenNode;if(Y.type!==13||Y.isBlock&&g.tag!=="svg"&&g.tag!=="foreignObject")return 0;if(Kv(Y))return D.set(g,0),0;{let Me=3;const De=K0(g,b);if(De===0)return D.set(g,0),0;De<Me&&(Me=De);for(let je=0;je<g.children.length;je++){const st=Bc(g.children[je],b);if(st===0)return D.set(g,0),0;st<Me&&(Me=st)}if(Me>1)for(let je=0;je<g.props.length;je++){const st=g.props[je];if(st.type===7&&st.name==="bind"&&st.exp){const nt=Bc(st.exp,b);if(nt===0)return D.set(g,0),0;nt<Me&&(Me=nt)}}return Y.isBlock&&(b.removeHelper(Iu),b.removeHelper(iu(b.inSSR,Y.isComponent)),Y.isBlock=!1,b.helper(Co(b.inSSR,Y.isComponent))),D.set(g,Me),Me}case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return Bc(g.content,b);case 4:return g.constType;case 8:let be=3;for(let Me=0;Me<g.children.length;Me++){const De=g.children[Me];if(sn(De)||bn(De))continue;const je=Bc(De,b);if(je===0)return 0;je<be&&(be=je)}return be;default:return 0}}const Hm=new Set([Q0,no,Rp,qh]);function Xv(g,b){if(g.type===14&&!sn(g.callee)&&Hm.has(g.callee)){const D=g.arguments[0];if(D.type===4)return Bc(D,b);if(D.type===14)return Xv(D,b)}return 0}function K0(g,b){let D=3;const L=Yv(g);if(L&&L.type===15){const{properties:Y}=L;for(let ne=0;ne<Y.length;ne++){const{key:be,value:Me}=Y[ne],De=Bc(be,b);if(De===0)return De;De<D&&(D=De);let je;if(Me.type===4?je=Bc(Me,b):Me.type===14?je=Xv(Me,b):je=0,je===0)return je;je<D&&(D=je)}}return D}function Yv(g){const b=g.codegenNode;if(b.type===13)return b.props}function Kv(g){const b=g.patchFlag;return b?parseInt(b,10):void 0}function $v(g,{filename:b="",prefixIdentifiers:D=!1,hoistStatic:L=!1,cacheHandlers:Y=!1,nodeTransforms:ne=[],directiveTransforms:be={},transformHoist:Me=null,isBuiltInComponent:De=Ce,isCustomElement:je=Ce,expressionPlugins:st=[],scopeId:nt=null,slotted:ot=!0,ssr:Vt=!1,inSSR:Jt=!1,ssrCssVars:en="",bindingMetadata:Yt=he,inline:ln=!1,isTS:et=!1,onError:$e=Id,onWarn:Gt=Ru,compatConfig:Ut}){const yt=b.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),wt={selfName:yt&&fe(In(yt[1])),prefixIdentifiers:D,hoistStatic:L,cacheHandlers:Y,nodeTransforms:ne,directiveTransforms:be,transformHoist:Me,isBuiltInComponent:De,isCustomElement:je,expressionPlugins:st,scopeId:nt,slotted:ot,ssr:Vt,inSSR:Jt,ssrCssVars:en,bindingMetadata:Yt,inline:ln,isTS:et,onError:$e,onWarn:Gt,compatConfig:Ut,root:g,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],constantCache:new Map,temps:0,cached:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,currentNode:g,childIndex:0,inVOnce:!1,helper(qe){const Ct=wt.helpers.get(qe)||0;return wt.helpers.set(qe,Ct+1),qe},removeHelper(qe){const Ct=wt.helpers.get(qe);if(Ct){const Dt=Ct-1;Dt?wt.helpers.set(qe,Dt):wt.helpers.delete(qe)}},helperString(qe){return`_${Pu[wt.helper(qe)]}`},replaceNode(qe){{if(!wt.currentNode)throw new Error("Node being replaced is already removed.");if(!wt.parent)throw new Error("Cannot replace root node.")}wt.parent.children[wt.childIndex]=wt.currentNode=qe},removeNode(qe){if(!wt.parent)throw new Error("Cannot remove root node.");const Ct=wt.parent.children,Dt=qe?Ct.indexOf(qe):wt.currentNode?wt.childIndex:-1;if(Dt<0)throw new Error("node being removed is not a child of current parent");!qe||qe===wt.currentNode?(wt.currentNode=null,wt.onNodeRemoved()):wt.childIndex>Dt&&(wt.childIndex--,wt.onNodeRemoved()),wt.parent.children.splice(Dt,1)},onNodeRemoved:()=>{},addIdentifiers(qe){},removeIdentifiers(qe){},hoist(qe){sn(qe)&&(qe=Yr(qe)),wt.hoists.push(qe);const Ct=Yr(`_hoisted_${wt.hoists.length}`,!1,qe.loc,2);return Ct.hoisted=qe,Ct},cache(qe,Ct=!1){return If(wt.cached++,qe,Ct)}};return wt}function ah(g,b){const D=$v(g,b);g_(g,D),b.hoistStatic&&bA(g,D),b.ssr||Bp(g,D),g.helpers=[...D.helpers.keys()],g.components=[...D.components],g.directives=[...D.directives],g.imports=D.imports,g.hoists=D.hoists,g.temps=D.temps,g.cached=D.cached}function Bp(g,b){const{helper:D}=b,{children:L}=g;if(L.length===1){const Y=L[0];if(m_(g,Y)&&Y.codegenNode){const ne=Y.codegenNode;ne.type===13&&yl(ne,b),g.codegenNode=ne}else g.codegenNode=Y}else if(L.length>1){let Y=64,ne=s[64];L.filter(be=>be.type!==3).length===1&&(Y|=2048,ne+=`, ${s[2048]}`),g.codegenNode=oh(b,D($l),void 0,g.children,Y+` /* ${ne} */`,void 0,void 0,!0,void 0,!1)}}function $0(g,b){let D=0;const L=()=>{D--};for(;D<g.children.length;D++){const Y=g.children[D];sn(Y)||(b.parent=g,b.childIndex=D,b.onNodeRemoved=L,g_(Y,b))}}function g_(g,b){b.currentNode=g;const{nodeTransforms:D}=b,L=[];for(let ne=0;ne<D.length;ne++){const be=D[ne](g,b);if(be&&(Nt(be)?L.push(...be):L.push(be)),b.currentNode)g=b.currentNode;else return}switch(g.type){case 3:b.ssr||b.helper(Sf);break;case 5:b.ssr||b.helper(c_);break;case 9:for(let ne=0;ne<g.branches.length;ne++)g_(g.branches[ne],b);break;case 10:case 11:case 1:case 0:$0(g,b);break}b.currentNode=g;let Y=L.length;for(;Y--;)L[Y]()}function __(g,b){const D=sn(g)?L=>L===g:L=>g.test(L);return(L,Y)=>{if(L.type===1){const{props:ne}=L;if(L.tagType===3&&ne.some(nu))return;const be=[];for(let Me=0;Me<ne.length;Me++){const De=ne[Me];if(De.type===7&&D(De.name)){ne.splice(Me,1),Me--;const je=b(L,De,Y);je&&be.push(je)}}return be}}}const nc="/*#__PURE__*/";function xA(g,{mode:b="function",prefixIdentifiers:D=b==="module",sourceMap:L=!1,filename:Y="template.vue.html",scopeId:ne=null,optimizeImports:be=!1,runtimeGlobalName:Me="Vue",runtimeModuleName:De="vue",ssrRuntimeModuleName:je="vue/server-renderer",ssr:st=!1,isTS:nt=!1,inSSR:ot=!1}){const Vt={mode:b,prefixIdentifiers:D,sourceMap:L,filename:Y,scopeId:ne,optimizeImports:be,runtimeGlobalName:Me,runtimeModuleName:De,ssrRuntimeModuleName:je,ssr:st,isTS:nt,inSSR:ot,source:g.loc.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(en){return`_${Pu[en]}`},push(en,Yt){Vt.code+=en},indent(){Jt(++Vt.indentLevel)},deindent(en=!1){en?--Vt.indentLevel:Jt(--Vt.indentLevel)},newline(){Jt(Vt.indentLevel)}};function Jt(en){Vt.push(`
`+"  ".repeat(en))}return Vt}function Ib(g,b={}){const D=xA(g,b);b.onContextCreated&&b.onContextCreated(D);const{mode:L,push:Y,prefixIdentifiers:ne,indent:be,deindent:Me,newline:De,scopeId:je,ssr:st}=D,nt=g.helpers.length>0,ot=!ne&&L!=="module";ku(g,D);const Jt=st?"ssrRender":"render",Yt=(st?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(Y(`function ${Jt}(${Yt}) {`),be(),ot&&(Y("with (_ctx) {"),be(),nt&&(Y(`const { ${g.helpers.map(ln=>`${Pu[ln]}: _${Pu[ln]}`).join(", ")} } = _Vue`),Y(`
`),De())),g.components.length&&(wA(g.components,"component",D),(g.directives.length||g.temps>0)&&De()),g.directives.length&&(wA(g.directives,"directive",D),g.temps>0&&De()),g.temps>0){Y("let ");for(let ln=0;ln<g.temps;ln++)Y(`${ln>0?", ":""}_temp${ln}`)}return(g.components.length||g.directives.length||g.temps)&&(Y(`
`),De()),st||Y("return "),g.codegenNode?io(g.codegenNode,D):Y("null"),ot&&(Me(),Y("}")),Me(),Y("}"),{ast:g,code:D.code,preamble:"",map:D.map?D.map.toJSON():void 0}}function ku(g,b){const{ssr:D,prefixIdentifiers:L,push:Y,newline:ne,runtimeModuleName:be,runtimeGlobalName:Me,ssrRuntimeModuleName:De}=b,je=Me,st=nt=>`${Pu[nt]}: _${Pu[nt]}`;if(g.helpers.length>0&&(Y(`const _Vue = ${je}
`),g.hoists.length)){const nt=[o_,Wh,Sf,Qh,Pm].filter(ot=>g.helpers.includes(ot)).map(st).join(", ");Y(`const { ${nt} } = _Vue
`)}Df(g.hoists,b),ne(),Y("return ")}function wA(g,b,{helper:D,push:L,newline:Y,isTS:ne}){const be=D(b==="component"?Uv:a_);for(let Me=0;Me<g.length;Me++){let De=g[Me];const je=De.endsWith("__self");je&&(De=De.slice(0,-6)),L(`const ${Fl(De,b)} = ${be}(${JSON.stringify(De)}${je?", true":""})${ne?"!":""}`),Me<g.length-1&&Y()}}function Df(g,b){if(!g.length)return;b.pure=!0;const{push:D,newline:L,helper:Y,scopeId:ne,mode:be}=b;L();for(let Me=0;Me<g.length;Me++){const De=g[Me];De&&(D(`const _hoisted_${Me+1} = `),io(De,b),L())}b.pure=!1}function Of(g){return sn(g)||g.type===4||g.type===2||g.type===5||g.type===8}function kd(g,b){const D=g.length>3||g.some(L=>Nt(L)||!Of(L));b.push("["),D&&b.indent(),v_(g,b,D),D&&b.deindent(),b.push("]")}function v_(g,b,D=!1,L=!0){const{push:Y,newline:ne}=b;for(let be=0;be<g.length;be++){const Me=g[be];sn(Me)?Y(Me):Nt(Me)?kd(Me,b):io(Me,b),be<g.length-1&&(D?(L&&Y(","),ne()):L&&Y(", "))}}function io(g,b){if(sn(g)){b.push(g);return}if(bn(g)){b.push(b.helper(g));return}switch(g.type){case 1:case 9:case 11:Zl(g.codegenNode!=null,"Codegen node is missing for element/if/for node. Apply appropriate transforms first."),io(g.codegenNode,b);break;case 2:Pb(g,b);break;case 4:Bf(g,b);break;case 5:y_(g,b);break;case 12:io(g.codegenNode,b);break;case 8:Lp(g,b);break;case 3:A_(g,b);break;case 13:Lf(g,b);break;case 14:b_(g,b);break;case 15:ms(g,b);break;case 17:Jv(g,b);break;case 18:Wm(g,b);break;case 19:Z0(g,b);break;case 20:ey(g,b);break;case 21:v_(g.body,b,!0,!1);break;case 22:break;case 23:break;case 24:break;case 25:break;case 26:break;case 10:break;default:return Zl(!1,`unhandled codegen node type: ${g.type}`),g}}function Pb(g,b){b.push(JSON.stringify(g.content),g)}function Bf(g,b){const{content:D,isStatic:L}=g;b.push(L?JSON.stringify(D):D,g)}function y_(g,b){const{push:D,helper:L,pure:Y}=b;Y&&D(nc),D(`${L(c_)}(`),io(g.content,b),D(")")}function Lp(g,b){for(let D=0;D<g.children.length;D++){const L=g.children[D];sn(L)?b.push(L):io(L,b)}}function J0(g,b){const{push:D}=b;if(g.type===8)D("["),Lp(g,b),D("]");else if(g.isStatic){const L=Pp(g.content)?g.content:JSON.stringify(g.content);D(L,g)}else D(`[${g.content}]`,g)}function A_(g,b){const{push:D,helper:L,pure:Y}=b;Y&&D(nc),D(`${L(Sf)}(${JSON.stringify(g.content)})`,g)}function Lf(g,b){const{push:D,helper:L,pure:Y}=b,{tag:ne,props:be,children:Me,patchFlag:De,dynamicProps:je,directives:st,isBlock:nt,disableTracking:ot,isComponent:Vt}=g;st&&D(L(l_)+"("),nt&&D(`(${L(Iu)}(${ot?"true":""}), `),Y&&D(nc);const Jt=nt?iu(b.inSSR,Vt):Co(b.inSSR,Vt);D(L(Jt)+"(",g),v_(Db([ne,be,Me,De,je]),b),D(")"),nt&&D(")"),st&&(D(", "),io(st,b),D(")"))}function Db(g){let b=g.length;for(;b--&&g[b]==null;);return g.slice(0,b+1).map(D=>D||"null")}function b_(g,b){const{push:D,helper:L,pure:Y}=b,ne=sn(g.callee)?g.callee:L(g.callee);Y&&D(nc),D(ne+"(",g),v_(g.arguments,b),D(")")}function ms(g,b){const{push:D,indent:L,deindent:Y,newline:ne}=b,{properties:be}=g;if(!be.length){D("{}",g);return}const Me=be.length>1||be.some(De=>De.value.type!==4);D(Me?"{":"{ "),Me&&L();for(let De=0;De<be.length;De++){const{key:je,value:st}=be[De];J0(je,b),D(": "),io(st,b),De<be.length-1&&(D(","),ne())}Me&&Y(),D(Me?"}":" }")}function Jv(g,b){kd(g.elements,b)}function Wm(g,b){const{push:D,indent:L,deindent:Y}=b,{params:ne,returns:be,body:Me,newline:De,isSlot:je}=g;je&&D(`_${Pu[Ic]}(`),D("(",g),Nt(ne)?v_(ne,b):ne&&io(ne,b),D(") => "),(De||Me)&&(D("{"),L()),be?(De&&D("return "),Nt(be)?kd(be,b):io(be,b)):Me&&io(Me,b),(De||Me)&&(Y(),D("}")),je&&D(")")}function Z0(g,b){const{test:D,consequent:L,alternate:Y,newline:ne}=g,{push:be,indent:Me,deindent:De,newline:je}=b;if(D.type===4){const nt=!Pp(D.content);nt&&be("("),Bf(D,b),nt&&be(")")}else be("("),io(D,b),be(")");ne&&Me(),b.indentLevel++,ne||be(" "),be("? "),io(L,b),b.indentLevel--,ne&&je(),ne||be(" "),be(": ");const st=Y.type===19;st||b.indentLevel++,io(Y,b),st||b.indentLevel--,ne&&De(!0)}function ey(g,b){const{push:D,helper:L,indent:Y,deindent:ne,newline:be}=b;D(`_cache[${g.index}] || (`),g.isVNode&&(Y(),D(`${L(Om)}(-1),`),be()),D(`_cache[${g.index}] = `),io(g.value,b),g.isVNode&&(D(","),be(),D(`${L(Om)}(1),`),be(),D(`_cache[${g.index}]`),ne()),D(")")}const Ud=new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments,typeof,void".split(",").join("\\b|\\b")+"\\b"),Ob=/'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\]|\\.)*`|`(?:[^`\\]|\\.)*`/g;function Lc(g,b,D=!1,L=!1){const Y=g.content;if(Y.trim())try{new Function(L?` ${Y} `:`return ${D?`(${Y}) => {}`:`(${Y})`}`)}catch(ne){let be=ne.message;const Me=Y.replace(Ob,"").match(Ud);Me&&(be=`avoid using JavaScript keyword as property name: "${Me[0]}"`),b.onError(Os(44,g.loc,void 0,be))}}const Fd=(g,b)=>{if(g.type===5)g.content=Zv(g.content,b);else if(g.type===1)for(let D=0;D<g.props.length;D++){const L=g.props[D];if(L.type===7&&L.name!=="for"){const Y=L.exp,ne=L.arg;Y&&Y.type===4&&!(L.name==="on"&&ne)&&(L.exp=Zv(Y,b,L.name==="slot")),ne&&ne.type===4&&!ne.isStatic&&(L.arg=Zv(ne,b))}}};function Zv(g,b,D=!1,L=!1,Y=Object.create(b.identifiers)){return Lc(g,b,D,L),g}const Bb=__(/^(if|else|else-if)$/,(g,b,D)=>EA(g,b,D,(L,Y,ne)=>{const be=D.parent.children;let Me=be.indexOf(L),De=0;for(;Me-->=0;){const je=be[Me];je&&je.type===9&&(De+=je.branches.length)}return()=>{if(ne)L.codegenNode=SA(Y,De,D);else{const je=TA(L.codegenNode);je.alternate=SA(Y,De+L.branches.length-1,D)}}}));function EA(g,b,D,L){if(b.name!=="else"&&(!b.exp||!b.exp.content.trim())){const Y=b.exp?b.exp.loc:g.loc;D.onError(Os(28,b.loc)),b.exp=Yr("true",!1,Y)}if(b.exp&&Lc(b.exp,D),b.name==="if"){const Y=e0(g,b),ne={type:9,loc:g.loc,branches:[Y]};if(D.replaceNode(ne),L)return L(ne,Y,!0)}else{const Y=D.parent.children,ne=[];let be=Y.indexOf(g);for(;be-->=-1;){const Me=Y[be];if(Me&&Me.type===3){D.removeNode(Me),ne.unshift(Me);continue}if(Me&&Me.type===2&&!Me.content.trim().length){D.removeNode(Me);continue}if(Me&&Me.type===9){b.name==="else-if"&&Me.branches[Me.branches.length-1].condition===void 0&&D.onError(Os(30,g.loc)),D.removeNode();const De=e0(g,b);ne.length&&!(D.parent&&D.parent.type===1&&Jo(D.parent.tag,"transition"))&&(De.children=[...ne,...De.children]);{const st=De.userKey;st&&Me.branches.forEach(({userKey:nt})=>{ty(nt,st)&&D.onError(Os(29,De.userKey.loc))})}Me.branches.push(De);const je=L&&L(Me,De,!1);g_(De,D),je&&je(),D.currentNode=null}else D.onError(Os(30,g.loc));break}}}function e0(g,b){return{type:10,loc:g.loc,condition:b.name==="else"?void 0:b.exp,children:g.tagType===3&&!vl(g,"for")?g.children:[g],userKey:Kh(g,"key")}}function SA(g,b,D){return g.condition?Nm(g.condition,MA(g,b,D),Ho(D.helper(Sf),['"v-if"',"true"])):MA(g,b,D)}function MA(g,b,D){const{helper:L}=D,Y=_o("key",Yr(`${b}`,!1,Za,2)),{children:ne}=g,be=ne[0];if(ne.length!==1||be.type!==1)if(ne.length===1&&be.type===11){const De=be.codegenNode;return ec(De,Y,D),De}else{let De=64,je=s[64];return ne.filter(st=>st.type!==3).length===1&&(De|=2048,je+=`, ${s[2048]}`),oh(D,L($l),_l([Y]),ne,De+` /* ${je} */`,void 0,void 0,!0,!1,!1,g.loc)}else{const De=be.codegenNode,je=Jh(De);return je.type===13&&yl(je,D),ec(je,Y,D),De}}function ty(g,b){if(!g||g.type!==b.type)return!1;if(g.type===6){if(g.value.content!==b.value.content)return!1}else{const D=g.exp,L=b.exp;if(D.type!==L.type||D.type!==4||D.isStatic!==L.isStatic||D.content!==L.content)return!1}return!0}function TA(g){for(;;)if(g.type===19)if(g.alternate.type===19)g=g.alternate;else return g;else g.type===20&&(g=g.value)}const t0=__("for",(g,b,D)=>{const{helper:L,removeHelper:Y}=D;return x_(g,b,D,ne=>{const be=Ho(L(zv),[ne.source]),Me=Pc(g),De=vl(g,"memo"),je=Kh(g,"key"),st=je&&(je.type===6?Yr(je.value.content,!0):je.exp),nt=je?_o("key",st):null,ot=ne.source.type===4&&ne.source.constType>0,Vt=ot?64:je?128:256;return ne.codegenNode=oh(D,L($l),void 0,be,Vt+` /* ${s[Vt]} */`,void 0,void 0,!0,!ot,!1,g.loc),()=>{let Jt;const{children:en}=ne;Me&&g.children.some(et=>{if(et.type===1){const $e=Kh(et,"key");if($e)return D.onError(Os(33,$e.loc)),!0}});const Yt=en.length!==1||en[0].type!==1,ln=$h(g)?g:Me&&g.children.length===1&&$h(g.children[0])?g.children[0]:null;if(ln?(Jt=ln.codegenNode,Me&&nt&&ec(Jt,nt,D)):Yt?Jt=oh(D,L($l),nt?_l([nt]):void 0,g.children,`64 /* ${s[64]} */`,void 0,void 0,!0,void 0,!1):(Jt=en[0].codegenNode,Me&&nt&&ec(Jt,nt,D),Jt.isBlock!==!ot&&(Jt.isBlock?(Y(Iu),Y(iu(D.inSSR,Jt.isComponent))):Y(Co(D.inSSR,Jt.isComponent))),Jt.isBlock=!ot,Jt.isBlock?(L(Iu),L(iu(D.inSSR,Jt.isComponent))):L(Co(D.inSSR,Jt.isComponent))),De){const et=Ip(kp(ne.parseResult,[Yr("_cached")]));et.body=To([Ul(["const _memo = (",De.exp,")"]),Ul(["if (_cached",...st?[" && _cached.key === ",st]:[],` && ${D.helperString(gA)}(_cached, _memo)) return _cached`]),Ul(["const _item = ",Jt]),Yr("_item.memo = _memo"),Yr("return _item")]),be.arguments.push(et,Yr("_cache"),Yr(String(D.cached++)))}else be.arguments.push(Ip(kp(ne.parseResult),Jt,!0))}})});function x_(g,b,D,L){if(!b.exp){D.onError(Os(31,b.loc));return}const Y=zd(b.exp,D);if(!Y){D.onError(Os(32,b.loc));return}const{addIdentifiers:ne,removeIdentifiers:be,scopes:Me}=D,{source:De,value:je,key:st,index:nt}=Y,ot={type:11,loc:b.loc,source:De,valueAlias:je,keyAlias:st,objectIndexAlias:nt,parseResult:Y,children:Pc(g)?g.children:[g]};D.replaceNode(ot),Me.vFor++;const Vt=L&&L(ot);return()=>{Me.vFor--,Vt&&Vt()}}const CA=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,Nc=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n0=/^\(|\)$/g;function zd(g,b){const D=g.loc,L=g.content,Y=L.match(CA);if(!Y)return;const[,ne,be]=Y,Me={source:Np(D,be.trim(),L.indexOf(be,ne.length)),value:void 0,key:void 0,index:void 0};Lc(Me.source,b);let De=ne.trim().replace(n0,"").trim();const je=ne.indexOf(De),st=De.match(Nc);if(st){De=De.replace(Nc,"").trim();const nt=st[1].trim();let ot;if(nt&&(ot=L.indexOf(nt,je+De.length),Me.key=Np(D,nt,ot),Lc(Me.key,b,!0)),st[2]){const Vt=st[2].trim();Vt&&(Me.index=Np(D,Vt,L.indexOf(Vt,Me.key?ot+nt.length:je+De.length)),Lc(Me.index,b,!0))}}return De&&(Me.value=Np(D,De,je),Lc(Me.value,b,!0)),Me}function Np(g,b,D){return Yr(b,!1,Od(g,D,b.length))}function kp({value:g,key:b,index:D},L=[]){return RA([g,b,D,...L])}function RA(g){let b=g.length;for(;b--&&!g[b];);return g.slice(0,b+1).map((D,L)=>D||Yr("_".repeat(L+1),!1))}const bl=Yr("undefined",!1),ic=(g,b)=>{if(g.type===1&&(g.tagType===1||g.tagType===3)){const D=vl(g,"slot");if(D)return D.exp,b.scopes.vSlot++,()=>{b.scopes.vSlot--}}},w_=(g,b,D)=>Ip(g,b,!1,!0,b.length?b[0].loc:D);function E_(g,b,D=w_){b.helper(Ic);const{children:L,loc:Y}=g,ne=[],be=[];let Me=b.scopes.vSlot>0||b.scopes.vFor>0;const De=vl(g,"slot",!0);if(De){const{arg:en,exp:Yt}=De;en&&!Jl(en)&&(Me=!0),ne.push(_o(en||Yr("default",!0),D(Yt,L,Y)))}let je=!1,st=!1;const nt=[],ot=new Set;for(let en=0;en<L.length;en++){const Yt=L[en];let ln;if(!Pc(Yt)||!(ln=vl(Yt,"slot",!0))){Yt.type!==3&&nt.push(Yt);continue}if(De){b.onError(Os(37,ln.loc));break}je=!0;const{children:et,loc:$e}=Yt,{arg:Gt=Yr("default",!0),exp:Ut,loc:yt}=ln;let wt;Jl(Gt)?wt=Gt?Gt.content:"default":Me=!0;const qe=D(Ut,et,$e);let Ct,Dt,hn;if(Ct=vl(Yt,"if"))Me=!0,be.push(Nm(Ct.exp,Up(Gt,qe),bl));else if(Dt=vl(Yt,/^else(-if)?$/,!0)){let Kt=en,yn;for(;Kt--&&(yn=L[Kt],yn.type===3););if(yn&&Pc(yn)&&vl(yn,"if")){L.splice(en,1),en--;let ii=be[be.length-1];for(;ii.alternate.type===19;)ii=ii.alternate;ii.alternate=Dt.exp?Nm(Dt.exp,Up(Gt,qe),bl):Up(Gt,qe)}else b.onError(Os(30,Dt.loc))}else if(hn=vl(Yt,"for")){Me=!0;const Kt=hn.parseResult||zd(hn.exp,b);Kt?be.push(Ho(b.helper(zv),[Kt.source,Ip(kp(Kt),Up(Gt,qe),!0)])):b.onError(Os(32,hn.loc))}else{if(wt){if(ot.has(wt)){b.onError(Os(38,yt));continue}ot.add(wt),wt==="default"&&(st=!0)}ne.push(_o(Gt,qe))}}if(!De){const en=(Yt,ln)=>{const et=D(Yt,ln,Y);return _o("default",et)};je?nt.length&&nt.some(Yt=>ny(Yt))&&(st?b.onError(Os(39,nt[0].loc)):ne.push(en(void 0,nt))):ne.push(en(void 0,L))}const Vt=Me?2:Qm(g.children)?3:1;let Jt=_l(ne.concat(_o("_",Yr(Vt+` /* ${v[Vt]} */`,!1))),Y);return be.length&&(Jt=Ho(b.helper(jv),[Jt,Dd(be)])),{slots:Jt,hasDynamicSlots:Me}}function Up(g,b){return _l([_o("name",g),_o("fn",b)])}function Qm(g){for(let b=0;b<g.length;b++){const D=g[b];switch(D.type){case 1:if(D.tagType===2||Qm(D.children))return!0;break;case 9:if(Qm(D.branches))return!0;break;case 10:case 11:if(Qm(D.children))return!0;break}}return!1}function ny(g){return g.type!==2&&g.type!==12?!0:g.type===2?!!g.content.trim():ny(g.content)}const iy=new WeakMap,ry=(g,b)=>function(){if(g=b.currentNode,!(g.type===1&&(g.tagType===0||g.tagType===1)))return;const{tag:L,props:Y}=g,ne=g.tagType===1;let be=ne?qm(g,b):`"${L}"`;const Me=Un(be)&&be.callee===Fv;let De,je,st,nt=0,ot,Vt,Jt,en=Me||be===Rc||be===rh||!ne&&(L==="svg"||L==="foreignObject");if(Y.length>0){const Yt=i0(g,b);De=Yt.props,nt=Yt.patchFlag,Vt=Yt.dynamicPropNames;const ln=Yt.directives;Jt=ln&&ln.length?Dd(ln.map(et=>Ro(et,b))):void 0,Yt.shouldUseBlock&&(en=!0)}if(g.children.length>0)if(be===Cp&&(en=!0,nt|=1024,g.children.length>1&&b.onError(Os(45,{start:g.children[0].loc.start,end:g.children[g.children.length-1].loc.end,source:""}))),ne&&be!==Rc&&be!==Cp){const{slots:ln,hasDynamicSlots:et}=E_(g,b);je=ln,et&&(nt|=1024)}else if(g.children.length===1&&be!==Rc){const ln=g.children[0],et=ln.type,$e=et===5||et===8;$e&&Bc(ln,b)===0&&(nt|=1),$e||et===2?je=ln:je=g.children}else je=g.children;if(nt!==0){if(nt<0)st=nt+` /* ${s[nt]} */`;else{const Yt=Object.keys(s).map(Number).filter(ln=>ln>0&&nt&ln).map(ln=>s[ln]).join(", ");st=nt+` /* ${Yt} */`}Vt&&Vt.length&&(ot=vo(Vt))}g.codegenNode=oh(b,be,De,je,st,ot,Jt,!!en,!1,ne,g.loc)};function qm(g,b,D=!1){let{tag:L}=g;const Y=Qs(L),ne=Kh(g,"is");if(ne)if(Y){const De=ne.type===6?ne.value&&Yr(ne.value.content,!0):ne.exp;if(De)return Ho(b.helper(Fv),[De])}else ne.type===6&&ne.value.content.startsWith("vue:")&&(L=ne.value.content.slice(4));const be=!Y&&vl(g,"is");if(be&&be.exp)return Ho(b.helper(Fv),[be.exp]);const Me=ks(L)||b.isBuiltInComponent(L);return Me?(D||b.helper(Me),Me):(b.helper(Uv),b.components.add(L),Fl(L,"component"))}function i0(g,b,D=g.props,L=!1){const{tag:Y,loc:ne,children:be}=g,Me=g.tagType===1;let De=[];const je=[],st=[],nt=be.length>0;let ot=!1,Vt=0,Jt=!1,en=!1,Yt=!1,ln=!1,et=!1,$e=!1;const Gt=[],Ut=({key:wt,value:qe})=>{if(Jl(wt)){const Ct=wt.content,Dt=Ye(Ct);if(!Me&&Dt&&Ct.toLowerCase()!=="onclick"&&Ct!=="onUpdate:modelValue"&&!Pn(Ct)&&(ln=!0),Dt&&Pn(Ct)&&($e=!0),qe.type===20||(qe.type===4||qe.type===8)&&Bc(qe,b)>0)return;Ct==="ref"?Jt=!0:Ct==="class"?en=!0:Ct==="style"?Yt=!0:Ct!=="key"&&!Gt.includes(Ct)&&Gt.push(Ct),Me&&(Ct==="class"||Ct==="style")&&!Gt.includes(Ct)&&Gt.push(Ct)}else et=!0};for(let wt=0;wt<D.length;wt++){const qe=D[wt];if(qe.type===6){const{loc:Ct,name:Dt,value:hn}=qe;let Kt=!0;if(Dt==="ref"&&(Jt=!0,b.scopes.vFor>0&&De.push(_o(Yr("ref_for",!0),Yr("true")))),Dt==="is"&&(Qs(Y)||hn&&hn.content.startsWith("vue:")))continue;De.push(_o(Yr(Dt,!0,Od(Ct,0,Dt.length)),Yr(hn?hn.content:"",Kt,hn?hn.loc:Ct)))}else{const{name:Ct,arg:Dt,exp:hn,loc:Kt}=qe,yn=Ct==="bind",ii=Ct==="on";if(Ct==="slot"){Me||b.onError(Os(40,Kt));continue}if(Ct==="once"||Ct==="memo"||Ct==="is"||yn&&Bd(Dt,"is")&&Qs(Y)||ii&&L)continue;if((yn&&Bd(Dt,"key")||ii&&nt&&Bd(Dt,"vue:before-update"))&&(ot=!0),yn&&Bd(Dt,"ref")&&b.scopes.vFor>0&&De.push(_o(Yr("ref_for",!0),Yr("true"))),!Dt&&(yn||ii)){et=!0,hn?(De.length&&(je.push(_l(sy(De),ne)),De=[]),yn?je.push(hn):je.push({type:14,loc:Kt,callee:b.helper(Mf),arguments:[hn]})):b.onError(Os(yn?34:35,Kt));continue}const Ui=b.directiveTransforms[Ct];if(Ui){const{props:Bi,needRuntime:ci}=Ui(qe,g,b);!L&&Bi.forEach(Ut),De.push(...Bi),ci&&(st.push(qe),bn(ci)&&iy.set(qe,ci))}else st.push(qe),nt&&(ot=!0)}}let yt;if(je.length?(De.length&&je.push(_l(sy(De),ne)),je.length>1?yt=Ho(b.helper(sh),je,ne):yt=je[0]):De.length&&(yt=_l(sy(De),ne)),et?Vt|=16:(en&&!Me&&(Vt|=2),Yt&&!Me&&(Vt|=4),Gt.length&&(Vt|=8),ln&&(Vt|=32)),!ot&&(Vt===0||Vt===32)&&(Jt||$e||st.length>0)&&(Vt|=512),!b.inSSR&&yt)switch(yt.type){case 15:let wt=-1,qe=-1,Ct=!1;for(let Kt=0;Kt<yt.properties.length;Kt++){const yn=yt.properties[Kt].key;Jl(yn)?yn.content==="class"?wt=Kt:yn.content==="style"&&(qe=Kt):yn.isHandlerKey||(Ct=!0)}const Dt=yt.properties[wt],hn=yt.properties[qe];Ct?yt=Ho(b.helper(Rp),[yt]):(Dt&&!Jl(Dt.value)&&(Dt.value=Ho(b.helper(Q0),[Dt.value])),hn&&!Jl(hn.value)&&(Yt||hn.value.type===17)&&(hn.value=Ho(b.helper(no),[hn.value])));break;case 14:break;default:yt=Ho(b.helper(Rp),[Ho(b.helper(qh),[yt])]);break}return{props:yt,directives:st,patchFlag:Vt,dynamicPropNames:Gt,shouldUseBlock:ot}}function sy(g){const b=new Map,D=[];for(let L=0;L<g.length;L++){const Y=g[L];if(Y.key.type===8||!Y.key.isStatic){D.push(Y);continue}const ne=Y.key.content,be=b.get(ne);be?(ne==="style"||ne==="class"||Ye(ne))&&S_(be,Y):(b.set(ne,Y),D.push(Y))}return D}function S_(g,b){g.value.type===17?g.value.elements.push(b.value):g.value=Dd([g.value,b.value],g.loc)}function Ro(g,b){const D=[],L=iy.get(g);L?D.push(b.helperString(L)):(b.helper(a_),b.directives.add(g.name),D.push(Fl(g.name,"directive")));const{loc:Y}=g;if(g.exp&&D.push(g.exp),g.arg&&(g.exp||D.push("void 0"),D.push(g.arg)),Object.keys(g.modifiers).length){g.arg||(g.exp||D.push("void 0"),D.push("void 0"));const ne=Yr("true",!1,Y);D.push(_l(g.modifiers.map(be=>_o(be,ne)),Y))}return Dd(D,g.loc)}function vo(g){let b="[";for(let D=0,L=g.length;D<L;D++)b+=JSON.stringify(g[D]),D<L-1&&(b+=", ");return b+"]"}function Qs(g){return g==="component"||g==="Component"}const au=(g,b)=>{if($h(g)){const{children:D,loc:L}=g,{slotName:Y,slotProps:ne}=Fp(g,b),be=[b.prefixIdentifiers?"_ctx.$slots":"$slots",Y,"{}","undefined","true"];let Me=2;ne&&(be[2]=ne,Me=3),D.length&&(be[3]=Ip([],D,!1,!1,L),Me=4),b.scopeId&&!b.slotted&&(Me=5),be.splice(Me),g.codegenNode=Ho(b.helper(W0),be,L)}};function Fp(g,b){let D='"default"',L;const Y=[];for(let ne=0;ne<g.props.length;ne++){const be=g.props[ne];be.type===6?be.value&&(be.name==="name"?D=JSON.stringify(be.value.content):(be.name=In(be.name),Y.push(be))):be.name==="bind"&&Bd(be.arg,"name")?be.exp&&(D=be.exp):(be.name==="bind"&&be.arg&&Jl(be.arg)&&(be.arg.content=In(be.arg.content)),Y.push(be))}if(Y.length>0){const{props:ne,directives:be}=i0(g,b,Y);L=ne,be.length&&b.onError(Os(36,be[0].loc))}return{slotName:D,slotProps:L}}const M_=/^\s*([\w$_]+|(async\s*)?\([^)]*?\))\s*=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,IA=(g,b,D,L)=>{const{loc:Y,modifiers:ne,arg:be}=g;!g.exp&&!ne.length&&D.onError(Os(35,Y));let Me;if(be.type===4)if(be.isStatic){let nt=be.content;nt.startsWith("vue:")&&(nt=`vnode-${nt.slice(4)}`),Me=Yr(Se(In(nt)),!0,be.loc)}else Me=Ul([`${D.helperString(Vv)}(`,be,")"]);else Me=be,Me.children.unshift(`${D.helperString(Vv)}(`),Me.children.push(")");let De=g.exp;De&&!De.content.trim()&&(De=void 0);let je=D.cacheHandlers&&!De&&!D.inVOnce;if(De){const nt=Pf(De.content),ot=!(nt||M_.test(De.content)),Vt=De.content.includes(";");Lc(De,D,!1,Vt),(ot||je&&nt)&&(De=Ul([`${ot?"$event":"(...args)"} => ${Vt?"{":"("}`,De,Vt?"}":")"]))}let st={props:[_o(Me,De||Yr("() => {}",!1,Y))]};return L&&(st=L(st)),je&&(st.props[0].value=D.cache(st.props[0].value)),st.props.forEach(nt=>nt.key.isHandlerKey=!0),st},PA=(g,b,D)=>{const{exp:L,modifiers:Y,loc:ne}=g,be=g.arg;return be.type!==4?(be.children.unshift("("),be.children.push(') || ""')):be.isStatic||(be.content=`${be.content} || ""`),Y.includes("camel")&&(be.type===4?be.isStatic?be.content=In(be.content):be.content=`${D.helperString(Tf)}(${be.content})`:(be.children.unshift(`${D.helperString(Tf)}(`),be.children.push(")"))),D.inSSR||(Y.includes("prop")&&T_(be,"."),Y.includes("attr")&&T_(be,"^")),!L||L.type===4&&!L.content.trim()?(D.onError(Os(34,ne)),{props:[_o(be,Yr("",!0,ne))]}):{props:[_o(be,L)]}},T_=(g,b)=>{g.type===4?g.isStatic?g.content=b+g.content:g.content=`\`${b}\${${g.content}}\``:(g.children.unshift(`'${b}' + (`),g.children.push(")"))},oy=(g,b)=>{if(g.type===0||g.type===1||g.type===11||g.type===10)return()=>{const D=g.children;let L,Y=!1;for(let ne=0;ne<D.length;ne++){const be=D[ne];if(ba(be)){Y=!0;for(let Me=ne+1;Me<D.length;Me++){const De=D[Me];if(ba(De))L||(L=D[ne]={type:8,loc:be.loc,children:[be]}),L.children.push(" + ",De),D.splice(Me,1),Me--;else{L=void 0;break}}}}if(!(!Y||D.length===1&&(g.type===0||g.type===1&&g.tagType===0&&!g.props.find(ne=>ne.type===7&&!b.directiveTransforms[ne.name]))))for(let ne=0;ne<D.length;ne++){const be=D[ne];if(ba(be)||be.type===8){const Me=[];(be.type!==2||be.content!==" ")&&Me.push(be),!b.ssr&&Bc(be,b)===0&&Me.push(`1 /* ${s[1]} */`),D[ne]={type:12,content:be,loc:be.loc,codegenNode:Ho(b.helper(Qh),Me)}}}}},r0=new WeakSet,lh=(g,b)=>{if(g.type===1&&vl(g,"once",!0))return r0.has(g)||b.inVOnce?void 0:(r0.add(g),b.inVOnce=!0,b.helper(Om),()=>{b.inVOnce=!1;const D=b.currentNode;D.codegenNode&&(D.codegenNode=b.cache(D.codegenNode,!0))})},s0=(g,b,D)=>{const{exp:L,arg:Y}=g;if(!L)return D.onError(Os(41,g.loc)),C_();const ne=L.loc.source,be=L.type===4?L.content:ne;D.bindingMetadata[ne];const Me=!1;if(!be.trim()||!Pf(be)&&!Me)return D.onError(Os(42,L.loc)),C_();const De=Y||Yr("modelValue",!0),je=Y?Jl(Y)?`onUpdate:${Y.content}`:Ul(['"onUpdate:" + ',Y]):"onUpdate:modelValue";let st;const nt=D.isTS?"($event: any)":"$event";st=Ul([`${nt} => ((`,L,") = $event)"]);const ot=[_o(De,g.exp),_o(je,st)];if(g.modifiers.length&&b.tagType===1){const Vt=g.modifiers.map(en=>(Pp(en)?en:JSON.stringify(en))+": true").join(", "),Jt=Y?Jl(Y)?`${Y.content}Modifiers`:Ul([Y,' + "Modifiers"']):"modelModifiers";ot.push(_o(Jt,Yr(`{ ${Vt} }`,!1,g.loc,2)))}return C_(ot)};function C_(g=[]){return{props:g}}const ay=new WeakSet,Lb=(g,b)=>{if(g.type===1){const D=vl(g,"memo");return!D||ay.has(g)?void 0:(ay.add(g),()=>{const L=g.codegenNode||b.currentNode.codegenNode;L&&L.type===13&&(g.tagType!==1&&yl(L,b),g.codegenNode=Ho(b.helper(Pd),[D.exp,Ip(void 0,L),"_cache",String(b.cached++)]))})}};function jd(g){return[[lh,Bb,Lb,t0,Fd,au,ry,ic,oy],{on:IA,bind:PA,model:s0}]}function R_(g,b={}){const D=b.onError||Id,L=b.mode==="module";b.prefixIdentifiers===!0?D(Os(46)):L&&D(Os(47));const Y=!1;b.cacheHandlers&&D(Os(48)),b.scopeId&&!L&&D(Os(49));const ne=sn(g)?zm(g,b):g,[be,Me]=jd();return ah(ne,_t({},b,{prefixIdentifiers:Y,nodeTransforms:[...be,...b.nodeTransforms||[]],directiveTransforms:_t({},Me,b.directiveTransforms||{})})),Ib(ne,_t({},b,{prefixIdentifiers:Y}))}const ly=()=>({props:[]}),o0=Symbol("vModelRadio"),cy=Symbol("vModelCheckbox"),Xm=Symbol("vModelText"),I_=Symbol("vModelSelect"),a0=Symbol("vModelDynamic"),DA=Symbol("vOnModifiersGuard"),l0=Symbol("vOnKeysGuard"),OA=Symbol("vShow"),uy=Symbol("Transition"),BA=Symbol("TransitionGroup");Lm({[o0]:"vModelRadio",[cy]:"vModelCheckbox",[Xm]:"vModelText",[I_]:"vModelSelect",[a0]:"vModelDynamic",[DA]:"withModifiers",[l0]:"withKeys",[OA]:"vShow",[uy]:"Transition",[BA]:"TransitionGroup"});let Ym;function Nb(g,b=!1){return Ym||(Ym=document.createElement("div")),b?(Ym.innerHTML=`<div foo="${g.replace(/"/g,"&quot;")}">`,Ym.children[0].getAttribute("foo")):(Ym.innerHTML=g,Ym.textContent)}const P_=a("style,iframe,script,noscript",!0),R={isVoidTag:Ae,isNativeTag:g=>_e(g)||ge(g),isPreTag:g=>g==="pre",decodeEntities:Nb,isBuiltInComponent:g=>{if(Jo(g,"Transition"))return uy;if(Jo(g,"TransitionGroup"))return BA},getNamespace(g,b){let D=b?b.ns:0;if(b&&D===2)if(b.tag==="annotation-xml"){if(g==="svg")return 1;b.props.some(L=>L.type===6&&L.name==="encoding"&&L.value!=null&&(L.value.content==="text/html"||L.value.content==="application/xhtml+xml"))&&(D=0)}else/^m(?:[ions]|text)$/.test(b.tag)&&g!=="mglyph"&&g!=="malignmark"&&(D=0);else b&&D===1&&(b.tag==="foreignObject"||b.tag==="desc"||b.tag==="title")&&(D=0);if(D===0){if(g==="svg")return 1;if(g==="math")return 2}return D},getTextMode({tag:g,ns:b}){if(b===0){if(g==="textarea"||g==="title")return 1;if(P_(g))return 2}return 0}},r=g=>{g.type===1&&g.props.forEach((b,D)=>{b.type===6&&b.name==="style"&&b.value&&(g.props[D]={type:7,name:"bind",arg:Yr("style",!0,b.loc),exp:d(b.value.content,b.loc),modifiers:[],loc:b.loc})})},d=(g,b)=>{const D=se(g);return Yr(JSON.stringify(D),!1,b,3)};function _(g,b){return Os(g,b,A)}const A={50:"v-html is missing expression.",51:"v-html will override element children.",52:"v-text is missing expression.",53:"v-text will override element children.",54:"v-model can only be used on <input>, <textarea> and <select> elements.",55:"v-model argument is not supported on plain elements.",56:"v-model cannot be used on file inputs since they are read-only. Use a v-on:change listener instead.",57:"Unnecessary value binding used alongside v-model. It will interfere with v-model's behavior.",58:"v-show is missing expression.",59:"<Transition> expects exactly one child element or component.",60:"Tags with side effect (<script> and <style>) are ignored in client component templates."},E=(g,b,D)=>{const{exp:L,loc:Y}=g;return L||D.onError(_(50,Y)),b.children.length&&(D.onError(_(51,Y)),b.children.length=0),{props:[_o(Yr("innerHTML",!0,Y),L||Yr("",!0))]}},P=(g,b,D)=>{const{exp:L,loc:Y}=g;return L||D.onError(_(52,Y)),b.children.length&&(D.onError(_(53,Y)),b.children.length=0),{props:[_o(Yr("textContent",!0),L?Ho(D.helperString(c_),[L],Y):Yr("",!0))]}},k=(g,b,D)=>{const L=s0(g,b,D);if(!L.props.length||b.tagType===1)return L;g.arg&&D.onError(_(55,g.arg.loc));function Y(){const Me=Kh(b,"value");Me&&D.onError(_(57,Me.loc))}const{tag:ne}=b,be=D.isCustomElement(ne);if(ne==="input"||ne==="textarea"||ne==="select"||be){let Me=Xm,De=!1;if(ne==="input"||be){const je=Kh(b,"type");if(je){if(je.type===7)Me=a0;else if(je.value)switch(je.value.content){case"radio":Me=o0;break;case"checkbox":Me=cy;break;case"file":De=!0,D.onError(_(56,g.loc));break;default:Y();break}}else Um(b)?Me=a0:Y()}else ne==="select"?Me=I_:Y();De||(L.needRuntime=D.helper(Me))}else D.onError(_(54,g.loc));return L.props=L.props.filter(Me=>!(Me.key.type===4&&Me.key.content==="modelValue")),L},Q=a("passive,once,capture"),G=a("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),re=a("left,right"),xe=a("onkeyup,onkeydown,onkeypress",!0),ye=(g,b,D,L)=>{const Y=[],ne=[],be=[];for(let Me=0;Me<b.length;Me++){const De=b[Me];Q(De)?be.push(De):re(De)?Jl(g)?xe(g.content)?Y.push(De):ne.push(De):(Y.push(De),ne.push(De)):G(De)?ne.push(De):Y.push(De)}return{keyModifiers:Y,nonKeyModifiers:ne,eventOptionModifiers:be}},Ee=(g,b)=>Jl(g)&&g.content.toLowerCase()==="onclick"?Yr(b,!0):g.type!==4?Ul(["(",g,`) === "onClick" ? "${b}" : (`,g,")"]):g,Ie=(g,b,D)=>IA(g,b,D,L=>{const{modifiers:Y}=g;if(!Y.length)return L;let{key:ne,value:be}=L.props[0];const{keyModifiers:Me,nonKeyModifiers:De,eventOptionModifiers:je}=ye(ne,Y,D,g.loc);if(De.includes("right")&&(ne=Ee(ne,"onContextmenu")),De.includes("middle")&&(ne=Ee(ne,"onMouseup")),De.length&&(be=Ho(D.helper(DA),[be,JSON.stringify(De)])),Me.length&&(!Jl(ne)||xe(ne.content))&&(be=Ho(D.helper(l0),[be,JSON.stringify(Me)])),je.length){const st=je.map(fe).join("");ne=Jl(ne)?Yr(`${ne.content}${st}`,!0):Ul(["(",ne,`) + "${st}"`])}return{props:[_o(ne,be)]}}),Ue=(g,b,D)=>{const{exp:L,loc:Y}=g;return L||D.onError(_(58,Y)),{props:[],needRuntime:D.helper(OA)}},Oe=(g,b)=>{if(g.type===1&&g.tagType===1&&b.isBuiltInComponent(g.tag)===uy)return()=>{g.children.length&&ke(g)&&b.onError(_(59,{start:g.children[0].loc.start,end:g.children[g.children.length-1].loc.end,source:""}))}};function ke(g){const b=g.children=g.children.filter(L=>L.type!==3&&!(L.type===2&&!L.content.trim())),D=b[0];return b.length!==1||D.type===11||D.type===9&&D.branches.some(ke)}const Ge=(g,b)=>{g.type===1&&g.tagType===0&&(g.tag==="script"||g.tag==="style")&&(b.onError(_(60,g.loc)),b.removeNode())},Je=[r,Oe],Rt={cloak:ly,html:E,text:P,model:k,on:Ie,show:Ue};function Et(g,b={}){return R_(g,_t({},R,b,{nodeTransforms:[Ge,...Je,...b.nodeTransforms||[]],directiveTransforms:_t({},Rt,b.directiveTransforms||{}),transformHoist:null}))}mA();const xt=Object.create(null);function Zt(g,b){if(!sn(g))if(g.nodeType)g=g.innerHTML;else return ei("invalid template option: ",g),Ce;const D=g,L=xt[D];if(L)return L;if(g[0]==="#"){const Me=document.querySelector(g);Me||ei(`Template element not found or is empty: ${g}`),g=Me?Me.innerHTML:""}const{code:Y}=Et(g,_t({hoistStatic:!0,onError:ne,onWarn:Me=>ne(Me,!0)},b));function ne(Me,De=!1){const je=De?Me.message:`Template compilation error: ${Me.message}`,st=Me.loc&&B(g,Me.loc.start.offset,Me.loc.end.offset);ei(st?`${je}
${st}`:je)}const be=new Function(Y)();return be._rc=!0,xt[D]=be}return _v(Zt),u.BaseTransition=da,u.Comment=Xs,u.EffectScope=Qn,u.Fragment=Vo,u.KeepAlive=Mg,u.ReactiveEffect=uo,u.Static=Ba,u.Suspense=xu,u.Teleport=Og,u.Text=wc,u.Transition=Yg,u.TransitionGroup=Jg,u.VueElement=fl,u.callWithAsyncErrorHandling=qo,u.callWithErrorHandling=kr,u.camelize=In,u.capitalize=fe,u.cloneVNode=eh,u.compatUtils=Mc,u.compile=Zt,u.computed=pm,u.createApp=Nv,u.createBlock=dv,u.createCommentVNode=uf,u.createElementBlock=I0,u.createElementVNode=D0,u.createHydrationRenderer=Dg,u.createPropsRestProxy=lA,u.createRenderer=Jc,u.createSSRApp=Tm,u.createSlots=pv,u.createStaticVNode=tA,u.createTextVNode=cf,u.createVNode=go,u.customRef=qf,u.defineAsyncComponent=ho,u.defineComponent=Ls,u.defineCustomElement=j0,u.defineEmits=oA,u.defineExpose=aA,u.defineProps=Sb,u.defineSSRCustomElement=mf,u.effect=oa,u.effectScope=Nn,u.getCurrentInstance=Lh,u.getCurrentScope=Qi,u.getTransitionRawChildren=Fi,u.guardReactiveProps=O0,u.h=La,u.handleError=aa,u.hydrate=i_,u.initCustomFormatter=xv,u.initDirectivesForSSR=kv,u.inject=Ca,u.isMemoSame=wv,u.isProxy=Ts,u.isReactive=Va,u.isReadonly=Wr,u.isRef=ao,u.isRuntimeOnly=Vg,u.isShallow=Gu,u.isVNode=Bh,u.markRaw=Ga,u.mergeDefaults=Mb,u.mergeProps=lm,u.nextTick=Kp,u.normalizeClass=ve,u.normalizeProps=ce,u.normalizeStyle=Z,u.onActivated=vd,u.onBeforeMount=Ph,u.onBeforeUnmount=Xu,u.onBeforeUpdate=tr,u.onDeactivated=Ns,u.onErrorCaptured=F,u.onMounted=Aa,u.onRenderTracked=T,u.onRenderTriggered=ie,u.onScopeDispose=Mr,u.onServerPrefetch=sf,u.onUnmounted=pa,u.onUpdated=cp,u.openBlock=Oh,u.popScopeId=op,u.provide=bs,u.proxyRefs=fs,u.pushScopeId=sp,u.queuePostFlushCb=dd,u.reactive=Is,u.readonly=Wl,u.ref=ud,u.registerRuntimeCompiler=_v,u.render=Tp,u.renderList=nA,u.renderSlot=Ug,u.resolveComponent=hv,u.resolveDirective=sm,u.resolveDynamicComponent=Ju,u.resolveFilter=Tu,u.resolveTransitionHooks=Rh,u.setBlockTracking=om,u.setDevtoolsHook=Vc,u.setTransitionHooks=Xc,u.shallowReactive=Vu,u.shallowReadonly=fu,u.shallowRef=xg,u.ssrContextKey=Ws,u.ssrUtils=Ev,u.stop=Oo,u.toDisplayString=Re,u.toHandlerKey=Se,u.toHandlers=Fg,u.toRaw=Nr,u.toRef=Yp,u.toRefs=Zd,u.transformVNodeArgs=P0,u.triggerRef=Xp,u.unref=wg,u.useAttrs=bv,u.useCssModule=gf,u.useCssVars=wp,u.useSSRContext=U0,u.useSlots=Av,u.useTransitionState=_d,u.vModelCheckbox=Sm,u.vModelDynamic=Tb,u.vModelRadio=Rv,u.vModelSelect=t_,u.vModelText=Em,u.vShow=Lv,u.version=fm,u.warn=ei,u.watch=yc,u.watchEffect=Ra,u.watchPostEffect=Eu,u.watchSyncEffect=qc,u.withAsyncContext=yp,u.withCtx=Gr,u.withDefaults=us,u.withDirectives=wb,u.withKeys=Bv,u.withMemo=Hg,u.withModifiers=Ov,u.withScopeId=Sh,Object.defineProperty(u,"__esModule",{value:!0}),u})({});/*!
 * VERSION: 2.1.3
 * DATE: 2019-05-17
 * UPDATES AND DOCS AT: http://greensock.com
 * 
 * Includes all of the following: TweenLite, TweenMax, TimelineLite, TimelineMax, EasePack, CSSPlugin, RoundPropsPlugin, BezierPlugin, AttrPlugin, DirectionalRotationPlugin
 *
 * @license Copyright (c) 2008-2019, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 **/var _gsScope=typeof module<"u"&&module.exports&&typeof global<"u"?global:globalThis||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(u,a,s){var v=function(ce){var K=[],X=ce.length,W;for(W=0;W!==X;K.push(ce[W++]));return K},x=function(ce,K,X){var W=ce.cycle,_e,ge;for(_e in W)ge=W[_e],ce[_e]=typeof ge=="function"?ge(X,K[X],K):ge[X%ge.length];delete ce.cycle},M=function(ce){if(typeof ce=="function")return ce;var K=typeof ce=="object"?ce:{each:ce},X=K.ease,W=K.from||0,_e=K.base||0,ge={},Ae=isNaN(W),ee=K.axis,$={center:.5,end:1}[W]||0;return function(ae,Re,pe){var he=(pe||K).length,we=ge[he],Ce,Ne,Ze,Ye,it,_t,At,vt,ut;if(!we){if(ut=K.grid==="auto"?0:(K.grid||[1/0])[0],!ut){for(At=-1/0;At<(At=pe[ut++].getBoundingClientRect().left)&&ut<he;);ut--}for(we=ge[he]=[],Ce=Ae?Math.min(ut,he)*$-.5:W%ut,Ne=Ae?he*$/ut-.5:W/ut|0,At=0,vt=1/0,_t=0;_t<he;_t++)Ze=_t%ut-Ce,Ye=Ne-(_t/ut|0),we[_t]=it=ee?Math.abs(ee==="y"?Ye:Ze):Math.sqrt(Ze*Ze+Ye*Ye),it>At&&(At=it),it<vt&&(vt=it);we.max=At-vt,we.min=vt,we.v=he=K.amount||K.each*(ut>he?he-1:ee?ee==="y"?he/ut:ut:Math.max(ut,he/ut))||0,we.b=he<0?_e-he:_e}return he=(we[ae]-we.min)/we.max,we.b+(X?X.getRatio(he):he)*we.v}},I=function(ce,K,X){s.call(this,ce,K,X),this._cycle=0,this._yoyo=this.vars.yoyo===!0||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._repeat&&this._uncache(!0),this.render=I.prototype.render},B=1e-8,U=s._internals,j=U.isSelector,te=U.isArray,Z=I.prototype=s.to({},.1,{}),oe=[];I.version="2.1.3",Z.constructor=I,Z.kill()._gc=!1,I.killTweensOf=I.killDelayedCallsTo=s.killTweensOf,I.getTweensOf=s.getTweensOf,I.lagSmoothing=s.lagSmoothing,I.ticker=s.ticker,I.render=s.render,I.distribute=M,Z.invalidate=function(){return this._yoyo=this.vars.yoyo===!0||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._yoyoEase=null,this._uncache(!0),s.prototype.invalidate.call(this)},Z.updateTo=function(ce,K){var X=this,W=X.ratio,_e=X.vars.immediateRender||ce.immediateRender,ge;K&&X._startTime<X._timeline._time&&(X._startTime=X._timeline._time,X._uncache(!1),X._gc?X._enabled(!0,!1):X._timeline.insert(X,X._startTime-X._delay));for(ge in ce)X.vars[ge]=ce[ge];if(X._initted||_e){if(K)X._initted=!1,_e&&X.render(0,!0,!0);else if(X._gc&&X._enabled(!0,!1),X._notifyPluginsOfEnabled&&X._firstPT&&s._onPluginEvent("_onDisable",X),X._time/X._duration>.998){var Ae=X._totalTime;X.render(0,!0,!1),X._initted=!1,X.render(Ae,!0,!1)}else if(X._initted=!1,X._init(),X._time>0||_e)for(var ee=1/(1-W),$=X._firstPT,ae;$;)ae=$.s+$.c,$.c*=ee,$.s=ae-$.c,$=$._next}return X},Z.render=function(ce,K,X){this._initted||this._duration===0&&this.vars.repeat&&this.invalidate();var W=this,_e=W._dirty?W.totalDuration():W._totalDuration,ge=W._time,Ae=W._totalTime,ee=W._cycle,$=W._duration,ae=W._rawPrevTime,Re,pe,he,we,Ce,Ne,Ze,Ye,it;if(ce>=_e-B&&ce>=0?(W._totalTime=_e,W._cycle=W._repeat,W._yoyo&&W._cycle&1?(W._time=0,W.ratio=W._ease._calcEnd?W._ease.getRatio(0):0):(W._time=$,W.ratio=W._ease._calcEnd?W._ease.getRatio(1):1),W._reversed||(Re=!0,pe="onComplete",X=X||W._timeline.autoRemoveChildren),$===0&&(W._initted||!W.vars.lazy||X)&&(W._startTime===W._timeline._duration&&(ce=0),(ae<0||ce<=0&&ce>=-B||ae===B&&W.data!=="isPause")&&ae!==ce&&(X=!0,ae>B&&(pe="onReverseComplete")),W._rawPrevTime=Ye=!K||ce||ae===ce?ce:B)):ce<B?(W._totalTime=W._time=W._cycle=0,W.ratio=W._ease._calcEnd?W._ease.getRatio(0):0,(Ae!==0||$===0&&ae>0)&&(pe="onReverseComplete",Re=W._reversed),ce>-B?ce=0:ce<0&&(W._active=!1,$===0&&(W._initted||!W.vars.lazy||X)&&(ae>=0&&(X=!0),W._rawPrevTime=Ye=!K||ce||ae===ce?ce:B)),W._initted||(X=!0)):(W._totalTime=W._time=ce,W._repeat!==0&&(we=$+W._repeatDelay,W._cycle=W._totalTime/we>>0,W._cycle!==0&&W._cycle===W._totalTime/we&&Ae<=ce&&W._cycle--,W._time=W._totalTime-W._cycle*we,W._yoyo&&W._cycle&1&&(W._time=$-W._time,it=W._yoyoEase||W.vars.yoyoEase,it&&(W._yoyoEase||(it===!0&&!W._initted?(it=W.vars.ease,W._yoyoEase=it=it?it instanceof Ease?it:typeof it=="function"?new Ease(it,W.vars.easeParams):Ease.map[it]||s.defaultEase:s.defaultEase):W._yoyoEase=it=it===!0?W._ease:it instanceof Ease?it:Ease.map[it]),W.ratio=it?1-it.getRatio(($-W._time)/$):0)),W._time>$?W._time=$:W._time<0&&(W._time=0)),W._easeType&&!it?(Ce=W._time/$,Ne=W._easeType,Ze=W._easePower,(Ne===1||Ne===3&&Ce>=.5)&&(Ce=1-Ce),Ne===3&&(Ce*=2),Ze===1?Ce*=Ce:Ze===2?Ce*=Ce*Ce:Ze===3?Ce*=Ce*Ce*Ce:Ze===4&&(Ce*=Ce*Ce*Ce*Ce),W.ratio=Ne===1?1-Ce:Ne===2?Ce:W._time/$<.5?Ce/2:1-Ce/2):it||(W.ratio=W._ease.getRatio(W._time/$))),ge===W._time&&!X&&ee===W._cycle){Ae!==W._totalTime&&W._onUpdate&&(K||W._callback("onUpdate"));return}else if(!W._initted){if(W._init(),!W._initted||W._gc)return;if(!X&&W._firstPT&&(W.vars.lazy!==!1&&W._duration||W.vars.lazy&&!W._duration)){W._time=ge,W._totalTime=Ae,W._rawPrevTime=ae,W._cycle=ee,U.lazyTweens.push(W),W._lazy=[ce,K];return}W._time&&!Re&&!it?W.ratio=W._ease.getRatio(W._time/$):Re&&this._ease._calcEnd&&!it&&(W.ratio=W._ease.getRatio(W._time===0?0:1))}for(W._lazy!==!1&&(W._lazy=!1),W._active||!W._paused&&W._time!==ge&&ce>=0&&(W._active=!0),Ae===0&&(W._initted===2&&ce>0&&W._init(),W._startAt&&(ce>=0?W._startAt.render(ce,!0,X):pe||(pe="_dummyGS")),W.vars.onStart&&(W._totalTime!==0||$===0)&&(K||W._callback("onStart"))),he=W._firstPT;he;)he.f?he.t[he.p](he.c*W.ratio+he.s):he.t[he.p]=he.c*W.ratio+he.s,he=he._next;W._onUpdate&&(ce<0&&W._startAt&&W._startTime&&W._startAt.render(ce,!0,X),K||(W._totalTime!==Ae||pe)&&W._callback("onUpdate")),W._cycle!==ee&&(K||W._gc||W.vars.onRepeat&&W._callback("onRepeat")),pe&&(!W._gc||X)&&(ce<0&&W._startAt&&!W._onUpdate&&W._startTime&&W._startAt.render(ce,!0,X),Re&&(W._timeline.autoRemoveChildren&&W._enabled(!1,!1),W._active=!1),!K&&W.vars[pe]&&W._callback(pe),$===0&&W._rawPrevTime===B&&Ye!==B&&(W._rawPrevTime=0))},I.to=function(ce,K,X){return new I(ce,K,X)},I.from=function(ce,K,X){return X.runBackwards=!0,X.immediateRender=X.immediateRender!=!1,new I(ce,K,X)},I.fromTo=function(ce,K,X,W){return W.startAt=X,W.immediateRender=W.immediateRender!=!1&&X.immediateRender!=!1,new I(ce,K,W)},I.staggerTo=I.allTo=function(ce,K,X,W,_e,ge,Ae){var ee=[],$=M(X.stagger||W),ae=X.cycle,Re=(X.startAt||oe).cycle,pe,he,we,Ce;for(te(ce)||(typeof ce=="string"&&(ce=s.selector(ce)||ce),j(ce)&&(ce=v(ce))),ce=ce||[],pe=ce.length-1,we=0;we<=pe;we++){he={};for(Ce in X)he[Ce]=X[Ce];if(ae&&(x(he,ce,we),he.duration!=null&&(K=he.duration,delete he.duration)),Re){Re=he.startAt={};for(Ce in X.startAt)Re[Ce]=X.startAt[Ce];x(he.startAt,ce,we)}he.delay=$(we,ce[we],ce)+(he.delay||0),we===pe&&_e&&(he.onComplete=function(){X.onComplete&&X.onComplete.apply(X.onCompleteScope||this,arguments),_e.apply(Ae||X.callbackScope||this,ge||oe)}),ee[we]=new I(ce[we],K,he)}return ee},I.staggerFrom=I.allFrom=function(ce,K,X,W,_e,ge,Ae){return X.runBackwards=!0,X.immediateRender=X.immediateRender!=!1,I.staggerTo(ce,K,X,W,_e,ge,Ae)},I.staggerFromTo=I.allFromTo=function(ce,K,X,W,_e,ge,Ae,ee){return W.startAt=X,W.immediateRender=W.immediateRender!=!1&&X.immediateRender!=!1,I.staggerTo(ce,K,W,_e,ge,Ae,ee)},I.delayedCall=function(ce,K,X,W,_e){return new I(K,0,{delay:ce,onComplete:K,onCompleteParams:X,callbackScope:W,onReverseComplete:K,onReverseCompleteParams:X,immediateRender:!1,useFrames:_e,overwrite:0})},I.set=function(ce,K){return new I(ce,0,K)},I.isTweening=function(ce){return s.getTweensOf(ce,!0).length>0};var le=function(ce,K){for(var X=[],W=0,_e=ce._first;_e;)_e instanceof s?X[W++]=_e:(K&&(X[W++]=_e),X=X.concat(le(_e,K)),W=X.length),_e=_e._next;return X},se=I.getAllTweens=function(ce){return le(u._rootTimeline,ce).concat(le(u._rootFramesTimeline,ce))};I.killAll=function(ce,K,X,W){K==null&&(K=!0),X==null&&(X=!0);var _e=se(W!=!1),ge=_e.length,Ae=K&&X&&W,ee,$,ae;for(ae=0;ae<ge;ae++)$=_e[ae],(Ae||$ instanceof a||(ee=$.target===$.vars.onComplete)&&X||K&&!ee)&&(ce?$.totalTime($._reversed?0:$.totalDuration()):$._enabled(!1,!1))},I.killChildTweensOf=function(ce,K){if(ce!=null){var X=U.tweenLookup,W,_e,ge,Ae,ee;if(typeof ce=="string"&&(ce=s.selector(ce)||ce),j(ce)&&(ce=v(ce)),te(ce)){for(Ae=ce.length;--Ae>-1;)I.killChildTweensOf(ce[Ae],K);return}W=[];for(ge in X)for(_e=X[ge].target.parentNode;_e;)_e===ce&&(W=W.concat(X[ge].tweens)),_e=_e.parentNode;for(ee=W.length,Ae=0;Ae<ee;Ae++)K&&W[Ae].totalTime(W[Ae].totalDuration()),W[Ae]._enabled(!1,!1)}};var ve=function(ce,K,X,W){K=K!==!1,X=X!==!1,W=W!==!1;for(var _e=se(W),ge=K&&X&&W,Ae=_e.length,ee,$;--Ae>-1;)$=_e[Ae],(ge||$ instanceof a||(ee=$.target===$.vars.onComplete)&&X||K&&!ee)&&$.paused(ce)};return I.pauseAll=function(ce,K,X){ve(!0,ce,K,X)},I.resumeAll=function(ce,K,X){ve(!1,ce,K,X)},I.globalTimeScale=function(ce){var K=u._rootTimeline,X=s.ticker.time;return arguments.length?(ce=ce||B,K._startTime=X-(X-K._startTime)*K._timeScale/ce,K=u._rootFramesTimeline,X=s.ticker.frame,K._startTime=X-(X-K._startTime)*K._timeScale/ce,K._timeScale=u._rootTimeline._timeScale=ce,ce):K._timeScale},Z.progress=function(ce,K){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&this._cycle&1?1-ce:ce)+this._cycle*(this._duration+this._repeatDelay),K):this.duration()?this._time/this._duration:this.ratio},Z.totalProgress=function(ce,K){return arguments.length?this.totalTime(this.totalDuration()*ce,K):this._totalTime/this.totalDuration()},Z.time=function(ce,K){if(!arguments.length)return this._time;this._dirty&&this.totalDuration();var X=this._duration,W=this._cycle,_e=W*(X+this._repeatDelay);return ce>X&&(ce=X),this.totalTime(this._yoyo&&W&1?X-ce+_e:this._repeat?ce+_e:ce,K)},Z.duration=function(ce){return arguments.length?u.prototype.duration.call(this,ce):this._duration},Z.totalDuration=function(ce){return arguments.length?this._repeat===-1?this:this.duration((ce-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},Z.repeat=function(ce){return arguments.length?(this._repeat=ce,this._uncache(!0)):this._repeat},Z.repeatDelay=function(ce){return arguments.length?(this._repeatDelay=ce,this._uncache(!0)):this._repeatDelay},Z.yoyo=function(ce){return arguments.length?(this._yoyo=ce,this):this._yoyo},I},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(u,a,s){var v=function(W){a.call(this,W);var _e=this,ge=_e.vars,Ae,ee;_e._labels={},_e.autoRemoveChildren=!!ge.autoRemoveChildren,_e.smoothChildTiming=!!ge.smoothChildTiming,_e._sortChildren=!0,_e._onUpdate=ge.onUpdate;for(ee in ge)Ae=ge[ee],U(Ae)&&Ae.join("").indexOf("{self}")!==-1&&(ge[ee]=_e._swapSelfInParams(Ae));U(ge.tweens)&&_e.add(ge.tweens,0,ge.align,ge.stagger)},x=1e-8,M=s._internals,I=v._internals={},B=M.isSelector,U=M.isArray,j=M.lazyTweens,te=M.lazyRender,Z=_gsScope._gsDefine.globals,oe=function(W){var _e={},ge;for(ge in W)_e[ge]=W[ge];return _e},le=function(W,_e,ge){var Ae=W.cycle,ee,$;for(ee in Ae)$=Ae[ee],W[ee]=typeof $=="function"?$(ge,_e[ge],_e):$[ge%$.length];delete W.cycle},se=I.pauseCallback=function(){},ve=function(W){var _e=[],ge=W.length,Ae;for(Ae=0;Ae!==ge;_e.push(W[Ae++]));return _e},ce=function(W,_e,ge,Ae){var ee="immediateRender";return ee in _e||(_e[ee]=!(ge&&ge[ee]===!1||Ae)),_e},K=function(W){if(typeof W=="function")return W;var _e=typeof W=="object"?W:{each:W},ge=_e.ease,Ae=_e.from||0,ee=_e.base||0,$={},ae=isNaN(Ae),Re=_e.axis,pe={center:.5,end:1}[Ae]||0;return function(he,we,Ce){var Ne=(Ce||_e).length,Ze=$[Ne],Ye,it,_t,At,vt,ut,Nt,Qt,Qe;if(!Ze){if(Qe=_e.grid==="auto"?0:(_e.grid||[1/0])[0],!Qe){for(Nt=-1/0;Nt<(Nt=Ce[Qe++].getBoundingClientRect().left)&&Qe<Ne;);Qe--}for(Ze=$[Ne]=[],Ye=ae?Math.min(Qe,Ne)*pe-.5:Ae%Qe,it=ae?Ne*pe/Qe-.5:Ae/Qe|0,Nt=0,Qt=1/0,ut=0;ut<Ne;ut++)_t=ut%Qe-Ye,At=it-(ut/Qe|0),Ze[ut]=vt=Re?Math.abs(Re==="y"?At:_t):Math.sqrt(_t*_t+At*At),vt>Nt&&(Nt=vt),vt<Qt&&(Qt=vt);Ze.max=Nt-Qt,Ze.min=Qt,Ze.v=Ne=_e.amount||_e.each*(Qe>Ne?Ne-1:Re?Re==="y"?Ne/Qe:Qe:Math.max(Qe,Ne/Qe))||0,Ze.b=Ne<0?ee-Ne:ee}return Ne=(Ze[he]-Ze.min)/Ze.max,Ze.b+(ge?ge.getRatio(Ne):Ne)*Ze.v}},X=v.prototype=new a;return v.version="2.1.3",v.distribute=K,X.constructor=v,X.kill()._gc=X._forcingPlayhead=X._hasPause=!1,X.to=function(W,_e,ge,Ae){var ee=ge.repeat&&Z.TweenMax||s;return _e?this.add(new ee(W,_e,ge),Ae):this.set(W,ge,Ae)},X.from=function(W,_e,ge,Ae){return this.add((ge.repeat&&Z.TweenMax||s).from(W,_e,ce(this,ge)),Ae)},X.fromTo=function(W,_e,ge,Ae,ee){var $=Ae.repeat&&Z.TweenMax||s;return Ae=ce(this,Ae,ge),_e?this.add($.fromTo(W,_e,ge,Ae),ee):this.set(W,Ae,ee)},X.staggerTo=function(W,_e,ge,Ae,ee,$,ae,Re){var pe=new v({onComplete:$,onCompleteParams:ae,callbackScope:Re,smoothChildTiming:this.smoothChildTiming}),he=K(ge.stagger||Ae),we=ge.startAt,Ce=ge.cycle,Ne,Ze;for(typeof W=="string"&&(W=s.selector(W)||W),W=W||[],B(W)&&(W=ve(W)),Ze=0;Ze<W.length;Ze++)Ne=oe(ge),we&&(Ne.startAt=oe(we),we.cycle&&le(Ne.startAt,W,Ze)),Ce&&(le(Ne,W,Ze),Ne.duration!=null&&(_e=Ne.duration,delete Ne.duration)),pe.to(W[Ze],_e,Ne,he(Ze,W[Ze],W));return this.add(pe,ee)},X.staggerFrom=function(W,_e,ge,Ae,ee,$,ae,Re){return ge.runBackwards=!0,this.staggerTo(W,_e,ce(this,ge),Ae,ee,$,ae,Re)},X.staggerFromTo=function(W,_e,ge,Ae,ee,$,ae,Re,pe){return Ae.startAt=ge,this.staggerTo(W,_e,ce(this,Ae,ge),ee,$,ae,Re,pe)},X.call=function(W,_e,ge,Ae){return this.add(s.delayedCall(0,W,_e,ge),Ae)},X.set=function(W,_e,ge){return this.add(new s(W,0,ce(this,_e,null,!0)),ge)},v.exportRoot=function(W,_e){W=W||{},W.smoothChildTiming==null&&(W.smoothChildTiming=!0);var ge=new v(W),Ae=ge._timeline,ee,$,ae,Re;for(_e==null&&(_e=!0),Ae._remove(ge,!0),ge._startTime=0,ge._rawPrevTime=ge._time=ge._totalTime=Ae._time,ae=Ae._first;ae;)Re=ae._next,(!_e||!(ae instanceof s&&ae.target===ae.vars.onComplete))&&($=ae._startTime-ae._delay,$<0&&(ee=1),ge.add(ae,$)),ae=Re;return Ae.add(ge,0),ee&&ge.totalDuration(),ge},X.add=function(W,_e,ge,Ae){var ee=this,$,ae,Re,pe,he,we;if(typeof _e!="number"&&(_e=ee._parseTimeOrLabel(_e,0,!0,W)),!(W instanceof u))if(W instanceof Array||W&&W.push&&U(W)){for(ge=ge||"normal",Ae=Ae||0,$=_e,ae=W.length,Re=0;Re<ae;Re++)U(pe=W[Re])&&(pe=new v({tweens:pe})),ee.add(pe,$),typeof pe!="string"&&typeof pe!="function"&&(ge==="sequence"?$=pe._startTime+pe.totalDuration()/pe._timeScale:ge==="start"&&(pe._startTime-=pe.delay())),$+=Ae;return ee._uncache(!0)}else{if(typeof W=="string")return ee.addLabel(W,_e);if(typeof W=="function")W=s.delayedCall(0,W);else throw"Cannot add "+W+" into the timeline; it is not a tween, timeline, function, or string."}if(a.prototype.add.call(ee,W,_e),(W._time||!W._duration&&W._initted)&&($=(ee.rawTime()-W._startTime)*W._timeScale,(!W._duration||Math.abs(Math.max(0,Math.min(W.totalDuration(),$)))-W._totalTime>1e-5)&&W.render($,!1,!1)),(ee._gc||ee._time===ee._duration)&&!ee._paused&&ee._duration<ee.duration())for(he=ee,we=he.rawTime()>W._startTime;he._timeline;)we&&he._timeline.smoothChildTiming?he.totalTime(he._totalTime,!0):he._gc&&he._enabled(!0,!1),he=he._timeline;return ee},X.remove=function(W){if(W instanceof u){this._remove(W,!1);var _e=W._timeline=W.vars.useFrames?u._rootFramesTimeline:u._rootTimeline;return W._startTime=(W._paused?W._pauseTime:_e._time)-(W._reversed?W.totalDuration()-W._totalTime:W._totalTime)/W._timeScale,this}else if(W instanceof Array||W&&W.push&&U(W)){for(var ge=W.length;--ge>-1;)this.remove(W[ge]);return this}else if(typeof W=="string")return this.removeLabel(W);return this.kill(null,W)},X._remove=function(W,_e){a.prototype._remove.call(this,W,_e);var ge=this._last;return ge?this._time>this.duration()&&(this._time=this._duration,this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},X.append=function(W,_e){return this.add(W,this._parseTimeOrLabel(null,_e,!0,W))},X.insert=X.insertMultiple=function(W,_e,ge,Ae){return this.add(W,_e||0,ge,Ae)},X.appendMultiple=function(W,_e,ge,Ae){return this.add(W,this._parseTimeOrLabel(null,_e,!0,W),ge,Ae)},X.addLabel=function(W,_e){return this._labels[W]=this._parseTimeOrLabel(_e),this},X.addPause=function(W,_e,ge,Ae){var ee=s.delayedCall(0,se,ge,Ae||this);return ee.vars.onComplete=ee.vars.onReverseComplete=_e,ee.data="isPause",this._hasPause=!0,this.add(ee,W)},X.removeLabel=function(W){return delete this._labels[W],this},X.getLabelTime=function(W){return this._labels[W]!=null?this._labels[W]:-1},X._parseTimeOrLabel=function(W,_e,ge,Ae){var ee,$;if(Ae instanceof u&&Ae.timeline===this)this.remove(Ae);else if(Ae&&(Ae instanceof Array||Ae.push&&U(Ae)))for($=Ae.length;--$>-1;)Ae[$]instanceof u&&Ae[$].timeline===this&&this.remove(Ae[$]);if(ee=typeof W=="number"&&!_e?0:this.duration()>99999999999?this.recent().endTime(!1):this._duration,typeof _e=="string")return this._parseTimeOrLabel(_e,ge&&typeof W=="number"&&this._labels[_e]==null?W-ee:0,ge);if(_e=_e||0,typeof W=="string"&&(isNaN(W)||this._labels[W]!=null)){if($=W.indexOf("="),$===-1)return this._labels[W]==null?ge?this._labels[W]=ee+_e:_e:this._labels[W]+_e;_e=parseInt(W.charAt($-1)+"1",10)*Number(W.substr($+1)),W=$>1?this._parseTimeOrLabel(W.substr(0,$-1),0,ge):ee}else W==null&&(W=ee);return Number(W)+_e},X.seek=function(W,_e){return this.totalTime(typeof W=="number"?W:this._parseTimeOrLabel(W),_e!==!1)},X.stop=function(){return this.paused(!0)},X.gotoAndPlay=function(W,_e){return this.play(W,_e)},X.gotoAndStop=function(W,_e){return this.pause(W,_e)},X.render=function(W,_e,ge){this._gc&&this._enabled(!0,!1);var Ae=this,ee=Ae._time,$=Ae._dirty?Ae.totalDuration():Ae._totalDuration,ae=Ae._startTime,Re=Ae._timeScale,pe=Ae._paused,he,we,Ce,Ne,Ze,Ye,it,_t;if(ee!==Ae._time&&(W+=Ae._time-ee),Ae._hasPause&&!Ae._forcingPlayhead&&!_e){if(W>ee)for(he=Ae._first;he&&he._startTime<=W&&!Ye;)he._duration||he.data==="isPause"&&!he.ratio&&!(he._startTime===0&&Ae._rawPrevTime===0)&&(Ye=he),he=he._next;else for(he=Ae._last;he&&he._startTime>=W&&!Ye;)he._duration||he.data==="isPause"&&he._rawPrevTime>0&&(Ye=he),he=he._prev;Ye&&(Ae._time=Ae._totalTime=W=Ye._startTime,_t=Ae._startTime+(Ae._reversed?Ae._duration-W:W)/Ae._timeScale)}if(W>=$-x&&W>=0)Ae._totalTime=Ae._time=$,Ae._reversed||Ae._hasPausedChild()||(we=!0,Ne="onComplete",Ze=!!Ae._timeline.autoRemoveChildren,Ae._duration===0&&(W<=0&&W>=-x||Ae._rawPrevTime<0||Ae._rawPrevTime===x)&&Ae._rawPrevTime!==W&&Ae._first&&(Ze=!0,Ae._rawPrevTime>x&&(Ne="onReverseComplete"))),Ae._rawPrevTime=Ae._duration||!_e||W||Ae._rawPrevTime===W?W:x,W=$+1e-4;else if(W<x)if(Ae._totalTime=Ae._time=0,W>-x&&(W=0),(ee!==0||Ae._duration===0&&Ae._rawPrevTime!==x&&(Ae._rawPrevTime>0||W<0&&Ae._rawPrevTime>=0))&&(Ne="onReverseComplete",we=Ae._reversed),W<0)Ae._active=!1,Ae._timeline.autoRemoveChildren&&Ae._reversed?(Ze=we=!0,Ne="onReverseComplete"):Ae._rawPrevTime>=0&&Ae._first&&(Ze=!0),Ae._rawPrevTime=W;else{if(Ae._rawPrevTime=Ae._duration||!_e||W||Ae._rawPrevTime===W?W:x,W===0&&we)for(he=Ae._first;he&&he._startTime===0;)he._duration||(we=!1),he=he._next;W=0,Ae._initted||(Ze=!0)}else Ae._totalTime=Ae._time=Ae._rawPrevTime=W;if(!((Ae._time===ee||!Ae._first)&&!ge&&!Ze&&!Ye)){if(Ae._initted||(Ae._initted=!0),Ae._active||!Ae._paused&&Ae._time!==ee&&W>0&&(Ae._active=!0),ee===0&&Ae.vars.onStart&&(Ae._time!==0||!Ae._duration)&&(_e||Ae._callback("onStart")),it=Ae._time,it>=ee)for(he=Ae._first;he&&(Ce=he._next,!(it!==Ae._time||Ae._paused&&!pe));)(he._active||he._startTime<=it&&!he._paused&&!he._gc)&&(Ye===he&&(Ae.pause(),Ae._pauseTime=_t),he._reversed?he.render((he._dirty?he.totalDuration():he._totalDuration)-(W-he._startTime)*he._timeScale,_e,ge):he.render((W-he._startTime)*he._timeScale,_e,ge)),he=Ce;else for(he=Ae._last;he&&(Ce=he._prev,!(it!==Ae._time||Ae._paused&&!pe));){if(he._active||he._startTime<=ee&&!he._paused&&!he._gc){if(Ye===he){for(Ye=he._prev;Ye&&Ye.endTime()>Ae._time;)Ye.render(Ye._reversed?Ye.totalDuration()-(W-Ye._startTime)*Ye._timeScale:(W-Ye._startTime)*Ye._timeScale,_e,ge),Ye=Ye._prev;Ye=null,Ae.pause(),Ae._pauseTime=_t}he._reversed?he.render((he._dirty?he.totalDuration():he._totalDuration)-(W-he._startTime)*he._timeScale,_e,ge):he.render((W-he._startTime)*he._timeScale,_e,ge)}he=Ce}Ae._onUpdate&&(_e||(j.length&&te(),Ae._callback("onUpdate"))),Ne&&(Ae._gc||(ae===Ae._startTime||Re!==Ae._timeScale)&&(Ae._time===0||$>=Ae.totalDuration())&&(we&&(j.length&&te(),Ae._timeline.autoRemoveChildren&&Ae._enabled(!1,!1),Ae._active=!1),!_e&&Ae.vars[Ne]&&Ae._callback(Ne)))}},X._hasPausedChild=function(){for(var W=this._first;W;){if(W._paused||W instanceof v&&W._hasPausedChild())return!0;W=W._next}return!1},X.getChildren=function(W,_e,ge,Ae){Ae=Ae||-9999999999;for(var ee=[],$=this._first,ae=0;$;)$._startTime<Ae||($ instanceof s?_e!==!1&&(ee[ae++]=$):(ge!==!1&&(ee[ae++]=$),W!==!1&&(ee=ee.concat($.getChildren(!0,_e,ge)),ae=ee.length))),$=$._next;return ee},X.getTweensOf=function(W,_e){var ge=this._gc,Ae=[],ee=0,$,ae;for(ge&&this._enabled(!0,!0),$=s.getTweensOf(W),ae=$.length;--ae>-1;)($[ae].timeline===this||_e&&this._contains($[ae]))&&(Ae[ee++]=$[ae]);return ge&&this._enabled(!1,!0),Ae},X.recent=function(){return this._recent},X._contains=function(W){for(var _e=W.timeline;_e;){if(_e===this)return!0;_e=_e.timeline}return!1},X.shiftChildren=function(W,_e,ge){ge=ge||0;for(var Ae=this._first,ee=this._labels,$;Ae;)Ae._startTime>=ge&&(Ae._startTime+=W),Ae=Ae._next;if(_e)for($ in ee)ee[$]>=ge&&(ee[$]+=W);return this._uncache(!0)},X._kill=function(W,_e){if(!W&&!_e)return this._enabled(!1,!1);for(var ge=_e?this.getTweensOf(_e):this.getChildren(!0,!0,!1),Ae=ge.length,ee=!1;--Ae>-1;)ge[Ae]._kill(W,_e)&&(ee=!0);return ee},X.clear=function(W){var _e=this.getChildren(!1,!0,!0),ge=_e.length;for(this._time=this._totalTime=0;--ge>-1;)_e[ge]._enabled(!1,!1);return W!==!1&&(this._labels={}),this._uncache(!0)},X.invalidate=function(){for(var W=this._first;W;)W.invalidate(),W=W._next;return u.prototype.invalidate.call(this)},X._enabled=function(W,_e){if(W===this._gc)for(var ge=this._first;ge;)ge._enabled(W,!0),ge=ge._next;return a.prototype._enabled.call(this,W,_e)},X.totalTime=function(W,_e,ge){this._forcingPlayhead=!0;var Ae=u.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,Ae},X.duration=function(W){return arguments.length?(this.duration()!==0&&W!==0&&this.timeScale(this._duration/W),this):(this._dirty&&this.totalDuration(),this._duration)},X.totalDuration=function(W){if(!arguments.length){if(this._dirty){for(var _e=0,ge=this,Ae=ge._last,ee=999999999999,$,ae;Ae;)$=Ae._prev,Ae._dirty&&Ae.totalDuration(),Ae._startTime>ee&&ge._sortChildren&&!Ae._paused&&!ge._calculatingDuration?(ge._calculatingDuration=1,ge.add(Ae,Ae._startTime-Ae._delay),ge._calculatingDuration=0):ee=Ae._startTime,Ae._startTime<0&&!Ae._paused&&(_e-=Ae._startTime,ge._timeline.smoothChildTiming&&(ge._startTime+=Ae._startTime/ge._timeScale,ge._time-=Ae._startTime,ge._totalTime-=Ae._startTime,ge._rawPrevTime-=Ae._startTime),ge.shiftChildren(-Ae._startTime,!1,-9999999999),ee=0),ae=Ae._startTime+Ae._totalDuration/Ae._timeScale,ae>_e&&(_e=ae),Ae=$;ge._duration=ge._totalDuration=_e,ge._dirty=!1}return this._totalDuration}return W&&this.totalDuration()?this.timeScale(this._totalDuration/W):this},X.paused=function(W){if(W===!1&&this._paused)for(var _e=this._first;_e;)_e._startTime===this._time&&_e.data==="isPause"&&(_e._rawPrevTime=0),_e=_e._next;return u.prototype.paused.apply(this,arguments)},X.usesFrames=function(){for(var W=this._timeline;W._timeline;)W=W._timeline;return W===u._rootFramesTimeline},X.rawTime=function(W){return W&&(this._paused||this._repeat&&this.time()>0&&this.totalProgress()<1)?this._totalTime%(this._duration+this._repeatDelay):this._paused?this._totalTime:(this._timeline.rawTime(W)-this._startTime)*this._timeScale},v},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(u,a,s){var v=function(Z){u.call(this,Z),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=!!this.vars.yoyo,this._dirty=!0},x=1e-8,M=a._internals,I=M.lazyTweens,B=M.lazyRender,U=_gsScope._gsDefine.globals,j=new s(null,null,1,0),te=v.prototype=new u;return te.constructor=v,te.kill()._gc=!1,v.version="2.1.3",te.invalidate=function(){return this._yoyo=!!this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),u.prototype.invalidate.call(this)},te.addCallback=function(Z,oe,le,se){return this.add(a.delayedCall(0,Z,le,se),oe)},te.removeCallback=function(Z,oe){if(Z)if(oe==null)this._kill(null,Z);else for(var le=this.getTweensOf(Z,!1),se=le.length,ve=this._parseTimeOrLabel(oe);--se>-1;)le[se]._startTime===ve&&le[se]._enabled(!1,!1);return this},te.removePause=function(Z){return this.removeCallback(u._internals.pauseCallback,Z)},te.tweenTo=function(Z,oe){oe=oe||{};var le={ease:j,useFrames:this.usesFrames(),immediateRender:!1,lazy:!1},se=oe.repeat&&U.TweenMax||a,ve,ce,K;for(ce in oe)le[ce]=oe[ce];return le.time=this._parseTimeOrLabel(Z),ve=Math.abs(Number(le.time)-this._time)/this._timeScale||.001,K=new se(this,ve,le),le.onStart=function(){K.target.paused(!0),K.vars.time!==K.target.time()&&ve===K.duration()&&!K.isFromTo&&K.duration(Math.abs(K.vars.time-K.target.time())/K.target._timeScale).render(K.time(),!0,!0),oe.onStart&&oe.onStart.apply(oe.onStartScope||oe.callbackScope||K,oe.onStartParams||[])},K},te.tweenFromTo=function(Z,oe,le){le=le||{},Z=this._parseTimeOrLabel(Z),le.startAt={onComplete:this.seek,onCompleteParams:[Z],callbackScope:this},le.immediateRender=le.immediateRender!==!1;var se=this.tweenTo(oe,le);return se.isFromTo=1,se.duration(Math.abs(se.vars.time-Z)/this._timeScale||.001)},te.render=function(Z,oe,le){this._gc&&this._enabled(!0,!1);var se=this,ve=se._time,ce=se._dirty?se.totalDuration():se._totalDuration,K=se._duration,X=se._totalTime,W=se._startTime,_e=se._timeScale,ge=se._rawPrevTime,Ae=se._paused,ee=se._cycle,$,ae,Re,pe,he,we,Ce,Ne,Ze;if(ve!==se._time&&(Z+=se._time-ve),Z>=ce-x&&Z>=0)se._locked||(se._totalTime=ce,se._cycle=se._repeat),se._reversed||se._hasPausedChild()||(ae=!0,pe="onComplete",he=!!se._timeline.autoRemoveChildren,se._duration===0&&(Z<=0&&Z>=-x||ge<0||ge===x)&&ge!==Z&&se._first&&(he=!0,ge>x&&(pe="onReverseComplete"))),se._rawPrevTime=se._duration||!oe||Z||se._rawPrevTime===Z?Z:x,se._yoyo&&se._cycle&1?se._time=Z=0:(se._time=K,Z=K+1e-4);else if(Z<x)if(se._locked||(se._totalTime=se._cycle=0),se._time=0,Z>-x&&(Z=0),(ve!==0||K===0&&ge!==x&&(ge>0||Z<0&&ge>=0)&&!se._locked)&&(pe="onReverseComplete",ae=se._reversed),Z<0)se._active=!1,se._timeline.autoRemoveChildren&&se._reversed?(he=ae=!0,pe="onReverseComplete"):ge>=0&&se._first&&(he=!0),se._rawPrevTime=Z;else{if(se._rawPrevTime=K||!oe||Z||se._rawPrevTime===Z?Z:x,Z===0&&ae)for($=se._first;$&&$._startTime===0;)$._duration||(ae=!1),$=$._next;Z=0,se._initted||(he=!0)}else K===0&&ge<0&&(he=!0),se._time=se._rawPrevTime=Z,se._locked||(se._totalTime=Z,se._repeat!==0&&(we=K+se._repeatDelay,se._cycle=se._totalTime/we>>0,se._cycle&&se._cycle===se._totalTime/we&&X<=Z&&se._cycle--,se._time=se._totalTime-se._cycle*we,se._yoyo&&se._cycle&1&&(se._time=K-se._time),se._time>K?(se._time=K,Z=K+1e-4):se._time<0?se._time=Z=0:Z=se._time));if(se._hasPause&&!se._forcingPlayhead&&!oe){if(Z=se._time,Z>ve||se._repeat&&ee!==se._cycle)for($=se._first;$&&$._startTime<=Z&&!Ce;)$._duration||$.data==="isPause"&&!$.ratio&&!($._startTime===0&&se._rawPrevTime===0)&&(Ce=$),$=$._next;else for($=se._last;$&&$._startTime>=Z&&!Ce;)$._duration||$.data==="isPause"&&$._rawPrevTime>0&&(Ce=$),$=$._prev;Ce&&(Ze=se._startTime+(se._reversed?se._duration-Ce._startTime:Ce._startTime)/se._timeScale,Ce._startTime<K&&(se._time=se._rawPrevTime=Z=Ce._startTime,se._totalTime=Z+se._cycle*(se._totalDuration+se._repeatDelay)))}if(se._cycle!==ee&&!se._locked){var Ye=se._yoyo&&(ee&1)!==0,it=Ye===(se._yoyo&&(se._cycle&1)!==0),_t=se._totalTime,At=se._cycle,vt=se._rawPrevTime,ut=se._time;if(se._totalTime=ee*K,se._cycle<ee?Ye=!Ye:se._totalTime+=K,se._time=ve,se._rawPrevTime=K===0?ge-1e-4:ge,se._cycle=ee,se._locked=!0,ve=Ye?0:K,se.render(ve,oe,K===0),oe||se._gc||se.vars.onRepeat&&(se._cycle=At,se._locked=!1,se._callback("onRepeat")),ve!==se._time||(it&&(se._cycle=ee,se._locked=!0,ve=Ye?K+1e-4:-1e-4,se.render(ve,!0,!1)),se._locked=!1,se._paused&&!Ae))return;se._time=ut,se._totalTime=_t,se._cycle=At,se._rawPrevTime=vt}if((se._time===ve||!se._first)&&!le&&!he&&!Ce){X!==se._totalTime&&se._onUpdate&&(oe||se._callback("onUpdate"));return}else se._initted||(se._initted=!0);if(se._active||!se._paused&&se._totalTime!==X&&Z>0&&(se._active=!0),X===0&&se.vars.onStart&&(se._totalTime!==0||!se._totalDuration)&&(oe||se._callback("onStart")),Ne=se._time,Ne>=ve)for($=se._first;$&&(Re=$._next,!(Ne!==se._time||se._paused&&!Ae));)($._active||$._startTime<=se._time&&!$._paused&&!$._gc)&&(Ce===$&&(se.pause(),se._pauseTime=Ze),$._reversed?$.render(($._dirty?$.totalDuration():$._totalDuration)-(Z-$._startTime)*$._timeScale,oe,le):$.render((Z-$._startTime)*$._timeScale,oe,le)),$=Re;else for($=se._last;$&&(Re=$._prev,!(Ne!==se._time||se._paused&&!Ae));){if($._active||$._startTime<=ve&&!$._paused&&!$._gc){if(Ce===$){for(Ce=$._prev;Ce&&Ce.endTime()>se._time;)Ce.render(Ce._reversed?Ce.totalDuration()-(Z-Ce._startTime)*Ce._timeScale:(Z-Ce._startTime)*Ce._timeScale,oe,le),Ce=Ce._prev;Ce=null,se.pause(),se._pauseTime=Ze}$._reversed?$.render(($._dirty?$.totalDuration():$._totalDuration)-(Z-$._startTime)*$._timeScale,oe,le):$.render((Z-$._startTime)*$._timeScale,oe,le)}$=Re}se._onUpdate&&(oe||(I.length&&B(),se._callback("onUpdate"))),pe&&(se._locked||se._gc||(W===se._startTime||_e!==se._timeScale)&&(se._time===0||ce>=se.totalDuration())&&(ae&&(I.length&&B(),se._timeline.autoRemoveChildren&&se._enabled(!1,!1),se._active=!1),!oe&&se.vars[pe]&&se._callback(pe)))},te.getActive=function(Z,oe,le){var se=[],ve=this.getChildren(Z||Z==null,oe||Z==null,!!le),ce=0,K=ve.length,X,W;for(X=0;X<K;X++)W=ve[X],W.isActive()&&(se[ce++]=W);return se},te.getLabelAfter=function(Z){Z||Z!==0&&(Z=this._time);var oe=this.getLabelsArray(),le=oe.length,se;for(se=0;se<le;se++)if(oe[se].time>Z)return oe[se].name;return null},te.getLabelBefore=function(Z){Z==null&&(Z=this._time);for(var oe=this.getLabelsArray(),le=oe.length;--le>-1;)if(oe[le].time<Z)return oe[le].name;return null},te.getLabelsArray=function(){var Z=[],oe=0,le;for(le in this._labels)Z[oe++]={time:this._labels[le],name:le};return Z.sort(function(se,ve){return se.time-ve.time}),Z},te.invalidate=function(){return this._locked=!1,u.prototype.invalidate.call(this)},te.progress=function(Z,oe){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&this._cycle&1?1-Z:Z)+this._cycle*(this._duration+this._repeatDelay),oe):this._time/this.duration()||0},te.totalProgress=function(Z,oe){return arguments.length?this.totalTime(this.totalDuration()*Z,oe):this._totalTime/this.totalDuration()||0},te.totalDuration=function(Z){return arguments.length?this._repeat===-1||!Z?this:this.timeScale(this.totalDuration()/Z):(this._dirty&&(u.prototype.totalDuration.call(this),this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},te.time=function(Z,oe){if(!arguments.length)return this._time;this._dirty&&this.totalDuration();var le=this._duration,se=this._cycle,ve=se*(le+this._repeatDelay);return Z>le&&(Z=le),this.totalTime(this._yoyo&&se&1?le-Z+ve:this._repeat?Z+ve:Z,oe)},te.repeat=function(Z){return arguments.length?(this._repeat=Z,this._uncache(!0)):this._repeat},te.repeatDelay=function(Z){return arguments.length?(this._repeatDelay=Z,this._uncache(!0)):this._repeatDelay},te.yoyo=function(Z){return arguments.length?(this._yoyo=Z,this):this._yoyo},te.currentLabel=function(Z){return arguments.length?this.seek(Z,!0):this.getLabelBefore(this._time+x)},v},!0),function(){var u=180/Math.PI,a=[],s=[],v=[],x={},M=_gsScope._gsDefine.globals,I=function(K,X,W,_e){W===_e&&(W=_e-(_e-X)/1e6),K===X&&(X=K+(W-K)/1e6),this.a=K,this.b=X,this.c=W,this.d=_e,this.da=_e-K,this.ca=W-K,this.ba=X-K},B=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",U=function(K,X,W,_e){var ge={a:K},Ae={},ee={},$={c:_e},ae=(K+X)/2,Re=(X+W)/2,pe=(W+_e)/2,he=(ae+Re)/2,we=(Re+pe)/2,Ce=(we-he)/8;return ge.b=ae+(K-ae)/4,Ae.b=he+Ce,ge.c=Ae.a=(ge.b+Ae.b)/2,Ae.c=ee.a=(he+we)/2,ee.b=we-Ce,$.b=pe+(_e-pe)/4,ee.c=$.a=(ee.b+$.b)/2,[ge,Ae,ee,$]},j=function(K,X,W,_e,ge){var Ae=K.length-1,ee=0,$=K[0].a,ae,Re,pe,he,we,Ce,Ne,Ze,Ye,it,_t,At,vt;for(ae=0;ae<Ae;ae++)we=K[ee],Re=we.a,pe=we.d,he=K[ee+1].d,ge?(_t=a[ae],At=s[ae],vt=(At+_t)*X*.25/(_e?.5:v[ae]||.5),Ce=pe-(pe-Re)*(_e?X*.5:_t!==0?vt/_t:0),Ne=pe+(he-pe)*(_e?X*.5:At!==0?vt/At:0),Ze=pe-(Ce+((Ne-Ce)*(_t*3/(_t+At)+.5)/4||0))):(Ce=pe-(pe-Re)*X*.5,Ne=pe+(he-pe)*X*.5,Ze=pe-(Ce+Ne)/2),Ce+=Ze,Ne+=Ze,we.c=Ye=Ce,ae!==0?we.b=$:we.b=$=we.a+(we.c-we.a)*.6,we.da=pe-Re,we.ca=Ye-Re,we.ba=$-Re,W?(it=U(Re,$,Ye,pe),K.splice(ee,1,it[0],it[1],it[2],it[3]),ee+=4):ee++,$=Ne;we=K[ee],we.b=$,we.c=$+(we.d-$)*.4,we.da=we.d-we.a,we.ca=we.c-we.a,we.ba=$-we.a,W&&(it=U(we.a,$,we.c,we.d),K.splice(ee,1,it[0],it[1],it[2],it[3]))},te=function(K,X,W,_e){var ge=[],Ae,ee,$,ae,Re,pe;if(_e)for(K=[_e].concat(K),ee=K.length;--ee>-1;)typeof(pe=K[ee][X])=="string"&&pe.charAt(1)==="="&&(K[ee][X]=_e[X]+Number(pe.charAt(0)+pe.substr(2)));if(Ae=K.length-2,Ae<0)return ge[0]=new I(K[0][X],0,0,K[0][X]),ge;for(ee=0;ee<Ae;ee++)$=K[ee][X],ae=K[ee+1][X],ge[ee]=new I($,0,0,ae),W&&(Re=K[ee+2][X],a[ee]=(a[ee]||0)+(ae-$)*(ae-$),s[ee]=(s[ee]||0)+(Re-ae)*(Re-ae));return ge[ee]=new I(K[ee][X],0,0,K[ee+1][X]),ge},Z=function(K,X,W,_e,ge,Ae){var ee={},$=[],ae=Ae||K[0],Re,pe,he,we,Ce,Ne,Ze,Ye;ge=typeof ge=="string"?","+ge+",":B,X==null&&(X=1);for(pe in K[0])$.push(pe);if(K.length>1){for(Ye=K[K.length-1],Ze=!0,Re=$.length;--Re>-1;)if(pe=$[Re],Math.abs(ae[pe]-Ye[pe])>.05){Ze=!1;break}Ze&&(K=K.concat(),Ae&&K.unshift(Ae),K.push(K[1]),Ae=K[K.length-3])}for(a.length=s.length=v.length=0,Re=$.length;--Re>-1;)pe=$[Re],x[pe]=ge.indexOf(","+pe+",")!==-1,ee[pe]=te(K,pe,x[pe],Ae);for(Re=a.length;--Re>-1;)a[Re]=Math.sqrt(a[Re]),s[Re]=Math.sqrt(s[Re]);if(!_e){for(Re=$.length;--Re>-1;)if(x[pe])for(he=ee[$[Re]],Ne=he.length-1,we=0;we<Ne;we++)Ce=he[we+1].da/s[we]+he[we].da/a[we]||0,v[we]=(v[we]||0)+Ce*Ce;for(Re=v.length;--Re>-1;)v[Re]=Math.sqrt(v[Re])}for(Re=$.length,we=W?4:1;--Re>-1;)pe=$[Re],he=ee[pe],j(he,X,W,_e,x[pe]),Ze&&(he.splice(0,we),he.splice(he.length-we,we));return ee},oe=function(K,X,W){X=X||"soft";var _e={},ge=X==="cubic"?3:2,Ae=X==="soft",ee=[],$,ae,Re,pe,he,we,Ce,Ne,Ze,Ye,it;if(Ae&&W&&(K=[W].concat(K)),K==null||K.length<ge+1)throw"invalid Bezier data";for(Ze in K[0])ee.push(Ze);for(we=ee.length;--we>-1;){for(Ze=ee[we],_e[Ze]=he=[],Ye=0,Ne=K.length,Ce=0;Ce<Ne;Ce++)$=W==null?K[Ce][Ze]:typeof(it=K[Ce][Ze])=="string"&&it.charAt(1)==="="?W[Ze]+Number(it.charAt(0)+it.substr(2)):Number(it),Ae&&Ce>1&&Ce<Ne-1&&(he[Ye++]=($+he[Ye-2])/2),he[Ye++]=$;for(Ne=Ye-ge+1,Ye=0,Ce=0;Ce<Ne;Ce+=ge)$=he[Ce],ae=he[Ce+1],Re=he[Ce+2],pe=ge===2?0:he[Ce+3],he[Ye++]=it=ge===3?new I($,ae,Re,pe):new I($,(2*ae+$)/3,(2*ae+Re)/3,Re);he.length=Ye}return _e},le=function(K,X,W){for(var _e=1/W,ge=K.length,Ae,ee,$,ae,Re,pe,he,we,Ce,Ne,Ze;--ge>-1;)for(Ne=K[ge],$=Ne.a,ae=Ne.d-$,Re=Ne.c-$,pe=Ne.b-$,Ae=ee=0,we=1;we<=W;we++)he=_e*we,Ce=1-he,Ae=ee-(ee=(he*he*ae+3*Ce*(he*Re+Ce*pe))*he),Ze=ge*W+we-1,X[Ze]=(X[Ze]||0)+Ae*Ae},se=function(K,X){X=X>>0||6;var W=[],_e=[],ge=0,Ae=0,ee=X-1,$=[],ae=[],Re,pe,he,we;for(Re in K)le(K[Re],W,X);for(he=W.length,pe=0;pe<he;pe++)ge+=Math.sqrt(W[pe]),we=pe%X,ae[we]=ge,we===ee&&(Ae+=ge,we=pe/X>>0,$[we]=ae,_e[we]=Ae,ge=0,ae=[]);return{length:Ae,lengths:_e,segments:$}},ve=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.9",API:2,global:!0,init:function(K,X,W){this._target=K,X instanceof Array&&(X={values:X}),this._func={},this._mod={},this._props=[],this._timeRes=X.timeResolution==null?6:parseInt(X.timeResolution,10);var _e=X.values||[],ge={},Ae=_e[0],ee=X.autoRotate||W.vars.orientToBezier,$,ae,Re,pe,he;this._autoRotate=ee?ee instanceof Array?ee:[["x","y","rotation",ee===!0?0:Number(ee)||0]]:null;for($ in Ae)this._props.push($);for(Re=this._props.length;--Re>-1;)$=this._props[Re],this._overwriteProps.push($),ae=this._func[$]=typeof K[$]=="function",ge[$]=ae?K[$.indexOf("set")||typeof K["get"+$.substr(3)]!="function"?$:"get"+$.substr(3)]():parseFloat(K[$]),he||ge[$]!==_e[0][$]&&(he=ge);if(this._beziers=X.type!=="cubic"&&X.type!=="quadratic"&&X.type!=="soft"?Z(_e,isNaN(X.curviness)?1:X.curviness,!1,X.type==="thruBasic",X.correlate,he):oe(_e,X.type,ge),this._segCount=this._beziers[$].length,this._timeRes){var we=se(this._beziers,this._timeRes);this._length=we.length,this._lengths=we.lengths,this._segments=we.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(ee=this._autoRotate)for(this._initialRotations=[],ee[0]instanceof Array||(this._autoRotate=ee=[ee]),Re=ee.length;--Re>-1;){for(pe=0;pe<3;pe++)$=ee[Re][pe],this._func[$]=typeof K[$]=="function"?K[$.indexOf("set")||typeof K["get"+$.substr(3)]!="function"?$:"get"+$.substr(3)]:!1;$=ee[Re][2],this._initialRotations[Re]=(this._func[$]?this._func[$].call(this._target):this._target[$])||0,this._overwriteProps.push($)}return this._startRatio=W.vars.runBackwards?1:0,!0},set:function(K){var X=this._segCount,W=this._func,_e=this._target,ge=K!==this._startRatio,Ae,ee,$,ae,Re,pe,he,we,Ce,Ne,Ze;if(!this._timeRes)Ae=K<0?0:K>=1?X-1:X*K>>0,pe=(K-Ae*(1/X))*X;else{if(Ce=this._lengths,Ne=this._curSeg,Ze=K*this._length,$=this._li,Ze>this._l2&&$<X-1){for(we=X-1;$<we&&(this._l2=Ce[++$])<=Ze;);this._l1=Ce[$-1],this._li=$,this._curSeg=Ne=this._segments[$],this._s2=Ne[this._s1=this._si=0]}else if(Ze<this._l1&&$>0){for(;$>0&&(this._l1=Ce[--$])>=Ze;);$===0&&Ze<this._l1?this._l1=0:$++,this._l2=Ce[$],this._li=$,this._curSeg=Ne=this._segments[$],this._s1=Ne[(this._si=Ne.length-1)-1]||0,this._s2=Ne[this._si]}if(Ae=$,Ze-=this._l1,$=this._si,Ze>this._s2&&$<Ne.length-1){for(we=Ne.length-1;$<we&&(this._s2=Ne[++$])<=Ze;);this._s1=Ne[$-1],this._si=$}else if(Ze<this._s1&&$>0){for(;$>0&&(this._s1=Ne[--$])>=Ze;);$===0&&Ze<this._s1?this._s1=0:$++,this._s2=Ne[$],this._si=$}pe=K===1?1:($+(Ze-this._s1)/(this._s2-this._s1))*this._prec||0}for(ee=1-pe,$=this._props.length;--$>-1;)ae=this._props[$],Re=this._beziers[ae][Ae],he=(pe*pe*Re.da+3*ee*(pe*Re.ca+ee*Re.ba))*pe+Re.a,this._mod[ae]&&(he=this._mod[ae](he,_e)),W[ae]?_e[ae](he):_e[ae]=he;if(this._autoRotate){var Ye=this._autoRotate,it,_t,At,vt,ut,Nt,Qt;for($=Ye.length;--$>-1;)ae=Ye[$][2],Nt=Ye[$][3]||0,Qt=Ye[$][4]===!0?1:u,Re=this._beziers[Ye[$][0]],it=this._beziers[Ye[$][1]],Re&&it&&(Re=Re[Ae],it=it[Ae],_t=Re.a+(Re.b-Re.a)*pe,vt=Re.b+(Re.c-Re.b)*pe,_t+=(vt-_t)*pe,vt+=(Re.c+(Re.d-Re.c)*pe-vt)*pe,At=it.a+(it.b-it.a)*pe,ut=it.b+(it.c-it.b)*pe,At+=(ut-At)*pe,ut+=(it.c+(it.d-it.c)*pe-ut)*pe,he=ge?Math.atan2(ut-At,vt-_t)*Qt+Nt:this._initialRotations[$],this._mod[ae]&&(he=this._mod[ae](he,_e)),W[ae]?_e[ae](he):_e[ae]=he)}}}),ce=ve.prototype;ve.bezierThrough=Z,ve.cubicToQuadratic=U,ve._autoCSS=!0,ve.quadraticToCubic=function(K,X,W){return new I(K,(2*X+K)/3,(2*X+W)/3,W)},ve._cssRegister=function(){var K=M.CSSPlugin;if(K){var X=K._internals,W=X._parseToProxy,_e=X._setPluginRatio,ge=X.CSSPropTween;X._registerComplexSpecialProp("bezier",{parser:function(Ae,ee,$,ae,Re,pe){ee instanceof Array&&(ee={values:ee}),pe=new ve;var he=ee.values,we=he.length-1,Ce=[],Ne={},Ze,Ye,it;if(we<0)return Re;for(Ze=0;Ze<=we;Ze++)it=W(Ae,he[Ze],ae,Re,pe,we!==Ze),Ce[Ze]=it.end;for(Ye in ee)Ne[Ye]=ee[Ye];return Ne.values=Ce,Re=new ge(Ae,"bezier",0,0,it.pt,2),Re.data=it,Re.plugin=pe,Re.setRatio=_e,Ne.autoRotate===0&&(Ne.autoRotate=!0),Ne.autoRotate&&!(Ne.autoRotate instanceof Array)&&(Ze=Ne.autoRotate===!0?0:Number(Ne.autoRotate),Ne.autoRotate=it.end.left!=null?[["left","top","rotation",Ze,!1]]:it.end.x!=null?[["x","y","rotation",Ze,!1]]:!1),Ne.autoRotate&&(ae._transform||ae._enableTransforms(!1),it.autoRotate=ae._target._gsTransform,it.proxy.rotation=it.autoRotate.rotation||0,ae._overwriteProps.push("rotation")),pe._onInitTween(it.proxy,Ne,ae._tween),Re}})}},ce._mod=function(K){for(var X=this._overwriteProps,W=X.length,_e;--W>-1;)_e=K[X[W]],_e&&typeof _e=="function"&&(this._mod[X[W]]=_e)},ce._kill=function(K){var X=this._props,W,_e;for(W in this._beziers)if(W in K)for(delete this._beziers[W],delete this._func[W],_e=X.length;--_e>-1;)X[_e]===W&&X.splice(_e,1);if(X=this._autoRotate,X)for(_e=X.length;--_e>-1;)K[X[_e][2]]&&X.splice(_e,1);return this._super._kill.call(this,K)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(u,a){var s=function(){u.call(this,"css"),this._overwriteProps.length=0,this.setRatio=s.prototype.setRatio},v=_gsScope._gsDefine.globals,x,M,I,B,U={},j=s.prototype=new u("css");j.constructor=s,s.version="2.1.3",s.API=2,s.defaultTransformPerspective=0,s.defaultSkewType="compensated",s.defaultSmoothOrigin=!0,j="px",s.suffixMap={top:j,right:j,bottom:j,left:j,width:j,height:j,fontSize:j,padding:j,margin:j,perspective:j,lineHeight:""};var te=/(?:\-|\.|\b)(\d|\.|e\-)+/g,Z=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,oe=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,le=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b),?/gi,se=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,ve=/(?:\d|\-|\+|=|#|\.)*/g,ce=/opacity *= *([^)]*)/i,K=/opacity:([^;]*)/i,X=/alpha\(opacity *=.+?\)/i,W=/^(rgb|hsl)/,_e=/([A-Z])/g,ge=/-([a-z])/gi,Ae=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,ee=function(Pe,Le){return Le.toUpperCase()},$=/(?:Left|Right|Width)/i,ae=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,Re=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,pe=/,(?=[^\)]*(?:\(|$))/gi,he=/[\s,\(]/i,we=Math.PI/180,Ce=180/Math.PI,Ne={},Ze={style:{}},Ye=_gsScope.document||{createElement:function(){return Ze}},it=function(Pe,Le){var ct=Ye.createElementNS?Ye.createElementNS(Le||"http://www.w3.org/1999/xhtml",Pe):Ye.createElement(Pe);return ct.style?ct:Ye.createElement(Pe)},_t=it("div"),At=it("img"),vt=s._internals={_specialProps:U},ut=(_gsScope.navigator||{}).userAgent||"",Nt,Qt,Qe,ft,bt,sn,bn=function(){var Pe=ut.indexOf("Android"),Le=it("a");return Qe=ut.indexOf("Safari")!==-1&&ut.indexOf("Chrome")===-1&&(Pe===-1||parseFloat(ut.substr(Pe+8,2))>3),bt=Qe&&parseFloat(ut.substr(ut.indexOf("Version/")+8,2))<6,ft=ut.indexOf("Firefox")!==-1,(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(ut)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(ut))&&(sn=parseFloat(RegExp.$1)),Le?(Le.style.cssText="top:1px;opacity:.55;",/^0.55/.test(Le.style.opacity)):!1}(),Un=function(Pe){return ce.test(typeof Pe=="string"?Pe:(Pe.currentStyle?Pe.currentStyle.filter:Pe.style.filter)||"")?parseFloat(RegExp.$1)/100:1},pi=function(Pe){_gsScope.console&&console.log(Pe)},Xe,Xt,tn="",dn="",pn=function(Pe,Le){Le=Le||_t;var ct=Le.style,ht,Ke;if(ct[Pe]!==void 0)return Pe;for(Pe=Pe.charAt(0).toUpperCase()+Pe.substr(1),ht=["O","Moz","ms","Ms","Webkit"],Ke=5;--Ke>-1&&ct[ht[Ke]+Pe]===void 0;);return Ke>=0?(dn=Ke===3?"ms":ht[Ke],tn="-"+dn.toLowerCase()+"-",dn+Pe):null},Pn=typeof window<"u"?window:Ye.defaultView||{getComputedStyle:function(){}},Cn=function(Pe){return Pn.getComputedStyle(Pe)},vn=s.getStyle=function(Pe,Le,ct,ht,Ke){var Lt;return!bn&&Le==="opacity"?Un(Pe):(!ht&&Pe.style[Le]?Lt=Pe.style[Le]:(ct=ct||Cn(Pe))?Lt=ct[Le]||ct.getPropertyValue(Le)||ct.getPropertyValue(Le.replace(_e,"-$1").toLowerCase()):Pe.currentStyle&&(Lt=Pe.currentStyle[Le]),Ke!=null&&(!Lt||Lt==="none"||Lt==="auto"||Lt==="auto auto")?Ke:Lt)},In=vt.convertToPixels=function(Pe,Le,ct,ht,Ke){if(ht==="px"||!ht&&Le!=="lineHeight")return ct;if(ht==="auto"||!ct)return 0;var Lt=$.test(Le),dt=Pe,Wt=_t.style,rn=ct<0,on=ct===1,gn,Xn,an;if(rn&&(ct=-ct),on&&(ct*=100),Le==="lineHeight"&&!ht)Xn=Cn(Pe).lineHeight,Pe.style.lineHeight=ct,gn=parseFloat(Cn(Pe).lineHeight),Pe.style.lineHeight=Xn;else if(ht==="%"&&Le.indexOf("border")!==-1)gn=ct/100*(Lt?Pe.clientWidth:Pe.clientHeight);else{if(Wt.cssText="border:0 solid red;position:"+vn(Pe,"position")+";line-height:0;",ht==="%"||!dt.appendChild||ht.charAt(0)==="v"||ht==="rem"){if(dt=Pe.parentNode||Ye.body,vn(dt,"display").indexOf("flex")!==-1&&(Wt.position="absolute"),Xn=dt._gsCache,an=a.ticker.frame,Xn&&Lt&&Xn.time===an)return Xn.width*ct/100;Wt[Lt?"width":"height"]=ct+ht}else Wt[Lt?"borderLeftWidth":"borderTopWidth"]=ct+ht;dt.appendChild(_t),gn=parseFloat(_t[Lt?"offsetWidth":"offsetHeight"]),dt.removeChild(_t),Lt&&ht==="%"&&s.cacheWidths!==!1&&(Xn=dt._gsCache=dt._gsCache||{},Xn.time=an,Xn.width=gn/ct*100),gn===0&&!Ke&&(gn=In(Pe,Le,ct,ht,!0))}return on&&(gn/=100),rn?-gn:gn},Fn=vt.calculateOffset=function(Pe,Le,ct){if(vn(Pe,"position",ct)!=="absolute")return 0;var ht=Le==="left"?"Left":"Top",Ke=vn(Pe,"margin"+ht,ct);return Pe["offset"+ht]-(In(Pe,Le,parseFloat(Ke),Ke.replace(ve,""))||0)},Hn=function(Pe,Le){var ct={},ht,Ke,Lt;if(Le=Le||Cn(Pe))if(ht=Le.length)for(;--ht>-1;)Lt=Le[ht],(Lt.indexOf("-transform")===-1||cs===Lt)&&(ct[Lt.replace(ge,ee)]=Le.getPropertyValue(Lt));else for(ht in Le)(ht.indexOf("Transform")===-1||Xr===ht)&&(ct[ht]=Le[ht]);else if(Le=Pe.currentStyle||Pe.style)for(ht in Le)typeof ht=="string"&&ct[ht]===void 0&&(ct[ht.replace(ge,ee)]=Le[ht]);return bn||(ct.opacity=Un(Pe)),Ke=Vn(Pe,Le,!1),ct.rotation=Ke.rotation,ct.skewX=Ke.skewX,ct.scaleX=Ke.scaleX,ct.scaleY=Ke.scaleY,ct.x=Ke.x,ct.y=Ke.y,Zr&&(ct.z=Ke.z,ct.rotationX=Ke.rotationX,ct.rotationY=Ke.rotationY,ct.scaleZ=Ke.scaleZ),ct.filters&&delete ct.filters,ct},fe=function(Pe,Le,ct,ht,Ke){var Lt={},dt=Pe.style,Wt,rn,on;for(rn in ct)rn!=="cssText"&&rn!=="length"&&isNaN(rn)&&(Le[rn]!==(Wt=ct[rn])||Ke&&Ke[rn])&&rn.indexOf("Origin")===-1&&(typeof Wt=="number"||typeof Wt=="string")&&(Lt[rn]=Wt==="auto"&&(rn==="left"||rn==="top")?Fn(Pe,rn):(Wt===""||Wt==="auto"||Wt==="none")&&typeof Le[rn]=="string"&&Le[rn].replace(se,"")!==""?0:Wt,dt[rn]!==void 0&&(on=new Mr(dt,rn,dt[rn],on)));if(ht)for(rn in ht)rn!=="className"&&(Lt[rn]=ht[rn]);return{difs:Lt,firstMPT:on}},Se={width:["Left","Right"],height:["Top","Bottom"]},Ve=["marginLeft","marginRight","marginTop","marginBottom"],We=function(Pe,Le,ct){if((Pe.nodeName+"").toLowerCase()==="svg")return(ct||Cn(Pe))[Le]||0;if(Pe.getCTM&&Lo(Pe))return Pe.getBBox()[Le]||0;var ht=parseFloat(Le==="width"?Pe.offsetWidth:Pe.offsetHeight),Ke=Se[Le],Lt=Ke.length;for(ct=ct||Cn(Pe);--Lt>-1;)ht-=parseFloat(vn(Pe,"padding"+Ke[Lt],ct,!0))||0,ht-=parseFloat(vn(Pe,"border"+Ke[Lt]+"Width",ct,!0))||0;return ht},pt=function(Pe,Le){if(Pe==="contain"||Pe==="auto"||Pe==="auto auto")return Pe+" ";(Pe==null||Pe==="")&&(Pe="0 0");var ct=Pe.split(" "),ht=Pe.indexOf("left")!==-1?"0%":Pe.indexOf("right")!==-1?"100%":ct[0],Ke=Pe.indexOf("top")!==-1?"0%":Pe.indexOf("bottom")!==-1?"100%":ct[1],Lt;if(ct.length>3&&!Le){for(ct=Pe.split(", ").join(",").split(","),Pe=[],Lt=0;Lt<ct.length;Lt++)Pe.push(pt(ct[Lt]));return Pe.join(",")}return Ke==null?Ke=ht==="center"?"50%":"0":Ke==="center"&&(Ke="50%"),(ht==="center"||isNaN(parseFloat(ht))&&(ht+"").indexOf("=")===-1)&&(ht="50%"),Pe=ht+" "+Ke+(ct.length>2?" "+ct[2]:""),Le&&(Le.oxp=ht.indexOf("%")!==-1,Le.oyp=Ke.indexOf("%")!==-1,Le.oxr=ht.charAt(1)==="=",Le.oyr=Ke.charAt(1)==="=",Le.ox=parseFloat(ht.replace(se,"")),Le.oy=parseFloat(Ke.replace(se,"")),Le.v=Pe),Le||Pe},It=function(Pe,Le){return typeof Pe=="function"&&(Pe=Pe(Xt,Xe)),typeof Pe=="string"&&Pe.charAt(1)==="="?parseInt(Pe.charAt(0)+"1",10)*parseFloat(Pe.substr(2)):parseFloat(Pe)-parseFloat(Le)||0},$t=function(Pe,Le){typeof Pe=="function"&&(Pe=Pe(Xt,Xe));var ct=typeof Pe=="string"&&Pe.charAt(1)==="=";return typeof Pe=="string"&&Pe.charAt(Pe.length-2)==="v"&&(Pe=(ct?Pe.substr(0,2):0)+window["inner"+(Pe.substr(-2)==="vh"?"Height":"Width")]*(parseFloat(ct?Pe.substr(2):Pe)/100)),Pe==null?Le:ct?parseInt(Pe.charAt(0)+"1",10)*parseFloat(Pe.substr(2))+Le:parseFloat(Pe)||0},nn=function(Pe,Le,ct,ht){var Ke=1e-6,Lt,dt,Wt,rn,on;return typeof Pe=="function"&&(Pe=Pe(Xt,Xe)),Pe==null?rn=Le:typeof Pe=="number"?rn=Pe:(Lt=360,dt=Pe.split("_"),on=Pe.charAt(1)==="=",Wt=(on?parseInt(Pe.charAt(0)+"1",10)*parseFloat(dt[0].substr(2)):parseFloat(dt[0]))*(Pe.indexOf("rad")===-1?1:Ce)-(on?0:Le),dt.length&&(ht&&(ht[ct]=Le+Wt),Pe.indexOf("short")!==-1&&(Wt=Wt%Lt,Wt!==Wt%(Lt/2)&&(Wt=Wt<0?Wt+Lt:Wt-Lt)),Pe.indexOf("_cw")!==-1&&Wt<0?Wt=(Wt+Lt*9999999999)%Lt-(Wt/Lt|0)*Lt:Pe.indexOf("ccw")!==-1&&Wt>0&&(Wt=(Wt-Lt*9999999999)%Lt-(Wt/Lt|0)*Lt)),rn=Le+Wt),rn<Ke&&rn>-Ke&&(rn=0),rn},Ht={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},Wn=function(Pe,Le,ct){return Pe=Pe<0?Pe+1:Pe>1?Pe-1:Pe,(Pe*6<1?Le+(ct-Le)*Pe*6:Pe<.5?ct:Pe*3<2?Le+(ct-Le)*(2/3-Pe)*6:Le)*255+.5|0},Ln=s.parseColor=function(Pe,Le){var ct,ht,Ke,Lt,dt,Wt,rn,on,gn,Xn,an;if(!Pe)ct=Ht.black;else if(typeof Pe=="number")ct=[Pe>>16,Pe>>8&255,Pe&255];else{if(Pe.charAt(Pe.length-1)===","&&(Pe=Pe.substr(0,Pe.length-1)),Ht[Pe])ct=Ht[Pe];else if(Pe.charAt(0)==="#")Pe.length===4&&(ht=Pe.charAt(1),Ke=Pe.charAt(2),Lt=Pe.charAt(3),Pe="#"+ht+ht+Ke+Ke+Lt+Lt),Pe=parseInt(Pe.substr(1),16),ct=[Pe>>16,Pe>>8&255,Pe&255];else if(Pe.substr(0,3)==="hsl"){if(ct=an=Pe.match(te),!Le)dt=Number(ct[0])%360/360,Wt=Number(ct[1])/100,rn=Number(ct[2])/100,Ke=rn<=.5?rn*(Wt+1):rn+Wt-rn*Wt,ht=rn*2-Ke,ct.length>3&&(ct[3]=Number(ct[3])),ct[0]=Wn(dt+1/3,ht,Ke),ct[1]=Wn(dt,ht,Ke),ct[2]=Wn(dt-1/3,ht,Ke);else if(Pe.indexOf("=")!==-1)return Pe.match(Z)}else ct=Pe.match(te)||Ht.transparent;ct[0]=Number(ct[0]),ct[1]=Number(ct[1]),ct[2]=Number(ct[2]),ct.length>3&&(ct[3]=Number(ct[3]))}return Le&&!an&&(ht=ct[0]/255,Ke=ct[1]/255,Lt=ct[2]/255,on=Math.max(ht,Ke,Lt),gn=Math.min(ht,Ke,Lt),rn=(on+gn)/2,on===gn?dt=Wt=0:(Xn=on-gn,Wt=rn>.5?Xn/(2-on-gn):Xn/(on+gn),dt=on===ht?(Ke-Lt)/Xn+(Ke<Lt?6:0):on===Ke?(Lt-ht)/Xn+2:(ht-Ke)/Xn+4,dt*=60),ct[0]=dt+.5|0,ct[1]=Wt*100+.5|0,ct[2]=rn*100+.5|0),ct},Qn=function(Pe,Le){var ct=Pe.match(Nn)||[],ht=0,Ke="",Lt,dt,Wt;if(!ct.length)return Pe;for(Lt=0;Lt<ct.length;Lt++)dt=ct[Lt],Wt=Pe.substr(ht,Pe.indexOf(dt,ht)-ht),ht+=Wt.length+dt.length,dt=Ln(dt,Le),dt.length===3&&dt.push(1),Ke+=Wt+(Le?"hsla("+dt[0]+","+dt[1]+"%,"+dt[2]+"%,"+dt[3]:"rgba("+dt.join(","))+")";return Ke+Pe.substr(ht)},Nn="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(j in Ht)Nn+="|"+j+"\\b";Nn=new RegExp(Nn+")","gi"),s.colorStringFilter=function(Pe){var Le=Pe[0]+" "+Pe[1],ct;Nn.test(Le)&&(ct=Le.indexOf("hsl(")!==-1||Le.indexOf("hsla(")!==-1,Pe[0]=Qn(Pe[0],ct),Pe[1]=Qn(Pe[1],ct)),Nn.lastIndex=0},a.defaultStringFilter||(a.defaultStringFilter=s.colorStringFilter);var Zn=function(Pe,Le,ct,ht){if(Pe==null)return function(an){return an};var Ke=Le?(Pe.match(Nn)||[""])[0]:"",Lt=Pe.split(Ke).join("").match(oe)||[],dt=Pe.substr(0,Pe.indexOf(Lt[0])),Wt=Pe.charAt(Pe.length-1)===")"?")":"",rn=Pe.indexOf(" ")!==-1?" ":",",on=Lt.length,gn=on>0?Lt[0].replace(te,""):"",Xn;return on?Le?(Xn=function(an){var ui,Ai,Bn,Kn;if(typeof an=="number")an+=gn;else if(ht&&pe.test(an)){for(Kn=an.replace(pe,"|").split("|"),Bn=0;Bn<Kn.length;Bn++)Kn[Bn]=Xn(Kn[Bn]);return Kn.join(",")}if(ui=(an.match(Nn)||[Ke])[0],Ai=an.split(ui).join("").match(oe)||[],Bn=Ai.length,on>Bn--)for(;++Bn<on;)Ai[Bn]=ct?Ai[(Bn-1)/2|0]:Lt[Bn];return dt+Ai.join(rn)+rn+ui+Wt+(an.indexOf("inset")!==-1?" inset":"")},Xn):(Xn=function(an){var ui,Ai,Bn;if(typeof an=="number")an+=gn;else if(ht&&pe.test(an)){for(Ai=an.replace(pe,"|").split("|"),Bn=0;Bn<Ai.length;Bn++)Ai[Bn]=Xn(Ai[Bn]);return Ai.join(",")}if(ui=an.match(rn===","?oe:le)||[],Bn=ui.length,on>Bn--)for(;++Bn<on;)ui[Bn]=ct?ui[(Bn-1)/2|0]:Lt[Bn];return(dt&&an!=="none"&&an.substr(0,an.indexOf(ui[0]))||dt)+ui.join(rn)+Wt},Xn):function(an){return an}},Qi=function(Pe){return Pe=Pe.split(","),function(Le,ct,ht,Ke,Lt,dt,Wt){var rn=(ct+"").split(" "),on;for(Wt={},on=0;on<4;on++)Wt[Pe[on]]=rn[on]=rn[on]||rn[(on-1)/2>>0];return Ke.parse(Le,Wt,Lt,dt)}};vt._setPluginRatio=function(Pe){this.plugin.setRatio(Pe);for(var Le=this.data,ct=Le.proxy,ht=Le.firstMPT,Ke=1e-6,Lt,dt,Wt,rn,on;ht;)Lt=ct[ht.v],ht.r?Lt=ht.r(Lt):Lt<Ke&&Lt>-Ke&&(Lt=0),ht.t[ht.p]=Lt,ht=ht._next;if(Le.autoRotate&&(Le.autoRotate.rotation=Le.mod?Le.mod.call(this._tween,ct.rotation,this.t,this._tween):ct.rotation),Pe===1||Pe===0)for(ht=Le.firstMPT,on=Pe===1?"e":"b";ht;){if(dt=ht.t,!dt.type)dt[on]=dt.s+dt.xs0;else if(dt.type===1){for(rn=dt.xs0+dt.s+dt.xs1,Wt=1;Wt<dt.l;Wt++)rn+=dt["xn"+Wt]+dt["xs"+(Wt+1)];dt[on]=rn}ht=ht._next}};var Mr=function(Pe,Le,ct,ht,Ke){this.t=Pe,this.p=Le,this.v=ct,this.r=Ke,ht&&(ht._prev=this,this._next=ht)};vt._parseToProxy=function(Pe,Le,ct,ht,Ke,Lt){var dt=ht,Wt={},rn={},on=ct._transform,gn=Ne,Xn,an,ui,Ai,Bn;for(ct._transform=null,Ne=Le,ht=Bn=ct.parse(Pe,Le,ht,Ke),Ne=gn,Lt&&(ct._transform=on,dt&&(dt._prev=null,dt._prev&&(dt._prev._next=null)));ht&&ht!==dt;){if(ht.type<=1&&(an=ht.p,rn[an]=ht.s+ht.c,Wt[an]=ht.s,Lt||(Ai=new Mr(ht,"s",an,Ai,ht.r),ht.c=0),ht.type===1))for(Xn=ht.l;--Xn>0;)ui="xn"+Xn,an=ht.p+"_"+ui,rn[an]=ht.data[ui],Wt[an]=ht[ui],Lt||(Ai=new Mr(ht,ui,an,Ai,ht.rxp[ui]));ht=ht._next}return{proxy:Wt,end:rn,firstMPT:Ai,pt:Bn}};var ze=vt.CSSPropTween=function(Pe,Le,ct,ht,Ke,Lt,dt,Wt,rn,on,gn){this.t=Pe,this.p=Le,this.s=ct,this.c=ht,this.n=dt||Le,Pe instanceof ze||B.push(this.n),this.r=Wt&&(typeof Wt=="function"?Wt:Math.round),this.type=Lt||0,rn&&(this.pr=rn,x=!0),this.b=on===void 0?ct:on,this.e=gn===void 0?ct+ht:gn,Ke&&(this._next=Ke,Ke._prev=this)},yi=function(Pe,Le,ct,ht,Ke,Lt){var dt=new ze(Pe,Le,ct,ht-ct,Ke,-1,Lt);return dt.b=ct,dt.e=dt.xs0=ht,dt},On=s.parseComplex=function(Pe,Le,ct,ht,Ke,Lt,dt,Wt,rn,on){ct=ct||Lt||"",typeof ht=="function"&&(ht=ht(Xt,Xe)),dt=new ze(Pe,Le,0,0,dt,on?2:1,null,!1,Wt,ct,ht),ht+="",Ke&&Nn.test(ht+ct)&&(ht=[ct,ht],s.colorStringFilter(ht),ct=ht[0],ht=ht[1]);var gn=ct.split(", ").join(",").split(" "),Xn=ht.split(", ").join(",").split(" "),an=gn.length,ui=Nt!==!1,Ai,Bn,Kn,Mn,Ci,Hi,cr,Ki,ni,Wi,Ir,Ar,_s;for((ht.indexOf(",")!==-1||ct.indexOf(",")!==-1)&&((ht+ct).indexOf("rgb")!==-1||(ht+ct).indexOf("hsl")!==-1?(gn=gn.join(" ").replace(pe,", ").split(" "),Xn=Xn.join(" ").replace(pe,", ").split(" ")):(gn=gn.join(" ").split(",").join(", ").split(" "),Xn=Xn.join(" ").split(",").join(", ").split(" ")),an=gn.length),an!==Xn.length&&(gn=(Lt||"").split(" "),an=gn.length),dt.plugin=rn,dt.setRatio=on,Nn.lastIndex=0,Ai=0;Ai<an;Ai++)if(Mn=gn[Ai],Ci=Xn[Ai]+"",Ki=parseFloat(Mn),Ki||Ki===0)dt.appendXtra("",Ki,It(Ci,Ki),Ci.replace(Z,""),ui&&Ci.indexOf("px")!==-1?Math.round:!1,!0);else if(Ke&&Nn.test(Mn))Ar=Ci.indexOf(")")+1,Ar=")"+(Ar?Ci.substr(Ar):""),_s=Ci.indexOf("hsl")!==-1&&bn,Wi=Ci,Mn=Ln(Mn,_s),Ci=Ln(Ci,_s),ni=Mn.length+Ci.length>6,ni&&!bn&&Ci[3]===0?(dt["xs"+dt.l]+=dt.l?" transparent":"transparent",dt.e=dt.e.split(Xn[Ai]).join("transparent")):(bn||(ni=!1),_s?dt.appendXtra(Wi.substr(0,Wi.indexOf("hsl"))+(ni?"hsla(":"hsl("),Mn[0],It(Ci[0],Mn[0]),",",!1,!0).appendXtra("",Mn[1],It(Ci[1],Mn[1]),"%,",!1).appendXtra("",Mn[2],It(Ci[2],Mn[2]),ni?"%,":"%"+Ar,!1):dt.appendXtra(Wi.substr(0,Wi.indexOf("rgb"))+(ni?"rgba(":"rgb("),Mn[0],Ci[0]-Mn[0],",",Math.round,!0).appendXtra("",Mn[1],Ci[1]-Mn[1],",",Math.round).appendXtra("",Mn[2],Ci[2]-Mn[2],ni?",":Ar,Math.round),ni&&(Mn=Mn.length<4?1:Mn[3],dt.appendXtra("",Mn,(Ci.length<4?1:Ci[3])-Mn,Ar,!1))),Nn.lastIndex=0;else if(Hi=Mn.match(te),!Hi)dt["xs"+dt.l]+=dt.l||dt["xs"+dt.l]?" "+Ci:Ci;else{if(cr=Ci.match(Z),!cr||cr.length!==Hi.length)return dt;for(Kn=0,Bn=0;Bn<Hi.length;Bn++)Ir=Hi[Bn],Wi=Mn.indexOf(Ir,Kn),dt.appendXtra(Mn.substr(Kn,Wi-Kn),Number(Ir),It(cr[Bn],Ir),"",ui&&Mn.substr(Wi+Ir.length,2)==="px"?Math.round:!1,Bn===0),Kn=Wi+Ir.length;dt["xs"+dt.l]+=Mn.substr(Kn)}if(ht.indexOf("=")!==-1&&dt.data){for(Ar=dt.xs0+dt.data.s,Ai=1;Ai<dt.l;Ai++)Ar+=dt["xs"+Ai]+dt.data["xn"+Ai];dt.e=Ar+dt["xs"+Ai]}return dt.l||(dt.type=-1,dt.xs0=dt.e),dt.xfirst||dt},si=9;for(j=ze.prototype,j.l=j.pr=0;--si>0;)j["xn"+si]=0,j["xs"+si]="";j.xs0="",j._next=j._prev=j.xfirst=j.data=j.plugin=j.setRatio=j.rxp=null,j.appendXtra=function(Pe,Le,ct,ht,Ke,Lt){var dt=this,Wt=dt.l;return dt["xs"+Wt]+=Lt&&(Wt||dt["xs"+Wt])?" "+Pe:Pe||"",!ct&&Wt!==0&&!dt.plugin?(dt["xs"+Wt]+=Le+(ht||""),dt):(dt.l++,dt.type=dt.setRatio?2:1,dt["xs"+dt.l]=ht||"",Wt>0?(dt.data["xn"+Wt]=Le+ct,dt.rxp["xn"+Wt]=Ke,dt["xn"+Wt]=Le,dt.plugin||(dt.xfirst=new ze(dt,"xn"+Wt,Le,ct,dt.xfirst||dt,0,dt.n,Ke,dt.pr),dt.xfirst.xs0=0),dt):(dt.data={s:Le+ct},dt.rxp={},dt.s=Le,dt.c=ct,dt.r=Ke,dt))};var di=function(Pe,Le){Le=Le||{},this.p=Le.prefix&&pn(Pe)||Pe,U[Pe]=U[this.p]=this,this.format=Le.formatter||Zn(Le.defaultValue,Le.color,Le.collapsible,Le.multi),Le.parser&&(this.parse=Le.parser),this.clrs=Le.color,this.multi=Le.multi,this.keyword=Le.keyword,this.dflt=Le.defaultValue,this.allowFunc=Le.allowFunc,this.pr=Le.priority||0},Mi=vt._registerComplexSpecialProp=function(Pe,Le,ct){typeof Le!="object"&&(Le={parser:ct});var ht=Pe.split(","),Ke=Le.defaultValue,Lt;for(ct=ct||[Ke],Lt=0;Lt<ht.length;Lt++)Le.prefix=Lt===0&&Le.prefix,Le.defaultValue=ct[Lt]||Ke,new di(ht[Lt],Le)},is=vt._registerPluginProp=function(Pe){if(!U[Pe]){var Le=Pe.charAt(0).toUpperCase()+Pe.substr(1)+"Plugin";Mi(Pe,{parser:function(ct,ht,Ke,Lt,dt,Wt,rn){var on=v.com.greensock.plugins[Le];return on?(on._cssRegister(),U[Ke].parse(ct,ht,Ke,Lt,dt,Wt,rn)):(pi("Error: "+Le+" js file not loaded."),dt)}})}};j=di.prototype,j.parseComplex=function(Pe,Le,ct,ht,Ke,Lt){var dt=this.keyword,Wt,rn,on,gn,Xn,an;if(this.multi&&(pe.test(ct)||pe.test(Le)?(rn=Le.replace(pe,"|").split("|"),on=ct.replace(pe,"|").split("|")):dt&&(rn=[Le],on=[ct])),on){for(gn=on.length>rn.length?on.length:rn.length,Wt=0;Wt<gn;Wt++)Le=rn[Wt]=rn[Wt]||this.dflt,ct=on[Wt]=on[Wt]||this.dflt,dt&&(Xn=Le.indexOf(dt),an=ct.indexOf(dt),Xn!==an&&(an===-1?rn[Wt]=rn[Wt].split(dt).join(""):Xn===-1&&(rn[Wt]+=" "+dt)));Le=rn.join(", "),ct=on.join(", ")}return On(Pe,this.p,Le,ct,this.clrs,this.dflt,ht,this.pr,Ke,Lt)},j.parse=function(Pe,Le,ct,ht,Ke,Lt,dt){return this.parseComplex(Pe.style,this.format(vn(Pe,this.p,I,!1,this.dflt)),this.format(Le),Ke,Lt)},s.registerSpecialProp=function(Pe,Le,ct){Mi(Pe,{parser:function(ht,Ke,Lt,dt,Wt,rn,on){var gn=new ze(ht,Lt,0,0,Wt,2,Lt,!1,ct);return gn.plugin=rn,gn.setRatio=Le(ht,Ke,dt._tween,Lt),gn},priority:ct})},s.useSVGTransformAttr=!0;var jr="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Xr=pn("transform"),cs=tn+"transform",ys=pn("transformOrigin"),Zr=pn("perspective")!==null,za=vt.Transform=function(){this.perspective=parseFloat(s.defaultTransformPerspective)||0,this.force3D=s.defaultForce3D===!1||!Zr?!1:s.defaultForce3D||"auto"},uo=_gsScope.SVGElement,sa,oa=function(Pe,Le,ct){var ht=Ye.createElementNS("http://www.w3.org/2000/svg",Pe),Ke=/([a-z])([A-Z])/g,Lt;for(Lt in ct)ht.setAttributeNS(null,Lt.replace(Ke,"$1-$2").toLowerCase(),ct[Lt]);return Le.appendChild(ht),ht},Oo=Ye.documentElement||{},Bo=function(){var Pe=sn||/Android/i.test(ut)&&!_gsScope.chrome,Le,ct,ht;return Ye.createElementNS&&Oo.appendChild&&!Pe&&(Le=oa("svg",Oo),ct=oa("rect",Le,{width:100,height:50,x:100}),ht=ct.getBoundingClientRect().width,ct.style[ys]="50% 50%",ct.style[Xr]="scaleX(0.5)",Pe=ht===ct.getBoundingClientRect().width&&!(ft&&Zr),Oo.removeChild(Le)),Pe}(),Hl=function(Pe,Le,ct,ht,Ke,Lt){var dt=Pe._gsTransform,Wt=wn(Pe,!0),rn,on,gn,Xn,an,ui,Ai,Bn,Kn,Mn,Ci,Hi,cr,Ki;dt&&(cr=dt.xOrigin,Ki=dt.yOrigin),(!ht||(rn=ht.split(" ")).length<2)&&(Ai=Pe.getBBox(),Ai.x===0&&Ai.y===0&&Ai.width+Ai.height===0&&(Ai={x:parseFloat(Pe.hasAttribute("x")?Pe.getAttribute("x"):Pe.hasAttribute("cx")?Pe.getAttribute("cx"):0)||0,y:parseFloat(Pe.hasAttribute("y")?Pe.getAttribute("y"):Pe.hasAttribute("cy")?Pe.getAttribute("cy"):0)||0,width:0,height:0}),Le=pt(Le).split(" "),rn=[(Le[0].indexOf("%")!==-1?parseFloat(Le[0])/100*Ai.width:parseFloat(Le[0]))+Ai.x,(Le[1].indexOf("%")!==-1?parseFloat(Le[1])/100*Ai.height:parseFloat(Le[1]))+Ai.y]),ct.xOrigin=Xn=parseFloat(rn[0]),ct.yOrigin=an=parseFloat(rn[1]),ht&&Wt!==Pt&&(ui=Wt[0],Ai=Wt[1],Bn=Wt[2],Kn=Wt[3],Mn=Wt[4],Ci=Wt[5],Hi=ui*Kn-Ai*Bn,Hi&&(on=Xn*(Kn/Hi)+an*(-Bn/Hi)+(Bn*Ci-Kn*Mn)/Hi,gn=Xn*(-Ai/Hi)+an*(ui/Hi)-(ui*Ci-Ai*Mn)/Hi,Xn=ct.xOrigin=rn[0]=on,an=ct.yOrigin=rn[1]=gn)),dt&&(Lt&&(ct.xOffset=dt.xOffset,ct.yOffset=dt.yOffset,dt=ct),Ke||Ke!==!1&&s.defaultSmoothOrigin!==!1?(on=Xn-cr,gn=an-Ki,dt.xOffset+=on*Wt[0]+gn*Wt[2]-on,dt.yOffset+=on*Wt[1]+gn*Wt[3]-gn):dt.xOffset=dt.yOffset=0),Lt||Pe.setAttribute("data-svg-origin",rn.join(" "))},ja=function(Pe){var Le=it("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),ct=this.parentNode,ht=this.nextSibling,Ke=this.style.cssText,Lt;if(Oo.appendChild(Le),Le.appendChild(this),this.style.display="block",Pe)try{Lt=this.getBBox(),this._originalGetBBox=this.getBBox,this.getBBox=ja}catch{}else this._originalGetBBox&&(Lt=this._originalGetBBox());return ht?ct.insertBefore(this,ht):ct.appendChild(this),Oo.removeChild(Le),this.style.cssText=Ke,Lt},Ma=function(Pe){try{return Pe.getBBox()}catch{return ja.call(Pe,!0)}},Lo=function(Pe){return!!(uo&&Pe.getCTM&&(!Pe.parentNode||Pe.ownerSVGElement)&&Ma(Pe))},Pt=[1,0,0,1,0,0],wn=function(Pe,Le){var ct=Pe._gsTransform||new za,ht=1e5,Ke=Pe.style,Lt,dt,Wt,rn,on,gn,Xn;if(Xr?dt=vn(Pe,cs,null,!0):Pe.currentStyle&&(dt=Pe.currentStyle.filter.match(ae),dt=dt&&dt.length===4?[dt[0].substr(4),Number(dt[2].substr(4)),Number(dt[1].substr(4)),dt[3].substr(4),ct.x||0,ct.y||0].join(","):""),Lt=!dt||dt==="none"||dt==="matrix(1, 0, 0, 1, 0, 0)",Xr&&Lt&&!Pe.offsetParent&&Pe!==Oo&&(rn=Ke.display,Ke.display="block",Xn=Pe.parentNode,(!Xn||!Pe.offsetParent)&&(on=1,gn=Pe.nextSibling,Oo.appendChild(Pe)),dt=vn(Pe,cs,null,!0),Lt=!dt||dt==="none"||dt==="matrix(1, 0, 0, 1, 0, 0)",rn?Ke.display=rn:ji(Ke,"display"),on&&(gn?Xn.insertBefore(Pe,gn):Xn?Xn.appendChild(Pe):Oo.removeChild(Pe))),(ct.svg||Pe.getCTM&&Lo(Pe))&&(Lt&&(Ke[Xr]+"").indexOf("matrix")!==-1&&(dt=Ke[Xr],Lt=0),Wt=Pe.getAttribute("transform"),Lt&&Wt&&(Wt=Pe.transform.baseVal.consolidate().matrix,dt="matrix("+Wt.a+","+Wt.b+","+Wt.c+","+Wt.d+","+Wt.e+","+Wt.f+")",Lt=0)),Lt)return Pt;for(Wt=(dt||"").match(te)||[],si=Wt.length;--si>-1;)rn=Number(Wt[si]),Wt[si]=(on=rn-(rn|=0))?(on*ht+(on<0?-.5:.5)|0)/ht+rn:rn;return Le&&Wt.length>6?[Wt[0],Wt[1],Wt[4],Wt[5],Wt[12],Wt[13]]:Wt},Vn=vt.getTransform=function(Pe,Le,ct,ht){if(Pe._gsTransform&&ct&&!ht)return Pe._gsTransform;var Ke=ct?Pe._gsTransform||new za:new za,Lt=Ke.scaleX<0,dt=2e-5,Wt=1e5,rn=Zr&&(parseFloat(vn(Pe,ys,Le,!1,"0 0 0").split(" ")[2])||Ke.zOrigin)||0,on=parseFloat(s.defaultTransformPerspective)||0,gn,Xn,an,ui,Ai,Bn;if(Ke.svg=!!(Pe.getCTM&&Lo(Pe)),Ke.svg&&(Hl(Pe,vn(Pe,ys,Le,!1,"50% 50%")+"",Ke,Pe.getAttribute("data-svg-origin")),sa=s.useSVGTransformAttr||Bo),gn=wn(Pe),gn!==Pt){if(gn.length===16){var Kn=gn[0],Mn=gn[1],Ci=gn[2],Hi=gn[3],cr=gn[4],Ki=gn[5],ni=gn[6],Wi=gn[7],Ir=gn[8],Ar=gn[9],_s=gn[10],bo=gn[12],Ms=gn[13],Ks=gn[14],so=gn[11],Zi=Math.atan2(ni,_s),As,Ri,No,br,rr;Ke.zOrigin&&(Ks=-Ke.zOrigin,bo=Ir*Ks-gn[12],Ms=Ar*Ks-gn[13],Ks=_s*Ks+Ke.zOrigin-gn[14]),Ke.rotationX=Zi*Ce,Zi&&(br=Math.cos(-Zi),rr=Math.sin(-Zi),As=cr*br+Ir*rr,Ri=Ki*br+Ar*rr,No=ni*br+_s*rr,Ir=cr*-rr+Ir*br,Ar=Ki*-rr+Ar*br,_s=ni*-rr+_s*br,so=Wi*-rr+so*br,cr=As,Ki=Ri,ni=No),Zi=Math.atan2(-Ci,_s),Ke.rotationY=Zi*Ce,Zi&&(br=Math.cos(-Zi),rr=Math.sin(-Zi),As=Kn*br-Ir*rr,Ri=Mn*br-Ar*rr,No=Ci*br-_s*rr,Ar=Mn*rr+Ar*br,_s=Ci*rr+_s*br,so=Hi*rr+so*br,Kn=As,Mn=Ri,Ci=No),Zi=Math.atan2(Mn,Kn),Ke.rotation=Zi*Ce,Zi&&(br=Math.cos(Zi),rr=Math.sin(Zi),As=Kn*br+Mn*rr,Ri=cr*br+Ki*rr,No=Ir*br+Ar*rr,Mn=Mn*br-Kn*rr,Ki=Ki*br-cr*rr,Ar=Ar*br-Ir*rr,Kn=As,cr=Ri,Ir=No),Ke.rotationX&&Math.abs(Ke.rotationX)+Math.abs(Ke.rotation)>359.9&&(Ke.rotationX=Ke.rotation=0,Ke.rotationY=180-Ke.rotationY),Zi=Math.atan2(cr,Ki),Ke.scaleX=(Math.sqrt(Kn*Kn+Mn*Mn+Ci*Ci)*Wt+.5|0)/Wt,Ke.scaleY=(Math.sqrt(Ki*Ki+ni*ni)*Wt+.5|0)/Wt,Ke.scaleZ=(Math.sqrt(Ir*Ir+Ar*Ar+_s*_s)*Wt+.5|0)/Wt,Kn/=Ke.scaleX,cr/=Ke.scaleY,Mn/=Ke.scaleX,Ki/=Ke.scaleY,Math.abs(Zi)>dt?(Ke.skewX=Zi*Ce,cr=0,Ke.skewType!=="simple"&&(Ke.scaleY*=1/Math.cos(Zi))):Ke.skewX=0,Ke.perspective=so?1/(so<0?-so:so):0,Ke.x=bo,Ke.y=Ms,Ke.z=Ks,Ke.svg&&(Ke.x-=Ke.xOrigin-(Ke.xOrigin*Kn-Ke.yOrigin*cr),Ke.y-=Ke.yOrigin-(Ke.yOrigin*Mn-Ke.xOrigin*Ki))}else if(!Zr||ht||!gn.length||Ke.x!==gn[4]||Ke.y!==gn[5]||!Ke.rotationX&&!Ke.rotationY){var oo=gn.length>=6,$s=oo?gn[0]:1,vr=gn[1]||0,Ta=gn[2]||0,xr=oo?gn[3]:1;Ke.x=gn[4]||0,Ke.y=gn[5]||0,an=Math.sqrt($s*$s+vr*vr),ui=Math.sqrt(xr*xr+Ta*Ta),Ai=$s||vr?Math.atan2(vr,$s)*Ce:Ke.rotation||0,Bn=Ta||xr?Math.atan2(Ta,xr)*Ce+Ai:Ke.skewX||0,Ke.scaleX=an,Ke.scaleY=ui,Ke.rotation=Ai,Ke.skewX=Bn,Zr&&(Ke.rotationX=Ke.rotationY=Ke.z=0,Ke.perspective=on,Ke.scaleZ=1),Ke.svg&&(Ke.x-=Ke.xOrigin-(Ke.xOrigin*$s+Ke.yOrigin*Ta),Ke.y-=Ke.yOrigin-(Ke.xOrigin*vr+Ke.yOrigin*xr))}Math.abs(Ke.skewX)>90&&Math.abs(Ke.skewX)<270&&(Lt?(Ke.scaleX*=-1,Ke.skewX+=Ke.rotation<=0?180:-180,Ke.rotation+=Ke.rotation<=0?180:-180):(Ke.scaleY*=-1,Ke.skewX+=Ke.skewX<=0?180:-180)),Ke.zOrigin=rn;for(Xn in Ke)Ke[Xn]<dt&&Ke[Xn]>-dt&&(Ke[Xn]=0)}return ct&&(Pe._gsTransform=Ke,Ke.svg&&(sa&&Pe.style[Xr]?a.delayedCall(.001,function(){ji(Pe.style,Xr)}):!sa&&Pe.getAttribute("transform")&&a.delayedCall(.001,function(){Pe.removeAttribute("transform")}))),Ke},un=function(Pe){var Le=this.data,ct=-Le.rotation*we,ht=ct+Le.skewX*we,Ke=1e5,Lt=(Math.cos(ct)*Le.scaleX*Ke|0)/Ke,dt=(Math.sin(ct)*Le.scaleX*Ke|0)/Ke,Wt=(Math.sin(ht)*-Le.scaleY*Ke|0)/Ke,rn=(Math.cos(ht)*Le.scaleY*Ke|0)/Ke,on=this.t.style,gn=this.t.currentStyle,Xn,an;if(gn){an=dt,dt=-Wt,Wt=-an,Xn=gn.filter,on.filter="";var ui=this.t.offsetWidth,Ai=this.t.offsetHeight,Bn=gn.position!=="absolute",Kn="progid:DXImageTransform.Microsoft.Matrix(M11="+Lt+", M12="+dt+", M21="+Wt+", M22="+rn,Mn=Le.x+ui*Le.xPercent/100,Ci=Le.y+Ai*Le.yPercent/100,Hi,cr;if(Le.ox!=null&&(Hi=(Le.oxp?ui*Le.ox*.01:Le.ox)-ui/2,cr=(Le.oyp?Ai*Le.oy*.01:Le.oy)-Ai/2,Mn+=Hi-(Hi*Lt+cr*dt),Ci+=cr-(Hi*Wt+cr*rn)),Bn?(Hi=ui/2,cr=Ai/2,Kn+=", Dx="+(Hi-(Hi*Lt+cr*dt)+Mn)+", Dy="+(cr-(Hi*Wt+cr*rn)+Ci)+")"):Kn+=", sizingMethod='auto expand')",Xn.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1?on.filter=Xn.replace(Re,Kn):on.filter=Kn+" "+Xn,(Pe===0||Pe===1)&&Lt===1&&dt===0&&Wt===0&&rn===1&&(!Bn||Kn.indexOf("Dx=0, Dy=0")!==-1)&&(!ce.test(Xn)||parseFloat(RegExp.$1)===100)&&Xn.indexOf(Xn.indexOf("Alpha"))===-1&&on.removeAttribute("filter"),!Bn){var Ki=sn<8?1:-1,ni,Wi,Ir;for(Hi=Le.ieOffsetX||0,cr=Le.ieOffsetY||0,Le.ieOffsetX=Math.round((ui-((Lt<0?-Lt:Lt)*ui+(dt<0?-dt:dt)*Ai))/2+Mn),Le.ieOffsetY=Math.round((Ai-((rn<0?-rn:rn)*Ai+(Wt<0?-Wt:Wt)*ui))/2+Ci),si=0;si<4;si++)Wi=Ve[si],ni=gn[Wi],an=ni.indexOf("px")!==-1?parseFloat(ni):In(this.t,Wi,parseFloat(ni),ni.replace(ve,""))||0,an!==Le[Wi]?Ir=si<2?-Le.ieOffsetX:-Le.ieOffsetY:Ir=si<2?Hi-Le.ieOffsetX:cr-Le.ieOffsetY,on[Wi]=(Le[Wi]=Math.round(an-Ir*(si===0||si===2?1:Ki)))+"px"}}},Gn=vt.set3DTransformRatio=vt.setTransformRatio=function(Pe){var Le=this.data,ct=this.t.style,ht=Le.rotation,Ke=Le.rotationX,Lt=Le.rotationY,dt=Le.scaleX,Wt=Le.scaleY,rn=Le.scaleZ,on=Le.x,gn=Le.y,Xn=Le.z,an=Le.svg,ui=Le.perspective,Ai=Le.force3D,Bn=Le.skewY,Kn=Le.skewX,Mn,Ci,Hi,cr,Ki,ni,Wi,Ir,Ar,_s,bo,Ms,Ks,so,Zi,As,Ri,No,br,rr,oo,$s,vr;if(Bn&&(Kn+=Bn,ht+=Bn),((Pe===1||Pe===0)&&Ai==="auto"&&(this.tween._totalTime===this.tween._totalDuration||!this.tween._totalTime)||!Ai)&&!Xn&&!ui&&!Lt&&!Ke&&rn===1||sa&&an||!Zr){ht||Kn||an?(ht*=we,$s=Kn*we,vr=1e5,Ci=Math.cos(ht)*dt,Ki=Math.sin(ht)*dt,Hi=Math.sin(ht-$s)*-Wt,ni=Math.cos(ht-$s)*Wt,$s&&Le.skewType==="simple"&&(Mn=Math.tan($s-Bn*we),Mn=Math.sqrt(1+Mn*Mn),Hi*=Mn,ni*=Mn,Bn&&(Mn=Math.tan(Bn*we),Mn=Math.sqrt(1+Mn*Mn),Ci*=Mn,Ki*=Mn)),an&&(on+=Le.xOrigin-(Le.xOrigin*Ci+Le.yOrigin*Hi)+Le.xOffset,gn+=Le.yOrigin-(Le.xOrigin*Ki+Le.yOrigin*ni)+Le.yOffset,sa&&(Le.xPercent||Le.yPercent)&&(Zi=this.t.getBBox(),on+=Le.xPercent*.01*Zi.width,gn+=Le.yPercent*.01*Zi.height),Zi=1e-6,on<Zi&&on>-Zi&&(on=0),gn<Zi&&gn>-Zi&&(gn=0)),br=(Ci*vr|0)/vr+","+(Ki*vr|0)/vr+","+(Hi*vr|0)/vr+","+(ni*vr|0)/vr+","+on+","+gn+")",an&&sa?this.t.setAttribute("transform","matrix("+br):ct[Xr]=(Le.xPercent||Le.yPercent?"translate("+Le.xPercent+"%,"+Le.yPercent+"%) matrix(":"matrix(")+br):ct[Xr]=(Le.xPercent||Le.yPercent?"translate("+Le.xPercent+"%,"+Le.yPercent+"%) matrix(":"matrix(")+dt+",0,0,"+Wt+","+on+","+gn+")";return}if(ft&&(Zi=1e-4,dt<Zi&&dt>-Zi&&(dt=rn=2e-5),Wt<Zi&&Wt>-Zi&&(Wt=rn=2e-5),ui&&!Le.z&&!Le.rotationX&&!Le.rotationY&&(ui=0)),ht||Kn)ht*=we,As=Ci=Math.cos(ht),Ri=Ki=Math.sin(ht),Kn&&(ht-=Kn*we,As=Math.cos(ht),Ri=Math.sin(ht),Le.skewType==="simple"&&(Mn=Math.tan((Kn-Bn)*we),Mn=Math.sqrt(1+Mn*Mn),As*=Mn,Ri*=Mn,Le.skewY&&(Mn=Math.tan(Bn*we),Mn=Math.sqrt(1+Mn*Mn),Ci*=Mn,Ki*=Mn))),Hi=-Ri,ni=As;else if(!Lt&&!Ke&&rn===1&&!ui&&!an){ct[Xr]=(Le.xPercent||Le.yPercent?"translate("+Le.xPercent+"%,"+Le.yPercent+"%) translate3d(":"translate3d(")+on+"px,"+gn+"px,"+Xn+"px)"+(dt!==1||Wt!==1?" scale("+dt+","+Wt+")":"");return}else Ci=ni=1,Hi=Ki=0;_s=1,cr=Wi=Ir=Ar=bo=Ms=0,Ks=ui?-1/ui:0,so=Le.zOrigin,Zi=1e-6,rr=",",oo="0",ht=Lt*we,ht&&(As=Math.cos(ht),Ri=Math.sin(ht),Ir=-Ri,bo=Ks*-Ri,cr=Ci*Ri,Wi=Ki*Ri,_s=As,Ks*=As,Ci*=As,Ki*=As),ht=Ke*we,ht&&(As=Math.cos(ht),Ri=Math.sin(ht),Mn=Hi*As+cr*Ri,No=ni*As+Wi*Ri,Ar=_s*Ri,Ms=Ks*Ri,cr=Hi*-Ri+cr*As,Wi=ni*-Ri+Wi*As,_s=_s*As,Ks=Ks*As,Hi=Mn,ni=No),rn!==1&&(cr*=rn,Wi*=rn,_s*=rn,Ks*=rn),Wt!==1&&(Hi*=Wt,ni*=Wt,Ar*=Wt,Ms*=Wt),dt!==1&&(Ci*=dt,Ki*=dt,Ir*=dt,bo*=dt),(so||an)&&(so&&(on+=cr*-so,gn+=Wi*-so,Xn+=_s*-so+so),an&&(on+=Le.xOrigin-(Le.xOrigin*Ci+Le.yOrigin*Hi)+Le.xOffset,gn+=Le.yOrigin-(Le.xOrigin*Ki+Le.yOrigin*ni)+Le.yOffset),on<Zi&&on>-Zi&&(on=oo),gn<Zi&&gn>-Zi&&(gn=oo),Xn<Zi&&Xn>-Zi&&(Xn=0)),br=Le.xPercent||Le.yPercent?"translate("+Le.xPercent+"%,"+Le.yPercent+"%) matrix3d(":"matrix3d(",br+=(Ci<Zi&&Ci>-Zi?oo:Ci)+rr+(Ki<Zi&&Ki>-Zi?oo:Ki)+rr+(Ir<Zi&&Ir>-Zi?oo:Ir),br+=rr+(bo<Zi&&bo>-Zi?oo:bo)+rr+(Hi<Zi&&Hi>-Zi?oo:Hi)+rr+(ni<Zi&&ni>-Zi?oo:ni),Ke||Lt||rn!==1?(br+=rr+(Ar<Zi&&Ar>-Zi?oo:Ar)+rr+(Ms<Zi&&Ms>-Zi?oo:Ms)+rr+(cr<Zi&&cr>-Zi?oo:cr),br+=rr+(Wi<Zi&&Wi>-Zi?oo:Wi)+rr+(_s<Zi&&_s>-Zi?oo:_s)+rr+(Ks<Zi&&Ks>-Zi?oo:Ks)+rr):br+=",0,0,0,0,1,0,",br+=on+rr+gn+rr+Xn+rr+(ui?1+-Xn/ui:1)+")",ct[Xr]=br};j=za.prototype,j.x=j.y=j.z=j.skewX=j.skewY=j.rotation=j.rotationX=j.rotationY=j.zOrigin=j.xPercent=j.yPercent=j.xOffset=j.yOffset=0,j.scaleX=j.scaleY=j.scaleZ=1,Mi("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(Pe,Le,ct,ht,Ke,Lt,dt){if(ht._lastParsedTransform===dt)return Ke;ht._lastParsedTransform=dt;var Wt=dt.scale&&typeof dt.scale=="function"?dt.scale:0;Wt&&(dt.scale=Wt(Xt,Pe));var rn=Pe._gsTransform,on=Pe.style,gn=1e-6,Xn=jr.length,an=dt,ui={},Ai="transformOrigin",Bn=Vn(Pe,I,!0,an.parseTransform),Kn=an.transform&&(typeof an.transform=="function"?an.transform(Xt,Xe):an.transform),Mn,Ci,Hi,cr,Ki,ni,Wi,Ir,Ar;if(Bn.skewType=an.skewType||Bn.skewType||s.defaultSkewType,ht._transform=Bn,"rotationZ"in an&&(an.rotation=an.rotationZ),Kn&&typeof Kn=="string"&&Xr)Ci=_t.style,Ci[Xr]=Kn,Ci.display="block",Ci.position="absolute",Kn.indexOf("%")!==-1&&(Ci.width=vn(Pe,"width"),Ci.height=vn(Pe,"height")),Ye.body.appendChild(_t),Mn=Vn(_t,null,!1),Bn.skewType==="simple"&&(Mn.scaleY*=Math.cos(Mn.skewX*we)),Bn.svg&&(ni=Bn.xOrigin,Wi=Bn.yOrigin,Mn.x-=Bn.xOffset,Mn.y-=Bn.yOffset,(an.transformOrigin||an.svgOrigin)&&(Kn={},Hl(Pe,pt(an.transformOrigin),Kn,an.svgOrigin,an.smoothOrigin,!0),ni=Kn.xOrigin,Wi=Kn.yOrigin,Mn.x-=Kn.xOffset-Bn.xOffset,Mn.y-=Kn.yOffset-Bn.yOffset),(ni||Wi)&&(Ir=wn(_t,!0),Mn.x-=ni-(ni*Ir[0]+Wi*Ir[2]),Mn.y-=Wi-(ni*Ir[1]+Wi*Ir[3]))),Ye.body.removeChild(_t),Mn.perspective||(Mn.perspective=Bn.perspective),an.xPercent!=null&&(Mn.xPercent=$t(an.xPercent,Bn.xPercent)),an.yPercent!=null&&(Mn.yPercent=$t(an.yPercent,Bn.yPercent));else if(typeof an=="object"){if(Mn={scaleX:$t(an.scaleX!=null?an.scaleX:an.scale,Bn.scaleX),scaleY:$t(an.scaleY!=null?an.scaleY:an.scale,Bn.scaleY),scaleZ:$t(an.scaleZ,Bn.scaleZ),x:$t(an.x,Bn.x),y:$t(an.y,Bn.y),z:$t(an.z,Bn.z),xPercent:$t(an.xPercent,Bn.xPercent),yPercent:$t(an.yPercent,Bn.yPercent),perspective:$t(an.transformPerspective,Bn.perspective)},Ki=an.directionalRotation,Ki!=null)if(typeof Ki=="object")for(Ci in Ki)an[Ci]=Ki[Ci];else an.rotation=Ki;typeof an.x=="string"&&an.x.indexOf("%")!==-1&&(Mn.x=0,Mn.xPercent=$t(an.x,Bn.xPercent)),typeof an.y=="string"&&an.y.indexOf("%")!==-1&&(Mn.y=0,Mn.yPercent=$t(an.y,Bn.yPercent)),Mn.rotation=nn("rotation"in an?an.rotation:"shortRotation"in an?an.shortRotation+"_short":Bn.rotation,Bn.rotation,"rotation",ui),Zr&&(Mn.rotationX=nn("rotationX"in an?an.rotationX:"shortRotationX"in an?an.shortRotationX+"_short":Bn.rotationX||0,Bn.rotationX,"rotationX",ui),Mn.rotationY=nn("rotationY"in an?an.rotationY:"shortRotationY"in an?an.shortRotationY+"_short":Bn.rotationY||0,Bn.rotationY,"rotationY",ui)),Mn.skewX=nn(an.skewX,Bn.skewX),Mn.skewY=nn(an.skewY,Bn.skewY)}for(Zr&&an.force3D!=null&&(Bn.force3D=an.force3D,cr=!0),Hi=Bn.force3D||Bn.z||Bn.rotationX||Bn.rotationY||Mn.z||Mn.rotationX||Mn.rotationY||Mn.perspective,!Hi&&an.scale!=null&&(Mn.scaleZ=1);--Xn>-1;)Ar=jr[Xn],Kn=Mn[Ar]-Bn[Ar],(Kn>gn||Kn<-gn||an[Ar]!=null||Ne[Ar]!=null)&&(cr=!0,Ke=new ze(Bn,Ar,Bn[Ar],Kn,Ke),Ar in ui&&(Ke.e=ui[Ar]),Ke.xs0=0,Ke.plugin=Lt,ht._overwriteProps.push(Ke.n));return Kn=typeof an.transformOrigin=="function"?an.transformOrigin(Xt,Xe):an.transformOrigin,Bn.svg&&(Kn||an.svgOrigin)&&(ni=Bn.xOffset,Wi=Bn.yOffset,Hl(Pe,pt(Kn),Mn,an.svgOrigin,an.smoothOrigin),Ke=yi(Bn,"xOrigin",(rn?Bn:Mn).xOrigin,Mn.xOrigin,Ke,Ai),Ke=yi(Bn,"yOrigin",(rn?Bn:Mn).yOrigin,Mn.yOrigin,Ke,Ai),(ni!==Bn.xOffset||Wi!==Bn.yOffset)&&(Ke=yi(Bn,"xOffset",rn?ni:Bn.xOffset,Bn.xOffset,Ke,Ai),Ke=yi(Bn,"yOffset",rn?Wi:Bn.yOffset,Bn.yOffset,Ke,Ai)),Kn="0px 0px"),(Kn||Zr&&Hi&&Bn.zOrigin)&&(Xr?(cr=!0,Ar=ys,Kn||(Kn=(vn(Pe,Ar,I,!1,"50% 50%")+"").split(" "),Kn=Kn[0]+" "+Kn[1]+" "+Bn.zOrigin+"px"),Kn+="",Ke=new ze(on,Ar,0,0,Ke,-1,Ai),Ke.b=on[Ar],Ke.plugin=Lt,Zr?(Ci=Bn.zOrigin,Kn=Kn.split(" "),Bn.zOrigin=(Kn.length>2?parseFloat(Kn[2]):Ci)||0,Ke.xs0=Ke.e=Kn[0]+" "+(Kn[1]||"50%")+" 0px",Ke=new ze(Bn,"zOrigin",0,0,Ke,-1,Ke.n),Ke.b=Ci,Ke.xs0=Ke.e=Bn.zOrigin):Ke.xs0=Ke.e=Kn):pt(Kn+"",Bn)),cr&&(ht._transformType=!(Bn.svg&&sa)&&(Hi||this._transformType===3)?3:2),Wt&&(dt.scale=Wt),Ke},allowFunc:!0,prefix:!0}),Mi("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),Mi("clipPath",{defaultValue:"inset(0%)",prefix:!0,multi:!0,formatter:Zn("inset(0% 0% 0% 0%)",!1,!0)}),Mi("borderRadius",{defaultValue:"0px",parser:function(Pe,Le,ct,ht,Ke,Lt){Le=this.format(Le);var dt=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],Wt=Pe.style,rn,on,gn,Xn,an,ui,Ai,Bn,Kn,Mn,Ci,Hi,cr,Ki,ni,Wi;for(Kn=parseFloat(Pe.offsetWidth),Mn=parseFloat(Pe.offsetHeight),rn=Le.split(" "),on=0;on<dt.length;on++)this.p.indexOf("border")&&(dt[on]=pn(dt[on])),an=Xn=vn(Pe,dt[on],I,!1,"0px"),an.indexOf(" ")!==-1&&(Xn=an.split(" "),an=Xn[0],Xn=Xn[1]),ui=gn=rn[on],Ai=parseFloat(an),Hi=an.substr((Ai+"").length),cr=ui.charAt(1)==="=",cr?(Bn=parseInt(ui.charAt(0)+"1",10),ui=ui.substr(2),Bn*=parseFloat(ui),Ci=ui.substr((Bn+"").length-(Bn<0?1:0))||""):(Bn=parseFloat(ui),Ci=ui.substr((Bn+"").length)),Ci===""&&(Ci=M[ct]||Hi),Ci!==Hi&&(Ki=In(Pe,"borderLeft",Ai,Hi),ni=In(Pe,"borderTop",Ai,Hi),Ci==="%"?(an=Ki/Kn*100+"%",Xn=ni/Mn*100+"%"):Ci==="em"?(Wi=In(Pe,"borderLeft",1,"em"),an=Ki/Wi+"em",Xn=ni/Wi+"em"):(an=Ki+"px",Xn=ni+"px"),cr&&(ui=parseFloat(an)+Bn+Ci,gn=parseFloat(Xn)+Bn+Ci)),Ke=On(Wt,dt[on],an+" "+Xn,ui+" "+gn,!1,"0px",Ke);return Ke},prefix:!0,formatter:Zn("0px 0px 0px 0px",!1,!0)}),Mi("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(Pe,Le,ct,ht,Ke,Lt){return On(Pe.style,ct,this.format(vn(Pe,ct,I,!1,"0px 0px")),this.format(Le),!1,"0px",Ke)},prefix:!0,formatter:Zn("0px 0px",!1,!0)}),Mi("backgroundPosition",{defaultValue:"0 0",parser:function(Pe,Le,ct,ht,Ke,Lt){var dt="background-position",Wt=I||Cn(Pe),rn=this.format((Wt?sn?Wt.getPropertyValue(dt+"-x")+" "+Wt.getPropertyValue(dt+"-y"):Wt.getPropertyValue(dt):Pe.currentStyle.backgroundPositionX+" "+Pe.currentStyle.backgroundPositionY)||"0 0"),on=this.format(Le),gn,Xn,an,ui,Ai,Bn;if(rn.indexOf("%")!==-1!=(on.indexOf("%")!==-1)&&on.split(",").length<2&&(Bn=vn(Pe,"backgroundImage").replace(Ae,""),Bn&&Bn!=="none")){for(gn=rn.split(" "),Xn=on.split(" "),At.setAttribute("src",Bn),an=2;--an>-1;)rn=gn[an],ui=rn.indexOf("%")!==-1,ui!==(Xn[an].indexOf("%")!==-1)&&(Ai=an===0?Pe.offsetWidth-At.width:Pe.offsetHeight-At.height,gn[an]=ui?parseFloat(rn)/100*Ai+"px":parseFloat(rn)/Ai*100+"%");rn=gn.join(" ")}return this.parseComplex(Pe.style,rn,on,Ke,Lt)},formatter:pt}),Mi("backgroundSize",{defaultValue:"0 0",formatter:function(Pe){return Pe+="",Pe.substr(0,2)==="co"?Pe:pt(Pe.indexOf(" ")===-1?Pe+" "+Pe:Pe)}}),Mi("perspective",{defaultValue:"0px",prefix:!0}),Mi("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),Mi("transformStyle",{prefix:!0}),Mi("backfaceVisibility",{prefix:!0}),Mi("userSelect",{prefix:!0}),Mi("margin",{parser:Qi("marginTop,marginRight,marginBottom,marginLeft")}),Mi("padding",{parser:Qi("paddingTop,paddingRight,paddingBottom,paddingLeft")}),Mi("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(Pe,Le,ct,ht,Ke,Lt){var dt,Wt,rn;return sn<9?(Wt=Pe.currentStyle,rn=sn<8?" ":",",dt="rect("+Wt.clipTop+rn+Wt.clipRight+rn+Wt.clipBottom+rn+Wt.clipLeft+")",Le=this.format(Le).split(",").join(rn)):(dt=this.format(vn(Pe,this.p,I,!1,this.dflt)),Le=this.format(Le)),this.parseComplex(Pe.style,dt,Le,Ke,Lt)}}),Mi("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),Mi("autoRound,strictUnits",{parser:function(Pe,Le,ct,ht,Ke){return Ke}}),Mi("border",{defaultValue:"0px solid #000",parser:function(Pe,Le,ct,ht,Ke,Lt){var dt=vn(Pe,"borderTopWidth",I,!1,"0px"),Wt=this.format(Le).split(" "),rn=Wt[0].replace(ve,"");return rn!=="px"&&(dt=parseFloat(dt)/In(Pe,"borderTopWidth",1,rn)+rn),this.parseComplex(Pe.style,this.format(dt+" "+vn(Pe,"borderTopStyle",I,!1,"solid")+" "+vn(Pe,"borderTopColor",I,!1,"#000")),Wt.join(" "),Ke,Lt)},color:!0,formatter:function(Pe){var Le=Pe.split(" ");return Le[0]+" "+(Le[1]||"solid")+" "+(Pe.match(Nn)||["#000"])[0]}}),Mi("borderWidth",{parser:Qi("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),Mi("float,cssFloat,styleFloat",{parser:function(Pe,Le,ct,ht,Ke,Lt){var dt=Pe.style,Wt="cssFloat"in dt?"cssFloat":"styleFloat";return new ze(dt,Wt,0,0,Ke,-1,ct,!1,0,dt[Wt],Le)}});var Yi=function(Pe){var Le=this.t,ct=Le.filter||vn(this.data,"filter")||"",ht=this.s+this.c*Pe|0,Ke;ht===100&&(ct.indexOf("atrix(")===-1&&ct.indexOf("radient(")===-1&&ct.indexOf("oader(")===-1?(Le.removeAttribute("filter"),Ke=!vn(this.data,"filter")):(Le.filter=ct.replace(X,""),Ke=!0)),Ke||(this.xn1&&(Le.filter=ct=ct||"alpha(opacity="+ht+")"),ct.indexOf("pacity")===-1?(ht!==0||!this.xn1)&&(Le.filter=ct+" alpha(opacity="+ht+")"):Le.filter=ct.replace(ce,"opacity="+ht))};Mi("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(Pe,Le,ct,ht,Ke,Lt){var dt=parseFloat(vn(Pe,"opacity",I,!1,"1")),Wt=Pe.style,rn=ct==="autoAlpha";return typeof Le=="string"&&Le.charAt(1)==="="&&(Le=(Le.charAt(0)==="-"?-1:1)*parseFloat(Le.substr(2))+dt),rn&&dt===1&&vn(Pe,"visibility",I)==="hidden"&&Le!==0&&(dt=0),bn?Ke=new ze(Wt,"opacity",dt,Le-dt,Ke):(Ke=new ze(Wt,"opacity",dt*100,(Le-dt)*100,Ke),Ke.xn1=rn?1:0,Wt.zoom=1,Ke.type=2,Ke.b="alpha(opacity="+Ke.s+")",Ke.e="alpha(opacity="+(Ke.s+Ke.c)+")",Ke.data=Pe,Ke.plugin=Lt,Ke.setRatio=Yi),rn&&(Ke=new ze(Wt,"visibility",0,0,Ke,-1,null,!1,0,dt!==0?"inherit":"hidden",Le===0?"hidden":"inherit"),Ke.xs0="inherit",ht._overwriteProps.push(Ke.n),ht._overwriteProps.push(ct)),Ke}});var ji=function(Pe,Le){Le&&(Pe.removeProperty?((Le.substr(0,2)==="ms"||Le.substr(0,6)==="webkit")&&(Le="-"+Le),Pe.removeProperty(Le.replace(_e,"-$1").toLowerCase())):Pe.removeAttribute(Le))},Er=function(Pe){if(this.t._gsClassPT=this,Pe===1||Pe===0){this.t.setAttribute("class",Pe===0?this.b:this.e);for(var Le=this.data,ct=this.t.style;Le;)Le.v?ct[Le.p]=Le.v:ji(ct,Le.p),Le=Le._next;Pe===1&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};Mi("className",{parser:function(Pe,Le,ct,ht,Ke,Lt,dt){var Wt=Pe.getAttribute("class")||"",rn=Pe.style.cssText,on,gn,Xn,an,ui;if(Ke=ht._classNamePT=new ze(Pe,ct,0,0,Ke,2),Ke.setRatio=Er,Ke.pr=-11,x=!0,Ke.b=Wt,gn=Hn(Pe,I),Xn=Pe._gsClassPT,Xn){for(an={},ui=Xn.data;ui;)an[ui.p]=1,ui=ui._next;Xn.setRatio(1)}return Pe._gsClassPT=Ke,Ke.e=Le.charAt(1)!=="="?Le:Wt.replace(new RegExp("(?:\\s|^)"+Le.substr(2)+"(?![\\w-])"),"")+(Le.charAt(0)==="+"?" "+Le.substr(2):""),Pe.setAttribute("class",Ke.e),on=fe(Pe,gn,Hn(Pe),dt,an),Pe.setAttribute("class",Wt),Ke.data=on.firstMPT,Pe.style.cssText!==rn&&(Pe.style.cssText=rn),Ke=Ke.xfirst=ht.parse(Pe,on.difs,Ke,Lt),Ke}});var ir=function(Pe){if((Pe===1||Pe===0)&&this.data._totalTime===this.data._totalDuration&&this.data.data!=="isFromStart"){var Le=this.t.style,ct=U.transform.parse,ht,Ke,Lt,dt,Wt;if(this.e==="all")Le.cssText="",dt=!0;else for(ht=this.e.split(" ").join("").split(","),Lt=ht.length;--Lt>-1;)Ke=ht[Lt],U[Ke]&&(U[Ke].parse===ct?dt=!0:Ke=Ke==="transformOrigin"?ys:U[Ke].p),ji(Le,Ke);dt&&(ji(Le,Xr),Wt=this.t._gsTransform,Wt&&(Wt.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(Mi("clearProps",{parser:function(Pe,Le,ct,ht,Ke){return Ke=new ze(Pe,ct,0,0,Ke,2),Ke.setRatio=ir,Ke.e=Le,Ke.pr=-10,Ke.data=ht._tween,x=!0,Ke}}),j="bezier,throwProps,physicsProps,physics2D".split(","),si=j.length;si--;)is(j[si]);j=s.prototype,j._firstPT=j._lastParsedTransform=j._transform=null,j._onInitTween=function(Pe,Le,ct,ht){if(!Pe.nodeType)return!1;this._target=Xe=Pe,this._tween=ct,this._vars=Le,Xt=ht,Nt=Le.autoRound,x=!1,M=Le.suffixMap||s.suffixMap,I=Cn(Pe),B=this._overwriteProps;var Ke=Pe.style,Lt,dt,Wt,rn,on,gn,Xn,an,ui;if(Qt&&Ke.zIndex===""&&(Lt=vn(Pe,"zIndex",I),(Lt==="auto"||Lt==="")&&this._addLazySet(Ke,"zIndex",0)),typeof Le=="string"&&(rn=Ke.cssText,Lt=Hn(Pe,I),Ke.cssText=rn+";"+Le,Lt=fe(Pe,Lt,Hn(Pe)).difs,!bn&&K.test(Le)&&(Lt.opacity=parseFloat(RegExp.$1)),Le=Lt,Ke.cssText=rn),Le.className?this._firstPT=dt=U.className.parse(Pe,Le.className,"className",this,null,null,Le):this._firstPT=dt=this.parse(Pe,Le,null),this._transformType){for(ui=this._transformType===3,Xr?Qe&&(Qt=!0,Ke.zIndex===""&&(Xn=vn(Pe,"zIndex",I),(Xn==="auto"||Xn==="")&&this._addLazySet(Ke,"zIndex",0)),bt&&this._addLazySet(Ke,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(ui?"visible":"hidden"))):Ke.zoom=1,Wt=dt;Wt&&Wt._next;)Wt=Wt._next;an=new ze(Pe,"transform",0,0,null,2),this._linkCSSP(an,null,Wt),an.setRatio=Xr?Gn:un,an.data=this._transform||Vn(Pe,I,!0),an.tween=ct,an.pr=-1,B.pop()}if(x){for(;dt;){for(gn=dt._next,Wt=rn;Wt&&Wt.pr>dt.pr;)Wt=Wt._next;(dt._prev=Wt?Wt._prev:on)?dt._prev._next=dt:rn=dt,(dt._next=Wt)?Wt._prev=dt:on=dt,dt=gn}this._firstPT=rn}return!0},j.parse=function(Pe,Le,ct,ht){var Ke=Pe.style,Lt,dt,Wt,rn,on,gn,Xn,an,ui,Ai;for(Lt in Le){if(gn=Le[Lt],dt=U[Lt],typeof gn=="function"&&!(dt&&dt.allowFunc)&&(gn=gn(Xt,Xe)),dt)ct=dt.parse(Pe,gn,Lt,this,ct,ht,Le);else if(Lt.substr(0,2)==="--"){this._tween._propLookup[Lt]=this._addTween.call(this._tween,Pe.style,"setProperty",Cn(Pe).getPropertyValue(Lt)+"",gn+"",Lt,!1,Lt);continue}else on=vn(Pe,Lt,I)+"",ui=typeof gn=="string",Lt==="color"||Lt==="fill"||Lt==="stroke"||Lt.indexOf("Color")!==-1||ui&&W.test(gn)?(ui||(gn=Ln(gn),gn=(gn.length>3?"rgba(":"rgb(")+gn.join(",")+")"),ct=On(Ke,Lt,on,gn,!0,"transparent",ct,0,ht)):ui&&he.test(gn)?ct=On(Ke,Lt,on,gn,!0,null,ct,0,ht):(Wt=parseFloat(on),Xn=Wt||Wt===0?on.substr((Wt+"").length):"",(on===""||on==="auto")&&(Lt==="width"||Lt==="height"?(Wt=We(Pe,Lt,I),Xn="px"):Lt==="left"||Lt==="top"?(Wt=Fn(Pe,Lt,I),Xn="px"):(Wt=Lt!=="opacity"?0:1,Xn="")),Ai=ui&&gn.charAt(1)==="=",Ai?(rn=parseInt(gn.charAt(0)+"1",10),gn=gn.substr(2),rn*=parseFloat(gn),an=gn.replace(ve,"")):(rn=parseFloat(gn),an=ui?gn.replace(ve,""):""),an===""&&(an=Lt in M?M[Lt]:Xn),gn=rn||rn===0?(Ai?rn+Wt:rn)+an:Le[Lt],Xn!==an&&(an!==""||Lt==="lineHeight")&&(rn||rn===0)&&Wt&&(Wt=In(Pe,Lt,Wt,Xn),an==="%"?(Wt/=In(Pe,Lt,100,"%")/100,Le.strictUnits!==!0&&(on=Wt+"%")):an==="em"||an==="rem"||an==="vw"||an==="vh"?Wt/=In(Pe,Lt,1,an):an!=="px"&&(rn=In(Pe,Lt,rn,an),an="px"),Ai&&(rn||rn===0)&&(gn=rn+Wt+an)),Ai&&(rn+=Wt),(Wt||Wt===0)&&(rn||rn===0)?(ct=new ze(Ke,Lt,Wt,rn-Wt,ct,0,Lt,Nt!==!1&&(an==="px"||Lt==="zIndex"),0,on,gn),ct.xs0=an):Ke[Lt]===void 0||!gn&&(gn+""=="NaN"||gn==null)?pi("invalid "+Lt+" tween value: "+Le[Lt]):(ct=new ze(Ke,Lt,rn||Wt||0,0,ct,-1,Lt,!1,0,on,gn),ct.xs0=gn==="none"&&(Lt==="display"||Lt.indexOf("Style")!==-1)?on:gn));ht&&ct&&!ct.plugin&&(ct.plugin=ht)}return ct},j.setRatio=function(Pe){var Le=this._firstPT,ct=1e-6,ht,Ke,Lt;if(Pe===1&&(this._tween._time===this._tween._duration||this._tween._time===0))for(;Le;){if(Le.type!==2)if(Le.r&&Le.type!==-1){if(ht=Le.r(Le.s+Le.c),!Le.type)Le.t[Le.p]=ht+Le.xs0;else if(Le.type===1){for(Lt=Le.l,Ke=Le.xs0+ht+Le.xs1,Lt=1;Lt<Le.l;Lt++)Ke+=Le["xn"+Lt]+Le["xs"+(Lt+1)];Le.t[Le.p]=Ke}}else Le.t[Le.p]=Le.e;else Le.setRatio(Pe);Le=Le._next}else if(Pe||!(this._tween._time===this._tween._duration||this._tween._time===0)||this._tween._rawPrevTime===-1e-6)for(;Le;){if(ht=Le.c*Pe+Le.s,Le.r?ht=Le.r(ht):ht<ct&&ht>-ct&&(ht=0),!Le.type)Le.t[Le.p]=ht+Le.xs0;else if(Le.type===1)if(Lt=Le.l,Lt===2)Le.t[Le.p]=Le.xs0+ht+Le.xs1+Le.xn1+Le.xs2;else if(Lt===3)Le.t[Le.p]=Le.xs0+ht+Le.xs1+Le.xn1+Le.xs2+Le.xn2+Le.xs3;else if(Lt===4)Le.t[Le.p]=Le.xs0+ht+Le.xs1+Le.xn1+Le.xs2+Le.xn2+Le.xs3+Le.xn3+Le.xs4;else if(Lt===5)Le.t[Le.p]=Le.xs0+ht+Le.xs1+Le.xn1+Le.xs2+Le.xn2+Le.xs3+Le.xn3+Le.xs4+Le.xn4+Le.xs5;else{for(Ke=Le.xs0+ht+Le.xs1,Lt=1;Lt<Le.l;Lt++)Ke+=Le["xn"+Lt]+Le["xs"+(Lt+1)];Le.t[Le.p]=Ke}else Le.type===-1?Le.t[Le.p]=Le.xs0:Le.setRatio&&Le.setRatio(Pe);Le=Le._next}else for(;Le;)Le.type!==2?Le.t[Le.p]=Le.b:Le.setRatio(Pe),Le=Le._next},j._enableTransforms=function(Pe){this._transform=this._transform||Vn(this._target,I,!0),this._transformType=!(this._transform.svg&&sa)&&(Pe||this._transformType===3)?3:2};var Yn=function(Pe){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};j._addLazySet=function(Pe,Le,ct){var ht=this._firstPT=new ze(Pe,Le,0,0,this._firstPT,2);ht.e=ct,ht.setRatio=Yn,ht.data=this},j._linkCSSP=function(Pe,Le,ct,ht){return Pe&&(Le&&(Le._prev=Pe),Pe._next&&(Pe._next._prev=Pe._prev),Pe._prev?Pe._prev._next=Pe._next:this._firstPT===Pe&&(this._firstPT=Pe._next,ht=!0),ct?ct._next=Pe:!ht&&this._firstPT===null&&(this._firstPT=Pe),Pe._next=Le,Pe._prev=ct),Pe},j._mod=function(Pe){for(var Le=this._firstPT;Le;)typeof Pe[Le.p]=="function"&&(Le.r=Pe[Le.p]),Le=Le._next},j._kill=function(Pe){var Le=Pe,ct,ht,Ke;if(Pe.autoAlpha||Pe.alpha){Le={};for(ht in Pe)Le[ht]=Pe[ht];Le.opacity=1,Le.autoAlpha&&(Le.visibility=1)}for(Pe.className&&(ct=this._classNamePT)&&(Ke=ct.xfirst,Ke&&Ke._prev?this._linkCSSP(Ke._prev,ct._next,Ke._prev._prev):Ke===this._firstPT&&(this._firstPT=ct._next),ct._next&&this._linkCSSP(ct._next,ct._next._next,Ke._prev),this._classNamePT=null),ct=this._firstPT;ct;)ct.plugin&&ct.plugin!==ht&&ct.plugin._kill&&(ct.plugin._kill(Pe),ht=ct.plugin),ct=ct._next;return u.prototype._kill.call(this,Le)};var er=function(Pe,Le,ct){var ht,Ke,Lt,dt;if(Pe.slice){for(Ke=Pe.length;--Ke>-1;)er(Pe[Ke],Le,ct);return}for(ht=Pe.childNodes,Ke=ht.length;--Ke>-1;)Lt=ht[Ke],dt=Lt.type,Lt.style&&(Le.push(Hn(Lt)),ct&&ct.push(Lt)),(dt===1||dt===9||dt===11)&&Lt.childNodes.length&&er(Lt,Le,ct)};return s.cascadeTo=function(Pe,Le,ct){var ht=a.to(Pe,Le,ct),Ke=[ht],Lt=[],dt=[],Wt=[],rn=a._internals.reservedProps,on,gn,Xn,an;for(Pe=ht._targets||ht.target,er(Pe,Lt,Wt),ht.render(Le,!0,!0),er(Pe,dt),ht.render(0,!0,!0),ht._enabled(!0),on=Wt.length;--on>-1;)if(gn=fe(Wt[on],Lt[on],dt[on]),gn.firstMPT){gn=gn.difs;for(Xn in ct)rn[Xn]&&(gn[Xn]=ct[Xn]);an={};for(Xn in gn)an[Xn]=Lt[on][Xn];Ke.push(a.fromTo(Wt[on],Le,an,gn))}return Ke},u.activate([s]),s},!0),function(){var u=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.7.0",priority:-1,API:2,init:function(x,M,I){return this._tween=I,!0}}),a=function(x){var M=x<1?Math.pow(10,(x+"").length-2):1;return function(I){return(Math.round(I/x)*x*M|0)/M}},s=function(x,M){for(;x;)!x.f&&!x.blob&&(x.m=M||Math.round),x=x._next},v=u.prototype;v._onInitAllProps=function(){var x=this._tween,M=x.vars.roundProps,I={},B=x._propLookup.roundProps,U,j,te,Z;if(typeof M=="object"&&!M.push)for(Z in M)I[Z]=a(M[Z]);else for(typeof M=="string"&&(M=M.split(",")),te=M.length;--te>-1;)I[M[te]]=Math.round;for(Z in I)for(U=x._firstPT;U;)j=U._next,U.pg?U.t._mod(I):U.n===Z&&(U.f===2&&U.t?s(U.t._firstPT,I[Z]):(this._add(U.t,Z,U.s,U.c,I[Z]),j&&(j._prev=U._prev),U._prev?U._prev._next=j:x._firstPT===U&&(x._firstPT=j),U._next=U._prev=null,x._propLookup[Z]=B)),U=j;return!1},v._add=function(x,M,I,B,U){this._addTween(x,M,I,I+B,M,U||Math.round),this._overwriteProps.push(M)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.6.1",init:function(u,a,s,v){var x,M;if(typeof u.setAttribute!="function")return!1;for(x in a)M=a[x],typeof M=="function"&&(M=M(v,u)),this._addTween(u,"setAttribute",u.getAttribute(x)+"",M+"",x,!1,x),this._overwriteProps.push(x);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.1",API:2,init:function(u,a,s,v){typeof a!="object"&&(a={rotation:a}),this.finals={};var x=a.useRadians===!0?Math.PI*2:360,M=1e-6,I,B,U,j,te,Z;for(I in a)I!=="useRadians"&&(j=a[I],typeof j=="function"&&(j=j(v,u)),Z=(j+"").split("_"),B=Z[0],U=parseFloat(typeof u[I]!="function"?u[I]:u[I.indexOf("set")||typeof u["get"+I.substr(3)]!="function"?I:"get"+I.substr(3)]()),j=this.finals[I]=typeof B=="string"&&B.charAt(1)==="="?U+parseInt(B.charAt(0)+"1",10)*Number(B.substr(2)):Number(B)||0,te=j-U,Z.length&&(B=Z.join("_"),B.indexOf("short")!==-1&&(te=te%x,te!==te%(x/2)&&(te=te<0?te+x:te-x)),B.indexOf("_cw")!==-1&&te<0?te=(te+x*9999999999)%x-(te/x|0)*x:B.indexOf("ccw")!==-1&&te>0&&(te=(te-x*9999999999)%x-(te/x|0)*x)),(te>M||te<-M)&&(this._addTween(u,I,U,U+te,I),this._overwriteProps.push(I)));return!0},set:function(u){var a;if(u!==1)this._super.setRatio.call(this,u);else for(a=this._firstPT;a;)a.f?a.t[a.p](this.finals[a.p]):a.t[a.p]=this.finals[a.p],a=a._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(u){var a=_gsScope.GreenSockGlobals||_gsScope,s=a.com.greensock,v=Math.PI*2,x=Math.PI/2,M=s._class,I=function(X,W){var _e=M("easing."+X,function(){},!0),ge=_e.prototype=new u;return ge.constructor=_e,ge.getRatio=W,_e},B=u.register||function(){},U=function(X,W,_e,ge,Ae){var ee=M("easing."+X,{easeOut:new W,easeIn:new _e,easeInOut:new ge},!0);return B(ee,X),ee},j=function(X,W,_e){this.t=X,this.v=W,_e&&(this.next=_e,_e.prev=this,this.c=_e.v-W,this.gap=_e.t-X)},te=function(X,W){var _e=M("easing."+X,function(Ae){this._p1=Ae||Ae===0?Ae:1.70158,this._p2=this._p1*1.525},!0),ge=_e.prototype=new u;return ge.constructor=_e,ge.getRatio=W,ge.config=function(Ae){return new _e(Ae)},_e},Z=U("Back",te("BackOut",function(X){return(X=X-1)*X*((this._p1+1)*X+this._p1)+1}),te("BackIn",function(X){return X*X*((this._p1+1)*X-this._p1)}),te("BackInOut",function(X){return(X*=2)<1?.5*X*X*((this._p2+1)*X-this._p2):.5*((X-=2)*X*((this._p2+1)*X+this._p2)+2)})),oe=M("easing.SlowMo",function(X,W,_e){W=W||W===0?W:.7,X==null?X=.7:X>1&&(X=1),this._p=X!==1?W:0,this._p1=(1-X)/2,this._p2=X,this._p3=this._p1+this._p2,this._calcEnd=_e===!0},!0),le=oe.prototype=new u,se,ve,ce,K;return le.constructor=oe,le.getRatio=function(X){var W=X+(.5-X)*this._p;return X<this._p1?this._calcEnd?1-(X=1-X/this._p1)*X:W-(X=1-X/this._p1)*X*X*X*W:X>this._p3?this._calcEnd?X===1?0:1-(X=(X-this._p3)/this._p1)*X:W+(X-W)*(X=(X-this._p3)/this._p1)*X*X*X:this._calcEnd?1:W},oe.ease=new oe(.7,.7),le.config=oe.config=function(X,W,_e){return new oe(X,W,_e)},se=M("easing.SteppedEase",function(X,W){X=X||1,this._p1=1/X,this._p2=X+(W?0:1),this._p3=W?1:0},!0),le=se.prototype=new u,le.constructor=se,le.getRatio=function(X){return X<0?X=0:X>=1&&(X=.999999999),((this._p2*X|0)+this._p3)*this._p1},le.config=se.config=function(X,W){return new se(X,W)},ve=M("easing.ExpoScaleEase",function(X,W,_e){this._p1=Math.log(W/X),this._p2=W-X,this._p3=X,this._ease=_e},!0),le=ve.prototype=new u,le.constructor=ve,le.getRatio=function(X){return this._ease&&(X=this._ease.getRatio(X)),(this._p3*Math.exp(this._p1*X)-this._p3)/this._p2},le.config=ve.config=function(X,W,_e){return new ve(X,W,_e)},ce=M("easing.RoughEase",function(X){X=X||{};for(var W=X.taper||"none",_e=[],ge=0,Ae=(X.points||20)|0,ee=Ae,$=X.randomize!==!1,ae=X.clamp===!0,Re=X.template instanceof u?X.template:null,pe=typeof X.strength=="number"?X.strength*.4:.4,he,we,Ce,Ne,Ze,Ye;--ee>-1;)he=$?Math.random():1/Ae*ee,we=Re?Re.getRatio(he):he,W==="none"?Ce=pe:W==="out"?(Ne=1-he,Ce=Ne*Ne*pe):W==="in"?Ce=he*he*pe:he<.5?(Ne=he*2,Ce=Ne*Ne*.5*pe):(Ne=(1-he)*2,Ce=Ne*Ne*.5*pe),$?we+=Math.random()*Ce-Ce*.5:ee%2?we+=Ce*.5:we-=Ce*.5,ae&&(we>1?we=1:we<0&&(we=0)),_e[ge++]={x:he,y:we};for(_e.sort(function(it,_t){return it.x-_t.x}),Ye=new j(1,1,null),ee=Ae;--ee>-1;)Ze=_e[ee],Ye=new j(Ze.x,Ze.y,Ye);this._prev=new j(0,0,Ye.t!==0?Ye:Ye.next)},!0),le=ce.prototype=new u,le.constructor=ce,le.getRatio=function(X){var W=this._prev;if(X>W.t){for(;W.next&&X>=W.t;)W=W.next;W=W.prev}else for(;W.prev&&X<=W.t;)W=W.prev;return this._prev=W,W.v+(X-W.t)/W.gap*W.c},le.config=function(X){return new ce(X)},ce.ease=new ce,U("Bounce",I("BounceOut",function(X){return X<1/2.75?7.5625*X*X:X<2/2.75?7.5625*(X-=1.5/2.75)*X+.75:X<2.5/2.75?7.5625*(X-=2.25/2.75)*X+.9375:7.5625*(X-=2.625/2.75)*X+.984375}),I("BounceIn",function(X){return(X=1-X)<1/2.75?1-7.5625*X*X:X<2/2.75?1-(7.5625*(X-=1.5/2.75)*X+.75):X<2.5/2.75?1-(7.5625*(X-=2.25/2.75)*X+.9375):1-(7.5625*(X-=2.625/2.75)*X+.984375)}),I("BounceInOut",function(X){var W=X<.5;return W?X=1-X*2:X=X*2-1,X<1/2.75?X=7.5625*X*X:X<2/2.75?X=7.5625*(X-=1.5/2.75)*X+.75:X<2.5/2.75?X=7.5625*(X-=2.25/2.75)*X+.9375:X=7.5625*(X-=2.625/2.75)*X+.984375,W?(1-X)*.5:X*.5+.5})),U("Circ",I("CircOut",function(X){return Math.sqrt(1-(X=X-1)*X)}),I("CircIn",function(X){return-(Math.sqrt(1-X*X)-1)}),I("CircInOut",function(X){return(X*=2)<1?-.5*(Math.sqrt(1-X*X)-1):.5*(Math.sqrt(1-(X-=2)*X)+1)})),K=function(X,W,_e){var ge=M("easing."+X,function(ee,$){this._p1=ee>=1?ee:1,this._p2=($||_e)/(ee<1?ee:1),this._p3=this._p2/v*(Math.asin(1/this._p1)||0),this._p2=v/this._p2},!0),Ae=ge.prototype=new u;return Ae.constructor=ge,Ae.getRatio=W,Ae.config=function(ee,$){return new ge(ee,$)},ge},U("Elastic",K("ElasticOut",function(X){return this._p1*Math.pow(2,-10*X)*Math.sin((X-this._p3)*this._p2)+1},.3),K("ElasticIn",function(X){return-(this._p1*Math.pow(2,10*(X-=1))*Math.sin((X-this._p3)*this._p2))},.3),K("ElasticInOut",function(X){return(X*=2)<1?-.5*(this._p1*Math.pow(2,10*(X-=1))*Math.sin((X-this._p3)*this._p2)):this._p1*Math.pow(2,-10*(X-=1))*Math.sin((X-this._p3)*this._p2)*.5+1},.45)),U("Expo",I("ExpoOut",function(X){return 1-Math.pow(2,-10*X)}),I("ExpoIn",function(X){return Math.pow(2,10*(X-1))-.001}),I("ExpoInOut",function(X){return(X*=2)<1?.5*Math.pow(2,10*(X-1)):.5*(2-Math.pow(2,-10*(X-1)))})),U("Sine",I("SineOut",function(X){return Math.sin(X*x)}),I("SineIn",function(X){return-Math.cos(X*x)+1}),I("SineInOut",function(X){return-.5*(Math.cos(Math.PI*X)-1)})),M("easing.EaseLookup",{find:function(X){return u.map[X]}},!0),B(a.SlowMo,"SlowMo","ease,"),B(ce,"RoughEase","ease,"),B(se,"SteppedEase","ease,"),Z},!0)});_gsScope._gsDefine&&_gsScope._gsQueue.pop()();(function(u,a){var s={},v=u.document,x=u.GreenSockGlobals=u.GreenSockGlobals||u,M=x[a];if(M)return typeof module<"u"&&module.exports&&(module.exports=M),M;var I=function(fe){var Se=fe.split("."),Ve=x,We;for(We=0;We<Se.length;We++)Ve[Se[We]]=Ve=Ve[Se[We]]||{};return Ve},B=I("com.greensock"),U=1e-8,j=function(fe){var Se=[],Ve=fe.length,We;for(We=0;We!==Ve;Se.push(fe[We++]));return Se},te=function(){},Z=function(){var fe=Object.prototype.toString,Se=fe.call([]);return function(Ve){return Ve!=null&&(Ve instanceof Array||typeof Ve=="object"&&!!Ve.push&&fe.call(Ve)===Se)}}(),oe,le,se,ve,ce,K={},X=function(fe,Se,Ve,We){this.sc=K[fe]?K[fe].sc:[],K[fe]=this,this.gsClass=null,this.func=Ve;var pt=[];this.check=function(It){for(var $t=Se.length,nn=$t,Ht,Wn,Ln,Qn;--$t>-1;)(Ht=K[Se[$t]]||new X(Se[$t],[])).gsClass?(pt[$t]=Ht.gsClass,nn--):It&&Ht.sc.push(this);if(nn===0&&Ve){if(Wn=("com.greensock."+fe).split("."),Ln=Wn.pop(),Qn=I(Wn.join("."))[Ln]=this.gsClass=Ve.apply(Ve,pt),We)if(x[Ln]=s[Ln]=Qn,typeof module<"u"&&module.exports)if(fe===a){module.exports=s[a]=Qn;for($t in s)Qn[$t]=s[$t]}else s[a]&&(s[a][Ln]=Qn);else typeof define=="function"&&define.amd&&define((u.GreenSockAMDPath?u.GreenSockAMDPath+"/":"")+fe.split(".").pop(),[],function(){return Qn});for($t=0;$t<this.sc.length;$t++)this.sc[$t].check()}},this.check(!0)},W=u._gsDefine=function(fe,Se,Ve,We){return new X(fe,Se,Ve,We)},_e=B._class=function(fe,Se,Ve){return Se=Se||function(){},W(fe,[],function(){return Se},Ve),Se};W.globals=x;var ge=[0,0,1,1],Ae=_e("easing.Ease",function(fe,Se,Ve,We){this._func=fe,this._type=Ve||0,this._power=We||0,this._params=Se?ge.concat(Se):ge},!0),ee=Ae.map={},$=Ae.register=function(fe,Se,Ve,We){for(var pt=Se.split(","),It=pt.length,$t=(Ve||"easeIn,easeOut,easeInOut").split(","),nn,Ht,Wn,Ln;--It>-1;)for(Ht=pt[It],nn=We?_e("easing."+Ht,null,!0):B.easing[Ht]||{},Wn=$t.length;--Wn>-1;)Ln=$t[Wn],ee[Ht+"."+Ln]=ee[Ln+Ht]=nn[Ln]=fe.getRatio?fe:fe[Ln]||new fe};for(se=Ae.prototype,se._calcEnd=!1,se.getRatio=function(fe){if(this._func)return this._params[0]=fe,this._func.apply(null,this._params);var Se=this._type,Ve=this._power,We=Se===1?1-fe:Se===2?fe:fe<.5?fe*2:(1-fe)*2;return Ve===1?We*=We:Ve===2?We*=We*We:Ve===3?We*=We*We*We:Ve===4&&(We*=We*We*We*We),Se===1?1-We:Se===2?We:fe<.5?We/2:1-We/2},oe=["Linear","Quad","Cubic","Quart","Quint,Strong"],le=oe.length;--le>-1;)se=oe[le]+",Power"+le,$(new Ae(null,null,1,le),se,"easeOut",!0),$(new Ae(null,null,2,le),se,"easeIn"+(le===0?",easeNone":"")),$(new Ae(null,null,3,le),se,"easeInOut");ee.linear=B.easing.Linear.easeIn,ee.swing=B.easing.Quad.easeInOut;var ae=_e("events.EventDispatcher",function(fe){this._listeners={},this._eventTarget=fe||this});se=ae.prototype,se.addEventListener=function(fe,Se,Ve,We,pt){pt=pt||0;var It=this._listeners[fe],$t=0,nn,Ht;for(this===ve&&!ce&&ve.wake(),It==null&&(this._listeners[fe]=It=[]),Ht=It.length;--Ht>-1;)nn=It[Ht],nn.c===Se&&nn.s===Ve?It.splice(Ht,1):$t===0&&nn.pr<pt&&($t=Ht+1);It.splice($t,0,{c:Se,s:Ve,up:We,pr:pt})},se.removeEventListener=function(fe,Se){var Ve=this._listeners[fe],We;if(Ve){for(We=Ve.length;--We>-1;)if(Ve[We].c===Se){Ve.splice(We,1);return}}},se.dispatchEvent=function(fe){var Se=this._listeners[fe],Ve,We,pt;if(Se)for(Ve=Se.length,Ve>1&&(Se=Se.slice(0)),We=this._eventTarget;--Ve>-1;)pt=Se[Ve],pt&&(pt.up?pt.c.call(pt.s||We,{type:fe,target:We}):pt.c.call(pt.s||We))};var Re=u.requestAnimationFrame,pe=u.cancelAnimationFrame,he=Date.now||function(){return new Date().getTime()},we=he();for(oe=["ms","moz","webkit","o"],le=oe.length;--le>-1&&!Re;)Re=u[oe[le]+"RequestAnimationFrame"],pe=u[oe[le]+"CancelAnimationFrame"]||u[oe[le]+"CancelRequestAnimationFrame"];_e("Ticker",function(fe,Se){var Ve=this,We=he(),pt=Se!==!1&&Re?"auto":!1,It=500,$t=33,nn="tick",Ht,Wn,Ln,Qn,Nn,Zn=function(Qi){var Mr=he()-we,ze,yi;Mr>It&&(We+=Mr-$t),we+=Mr,Ve.time=(we-We)/1e3,ze=Ve.time-Nn,(!Ht||ze>0||Qi===!0)&&(Ve.frame++,Nn+=ze+(ze>=Qn?.004:Qn-ze),yi=!0),Qi!==!0&&(Ln=Wn(Zn)),yi&&Ve.dispatchEvent(nn)};ae.call(Ve),Ve.time=Ve.frame=0,Ve.tick=function(){Zn(!0)},Ve.lagSmoothing=function(Qi,Mr){if(!arguments.length)return It<1/U;It=Qi||1/U,$t=Math.min(Mr,It,0)},Ve.sleep=function(){Ln!=null&&(!pt||!pe?clearTimeout(Ln):pe(Ln),Wn=te,Ln=null,Ve===ve&&(ce=!1))},Ve.wake=function(Qi){Ln!==null?Ve.sleep():Qi?We+=-we+(we=he()):Ve.frame>10&&(we=he()-It+5),Wn=Ht===0?te:!pt||!Re?function(Mr){return setTimeout(Mr,(Nn-Ve.time)*1e3+1|0)}:Re,Ve===ve&&(ce=!0),Zn(2)},Ve.fps=function(Qi){if(!arguments.length)return Ht;Ht=Qi,Qn=1/(Ht||60),Nn=this.time+Qn,Ve.wake()},Ve.useRAF=function(Qi){if(!arguments.length)return pt;Ve.sleep(),pt=Qi,Ve.fps(Ht)},Ve.fps(fe),setTimeout(function(){pt==="auto"&&Ve.frame<5&&(v||{}).visibilityState!=="hidden"&&Ve.useRAF(!1)},1500)}),se=B.Ticker.prototype=new B.events.EventDispatcher,se.constructor=B.Ticker;var Ce=_e("core.Animation",function(fe,Se){if(this.vars=Se=Se||{},this._duration=this._totalDuration=fe||0,this._delay=Number(Se.delay)||0,this._timeScale=1,this._active=!!Se.immediateRender,this.data=Se.data,this._reversed=!!Se.reversed,!!dn){ce||ve.wake();var Ve=this.vars.useFrames?tn:dn;Ve.add(this,Ve._time),this.vars.paused&&this.paused(!0)}});ve=Ce.ticker=new B.Ticker,se=Ce.prototype,se._dirty=se._gc=se._initted=se._paused=!1,se._totalTime=se._time=0,se._rawPrevTime=-1,se._next=se._last=se._onUpdate=se._timeline=se.timeline=null,se._paused=!1;var Ne=function(){ce&&he()-we>2e3&&((v||{}).visibilityState!=="hidden"||!ve.lagSmoothing())&&ve.wake();var fe=setTimeout(Ne,2e3);fe.unref&&fe.unref()};Ne(),se.play=function(fe,Se){return fe!=null&&this.seek(fe,Se),this.reversed(!1).paused(!1)},se.pause=function(fe,Se){return fe!=null&&this.seek(fe,Se),this.paused(!0)},se.resume=function(fe,Se){return fe!=null&&this.seek(fe,Se),this.paused(!1)},se.seek=function(fe,Se){return this.totalTime(Number(fe),Se!==!1)},se.restart=function(fe,Se){return this.reversed(!1).paused(!1).totalTime(fe?-this._delay:0,Se!==!1,!0)},se.reverse=function(fe,Se){return fe!=null&&this.seek(fe||this.totalDuration(),Se),this.reversed(!0).paused(!1)},se.render=function(fe,Se,Ve){},se.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},se.isActive=function(){var fe=this._timeline,Se=this._startTime,Ve;return!fe||!this._gc&&!this._paused&&fe.isActive()&&(Ve=fe.rawTime(!0))>=Se&&Ve<Se+this.totalDuration()/this._timeScale-U},se._enabled=function(fe,Se){return ce||ve.wake(),this._gc=!fe,this._active=this.isActive(),Se!==!0&&(fe&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!fe&&this.timeline&&this._timeline._remove(this,!0)),!1},se._kill=function(fe,Se){return this._enabled(!1,!1)},se.kill=function(fe,Se){return this._kill(fe,Se),this},se._uncache=function(fe){for(var Se=fe?this:this.timeline;Se;)Se._dirty=!0,Se=Se.timeline;return this},se._swapSelfInParams=function(fe){for(var Se=fe.length,Ve=fe.concat();--Se>-1;)fe[Se]==="{self}"&&(Ve[Se]=this);return Ve},se._callback=function(fe){var Se=this.vars,Ve=Se[fe],We=Se[fe+"Params"],pt=Se[fe+"Scope"]||Se.callbackScope||this,It=We?We.length:0;switch(It){case 0:Ve.call(pt);break;case 1:Ve.call(pt,We[0]);break;case 2:Ve.call(pt,We[0],We[1]);break;default:Ve.apply(pt,We)}},se.eventCallback=function(fe,Se,Ve,We){if((fe||"").substr(0,2)==="on"){var pt=this.vars;if(arguments.length===1)return pt[fe];Se==null?delete pt[fe]:(pt[fe]=Se,pt[fe+"Params"]=Z(Ve)&&Ve.join("").indexOf("{self}")!==-1?this._swapSelfInParams(Ve):Ve,pt[fe+"Scope"]=We),fe==="onUpdate"&&(this._onUpdate=Se)}return this},se.delay=function(fe){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+fe-this._delay),this._delay=fe,this):this._delay},se.duration=function(fe){return arguments.length?(this._duration=this._totalDuration=fe,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&fe!==0&&this.totalTime(this._totalTime*(fe/this._duration),!0),this):(this._dirty=!1,this._duration)},se.totalDuration=function(fe){return this._dirty=!1,arguments.length?this.duration(fe):this._totalDuration},se.time=function(fe,Se){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(fe>this._duration?this._duration:fe,Se)):this._time},se.totalTime=function(fe,Se,Ve){if(ce||ve.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(fe<0&&!Ve&&(fe+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var We=this._totalDuration,pt=this._timeline;if(fe>We&&!Ve&&(fe=We),this._startTime=(this._paused?this._pauseTime:pt._time)-(this._reversed?We-fe:fe)/this._timeScale,pt._dirty||this._uncache(!1),pt._timeline)for(;pt._timeline;)pt._timeline._time!==(pt._startTime+pt._totalTime)/pt._timeScale&&pt.totalTime(pt._totalTime,!0),pt=pt._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==fe||this._duration===0)&&(At.length&&Pn(),this.render(fe,Se,!1),At.length&&Pn())}return this},se.progress=se.totalProgress=function(fe,Se){var Ve=this.duration();return arguments.length?this.totalTime(Ve*fe,Se):Ve?this._time/Ve:this.ratio},se.startTime=function(fe){return arguments.length?(fe!==this._startTime&&(this._startTime=fe,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,fe-this._delay)),this):this._startTime},se.endTime=function(fe){return this._startTime+(fe!=!1?this.totalDuration():this.duration())/this._timeScale},se.timeScale=function(fe){if(!arguments.length)return this._timeScale;var Se,Ve;for(fe=fe||U,this._timeline&&this._timeline.smoothChildTiming&&(Se=this._pauseTime,Ve=Se||Se===0?Se:this._timeline.totalTime(),this._startTime=Ve-(Ve-this._startTime)*this._timeScale/fe),this._timeScale=fe,Ve=this.timeline;Ve&&Ve.timeline;)Ve._dirty=!0,Ve.totalDuration(),Ve=Ve.timeline;return this},se.reversed=function(fe){return arguments.length?(fe!=this._reversed&&(this._reversed=fe,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},se.paused=function(fe){if(!arguments.length)return this._paused;var Se=this._timeline,Ve,We;return fe!=this._paused&&Se&&(!ce&&!fe&&ve.wake(),Ve=Se.rawTime(),We=Ve-this._pauseTime,!fe&&Se.smoothChildTiming&&(this._startTime+=We,this._uncache(!1)),this._pauseTime=fe?Ve:null,this._paused=fe,this._active=this.isActive(),!fe&&We!==0&&this._initted&&this.duration()&&(Ve=Se.smoothChildTiming?this._totalTime:(Ve-this._startTime)/this._timeScale,this.render(Ve,Ve===this._totalTime,!0))),this._gc&&!fe&&this._enabled(!0,!1),this};var Ze=_e("core.SimpleTimeline",function(fe){Ce.call(this,0,fe),this.autoRemoveChildren=this.smoothChildTiming=!0});se=Ze.prototype=new Ce,se.constructor=Ze,se.kill()._gc=!1,se._first=se._last=se._recent=null,se._sortChildren=!1,se.add=se.insert=function(fe,Se,Ve,We){var pt,It;if(fe._startTime=Number(Se||0)+fe._delay,fe._paused&&this!==fe._timeline&&(fe._pauseTime=this.rawTime()-(fe._timeline.rawTime()-fe._pauseTime)),fe.timeline&&fe.timeline._remove(fe,!0),fe.timeline=fe._timeline=this,fe._gc&&fe._enabled(!0,!0),pt=this._last,this._sortChildren)for(It=fe._startTime;pt&&pt._startTime>It;)pt=pt._prev;return pt?(fe._next=pt._next,pt._next=fe):(fe._next=this._first,this._first=fe),fe._next?fe._next._prev=fe:this._last=fe,fe._prev=pt,this._recent=fe,this._timeline&&this._uncache(!0),this},se._remove=function(fe,Se){return fe.timeline===this&&(Se||fe._enabled(!1,!0),fe._prev?fe._prev._next=fe._next:this._first===fe&&(this._first=fe._next),fe._next?fe._next._prev=fe._prev:this._last===fe&&(this._last=fe._prev),fe._next=fe._prev=fe.timeline=null,fe===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},se.render=function(fe,Se,Ve){var We=this._first,pt;for(this._totalTime=this._time=this._rawPrevTime=fe;We;)pt=We._next,(We._active||fe>=We._startTime&&!We._paused&&!We._gc)&&(We._reversed?We.render((We._dirty?We.totalDuration():We._totalDuration)-(fe-We._startTime)*We._timeScale,Se,Ve):We.render((fe-We._startTime)*We._timeScale,Se,Ve)),We=pt},se.rawTime=function(){return ce||ve.wake(),this._totalTime};var Ye=_e("TweenLite",function(fe,Se,Ve){if(Ce.call(this,Se,Ve),this.render=Ye.prototype.render,fe==null)throw"Cannot tween a null target.";this.target=fe=typeof fe!="string"?fe:Ye.selector(fe)||fe;var We=fe.jquery||fe.length&&fe!==u&&fe[0]&&(fe[0]===u||fe[0].nodeType&&fe[0].style&&!fe.nodeType),pt=this.vars.overwrite,It,$t,nn;if(this._overwrite=pt=pt==null?Xt[Ye.defaultOverwrite]:typeof pt=="number"?pt>>0:Xt[pt],(We||fe instanceof Array||fe.push&&Z(fe))&&typeof fe[0]!="number")for(this._targets=nn=j(fe),this._propLookup=[],this._siblings=[],It=0;It<nn.length;It++){if($t=nn[It],$t){if(typeof $t=="string"){$t=nn[It--]=Ye.selector($t),typeof $t=="string"&&nn.splice(It+1,1);continue}else if($t.length&&$t!==u&&$t[0]&&($t[0]===u||$t[0].nodeType&&$t[0].style&&!$t.nodeType)){nn.splice(It--,1),this._targets=nn=nn.concat(j($t));continue}}else{nn.splice(It--,1);continue}this._siblings[It]=Cn($t,this,!1),pt===1&&this._siblings[It].length>1&&In($t,this,null,1,this._siblings[It])}else this._propLookup={},this._siblings=Cn(fe,this,!1),pt===1&&this._siblings.length>1&&In(fe,this,null,1,this._siblings);(this.vars.immediateRender||Se===0&&this._delay===0&&this.vars.immediateRender!==!1)&&(this._time=-U,this.render(Math.min(0,-this._delay)))},!0),it=function(fe){return fe&&fe.length&&fe!==u&&fe[0]&&(fe[0]===u||fe[0].nodeType&&fe[0].style&&!fe.nodeType)},_t=function(fe,Se){var Ve={},We;for(We in fe)!Xe[We]&&(!(We in Se)||We==="transform"||We==="x"||We==="y"||We==="width"||We==="height"||We==="className"||We==="border")&&(!bn[We]||bn[We]&&bn[We]._autoCSS)&&(Ve[We]=fe[We],delete fe[We]);fe.css=Ve};se=Ye.prototype=new Ce,se.constructor=Ye,se.kill()._gc=!1,se.ratio=0,se._firstPT=se._targets=se._overwrittenProps=se._startAt=null,se._notifyPluginsOfEnabled=se._lazy=!1,Ye.version="2.1.3",Ye.defaultEase=se._ease=new Ae(null,null,1,1),Ye.defaultOverwrite="auto",Ye.ticker=ve,Ye.autoSleep=120,Ye.lagSmoothing=function(fe,Se){ve.lagSmoothing(fe,Se)},Ye.selector=u.$||u.jQuery||function(fe){var Se=u.$||u.jQuery;return Se?(Ye.selector=Se,Se(fe)):(v||(v=u.document),v?v.querySelectorAll?v.querySelectorAll(fe):v.getElementById(fe.charAt(0)==="#"?fe.substr(1):fe):fe)};var At=[],vt={},ut=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,Nt=/[\+-]=-?[\.\d]/,Qt=function(fe){for(var Se=this._firstPT,Ve=1e-6,We;Se;)We=Se.blob?fe===1&&this.end!=null?this.end:fe?this.join(""):this.start:Se.c*fe+Se.s,Se.m?We=Se.m.call(this._tween,We,this._target||Se.t,this._tween):We<Ve&&We>-Ve&&!Se.blob&&(We=0),Se.f?Se.fp?Se.t[Se.p](Se.fp,We):Se.t[Se.p](We):Se.t[Se.p]=We,Se=Se._next},Qe=function(fe){return(fe*1e3|0)/1e3+""},ft=function(fe,Se,Ve,We){var pt=[],It=0,$t="",nn=0,Ht,Wn,Ln,Qn,Nn,Zn,Qi;for(pt.start=fe,pt.end=Se,fe=pt[0]=fe+"",Se=pt[1]=Se+"",Ve&&(Ve(pt),fe=pt[0],Se=pt[1]),pt.length=0,Ht=fe.match(ut)||[],Wn=Se.match(ut)||[],We&&(We._next=null,We.blob=1,pt._firstPT=pt._applyPT=We),Nn=Wn.length,Qn=0;Qn<Nn;Qn++)Qi=Wn[Qn],Zn=Se.substr(It,Se.indexOf(Qi,It)-It),$t+=Zn||!Qn?Zn:",",It+=Zn.length,nn?nn=(nn+1)%5:Zn.substr(-5)==="rgba("&&(nn=1),Qi===Ht[Qn]||Ht.length<=Qn?$t+=Qi:($t&&(pt.push($t),$t=""),Ln=parseFloat(Ht[Qn]),pt.push(Ln),pt._firstPT={_next:pt._firstPT,t:pt,p:pt.length-1,s:Ln,c:(Qi.charAt(1)==="="?parseInt(Qi.charAt(0)+"1",10)*parseFloat(Qi.substr(2)):parseFloat(Qi)-Ln)||0,f:0,m:nn&&nn<4?Math.round:Qe}),It+=Qi.length;return $t+=Se.substr(It),$t&&pt.push($t),pt.setRatio=Qt,Nt.test(Se)&&(pt.end=null),pt},bt=function(fe,Se,Ve,We,pt,It,$t,nn,Ht){typeof We=="function"&&(We=We(Ht||0,fe));var Wn=typeof fe[Se],Ln=Wn!=="function"?"":Se.indexOf("set")||typeof fe["get"+Se.substr(3)]!="function"?Se:"get"+Se.substr(3),Qn=Ve!=="get"?Ve:Ln?$t?fe[Ln]($t):fe[Ln]():fe[Se],Nn=typeof We=="string"&&We.charAt(1)==="=",Zn={t:fe,p:Se,s:Qn,f:Wn==="function",pg:0,n:pt||Se,m:It?typeof It=="function"?It:Math.round:0,pr:0,c:Nn?parseInt(We.charAt(0)+"1",10)*parseFloat(We.substr(2)):parseFloat(We)-Qn||0},Qi;if((typeof Qn!="number"||typeof We!="number"&&!Nn)&&($t||isNaN(Qn)||!Nn&&isNaN(We)||typeof Qn=="boolean"||typeof We=="boolean"?(Zn.fp=$t,Qi=ft(Qn,Nn?parseFloat(Zn.s)+Zn.c+(Zn.s+"").replace(/[0-9\-\.]/g,""):We,nn||Ye.defaultStringFilter,Zn),Zn={t:Qi,p:"setRatio",s:0,c:1,f:2,pg:0,n:pt||Se,pr:0,m:0}):(Zn.s=parseFloat(Qn),Nn||(Zn.c=parseFloat(We)-Zn.s||0))),Zn.c)return(Zn._next=this._firstPT)&&(Zn._next._prev=Zn),this._firstPT=Zn,Zn},sn=Ye._internals={isArray:Z,isSelector:it,lazyTweens:At,blobDif:ft},bn=Ye._plugins={},Un=sn.tweenLookup={},pi=0,Xe=sn.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1,yoyoEase:1,stagger:1},Xt={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},tn=Ce._rootFramesTimeline=new Ze,dn=Ce._rootTimeline=new Ze,pn=30,Pn=sn.lazyRender=function(){var fe=At.length,Se,Ve;for(vt={},Se=0;Se<fe;Se++)Ve=At[Se],Ve&&Ve._lazy!==!1&&(Ve.render(Ve._lazy[0],Ve._lazy[1],!0),Ve._lazy=!1);At.length=0};dn._startTime=ve.time,tn._startTime=ve.frame,dn._active=tn._active=!0,setTimeout(Pn,1),Ce._updateRoot=Ye.render=function(){var fe,Se,Ve;if(At.length&&Pn(),dn.render((ve.time-dn._startTime)*dn._timeScale,!1,!1),tn.render((ve.frame-tn._startTime)*tn._timeScale,!1,!1),At.length&&Pn(),ve.frame>=pn){pn=ve.frame+(parseInt(Ye.autoSleep,10)||120);for(Ve in Un){for(Se=Un[Ve].tweens,fe=Se.length;--fe>-1;)Se[fe]._gc&&Se.splice(fe,1);Se.length===0&&delete Un[Ve]}if(Ve=dn._first,(!Ve||Ve._paused)&&Ye.autoSleep&&!tn._first&&ve._listeners.tick.length===1){for(;Ve&&Ve._paused;)Ve=Ve._next;Ve||ve.sleep()}}},ve.addEventListener("tick",Ce._updateRoot);var Cn=function(fe,Se,Ve){var We=fe._gsTweenID,pt,It;if(Un[We||(fe._gsTweenID=We="t"+pi++)]||(Un[We]={target:fe,tweens:[]}),Se&&(pt=Un[We].tweens,pt[It=pt.length]=Se,Ve))for(;--It>-1;)pt[It]===Se&&pt.splice(It,1);return Un[We].tweens},vn=function(fe,Se,Ve,We){var pt=fe.vars.onOverwrite,It,$t;return pt&&(It=pt(fe,Se,Ve,We)),pt=Ye.onOverwrite,pt&&($t=pt(fe,Se,Ve,We)),It!==!1&&$t!==!1},In=function(fe,Se,Ve,We,pt){var It,$t,nn,Ht;if(We===1||We>=4){for(Ht=pt.length,It=0;It<Ht;It++)if((nn=pt[It])!==Se)nn._gc||nn._kill(null,fe,Se)&&($t=!0);else if(We===5)break;return $t}var Wn=Se._startTime+U,Ln=[],Qn=0,Nn=Se._duration===0,Zn;for(It=pt.length;--It>-1;)(nn=pt[It])===Se||nn._gc||nn._paused||(nn._timeline!==Se._timeline?(Zn=Zn||Fn(Se,0,Nn),Fn(nn,Zn,Nn)===0&&(Ln[Qn++]=nn)):nn._startTime<=Wn&&nn._startTime+nn.totalDuration()/nn._timeScale>Wn&&((Nn||!nn._initted)&&Wn-nn._startTime<=U*2||(Ln[Qn++]=nn)));for(It=Qn;--It>-1;)if(nn=Ln[It],Ht=nn._firstPT,We===2&&nn._kill(Ve,fe,Se)&&($t=!0),We!==2||!nn._firstPT&&nn._initted&&Ht){if(We!==2&&!vn(nn,Se))continue;nn._enabled(!1,!1)&&($t=!0)}return $t},Fn=function(fe,Se,Ve){for(var We=fe._timeline,pt=We._timeScale,It=fe._startTime;We._timeline;){if(It+=We._startTime,pt*=We._timeScale,We._paused)return-100;We=We._timeline}return It/=pt,It>Se?It-Se:Ve&&It===Se||!fe._initted&&It-Se<2*U?U:(It+=fe.totalDuration()/fe._timeScale/pt)>Se+U?0:It-Se-U};se._init=function(){var fe=this.vars,Se=this._overwrittenProps,Ve=this._duration,We=!!fe.immediateRender,pt=fe.ease,It=this._startAt,$t,nn,Ht,Wn,Ln,Qn;if(fe.startAt){It&&(It.render(-1,!0),It.kill()),Ln={};for(Wn in fe.startAt)Ln[Wn]=fe.startAt[Wn];if(Ln.data="isStart",Ln.overwrite=!1,Ln.immediateRender=!0,Ln.lazy=We&&fe.lazy!==!1,Ln.startAt=Ln.delay=null,Ln.onUpdate=fe.onUpdate,Ln.onUpdateParams=fe.onUpdateParams,Ln.onUpdateScope=fe.onUpdateScope||fe.callbackScope||this,this._startAt=Ye.to(this.target||{},0,Ln),We){if(this._time>0)this._startAt=null;else if(Ve!==0)return}}else if(fe.runBackwards&&Ve!==0)if(It)It.render(-1,!0),It.kill(),this._startAt=null;else{this._time!==0&&(We=!1),Ht={};for(Wn in fe)(!Xe[Wn]||Wn==="autoCSS")&&(Ht[Wn]=fe[Wn]);if(Ht.overwrite=0,Ht.data="isFromStart",Ht.lazy=We&&fe.lazy!==!1,Ht.immediateRender=We,this._startAt=Ye.to(this.target,0,Ht),!We)this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null);else if(this._time===0)return}if(this._ease=pt=pt?pt instanceof Ae?pt:typeof pt=="function"?new Ae(pt,fe.easeParams):ee[pt]||Ye.defaultEase:Ye.defaultEase,fe.easeParams instanceof Array&&pt.config&&(this._ease=pt.config.apply(pt,fe.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(Qn=this._targets.length,$t=0;$t<Qn;$t++)this._initProps(this._targets[$t],this._propLookup[$t]={},this._siblings[$t],Se?Se[$t]:null,$t)&&(nn=!0);else nn=this._initProps(this.target,this._propLookup,this._siblings,Se,0);if(nn&&Ye._onPluginEvent("_onInitAllProps",this),Se&&(this._firstPT||typeof this.target!="function"&&this._enabled(!1,!1)),fe.runBackwards)for(Ht=this._firstPT;Ht;)Ht.s+=Ht.c,Ht.c=-Ht.c,Ht=Ht._next;this._onUpdate=fe.onUpdate,this._initted=!0},se._initProps=function(fe,Se,Ve,We,pt){var It,$t,nn,Ht,Wn,Ln;if(fe==null)return!1;vt[fe._gsTweenID]&&Pn(),this.vars.css||fe.style&&fe!==u&&fe.nodeType&&bn.css&&this.vars.autoCSS!==!1&&_t(this.vars,fe);for(It in this.vars)if(Ln=this.vars[It],Xe[It])Ln&&(Ln instanceof Array||Ln.push&&Z(Ln))&&Ln.join("").indexOf("{self}")!==-1&&(this.vars[It]=Ln=this._swapSelfInParams(Ln,this));else if(bn[It]&&(Ht=new bn[It])._onInitTween(fe,this.vars[It],this,pt)){for(this._firstPT=Wn={_next:this._firstPT,t:Ht,p:"setRatio",s:0,c:1,f:1,n:It,pg:1,pr:Ht._priority,m:0},$t=Ht._overwriteProps.length;--$t>-1;)Se[Ht._overwriteProps[$t]]=this._firstPT;(Ht._priority||Ht._onInitAllProps)&&(nn=!0),(Ht._onDisable||Ht._onEnable)&&(this._notifyPluginsOfEnabled=!0),Wn._next&&(Wn._next._prev=Wn)}else Se[It]=bt.call(this,fe,It,"get",Ln,It,0,null,this.vars.stringFilter,pt);return We&&this._kill(We,fe)?this._initProps(fe,Se,Ve,We,pt):this._overwrite>1&&this._firstPT&&Ve.length>1&&In(fe,this,Se,this._overwrite,Ve)?(this._kill(Se,fe),this._initProps(fe,Se,Ve,We,pt)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(vt[fe._gsTweenID]=!0),nn)},se.render=function(fe,Se,Ve){var We=this,pt=We._time,It=We._duration,$t=We._rawPrevTime,nn,Ht,Wn,Ln;if(fe>=It-U&&fe>=0)We._totalTime=We._time=It,We.ratio=We._ease._calcEnd?We._ease.getRatio(1):1,We._reversed||(nn=!0,Ht="onComplete",Ve=Ve||We._timeline.autoRemoveChildren),It===0&&(We._initted||!We.vars.lazy||Ve)&&(We._startTime===We._timeline._duration&&(fe=0),($t<0||fe<=0&&fe>=-U||$t===U&&We.data!=="isPause")&&$t!==fe&&(Ve=!0,$t>U&&(Ht="onReverseComplete")),We._rawPrevTime=Ln=!Se||fe||$t===fe?fe:U);else if(fe<U)We._totalTime=We._time=0,We.ratio=We._ease._calcEnd?We._ease.getRatio(0):0,(pt!==0||It===0&&$t>0)&&(Ht="onReverseComplete",nn=We._reversed),fe>-U?fe=0:fe<0&&(We._active=!1,It===0&&(We._initted||!We.vars.lazy||Ve)&&($t>=0&&!($t===U&&We.data==="isPause")&&(Ve=!0),We._rawPrevTime=Ln=!Se||fe||$t===fe?fe:U)),(!We._initted||We._startAt&&We._startAt.progress())&&(Ve=!0);else if(We._totalTime=We._time=fe,We._easeType){var Qn=fe/It,Nn=We._easeType,Zn=We._easePower;(Nn===1||Nn===3&&Qn>=.5)&&(Qn=1-Qn),Nn===3&&(Qn*=2),Zn===1?Qn*=Qn:Zn===2?Qn*=Qn*Qn:Zn===3?Qn*=Qn*Qn*Qn:Zn===4&&(Qn*=Qn*Qn*Qn*Qn),We.ratio=Nn===1?1-Qn:Nn===2?Qn:fe/It<.5?Qn/2:1-Qn/2}else We.ratio=We._ease.getRatio(fe/It);if(!(We._time===pt&&!Ve)){if(!We._initted){if(We._init(),!We._initted||We._gc)return;if(!Ve&&We._firstPT&&(We.vars.lazy!==!1&&We._duration||We.vars.lazy&&!We._duration)){We._time=We._totalTime=pt,We._rawPrevTime=$t,At.push(We),We._lazy=[fe,Se];return}We._time&&!nn?We.ratio=We._ease.getRatio(We._time/It):nn&&We._ease._calcEnd&&(We.ratio=We._ease.getRatio(We._time===0?0:1))}for(We._lazy!==!1&&(We._lazy=!1),We._active||!We._paused&&We._time!==pt&&fe>=0&&(We._active=!0),pt===0&&(We._startAt&&(fe>=0?We._startAt.render(fe,!0,Ve):Ht||(Ht="_dummyGS")),We.vars.onStart&&(We._time!==0||It===0)&&(Se||We._callback("onStart"))),Wn=We._firstPT;Wn;)Wn.f?Wn.t[Wn.p](Wn.c*We.ratio+Wn.s):Wn.t[Wn.p]=Wn.c*We.ratio+Wn.s,Wn=Wn._next;We._onUpdate&&(fe<0&&We._startAt&&fe!==-1e-4&&We._startAt.render(fe,!0,Ve),Se||(We._time!==pt||nn||Ve)&&We._callback("onUpdate")),Ht&&(!We._gc||Ve)&&(fe<0&&We._startAt&&!We._onUpdate&&fe!==-1e-4&&We._startAt.render(fe,!0,Ve),nn&&(We._timeline.autoRemoveChildren&&We._enabled(!1,!1),We._active=!1),!Se&&We.vars[Ht]&&We._callback(Ht),It===0&&We._rawPrevTime===U&&Ln!==U&&(We._rawPrevTime=0))}},se._kill=function(fe,Se,Ve){if(fe==="all"&&(fe=null),fe==null&&(Se==null||Se===this.target))return this._lazy=!1,this._enabled(!1,!1);Se=typeof Se!="string"?Se||this._targets||this.target:Ye.selector(Se)||Se;var We=Ve&&this._time&&Ve._startTime===this._startTime&&this._timeline===Ve._timeline,pt=this._firstPT,It,$t,nn,Ht,Wn,Ln,Qn,Nn,Zn;if((Z(Se)||it(Se))&&typeof Se[0]!="number")for(It=Se.length;--It>-1;)this._kill(fe,Se[It],Ve)&&(Ln=!0);else{if(this._targets){for(It=this._targets.length;--It>-1;)if(Se===this._targets[It]){Wn=this._propLookup[It]||{},this._overwrittenProps=this._overwrittenProps||[],$t=this._overwrittenProps[It]=fe?this._overwrittenProps[It]||{}:"all";break}}else{if(Se!==this.target)return!1;Wn=this._propLookup,$t=this._overwrittenProps=fe?this._overwrittenProps||{}:"all"}if(Wn){if(Qn=fe||Wn,Nn=fe!==$t&&$t!=="all"&&fe!==Wn&&(typeof fe!="object"||!fe._tempKill),Ve&&(Ye.onOverwrite||this.vars.onOverwrite)){for(nn in Qn)Wn[nn]&&(Zn||(Zn=[]),Zn.push(nn));if((Zn||!fe)&&!vn(this,Ve,Se,Zn))return!1}for(nn in Qn)(Ht=Wn[nn])&&(We&&(Ht.f?Ht.t[Ht.p](Ht.s):Ht.t[Ht.p]=Ht.s,Ln=!0),Ht.pg&&Ht.t._kill(Qn)&&(Ln=!0),(!Ht.pg||Ht.t._overwriteProps.length===0)&&(Ht._prev?Ht._prev._next=Ht._next:Ht===this._firstPT&&(this._firstPT=Ht._next),Ht._next&&(Ht._next._prev=Ht._prev),Ht._next=Ht._prev=null),delete Wn[nn]),Nn&&($t[nn]=1);!this._firstPT&&this._initted&&pt&&this._enabled(!1,!1)}}return Ln},se.invalidate=function(){this._notifyPluginsOfEnabled&&Ye._onPluginEvent("_onDisable",this);var fe=this._time;return this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],Ce.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-U,this.render(fe,!1,this.vars.lazy!==!1)),this},se._enabled=function(fe,Se){if(ce||ve.wake(),fe&&this._gc){var Ve=this._targets,We;if(Ve)for(We=Ve.length;--We>-1;)this._siblings[We]=Cn(Ve[We],this,!0);else this._siblings=Cn(this.target,this,!0)}return Ce.prototype._enabled.call(this,fe,Se),this._notifyPluginsOfEnabled&&this._firstPT?Ye._onPluginEvent(fe?"_onEnable":"_onDisable",this):!1},Ye.to=function(fe,Se,Ve){return new Ye(fe,Se,Ve)},Ye.from=function(fe,Se,Ve){return Ve.runBackwards=!0,Ve.immediateRender=Ve.immediateRender!=!1,new Ye(fe,Se,Ve)},Ye.fromTo=function(fe,Se,Ve,We){return We.startAt=Ve,We.immediateRender=We.immediateRender!=!1&&Ve.immediateRender!=!1,new Ye(fe,Se,We)},Ye.delayedCall=function(fe,Se,Ve,We,pt){return new Ye(Se,0,{delay:fe,onComplete:Se,onCompleteParams:Ve,callbackScope:We,onReverseComplete:Se,onReverseCompleteParams:Ve,immediateRender:!1,lazy:!1,useFrames:pt,overwrite:0})},Ye.set=function(fe,Se){return new Ye(fe,0,Se)},Ye.getTweensOf=function(fe,Se){if(fe==null)return[];fe=typeof fe!="string"?fe:Ye.selector(fe)||fe;var Ve,We,pt,It;if((Z(fe)||it(fe))&&typeof fe[0]!="number"){for(Ve=fe.length,We=[];--Ve>-1;)We=We.concat(Ye.getTweensOf(fe[Ve],Se));for(Ve=We.length;--Ve>-1;)for(It=We[Ve],pt=Ve;--pt>-1;)It===We[pt]&&We.splice(Ve,1)}else if(fe._gsTweenID)for(We=Cn(fe).concat(),Ve=We.length;--Ve>-1;)(We[Ve]._gc||Se&&!We[Ve].isActive())&&We.splice(Ve,1);return We||[]},Ye.killTweensOf=Ye.killDelayedCallsTo=function(fe,Se,Ve){typeof Se=="object"&&(Ve=Se,Se=!1);for(var We=Ye.getTweensOf(fe,Se),pt=We.length;--pt>-1;)We[pt]._kill(Ve,fe)};var Hn=_e("plugins.TweenPlugin",function(fe,Se){this._overwriteProps=(fe||"").split(","),this._propName=this._overwriteProps[0],this._priority=Se||0,this._super=Hn.prototype},!0);if(se=Hn.prototype,Hn.version="1.19.0",Hn.API=2,se._firstPT=null,se._addTween=bt,se.setRatio=Qt,se._kill=function(fe){var Se=this._overwriteProps,Ve=this._firstPT,We;if(fe[this._propName]!=null)this._overwriteProps=[];else for(We=Se.length;--We>-1;)fe[Se[We]]!=null&&Se.splice(We,1);for(;Ve;)fe[Ve.n]!=null&&(Ve._next&&(Ve._next._prev=Ve._prev),Ve._prev?(Ve._prev._next=Ve._next,Ve._prev=null):this._firstPT===Ve&&(this._firstPT=Ve._next)),Ve=Ve._next;return!1},se._mod=se._roundProps=function(fe){for(var Se=this._firstPT,Ve;Se;)Ve=fe[this._propName]||Se.n!=null&&fe[Se.n.split(this._propName+"_").join("")],Ve&&typeof Ve=="function"&&(Se.f===2?Se.t._applyPT.m=Ve:Se.m=Ve),Se=Se._next},Ye._onPluginEvent=function(fe,Se){var Ve=Se._firstPT,We,pt,It,$t,nn;if(fe==="_onInitAllProps"){for(;Ve;){for(nn=Ve._next,pt=It;pt&&pt.pr>Ve.pr;)pt=pt._next;(Ve._prev=pt?pt._prev:$t)?Ve._prev._next=Ve:It=Ve,(Ve._next=pt)?pt._prev=Ve:$t=Ve,Ve=nn}Ve=Se._firstPT=It}for(;Ve;)Ve.pg&&typeof Ve.t[fe]=="function"&&Ve.t[fe]()&&(We=!0),Ve=Ve._next;return We},Hn.activate=function(fe){for(var Se=fe.length;--Se>-1;)fe[Se].API===Hn.API&&(bn[new fe[Se]()._propName]=fe[Se]);return!0},W.plugin=function(fe){if(!fe||!fe.propName||!fe.init||!fe.API)throw"illegal plugin definition.";var Se=fe.propName,Ve=fe.priority||0,We=fe.overwriteProps,pt={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},It=_e("plugins."+Se.charAt(0).toUpperCase()+Se.substr(1)+"Plugin",function(){Hn.call(this,Se,Ve),this._overwriteProps=We||[]},fe.global===!0),$t=It.prototype=new Hn(Se),nn;$t.constructor=It,It.API=fe.API;for(nn in pt)typeof fe[nn]=="function"&&($t[pt[nn]]=fe[nn]);return It.version=fe.version,Hn.activate([It]),It},oe=u._gsQueue,oe){for(le=0;le<oe.length;le++)oe[le]();for(se in K)K[se].func||u.console.log("GSAP encountered missing dependency: "+se)}ce=!1})(typeof module<"u"&&module.exports&&typeof global<"u"?global:globalThis||window,"TweenMax");const style="";/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="155",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(a,s){this._listeners===void 0&&(this._listeners={});const v=this._listeners;v[a]===void 0&&(v[a]=[]),v[a].indexOf(s)===-1&&v[a].push(s)}hasEventListener(a,s){if(this._listeners===void 0)return!1;const v=this._listeners;return v[a]!==void 0&&v[a].indexOf(s)!==-1}removeEventListener(a,s){if(this._listeners===void 0)return;const x=this._listeners[a];if(x!==void 0){const M=x.indexOf(s);M!==-1&&x.splice(M,1)}}dispatchEvent(a){if(this._listeners===void 0)return;const v=this._listeners[a.type];if(v!==void 0){a.target=this;const x=v.slice(0);for(let M=0,I=x.length;M<I;M++)x[M].call(this,a);a.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const u=Math.random()*4294967295|0,a=Math.random()*4294967295|0,s=Math.random()*4294967295|0,v=Math.random()*4294967295|0;return(_lut[u&255]+_lut[u>>8&255]+_lut[u>>16&255]+_lut[u>>24&255]+"-"+_lut[a&255]+_lut[a>>8&255]+"-"+_lut[a>>16&15|64]+_lut[a>>24&255]+"-"+_lut[s&63|128]+_lut[s>>8&255]+"-"+_lut[s>>16&255]+_lut[s>>24&255]+_lut[v&255]+_lut[v>>8&255]+_lut[v>>16&255]+_lut[v>>24&255]).toLowerCase()}function clamp(u,a,s){return Math.max(a,Math.min(s,u))}function euclideanModulo(u,a){return(u%a+a)%a}function lerp(u,a,s){return(1-s)*u+s*a}function isPowerOfTwo(u){return(u&u-1)===0&&u!==0}function floorPowerOfTwo(u){return Math.pow(2,Math.floor(Math.log(u)/Math.LN2))}function denormalize(u,a){switch(a.constructor){case Float32Array:return u;case Uint32Array:return u/4294967295;case Uint16Array:return u/65535;case Uint8Array:return u/255;case Int32Array:return Math.max(u/2147483647,-1);case Int16Array:return Math.max(u/32767,-1);case Int8Array:return Math.max(u/127,-1);default:throw new Error("Invalid component type.")}}function normalize(u,a){switch(a.constructor){case Float32Array:return u;case Uint32Array:return Math.round(u*4294967295);case Uint16Array:return Math.round(u*65535);case Uint8Array:return Math.round(u*255);case Int32Array:return Math.round(u*2147483647);case Int16Array:return Math.round(u*32767);case Int8Array:return Math.round(u*127);default:throw new Error("Invalid component type.")}}class Vector2{constructor(a=0,s=0){Vector2.prototype.isVector2=!0,this.x=a,this.y=s}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,s){return this.x=a,this.y=s,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,s){switch(a){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,s){return this.x=a.x+s.x,this.y=a.y+s.y,this}addScaledVector(a,s){return this.x+=a.x*s,this.y+=a.y*s,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,s){return this.x=a.x-s.x,this.y=a.y-s.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const s=this.x,v=this.y,x=a.elements;return this.x=x[0]*s+x[3]*v+x[6],this.y=x[1]*s+x[4]*v+x[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,s){return this.x=Math.max(a.x,Math.min(s.x,this.x)),this.y=Math.max(a.y,Math.min(s.y,this.y)),this}clampScalar(a,s){return this.x=Math.max(a,Math.min(s,this.x)),this.y=Math.max(a,Math.min(s,this.y)),this}clampLength(a,s){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(a,Math.min(s,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const s=Math.sqrt(this.lengthSq()*a.lengthSq());if(s===0)return Math.PI/2;const v=this.dot(a)/s;return Math.acos(clamp(v,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const s=this.x-a.x,v=this.y-a.y;return s*s+v*v}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,s){return this.x+=(a.x-this.x)*s,this.y+=(a.y-this.y)*s,this}lerpVectors(a,s,v){return this.x=a.x+(s.x-a.x)*v,this.y=a.y+(s.y-a.y)*v,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,s=0){return this.x=a[s],this.y=a[s+1],this}toArray(a=[],s=0){return a[s]=this.x,a[s+1]=this.y,a}fromBufferAttribute(a,s){return this.x=a.getX(s),this.y=a.getY(s),this}rotateAround(a,s){const v=Math.cos(s),x=Math.sin(s),M=this.x-a.x,I=this.y-a.y;return this.x=M*v-I*x+a.x,this.y=M*x+I*v+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(a,s,v,x,M,I,B,U,j){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],a!==void 0&&this.set(a,s,v,x,M,I,B,U,j)}set(a,s,v,x,M,I,B,U,j){const te=this.elements;return te[0]=a,te[1]=x,te[2]=B,te[3]=s,te[4]=M,te[5]=U,te[6]=v,te[7]=I,te[8]=j,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){const s=this.elements,v=a.elements;return s[0]=v[0],s[1]=v[1],s[2]=v[2],s[3]=v[3],s[4]=v[4],s[5]=v[5],s[6]=v[6],s[7]=v[7],s[8]=v[8],this}extractBasis(a,s,v){return a.setFromMatrix3Column(this,0),s.setFromMatrix3Column(this,1),v.setFromMatrix3Column(this,2),this}setFromMatrix4(a){const s=a.elements;return this.set(s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,s){const v=a.elements,x=s.elements,M=this.elements,I=v[0],B=v[3],U=v[6],j=v[1],te=v[4],Z=v[7],oe=v[2],le=v[5],se=v[8],ve=x[0],ce=x[3],K=x[6],X=x[1],W=x[4],_e=x[7],ge=x[2],Ae=x[5],ee=x[8];return M[0]=I*ve+B*X+U*ge,M[3]=I*ce+B*W+U*Ae,M[6]=I*K+B*_e+U*ee,M[1]=j*ve+te*X+Z*ge,M[4]=j*ce+te*W+Z*Ae,M[7]=j*K+te*_e+Z*ee,M[2]=oe*ve+le*X+se*ge,M[5]=oe*ce+le*W+se*Ae,M[8]=oe*K+le*_e+se*ee,this}multiplyScalar(a){const s=this.elements;return s[0]*=a,s[3]*=a,s[6]*=a,s[1]*=a,s[4]*=a,s[7]*=a,s[2]*=a,s[5]*=a,s[8]*=a,this}determinant(){const a=this.elements,s=a[0],v=a[1],x=a[2],M=a[3],I=a[4],B=a[5],U=a[6],j=a[7],te=a[8];return s*I*te-s*B*j-v*M*te+v*B*U+x*M*j-x*I*U}invert(){const a=this.elements,s=a[0],v=a[1],x=a[2],M=a[3],I=a[4],B=a[5],U=a[6],j=a[7],te=a[8],Z=te*I-B*j,oe=B*U-te*M,le=j*M-I*U,se=s*Z+v*oe+x*le;if(se===0)return this.set(0,0,0,0,0,0,0,0,0);const ve=1/se;return a[0]=Z*ve,a[1]=(x*j-te*v)*ve,a[2]=(B*v-x*I)*ve,a[3]=oe*ve,a[4]=(te*s-x*U)*ve,a[5]=(x*M-B*s)*ve,a[6]=le*ve,a[7]=(v*U-j*s)*ve,a[8]=(I*s-v*M)*ve,this}transpose(){let a;const s=this.elements;return a=s[1],s[1]=s[3],s[3]=a,a=s[2],s[2]=s[6],s[6]=a,a=s[5],s[5]=s[7],s[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const s=this.elements;return a[0]=s[0],a[1]=s[3],a[2]=s[6],a[3]=s[1],a[4]=s[4],a[5]=s[7],a[6]=s[2],a[7]=s[5],a[8]=s[8],this}setUvTransform(a,s,v,x,M,I,B){const U=Math.cos(M),j=Math.sin(M);return this.set(v*U,v*j,-v*(U*I+j*B)+I+a,-x*j,x*U,-x*(-j*I+U*B)+B+s,0,0,1),this}scale(a,s){return this.premultiply(_m3.makeScale(a,s)),this}rotate(a){return this.premultiply(_m3.makeRotation(-a)),this}translate(a,s){return this.premultiply(_m3.makeTranslation(a,s)),this}makeTranslation(a,s){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,s,0,0,1),this}makeRotation(a){const s=Math.cos(a),v=Math.sin(a);return this.set(s,-v,0,v,s,0,0,0,1),this}makeScale(a,s){return this.set(a,0,0,0,s,0,0,0,1),this}equals(a){const s=this.elements,v=a.elements;for(let x=0;x<9;x++)if(s[x]!==v[x])return!1;return!0}fromArray(a,s=0){for(let v=0;v<9;v++)this.elements[v]=a[v+s];return this}toArray(a=[],s=0){const v=this.elements;return a[s]=v[0],a[s+1]=v[1],a[s+2]=v[2],a[s+3]=v[3],a[s+4]=v[4],a[s+5]=v[5],a[s+6]=v[6],a[s+7]=v[7],a[s+8]=v[8],a}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(u){for(let a=u.length-1;a>=0;--a)if(u[a]>=65535)return!0;return!1}function createElementNS(u){return document.createElementNS("http://www.w3.org/1999/xhtml",u)}const _cache={};function warnOnce(u){u in _cache||(_cache[u]=!0,console.warn(u))}function SRGBToLinear(u){return u<.04045?u*.0773993808:Math.pow(u*.9478672986+.0521327014,2.4)}function LinearToSRGB(u){return u<.0031308?u*12.92:1.055*Math.pow(u,.41666)-.055}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function DisplayP3ToLinearSRGB(u){return u.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB)}function LinearSRGBToDisplayP3(u){return u.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}const TO_LINEAR={[LinearSRGBColorSpace]:u=>u,[SRGBColorSpace]:u=>u.convertSRGBToLinear(),[DisplayP3ColorSpace]:DisplayP3ToLinearSRGB},FROM_LINEAR={[LinearSRGBColorSpace]:u=>u,[SRGBColorSpace]:u=>u.convertLinearToSRGB(),[DisplayP3ColorSpace]:LinearSRGBToDisplayP3},ColorManagement={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(u){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!u},get workingColorSpace(){return LinearSRGBColorSpace},set workingColorSpace(u){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(u,a,s){if(this.enabled===!1||a===s||!a||!s)return u;const v=TO_LINEAR[a],x=FROM_LINEAR[s];if(v===void 0||x===void 0)throw new Error(`Unsupported color space conversion, "${a}" to "${s}".`);return x(v(u))},fromWorkingColorSpace:function(u,a){return this.convert(u,this.workingColorSpace,a)},toWorkingColorSpace:function(u,a){return this.convert(u,a,this.workingColorSpace)}};let _canvas;class ImageUtils{static getDataURL(a){if(/^data:/i.test(a.src)||typeof HTMLCanvasElement>"u")return a.src;let s;if(a instanceof HTMLCanvasElement)s=a;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=a.width,_canvas.height=a.height;const v=_canvas.getContext("2d");a instanceof ImageData?v.putImageData(a,0,0):v.drawImage(a,0,0,a.width,a.height),s=_canvas}return s.width>2048||s.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(a){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const s=createElementNS("canvas");s.width=a.width,s.height=a.height;const v=s.getContext("2d");v.drawImage(a,0,0,a.width,a.height);const x=v.getImageData(0,0,a.width,a.height),M=x.data;for(let I=0;I<M.length;I++)M[I]=SRGBToLinear(M[I]/255)*255;return v.putImageData(x,0,0),s}else if(a.data){const s=a.data.slice(0);for(let v=0;v<s.length;v++)s instanceof Uint8Array||s instanceof Uint8ClampedArray?s[v]=Math.floor(SRGBToLinear(s[v]/255)*255):s[v]=SRGBToLinear(s[v]);return{data:s,width:a.width,height:a.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a}}let sourceId=0;class Source{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sourceId++}),this.uuid=generateUUID(),this.data=a,this.version=0}set needsUpdate(a){a===!0&&this.version++}toJSON(a){const s=a===void 0||typeof a=="string";if(!s&&a.images[this.uuid]!==void 0)return a.images[this.uuid];const v={uuid:this.uuid,url:""},x=this.data;if(x!==null){let M;if(Array.isArray(x)){M=[];for(let I=0,B=x.length;I<B;I++)x[I].isDataTexture?M.push(serializeImage(x[I].image)):M.push(serializeImage(x[I]))}else M=serializeImage(x);v.url=M}return s||(a.images[this.uuid]=v),v}}function serializeImage(u){return typeof HTMLImageElement<"u"&&u instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&u instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&u instanceof ImageBitmap?ImageUtils.getDataURL(u):u.data?{data:Array.from(u.data),width:u.width,height:u.height,type:u.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let textureId=0;class Texture extends EventDispatcher{constructor(a=Texture.DEFAULT_IMAGE,s=Texture.DEFAULT_MAPPING,v=ClampToEdgeWrapping,x=ClampToEdgeWrapping,M=LinearFilter,I=LinearMipmapLinearFilter,B=RGBAFormat,U=UnsignedByteType,j=Texture.DEFAULT_ANISOTROPY,te=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(a),this.mipmaps=[],this.mapping=s,this.channel=0,this.wrapS=v,this.wrapT=x,this.magFilter=M,this.minFilter=I,this.anisotropy=j,this.format=B,this.internalFormat=null,this.type=U,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof te=="string"?this.colorSpace=te:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=te===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){const s=a===void 0||typeof a=="string";if(!s&&a.textures[this.uuid]!==void 0)return a.textures[this.uuid];const v={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(v.userData=this.userData),s||(a.textures[this.uuid]=v),v}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(this.mapping!==UVMapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case RepeatWrapping:a.x=a.x-Math.floor(a.x);break;case ClampToEdgeWrapping:a.x=a.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(a.x)%2)===1?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x);break}if(a.y<0||a.y>1)switch(this.wrapT){case RepeatWrapping:a.y=a.y-Math.floor(a.y);break;case ClampToEdgeWrapping:a.y=a.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(a.y)%2)===1?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y);break}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){a===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(a){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=a===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(a=0,s=0,v=0,x=1){Vector4.prototype.isVector4=!0,this.x=a,this.y=s,this.z=v,this.w=x}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,s,v,x){return this.x=a,this.y=s,this.z=v,this.w=x,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,s){switch(a){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;case 3:this.w=s;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w!==void 0?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,s){return this.x=a.x+s.x,this.y=a.y+s.y,this.z=a.z+s.z,this.w=a.w+s.w,this}addScaledVector(a,s){return this.x+=a.x*s,this.y+=a.y*s,this.z+=a.z*s,this.w+=a.w*s,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,s){return this.x=a.x-s.x,this.y=a.y-s.y,this.z=a.z-s.z,this.w=a.w-s.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){const s=this.x,v=this.y,x=this.z,M=this.w,I=a.elements;return this.x=I[0]*s+I[4]*v+I[8]*x+I[12]*M,this.y=I[1]*s+I[5]*v+I[9]*x+I[13]*M,this.z=I[2]*s+I[6]*v+I[10]*x+I[14]*M,this.w=I[3]*s+I[7]*v+I[11]*x+I[15]*M,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const s=Math.sqrt(1-a.w*a.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/s,this.y=a.y/s,this.z=a.z/s),this}setAxisAngleFromRotationMatrix(a){let s,v,x,M;const U=a.elements,j=U[0],te=U[4],Z=U[8],oe=U[1],le=U[5],se=U[9],ve=U[2],ce=U[6],K=U[10];if(Math.abs(te-oe)<.01&&Math.abs(Z-ve)<.01&&Math.abs(se-ce)<.01){if(Math.abs(te+oe)<.1&&Math.abs(Z+ve)<.1&&Math.abs(se+ce)<.1&&Math.abs(j+le+K-3)<.1)return this.set(1,0,0,0),this;s=Math.PI;const W=(j+1)/2,_e=(le+1)/2,ge=(K+1)/2,Ae=(te+oe)/4,ee=(Z+ve)/4,$=(se+ce)/4;return W>_e&&W>ge?W<.01?(v=0,x=.707106781,M=.707106781):(v=Math.sqrt(W),x=Ae/v,M=ee/v):_e>ge?_e<.01?(v=.707106781,x=0,M=.707106781):(x=Math.sqrt(_e),v=Ae/x,M=$/x):ge<.01?(v=.707106781,x=.707106781,M=0):(M=Math.sqrt(ge),v=ee/M,x=$/M),this.set(v,x,M,s),this}let X=Math.sqrt((ce-se)*(ce-se)+(Z-ve)*(Z-ve)+(oe-te)*(oe-te));return Math.abs(X)<.001&&(X=1),this.x=(ce-se)/X,this.y=(Z-ve)/X,this.z=(oe-te)/X,this.w=Math.acos((j+le+K-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,s){return this.x=Math.max(a.x,Math.min(s.x,this.x)),this.y=Math.max(a.y,Math.min(s.y,this.y)),this.z=Math.max(a.z,Math.min(s.z,this.z)),this.w=Math.max(a.w,Math.min(s.w,this.w)),this}clampScalar(a,s){return this.x=Math.max(a,Math.min(s,this.x)),this.y=Math.max(a,Math.min(s,this.y)),this.z=Math.max(a,Math.min(s,this.z)),this.w=Math.max(a,Math.min(s,this.w)),this}clampLength(a,s){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(a,Math.min(s,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,s){return this.x+=(a.x-this.x)*s,this.y+=(a.y-this.y)*s,this.z+=(a.z-this.z)*s,this.w+=(a.w-this.w)*s,this}lerpVectors(a,s,v){return this.x=a.x+(s.x-a.x)*v,this.y=a.y+(s.y-a.y)*v,this.z=a.z+(s.z-a.z)*v,this.w=a.w+(s.w-a.w)*v,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,s=0){return this.x=a[s],this.y=a[s+1],this.z=a[s+2],this.w=a[s+3],this}toArray(a=[],s=0){return a[s]=this.x,a[s+1]=this.y,a[s+2]=this.z,a[s+3]=this.w,a}fromBufferAttribute(a,s){return this.x=a.getX(s),this.y=a.getY(s),this.z=a.getZ(s),this.w=a.getW(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(a=1,s=1,v={}){super(),this.isRenderTarget=!0,this.width=a,this.height=s,this.depth=1,this.scissor=new Vector4(0,0,a,s),this.scissorTest=!1,this.viewport=new Vector4(0,0,a,s);const x={width:a,height:s,depth:1};v.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),v.colorSpace=v.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new Texture(x,v.mapping,v.wrapS,v.wrapT,v.magFilter,v.minFilter,v.format,v.type,v.anisotropy,v.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=v.generateMipmaps!==void 0?v.generateMipmaps:!1,this.texture.internalFormat=v.internalFormat!==void 0?v.internalFormat:null,this.texture.minFilter=v.minFilter!==void 0?v.minFilter:LinearFilter,this.depthBuffer=v.depthBuffer!==void 0?v.depthBuffer:!0,this.stencilBuffer=v.stencilBuffer!==void 0?v.stencilBuffer:!1,this.depthTexture=v.depthTexture!==void 0?v.depthTexture:null,this.samples=v.samples!==void 0?v.samples:0}setSize(a,s,v=1){(this.width!==a||this.height!==s||this.depth!==v)&&(this.width=a,this.height=s,this.depth=v,this.texture.image.width=a,this.texture.image.height=s,this.texture.image.depth=v,this.dispose()),this.viewport.set(0,0,a,s),this.scissor.set(0,0,a,s)}clone(){return new this.constructor().copy(this)}copy(a){this.width=a.width,this.height=a.height,this.depth=a.depth,this.scissor.copy(a.scissor),this.scissorTest=a.scissorTest,this.viewport.copy(a.viewport),this.texture=a.texture.clone(),this.texture.isRenderTargetTexture=!0;const s=Object.assign({},a.texture.image);return this.texture.source=new Source(s),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,a.depthTexture!==null&&(this.depthTexture=a.depthTexture.clone()),this.samples=a.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(a=1,s=1,v={}){super(a,s,v),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(a=null,s=1,v=1,x=1){super(null),this.isDataArrayTexture=!0,this.image={data:a,width:s,height:v,depth:x},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Data3DTexture extends Texture{constructor(a=null,s=1,v=1,x=1){super(null),this.isData3DTexture=!0,this.image={data:a,width:s,height:v,depth:x},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Quaternion{constructor(a=0,s=0,v=0,x=1){this.isQuaternion=!0,this._x=a,this._y=s,this._z=v,this._w=x}static slerpFlat(a,s,v,x,M,I,B){let U=v[x+0],j=v[x+1],te=v[x+2],Z=v[x+3];const oe=M[I+0],le=M[I+1],se=M[I+2],ve=M[I+3];if(B===0){a[s+0]=U,a[s+1]=j,a[s+2]=te,a[s+3]=Z;return}if(B===1){a[s+0]=oe,a[s+1]=le,a[s+2]=se,a[s+3]=ve;return}if(Z!==ve||U!==oe||j!==le||te!==se){let ce=1-B;const K=U*oe+j*le+te*se+Z*ve,X=K>=0?1:-1,W=1-K*K;if(W>Number.EPSILON){const ge=Math.sqrt(W),Ae=Math.atan2(ge,K*X);ce=Math.sin(ce*Ae)/ge,B=Math.sin(B*Ae)/ge}const _e=B*X;if(U=U*ce+oe*_e,j=j*ce+le*_e,te=te*ce+se*_e,Z=Z*ce+ve*_e,ce===1-B){const ge=1/Math.sqrt(U*U+j*j+te*te+Z*Z);U*=ge,j*=ge,te*=ge,Z*=ge}}a[s]=U,a[s+1]=j,a[s+2]=te,a[s+3]=Z}static multiplyQuaternionsFlat(a,s,v,x,M,I){const B=v[x],U=v[x+1],j=v[x+2],te=v[x+3],Z=M[I],oe=M[I+1],le=M[I+2],se=M[I+3];return a[s]=B*se+te*Z+U*le-j*oe,a[s+1]=U*se+te*oe+j*Z-B*le,a[s+2]=j*se+te*le+B*oe-U*Z,a[s+3]=te*se-B*Z-U*oe-j*le,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,s,v,x){return this._x=a,this._y=s,this._z=v,this._w=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,s){const v=a._x,x=a._y,M=a._z,I=a._order,B=Math.cos,U=Math.sin,j=B(v/2),te=B(x/2),Z=B(M/2),oe=U(v/2),le=U(x/2),se=U(M/2);switch(I){case"XYZ":this._x=oe*te*Z+j*le*se,this._y=j*le*Z-oe*te*se,this._z=j*te*se+oe*le*Z,this._w=j*te*Z-oe*le*se;break;case"YXZ":this._x=oe*te*Z+j*le*se,this._y=j*le*Z-oe*te*se,this._z=j*te*se-oe*le*Z,this._w=j*te*Z+oe*le*se;break;case"ZXY":this._x=oe*te*Z-j*le*se,this._y=j*le*Z+oe*te*se,this._z=j*te*se+oe*le*Z,this._w=j*te*Z-oe*le*se;break;case"ZYX":this._x=oe*te*Z-j*le*se,this._y=j*le*Z+oe*te*se,this._z=j*te*se-oe*le*Z,this._w=j*te*Z+oe*le*se;break;case"YZX":this._x=oe*te*Z+j*le*se,this._y=j*le*Z+oe*te*se,this._z=j*te*se-oe*le*Z,this._w=j*te*Z-oe*le*se;break;case"XZY":this._x=oe*te*Z-j*le*se,this._y=j*le*Z-oe*te*se,this._z=j*te*se+oe*le*Z,this._w=j*te*Z+oe*le*se;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+I)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(a,s){const v=s/2,x=Math.sin(v);return this._x=a.x*x,this._y=a.y*x,this._z=a.z*x,this._w=Math.cos(v),this._onChangeCallback(),this}setFromRotationMatrix(a){const s=a.elements,v=s[0],x=s[4],M=s[8],I=s[1],B=s[5],U=s[9],j=s[2],te=s[6],Z=s[10],oe=v+B+Z;if(oe>0){const le=.5/Math.sqrt(oe+1);this._w=.25/le,this._x=(te-U)*le,this._y=(M-j)*le,this._z=(I-x)*le}else if(v>B&&v>Z){const le=2*Math.sqrt(1+v-B-Z);this._w=(te-U)/le,this._x=.25*le,this._y=(x+I)/le,this._z=(M+j)/le}else if(B>Z){const le=2*Math.sqrt(1+B-v-Z);this._w=(M-j)/le,this._x=(x+I)/le,this._y=.25*le,this._z=(U+te)/le}else{const le=2*Math.sqrt(1+Z-v-B);this._w=(I-x)/le,this._x=(M+j)/le,this._y=(U+te)/le,this._z=.25*le}return this._onChangeCallback(),this}setFromUnitVectors(a,s){let v=a.dot(s)+1;return v<Number.EPSILON?(v=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0,this._w=v):(this._x=0,this._y=-a.z,this._z=a.y,this._w=v)):(this._x=a.y*s.z-a.z*s.y,this._y=a.z*s.x-a.x*s.z,this._z=a.x*s.y-a.y*s.x,this._w=v),this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(clamp(this.dot(a),-1,1)))}rotateTowards(a,s){const v=this.angleTo(a);if(v===0)return this;const x=Math.min(1,s/v);return this.slerp(a,x),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return a===0?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,s){const v=a._x,x=a._y,M=a._z,I=a._w,B=s._x,U=s._y,j=s._z,te=s._w;return this._x=v*te+I*B+x*j-M*U,this._y=x*te+I*U+M*B-v*j,this._z=M*te+I*j+v*U-x*B,this._w=I*te-v*B-x*U-M*j,this._onChangeCallback(),this}slerp(a,s){if(s===0)return this;if(s===1)return this.copy(a);const v=this._x,x=this._y,M=this._z,I=this._w;let B=I*a._w+v*a._x+x*a._y+M*a._z;if(B<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,B=-B):this.copy(a),B>=1)return this._w=I,this._x=v,this._y=x,this._z=M,this;const U=1-B*B;if(U<=Number.EPSILON){const le=1-s;return this._w=le*I+s*this._w,this._x=le*v+s*this._x,this._y=le*x+s*this._y,this._z=le*M+s*this._z,this.normalize(),this._onChangeCallback(),this}const j=Math.sqrt(U),te=Math.atan2(j,B),Z=Math.sin((1-s)*te)/j,oe=Math.sin(s*te)/j;return this._w=I*Z+this._w*oe,this._x=v*Z+this._x*oe,this._y=x*Z+this._y*oe,this._z=M*Z+this._z*oe,this._onChangeCallback(),this}slerpQuaternions(a,s,v){return this.copy(a).slerp(s,v)}random(){const a=Math.random(),s=Math.sqrt(1-a),v=Math.sqrt(a),x=2*Math.PI*Math.random(),M=2*Math.PI*Math.random();return this.set(s*Math.cos(x),v*Math.sin(M),v*Math.cos(M),s*Math.sin(x))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,s=0){return this._x=a[s],this._y=a[s+1],this._z=a[s+2],this._w=a[s+3],this._onChangeCallback(),this}toArray(a=[],s=0){return a[s]=this._x,a[s+1]=this._y,a[s+2]=this._z,a[s+3]=this._w,a}fromBufferAttribute(a,s){return this._x=a.getX(s),this._y=a.getY(s),this._z=a.getZ(s),this._w=a.getW(s),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(a=0,s=0,v=0){Vector3.prototype.isVector3=!0,this.x=a,this.y=s,this.z=v}set(a,s,v){return v===void 0&&(v=this.z),this.x=a,this.y=s,this.z=v,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,s){switch(a){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,s){return this.x=a.x+s.x,this.y=a.y+s.y,this.z=a.z+s.z,this}addScaledVector(a,s){return this.x+=a.x*s,this.y+=a.y*s,this.z+=a.z*s,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,s){return this.x=a.x-s.x,this.y=a.y-s.y,this.z=a.z-s.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,s){return this.x=a.x*s.x,this.y=a.y*s.y,this.z=a.z*s.z,this}applyEuler(a){return this.applyQuaternion(_quaternion$4.setFromEuler(a))}applyAxisAngle(a,s){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(a,s))}applyMatrix3(a){const s=this.x,v=this.y,x=this.z,M=a.elements;return this.x=M[0]*s+M[3]*v+M[6]*x,this.y=M[1]*s+M[4]*v+M[7]*x,this.z=M[2]*s+M[5]*v+M[8]*x,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const s=this.x,v=this.y,x=this.z,M=a.elements,I=1/(M[3]*s+M[7]*v+M[11]*x+M[15]);return this.x=(M[0]*s+M[4]*v+M[8]*x+M[12])*I,this.y=(M[1]*s+M[5]*v+M[9]*x+M[13])*I,this.z=(M[2]*s+M[6]*v+M[10]*x+M[14])*I,this}applyQuaternion(a){const s=this.x,v=this.y,x=this.z,M=a.x,I=a.y,B=a.z,U=a.w,j=U*s+I*x-B*v,te=U*v+B*s-M*x,Z=U*x+M*v-I*s,oe=-M*s-I*v-B*x;return this.x=j*U+oe*-M+te*-B-Z*-I,this.y=te*U+oe*-I+Z*-M-j*-B,this.z=Z*U+oe*-B+j*-I-te*-M,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const s=this.x,v=this.y,x=this.z,M=a.elements;return this.x=M[0]*s+M[4]*v+M[8]*x,this.y=M[1]*s+M[5]*v+M[9]*x,this.z=M[2]*s+M[6]*v+M[10]*x,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,s){return this.x=Math.max(a.x,Math.min(s.x,this.x)),this.y=Math.max(a.y,Math.min(s.y,this.y)),this.z=Math.max(a.z,Math.min(s.z,this.z)),this}clampScalar(a,s){return this.x=Math.max(a,Math.min(s,this.x)),this.y=Math.max(a,Math.min(s,this.y)),this.z=Math.max(a,Math.min(s,this.z)),this}clampLength(a,s){const v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(a,Math.min(s,v)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,s){return this.x+=(a.x-this.x)*s,this.y+=(a.y-this.y)*s,this.z+=(a.z-this.z)*s,this}lerpVectors(a,s,v){return this.x=a.x+(s.x-a.x)*v,this.y=a.y+(s.y-a.y)*v,this.z=a.z+(s.z-a.z)*v,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,s){const v=a.x,x=a.y,M=a.z,I=s.x,B=s.y,U=s.z;return this.x=x*U-M*B,this.y=M*I-v*U,this.z=v*B-x*I,this}projectOnVector(a){const s=a.lengthSq();if(s===0)return this.set(0,0,0);const v=a.dot(this)/s;return this.copy(a).multiplyScalar(v)}projectOnPlane(a){return _vector$b.copy(this).projectOnVector(a),this.sub(_vector$b)}reflect(a){return this.sub(_vector$b.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const s=Math.sqrt(this.lengthSq()*a.lengthSq());if(s===0)return Math.PI/2;const v=this.dot(a)/s;return Math.acos(clamp(v,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const s=this.x-a.x,v=this.y-a.y,x=this.z-a.z;return s*s+v*v+x*x}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,s,v){const x=Math.sin(s)*a;return this.x=x*Math.sin(v),this.y=Math.cos(s)*a,this.z=x*Math.cos(v),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,s,v){return this.x=a*Math.sin(s),this.y=v,this.z=a*Math.cos(s),this}setFromMatrixPosition(a){const s=a.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(a){const s=this.setFromMatrixColumn(a,0).length(),v=this.setFromMatrixColumn(a,1).length(),x=this.setFromMatrixColumn(a,2).length();return this.x=s,this.y=v,this.z=x,this}setFromMatrixColumn(a,s){return this.fromArray(a.elements,s*4)}setFromMatrix3Column(a,s){return this.fromArray(a.elements,s*3)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,s=0){return this.x=a[s],this.y=a[s+1],this.z=a[s+2],this}toArray(a=[],s=0){return a[s]=this.x,a[s+1]=this.y,a[s+2]=this.z,a}fromBufferAttribute(a,s){return this.x=a.getX(s),this.y=a.getY(s),this.z=a.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const a=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,v=Math.sqrt(1-a**2);return this.x=v*Math.cos(s),this.y=v*Math.sin(s),this.z=a,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(a=new Vector3(1/0,1/0,1/0),s=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=s}set(a,s){return this.min.copy(a),this.max.copy(s),this}setFromArray(a){this.makeEmpty();for(let s=0,v=a.length;s<v;s+=3)this.expandByPoint(_vector$a.fromArray(a,s));return this}setFromBufferAttribute(a){this.makeEmpty();for(let s=0,v=a.count;s<v;s++)this.expandByPoint(_vector$a.fromBufferAttribute(a,s));return this}setFromPoints(a){this.makeEmpty();for(let s=0,v=a.length;s<v;s++)this.expandByPoint(a[s]);return this}setFromCenterAndSize(a,s){const v=_vector$a.copy(s).multiplyScalar(.5);return this.min.copy(a).sub(v),this.max.copy(a).add(v),this}setFromObject(a,s=!1){return this.makeEmpty(),this.expandByObject(a,s)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,s=!1){if(a.updateWorldMatrix(!1,!1),a.boundingBox!==void 0)a.boundingBox===null&&a.computeBoundingBox(),_box$3.copy(a.boundingBox),_box$3.applyMatrix4(a.matrixWorld),this.union(_box$3);else{const x=a.geometry;if(x!==void 0)if(s&&x.attributes!==void 0&&x.attributes.position!==void 0){const M=x.attributes.position;for(let I=0,B=M.count;I<B;I++)_vector$a.fromBufferAttribute(M,I).applyMatrix4(a.matrixWorld),this.expandByPoint(_vector$a)}else x.boundingBox===null&&x.computeBoundingBox(),_box$3.copy(x.boundingBox),_box$3.applyMatrix4(a.matrixWorld),this.union(_box$3)}const v=a.children;for(let x=0,M=v.length;x<M;x++)this.expandByObject(v[x],s);return this}containsPoint(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,s){return s.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,_vector$a),_vector$a.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let s,v;return a.normal.x>0?(s=a.normal.x*this.min.x,v=a.normal.x*this.max.x):(s=a.normal.x*this.max.x,v=a.normal.x*this.min.x),a.normal.y>0?(s+=a.normal.y*this.min.y,v+=a.normal.y*this.max.y):(s+=a.normal.y*this.max.y,v+=a.normal.y*this.min.y),a.normal.z>0?(s+=a.normal.z*this.min.z,v+=a.normal.z*this.max.z):(s+=a.normal.z*this.max.z,v+=a.normal.z*this.min.z),s<=-a.constant&&v>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(a.a,_center),_v1$7.subVectors(a.b,_center),_v2$4.subVectors(a.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let s=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(s,_v0$2,_v1$7,_v2$4,_extents)||(s=[1,0,0,0,1,0,0,0,1],!satForAxes(s,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),s=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(s,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(a,s){return s.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,_vector$a).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=this.getSize(_vector$a).length()*.5),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(_points),this)}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(u,a,s,v,x){for(let M=0,I=u.length-3;M<=I;M+=3){_testAxis.fromArray(u,M);const B=x.x*Math.abs(_testAxis.x)+x.y*Math.abs(_testAxis.y)+x.z*Math.abs(_testAxis.z),U=a.dot(_testAxis),j=s.dot(_testAxis),te=v.dot(_testAxis);if(Math.max(-Math.max(U,j,te),Math.min(U,j,te))>B)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(a=new Vector3,s=-1){this.center=a,this.radius=s}set(a,s){return this.center.copy(a),this.radius=s,this}setFromPoints(a,s){const v=this.center;s!==void 0?v.copy(s):_box$2.setFromPoints(a).getCenter(v);let x=0;for(let M=0,I=a.length;M<I;M++)x=Math.max(x,v.distanceToSquared(a[M]));return this.radius=Math.sqrt(x),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const s=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=s*s}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,s){const v=this.center.distanceToSquared(a);return s.copy(a),v>this.radius*this.radius&&(s.sub(this.center).normalize(),s.multiplyScalar(this.radius).add(this.center)),s}getBoundingBox(a){return this.isEmpty()?(a.makeEmpty(),a):(a.set(this.center,this.center),a.expandByScalar(this.radius),a)}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;_v1$6.subVectors(a,this.center);const s=_v1$6.lengthSq();if(s>this.radius*this.radius){const v=Math.sqrt(s),x=(v-this.radius)*.5;this.center.addScaledVector(_v1$6,x/v),this.radius+=x}return this}union(a){return a.isEmpty()?this:this.isEmpty()?(this.copy(a),this):(this.center.equals(a.center)===!0?this.radius=Math.max(this.radius,a.radius):(_v2$3.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(_v1$6.copy(a.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(a.center).sub(_v2$3))),this)}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(a=new Vector3,s=new Vector3(0,0,-1)){this.origin=a,this.direction=s}set(a,s){return this.origin.copy(a),this.direction.copy(s),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,s){return s.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,_vector$9)),this}closestPointToPoint(a,s){s.subVectors(a,this.origin);const v=s.dot(this.direction);return v<0?s.copy(this.origin):s.copy(this.origin).addScaledVector(this.direction,v)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const s=_vector$9.subVectors(a,this.origin).dot(this.direction);return s<0?this.origin.distanceToSquared(a):(_vector$9.copy(this.origin).addScaledVector(this.direction,s),_vector$9.distanceToSquared(a))}distanceSqToSegment(a,s,v,x){_segCenter.copy(a).add(s).multiplyScalar(.5),_segDir.copy(s).sub(a).normalize(),_diff.copy(this.origin).sub(_segCenter);const M=a.distanceTo(s)*.5,I=-this.direction.dot(_segDir),B=_diff.dot(this.direction),U=-_diff.dot(_segDir),j=_diff.lengthSq(),te=Math.abs(1-I*I);let Z,oe,le,se;if(te>0)if(Z=I*U-B,oe=I*B-U,se=M*te,Z>=0)if(oe>=-se)if(oe<=se){const ve=1/te;Z*=ve,oe*=ve,le=Z*(Z+I*oe+2*B)+oe*(I*Z+oe+2*U)+j}else oe=M,Z=Math.max(0,-(I*oe+B)),le=-Z*Z+oe*(oe+2*U)+j;else oe=-M,Z=Math.max(0,-(I*oe+B)),le=-Z*Z+oe*(oe+2*U)+j;else oe<=-se?(Z=Math.max(0,-(-I*M+B)),oe=Z>0?-M:Math.min(Math.max(-M,-U),M),le=-Z*Z+oe*(oe+2*U)+j):oe<=se?(Z=0,oe=Math.min(Math.max(-M,-U),M),le=oe*(oe+2*U)+j):(Z=Math.max(0,-(I*M+B)),oe=Z>0?M:Math.min(Math.max(-M,-U),M),le=-Z*Z+oe*(oe+2*U)+j);else oe=I>0?-M:M,Z=Math.max(0,-(I*oe+B)),le=-Z*Z+oe*(oe+2*U)+j;return v&&v.copy(this.origin).addScaledVector(this.direction,Z),x&&x.copy(_segCenter).addScaledVector(_segDir,oe),le}intersectSphere(a,s){_vector$9.subVectors(a.center,this.origin);const v=_vector$9.dot(this.direction),x=_vector$9.dot(_vector$9)-v*v,M=a.radius*a.radius;if(x>M)return null;const I=Math.sqrt(M-x),B=v-I,U=v+I;return U<0?null:B<0?this.at(U,s):this.at(B,s)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const s=a.normal.dot(this.direction);if(s===0)return a.distanceToPoint(this.origin)===0?0:null;const v=-(this.origin.dot(a.normal)+a.constant)/s;return v>=0?v:null}intersectPlane(a,s){const v=this.distanceToPlane(a);return v===null?null:this.at(v,s)}intersectsPlane(a){const s=a.distanceToPoint(this.origin);return s===0||a.normal.dot(this.direction)*s<0}intersectBox(a,s){let v,x,M,I,B,U;const j=1/this.direction.x,te=1/this.direction.y,Z=1/this.direction.z,oe=this.origin;return j>=0?(v=(a.min.x-oe.x)*j,x=(a.max.x-oe.x)*j):(v=(a.max.x-oe.x)*j,x=(a.min.x-oe.x)*j),te>=0?(M=(a.min.y-oe.y)*te,I=(a.max.y-oe.y)*te):(M=(a.max.y-oe.y)*te,I=(a.min.y-oe.y)*te),v>I||M>x||((M>v||isNaN(v))&&(v=M),(I<x||isNaN(x))&&(x=I),Z>=0?(B=(a.min.z-oe.z)*Z,U=(a.max.z-oe.z)*Z):(B=(a.max.z-oe.z)*Z,U=(a.min.z-oe.z)*Z),v>U||B>x)||((B>v||v!==v)&&(v=B),(U<x||x!==x)&&(x=U),x<0)?null:this.at(v>=0?v:x,s)}intersectsBox(a){return this.intersectBox(a,_vector$9)!==null}intersectTriangle(a,s,v,x,M){_edge1.subVectors(s,a),_edge2.subVectors(v,a),_normal$1.crossVectors(_edge1,_edge2);let I=this.direction.dot(_normal$1),B;if(I>0){if(x)return null;B=1}else if(I<0)B=-1,I=-I;else return null;_diff.subVectors(this.origin,a);const U=B*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(U<0)return null;const j=B*this.direction.dot(_edge1.cross(_diff));if(j<0||U+j>I)return null;const te=-B*_diff.dot(_normal$1);return te<0?null:this.at(te/I,M)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(a,s,v,x,M,I,B,U,j,te,Z,oe,le,se,ve,ce){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a!==void 0&&this.set(a,s,v,x,M,I,B,U,j,te,Z,oe,le,se,ve,ce)}set(a,s,v,x,M,I,B,U,j,te,Z,oe,le,se,ve,ce){const K=this.elements;return K[0]=a,K[4]=s,K[8]=v,K[12]=x,K[1]=M,K[5]=I,K[9]=B,K[13]=U,K[2]=j,K[6]=te,K[10]=Z,K[14]=oe,K[3]=le,K[7]=se,K[11]=ve,K[15]=ce,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(a){const s=this.elements,v=a.elements;return s[0]=v[0],s[1]=v[1],s[2]=v[2],s[3]=v[3],s[4]=v[4],s[5]=v[5],s[6]=v[6],s[7]=v[7],s[8]=v[8],s[9]=v[9],s[10]=v[10],s[11]=v[11],s[12]=v[12],s[13]=v[13],s[14]=v[14],s[15]=v[15],this}copyPosition(a){const s=this.elements,v=a.elements;return s[12]=v[12],s[13]=v[13],s[14]=v[14],this}setFromMatrix3(a){const s=a.elements;return this.set(s[0],s[3],s[6],0,s[1],s[4],s[7],0,s[2],s[5],s[8],0,0,0,0,1),this}extractBasis(a,s,v){return a.setFromMatrixColumn(this,0),s.setFromMatrixColumn(this,1),v.setFromMatrixColumn(this,2),this}makeBasis(a,s,v){return this.set(a.x,s.x,v.x,0,a.y,s.y,v.y,0,a.z,s.z,v.z,0,0,0,0,1),this}extractRotation(a){const s=this.elements,v=a.elements,x=1/_v1$5.setFromMatrixColumn(a,0).length(),M=1/_v1$5.setFromMatrixColumn(a,1).length(),I=1/_v1$5.setFromMatrixColumn(a,2).length();return s[0]=v[0]*x,s[1]=v[1]*x,s[2]=v[2]*x,s[3]=0,s[4]=v[4]*M,s[5]=v[5]*M,s[6]=v[6]*M,s[7]=0,s[8]=v[8]*I,s[9]=v[9]*I,s[10]=v[10]*I,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromEuler(a){const s=this.elements,v=a.x,x=a.y,M=a.z,I=Math.cos(v),B=Math.sin(v),U=Math.cos(x),j=Math.sin(x),te=Math.cos(M),Z=Math.sin(M);if(a.order==="XYZ"){const oe=I*te,le=I*Z,se=B*te,ve=B*Z;s[0]=U*te,s[4]=-U*Z,s[8]=j,s[1]=le+se*j,s[5]=oe-ve*j,s[9]=-B*U,s[2]=ve-oe*j,s[6]=se+le*j,s[10]=I*U}else if(a.order==="YXZ"){const oe=U*te,le=U*Z,se=j*te,ve=j*Z;s[0]=oe+ve*B,s[4]=se*B-le,s[8]=I*j,s[1]=I*Z,s[5]=I*te,s[9]=-B,s[2]=le*B-se,s[6]=ve+oe*B,s[10]=I*U}else if(a.order==="ZXY"){const oe=U*te,le=U*Z,se=j*te,ve=j*Z;s[0]=oe-ve*B,s[4]=-I*Z,s[8]=se+le*B,s[1]=le+se*B,s[5]=I*te,s[9]=ve-oe*B,s[2]=-I*j,s[6]=B,s[10]=I*U}else if(a.order==="ZYX"){const oe=I*te,le=I*Z,se=B*te,ve=B*Z;s[0]=U*te,s[4]=se*j-le,s[8]=oe*j+ve,s[1]=U*Z,s[5]=ve*j+oe,s[9]=le*j-se,s[2]=-j,s[6]=B*U,s[10]=I*U}else if(a.order==="YZX"){const oe=I*U,le=I*j,se=B*U,ve=B*j;s[0]=U*te,s[4]=ve-oe*Z,s[8]=se*Z+le,s[1]=Z,s[5]=I*te,s[9]=-B*te,s[2]=-j*te,s[6]=le*Z+se,s[10]=oe-ve*Z}else if(a.order==="XZY"){const oe=I*U,le=I*j,se=B*U,ve=B*j;s[0]=U*te,s[4]=-Z,s[8]=j*te,s[1]=oe*Z+ve,s[5]=I*te,s[9]=le*Z-se,s[2]=se*Z-le,s[6]=B*te,s[10]=ve*Z+oe}return s[3]=0,s[7]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}makeRotationFromQuaternion(a){return this.compose(_zero,a,_one)}lookAt(a,s,v){const x=this.elements;return _z.subVectors(a,s),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(v,_z),_x.lengthSq()===0&&(Math.abs(v.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(v,_z)),_x.normalize(),_y.crossVectors(_z,_x),x[0]=_x.x,x[4]=_y.x,x[8]=_z.x,x[1]=_x.y,x[5]=_y.y,x[9]=_z.y,x[2]=_x.z,x[6]=_y.z,x[10]=_z.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,s){const v=a.elements,x=s.elements,M=this.elements,I=v[0],B=v[4],U=v[8],j=v[12],te=v[1],Z=v[5],oe=v[9],le=v[13],se=v[2],ve=v[6],ce=v[10],K=v[14],X=v[3],W=v[7],_e=v[11],ge=v[15],Ae=x[0],ee=x[4],$=x[8],ae=x[12],Re=x[1],pe=x[5],he=x[9],we=x[13],Ce=x[2],Ne=x[6],Ze=x[10],Ye=x[14],it=x[3],_t=x[7],At=x[11],vt=x[15];return M[0]=I*Ae+B*Re+U*Ce+j*it,M[4]=I*ee+B*pe+U*Ne+j*_t,M[8]=I*$+B*he+U*Ze+j*At,M[12]=I*ae+B*we+U*Ye+j*vt,M[1]=te*Ae+Z*Re+oe*Ce+le*it,M[5]=te*ee+Z*pe+oe*Ne+le*_t,M[9]=te*$+Z*he+oe*Ze+le*At,M[13]=te*ae+Z*we+oe*Ye+le*vt,M[2]=se*Ae+ve*Re+ce*Ce+K*it,M[6]=se*ee+ve*pe+ce*Ne+K*_t,M[10]=se*$+ve*he+ce*Ze+K*At,M[14]=se*ae+ve*we+ce*Ye+K*vt,M[3]=X*Ae+W*Re+_e*Ce+ge*it,M[7]=X*ee+W*pe+_e*Ne+ge*_t,M[11]=X*$+W*he+_e*Ze+ge*At,M[15]=X*ae+W*we+_e*Ye+ge*vt,this}multiplyScalar(a){const s=this.elements;return s[0]*=a,s[4]*=a,s[8]*=a,s[12]*=a,s[1]*=a,s[5]*=a,s[9]*=a,s[13]*=a,s[2]*=a,s[6]*=a,s[10]*=a,s[14]*=a,s[3]*=a,s[7]*=a,s[11]*=a,s[15]*=a,this}determinant(){const a=this.elements,s=a[0],v=a[4],x=a[8],M=a[12],I=a[1],B=a[5],U=a[9],j=a[13],te=a[2],Z=a[6],oe=a[10],le=a[14],se=a[3],ve=a[7],ce=a[11],K=a[15];return se*(+M*U*Z-x*j*Z-M*B*oe+v*j*oe+x*B*le-v*U*le)+ve*(+s*U*le-s*j*oe+M*I*oe-x*I*le+x*j*te-M*U*te)+ce*(+s*j*Z-s*B*le-M*I*Z+v*I*le+M*B*te-v*j*te)+K*(-x*B*te-s*U*Z+s*B*oe+x*I*Z-v*I*oe+v*U*te)}transpose(){const a=this.elements;let s;return s=a[1],a[1]=a[4],a[4]=s,s=a[2],a[2]=a[8],a[8]=s,s=a[6],a[6]=a[9],a[9]=s,s=a[3],a[3]=a[12],a[12]=s,s=a[7],a[7]=a[13],a[13]=s,s=a[11],a[11]=a[14],a[14]=s,this}setPosition(a,s,v){const x=this.elements;return a.isVector3?(x[12]=a.x,x[13]=a.y,x[14]=a.z):(x[12]=a,x[13]=s,x[14]=v),this}invert(){const a=this.elements,s=a[0],v=a[1],x=a[2],M=a[3],I=a[4],B=a[5],U=a[6],j=a[7],te=a[8],Z=a[9],oe=a[10],le=a[11],se=a[12],ve=a[13],ce=a[14],K=a[15],X=Z*ce*j-ve*oe*j+ve*U*le-B*ce*le-Z*U*K+B*oe*K,W=se*oe*j-te*ce*j-se*U*le+I*ce*le+te*U*K-I*oe*K,_e=te*ve*j-se*Z*j+se*B*le-I*ve*le-te*B*K+I*Z*K,ge=se*Z*U-te*ve*U-se*B*oe+I*ve*oe+te*B*ce-I*Z*ce,Ae=s*X+v*W+x*_e+M*ge;if(Ae===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ee=1/Ae;return a[0]=X*ee,a[1]=(ve*oe*M-Z*ce*M-ve*x*le+v*ce*le+Z*x*K-v*oe*K)*ee,a[2]=(B*ce*M-ve*U*M+ve*x*j-v*ce*j-B*x*K+v*U*K)*ee,a[3]=(Z*U*M-B*oe*M-Z*x*j+v*oe*j+B*x*le-v*U*le)*ee,a[4]=W*ee,a[5]=(te*ce*M-se*oe*M+se*x*le-s*ce*le-te*x*K+s*oe*K)*ee,a[6]=(se*U*M-I*ce*M-se*x*j+s*ce*j+I*x*K-s*U*K)*ee,a[7]=(I*oe*M-te*U*M+te*x*j-s*oe*j-I*x*le+s*U*le)*ee,a[8]=_e*ee,a[9]=(se*Z*M-te*ve*M-se*v*le+s*ve*le+te*v*K-s*Z*K)*ee,a[10]=(I*ve*M-se*B*M+se*v*j-s*ve*j-I*v*K+s*B*K)*ee,a[11]=(te*B*M-I*Z*M-te*v*j+s*Z*j+I*v*le-s*B*le)*ee,a[12]=ge*ee,a[13]=(te*ve*x-se*Z*x+se*v*oe-s*ve*oe-te*v*ce+s*Z*ce)*ee,a[14]=(se*B*x-I*ve*x-se*v*U+s*ve*U+I*v*ce-s*B*ce)*ee,a[15]=(I*Z*x-te*B*x+te*v*U-s*Z*U-I*v*oe+s*B*oe)*ee,this}scale(a){const s=this.elements,v=a.x,x=a.y,M=a.z;return s[0]*=v,s[4]*=x,s[8]*=M,s[1]*=v,s[5]*=x,s[9]*=M,s[2]*=v,s[6]*=x,s[10]*=M,s[3]*=v,s[7]*=x,s[11]*=M,this}getMaxScaleOnAxis(){const a=this.elements,s=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],v=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],x=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(s,v,x))}makeTranslation(a,s,v){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,s,0,0,1,v,0,0,0,1),this}makeRotationX(a){const s=Math.cos(a),v=Math.sin(a);return this.set(1,0,0,0,0,s,-v,0,0,v,s,0,0,0,0,1),this}makeRotationY(a){const s=Math.cos(a),v=Math.sin(a);return this.set(s,0,v,0,0,1,0,0,-v,0,s,0,0,0,0,1),this}makeRotationZ(a){const s=Math.cos(a),v=Math.sin(a);return this.set(s,-v,0,0,v,s,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,s){const v=Math.cos(s),x=Math.sin(s),M=1-v,I=a.x,B=a.y,U=a.z,j=M*I,te=M*B;return this.set(j*I+v,j*B-x*U,j*U+x*B,0,j*B+x*U,te*B+v,te*U-x*I,0,j*U-x*B,te*U+x*I,M*U*U+v,0,0,0,0,1),this}makeScale(a,s,v){return this.set(a,0,0,0,0,s,0,0,0,0,v,0,0,0,0,1),this}makeShear(a,s,v,x,M,I){return this.set(1,v,M,0,a,1,I,0,s,x,1,0,0,0,0,1),this}compose(a,s,v){const x=this.elements,M=s._x,I=s._y,B=s._z,U=s._w,j=M+M,te=I+I,Z=B+B,oe=M*j,le=M*te,se=M*Z,ve=I*te,ce=I*Z,K=B*Z,X=U*j,W=U*te,_e=U*Z,ge=v.x,Ae=v.y,ee=v.z;return x[0]=(1-(ve+K))*ge,x[1]=(le+_e)*ge,x[2]=(se-W)*ge,x[3]=0,x[4]=(le-_e)*Ae,x[5]=(1-(oe+K))*Ae,x[6]=(ce+X)*Ae,x[7]=0,x[8]=(se+W)*ee,x[9]=(ce-X)*ee,x[10]=(1-(oe+ve))*ee,x[11]=0,x[12]=a.x,x[13]=a.y,x[14]=a.z,x[15]=1,this}decompose(a,s,v){const x=this.elements;let M=_v1$5.set(x[0],x[1],x[2]).length();const I=_v1$5.set(x[4],x[5],x[6]).length(),B=_v1$5.set(x[8],x[9],x[10]).length();this.determinant()<0&&(M=-M),a.x=x[12],a.y=x[13],a.z=x[14],_m1$2.copy(this);const j=1/M,te=1/I,Z=1/B;return _m1$2.elements[0]*=j,_m1$2.elements[1]*=j,_m1$2.elements[2]*=j,_m1$2.elements[4]*=te,_m1$2.elements[5]*=te,_m1$2.elements[6]*=te,_m1$2.elements[8]*=Z,_m1$2.elements[9]*=Z,_m1$2.elements[10]*=Z,s.setFromRotationMatrix(_m1$2),v.x=M,v.y=I,v.z=B,this}makePerspective(a,s,v,x,M,I,B=WebGLCoordinateSystem){const U=this.elements,j=2*M/(s-a),te=2*M/(v-x),Z=(s+a)/(s-a),oe=(v+x)/(v-x);let le,se;if(B===WebGLCoordinateSystem)le=-(I+M)/(I-M),se=-2*I*M/(I-M);else if(B===WebGPUCoordinateSystem)le=-I/(I-M),se=-I*M/(I-M);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+B);return U[0]=j,U[4]=0,U[8]=Z,U[12]=0,U[1]=0,U[5]=te,U[9]=oe,U[13]=0,U[2]=0,U[6]=0,U[10]=le,U[14]=se,U[3]=0,U[7]=0,U[11]=-1,U[15]=0,this}makeOrthographic(a,s,v,x,M,I,B=WebGLCoordinateSystem){const U=this.elements,j=1/(s-a),te=1/(v-x),Z=1/(I-M),oe=(s+a)*j,le=(v+x)*te;let se,ve;if(B===WebGLCoordinateSystem)se=(I+M)*Z,ve=-2*Z;else if(B===WebGPUCoordinateSystem)se=M*Z,ve=-1*Z;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+B);return U[0]=2*j,U[4]=0,U[8]=0,U[12]=-oe,U[1]=0,U[5]=2*te,U[9]=0,U[13]=-le,U[2]=0,U[6]=0,U[10]=ve,U[14]=-se,U[3]=0,U[7]=0,U[11]=0,U[15]=1,this}equals(a){const s=this.elements,v=a.elements;for(let x=0;x<16;x++)if(s[x]!==v[x])return!1;return!0}fromArray(a,s=0){for(let v=0;v<16;v++)this.elements[v]=a[v+s];return this}toArray(a=[],s=0){const v=this.elements;return a[s]=v[0],a[s+1]=v[1],a[s+2]=v[2],a[s+3]=v[3],a[s+4]=v[4],a[s+5]=v[5],a[s+6]=v[6],a[s+7]=v[7],a[s+8]=v[8],a[s+9]=v[9],a[s+10]=v[10],a[s+11]=v[11],a[s+12]=v[12],a[s+13]=v[13],a[s+14]=v[14],a[s+15]=v[15],a}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(a=0,s=0,v=0,x=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=s,this._z=v,this._order=x}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,s,v,x=this._order){return this._x=a,this._y=s,this._z=v,this._order=x,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,s=this._order,v=!0){const x=a.elements,M=x[0],I=x[4],B=x[8],U=x[1],j=x[5],te=x[9],Z=x[2],oe=x[6],le=x[10];switch(s){case"XYZ":this._y=Math.asin(clamp(B,-1,1)),Math.abs(B)<.9999999?(this._x=Math.atan2(-te,le),this._z=Math.atan2(-I,M)):(this._x=Math.atan2(oe,j),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(te,-1,1)),Math.abs(te)<.9999999?(this._y=Math.atan2(B,le),this._z=Math.atan2(U,j)):(this._y=Math.atan2(-Z,M),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(oe,-1,1)),Math.abs(oe)<.9999999?(this._y=Math.atan2(-Z,le),this._z=Math.atan2(-I,j)):(this._y=0,this._z=Math.atan2(U,M));break;case"ZYX":this._y=Math.asin(-clamp(Z,-1,1)),Math.abs(Z)<.9999999?(this._x=Math.atan2(oe,le),this._z=Math.atan2(U,M)):(this._x=0,this._z=Math.atan2(-I,j));break;case"YZX":this._z=Math.asin(clamp(U,-1,1)),Math.abs(U)<.9999999?(this._x=Math.atan2(-te,j),this._y=Math.atan2(-Z,M)):(this._x=0,this._y=Math.atan2(B,le));break;case"XZY":this._z=Math.asin(-clamp(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(oe,j),this._y=Math.atan2(B,M)):(this._x=Math.atan2(-te,le),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+s)}return this._order=s,v===!0&&this._onChangeCallback(),this}setFromQuaternion(a,s,v){return _matrix.makeRotationFromQuaternion(a),this.setFromRotationMatrix(_matrix,s,v)}setFromVector3(a,s=this._order){return this.set(a.x,a.y,a.z,s)}reorder(a){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],a[3]!==void 0&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],s=0){return a[s]=this._x,a[s+1]=this._y,a[s+2]=this._z,a[s+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask|=1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!==0}isEnabled(a){return(this.mask&(1<<a|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const a=new Vector3,s=new Euler,v=new Quaternion,x=new Vector3(1,1,1);function M(){v.setFromEuler(s,!1)}function I(){s.setFromQuaternion(v,void 0,!1)}s._onChange(M),v._onChange(I),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:s},quaternion:{configurable:!0,enumerable:!0,value:v},scale:{configurable:!0,enumerable:!0,value:x},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,s){this.quaternion.setFromAxisAngle(a,s)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,s){return _q1.setFromAxisAngle(a,s),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(a,s){return _q1.setFromAxisAngle(a,s),this.quaternion.premultiply(_q1),this}rotateX(a){return this.rotateOnAxis(_xAxis,a)}rotateY(a){return this.rotateOnAxis(_yAxis,a)}rotateZ(a){return this.rotateOnAxis(_zAxis,a)}translateOnAxis(a,s){return _v1$4.copy(a).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(s)),this}translateX(a){return this.translateOnAxis(_xAxis,a)}translateY(a){return this.translateOnAxis(_yAxis,a)}translateZ(a){return this.translateOnAxis(_zAxis,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(a,s,v){a.isVector3?_target.copy(a):_target.set(a,s,v);const x=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),x&&(_m1$1.extractRotation(x.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(a){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.add(arguments[s]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(a.parent!==null&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)}remove(a){if(arguments.length>1){for(let v=0;v<arguments.length;v++)this.remove(arguments[v]);return this}const s=this.children.indexOf(a);return s!==-1&&(a.parent=null,this.children.splice(s,1),a.dispatchEvent(_removedEvent)),this}removeFromParent(){const a=this.parent;return a!==null&&a.remove(this),this}clear(){for(let a=0;a<this.children.length;a++){const s=this.children[a];s.parent=null,s.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(a){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),a.parent!==null&&(a.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(a.parent.matrixWorld)),a.applyMatrix4(_m1$1),this.add(a),a.updateWorldMatrix(!1,!0),this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,s){if(this[a]===s)return this;for(let v=0,x=this.children.length;v<x;v++){const I=this.children[v].getObjectByProperty(a,s);if(I!==void 0)return I}}getObjectsByProperty(a,s){let v=[];this[a]===s&&v.push(this);for(let x=0,M=this.children.length;x<M;x++){const I=this.children[x].getObjectsByProperty(a,s);I.length>0&&(v=v.concat(I))}return v}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,a,_scale$2),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const s=this.matrixWorld.elements;return a.set(s[8],s[9],s[10]).normalize()}raycast(){}traverse(a){a(this);const s=this.children;for(let v=0,x=s.length;v<x;v++)s[v].traverse(a)}traverseVisible(a){if(this.visible===!1)return;a(this);const s=this.children;for(let v=0,x=s.length;v<x;v++)s[v].traverseVisible(a)}traverseAncestors(a){const s=this.parent;s!==null&&(a(s),s.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);const s=this.children;for(let v=0,x=s.length;v<x;v++){const M=s[v];(M.matrixWorldAutoUpdate===!0||a===!0)&&M.updateMatrixWorld(a)}}updateWorldMatrix(a,s){const v=this.parent;if(a===!0&&v!==null&&v.matrixWorldAutoUpdate===!0&&v.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),s===!0){const x=this.children;for(let M=0,I=x.length;M<I;M++){const B=x[M];B.matrixWorldAutoUpdate===!0&&B.updateWorldMatrix(!1,!0)}}}toJSON(a){const s=a===void 0||typeof a=="string",v={};s&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},v.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const x={};x.uuid=this.uuid,x.type=this.type,this.name!==""&&(x.name=this.name),this.castShadow===!0&&(x.castShadow=!0),this.receiveShadow===!0&&(x.receiveShadow=!0),this.visible===!1&&(x.visible=!1),this.frustumCulled===!1&&(x.frustumCulled=!1),this.renderOrder!==0&&(x.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(x.userData=this.userData),x.layers=this.layers.mask,x.matrix=this.matrix.toArray(),x.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(x.matrixAutoUpdate=!1),this.isInstancedMesh&&(x.type="InstancedMesh",x.count=this.count,x.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(x.instanceColor=this.instanceColor.toJSON()));function M(B,U){return B[U.uuid]===void 0&&(B[U.uuid]=U.toJSON(a)),U.uuid}if(this.isScene)this.background&&(this.background.isColor?x.background=this.background.toJSON():this.background.isTexture&&(x.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(x.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){x.geometry=M(a.geometries,this.geometry);const B=this.geometry.parameters;if(B!==void 0&&B.shapes!==void 0){const U=B.shapes;if(Array.isArray(U))for(let j=0,te=U.length;j<te;j++){const Z=U[j];M(a.shapes,Z)}else M(a.shapes,U)}}if(this.isSkinnedMesh&&(x.bindMode=this.bindMode,x.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(M(a.skeletons,this.skeleton),x.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const B=[];for(let U=0,j=this.material.length;U<j;U++)B.push(M(a.materials,this.material[U]));x.material=B}else x.material=M(a.materials,this.material);if(this.children.length>0){x.children=[];for(let B=0;B<this.children.length;B++)x.children.push(this.children[B].toJSON(a).object)}if(this.animations.length>0){x.animations=[];for(let B=0;B<this.animations.length;B++){const U=this.animations[B];x.animations.push(M(a.animations,U))}}if(s){const B=I(a.geometries),U=I(a.materials),j=I(a.textures),te=I(a.images),Z=I(a.shapes),oe=I(a.skeletons),le=I(a.animations),se=I(a.nodes);B.length>0&&(v.geometries=B),U.length>0&&(v.materials=U),j.length>0&&(v.textures=j),te.length>0&&(v.images=te),Z.length>0&&(v.shapes=Z),oe.length>0&&(v.skeletons=oe),le.length>0&&(v.animations=le),se.length>0&&(v.nodes=se)}return v.object=x,v;function I(B){const U=[];for(const j in B){const te=B[j];delete te.metadata,U.push(te)}return U}}clone(a){return new this.constructor().copy(this,a)}copy(a,s=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),s===!0)for(let v=0;v<a.children.length;v++){const x=a.children[v];this.add(x.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(a=new Vector3,s=new Vector3,v=new Vector3){this.a=a,this.b=s,this.c=v}static getNormal(a,s,v,x){x.subVectors(v,s),_v0$1.subVectors(a,s),x.cross(_v0$1);const M=x.lengthSq();return M>0?x.multiplyScalar(1/Math.sqrt(M)):x.set(0,0,0)}static getBarycoord(a,s,v,x,M){_v0$1.subVectors(x,s),_v1$3.subVectors(v,s),_v2$2.subVectors(a,s);const I=_v0$1.dot(_v0$1),B=_v0$1.dot(_v1$3),U=_v0$1.dot(_v2$2),j=_v1$3.dot(_v1$3),te=_v1$3.dot(_v2$2),Z=I*j-B*B;if(Z===0)return M.set(-2,-1,-1);const oe=1/Z,le=(j*U-B*te)*oe,se=(I*te-B*U)*oe;return M.set(1-le-se,se,le)}static containsPoint(a,s,v,x){return this.getBarycoord(a,s,v,x,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(a,s,v,x,M,I,B,U){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(a,s,v,x,M,I,B,U)}static getInterpolation(a,s,v,x,M,I,B,U){return this.getBarycoord(a,s,v,x,_v3$1),U.setScalar(0),U.addScaledVector(M,_v3$1.x),U.addScaledVector(I,_v3$1.y),U.addScaledVector(B,_v3$1.z),U}static isFrontFacing(a,s,v,x){return _v0$1.subVectors(v,s),_v1$3.subVectors(a,s),_v0$1.cross(_v1$3).dot(x)<0}set(a,s,v){return this.a.copy(a),this.b.copy(s),this.c.copy(v),this}setFromPointsAndIndices(a,s,v,x){return this.a.copy(a[s]),this.b.copy(a[v]),this.c.copy(a[x]),this}setFromAttributeAndIndices(a,s,v,x){return this.a.fromBufferAttribute(a,s),this.b.fromBufferAttribute(a,v),this.c.fromBufferAttribute(a,x),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return Triangle.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,s){return Triangle.getBarycoord(a,this.a,this.b,this.c,s)}getUV(a,s,v,x,M){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(a,this.a,this.b,this.c,s,v,x,M)}getInterpolation(a,s,v,x,M){return Triangle.getInterpolation(a,this.a,this.b,this.c,s,v,x,M)}containsPoint(a){return Triangle.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return Triangle.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,s){const v=this.a,x=this.b,M=this.c;let I,B;_vab.subVectors(x,v),_vac.subVectors(M,v),_vap.subVectors(a,v);const U=_vab.dot(_vap),j=_vac.dot(_vap);if(U<=0&&j<=0)return s.copy(v);_vbp.subVectors(a,x);const te=_vab.dot(_vbp),Z=_vac.dot(_vbp);if(te>=0&&Z<=te)return s.copy(x);const oe=U*Z-te*j;if(oe<=0&&U>=0&&te<=0)return I=U/(U-te),s.copy(v).addScaledVector(_vab,I);_vcp.subVectors(a,M);const le=_vab.dot(_vcp),se=_vac.dot(_vcp);if(se>=0&&le<=se)return s.copy(M);const ve=le*j-U*se;if(ve<=0&&j>=0&&se<=0)return B=j/(j-se),s.copy(v).addScaledVector(_vac,B);const ce=te*se-le*Z;if(ce<=0&&Z-te>=0&&le-se>=0)return _vbc.subVectors(M,x),B=(Z-te)/(Z-te+(le-se)),s.copy(x).addScaledVector(_vbc,B);const K=1/(ce+ve+oe);return I=ve*K,B=oe*K,s.copy(v).addScaledVector(_vab,I).addScaledVector(_vac,B)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}let materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(a!==void 0)for(const s in a){const v=a[s];if(v===void 0){console.warn(`THREE.Material: parameter '${s}' has value of undefined.`);continue}const x=this[s];if(x===void 0){console.warn(`THREE.Material: '${s}' is not a property of THREE.${this.type}.`);continue}x&&x.isColor?x.set(v):x&&x.isVector3&&v&&v.isVector3?x.copy(v):this[s]=v}}toJSON(a){const s=a===void 0||typeof a=="string";s&&(a={textures:{},images:{}});const v={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};v.uuid=this.uuid,v.type=this.type,this.name!==""&&(v.name=this.name),this.color&&this.color.isColor&&(v.color=this.color.getHex()),this.roughness!==void 0&&(v.roughness=this.roughness),this.metalness!==void 0&&(v.metalness=this.metalness),this.sheen!==void 0&&(v.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(v.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(v.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(v.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(v.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(v.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(v.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(v.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(v.shininess=this.shininess),this.clearcoat!==void 0&&(v.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(v.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(v.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(v.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(v.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,v.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(v.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(v.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(v.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(v.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(v.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),this.anisotropy!==void 0&&(v.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(v.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(v.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(v.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(v.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(v.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(v.lightMap=this.lightMap.toJSON(a).uuid,v.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(v.aoMap=this.aoMap.toJSON(a).uuid,v.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(v.bumpMap=this.bumpMap.toJSON(a).uuid,v.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(v.normalMap=this.normalMap.toJSON(a).uuid,v.normalMapType=this.normalMapType,v.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(v.displacementMap=this.displacementMap.toJSON(a).uuid,v.displacementScale=this.displacementScale,v.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(v.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(v.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(v.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(v.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(v.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(v.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(v.envMap=this.envMap.toJSON(a).uuid,this.combine!==void 0&&(v.combine=this.combine)),this.envMapIntensity!==void 0&&(v.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(v.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(v.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(v.gradientMap=this.gradientMap.toJSON(a).uuid),this.transmission!==void 0&&(v.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(v.transmissionMap=this.transmissionMap.toJSON(a).uuid),this.thickness!==void 0&&(v.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(v.thicknessMap=this.thicknessMap.toJSON(a).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(v.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(v.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(v.size=this.size),this.shadowSide!==null&&(v.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(v.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(v.blending=this.blending),this.side!==FrontSide&&(v.side=this.side),this.vertexColors&&(v.vertexColors=!0),this.opacity<1&&(v.opacity=this.opacity),this.transparent===!0&&(v.transparent=this.transparent),v.depthFunc=this.depthFunc,v.depthTest=this.depthTest,v.depthWrite=this.depthWrite,v.colorWrite=this.colorWrite,v.stencilWrite=this.stencilWrite,v.stencilWriteMask=this.stencilWriteMask,v.stencilFunc=this.stencilFunc,v.stencilRef=this.stencilRef,v.stencilFuncMask=this.stencilFuncMask,v.stencilFail=this.stencilFail,v.stencilZFail=this.stencilZFail,v.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(v.rotation=this.rotation),this.polygonOffset===!0&&(v.polygonOffset=!0),this.polygonOffsetFactor!==0&&(v.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(v.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(v.linewidth=this.linewidth),this.dashSize!==void 0&&(v.dashSize=this.dashSize),this.gapSize!==void 0&&(v.gapSize=this.gapSize),this.scale!==void 0&&(v.scale=this.scale),this.dithering===!0&&(v.dithering=!0),this.alphaTest>0&&(v.alphaTest=this.alphaTest),this.alphaHash===!0&&(v.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(v.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(v.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(v.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(v.wireframe=this.wireframe),this.wireframeLinewidth>1&&(v.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(v.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(v.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(v.flatShading=this.flatShading),this.visible===!1&&(v.visible=!1),this.toneMapped===!1&&(v.toneMapped=!1),this.fog===!1&&(v.fog=!1),Object.keys(this.userData).length>0&&(v.userData=this.userData);function x(M){const I=[];for(const B in M){const U=M[B];delete U.metadata,I.push(U)}return I}if(s){const M=x(a.textures),I=x(a.images);M.length>0&&(v.textures=M),I.length>0&&(v.images=I)}return v}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;const s=a.clippingPlanes;let v=null;if(s!==null){const x=s.length;v=new Array(x);for(let M=0;M!==x;++M)v[M]=s[M].clone()}return this.clippingPlanes=v,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){a===!0&&this.version++}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(u,a,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?u+(a-u)*6*s:s<1/2?a:s<2/3?u+(a-u)*6*(2/3-s):u}class Color{constructor(a,s,v){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,s,v)}set(a,s,v){if(s===void 0&&v===void 0){const x=a;x&&x.isColor?this.copy(x):typeof x=="number"?this.setHex(x):typeof x=="string"&&this.setStyle(x)}else this.setRGB(a,s,v);return this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,s=SRGBColorSpace){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(a&255)/255,ColorManagement.toWorkingColorSpace(this,s),this}setRGB(a,s,v,x=ColorManagement.workingColorSpace){return this.r=a,this.g=s,this.b=v,ColorManagement.toWorkingColorSpace(this,x),this}setHSL(a,s,v,x=ColorManagement.workingColorSpace){if(a=euclideanModulo(a,1),s=clamp(s,0,1),v=clamp(v,0,1),s===0)this.r=this.g=this.b=v;else{const M=v<=.5?v*(1+s):v+s-v*s,I=2*v-M;this.r=hue2rgb(I,M,a+1/3),this.g=hue2rgb(I,M,a),this.b=hue2rgb(I,M,a-1/3)}return ColorManagement.toWorkingColorSpace(this,x),this}setStyle(a,s=SRGBColorSpace){function v(M){M!==void 0&&parseFloat(M)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}let x;if(x=/^(\w+)\(([^\)]*)\)/.exec(a)){let M;const I=x[1],B=x[2];switch(I){case"rgb":case"rgba":if(M=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return v(M[4]),this.setRGB(Math.min(255,parseInt(M[1],10))/255,Math.min(255,parseInt(M[2],10))/255,Math.min(255,parseInt(M[3],10))/255,s);if(M=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return v(M[4]),this.setRGB(Math.min(100,parseInt(M[1],10))/100,Math.min(100,parseInt(M[2],10))/100,Math.min(100,parseInt(M[3],10))/100,s);break;case"hsl":case"hsla":if(M=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(B))return v(M[4]),this.setHSL(parseFloat(M[1])/360,parseFloat(M[2])/100,parseFloat(M[3])/100,s);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(x=/^\#([A-Fa-f\d]+)$/.exec(a)){const M=x[1],I=M.length;if(I===3)return this.setRGB(parseInt(M.charAt(0),16)/15,parseInt(M.charAt(1),16)/15,parseInt(M.charAt(2),16)/15,s);if(I===6)return this.setHex(parseInt(M,16),s);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,s);return this}setColorName(a,s=SRGBColorSpace){const v=_colorKeywords[a.toLowerCase()];return v!==void 0?this.setHex(v,s):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=SRGBToLinear(a.r),this.g=SRGBToLinear(a.g),this.b=SRGBToLinear(a.b),this}copyLinearToSRGB(a){return this.r=LinearToSRGB(a.r),this.g=LinearToSRGB(a.g),this.b=LinearToSRGB(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),a),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(a=SRGBColorSpace){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,s=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),s);const v=_color.r,x=_color.g,M=_color.b,I=Math.max(v,x,M),B=Math.min(v,x,M);let U,j;const te=(B+I)/2;if(B===I)U=0,j=0;else{const Z=I-B;switch(j=te<=.5?Z/(I+B):Z/(2-I-B),I){case v:U=(x-M)/Z+(x<M?6:0);break;case x:U=(M-v)/Z+2;break;case M:U=(v-x)/Z+4;break}U/=6}return a.h=U,a.s=j,a.l=te,a}getRGB(a,s=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),s),a.r=_color.r,a.g=_color.g,a.b=_color.b,a}getStyle(a=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),a);const s=_color.r,v=_color.g,x=_color.b;return a!==SRGBColorSpace?`color(${a} ${s.toFixed(3)} ${v.toFixed(3)} ${x.toFixed(3)})`:`rgb(${Math.round(s*255)},${Math.round(v*255)},${Math.round(x*255)})`}offsetHSL(a,s,v){return this.getHSL(_hslA),_hslA.h+=a,_hslA.s+=s,_hslA.l+=v,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,s){return this.r=a.r+s.r,this.g=a.g+s.g,this.b=a.b+s.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,s){return this.r+=(a.r-this.r)*s,this.g+=(a.g-this.g)*s,this.b+=(a.b-this.b)*s,this}lerpColors(a,s,v){return this.r=a.r+(s.r-a.r)*v,this.g=a.g+(s.g-a.g)*v,this.b=a.b+(s.b-a.b)*v,this}lerpHSL(a,s){this.getHSL(_hslA),a.getHSL(_hslB);const v=lerp(_hslA.h,_hslB.h,s),x=lerp(_hslA.s,_hslB.s,s),M=lerp(_hslA.l,_hslB.l,s);return this.setHSL(v,x,M),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){const s=this.r,v=this.g,x=this.b,M=a.elements;return this.r=M[0]*s+M[3]*v+M[6]*x,this.g=M[1]*s+M[4]*v+M[7]*x,this.b=M[2]*s+M[5]*v+M[8]*x,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,s=0){return this.r=a[s],this.g=a[s+1],this.b=a[s+2],this}toArray(a=[],s=0){return a[s]=this.r,a[s+1]=this.g,a[s+2]=this.b,a}fromBufferAttribute(a,s){return this.r=a.getX(s),this.g=a.getY(s),this.b=a.getZ(s),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;class MeshBasicMaterial extends Material{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}const _vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(a,s,v=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=s,this.count=a!==void 0?a.length/s:0,this.normalized=v,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(a){a===!0&&this.version++}setUsage(a){return this.usage=a,this}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,s,v){a*=this.itemSize,v*=s.itemSize;for(let x=0,M=this.itemSize;x<M;x++)this.array[a+x]=s.array[v+x];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(this.itemSize===2)for(let s=0,v=this.count;s<v;s++)_vector2$1.fromBufferAttribute(this,s),_vector2$1.applyMatrix3(a),this.setXY(s,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let s=0,v=this.count;s<v;s++)_vector$8.fromBufferAttribute(this,s),_vector$8.applyMatrix3(a),this.setXYZ(s,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(a){for(let s=0,v=this.count;s<v;s++)_vector$8.fromBufferAttribute(this,s),_vector$8.applyMatrix4(a),this.setXYZ(s,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(a){for(let s=0,v=this.count;s<v;s++)_vector$8.fromBufferAttribute(this,s),_vector$8.applyNormalMatrix(a),this.setXYZ(s,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(a){for(let s=0,v=this.count;s<v;s++)_vector$8.fromBufferAttribute(this,s),_vector$8.transformDirection(a),this.setXYZ(s,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(a,s=0){return this.array.set(a,s),this}getComponent(a,s){let v=this.array[a*this.itemSize+s];return this.normalized&&(v=denormalize(v,this.array)),v}setComponent(a,s,v){return this.normalized&&(v=normalize(v,this.array)),this.array[a*this.itemSize+s]=v,this}getX(a){let s=this.array[a*this.itemSize];return this.normalized&&(s=denormalize(s,this.array)),s}setX(a,s){return this.normalized&&(s=normalize(s,this.array)),this.array[a*this.itemSize]=s,this}getY(a){let s=this.array[a*this.itemSize+1];return this.normalized&&(s=denormalize(s,this.array)),s}setY(a,s){return this.normalized&&(s=normalize(s,this.array)),this.array[a*this.itemSize+1]=s,this}getZ(a){let s=this.array[a*this.itemSize+2];return this.normalized&&(s=denormalize(s,this.array)),s}setZ(a,s){return this.normalized&&(s=normalize(s,this.array)),this.array[a*this.itemSize+2]=s,this}getW(a){let s=this.array[a*this.itemSize+3];return this.normalized&&(s=denormalize(s,this.array)),s}setW(a,s){return this.normalized&&(s=normalize(s,this.array)),this.array[a*this.itemSize+3]=s,this}setXY(a,s,v){return a*=this.itemSize,this.normalized&&(s=normalize(s,this.array),v=normalize(v,this.array)),this.array[a+0]=s,this.array[a+1]=v,this}setXYZ(a,s,v,x){return a*=this.itemSize,this.normalized&&(s=normalize(s,this.array),v=normalize(v,this.array),x=normalize(x,this.array)),this.array[a+0]=s,this.array[a+1]=v,this.array[a+2]=x,this}setXYZW(a,s,v,x,M){return a*=this.itemSize,this.normalized&&(s=normalize(s,this.array),v=normalize(v,this.array),x=normalize(x,this.array),M=normalize(M,this.array)),this.array[a+0]=s,this.array[a+1]=v,this.array[a+2]=x,this.array[a+3]=M,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(a.name=this.name),this.usage!==StaticDrawUsage&&(a.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(a.updateRange=this.updateRange),a}}class Uint16BufferAttribute extends BufferAttribute{constructor(a,s,v){super(new Uint16Array(a),s,v)}}class Uint32BufferAttribute extends BufferAttribute{constructor(a,s,v){super(new Uint32Array(a),s,v)}}class Float32BufferAttribute extends BufferAttribute{constructor(a,s,v){super(new Float32Array(a),s,v)}}let _id$1=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;let BufferGeometry$1=class hI extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(arrayNeedsUint32(a)?Uint32BufferAttribute:Uint16BufferAttribute)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,s){return this.attributes[a]=s,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return this.attributes[a]!==void 0}addGroup(a,s,v=0){this.groups.push({start:a,count:s,materialIndex:v})}clearGroups(){this.groups=[]}setDrawRange(a,s){this.drawRange.start=a,this.drawRange.count=s}applyMatrix4(a){const s=this.attributes.position;s!==void 0&&(s.applyMatrix4(a),s.needsUpdate=!0);const v=this.attributes.normal;if(v!==void 0){const M=new Matrix3().getNormalMatrix(a);v.applyNormalMatrix(M),v.needsUpdate=!0}const x=this.attributes.tangent;return x!==void 0&&(x.transformDirection(a),x.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(a){return _m1.makeRotationFromQuaternion(a),this.applyMatrix4(_m1),this}rotateX(a){return _m1.makeRotationX(a),this.applyMatrix4(_m1),this}rotateY(a){return _m1.makeRotationY(a),this.applyMatrix4(_m1),this}rotateZ(a){return _m1.makeRotationZ(a),this.applyMatrix4(_m1),this}translate(a,s,v){return _m1.makeTranslation(a,s,v),this.applyMatrix4(_m1),this}scale(a,s,v){return _m1.makeScale(a,s,v),this.applyMatrix4(_m1),this}lookAt(a){return _obj.lookAt(a),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(a){const s=[];for(let v=0,x=a.length;v<x;v++){const M=a[v];s.push(M.x,M.y,M.z||0)}return this.setAttribute("position",new Float32BufferAttribute(s,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const a=this.attributes.position,s=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(a!==void 0){if(this.boundingBox.setFromBufferAttribute(a),s)for(let v=0,x=s.length;v<x;v++){const M=s[v];_box$1.setFromBufferAttribute(M),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const a=this.attributes.position,s=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(a){const v=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(a),s)for(let M=0,I=s.length;M<I;M++){const B=s[M];_boxMorphTargets.setFromBufferAttribute(B),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(v);let x=0;for(let M=0,I=a.count;M<I;M++)_vector$7.fromBufferAttribute(a,M),x=Math.max(x,v.distanceToSquared(_vector$7));if(s)for(let M=0,I=s.length;M<I;M++){const B=s[M],U=this.morphTargetsRelative;for(let j=0,te=B.count;j<te;j++)_vector$7.fromBufferAttribute(B,j),U&&(_offset.fromBufferAttribute(a,j),_vector$7.add(_offset)),x=Math.max(x,v.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(x),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const a=this.index,s=this.attributes;if(a===null||s.position===void 0||s.normal===void 0||s.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const v=a.array,x=s.position.array,M=s.normal.array,I=s.uv.array,B=x.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*B),4));const U=this.getAttribute("tangent").array,j=[],te=[];for(let Re=0;Re<B;Re++)j[Re]=new Vector3,te[Re]=new Vector3;const Z=new Vector3,oe=new Vector3,le=new Vector3,se=new Vector2,ve=new Vector2,ce=new Vector2,K=new Vector3,X=new Vector3;function W(Re,pe,he){Z.fromArray(x,Re*3),oe.fromArray(x,pe*3),le.fromArray(x,he*3),se.fromArray(I,Re*2),ve.fromArray(I,pe*2),ce.fromArray(I,he*2),oe.sub(Z),le.sub(Z),ve.sub(se),ce.sub(se);const we=1/(ve.x*ce.y-ce.x*ve.y);isFinite(we)&&(K.copy(oe).multiplyScalar(ce.y).addScaledVector(le,-ve.y).multiplyScalar(we),X.copy(le).multiplyScalar(ve.x).addScaledVector(oe,-ce.x).multiplyScalar(we),j[Re].add(K),j[pe].add(K),j[he].add(K),te[Re].add(X),te[pe].add(X),te[he].add(X))}let _e=this.groups;_e.length===0&&(_e=[{start:0,count:v.length}]);for(let Re=0,pe=_e.length;Re<pe;++Re){const he=_e[Re],we=he.start,Ce=he.count;for(let Ne=we,Ze=we+Ce;Ne<Ze;Ne+=3)W(v[Ne+0],v[Ne+1],v[Ne+2])}const ge=new Vector3,Ae=new Vector3,ee=new Vector3,$=new Vector3;function ae(Re){ee.fromArray(M,Re*3),$.copy(ee);const pe=j[Re];ge.copy(pe),ge.sub(ee.multiplyScalar(ee.dot(pe))).normalize(),Ae.crossVectors($,pe);const we=Ae.dot(te[Re])<0?-1:1;U[Re*4]=ge.x,U[Re*4+1]=ge.y,U[Re*4+2]=ge.z,U[Re*4+3]=we}for(let Re=0,pe=_e.length;Re<pe;++Re){const he=_e[Re],we=he.start,Ce=he.count;for(let Ne=we,Ze=we+Ce;Ne<Ze;Ne+=3)ae(v[Ne+0]),ae(v[Ne+1]),ae(v[Ne+2])}}computeVertexNormals(){const a=this.index,s=this.getAttribute("position");if(s!==void 0){let v=this.getAttribute("normal");if(v===void 0)v=new BufferAttribute(new Float32Array(s.count*3),3),this.setAttribute("normal",v);else for(let oe=0,le=v.count;oe<le;oe++)v.setXYZ(oe,0,0,0);const x=new Vector3,M=new Vector3,I=new Vector3,B=new Vector3,U=new Vector3,j=new Vector3,te=new Vector3,Z=new Vector3;if(a)for(let oe=0,le=a.count;oe<le;oe+=3){const se=a.getX(oe+0),ve=a.getX(oe+1),ce=a.getX(oe+2);x.fromBufferAttribute(s,se),M.fromBufferAttribute(s,ve),I.fromBufferAttribute(s,ce),te.subVectors(I,M),Z.subVectors(x,M),te.cross(Z),B.fromBufferAttribute(v,se),U.fromBufferAttribute(v,ve),j.fromBufferAttribute(v,ce),B.add(te),U.add(te),j.add(te),v.setXYZ(se,B.x,B.y,B.z),v.setXYZ(ve,U.x,U.y,U.z),v.setXYZ(ce,j.x,j.y,j.z)}else for(let oe=0,le=s.count;oe<le;oe+=3)x.fromBufferAttribute(s,oe+0),M.fromBufferAttribute(s,oe+1),I.fromBufferAttribute(s,oe+2),te.subVectors(I,M),Z.subVectors(x,M),te.cross(Z),v.setXYZ(oe+0,te.x,te.y,te.z),v.setXYZ(oe+1,te.x,te.y,te.z),v.setXYZ(oe+2,te.x,te.y,te.z);this.normalizeNormals(),v.needsUpdate=!0}}normalizeNormals(){const a=this.attributes.normal;for(let s=0,v=a.count;s<v;s++)_vector$7.fromBufferAttribute(a,s),_vector$7.normalize(),a.setXYZ(s,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function a(B,U){const j=B.array,te=B.itemSize,Z=B.normalized,oe=new j.constructor(U.length*te);let le=0,se=0;for(let ve=0,ce=U.length;ve<ce;ve++){B.isInterleavedBufferAttribute?le=U[ve]*B.data.stride+B.offset:le=U[ve]*te;for(let K=0;K<te;K++)oe[se++]=j[le++]}return new BufferAttribute(oe,te,Z)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const s=new hI,v=this.index.array,x=this.attributes;for(const B in x){const U=x[B],j=a(U,v);s.setAttribute(B,j)}const M=this.morphAttributes;for(const B in M){const U=[],j=M[B];for(let te=0,Z=j.length;te<Z;te++){const oe=j[te],le=a(oe,v);U.push(le)}s.morphAttributes[B]=U}s.morphTargetsRelative=this.morphTargetsRelative;const I=this.groups;for(let B=0,U=I.length;B<U;B++){const j=I[B];s.addGroup(j.start,j.count,j.materialIndex)}return s}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),this.parameters!==void 0){const U=this.parameters;for(const j in U)U[j]!==void 0&&(a[j]=U[j]);return a}a.data={attributes:{}};const s=this.index;s!==null&&(a.data.index={type:s.array.constructor.name,array:Array.prototype.slice.call(s.array)});const v=this.attributes;for(const U in v){const j=v[U];a.data.attributes[U]=j.toJSON(a.data)}const x={};let M=!1;for(const U in this.morphAttributes){const j=this.morphAttributes[U],te=[];for(let Z=0,oe=j.length;Z<oe;Z++){const le=j[Z];te.push(le.toJSON(a.data))}te.length>0&&(x[U]=te,M=!0)}M&&(a.data.morphAttributes=x,a.data.morphTargetsRelative=this.morphTargetsRelative);const I=this.groups;I.length>0&&(a.data.groups=JSON.parse(JSON.stringify(I)));const B=this.boundingSphere;return B!==null&&(a.data.boundingSphere={center:B.center.toArray(),radius:B.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const s={};this.name=a.name;const v=a.index;v!==null&&this.setIndex(v.clone(s));const x=a.attributes;for(const j in x){const te=x[j];this.setAttribute(j,te.clone(s))}const M=a.morphAttributes;for(const j in M){const te=[],Z=M[j];for(let oe=0,le=Z.length;oe<le;oe++)te.push(Z[oe].clone(s));this.morphAttributes[j]=te}this.morphTargetsRelative=a.morphTargetsRelative;const I=a.groups;for(let j=0,te=I.length;j<te;j++){const Z=I[j];this.addGroup(Z.start,Z.count,Z.materialIndex)}const B=a.boundingBox;B!==null&&(this.boundingBox=B.clone());const U=a.boundingSphere;return U!==null&&(this.boundingSphere=U.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(a=new BufferGeometry$1,s=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=s,this.updateMorphTargets()}copy(a,s){return super.copy(a,s),a.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),a.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=a.material,this.geometry=a.geometry,this}updateMorphTargets(){const s=this.geometry.morphAttributes,v=Object.keys(s);if(v.length>0){const x=s[v[0]];if(x!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let M=0,I=x.length;M<I;M++){const B=x[M].name||String(M);this.morphTargetInfluences.push(0),this.morphTargetDictionary[B]=M}}}}getVertexPosition(a,s){const v=this.geometry,x=v.attributes.position,M=v.morphAttributes.position,I=v.morphTargetsRelative;s.fromBufferAttribute(x,a);const B=this.morphTargetInfluences;if(M&&B){_morphA.set(0,0,0);for(let U=0,j=M.length;U<j;U++){const te=B[U],Z=M[U];te!==0&&(_tempA.fromBufferAttribute(Z,a),I?_morphA.addScaledVector(_tempA,te):_morphA.addScaledVector(_tempA.sub(s),te))}s.add(_morphA)}return s}raycast(a,s){const v=this.geometry,x=this.material,M=this.matrixWorld;x!==void 0&&(v.boundingSphere===null&&v.computeBoundingSphere(),_sphere$5.copy(v.boundingSphere),_sphere$5.applyMatrix4(M),_ray$3.copy(a.ray).recast(a.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(a.far-a.near)**2))&&(_inverseMatrix$3.copy(M).invert(),_ray$3.copy(a.ray).applyMatrix4(_inverseMatrix$3),!(v.boundingBox!==null&&_ray$3.intersectsBox(v.boundingBox)===!1)&&this._computeIntersections(a,s,_ray$3)))}_computeIntersections(a,s,v){let x;const M=this.geometry,I=this.material,B=M.index,U=M.attributes.position,j=M.attributes.uv,te=M.attributes.uv1,Z=M.attributes.normal,oe=M.groups,le=M.drawRange;if(B!==null)if(Array.isArray(I))for(let se=0,ve=oe.length;se<ve;se++){const ce=oe[se],K=I[ce.materialIndex],X=Math.max(ce.start,le.start),W=Math.min(B.count,Math.min(ce.start+ce.count,le.start+le.count));for(let _e=X,ge=W;_e<ge;_e+=3){const Ae=B.getX(_e),ee=B.getX(_e+1),$=B.getX(_e+2);x=checkGeometryIntersection(this,K,a,v,j,te,Z,Ae,ee,$),x&&(x.faceIndex=Math.floor(_e/3),x.face.materialIndex=ce.materialIndex,s.push(x))}}else{const se=Math.max(0,le.start),ve=Math.min(B.count,le.start+le.count);for(let ce=se,K=ve;ce<K;ce+=3){const X=B.getX(ce),W=B.getX(ce+1),_e=B.getX(ce+2);x=checkGeometryIntersection(this,I,a,v,j,te,Z,X,W,_e),x&&(x.faceIndex=Math.floor(ce/3),s.push(x))}}else if(U!==void 0)if(Array.isArray(I))for(let se=0,ve=oe.length;se<ve;se++){const ce=oe[se],K=I[ce.materialIndex],X=Math.max(ce.start,le.start),W=Math.min(U.count,Math.min(ce.start+ce.count,le.start+le.count));for(let _e=X,ge=W;_e<ge;_e+=3){const Ae=_e,ee=_e+1,$=_e+2;x=checkGeometryIntersection(this,K,a,v,j,te,Z,Ae,ee,$),x&&(x.faceIndex=Math.floor(_e/3),x.face.materialIndex=ce.materialIndex,s.push(x))}}else{const se=Math.max(0,le.start),ve=Math.min(U.count,le.start+le.count);for(let ce=se,K=ve;ce<K;ce+=3){const X=ce,W=ce+1,_e=ce+2;x=checkGeometryIntersection(this,I,a,v,j,te,Z,X,W,_e),x&&(x.faceIndex=Math.floor(ce/3),s.push(x))}}}}function checkIntersection(u,a,s,v,x,M,I,B){let U;if(a.side===BackSide?U=v.intersectTriangle(I,M,x,!0,B):U=v.intersectTriangle(x,M,I,a.side===FrontSide,B),U===null)return null;_intersectionPointWorld.copy(B),_intersectionPointWorld.applyMatrix4(u.matrixWorld);const j=s.ray.origin.distanceTo(_intersectionPointWorld);return j<s.near||j>s.far?null:{distance:j,point:_intersectionPointWorld.clone(),object:u}}function checkGeometryIntersection(u,a,s,v,x,M,I,B,U,j){u.getVertexPosition(B,_vA$1),u.getVertexPosition(U,_vB$1),u.getVertexPosition(j,_vC$1);const te=checkIntersection(u,a,s,v,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(te){x&&(_uvA$1.fromBufferAttribute(x,B),_uvB$1.fromBufferAttribute(x,U),_uvC$1.fromBufferAttribute(x,j),te.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),M&&(_uvA$1.fromBufferAttribute(M,B),_uvB$1.fromBufferAttribute(M,U),_uvC$1.fromBufferAttribute(M,j),te.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),te.uv2=te.uv1),I&&(_normalA.fromBufferAttribute(I,B),_normalB.fromBufferAttribute(I,U),_normalC.fromBufferAttribute(I,j),te.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),te.normal.dot(v.direction)>0&&te.normal.multiplyScalar(-1));const Z={a:B,b:U,c:j,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,Z.normal),te.face=Z}return te}class BoxGeometry extends BufferGeometry$1{constructor(a=1,s=1,v=1,x=1,M=1,I=1){super(),this.type="BoxGeometry",this.parameters={width:a,height:s,depth:v,widthSegments:x,heightSegments:M,depthSegments:I};const B=this;x=Math.floor(x),M=Math.floor(M),I=Math.floor(I);const U=[],j=[],te=[],Z=[];let oe=0,le=0;se("z","y","x",-1,-1,v,s,a,I,M,0),se("z","y","x",1,-1,v,s,-a,I,M,1),se("x","z","y",1,1,a,v,s,x,I,2),se("x","z","y",1,-1,a,v,-s,x,I,3),se("x","y","z",1,-1,a,s,v,x,M,4),se("x","y","z",-1,-1,a,s,-v,x,M,5),this.setIndex(U),this.setAttribute("position",new Float32BufferAttribute(j,3)),this.setAttribute("normal",new Float32BufferAttribute(te,3)),this.setAttribute("uv",new Float32BufferAttribute(Z,2));function se(ve,ce,K,X,W,_e,ge,Ae,ee,$,ae){const Re=_e/ee,pe=ge/$,he=_e/2,we=ge/2,Ce=Ae/2,Ne=ee+1,Ze=$+1;let Ye=0,it=0;const _t=new Vector3;for(let At=0;At<Ze;At++){const vt=At*pe-we;for(let ut=0;ut<Ne;ut++){const Nt=ut*Re-he;_t[ve]=Nt*X,_t[ce]=vt*W,_t[K]=Ce,j.push(_t.x,_t.y,_t.z),_t[ve]=0,_t[ce]=0,_t[K]=Ae>0?1:-1,te.push(_t.x,_t.y,_t.z),Z.push(ut/ee),Z.push(1-At/$),Ye+=1}}for(let At=0;At<$;At++)for(let vt=0;vt<ee;vt++){const ut=oe+vt+Ne*At,Nt=oe+vt+Ne*(At+1),Qt=oe+(vt+1)+Ne*(At+1),Qe=oe+(vt+1)+Ne*At;U.push(ut,Nt,Qe),U.push(Nt,Qt,Qe),it+=6}B.addGroup(le,it,ae),le+=it,oe+=Ye}}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}function cloneUniforms(u){const a={};for(const s in u){a[s]={};for(const v in u[s]){const x=u[s][v];x&&(x.isColor||x.isMatrix3||x.isMatrix4||x.isVector2||x.isVector3||x.isVector4||x.isTexture||x.isQuaternion)?x.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),a[s][v]=null):a[s][v]=x.clone():Array.isArray(x)?a[s][v]=x.slice():a[s][v]=x}}return a}function mergeUniforms(u){const a={};for(let s=0;s<u.length;s++){const v=cloneUniforms(u[s]);for(const x in v)a[x]=v[x]}return a}function cloneUniformsGroups(u){const a=[];for(let s=0;s<u.length;s++)a.push(u[s].clone());return a}function getUnlitUniformColorSpace(u){return u.getRenderTarget()===null?u.outputColorSpace:LinearSRGBColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(a){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,a!==void 0&&this.setValues(a)}copy(a){return super.copy(a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=cloneUniforms(a.uniforms),this.uniformsGroups=cloneUniformsGroups(a.uniformsGroups),this.defines=Object.assign({},a.defines),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.clipping=a.clipping,this.extensions=Object.assign({},a.extensions),this.glslVersion=a.glslVersion,this}toJSON(a){const s=super.toJSON(a);s.glslVersion=this.glslVersion,s.uniforms={};for(const x in this.uniforms){const I=this.uniforms[x].value;I&&I.isTexture?s.uniforms[x]={type:"t",value:I.toJSON(a).uuid}:I&&I.isColor?s.uniforms[x]={type:"c",value:I.getHex()}:I&&I.isVector2?s.uniforms[x]={type:"v2",value:I.toArray()}:I&&I.isVector3?s.uniforms[x]={type:"v3",value:I.toArray()}:I&&I.isVector4?s.uniforms[x]={type:"v4",value:I.toArray()}:I&&I.isMatrix3?s.uniforms[x]={type:"m3",value:I.toArray()}:I&&I.isMatrix4?s.uniforms[x]={type:"m4",value:I.toArray()}:s.uniforms[x]={value:I}}Object.keys(this.defines).length>0&&(s.defines=this.defines),s.vertexShader=this.vertexShader,s.fragmentShader=this.fragmentShader,s.lights=this.lights,s.clipping=this.clipping;const v={};for(const x in this.extensions)this.extensions[x]===!0&&(v[x]=!0);return Object.keys(v).length>0&&(s.extensions=v),s}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(a,s){return super.copy(a,s),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const s=this.matrixWorld.elements;return a.set(-s[8],-s[9],-s[10]).normalize()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,s){super.updateWorldMatrix(a,s),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class PerspectiveCamera extends Camera{constructor(a=50,s=1,v=.1,x=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=v,this.far=x,this.focus=10,this.aspect=s,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,s){return super.copy(a,s),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=a.view===null?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){const s=.5*this.getFilmHeight()/a;this.fov=RAD2DEG*2*Math.atan(s),this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(a,s,v,x,M,I){this.aspect=a/s,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=s,this.view.offsetX=v,this.view.offsetY=x,this.view.width=M,this.view.height=I,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let s=a*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,v=2*s,x=this.aspect*v,M=-.5*x;const I=this.view;if(this.view!==null&&this.view.enabled){const U=I.fullWidth,j=I.fullHeight;M+=I.offsetX*x/U,s-=I.offsetY*v/j,x*=I.width/U,v*=I.height/j}const B=this.filmOffset;B!==0&&(M+=a*B/this.getFilmWidth()),this.projectionMatrix.makePerspective(M,M+x,s,s-v,a,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const s=super.toJSON(a);return s.object.fov=this.fov,s.object.zoom=this.zoom,s.object.near=this.near,s.object.far=this.far,s.object.focus=this.focus,s.object.aspect=this.aspect,this.view!==null&&(s.object.view=Object.assign({},this.view)),s.object.filmGauge=this.filmGauge,s.object.filmOffset=this.filmOffset,s}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(a,s,v){super(),this.type="CubeCamera",this.renderTarget=v,this.coordinateSystem=null;const x=new PerspectiveCamera(fov,aspect,a,s);x.layers=this.layers,this.add(x);const M=new PerspectiveCamera(fov,aspect,a,s);M.layers=this.layers,this.add(M);const I=new PerspectiveCamera(fov,aspect,a,s);I.layers=this.layers,this.add(I);const B=new PerspectiveCamera(fov,aspect,a,s);B.layers=this.layers,this.add(B);const U=new PerspectiveCamera(fov,aspect,a,s);U.layers=this.layers,this.add(U);const j=new PerspectiveCamera(fov,aspect,a,s);j.layers=this.layers,this.add(j)}updateCoordinateSystem(){const a=this.coordinateSystem,s=this.children.concat(),[v,x,M,I,B,U]=s;for(const j of s)this.remove(j);if(a===WebGLCoordinateSystem)v.up.set(0,1,0),v.lookAt(1,0,0),x.up.set(0,1,0),x.lookAt(-1,0,0),M.up.set(0,0,-1),M.lookAt(0,1,0),I.up.set(0,0,1),I.lookAt(0,-1,0),B.up.set(0,1,0),B.lookAt(0,0,1),U.up.set(0,1,0),U.lookAt(0,0,-1);else if(a===WebGPUCoordinateSystem)v.up.set(0,-1,0),v.lookAt(-1,0,0),x.up.set(0,-1,0),x.lookAt(1,0,0),M.up.set(0,0,1),M.lookAt(0,1,0),I.up.set(0,0,-1),I.lookAt(0,-1,0),B.up.set(0,-1,0),B.lookAt(0,0,1),U.up.set(0,-1,0),U.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(const j of s)this.add(j),j.updateMatrixWorld()}update(a,s){this.parent===null&&this.updateMatrixWorld();const v=this.renderTarget;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());const[x,M,I,B,U,j]=this.children,te=a.getRenderTarget(),Z=a.xr.enabled;a.xr.enabled=!1;const oe=v.texture.generateMipmaps;v.texture.generateMipmaps=!1,a.setRenderTarget(v,0),a.render(s,x),a.setRenderTarget(v,1),a.render(s,M),a.setRenderTarget(v,2),a.render(s,I),a.setRenderTarget(v,3),a.render(s,B),a.setRenderTarget(v,4),a.render(s,U),v.texture.generateMipmaps=oe,a.setRenderTarget(v,5),a.render(s,j),a.setRenderTarget(te),a.xr.enabled=Z,v.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(a,s,v,x,M,I,B,U,j,te){a=a!==void 0?a:[],s=s!==void 0?s:CubeReflectionMapping,super(a,s,v,x,M,I,B,U,j,te),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(a=1,s={}){super(a,a,s),this.isWebGLCubeRenderTarget=!0;const v={width:a,height:a,depth:1},x=[v,v,v,v,v,v];s.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),s.colorSpace=s.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(x,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:LinearFilter}fromEquirectangularTexture(a,s){this.texture.type=s.type,this.texture.colorSpace=s.colorSpace,this.texture.generateMipmaps=s.generateMipmaps,this.texture.minFilter=s.minFilter,this.texture.magFilter=s.magFilter;const v={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},x=new BoxGeometry(5,5,5),M=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(v.uniforms),vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,side:BackSide,blending:NoBlending});M.uniforms.tEquirect.value=s;const I=new Mesh(x,M),B=s.minFilter;return s.minFilter===LinearMipmapLinearFilter&&(s.minFilter=LinearFilter),new CubeCamera(1,10,this).update(a,I),s.minFilter=B,I.geometry.dispose(),I.material.dispose(),this}clear(a,s,v,x){const M=a.getRenderTarget();for(let I=0;I<6;I++)a.setRenderTarget(this,I),a.clear(s,v,x);a.setRenderTarget(M)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(a=new Vector3(1,0,0),s=0){this.isPlane=!0,this.normal=a,this.constant=s}set(a,s){return this.normal.copy(a),this.constant=s,this}setComponents(a,s,v,x){return this.normal.set(a,s,v),this.constant=x,this}setFromNormalAndCoplanarPoint(a,s){return this.normal.copy(a),this.constant=-s.dot(this.normal),this}setFromCoplanarPoints(a,s,v){const x=_vector1.subVectors(v,s).cross(_vector2.subVectors(a,s)).normalize();return this.setFromNormalAndCoplanarPoint(x,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){const a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,s){return s.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,s){const v=a.delta(_vector1),x=this.normal.dot(v);if(x===0)return this.distanceToPoint(a.start)===0?s.copy(a.start):null;const M=-(a.start.dot(this.normal)+this.constant)/x;return M<0||M>1?null:s.copy(a.start).addScaledVector(v,M)}intersectsLine(a){const s=this.distanceToPoint(a.start),v=this.distanceToPoint(a.end);return s<0&&v>0||v<0&&s>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,s){const v=s||_normalMatrix.getNormalMatrix(a),x=this.coplanarPoint(_vector1).applyMatrix4(a),M=this.normal.applyMatrix3(v).normalize();return this.constant=-x.dot(M),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(a=new Plane,s=new Plane,v=new Plane,x=new Plane,M=new Plane,I=new Plane){this.planes=[a,s,v,x,M,I]}set(a,s,v,x,M,I){const B=this.planes;return B[0].copy(a),B[1].copy(s),B[2].copy(v),B[3].copy(x),B[4].copy(M),B[5].copy(I),this}copy(a){const s=this.planes;for(let v=0;v<6;v++)s[v].copy(a.planes[v]);return this}setFromProjectionMatrix(a,s=WebGLCoordinateSystem){const v=this.planes,x=a.elements,M=x[0],I=x[1],B=x[2],U=x[3],j=x[4],te=x[5],Z=x[6],oe=x[7],le=x[8],se=x[9],ve=x[10],ce=x[11],K=x[12],X=x[13],W=x[14],_e=x[15];if(v[0].setComponents(U-M,oe-j,ce-le,_e-K).normalize(),v[1].setComponents(U+M,oe+j,ce+le,_e+K).normalize(),v[2].setComponents(U+I,oe+te,ce+se,_e+X).normalize(),v[3].setComponents(U-I,oe-te,ce-se,_e-X).normalize(),v[4].setComponents(U-B,oe-Z,ce-ve,_e-W).normalize(),s===WebGLCoordinateSystem)v[5].setComponents(U+B,oe+Z,ce+ve,_e+W).normalize();else if(s===WebGPUCoordinateSystem)v[5].setComponents(B,Z,ve,W).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+s);return this}intersectsObject(a){if(a.boundingSphere!==void 0)a.boundingSphere===null&&a.computeBoundingSphere(),_sphere$4.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const s=a.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),_sphere$4.copy(s.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(a){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(a.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(a){const s=this.planes,v=a.center,x=-a.radius;for(let M=0;M<6;M++)if(s[M].distanceToPoint(v)<x)return!1;return!0}intersectsBox(a){const s=this.planes;for(let v=0;v<6;v++){const x=s[v];if(_vector$6.x=x.normal.x>0?a.max.x:a.min.x,_vector$6.y=x.normal.y>0?a.max.y:a.min.y,_vector$6.z=x.normal.z>0?a.max.z:a.min.z,x.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(a){const s=this.planes;for(let v=0;v<6;v++)if(s[v].distanceToPoint(a)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let u=null,a=!1,s=null,v=null;function x(M,I){s(M,I),v=u.requestAnimationFrame(x)}return{start:function(){a!==!0&&s!==null&&(v=u.requestAnimationFrame(x),a=!0)},stop:function(){u.cancelAnimationFrame(v),a=!1},setAnimationLoop:function(M){s=M},setContext:function(M){u=M}}}function WebGLAttributes(u,a){const s=a.isWebGL2,v=new WeakMap;function x(j,te){const Z=j.array,oe=j.usage,le=u.createBuffer();u.bindBuffer(te,le),u.bufferData(te,Z,oe),j.onUploadCallback();let se;if(Z instanceof Float32Array)se=u.FLOAT;else if(Z instanceof Uint16Array)if(j.isFloat16BufferAttribute)if(s)se=u.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else se=u.UNSIGNED_SHORT;else if(Z instanceof Int16Array)se=u.SHORT;else if(Z instanceof Uint32Array)se=u.UNSIGNED_INT;else if(Z instanceof Int32Array)se=u.INT;else if(Z instanceof Int8Array)se=u.BYTE;else if(Z instanceof Uint8Array)se=u.UNSIGNED_BYTE;else if(Z instanceof Uint8ClampedArray)se=u.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Z);return{buffer:le,type:se,bytesPerElement:Z.BYTES_PER_ELEMENT,version:j.version}}function M(j,te,Z){const oe=te.array,le=te.updateRange;u.bindBuffer(Z,j),le.count===-1?u.bufferSubData(Z,0,oe):(s?u.bufferSubData(Z,le.offset*oe.BYTES_PER_ELEMENT,oe,le.offset,le.count):u.bufferSubData(Z,le.offset*oe.BYTES_PER_ELEMENT,oe.subarray(le.offset,le.offset+le.count)),le.count=-1),te.onUploadCallback()}function I(j){return j.isInterleavedBufferAttribute&&(j=j.data),v.get(j)}function B(j){j.isInterleavedBufferAttribute&&(j=j.data);const te=v.get(j);te&&(u.deleteBuffer(te.buffer),v.delete(j))}function U(j,te){if(j.isGLBufferAttribute){const oe=v.get(j);(!oe||oe.version<j.version)&&v.set(j,{buffer:j.buffer,type:j.type,bytesPerElement:j.elementSize,version:j.version});return}j.isInterleavedBufferAttribute&&(j=j.data);const Z=v.get(j);Z===void 0?v.set(j,x(j,te)):Z.version<j.version&&(M(Z.buffer,j,te),Z.version=j.version)}return{get:I,remove:B,update:U}}class PlaneGeometry extends BufferGeometry$1{constructor(a=1,s=1,v=1,x=1){super(),this.type="PlaneGeometry",this.parameters={width:a,height:s,widthSegments:v,heightSegments:x};const M=a/2,I=s/2,B=Math.floor(v),U=Math.floor(x),j=B+1,te=U+1,Z=a/B,oe=s/U,le=[],se=[],ve=[],ce=[];for(let K=0;K<te;K++){const X=K*oe-I;for(let W=0;W<j;W++){const _e=W*Z-M;se.push(_e,-X,0),ve.push(0,0,1),ce.push(W/B),ce.push(1-K/U)}}for(let K=0;K<U;K++)for(let X=0;X<B;X++){const W=X+j*K,_e=X+j*(K+1),ge=X+1+j*(K+1),Ae=X+1+j*K;le.push(W,_e,Ae),le.push(_e,ge,Ae)}this.setIndex(le),this.setAttribute("position",new Float32BufferAttribute(se,3)),this.setAttribute("normal",new Float32BufferAttribute(ve,3)),this.setAttribute("uv",new Float32BufferAttribute(ce,2))}copy(a){return super.copy(a),this.parameters=Object.assign({},a.parameters),this}static fromJSON(a){return new PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(u,a,s,v,x,M,I){const B=new Color(0);let U=M===!0?0:1,j,te,Z=null,oe=0,le=null;function se(ce,K){let X=!1,W=K.isScene===!0?K.background:null;switch(W&&W.isTexture&&(W=(K.backgroundBlurriness>0?s:a).get(W)),W===null?ve(B,U):W&&W.isColor&&(ve(W,1),X=!0),u.xr.getEnvironmentBlendMode()){case"opaque":X=!0;break;case"additive":v.buffers.color.setClear(0,0,0,1,I),X=!0;break;case"alpha-blend":v.buffers.color.setClear(0,0,0,0,I),X=!0;break}(u.autoClear||X)&&u.clear(u.autoClearColor,u.autoClearDepth,u.autoClearStencil),W&&(W.isCubeTexture||W.mapping===CubeUVReflectionMapping)?(te===void 0&&(te=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),te.geometry.deleteAttribute("normal"),te.geometry.deleteAttribute("uv"),te.onBeforeRender=function(Ae,ee,$){this.matrixWorld.copyPosition($.matrixWorld)},Object.defineProperty(te.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),x.update(te)),te.material.uniforms.envMap.value=W,te.material.uniforms.flipEnvMap.value=W.isCubeTexture&&W.isRenderTargetTexture===!1?-1:1,te.material.uniforms.backgroundBlurriness.value=K.backgroundBlurriness,te.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,te.material.toneMapped=W.colorSpace!==SRGBColorSpace,(Z!==W||oe!==W.version||le!==u.toneMapping)&&(te.material.needsUpdate=!0,Z=W,oe=W.version,le=u.toneMapping),te.layers.enableAll(),ce.unshift(te,te.geometry,te.material,0,0,null)):W&&W.isTexture&&(j===void 0&&(j=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),j.geometry.deleteAttribute("normal"),Object.defineProperty(j.material,"map",{get:function(){return this.uniforms.t2D.value}}),x.update(j)),j.material.uniforms.t2D.value=W,j.material.uniforms.backgroundIntensity.value=K.backgroundIntensity,j.material.toneMapped=W.colorSpace!==SRGBColorSpace,W.matrixAutoUpdate===!0&&W.updateMatrix(),j.material.uniforms.uvTransform.value.copy(W.matrix),(Z!==W||oe!==W.version||le!==u.toneMapping)&&(j.material.needsUpdate=!0,Z=W,oe=W.version,le=u.toneMapping),j.layers.enableAll(),ce.unshift(j,j.geometry,j.material,0,0,null))}function ve(ce,K){ce.getRGB(_rgb,getUnlitUniformColorSpace(u)),v.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,K,I)}return{getClearColor:function(){return B},setClearColor:function(ce,K=1){B.set(ce),U=K,ve(B,U)},getClearAlpha:function(){return U},setClearAlpha:function(ce){U=ce,ve(B,U)},render:se}}function WebGLBindingStates(u,a,s,v){const x=u.getParameter(u.MAX_VERTEX_ATTRIBS),M=v.isWebGL2?null:a.get("OES_vertex_array_object"),I=v.isWebGL2||M!==null,B={},U=ce(null);let j=U,te=!1;function Z(Ce,Ne,Ze,Ye,it){let _t=!1;if(I){const At=ve(Ye,Ze,Ne);j!==At&&(j=At,le(j.object)),_t=K(Ce,Ye,Ze,it),_t&&X(Ce,Ye,Ze,it)}else{const At=Ne.wireframe===!0;(j.geometry!==Ye.id||j.program!==Ze.id||j.wireframe!==At)&&(j.geometry=Ye.id,j.program=Ze.id,j.wireframe=At,_t=!0)}it!==null&&s.update(it,u.ELEMENT_ARRAY_BUFFER),(_t||te)&&(te=!1,$(Ce,Ne,Ze,Ye),it!==null&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s.get(it).buffer))}function oe(){return v.isWebGL2?u.createVertexArray():M.createVertexArrayOES()}function le(Ce){return v.isWebGL2?u.bindVertexArray(Ce):M.bindVertexArrayOES(Ce)}function se(Ce){return v.isWebGL2?u.deleteVertexArray(Ce):M.deleteVertexArrayOES(Ce)}function ve(Ce,Ne,Ze){const Ye=Ze.wireframe===!0;let it=B[Ce.id];it===void 0&&(it={},B[Ce.id]=it);let _t=it[Ne.id];_t===void 0&&(_t={},it[Ne.id]=_t);let At=_t[Ye];return At===void 0&&(At=ce(oe()),_t[Ye]=At),At}function ce(Ce){const Ne=[],Ze=[],Ye=[];for(let it=0;it<x;it++)Ne[it]=0,Ze[it]=0,Ye[it]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ne,enabledAttributes:Ze,attributeDivisors:Ye,object:Ce,attributes:{},index:null}}function K(Ce,Ne,Ze,Ye){const it=j.attributes,_t=Ne.attributes;let At=0;const vt=Ze.getAttributes();for(const ut in vt)if(vt[ut].location>=0){const Qt=it[ut];let Qe=_t[ut];if(Qe===void 0&&(ut==="instanceMatrix"&&Ce.instanceMatrix&&(Qe=Ce.instanceMatrix),ut==="instanceColor"&&Ce.instanceColor&&(Qe=Ce.instanceColor)),Qt===void 0||Qt.attribute!==Qe||Qe&&Qt.data!==Qe.data)return!0;At++}return j.attributesNum!==At||j.index!==Ye}function X(Ce,Ne,Ze,Ye){const it={},_t=Ne.attributes;let At=0;const vt=Ze.getAttributes();for(const ut in vt)if(vt[ut].location>=0){let Qt=_t[ut];Qt===void 0&&(ut==="instanceMatrix"&&Ce.instanceMatrix&&(Qt=Ce.instanceMatrix),ut==="instanceColor"&&Ce.instanceColor&&(Qt=Ce.instanceColor));const Qe={};Qe.attribute=Qt,Qt&&Qt.data&&(Qe.data=Qt.data),it[ut]=Qe,At++}j.attributes=it,j.attributesNum=At,j.index=Ye}function W(){const Ce=j.newAttributes;for(let Ne=0,Ze=Ce.length;Ne<Ze;Ne++)Ce[Ne]=0}function _e(Ce){ge(Ce,0)}function ge(Ce,Ne){const Ze=j.newAttributes,Ye=j.enabledAttributes,it=j.attributeDivisors;Ze[Ce]=1,Ye[Ce]===0&&(u.enableVertexAttribArray(Ce),Ye[Ce]=1),it[Ce]!==Ne&&((v.isWebGL2?u:a.get("ANGLE_instanced_arrays"))[v.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ce,Ne),it[Ce]=Ne)}function Ae(){const Ce=j.newAttributes,Ne=j.enabledAttributes;for(let Ze=0,Ye=Ne.length;Ze<Ye;Ze++)Ne[Ze]!==Ce[Ze]&&(u.disableVertexAttribArray(Ze),Ne[Ze]=0)}function ee(Ce,Ne,Ze,Ye,it,_t,At){At===!0?u.vertexAttribIPointer(Ce,Ne,Ze,it,_t):u.vertexAttribPointer(Ce,Ne,Ze,Ye,it,_t)}function $(Ce,Ne,Ze,Ye){if(v.isWebGL2===!1&&(Ce.isInstancedMesh||Ye.isInstancedBufferGeometry)&&a.get("ANGLE_instanced_arrays")===null)return;W();const it=Ye.attributes,_t=Ze.getAttributes(),At=Ne.defaultAttributeValues;for(const vt in _t){const ut=_t[vt];if(ut.location>=0){let Nt=it[vt];if(Nt===void 0&&(vt==="instanceMatrix"&&Ce.instanceMatrix&&(Nt=Ce.instanceMatrix),vt==="instanceColor"&&Ce.instanceColor&&(Nt=Ce.instanceColor)),Nt!==void 0){const Qt=Nt.normalized,Qe=Nt.itemSize,ft=s.get(Nt);if(ft===void 0)continue;const bt=ft.buffer,sn=ft.type,bn=ft.bytesPerElement,Un=v.isWebGL2===!0&&(sn===u.INT||sn===u.UNSIGNED_INT||Nt.gpuType===IntType);if(Nt.isInterleavedBufferAttribute){const pi=Nt.data,Xe=pi.stride,Xt=Nt.offset;if(pi.isInstancedInterleavedBuffer){for(let tn=0;tn<ut.locationSize;tn++)ge(ut.location+tn,pi.meshPerAttribute);Ce.isInstancedMesh!==!0&&Ye._maxInstanceCount===void 0&&(Ye._maxInstanceCount=pi.meshPerAttribute*pi.count)}else for(let tn=0;tn<ut.locationSize;tn++)_e(ut.location+tn);u.bindBuffer(u.ARRAY_BUFFER,bt);for(let tn=0;tn<ut.locationSize;tn++)ee(ut.location+tn,Qe/ut.locationSize,sn,Qt,Xe*bn,(Xt+Qe/ut.locationSize*tn)*bn,Un)}else{if(Nt.isInstancedBufferAttribute){for(let pi=0;pi<ut.locationSize;pi++)ge(ut.location+pi,Nt.meshPerAttribute);Ce.isInstancedMesh!==!0&&Ye._maxInstanceCount===void 0&&(Ye._maxInstanceCount=Nt.meshPerAttribute*Nt.count)}else for(let pi=0;pi<ut.locationSize;pi++)_e(ut.location+pi);u.bindBuffer(u.ARRAY_BUFFER,bt);for(let pi=0;pi<ut.locationSize;pi++)ee(ut.location+pi,Qe/ut.locationSize,sn,Qt,Qe*bn,Qe/ut.locationSize*pi*bn,Un)}}else if(At!==void 0){const Qt=At[vt];if(Qt!==void 0)switch(Qt.length){case 2:u.vertexAttrib2fv(ut.location,Qt);break;case 3:u.vertexAttrib3fv(ut.location,Qt);break;case 4:u.vertexAttrib4fv(ut.location,Qt);break;default:u.vertexAttrib1fv(ut.location,Qt)}}}}Ae()}function ae(){he();for(const Ce in B){const Ne=B[Ce];for(const Ze in Ne){const Ye=Ne[Ze];for(const it in Ye)se(Ye[it].object),delete Ye[it];delete Ne[Ze]}delete B[Ce]}}function Re(Ce){if(B[Ce.id]===void 0)return;const Ne=B[Ce.id];for(const Ze in Ne){const Ye=Ne[Ze];for(const it in Ye)se(Ye[it].object),delete Ye[it];delete Ne[Ze]}delete B[Ce.id]}function pe(Ce){for(const Ne in B){const Ze=B[Ne];if(Ze[Ce.id]===void 0)continue;const Ye=Ze[Ce.id];for(const it in Ye)se(Ye[it].object),delete Ye[it];delete Ze[Ce.id]}}function he(){we(),te=!0,j!==U&&(j=U,le(j.object))}function we(){U.geometry=null,U.program=null,U.wireframe=!1}return{setup:Z,reset:he,resetDefaultState:we,dispose:ae,releaseStatesOfGeometry:Re,releaseStatesOfProgram:pe,initAttributes:W,enableAttribute:_e,disableUnusedAttributes:Ae}}function WebGLBufferRenderer(u,a,s,v){const x=v.isWebGL2;let M;function I(j){M=j}function B(j,te){u.drawArrays(M,j,te),s.update(te,M,1)}function U(j,te,Z){if(Z===0)return;let oe,le;if(x)oe=u,le="drawArraysInstanced";else if(oe=a.get("ANGLE_instanced_arrays"),le="drawArraysInstancedANGLE",oe===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}oe[le](M,j,te,Z),s.update(te,M,Z)}this.setMode=I,this.render=B,this.renderInstances=U}function WebGLCapabilities(u,a,s){let v;function x(){if(v!==void 0)return v;if(a.has("EXT_texture_filter_anisotropic")===!0){const ee=a.get("EXT_texture_filter_anisotropic");v=u.getParameter(ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else v=0;return v}function M(ee){if(ee==="highp"){if(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision>0)return"highp";ee="mediump"}return ee==="mediump"&&u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision>0&&u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const I=typeof WebGL2RenderingContext<"u"&&u.constructor.name==="WebGL2RenderingContext";let B=s.precision!==void 0?s.precision:"highp";const U=M(B);U!==B&&(console.warn("THREE.WebGLRenderer:",B,"not supported, using",U,"instead."),B=U);const j=I||a.has("WEBGL_draw_buffers"),te=s.logarithmicDepthBuffer===!0,Z=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),oe=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),le=u.getParameter(u.MAX_TEXTURE_SIZE),se=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),ve=u.getParameter(u.MAX_VERTEX_ATTRIBS),ce=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),K=u.getParameter(u.MAX_VARYING_VECTORS),X=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),W=oe>0,_e=I||a.has("OES_texture_float"),ge=W&&_e,Ae=I?u.getParameter(u.MAX_SAMPLES):0;return{isWebGL2:I,drawBuffers:j,getMaxAnisotropy:x,getMaxPrecision:M,precision:B,logarithmicDepthBuffer:te,maxTextures:Z,maxVertexTextures:oe,maxTextureSize:le,maxCubemapSize:se,maxAttributes:ve,maxVertexUniforms:ce,maxVaryings:K,maxFragmentUniforms:X,vertexTextures:W,floatFragmentTextures:_e,floatVertexTextures:ge,maxSamples:Ae}}function WebGLClipping(u){const a=this;let s=null,v=0,x=!1,M=!1;const I=new Plane,B=new Matrix3,U={value:null,needsUpdate:!1};this.uniform=U,this.numPlanes=0,this.numIntersection=0,this.init=function(Z,oe){const le=Z.length!==0||oe||v!==0||x;return x=oe,v=Z.length,le},this.beginShadows=function(){M=!0,te(null)},this.endShadows=function(){M=!1},this.setGlobalState=function(Z,oe){s=te(Z,oe,0)},this.setState=function(Z,oe,le){const se=Z.clippingPlanes,ve=Z.clipIntersection,ce=Z.clipShadows,K=u.get(Z);if(!x||se===null||se.length===0||M&&!ce)M?te(null):j();else{const X=M?0:v,W=X*4;let _e=K.clippingState||null;U.value=_e,_e=te(se,oe,W,le);for(let ge=0;ge!==W;++ge)_e[ge]=s[ge];K.clippingState=_e,this.numIntersection=ve?this.numPlanes:0,this.numPlanes+=X}};function j(){U.value!==s&&(U.value=s,U.needsUpdate=v>0),a.numPlanes=v,a.numIntersection=0}function te(Z,oe,le,se){const ve=Z!==null?Z.length:0;let ce=null;if(ve!==0){if(ce=U.value,se!==!0||ce===null){const K=le+ve*4,X=oe.matrixWorldInverse;B.getNormalMatrix(X),(ce===null||ce.length<K)&&(ce=new Float32Array(K));for(let W=0,_e=le;W!==ve;++W,_e+=4)I.copy(Z[W]).applyMatrix4(X,B),I.normal.toArray(ce,_e),ce[_e+3]=I.constant}U.value=ce,U.needsUpdate=!0}return a.numPlanes=ve,a.numIntersection=0,ce}}function WebGLCubeMaps(u){let a=new WeakMap;function s(I,B){return B===EquirectangularReflectionMapping?I.mapping=CubeReflectionMapping:B===EquirectangularRefractionMapping&&(I.mapping=CubeRefractionMapping),I}function v(I){if(I&&I.isTexture&&I.isRenderTargetTexture===!1){const B=I.mapping;if(B===EquirectangularReflectionMapping||B===EquirectangularRefractionMapping)if(a.has(I)){const U=a.get(I).texture;return s(U,I.mapping)}else{const U=I.image;if(U&&U.height>0){const j=new WebGLCubeRenderTarget(U.height/2);return j.fromEquirectangularTexture(u,I),a.set(I,j),I.addEventListener("dispose",x),s(j.texture,I.mapping)}else return null}}return I}function x(I){const B=I.target;B.removeEventListener("dispose",x);const U=a.get(B);U!==void 0&&(a.delete(B),U.dispose())}function M(){a=new WeakMap}return{get:v,dispose:M}}class OrthographicCamera extends Camera{constructor(a=-1,s=1,v=1,x=-1,M=.1,I=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=s,this.top=v,this.bottom=x,this.near=M,this.far=I,this.updateProjectionMatrix()}copy(a,s){return super.copy(a,s),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=a.view===null?null:Object.assign({},a.view),this}setViewOffset(a,s,v,x,M,I){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=s,this.view.offsetX=v,this.view.offsetY=x,this.view.width=M,this.view.height=I,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const a=(this.right-this.left)/(2*this.zoom),s=(this.top-this.bottom)/(2*this.zoom),v=(this.right+this.left)/2,x=(this.top+this.bottom)/2;let M=v-a,I=v+a,B=x+s,U=x-s;if(this.view!==null&&this.view.enabled){const j=(this.right-this.left)/this.view.fullWidth/this.zoom,te=(this.top-this.bottom)/this.view.fullHeight/this.zoom;M+=j*this.view.offsetX,I=M+j*this.view.width,B-=te*this.view.offsetY,U=B-te*this.view.height}this.projectionMatrix.makeOrthographic(M,I,B,U,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){const s=super.toJSON(a);return s.object.zoom=this.zoom,s.object.left=this.left,s.object.right=this.right,s.object.top=this.top,s.object.bottom=this.bottom,s.object.near=this.near,s.object.far=this.far,this.view!==null&&(s.object.view=Object.assign({},this.view)),s}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(a){this._renderer=a,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(a,s=0,v=.1,x=100){_oldTarget=this._renderer.getRenderTarget(),this._setSize(256);const M=this._allocateTargets();return M.depthBuffer=!0,this._sceneToCubeUV(a,v,x,M),s>0&&this._blur(M,0,0,s),this._applyPMREM(M),this._cleanup(M),M}fromEquirectangular(a,s=null){return this._fromTexture(a,s)}fromCubemap(a,s=null){return this._fromTexture(a,s)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(_oldTarget),a.scissorTest=!1,_setViewport(a,0,0,a.width,a.height)}_fromTexture(a,s){a.mapping===CubeReflectionMapping||a.mapping===CubeRefractionMapping?this._setSize(a.image.length===0?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4),_oldTarget=this._renderer.getRenderTarget();const v=s||this._allocateTargets();return this._textureToCubeUV(a,v),this._applyPMREM(v),this._cleanup(v),v}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),s=4*this._cubeSize,v={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},x=_createRenderTarget(a,s,v);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==s){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(a,s,v);const{_lodMax:M}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(M)),this._blurMaterial=_getBlurShader(M,a,s)}return x}_compileMaterial(a){const s=new Mesh(this._lodPlanes[0],a);this._renderer.compile(s,_flatCamera)}_sceneToCubeUV(a,s,v,x){const B=new PerspectiveCamera(90,1,s,v),U=[1,-1,1,1,1,1],j=[1,1,1,-1,-1,-1],te=this._renderer,Z=te.autoClear,oe=te.toneMapping;te.getClearColor(_clearColor),te.toneMapping=NoToneMapping,te.autoClear=!1;const le=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),se=new Mesh(new BoxGeometry,le);let ve=!1;const ce=a.background;ce?ce.isColor&&(le.color.copy(ce),a.background=null,ve=!0):(le.color.copy(_clearColor),ve=!0);for(let K=0;K<6;K++){const X=K%3;X===0?(B.up.set(0,U[K],0),B.lookAt(j[K],0,0)):X===1?(B.up.set(0,0,U[K]),B.lookAt(0,j[K],0)):(B.up.set(0,U[K],0),B.lookAt(0,0,j[K]));const W=this._cubeSize;_setViewport(x,X*W,K>2?W:0,W,W),te.setRenderTarget(x),ve&&te.render(se,B),te.render(a,B)}se.geometry.dispose(),se.material.dispose(),te.toneMapping=oe,te.autoClear=Z,a.background=ce}_textureToCubeUV(a,s){const v=this._renderer,x=a.mapping===CubeReflectionMapping||a.mapping===CubeRefractionMapping;x?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=a.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const M=x?this._cubemapMaterial:this._equirectMaterial,I=new Mesh(this._lodPlanes[0],M),B=M.uniforms;B.envMap.value=a;const U=this._cubeSize;_setViewport(s,0,0,3*U,2*U),v.setRenderTarget(s),v.render(I,_flatCamera)}_applyPMREM(a){const s=this._renderer,v=s.autoClear;s.autoClear=!1;for(let x=1;x<this._lodPlanes.length;x++){const M=Math.sqrt(this._sigmas[x]*this._sigmas[x]-this._sigmas[x-1]*this._sigmas[x-1]),I=_axisDirections[(x-1)%_axisDirections.length];this._blur(a,x-1,x,M,I)}s.autoClear=v}_blur(a,s,v,x,M){const I=this._pingPongRenderTarget;this._halfBlur(a,I,s,v,x,"latitudinal",M),this._halfBlur(I,a,v,v,x,"longitudinal",M)}_halfBlur(a,s,v,x,M,I,B){const U=this._renderer,j=this._blurMaterial;I!=="latitudinal"&&I!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const te=3,Z=new Mesh(this._lodPlanes[x],j),oe=j.uniforms,le=this._sizeLods[v]-1,se=isFinite(M)?Math.PI/(2*le):2*Math.PI/(2*MAX_SAMPLES-1),ve=M/se,ce=isFinite(M)?1+Math.floor(te*ve):MAX_SAMPLES;ce>MAX_SAMPLES&&console.warn(`sigmaRadians, ${M}, is too large and will clip, as it requested ${ce} samples when the maximum is set to ${MAX_SAMPLES}`);const K=[];let X=0;for(let ee=0;ee<MAX_SAMPLES;++ee){const $=ee/ve,ae=Math.exp(-$*$/2);K.push(ae),ee===0?X+=ae:ee<ce&&(X+=2*ae)}for(let ee=0;ee<K.length;ee++)K[ee]=K[ee]/X;oe.envMap.value=a.texture,oe.samples.value=ce,oe.weights.value=K,oe.latitudinal.value=I==="latitudinal",B&&(oe.poleAxis.value=B);const{_lodMax:W}=this;oe.dTheta.value=se,oe.mipInt.value=W-v;const _e=this._sizeLods[x],ge=3*_e*(x>W-LOD_MIN?x-W+LOD_MIN:0),Ae=4*(this._cubeSize-_e);_setViewport(s,ge,Ae,3*_e,2*_e),U.setRenderTarget(s),U.render(Z,_flatCamera)}}function _createPlanes(u){const a=[],s=[],v=[];let x=u;const M=u-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let I=0;I<M;I++){const B=Math.pow(2,x);s.push(B);let U=1/B;I>u-LOD_MIN?U=EXTRA_LOD_SIGMA[I-u+LOD_MIN-1]:I===0&&(U=0),v.push(U);const j=1/(B-2),te=-j,Z=1+j,oe=[te,te,Z,te,Z,Z,te,te,Z,Z,te,Z],le=6,se=6,ve=3,ce=2,K=1,X=new Float32Array(ve*se*le),W=new Float32Array(ce*se*le),_e=new Float32Array(K*se*le);for(let Ae=0;Ae<le;Ae++){const ee=Ae%3*2/3-1,$=Ae>2?0:-1,ae=[ee,$,0,ee+2/3,$,0,ee+2/3,$+1,0,ee,$,0,ee+2/3,$+1,0,ee,$+1,0];X.set(ae,ve*se*Ae),W.set(oe,ce*se*Ae);const Re=[Ae,Ae,Ae,Ae,Ae,Ae];_e.set(Re,K*se*Ae)}const ge=new BufferGeometry$1;ge.setAttribute("position",new BufferAttribute(X,ve)),ge.setAttribute("uv",new BufferAttribute(W,ce)),ge.setAttribute("faceIndex",new BufferAttribute(_e,K)),a.push(ge),x>LOD_MIN&&x--}return{lodPlanes:a,sizeLods:s,sigmas:v}}function _createRenderTarget(u,a,s){const v=new WebGLRenderTarget(u,a,s);return v.texture.mapping=CubeUVReflectionMapping,v.texture.name="PMREM.cubeUv",v.scissorTest=!0,v}function _setViewport(u,a,s,v,x){u.viewport.set(a,s,v,x),u.scissor.set(a,s,v,x)}function _getBlurShader(u,a,s){const v=new Float32Array(MAX_SAMPLES),x=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/s,CUBEUV_MAX_MIP:`${u}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:v},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:x}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(u){let a=new WeakMap,s=null;function v(B){if(B&&B.isTexture){const U=B.mapping,j=U===EquirectangularReflectionMapping||U===EquirectangularRefractionMapping,te=U===CubeReflectionMapping||U===CubeRefractionMapping;if(j||te)if(B.isRenderTargetTexture&&B.needsPMREMUpdate===!0){B.needsPMREMUpdate=!1;let Z=a.get(B);return s===null&&(s=new PMREMGenerator(u)),Z=j?s.fromEquirectangular(B,Z):s.fromCubemap(B,Z),a.set(B,Z),Z.texture}else{if(a.has(B))return a.get(B).texture;{const Z=B.image;if(j&&Z&&Z.height>0||te&&Z&&x(Z)){s===null&&(s=new PMREMGenerator(u));const oe=j?s.fromEquirectangular(B):s.fromCubemap(B);return a.set(B,oe),B.addEventListener("dispose",M),oe.texture}else return null}}}return B}function x(B){let U=0;const j=6;for(let te=0;te<j;te++)B[te]!==void 0&&U++;return U===j}function M(B){const U=B.target;U.removeEventListener("dispose",M);const j=a.get(U);j!==void 0&&(a.delete(U),j.dispose())}function I(){a=new WeakMap,s!==null&&(s.dispose(),s=null)}return{get:v,dispose:I}}function WebGLExtensions(u){const a={};function s(v){if(a[v]!==void 0)return a[v];let x;switch(v){case"WEBGL_depth_texture":x=u.getExtension("WEBGL_depth_texture")||u.getExtension("MOZ_WEBGL_depth_texture")||u.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":x=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":x=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":x=u.getExtension("WEBGL_compressed_texture_pvrtc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:x=u.getExtension(v)}return a[v]=x,x}return{has:function(v){return s(v)!==null},init:function(v){v.isWebGL2?s("EXT_color_buffer_float"):(s("WEBGL_depth_texture"),s("OES_texture_float"),s("OES_texture_half_float"),s("OES_texture_half_float_linear"),s("OES_standard_derivatives"),s("OES_element_index_uint"),s("OES_vertex_array_object"),s("ANGLE_instanced_arrays")),s("OES_texture_float_linear"),s("EXT_color_buffer_half_float"),s("WEBGL_multisampled_render_to_texture")},get:function(v){const x=s(v);return x===null&&console.warn("THREE.WebGLRenderer: "+v+" extension not supported."),x}}}function WebGLGeometries(u,a,s,v){const x={},M=new WeakMap;function I(Z){const oe=Z.target;oe.index!==null&&a.remove(oe.index);for(const se in oe.attributes)a.remove(oe.attributes[se]);for(const se in oe.morphAttributes){const ve=oe.morphAttributes[se];for(let ce=0,K=ve.length;ce<K;ce++)a.remove(ve[ce])}oe.removeEventListener("dispose",I),delete x[oe.id];const le=M.get(oe);le&&(a.remove(le),M.delete(oe)),v.releaseStatesOfGeometry(oe),oe.isInstancedBufferGeometry===!0&&delete oe._maxInstanceCount,s.memory.geometries--}function B(Z,oe){return x[oe.id]===!0||(oe.addEventListener("dispose",I),x[oe.id]=!0,s.memory.geometries++),oe}function U(Z){const oe=Z.attributes;for(const se in oe)a.update(oe[se],u.ARRAY_BUFFER);const le=Z.morphAttributes;for(const se in le){const ve=le[se];for(let ce=0,K=ve.length;ce<K;ce++)a.update(ve[ce],u.ARRAY_BUFFER)}}function j(Z){const oe=[],le=Z.index,se=Z.attributes.position;let ve=0;if(le!==null){const X=le.array;ve=le.version;for(let W=0,_e=X.length;W<_e;W+=3){const ge=X[W+0],Ae=X[W+1],ee=X[W+2];oe.push(ge,Ae,Ae,ee,ee,ge)}}else if(se!==void 0){const X=se.array;ve=se.version;for(let W=0,_e=X.length/3-1;W<_e;W+=3){const ge=W+0,Ae=W+1,ee=W+2;oe.push(ge,Ae,Ae,ee,ee,ge)}}else return;const ce=new(arrayNeedsUint32(oe)?Uint32BufferAttribute:Uint16BufferAttribute)(oe,1);ce.version=ve;const K=M.get(Z);K&&a.remove(K),M.set(Z,ce)}function te(Z){const oe=M.get(Z);if(oe){const le=Z.index;le!==null&&oe.version<le.version&&j(Z)}else j(Z);return M.get(Z)}return{get:B,update:U,getWireframeAttribute:te}}function WebGLIndexedBufferRenderer(u,a,s,v){const x=v.isWebGL2;let M;function I(oe){M=oe}let B,U;function j(oe){B=oe.type,U=oe.bytesPerElement}function te(oe,le){u.drawElements(M,le,B,oe*U),s.update(le,M,1)}function Z(oe,le,se){if(se===0)return;let ve,ce;if(x)ve=u,ce="drawElementsInstanced";else if(ve=a.get("ANGLE_instanced_arrays"),ce="drawElementsInstancedANGLE",ve===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}ve[ce](M,le,B,oe*U,se),s.update(le,M,se)}this.setMode=I,this.setIndex=j,this.render=te,this.renderInstances=Z}function WebGLInfo(u){const a={geometries:0,textures:0},s={frame:0,calls:0,triangles:0,points:0,lines:0};function v(M,I,B){switch(s.calls++,I){case u.TRIANGLES:s.triangles+=B*(M/3);break;case u.LINES:s.lines+=B*(M/2);break;case u.LINE_STRIP:s.lines+=B*(M-1);break;case u.LINE_LOOP:s.lines+=B*M;break;case u.POINTS:s.points+=B*M;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",I);break}}function x(){s.calls=0,s.triangles=0,s.points=0,s.lines=0}return{memory:a,render:s,programs:null,autoReset:!0,reset:x,update:v}}function numericalSort(u,a){return u[0]-a[0]}function absNumericalSort(u,a){return Math.abs(a[1])-Math.abs(u[1])}function WebGLMorphtargets(u,a,s){const v={},x=new Float32Array(8),M=new WeakMap,I=new Vector4,B=[];for(let j=0;j<8;j++)B[j]=[j,0];function U(j,te,Z){const oe=j.morphTargetInfluences;if(a.isWebGL2===!0){const le=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,se=le!==void 0?le.length:0;let ve=M.get(te);if(ve===void 0||ve.count!==se){let Ce=function(){he.dispose(),M.delete(te),te.removeEventListener("dispose",Ce)};ve!==void 0&&ve.texture.dispose();const X=te.morphAttributes.position!==void 0,W=te.morphAttributes.normal!==void 0,_e=te.morphAttributes.color!==void 0,ge=te.morphAttributes.position||[],Ae=te.morphAttributes.normal||[],ee=te.morphAttributes.color||[];let $=0;X===!0&&($=1),W===!0&&($=2),_e===!0&&($=3);let ae=te.attributes.position.count*$,Re=1;ae>a.maxTextureSize&&(Re=Math.ceil(ae/a.maxTextureSize),ae=a.maxTextureSize);const pe=new Float32Array(ae*Re*4*se),he=new DataArrayTexture(pe,ae,Re,se);he.type=FloatType,he.needsUpdate=!0;const we=$*4;for(let Ne=0;Ne<se;Ne++){const Ze=ge[Ne],Ye=Ae[Ne],it=ee[Ne],_t=ae*Re*4*Ne;for(let At=0;At<Ze.count;At++){const vt=At*we;X===!0&&(I.fromBufferAttribute(Ze,At),pe[_t+vt+0]=I.x,pe[_t+vt+1]=I.y,pe[_t+vt+2]=I.z,pe[_t+vt+3]=0),W===!0&&(I.fromBufferAttribute(Ye,At),pe[_t+vt+4]=I.x,pe[_t+vt+5]=I.y,pe[_t+vt+6]=I.z,pe[_t+vt+7]=0),_e===!0&&(I.fromBufferAttribute(it,At),pe[_t+vt+8]=I.x,pe[_t+vt+9]=I.y,pe[_t+vt+10]=I.z,pe[_t+vt+11]=it.itemSize===4?I.w:1)}}ve={count:se,texture:he,size:new Vector2(ae,Re)},M.set(te,ve),te.addEventListener("dispose",Ce)}let ce=0;for(let X=0;X<oe.length;X++)ce+=oe[X];const K=te.morphTargetsRelative?1:1-ce;Z.getUniforms().setValue(u,"morphTargetBaseInfluence",K),Z.getUniforms().setValue(u,"morphTargetInfluences",oe),Z.getUniforms().setValue(u,"morphTargetsTexture",ve.texture,s),Z.getUniforms().setValue(u,"morphTargetsTextureSize",ve.size)}else{const le=oe===void 0?0:oe.length;let se=v[te.id];if(se===void 0||se.length!==le){se=[];for(let W=0;W<le;W++)se[W]=[W,0];v[te.id]=se}for(let W=0;W<le;W++){const _e=se[W];_e[0]=W,_e[1]=oe[W]}se.sort(absNumericalSort);for(let W=0;W<8;W++)W<le&&se[W][1]?(B[W][0]=se[W][0],B[W][1]=se[W][1]):(B[W][0]=Number.MAX_SAFE_INTEGER,B[W][1]=0);B.sort(numericalSort);const ve=te.morphAttributes.position,ce=te.morphAttributes.normal;let K=0;for(let W=0;W<8;W++){const _e=B[W],ge=_e[0],Ae=_e[1];ge!==Number.MAX_SAFE_INTEGER&&Ae?(ve&&te.getAttribute("morphTarget"+W)!==ve[ge]&&te.setAttribute("morphTarget"+W,ve[ge]),ce&&te.getAttribute("morphNormal"+W)!==ce[ge]&&te.setAttribute("morphNormal"+W,ce[ge]),x[W]=Ae,K+=Ae):(ve&&te.hasAttribute("morphTarget"+W)===!0&&te.deleteAttribute("morphTarget"+W),ce&&te.hasAttribute("morphNormal"+W)===!0&&te.deleteAttribute("morphNormal"+W),x[W]=0)}const X=te.morphTargetsRelative?1:1-K;Z.getUniforms().setValue(u,"morphTargetBaseInfluence",X),Z.getUniforms().setValue(u,"morphTargetInfluences",x)}}return{update:U}}function WebGLObjects(u,a,s,v){let x=new WeakMap;function M(U){const j=v.render.frame,te=U.geometry,Z=a.get(U,te);if(x.get(Z)!==j&&(a.update(Z),x.set(Z,j)),U.isInstancedMesh&&(U.hasEventListener("dispose",B)===!1&&U.addEventListener("dispose",B),x.get(U)!==j&&(s.update(U.instanceMatrix,u.ARRAY_BUFFER),U.instanceColor!==null&&s.update(U.instanceColor,u.ARRAY_BUFFER),x.set(U,j))),U.isSkinnedMesh){const oe=U.skeleton;x.get(oe)!==j&&(oe.update(),x.set(oe,j))}return Z}function I(){x=new WeakMap}function B(U){const j=U.target;j.removeEventListener("dispose",B),s.remove(j.instanceMatrix),j.instanceColor!==null&&s.remove(j.instanceColor)}return{update:M,dispose:I}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(u,a,s){const v=u[0];if(v<=0||v>0)return u;const x=a*s;let M=arrayCacheF32[x];if(M===void 0&&(M=new Float32Array(x),arrayCacheF32[x]=M),a!==0){v.toArray(M,0);for(let I=1,B=0;I!==a;++I)B+=s,u[I].toArray(M,B)}return M}function arraysEqual(u,a){if(u.length!==a.length)return!1;for(let s=0,v=u.length;s<v;s++)if(u[s]!==a[s])return!1;return!0}function copyArray(u,a){for(let s=0,v=a.length;s<v;s++)u[s]=a[s]}function allocTexUnits(u,a){let s=arrayCacheI32[a];s===void 0&&(s=new Int32Array(a),arrayCacheI32[a]=s);for(let v=0;v!==a;++v)s[v]=u.allocateTextureUnit();return s}function setValueV1f(u,a){const s=this.cache;s[0]!==a&&(u.uniform1f(this.addr,a),s[0]=a)}function setValueV2f(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y)&&(u.uniform2f(this.addr,a.x,a.y),s[0]=a.x,s[1]=a.y);else{if(arraysEqual(s,a))return;u.uniform2fv(this.addr,a),copyArray(s,a)}}function setValueV3f(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z)&&(u.uniform3f(this.addr,a.x,a.y,a.z),s[0]=a.x,s[1]=a.y,s[2]=a.z);else if(a.r!==void 0)(s[0]!==a.r||s[1]!==a.g||s[2]!==a.b)&&(u.uniform3f(this.addr,a.r,a.g,a.b),s[0]=a.r,s[1]=a.g,s[2]=a.b);else{if(arraysEqual(s,a))return;u.uniform3fv(this.addr,a),copyArray(s,a)}}function setValueV4f(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z||s[3]!==a.w)&&(u.uniform4f(this.addr,a.x,a.y,a.z,a.w),s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=a.w);else{if(arraysEqual(s,a))return;u.uniform4fv(this.addr,a),copyArray(s,a)}}function setValueM2(u,a){const s=this.cache,v=a.elements;if(v===void 0){if(arraysEqual(s,a))return;u.uniformMatrix2fv(this.addr,!1,a),copyArray(s,a)}else{if(arraysEqual(s,v))return;mat2array.set(v),u.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(s,v)}}function setValueM3(u,a){const s=this.cache,v=a.elements;if(v===void 0){if(arraysEqual(s,a))return;u.uniformMatrix3fv(this.addr,!1,a),copyArray(s,a)}else{if(arraysEqual(s,v))return;mat3array.set(v),u.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(s,v)}}function setValueM4(u,a){const s=this.cache,v=a.elements;if(v===void 0){if(arraysEqual(s,a))return;u.uniformMatrix4fv(this.addr,!1,a),copyArray(s,a)}else{if(arraysEqual(s,v))return;mat4array.set(v),u.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(s,v)}}function setValueV1i(u,a){const s=this.cache;s[0]!==a&&(u.uniform1i(this.addr,a),s[0]=a)}function setValueV2i(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y)&&(u.uniform2i(this.addr,a.x,a.y),s[0]=a.x,s[1]=a.y);else{if(arraysEqual(s,a))return;u.uniform2iv(this.addr,a),copyArray(s,a)}}function setValueV3i(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z)&&(u.uniform3i(this.addr,a.x,a.y,a.z),s[0]=a.x,s[1]=a.y,s[2]=a.z);else{if(arraysEqual(s,a))return;u.uniform3iv(this.addr,a),copyArray(s,a)}}function setValueV4i(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z||s[3]!==a.w)&&(u.uniform4i(this.addr,a.x,a.y,a.z,a.w),s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=a.w);else{if(arraysEqual(s,a))return;u.uniform4iv(this.addr,a),copyArray(s,a)}}function setValueV1ui(u,a){const s=this.cache;s[0]!==a&&(u.uniform1ui(this.addr,a),s[0]=a)}function setValueV2ui(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y)&&(u.uniform2ui(this.addr,a.x,a.y),s[0]=a.x,s[1]=a.y);else{if(arraysEqual(s,a))return;u.uniform2uiv(this.addr,a),copyArray(s,a)}}function setValueV3ui(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z)&&(u.uniform3ui(this.addr,a.x,a.y,a.z),s[0]=a.x,s[1]=a.y,s[2]=a.z);else{if(arraysEqual(s,a))return;u.uniform3uiv(this.addr,a),copyArray(s,a)}}function setValueV4ui(u,a){const s=this.cache;if(a.x!==void 0)(s[0]!==a.x||s[1]!==a.y||s[2]!==a.z||s[3]!==a.w)&&(u.uniform4ui(this.addr,a.x,a.y,a.z,a.w),s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=a.w);else{if(arraysEqual(s,a))return;u.uniform4uiv(this.addr,a),copyArray(s,a)}}function setValueT1(u,a,s){const v=this.cache,x=s.allocateTextureUnit();v[0]!==x&&(u.uniform1i(this.addr,x),v[0]=x),s.setTexture2D(a||emptyTexture,x)}function setValueT3D1(u,a,s){const v=this.cache,x=s.allocateTextureUnit();v[0]!==x&&(u.uniform1i(this.addr,x),v[0]=x),s.setTexture3D(a||empty3dTexture,x)}function setValueT6(u,a,s){const v=this.cache,x=s.allocateTextureUnit();v[0]!==x&&(u.uniform1i(this.addr,x),v[0]=x),s.setTextureCube(a||emptyCubeTexture,x)}function setValueT2DArray1(u,a,s){const v=this.cache,x=s.allocateTextureUnit();v[0]!==x&&(u.uniform1i(this.addr,x),v[0]=x),s.setTexture2DArray(a||emptyArrayTexture,x)}function getSingularSetter(u){switch(u){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(u,a){u.uniform1fv(this.addr,a)}function setValueV2fArray(u,a){const s=flatten(a,this.size,2);u.uniform2fv(this.addr,s)}function setValueV3fArray(u,a){const s=flatten(a,this.size,3);u.uniform3fv(this.addr,s)}function setValueV4fArray(u,a){const s=flatten(a,this.size,4);u.uniform4fv(this.addr,s)}function setValueM2Array(u,a){const s=flatten(a,this.size,4);u.uniformMatrix2fv(this.addr,!1,s)}function setValueM3Array(u,a){const s=flatten(a,this.size,9);u.uniformMatrix3fv(this.addr,!1,s)}function setValueM4Array(u,a){const s=flatten(a,this.size,16);u.uniformMatrix4fv(this.addr,!1,s)}function setValueV1iArray(u,a){u.uniform1iv(this.addr,a)}function setValueV2iArray(u,a){u.uniform2iv(this.addr,a)}function setValueV3iArray(u,a){u.uniform3iv(this.addr,a)}function setValueV4iArray(u,a){u.uniform4iv(this.addr,a)}function setValueV1uiArray(u,a){u.uniform1uiv(this.addr,a)}function setValueV2uiArray(u,a){u.uniform2uiv(this.addr,a)}function setValueV3uiArray(u,a){u.uniform3uiv(this.addr,a)}function setValueV4uiArray(u,a){u.uniform4uiv(this.addr,a)}function setValueT1Array(u,a,s){const v=this.cache,x=a.length,M=allocTexUnits(s,x);arraysEqual(v,M)||(u.uniform1iv(this.addr,M),copyArray(v,M));for(let I=0;I!==x;++I)s.setTexture2D(a[I]||emptyTexture,M[I])}function setValueT3DArray(u,a,s){const v=this.cache,x=a.length,M=allocTexUnits(s,x);arraysEqual(v,M)||(u.uniform1iv(this.addr,M),copyArray(v,M));for(let I=0;I!==x;++I)s.setTexture3D(a[I]||empty3dTexture,M[I])}function setValueT6Array(u,a,s){const v=this.cache,x=a.length,M=allocTexUnits(s,x);arraysEqual(v,M)||(u.uniform1iv(this.addr,M),copyArray(v,M));for(let I=0;I!==x;++I)s.setTextureCube(a[I]||emptyCubeTexture,M[I])}function setValueT2DArrayArray(u,a,s){const v=this.cache,x=a.length,M=allocTexUnits(s,x);arraysEqual(v,M)||(u.uniform1iv(this.addr,M),copyArray(v,M));for(let I=0;I!==x;++I)s.setTexture2DArray(a[I]||emptyArrayTexture,M[I])}function getPureArraySetter(u){switch(u){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(a,s,v){this.id=a,this.addr=v,this.cache=[],this.setValue=getSingularSetter(s.type)}}class PureArrayUniform{constructor(a,s,v){this.id=a,this.addr=v,this.cache=[],this.size=s.size,this.setValue=getPureArraySetter(s.type)}}class StructuredUniform{constructor(a){this.id=a,this.seq=[],this.map={}}setValue(a,s,v){const x=this.seq;for(let M=0,I=x.length;M!==I;++M){const B=x[M];B.setValue(a,s[B.id],v)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(u,a){u.seq.push(a),u.map[a.id]=a}function parseUniform(u,a,s){const v=u.name,x=v.length;for(RePathPart.lastIndex=0;;){const M=RePathPart.exec(v),I=RePathPart.lastIndex;let B=M[1];const U=M[2]==="]",j=M[3];if(U&&(B=B|0),j===void 0||j==="["&&I+2===x){addUniform(s,j===void 0?new SingleUniform(B,u,a):new PureArrayUniform(B,u,a));break}else{let Z=s.map[B];Z===void 0&&(Z=new StructuredUniform(B),addUniform(s,Z)),s=Z}}}class WebGLUniforms{constructor(a,s){this.seq=[],this.map={};const v=a.getProgramParameter(s,a.ACTIVE_UNIFORMS);for(let x=0;x<v;++x){const M=a.getActiveUniform(s,x),I=a.getUniformLocation(s,M.name);parseUniform(M,I,this)}}setValue(a,s,v,x){const M=this.map[s];M!==void 0&&M.setValue(a,v,x)}setOptional(a,s,v){const x=s[v];x!==void 0&&this.setValue(a,v,x)}static upload(a,s,v,x){for(let M=0,I=s.length;M!==I;++M){const B=s[M],U=v[B.id];U.needsUpdate!==!1&&B.setValue(a,U.value,x)}}static seqWithValue(a,s){const v=[];for(let x=0,M=a.length;x!==M;++x){const I=a[x];I.id in s&&v.push(I)}return v}}function WebGLShader(u,a,s){const v=u.createShader(a);return u.shaderSource(v,s),u.compileShader(v),v}let programIdCount=0;function handleSource(u,a){const s=u.split(`
`),v=[],x=Math.max(a-6,0),M=Math.min(a+6,s.length);for(let I=x;I<M;I++){const B=I+1;v.push(`${B===a?">":" "} ${B}: ${s[I]}`)}return v.join(`
`)}function getEncodingComponents(u){switch(u){case LinearSRGBColorSpace:return["Linear","( value )"];case SRGBColorSpace:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",u),["Linear","( value )"]}}function getShaderErrors(u,a,s){const v=u.getShaderParameter(a,u.COMPILE_STATUS),x=u.getShaderInfoLog(a).trim();if(v&&x==="")return"";const M=/ERROR: 0:(\d+)/.exec(x);if(M){const I=parseInt(M[1]);return s.toUpperCase()+`

`+x+`

`+handleSource(u.getShaderSource(a),I)}else return x}function getTexelEncodingFunction(u,a){const s=getEncodingComponents(a);return"vec4 "+u+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"}function getToneMappingFunction(u,a){let s;switch(a){case LinearToneMapping:s="Linear";break;case ReinhardToneMapping:s="Reinhard";break;case CineonToneMapping:s="OptimizedCineon";break;case ACESFilmicToneMapping:s="ACESFilmic";break;case CustomToneMapping:s="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",a),s="Linear"}return"vec3 "+u+"( vec3 color ) { return "+s+"ToneMapping( color ); }"}function generateExtensions(u){return[u.extensionDerivatives||u.envMapCubeUVHeight||u.bumpMap||u.normalMapTangentSpace||u.clearcoatNormalMap||u.flatShading||u.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(u.extensionFragDepth||u.logarithmicDepthBuffer)&&u.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",u.extensionDrawBuffers&&u.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(u.extensionShaderTextureLOD||u.envMap||u.transmission)&&u.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(u){const a=[];for(const s in u){const v=u[s];v!==!1&&a.push("#define "+s+" "+v)}return a.join(`
`)}function fetchAttributeLocations(u,a){const s={},v=u.getProgramParameter(a,u.ACTIVE_ATTRIBUTES);for(let x=0;x<v;x++){const M=u.getActiveAttrib(a,x),I=M.name;let B=1;M.type===u.FLOAT_MAT2&&(B=2),M.type===u.FLOAT_MAT3&&(B=3),M.type===u.FLOAT_MAT4&&(B=4),s[I]={type:M.type,location:u.getAttribLocation(a,I),locationSize:B}}return s}function filterEmptyLine(u){return u!==""}function replaceLightNums(u,a){const s=a.numSpotLightShadows+a.numSpotLightMaps-a.numSpotLightShadowsWithMaps;return u.replace(/NUM_DIR_LIGHTS/g,a.numDirLights).replace(/NUM_SPOT_LIGHTS/g,a.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,a.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,s).replace(/NUM_RECT_AREA_LIGHTS/g,a.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,a.numPointLights).replace(/NUM_HEMI_LIGHTS/g,a.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,a.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,a.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,a.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,a.numPointLightShadows)}function replaceClippingPlaneNums(u,a){return u.replace(/NUM_CLIPPING_PLANES/g,a.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,a.numClippingPlanes-a.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(u){return u.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(u,a){let s=ShaderChunk[a];if(s===void 0){const v=shaderChunkMap.get(a);if(v!==void 0)s=ShaderChunk[v],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',a,v);else throw new Error("Can not resolve #include <"+a+">")}return resolveIncludes(s)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(u){return u.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(u,a,s,v){let x="";for(let M=parseInt(a);M<parseInt(s);M++)x+=v.replace(/\[\s*i\s*\]/g,"[ "+M+" ]").replace(/UNROLLED_LOOP_INDEX/g,M);return x}function generatePrecision(u){let a="precision "+u.precision+` float;
precision `+u.precision+" int;";return u.precision==="highp"?a+=`
#define HIGH_PRECISION`:u.precision==="mediump"?a+=`
#define MEDIUM_PRECISION`:u.precision==="lowp"&&(a+=`
#define LOW_PRECISION`),a}function generateShadowMapTypeDefine(u){let a="SHADOWMAP_TYPE_BASIC";return u.shadowMapType===PCFShadowMap?a="SHADOWMAP_TYPE_PCF":u.shadowMapType===PCFSoftShadowMap?a="SHADOWMAP_TYPE_PCF_SOFT":u.shadowMapType===VSMShadowMap&&(a="SHADOWMAP_TYPE_VSM"),a}function generateEnvMapTypeDefine(u){let a="ENVMAP_TYPE_CUBE";if(u.envMap)switch(u.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:a="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:a="ENVMAP_TYPE_CUBE_UV";break}return a}function generateEnvMapModeDefine(u){let a="ENVMAP_MODE_REFLECTION";if(u.envMap)switch(u.envMapMode){case CubeRefractionMapping:a="ENVMAP_MODE_REFRACTION";break}return a}function generateEnvMapBlendingDefine(u){let a="ENVMAP_BLENDING_NONE";if(u.envMap)switch(u.combine){case MultiplyOperation:a="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:a="ENVMAP_BLENDING_MIX";break;case AddOperation:a="ENVMAP_BLENDING_ADD";break}return a}function generateCubeUVSize(u){const a=u.envMapCubeUVHeight;if(a===null)return null;const s=Math.log2(a)-2,v=1/a;return{texelWidth:1/(3*Math.max(Math.pow(2,s),7*16)),texelHeight:v,maxMip:s}}function WebGLProgram(u,a,s,v){const x=u.getContext(),M=s.defines;let I=s.vertexShader,B=s.fragmentShader;const U=generateShadowMapTypeDefine(s),j=generateEnvMapTypeDefine(s),te=generateEnvMapModeDefine(s),Z=generateEnvMapBlendingDefine(s),oe=generateCubeUVSize(s),le=s.isWebGL2?"":generateExtensions(s),se=generateDefines(M),ve=x.createProgram();let ce,K,X=s.glslVersion?"#version "+s.glslVersion+`
`:"";s.isRawShaderMaterial?(ce=["#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,se].filter(filterEmptyLine).join(`
`),ce.length>0&&(ce+=`
`),K=[le,"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,se].filter(filterEmptyLine).join(`
`),K.length>0&&(K+=`
`)):(ce=[generatePrecision(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,se,s.instancing?"#define USE_INSTANCING":"",s.instancingColor?"#define USE_INSTANCING_COLOR":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+te:"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.displacementMap?"#define USE_DISPLACEMENTMAP":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.mapUv?"#define MAP_UV "+s.mapUv:"",s.alphaMapUv?"#define ALPHAMAP_UV "+s.alphaMapUv:"",s.lightMapUv?"#define LIGHTMAP_UV "+s.lightMapUv:"",s.aoMapUv?"#define AOMAP_UV "+s.aoMapUv:"",s.emissiveMapUv?"#define EMISSIVEMAP_UV "+s.emissiveMapUv:"",s.bumpMapUv?"#define BUMPMAP_UV "+s.bumpMapUv:"",s.normalMapUv?"#define NORMALMAP_UV "+s.normalMapUv:"",s.displacementMapUv?"#define DISPLACEMENTMAP_UV "+s.displacementMapUv:"",s.metalnessMapUv?"#define METALNESSMAP_UV "+s.metalnessMapUv:"",s.roughnessMapUv?"#define ROUGHNESSMAP_UV "+s.roughnessMapUv:"",s.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+s.anisotropyMapUv:"",s.clearcoatMapUv?"#define CLEARCOATMAP_UV "+s.clearcoatMapUv:"",s.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+s.clearcoatNormalMapUv:"",s.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+s.clearcoatRoughnessMapUv:"",s.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+s.iridescenceMapUv:"",s.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+s.iridescenceThicknessMapUv:"",s.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+s.sheenColorMapUv:"",s.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+s.sheenRoughnessMapUv:"",s.specularMapUv?"#define SPECULARMAP_UV "+s.specularMapUv:"",s.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+s.specularColorMapUv:"",s.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+s.specularIntensityMapUv:"",s.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+s.transmissionMapUv:"",s.thicknessMapUv?"#define THICKNESSMAP_UV "+s.thicknessMapUv:"",s.vertexTangents&&s.flatShading===!1?"#define USE_TANGENT":"",s.vertexColors?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals&&s.flatShading===!1?"#define USE_MORPHNORMALS":"",s.morphColors&&s.isWebGL2?"#define USE_MORPHCOLORS":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+s.morphTextureStride:"",s.morphTargetsCount>0&&s.isWebGL2?"#define MORPHTARGETS_COUNT "+s.morphTargetsCount:"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+U:"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),K=[le,generatePrecision(s),"#define SHADER_TYPE "+s.shaderType,"#define SHADER_NAME "+s.shaderName,se,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp2?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.matcap?"#define USE_MATCAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+j:"",s.envMap?"#define "+te:"",s.envMap?"#define "+Z:"",oe?"#define CUBEUV_TEXEL_WIDTH "+oe.texelWidth:"",oe?"#define CUBEUV_TEXEL_HEIGHT "+oe.texelHeight:"",oe?"#define CUBEUV_MAX_MIP "+oe.maxMip+".0":"",s.lightMap?"#define USE_LIGHTMAP":"",s.aoMap?"#define USE_AOMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",s.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",s.emissiveMap?"#define USE_EMISSIVEMAP":"",s.anisotropy?"#define USE_ANISOTROPY":"",s.anisotropyMap?"#define USE_ANISOTROPYMAP":"",s.clearcoat?"#define USE_CLEARCOAT":"",s.clearcoatMap?"#define USE_CLEARCOATMAP":"",s.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",s.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",s.iridescence?"#define USE_IRIDESCENCE":"",s.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",s.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",s.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",s.roughnessMap?"#define USE_ROUGHNESSMAP":"",s.metalnessMap?"#define USE_METALNESSMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.alphaTest?"#define USE_ALPHATEST":"",s.alphaHash?"#define USE_ALPHAHASH":"",s.sheen?"#define USE_SHEEN":"",s.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",s.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",s.transmission?"#define USE_TRANSMISSION":"",s.transmissionMap?"#define USE_TRANSMISSIONMAP":"",s.thicknessMap?"#define USE_THICKNESSMAP":"",s.vertexTangents&&s.flatShading===!1?"#define USE_TANGENT":"",s.vertexColors||s.instancingColor?"#define USE_COLOR":"",s.vertexAlphas?"#define USE_COLOR_ALPHA":"",s.vertexUv1s?"#define USE_UV1":"",s.vertexUv2s?"#define USE_UV2":"",s.vertexUv3s?"#define USE_UV3":"",s.pointsUvs?"#define USE_POINTS_UV":"",s.gradientMap?"#define USE_GRADIENTMAP":"",s.flatShading?"#define FLAT_SHADED":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+U:"",s.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",s.useLegacyLights?"#define LEGACY_LIGHTS":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",s.logarithmicDepthBuffer&&s.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",s.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",s.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",s.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",s.toneMapping):"",s.dithering?"#define DITHERING":"",s.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",s.outputColorSpace),s.useDepthPacking?"#define DEPTH_PACKING "+s.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),I=resolveIncludes(I),I=replaceLightNums(I,s),I=replaceClippingPlaneNums(I,s),B=resolveIncludes(B),B=replaceLightNums(B,s),B=replaceClippingPlaneNums(B,s),I=unrollLoops(I),B=unrollLoops(B),s.isWebGL2&&s.isRawShaderMaterial!==!0&&(X=`#version 300 es
`,ce=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ce,K=["#define varying in",s.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",s.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+K);const W=X+ce+I,_e=X+K+B,ge=WebGLShader(x,x.VERTEX_SHADER,W),Ae=WebGLShader(x,x.FRAGMENT_SHADER,_e);if(x.attachShader(ve,ge),x.attachShader(ve,Ae),s.index0AttributeName!==void 0?x.bindAttribLocation(ve,0,s.index0AttributeName):s.morphTargets===!0&&x.bindAttribLocation(ve,0,"position"),x.linkProgram(ve),u.debug.checkShaderErrors){const ae=x.getProgramInfoLog(ve).trim(),Re=x.getShaderInfoLog(ge).trim(),pe=x.getShaderInfoLog(Ae).trim();let he=!0,we=!0;if(x.getProgramParameter(ve,x.LINK_STATUS)===!1)if(he=!1,typeof u.debug.onShaderError=="function")u.debug.onShaderError(x,ve,ge,Ae);else{const Ce=getShaderErrors(x,ge,"vertex"),Ne=getShaderErrors(x,Ae,"fragment");console.error("THREE.WebGLProgram: Shader Error "+x.getError()+" - VALIDATE_STATUS "+x.getProgramParameter(ve,x.VALIDATE_STATUS)+`

Program Info Log: `+ae+`
`+Ce+`
`+Ne)}else ae!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ae):(Re===""||pe==="")&&(we=!1);we&&(this.diagnostics={runnable:he,programLog:ae,vertexShader:{log:Re,prefix:ce},fragmentShader:{log:pe,prefix:K}})}x.deleteShader(ge),x.deleteShader(Ae);let ee;this.getUniforms=function(){return ee===void 0&&(ee=new WebGLUniforms(x,ve)),ee};let $;return this.getAttributes=function(){return $===void 0&&($=fetchAttributeLocations(x,ve)),$},this.destroy=function(){v.releaseStatesOfProgram(this),x.deleteProgram(ve),this.program=void 0},this.type=s.shaderType,this.name=s.shaderName,this.id=programIdCount++,this.cacheKey=a,this.usedTimes=1,this.program=ve,this.vertexShader=ge,this.fragmentShader=Ae,this}let _id=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(a){const s=a.vertexShader,v=a.fragmentShader,x=this._getShaderStage(s),M=this._getShaderStage(v),I=this._getShaderCacheForMaterial(a);return I.has(x)===!1&&(I.add(x),x.usedTimes++),I.has(M)===!1&&(I.add(M),M.usedTimes++),this}remove(a){const s=this.materialCache.get(a);for(const v of s)v.usedTimes--,v.usedTimes===0&&this.shaderCache.delete(v.code);return this.materialCache.delete(a),this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(a){const s=this.materialCache;let v=s.get(a);return v===void 0&&(v=new Set,s.set(a,v)),v}_getShaderStage(a){const s=this.shaderCache;let v=s.get(a);return v===void 0&&(v=new WebGLShaderStage(a),s.set(a,v)),v}}class WebGLShaderStage{constructor(a){this.id=_id++,this.code=a,this.usedTimes=0}}function WebGLPrograms(u,a,s,v,x,M,I){const B=new Layers,U=new WebGLShaderCache,j=[],te=x.isWebGL2,Z=x.logarithmicDepthBuffer,oe=x.vertexTextures;let le=x.precision;const se={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function ve(ae){return ae===0?"uv":`uv${ae}`}function ce(ae,Re,pe,he,we){const Ce=he.fog,Ne=we.geometry,Ze=ae.isMeshStandardMaterial?he.environment:null,Ye=(ae.isMeshStandardMaterial?s:a).get(ae.envMap||Ze),it=Ye&&Ye.mapping===CubeUVReflectionMapping?Ye.image.height:null,_t=se[ae.type];ae.precision!==null&&(le=x.getMaxPrecision(ae.precision),le!==ae.precision&&console.warn("THREE.WebGLProgram.getParameters:",ae.precision,"not supported, using",le,"instead."));const At=Ne.morphAttributes.position||Ne.morphAttributes.normal||Ne.morphAttributes.color,vt=At!==void 0?At.length:0;let ut=0;Ne.morphAttributes.position!==void 0&&(ut=1),Ne.morphAttributes.normal!==void 0&&(ut=2),Ne.morphAttributes.color!==void 0&&(ut=3);let Nt,Qt,Qe,ft;if(_t){const cs=ShaderLib[_t];Nt=cs.vertexShader,Qt=cs.fragmentShader}else Nt=ae.vertexShader,Qt=ae.fragmentShader,U.update(ae),Qe=U.getVertexShaderID(ae),ft=U.getFragmentShaderID(ae);const bt=u.getRenderTarget(),sn=we.isInstancedMesh===!0,bn=!!ae.map,Un=!!ae.matcap,pi=!!Ye,Xe=!!ae.aoMap,Xt=!!ae.lightMap,tn=!!ae.bumpMap,dn=!!ae.normalMap,pn=!!ae.displacementMap,Pn=!!ae.emissiveMap,Cn=!!ae.metalnessMap,vn=!!ae.roughnessMap,In=ae.anisotropy>0,Fn=ae.clearcoat>0,Hn=ae.iridescence>0,fe=ae.sheen>0,Se=ae.transmission>0,Ve=In&&!!ae.anisotropyMap,We=Fn&&!!ae.clearcoatMap,pt=Fn&&!!ae.clearcoatNormalMap,It=Fn&&!!ae.clearcoatRoughnessMap,$t=Hn&&!!ae.iridescenceMap,nn=Hn&&!!ae.iridescenceThicknessMap,Ht=fe&&!!ae.sheenColorMap,Wn=fe&&!!ae.sheenRoughnessMap,Ln=!!ae.specularMap,Qn=!!ae.specularColorMap,Nn=!!ae.specularIntensityMap,Zn=Se&&!!ae.transmissionMap,Qi=Se&&!!ae.thicknessMap,Mr=!!ae.gradientMap,ze=!!ae.alphaMap,yi=ae.alphaTest>0,On=!!ae.alphaHash,si=!!ae.extensions,di=!!Ne.attributes.uv1,Mi=!!Ne.attributes.uv2,is=!!Ne.attributes.uv3;let jr=NoToneMapping;return ae.toneMapped&&(bt===null||bt.isXRRenderTarget===!0)&&(jr=u.toneMapping),{isWebGL2:te,shaderID:_t,shaderType:ae.type,shaderName:ae.name,vertexShader:Nt,fragmentShader:Qt,defines:ae.defines,customVertexShaderID:Qe,customFragmentShaderID:ft,isRawShaderMaterial:ae.isRawShaderMaterial===!0,glslVersion:ae.glslVersion,precision:le,instancing:sn,instancingColor:sn&&we.instanceColor!==null,supportsVertexTextures:oe,outputColorSpace:bt===null?u.outputColorSpace:bt.isXRRenderTarget===!0?bt.texture.colorSpace:LinearSRGBColorSpace,map:bn,matcap:Un,envMap:pi,envMapMode:pi&&Ye.mapping,envMapCubeUVHeight:it,aoMap:Xe,lightMap:Xt,bumpMap:tn,normalMap:dn,displacementMap:oe&&pn,emissiveMap:Pn,normalMapObjectSpace:dn&&ae.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:dn&&ae.normalMapType===TangentSpaceNormalMap,metalnessMap:Cn,roughnessMap:vn,anisotropy:In,anisotropyMap:Ve,clearcoat:Fn,clearcoatMap:We,clearcoatNormalMap:pt,clearcoatRoughnessMap:It,iridescence:Hn,iridescenceMap:$t,iridescenceThicknessMap:nn,sheen:fe,sheenColorMap:Ht,sheenRoughnessMap:Wn,specularMap:Ln,specularColorMap:Qn,specularIntensityMap:Nn,transmission:Se,transmissionMap:Zn,thicknessMap:Qi,gradientMap:Mr,opaque:ae.transparent===!1&&ae.blending===NormalBlending,alphaMap:ze,alphaTest:yi,alphaHash:On,combine:ae.combine,mapUv:bn&&ve(ae.map.channel),aoMapUv:Xe&&ve(ae.aoMap.channel),lightMapUv:Xt&&ve(ae.lightMap.channel),bumpMapUv:tn&&ve(ae.bumpMap.channel),normalMapUv:dn&&ve(ae.normalMap.channel),displacementMapUv:pn&&ve(ae.displacementMap.channel),emissiveMapUv:Pn&&ve(ae.emissiveMap.channel),metalnessMapUv:Cn&&ve(ae.metalnessMap.channel),roughnessMapUv:vn&&ve(ae.roughnessMap.channel),anisotropyMapUv:Ve&&ve(ae.anisotropyMap.channel),clearcoatMapUv:We&&ve(ae.clearcoatMap.channel),clearcoatNormalMapUv:pt&&ve(ae.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:It&&ve(ae.clearcoatRoughnessMap.channel),iridescenceMapUv:$t&&ve(ae.iridescenceMap.channel),iridescenceThicknessMapUv:nn&&ve(ae.iridescenceThicknessMap.channel),sheenColorMapUv:Ht&&ve(ae.sheenColorMap.channel),sheenRoughnessMapUv:Wn&&ve(ae.sheenRoughnessMap.channel),specularMapUv:Ln&&ve(ae.specularMap.channel),specularColorMapUv:Qn&&ve(ae.specularColorMap.channel),specularIntensityMapUv:Nn&&ve(ae.specularIntensityMap.channel),transmissionMapUv:Zn&&ve(ae.transmissionMap.channel),thicknessMapUv:Qi&&ve(ae.thicknessMap.channel),alphaMapUv:ze&&ve(ae.alphaMap.channel),vertexTangents:!!Ne.attributes.tangent&&(dn||In),vertexColors:ae.vertexColors,vertexAlphas:ae.vertexColors===!0&&!!Ne.attributes.color&&Ne.attributes.color.itemSize===4,vertexUv1s:di,vertexUv2s:Mi,vertexUv3s:is,pointsUvs:we.isPoints===!0&&!!Ne.attributes.uv&&(bn||ze),fog:!!Ce,useFog:ae.fog===!0,fogExp2:Ce&&Ce.isFogExp2,flatShading:ae.flatShading===!0,sizeAttenuation:ae.sizeAttenuation===!0,logarithmicDepthBuffer:Z,skinning:we.isSkinnedMesh===!0,morphTargets:Ne.morphAttributes.position!==void 0,morphNormals:Ne.morphAttributes.normal!==void 0,morphColors:Ne.morphAttributes.color!==void 0,morphTargetsCount:vt,morphTextureStride:ut,numDirLights:Re.directional.length,numPointLights:Re.point.length,numSpotLights:Re.spot.length,numSpotLightMaps:Re.spotLightMap.length,numRectAreaLights:Re.rectArea.length,numHemiLights:Re.hemi.length,numDirLightShadows:Re.directionalShadowMap.length,numPointLightShadows:Re.pointShadowMap.length,numSpotLightShadows:Re.spotShadowMap.length,numSpotLightShadowsWithMaps:Re.numSpotLightShadowsWithMaps,numClippingPlanes:I.numPlanes,numClipIntersection:I.numIntersection,dithering:ae.dithering,shadowMapEnabled:u.shadowMap.enabled&&pe.length>0,shadowMapType:u.shadowMap.type,toneMapping:jr,useLegacyLights:u._useLegacyLights,premultipliedAlpha:ae.premultipliedAlpha,doubleSided:ae.side===DoubleSide,flipSided:ae.side===BackSide,useDepthPacking:ae.depthPacking>=0,depthPacking:ae.depthPacking||0,index0AttributeName:ae.index0AttributeName,extensionDerivatives:si&&ae.extensions.derivatives===!0,extensionFragDepth:si&&ae.extensions.fragDepth===!0,extensionDrawBuffers:si&&ae.extensions.drawBuffers===!0,extensionShaderTextureLOD:si&&ae.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:te||v.has("EXT_frag_depth"),rendererExtensionDrawBuffers:te||v.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:te||v.has("EXT_shader_texture_lod"),customProgramCacheKey:ae.customProgramCacheKey()}}function K(ae){const Re=[];if(ae.shaderID?Re.push(ae.shaderID):(Re.push(ae.customVertexShaderID),Re.push(ae.customFragmentShaderID)),ae.defines!==void 0)for(const pe in ae.defines)Re.push(pe),Re.push(ae.defines[pe]);return ae.isRawShaderMaterial===!1&&(X(Re,ae),W(Re,ae),Re.push(u.outputColorSpace)),Re.push(ae.customProgramCacheKey),Re.join()}function X(ae,Re){ae.push(Re.precision),ae.push(Re.outputColorSpace),ae.push(Re.envMapMode),ae.push(Re.envMapCubeUVHeight),ae.push(Re.mapUv),ae.push(Re.alphaMapUv),ae.push(Re.lightMapUv),ae.push(Re.aoMapUv),ae.push(Re.bumpMapUv),ae.push(Re.normalMapUv),ae.push(Re.displacementMapUv),ae.push(Re.emissiveMapUv),ae.push(Re.metalnessMapUv),ae.push(Re.roughnessMapUv),ae.push(Re.anisotropyMapUv),ae.push(Re.clearcoatMapUv),ae.push(Re.clearcoatNormalMapUv),ae.push(Re.clearcoatRoughnessMapUv),ae.push(Re.iridescenceMapUv),ae.push(Re.iridescenceThicknessMapUv),ae.push(Re.sheenColorMapUv),ae.push(Re.sheenRoughnessMapUv),ae.push(Re.specularMapUv),ae.push(Re.specularColorMapUv),ae.push(Re.specularIntensityMapUv),ae.push(Re.transmissionMapUv),ae.push(Re.thicknessMapUv),ae.push(Re.combine),ae.push(Re.fogExp2),ae.push(Re.sizeAttenuation),ae.push(Re.morphTargetsCount),ae.push(Re.morphAttributeCount),ae.push(Re.numDirLights),ae.push(Re.numPointLights),ae.push(Re.numSpotLights),ae.push(Re.numSpotLightMaps),ae.push(Re.numHemiLights),ae.push(Re.numRectAreaLights),ae.push(Re.numDirLightShadows),ae.push(Re.numPointLightShadows),ae.push(Re.numSpotLightShadows),ae.push(Re.numSpotLightShadowsWithMaps),ae.push(Re.shadowMapType),ae.push(Re.toneMapping),ae.push(Re.numClippingPlanes),ae.push(Re.numClipIntersection),ae.push(Re.depthPacking)}function W(ae,Re){B.disableAll(),Re.isWebGL2&&B.enable(0),Re.supportsVertexTextures&&B.enable(1),Re.instancing&&B.enable(2),Re.instancingColor&&B.enable(3),Re.matcap&&B.enable(4),Re.envMap&&B.enable(5),Re.normalMapObjectSpace&&B.enable(6),Re.normalMapTangentSpace&&B.enable(7),Re.clearcoat&&B.enable(8),Re.iridescence&&B.enable(9),Re.alphaTest&&B.enable(10),Re.vertexColors&&B.enable(11),Re.vertexAlphas&&B.enable(12),Re.vertexUv1s&&B.enable(13),Re.vertexUv2s&&B.enable(14),Re.vertexUv3s&&B.enable(15),Re.vertexTangents&&B.enable(16),Re.anisotropy&&B.enable(17),ae.push(B.mask),B.disableAll(),Re.fog&&B.enable(0),Re.useFog&&B.enable(1),Re.flatShading&&B.enable(2),Re.logarithmicDepthBuffer&&B.enable(3),Re.skinning&&B.enable(4),Re.morphTargets&&B.enable(5),Re.morphNormals&&B.enable(6),Re.morphColors&&B.enable(7),Re.premultipliedAlpha&&B.enable(8),Re.shadowMapEnabled&&B.enable(9),Re.useLegacyLights&&B.enable(10),Re.doubleSided&&B.enable(11),Re.flipSided&&B.enable(12),Re.useDepthPacking&&B.enable(13),Re.dithering&&B.enable(14),Re.transmission&&B.enable(15),Re.sheen&&B.enable(16),Re.opaque&&B.enable(17),Re.pointsUvs&&B.enable(18),ae.push(B.mask)}function _e(ae){const Re=se[ae.type];let pe;if(Re){const he=ShaderLib[Re];pe=UniformsUtils.clone(he.uniforms)}else pe=ae.uniforms;return pe}function ge(ae,Re){let pe;for(let he=0,we=j.length;he<we;he++){const Ce=j[he];if(Ce.cacheKey===Re){pe=Ce,++pe.usedTimes;break}}return pe===void 0&&(pe=new WebGLProgram(u,Re,ae,M),j.push(pe)),pe}function Ae(ae){if(--ae.usedTimes===0){const Re=j.indexOf(ae);j[Re]=j[j.length-1],j.pop(),ae.destroy()}}function ee(ae){U.remove(ae)}function $(){U.dispose()}return{getParameters:ce,getProgramCacheKey:K,getUniforms:_e,acquireProgram:ge,releaseProgram:Ae,releaseShaderCache:ee,programs:j,dispose:$}}function WebGLProperties(){let u=new WeakMap;function a(M){let I=u.get(M);return I===void 0&&(I={},u.set(M,I)),I}function s(M){u.delete(M)}function v(M,I,B){u.get(M)[I]=B}function x(){u=new WeakMap}return{get:a,remove:s,update:v,dispose:x}}function painterSortStable(u,a){return u.groupOrder!==a.groupOrder?u.groupOrder-a.groupOrder:u.renderOrder!==a.renderOrder?u.renderOrder-a.renderOrder:u.material.id!==a.material.id?u.material.id-a.material.id:u.z!==a.z?u.z-a.z:u.id-a.id}function reversePainterSortStable(u,a){return u.groupOrder!==a.groupOrder?u.groupOrder-a.groupOrder:u.renderOrder!==a.renderOrder?u.renderOrder-a.renderOrder:u.z!==a.z?a.z-u.z:u.id-a.id}function WebGLRenderList(){const u=[];let a=0;const s=[],v=[],x=[];function M(){a=0,s.length=0,v.length=0,x.length=0}function I(Z,oe,le,se,ve,ce){let K=u[a];return K===void 0?(K={id:Z.id,object:Z,geometry:oe,material:le,groupOrder:se,renderOrder:Z.renderOrder,z:ve,group:ce},u[a]=K):(K.id=Z.id,K.object=Z,K.geometry=oe,K.material=le,K.groupOrder=se,K.renderOrder=Z.renderOrder,K.z=ve,K.group=ce),a++,K}function B(Z,oe,le,se,ve,ce){const K=I(Z,oe,le,se,ve,ce);le.transmission>0?v.push(K):le.transparent===!0?x.push(K):s.push(K)}function U(Z,oe,le,se,ve,ce){const K=I(Z,oe,le,se,ve,ce);le.transmission>0?v.unshift(K):le.transparent===!0?x.unshift(K):s.unshift(K)}function j(Z,oe){s.length>1&&s.sort(Z||painterSortStable),v.length>1&&v.sort(oe||reversePainterSortStable),x.length>1&&x.sort(oe||reversePainterSortStable)}function te(){for(let Z=a,oe=u.length;Z<oe;Z++){const le=u[Z];if(le.id===null)break;le.id=null,le.object=null,le.geometry=null,le.material=null,le.group=null}}return{opaque:s,transmissive:v,transparent:x,init:M,push:B,unshift:U,finish:te,sort:j}}function WebGLRenderLists(){let u=new WeakMap;function a(v,x){const M=u.get(v);let I;return M===void 0?(I=new WebGLRenderList,u.set(v,[I])):x>=M.length?(I=new WebGLRenderList,M.push(I)):I=M[x],I}function s(){u=new WeakMap}return{get:a,dispose:s}}function UniformsCache(){const u={};return{get:function(a){if(u[a.id]!==void 0)return u[a.id];let s;switch(a.type){case"DirectionalLight":s={direction:new Vector3,color:new Color};break;case"SpotLight":s={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":s={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":s={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":s={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return u[a.id]=s,s}}}function ShadowUniformsCache(){const u={};return{get:function(a){if(u[a.id]!==void 0)return u[a.id];let s;switch(a.type){case"DirectionalLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":s={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return u[a.id]=s,s}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(u,a){return(a.castShadow?2:0)-(u.castShadow?2:0)+(a.map?1:0)-(u.map?1:0)}function WebGLLights(u,a){const s=new UniformsCache,v=ShadowUniformsCache(),x={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let te=0;te<9;te++)x.probe.push(new Vector3);const M=new Vector3,I=new Matrix4,B=new Matrix4;function U(te,Z){let oe=0,le=0,se=0;for(let pe=0;pe<9;pe++)x.probe[pe].set(0,0,0);let ve=0,ce=0,K=0,X=0,W=0,_e=0,ge=0,Ae=0,ee=0,$=0;te.sort(shadowCastingAndTexturingLightsFirst);const ae=Z===!0?Math.PI:1;for(let pe=0,he=te.length;pe<he;pe++){const we=te[pe],Ce=we.color,Ne=we.intensity,Ze=we.distance,Ye=we.shadow&&we.shadow.map?we.shadow.map.texture:null;if(we.isAmbientLight)oe+=Ce.r*Ne*ae,le+=Ce.g*Ne*ae,se+=Ce.b*Ne*ae;else if(we.isLightProbe)for(let it=0;it<9;it++)x.probe[it].addScaledVector(we.sh.coefficients[it],Ne);else if(we.isDirectionalLight){const it=s.get(we);if(it.color.copy(we.color).multiplyScalar(we.intensity*ae),we.castShadow){const _t=we.shadow,At=v.get(we);At.shadowBias=_t.bias,At.shadowNormalBias=_t.normalBias,At.shadowRadius=_t.radius,At.shadowMapSize=_t.mapSize,x.directionalShadow[ve]=At,x.directionalShadowMap[ve]=Ye,x.directionalShadowMatrix[ve]=we.shadow.matrix,_e++}x.directional[ve]=it,ve++}else if(we.isSpotLight){const it=s.get(we);it.position.setFromMatrixPosition(we.matrixWorld),it.color.copy(Ce).multiplyScalar(Ne*ae),it.distance=Ze,it.coneCos=Math.cos(we.angle),it.penumbraCos=Math.cos(we.angle*(1-we.penumbra)),it.decay=we.decay,x.spot[K]=it;const _t=we.shadow;if(we.map&&(x.spotLightMap[ee]=we.map,ee++,_t.updateMatrices(we),we.castShadow&&$++),x.spotLightMatrix[K]=_t.matrix,we.castShadow){const At=v.get(we);At.shadowBias=_t.bias,At.shadowNormalBias=_t.normalBias,At.shadowRadius=_t.radius,At.shadowMapSize=_t.mapSize,x.spotShadow[K]=At,x.spotShadowMap[K]=Ye,Ae++}K++}else if(we.isRectAreaLight){const it=s.get(we);it.color.copy(Ce).multiplyScalar(Ne),it.halfWidth.set(we.width*.5,0,0),it.halfHeight.set(0,we.height*.5,0),x.rectArea[X]=it,X++}else if(we.isPointLight){const it=s.get(we);if(it.color.copy(we.color).multiplyScalar(we.intensity*ae),it.distance=we.distance,it.decay=we.decay,we.castShadow){const _t=we.shadow,At=v.get(we);At.shadowBias=_t.bias,At.shadowNormalBias=_t.normalBias,At.shadowRadius=_t.radius,At.shadowMapSize=_t.mapSize,At.shadowCameraNear=_t.camera.near,At.shadowCameraFar=_t.camera.far,x.pointShadow[ce]=At,x.pointShadowMap[ce]=Ye,x.pointShadowMatrix[ce]=we.shadow.matrix,ge++}x.point[ce]=it,ce++}else if(we.isHemisphereLight){const it=s.get(we);it.skyColor.copy(we.color).multiplyScalar(Ne*ae),it.groundColor.copy(we.groundColor).multiplyScalar(Ne*ae),x.hemi[W]=it,W++}}X>0&&(a.isWebGL2||u.has("OES_texture_float_linear")===!0?(x.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,x.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):u.has("OES_texture_half_float_linear")===!0?(x.rectAreaLTC1=UniformsLib.LTC_HALF_1,x.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),x.ambient[0]=oe,x.ambient[1]=le,x.ambient[2]=se;const Re=x.hash;(Re.directionalLength!==ve||Re.pointLength!==ce||Re.spotLength!==K||Re.rectAreaLength!==X||Re.hemiLength!==W||Re.numDirectionalShadows!==_e||Re.numPointShadows!==ge||Re.numSpotShadows!==Ae||Re.numSpotMaps!==ee)&&(x.directional.length=ve,x.spot.length=K,x.rectArea.length=X,x.point.length=ce,x.hemi.length=W,x.directionalShadow.length=_e,x.directionalShadowMap.length=_e,x.pointShadow.length=ge,x.pointShadowMap.length=ge,x.spotShadow.length=Ae,x.spotShadowMap.length=Ae,x.directionalShadowMatrix.length=_e,x.pointShadowMatrix.length=ge,x.spotLightMatrix.length=Ae+ee-$,x.spotLightMap.length=ee,x.numSpotLightShadowsWithMaps=$,Re.directionalLength=ve,Re.pointLength=ce,Re.spotLength=K,Re.rectAreaLength=X,Re.hemiLength=W,Re.numDirectionalShadows=_e,Re.numPointShadows=ge,Re.numSpotShadows=Ae,Re.numSpotMaps=ee,x.version=nextVersion++)}function j(te,Z){let oe=0,le=0,se=0,ve=0,ce=0;const K=Z.matrixWorldInverse;for(let X=0,W=te.length;X<W;X++){const _e=te[X];if(_e.isDirectionalLight){const ge=x.directional[oe];ge.direction.setFromMatrixPosition(_e.matrixWorld),M.setFromMatrixPosition(_e.target.matrixWorld),ge.direction.sub(M),ge.direction.transformDirection(K),oe++}else if(_e.isSpotLight){const ge=x.spot[se];ge.position.setFromMatrixPosition(_e.matrixWorld),ge.position.applyMatrix4(K),ge.direction.setFromMatrixPosition(_e.matrixWorld),M.setFromMatrixPosition(_e.target.matrixWorld),ge.direction.sub(M),ge.direction.transformDirection(K),se++}else if(_e.isRectAreaLight){const ge=x.rectArea[ve];ge.position.setFromMatrixPosition(_e.matrixWorld),ge.position.applyMatrix4(K),B.identity(),I.copy(_e.matrixWorld),I.premultiply(K),B.extractRotation(I),ge.halfWidth.set(_e.width*.5,0,0),ge.halfHeight.set(0,_e.height*.5,0),ge.halfWidth.applyMatrix4(B),ge.halfHeight.applyMatrix4(B),ve++}else if(_e.isPointLight){const ge=x.point[le];ge.position.setFromMatrixPosition(_e.matrixWorld),ge.position.applyMatrix4(K),le++}else if(_e.isHemisphereLight){const ge=x.hemi[ce];ge.direction.setFromMatrixPosition(_e.matrixWorld),ge.direction.transformDirection(K),ce++}}}return{setup:U,setupView:j,state:x}}function WebGLRenderState(u,a){const s=new WebGLLights(u,a),v=[],x=[];function M(){v.length=0,x.length=0}function I(Z){v.push(Z)}function B(Z){x.push(Z)}function U(Z){s.setup(v,Z)}function j(Z){s.setupView(v,Z)}return{init:M,state:{lightsArray:v,shadowsArray:x,lights:s},setupLights:U,setupLightsView:j,pushLight:I,pushShadow:B}}function WebGLRenderStates(u,a){let s=new WeakMap;function v(M,I=0){const B=s.get(M);let U;return B===void 0?(U=new WebGLRenderState(u,a),s.set(M,[U])):I>=B.length?(U=new WebGLRenderState(u,a),B.push(U)):U=B[I],U}function x(){s=new WeakMap}return{get:v,dispose:x}}class MeshDepthMaterial extends Material{constructor(a){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)}copy(a){return super.copy(a),this.depthPacking=a.depthPacking,this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(a){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(a)}copy(a){return super.copy(a),this.map=a.map,this.alphaMap=a.alphaMap,this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(u,a,s){let v=new Frustum;const x=new Vector2,M=new Vector2,I=new Vector4,B=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),U=new MeshDistanceMaterial,j={},te=s.maxTextureSize,Z={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},oe=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),le=oe.clone();le.defines.HORIZONTAL_PASS=1;const se=new BufferGeometry$1;se.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const ve=new Mesh(se,oe),ce=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let K=this.type;this.render=function(ge,Ae,ee){if(ce.enabled===!1||ce.autoUpdate===!1&&ce.needsUpdate===!1||ge.length===0)return;const $=u.getRenderTarget(),ae=u.getActiveCubeFace(),Re=u.getActiveMipmapLevel(),pe=u.state;pe.setBlending(NoBlending),pe.buffers.color.setClear(1,1,1,1),pe.buffers.depth.setTest(!0),pe.setScissorTest(!1);const he=K!==VSMShadowMap&&this.type===VSMShadowMap,we=K===VSMShadowMap&&this.type!==VSMShadowMap;for(let Ce=0,Ne=ge.length;Ce<Ne;Ce++){const Ze=ge[Ce],Ye=Ze.shadow;if(Ye===void 0){console.warn("THREE.WebGLShadowMap:",Ze,"has no shadow.");continue}if(Ye.autoUpdate===!1&&Ye.needsUpdate===!1)continue;x.copy(Ye.mapSize);const it=Ye.getFrameExtents();if(x.multiply(it),M.copy(Ye.mapSize),(x.x>te||x.y>te)&&(x.x>te&&(M.x=Math.floor(te/it.x),x.x=M.x*it.x,Ye.mapSize.x=M.x),x.y>te&&(M.y=Math.floor(te/it.y),x.y=M.y*it.y,Ye.mapSize.y=M.y)),Ye.map===null||he===!0||we===!0){const At=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Ye.map!==null&&Ye.map.dispose(),Ye.map=new WebGLRenderTarget(x.x,x.y,At),Ye.map.texture.name=Ze.name+".shadowMap",Ye.camera.updateProjectionMatrix()}u.setRenderTarget(Ye.map),u.clear();const _t=Ye.getViewportCount();for(let At=0;At<_t;At++){const vt=Ye.getViewport(At);I.set(M.x*vt.x,M.y*vt.y,M.x*vt.z,M.y*vt.w),pe.viewport(I),Ye.updateMatrices(Ze,At),v=Ye.getFrustum(),_e(Ae,ee,Ye.camera,Ze,this.type)}Ye.isPointLightShadow!==!0&&this.type===VSMShadowMap&&X(Ye,ee),Ye.needsUpdate=!1}K=this.type,ce.needsUpdate=!1,u.setRenderTarget($,ae,Re)};function X(ge,Ae){const ee=a.update(ve);oe.defines.VSM_SAMPLES!==ge.blurSamples&&(oe.defines.VSM_SAMPLES=ge.blurSamples,le.defines.VSM_SAMPLES=ge.blurSamples,oe.needsUpdate=!0,le.needsUpdate=!0),ge.mapPass===null&&(ge.mapPass=new WebGLRenderTarget(x.x,x.y)),oe.uniforms.shadow_pass.value=ge.map.texture,oe.uniforms.resolution.value=ge.mapSize,oe.uniforms.radius.value=ge.radius,u.setRenderTarget(ge.mapPass),u.clear(),u.renderBufferDirect(Ae,null,ee,oe,ve,null),le.uniforms.shadow_pass.value=ge.mapPass.texture,le.uniforms.resolution.value=ge.mapSize,le.uniforms.radius.value=ge.radius,u.setRenderTarget(ge.map),u.clear(),u.renderBufferDirect(Ae,null,ee,le,ve,null)}function W(ge,Ae,ee,$){let ae=null;const Re=ee.isPointLight===!0?ge.customDistanceMaterial:ge.customDepthMaterial;if(Re!==void 0)ae=Re;else if(ae=ee.isPointLight===!0?U:B,u.localClippingEnabled&&Ae.clipShadows===!0&&Array.isArray(Ae.clippingPlanes)&&Ae.clippingPlanes.length!==0||Ae.displacementMap&&Ae.displacementScale!==0||Ae.alphaMap&&Ae.alphaTest>0||Ae.map&&Ae.alphaTest>0){const pe=ae.uuid,he=Ae.uuid;let we=j[pe];we===void 0&&(we={},j[pe]=we);let Ce=we[he];Ce===void 0&&(Ce=ae.clone(),we[he]=Ce),ae=Ce}if(ae.visible=Ae.visible,ae.wireframe=Ae.wireframe,$===VSMShadowMap?ae.side=Ae.shadowSide!==null?Ae.shadowSide:Ae.side:ae.side=Ae.shadowSide!==null?Ae.shadowSide:Z[Ae.side],ae.alphaMap=Ae.alphaMap,ae.alphaTest=Ae.alphaTest,ae.map=Ae.map,ae.clipShadows=Ae.clipShadows,ae.clippingPlanes=Ae.clippingPlanes,ae.clipIntersection=Ae.clipIntersection,ae.displacementMap=Ae.displacementMap,ae.displacementScale=Ae.displacementScale,ae.displacementBias=Ae.displacementBias,ae.wireframeLinewidth=Ae.wireframeLinewidth,ae.linewidth=Ae.linewidth,ee.isPointLight===!0&&ae.isMeshDistanceMaterial===!0){const pe=u.properties.get(ae);pe.light=ee}return ae}function _e(ge,Ae,ee,$,ae){if(ge.visible===!1)return;if(ge.layers.test(Ae.layers)&&(ge.isMesh||ge.isLine||ge.isPoints)&&(ge.castShadow||ge.receiveShadow&&ae===VSMShadowMap)&&(!ge.frustumCulled||v.intersectsObject(ge))){ge.modelViewMatrix.multiplyMatrices(ee.matrixWorldInverse,ge.matrixWorld);const he=a.update(ge),we=ge.material;if(Array.isArray(we)){const Ce=he.groups;for(let Ne=0,Ze=Ce.length;Ne<Ze;Ne++){const Ye=Ce[Ne],it=we[Ye.materialIndex];if(it&&it.visible){const _t=W(ge,it,$,ae);u.renderBufferDirect(ee,null,he,_t,ge,Ye)}}}else if(we.visible){const Ce=W(ge,we,$,ae);u.renderBufferDirect(ee,null,he,Ce,ge,null)}}const pe=ge.children;for(let he=0,we=pe.length;he<we;he++)_e(pe[he],Ae,ee,$,ae)}}function WebGLState(u,a,s){const v=s.isWebGL2;function x(){let ze=!1;const yi=new Vector4;let On=null;const si=new Vector4(0,0,0,0);return{setMask:function(di){On!==di&&!ze&&(u.colorMask(di,di,di,di),On=di)},setLocked:function(di){ze=di},setClear:function(di,Mi,is,jr,Xr){Xr===!0&&(di*=jr,Mi*=jr,is*=jr),yi.set(di,Mi,is,jr),si.equals(yi)===!1&&(u.clearColor(di,Mi,is,jr),si.copy(yi))},reset:function(){ze=!1,On=null,si.set(-1,0,0,0)}}}function M(){let ze=!1,yi=null,On=null,si=null;return{setTest:function(di){di?bt(u.DEPTH_TEST):sn(u.DEPTH_TEST)},setMask:function(di){yi!==di&&!ze&&(u.depthMask(di),yi=di)},setFunc:function(di){if(On!==di){switch(di){case NeverDepth:u.depthFunc(u.NEVER);break;case AlwaysDepth:u.depthFunc(u.ALWAYS);break;case LessDepth:u.depthFunc(u.LESS);break;case LessEqualDepth:u.depthFunc(u.LEQUAL);break;case EqualDepth:u.depthFunc(u.EQUAL);break;case GreaterEqualDepth:u.depthFunc(u.GEQUAL);break;case GreaterDepth:u.depthFunc(u.GREATER);break;case NotEqualDepth:u.depthFunc(u.NOTEQUAL);break;default:u.depthFunc(u.LEQUAL)}On=di}},setLocked:function(di){ze=di},setClear:function(di){si!==di&&(u.clearDepth(di),si=di)},reset:function(){ze=!1,yi=null,On=null,si=null}}}function I(){let ze=!1,yi=null,On=null,si=null,di=null,Mi=null,is=null,jr=null,Xr=null;return{setTest:function(cs){ze||(cs?bt(u.STENCIL_TEST):sn(u.STENCIL_TEST))},setMask:function(cs){yi!==cs&&!ze&&(u.stencilMask(cs),yi=cs)},setFunc:function(cs,ys,Zr){(On!==cs||si!==ys||di!==Zr)&&(u.stencilFunc(cs,ys,Zr),On=cs,si=ys,di=Zr)},setOp:function(cs,ys,Zr){(Mi!==cs||is!==ys||jr!==Zr)&&(u.stencilOp(cs,ys,Zr),Mi=cs,is=ys,jr=Zr)},setLocked:function(cs){ze=cs},setClear:function(cs){Xr!==cs&&(u.clearStencil(cs),Xr=cs)},reset:function(){ze=!1,yi=null,On=null,si=null,di=null,Mi=null,is=null,jr=null,Xr=null}}}const B=new x,U=new M,j=new I,te=new WeakMap,Z=new WeakMap;let oe={},le={},se=new WeakMap,ve=[],ce=null,K=!1,X=null,W=null,_e=null,ge=null,Ae=null,ee=null,$=null,ae=!1,Re=null,pe=null,he=null,we=null,Ce=null;const Ne=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Ze=!1,Ye=0;const it=u.getParameter(u.VERSION);it.indexOf("WebGL")!==-1?(Ye=parseFloat(/^WebGL (\d)/.exec(it)[1]),Ze=Ye>=1):it.indexOf("OpenGL ES")!==-1&&(Ye=parseFloat(/^OpenGL ES (\d)/.exec(it)[1]),Ze=Ye>=2);let _t=null,At={};const vt=u.getParameter(u.SCISSOR_BOX),ut=u.getParameter(u.VIEWPORT),Nt=new Vector4().fromArray(vt),Qt=new Vector4().fromArray(ut);function Qe(ze,yi,On,si){const di=new Uint8Array(4),Mi=u.createTexture();u.bindTexture(ze,Mi),u.texParameteri(ze,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(ze,u.TEXTURE_MAG_FILTER,u.NEAREST);for(let is=0;is<On;is++)v&&(ze===u.TEXTURE_3D||ze===u.TEXTURE_2D_ARRAY)?u.texImage3D(yi,0,u.RGBA,1,1,si,0,u.RGBA,u.UNSIGNED_BYTE,di):u.texImage2D(yi+is,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,di);return Mi}const ft={};ft[u.TEXTURE_2D]=Qe(u.TEXTURE_2D,u.TEXTURE_2D,1),ft[u.TEXTURE_CUBE_MAP]=Qe(u.TEXTURE_CUBE_MAP,u.TEXTURE_CUBE_MAP_POSITIVE_X,6),v&&(ft[u.TEXTURE_2D_ARRAY]=Qe(u.TEXTURE_2D_ARRAY,u.TEXTURE_2D_ARRAY,1,1),ft[u.TEXTURE_3D]=Qe(u.TEXTURE_3D,u.TEXTURE_3D,1,1)),B.setClear(0,0,0,1),U.setClear(1),j.setClear(0),bt(u.DEPTH_TEST),U.setFunc(LessEqualDepth),pn(!1),Pn(CullFaceBack),bt(u.CULL_FACE),tn(NoBlending);function bt(ze){oe[ze]!==!0&&(u.enable(ze),oe[ze]=!0)}function sn(ze){oe[ze]!==!1&&(u.disable(ze),oe[ze]=!1)}function bn(ze,yi){return le[ze]!==yi?(u.bindFramebuffer(ze,yi),le[ze]=yi,v&&(ze===u.DRAW_FRAMEBUFFER&&(le[u.FRAMEBUFFER]=yi),ze===u.FRAMEBUFFER&&(le[u.DRAW_FRAMEBUFFER]=yi)),!0):!1}function Un(ze,yi){let On=ve,si=!1;if(ze)if(On=se.get(yi),On===void 0&&(On=[],se.set(yi,On)),ze.isWebGLMultipleRenderTargets){const di=ze.texture;if(On.length!==di.length||On[0]!==u.COLOR_ATTACHMENT0){for(let Mi=0,is=di.length;Mi<is;Mi++)On[Mi]=u.COLOR_ATTACHMENT0+Mi;On.length=di.length,si=!0}}else On[0]!==u.COLOR_ATTACHMENT0&&(On[0]=u.COLOR_ATTACHMENT0,si=!0);else On[0]!==u.BACK&&(On[0]=u.BACK,si=!0);si&&(s.isWebGL2?u.drawBuffers(On):a.get("WEBGL_draw_buffers").drawBuffersWEBGL(On))}function pi(ze){return ce!==ze?(u.useProgram(ze),ce=ze,!0):!1}const Xe={[AddEquation]:u.FUNC_ADD,[SubtractEquation]:u.FUNC_SUBTRACT,[ReverseSubtractEquation]:u.FUNC_REVERSE_SUBTRACT};if(v)Xe[MinEquation]=u.MIN,Xe[MaxEquation]=u.MAX;else{const ze=a.get("EXT_blend_minmax");ze!==null&&(Xe[MinEquation]=ze.MIN_EXT,Xe[MaxEquation]=ze.MAX_EXT)}const Xt={[ZeroFactor]:u.ZERO,[OneFactor]:u.ONE,[SrcColorFactor]:u.SRC_COLOR,[SrcAlphaFactor]:u.SRC_ALPHA,[SrcAlphaSaturateFactor]:u.SRC_ALPHA_SATURATE,[DstColorFactor]:u.DST_COLOR,[DstAlphaFactor]:u.DST_ALPHA,[OneMinusSrcColorFactor]:u.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:u.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:u.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:u.ONE_MINUS_DST_ALPHA};function tn(ze,yi,On,si,di,Mi,is,jr){if(ze===NoBlending){K===!0&&(sn(u.BLEND),K=!1);return}if(K===!1&&(bt(u.BLEND),K=!0),ze!==CustomBlending){if(ze!==X||jr!==ae){if((W!==AddEquation||Ae!==AddEquation)&&(u.blendEquation(u.FUNC_ADD),W=AddEquation,Ae=AddEquation),jr)switch(ze){case NormalBlending:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.ONE,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}else switch(ze){case NormalBlending:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case SubtractiveBlending:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case MultiplyBlending:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ze);break}_e=null,ge=null,ee=null,$=null,X=ze,ae=jr}return}di=di||yi,Mi=Mi||On,is=is||si,(yi!==W||di!==Ae)&&(u.blendEquationSeparate(Xe[yi],Xe[di]),W=yi,Ae=di),(On!==_e||si!==ge||Mi!==ee||is!==$)&&(u.blendFuncSeparate(Xt[On],Xt[si],Xt[Mi],Xt[is]),_e=On,ge=si,ee=Mi,$=is),X=ze,ae=!1}function dn(ze,yi){ze.side===DoubleSide?sn(u.CULL_FACE):bt(u.CULL_FACE);let On=ze.side===BackSide;yi&&(On=!On),pn(On),ze.blending===NormalBlending&&ze.transparent===!1?tn(NoBlending):tn(ze.blending,ze.blendEquation,ze.blendSrc,ze.blendDst,ze.blendEquationAlpha,ze.blendSrcAlpha,ze.blendDstAlpha,ze.premultipliedAlpha),U.setFunc(ze.depthFunc),U.setTest(ze.depthTest),U.setMask(ze.depthWrite),B.setMask(ze.colorWrite);const si=ze.stencilWrite;j.setTest(si),si&&(j.setMask(ze.stencilWriteMask),j.setFunc(ze.stencilFunc,ze.stencilRef,ze.stencilFuncMask),j.setOp(ze.stencilFail,ze.stencilZFail,ze.stencilZPass)),vn(ze.polygonOffset,ze.polygonOffsetFactor,ze.polygonOffsetUnits),ze.alphaToCoverage===!0?bt(u.SAMPLE_ALPHA_TO_COVERAGE):sn(u.SAMPLE_ALPHA_TO_COVERAGE)}function pn(ze){Re!==ze&&(ze?u.frontFace(u.CW):u.frontFace(u.CCW),Re=ze)}function Pn(ze){ze!==CullFaceNone?(bt(u.CULL_FACE),ze!==pe&&(ze===CullFaceBack?u.cullFace(u.BACK):ze===CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK))):sn(u.CULL_FACE),pe=ze}function Cn(ze){ze!==he&&(Ze&&u.lineWidth(ze),he=ze)}function vn(ze,yi,On){ze?(bt(u.POLYGON_OFFSET_FILL),(we!==yi||Ce!==On)&&(u.polygonOffset(yi,On),we=yi,Ce=On)):sn(u.POLYGON_OFFSET_FILL)}function In(ze){ze?bt(u.SCISSOR_TEST):sn(u.SCISSOR_TEST)}function Fn(ze){ze===void 0&&(ze=u.TEXTURE0+Ne-1),_t!==ze&&(u.activeTexture(ze),_t=ze)}function Hn(ze,yi,On){On===void 0&&(_t===null?On=u.TEXTURE0+Ne-1:On=_t);let si=At[On];si===void 0&&(si={type:void 0,texture:void 0},At[On]=si),(si.type!==ze||si.texture!==yi)&&(_t!==On&&(u.activeTexture(On),_t=On),u.bindTexture(ze,yi||ft[ze]),si.type=ze,si.texture=yi)}function fe(){const ze=At[_t];ze!==void 0&&ze.type!==void 0&&(u.bindTexture(ze.type,null),ze.type=void 0,ze.texture=void 0)}function Se(){try{u.compressedTexImage2D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Ve(){try{u.compressedTexImage3D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function We(){try{u.texSubImage2D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function pt(){try{u.texSubImage3D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function It(){try{u.compressedTexSubImage2D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function $t(){try{u.compressedTexSubImage3D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function nn(){try{u.texStorage2D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Ht(){try{u.texStorage3D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Wn(){try{u.texImage2D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Ln(){try{u.texImage3D.apply(u,arguments)}catch(ze){console.error("THREE.WebGLState:",ze)}}function Qn(ze){Nt.equals(ze)===!1&&(u.scissor(ze.x,ze.y,ze.z,ze.w),Nt.copy(ze))}function Nn(ze){Qt.equals(ze)===!1&&(u.viewport(ze.x,ze.y,ze.z,ze.w),Qt.copy(ze))}function Zn(ze,yi){let On=Z.get(yi);On===void 0&&(On=new WeakMap,Z.set(yi,On));let si=On.get(ze);si===void 0&&(si=u.getUniformBlockIndex(yi,ze.name),On.set(ze,si))}function Qi(ze,yi){const si=Z.get(yi).get(ze);te.get(yi)!==si&&(u.uniformBlockBinding(yi,si,ze.__bindingPointIndex),te.set(yi,si))}function Mr(){u.disable(u.BLEND),u.disable(u.CULL_FACE),u.disable(u.DEPTH_TEST),u.disable(u.POLYGON_OFFSET_FILL),u.disable(u.SCISSOR_TEST),u.disable(u.STENCIL_TEST),u.disable(u.SAMPLE_ALPHA_TO_COVERAGE),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ONE,u.ZERO),u.blendFuncSeparate(u.ONE,u.ZERO,u.ONE,u.ZERO),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(u.LESS),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(u.ALWAYS,0,4294967295),u.stencilOp(u.KEEP,u.KEEP,u.KEEP),u.clearStencil(0),u.cullFace(u.BACK),u.frontFace(u.CCW),u.polygonOffset(0,0),u.activeTexture(u.TEXTURE0),u.bindFramebuffer(u.FRAMEBUFFER,null),v===!0&&(u.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),u.bindFramebuffer(u.READ_FRAMEBUFFER,null)),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),oe={},_t=null,At={},le={},se=new WeakMap,ve=[],ce=null,K=!1,X=null,W=null,_e=null,ge=null,Ae=null,ee=null,$=null,ae=!1,Re=null,pe=null,he=null,we=null,Ce=null,Nt.set(0,0,u.canvas.width,u.canvas.height),Qt.set(0,0,u.canvas.width,u.canvas.height),B.reset(),U.reset(),j.reset()}return{buffers:{color:B,depth:U,stencil:j},enable:bt,disable:sn,bindFramebuffer:bn,drawBuffers:Un,useProgram:pi,setBlending:tn,setMaterial:dn,setFlipSided:pn,setCullFace:Pn,setLineWidth:Cn,setPolygonOffset:vn,setScissorTest:In,activeTexture:Fn,bindTexture:Hn,unbindTexture:fe,compressedTexImage2D:Se,compressedTexImage3D:Ve,texImage2D:Wn,texImage3D:Ln,updateUBOMapping:Zn,uniformBlockBinding:Qi,texStorage2D:nn,texStorage3D:Ht,texSubImage2D:We,texSubImage3D:pt,compressedTexSubImage2D:It,compressedTexSubImage3D:$t,scissor:Qn,viewport:Nn,reset:Mr}}function WebGLTextures(u,a,s,v,x,M,I){const B=x.isWebGL2,U=x.maxTextures,j=x.maxCubemapSize,te=x.maxTextureSize,Z=x.maxSamples,oe=a.has("WEBGL_multisampled_render_to_texture")?a.get("WEBGL_multisampled_render_to_texture"):null,le=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),se=new WeakMap;let ve;const ce=new WeakMap;let K=!1;try{K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function X(fe,Se){return K?new OffscreenCanvas(fe,Se):createElementNS("canvas")}function W(fe,Se,Ve,We){let pt=1;if((fe.width>We||fe.height>We)&&(pt=We/Math.max(fe.width,fe.height)),pt<1||Se===!0)if(typeof HTMLImageElement<"u"&&fe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&fe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&fe instanceof ImageBitmap){const It=Se?floorPowerOfTwo:Math.floor,$t=It(pt*fe.width),nn=It(pt*fe.height);ve===void 0&&(ve=X($t,nn));const Ht=Ve?X($t,nn):ve;return Ht.width=$t,Ht.height=nn,Ht.getContext("2d").drawImage(fe,0,0,$t,nn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+fe.width+"x"+fe.height+") to ("+$t+"x"+nn+")."),Ht}else return"data"in fe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+fe.width+"x"+fe.height+")."),fe;return fe}function _e(fe){return isPowerOfTwo(fe.width)&&isPowerOfTwo(fe.height)}function ge(fe){return B?!1:fe.wrapS!==ClampToEdgeWrapping||fe.wrapT!==ClampToEdgeWrapping||fe.minFilter!==NearestFilter&&fe.minFilter!==LinearFilter}function Ae(fe,Se){return fe.generateMipmaps&&Se&&fe.minFilter!==NearestFilter&&fe.minFilter!==LinearFilter}function ee(fe){u.generateMipmap(fe)}function $(fe,Se,Ve,We,pt=!1){if(B===!1)return Se;if(fe!==null){if(u[fe]!==void 0)return u[fe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+fe+"'")}let It=Se;return Se===u.RED&&(Ve===u.FLOAT&&(It=u.R32F),Ve===u.HALF_FLOAT&&(It=u.R16F),Ve===u.UNSIGNED_BYTE&&(It=u.R8)),Se===u.RED_INTEGER&&(Ve===u.UNSIGNED_BYTE&&(It=u.R8UI),Ve===u.UNSIGNED_SHORT&&(It=u.R16UI),Ve===u.UNSIGNED_INT&&(It=u.R32UI),Ve===u.BYTE&&(It=u.R8I),Ve===u.SHORT&&(It=u.R16I),Ve===u.INT&&(It=u.R32I)),Se===u.RG&&(Ve===u.FLOAT&&(It=u.RG32F),Ve===u.HALF_FLOAT&&(It=u.RG16F),Ve===u.UNSIGNED_BYTE&&(It=u.RG8)),Se===u.RGBA&&(Ve===u.FLOAT&&(It=u.RGBA32F),Ve===u.HALF_FLOAT&&(It=u.RGBA16F),Ve===u.UNSIGNED_BYTE&&(It=We===SRGBColorSpace&&pt===!1?u.SRGB8_ALPHA8:u.RGBA8),Ve===u.UNSIGNED_SHORT_4_4_4_4&&(It=u.RGBA4),Ve===u.UNSIGNED_SHORT_5_5_5_1&&(It=u.RGB5_A1)),(It===u.R16F||It===u.R32F||It===u.RG16F||It===u.RG32F||It===u.RGBA16F||It===u.RGBA32F)&&a.get("EXT_color_buffer_float"),It}function ae(fe,Se,Ve){return Ae(fe,Ve)===!0||fe.isFramebufferTexture&&fe.minFilter!==NearestFilter&&fe.minFilter!==LinearFilter?Math.log2(Math.max(Se.width,Se.height))+1:fe.mipmaps!==void 0&&fe.mipmaps.length>0?fe.mipmaps.length:fe.isCompressedTexture&&Array.isArray(fe.image)?Se.mipmaps.length:1}function Re(fe){return fe===NearestFilter||fe===NearestMipmapNearestFilter||fe===NearestMipmapLinearFilter?u.NEAREST:u.LINEAR}function pe(fe){const Se=fe.target;Se.removeEventListener("dispose",pe),we(Se),Se.isVideoTexture&&se.delete(Se)}function he(fe){const Se=fe.target;Se.removeEventListener("dispose",he),Ne(Se)}function we(fe){const Se=v.get(fe);if(Se.__webglInit===void 0)return;const Ve=fe.source,We=ce.get(Ve);if(We){const pt=We[Se.__cacheKey];pt.usedTimes--,pt.usedTimes===0&&Ce(fe),Object.keys(We).length===0&&ce.delete(Ve)}v.remove(fe)}function Ce(fe){const Se=v.get(fe);u.deleteTexture(Se.__webglTexture);const Ve=fe.source,We=ce.get(Ve);delete We[Se.__cacheKey],I.memory.textures--}function Ne(fe){const Se=fe.texture,Ve=v.get(fe),We=v.get(Se);if(We.__webglTexture!==void 0&&(u.deleteTexture(We.__webglTexture),I.memory.textures--),fe.depthTexture&&fe.depthTexture.dispose(),fe.isWebGLCubeRenderTarget)for(let pt=0;pt<6;pt++){if(Array.isArray(Ve.__webglFramebuffer[pt]))for(let It=0;It<Ve.__webglFramebuffer[pt].length;It++)u.deleteFramebuffer(Ve.__webglFramebuffer[pt][It]);else u.deleteFramebuffer(Ve.__webglFramebuffer[pt]);Ve.__webglDepthbuffer&&u.deleteRenderbuffer(Ve.__webglDepthbuffer[pt])}else{if(Array.isArray(Ve.__webglFramebuffer))for(let pt=0;pt<Ve.__webglFramebuffer.length;pt++)u.deleteFramebuffer(Ve.__webglFramebuffer[pt]);else u.deleteFramebuffer(Ve.__webglFramebuffer);if(Ve.__webglDepthbuffer&&u.deleteRenderbuffer(Ve.__webglDepthbuffer),Ve.__webglMultisampledFramebuffer&&u.deleteFramebuffer(Ve.__webglMultisampledFramebuffer),Ve.__webglColorRenderbuffer)for(let pt=0;pt<Ve.__webglColorRenderbuffer.length;pt++)Ve.__webglColorRenderbuffer[pt]&&u.deleteRenderbuffer(Ve.__webglColorRenderbuffer[pt]);Ve.__webglDepthRenderbuffer&&u.deleteRenderbuffer(Ve.__webglDepthRenderbuffer)}if(fe.isWebGLMultipleRenderTargets)for(let pt=0,It=Se.length;pt<It;pt++){const $t=v.get(Se[pt]);$t.__webglTexture&&(u.deleteTexture($t.__webglTexture),I.memory.textures--),v.remove(Se[pt])}v.remove(Se),v.remove(fe)}let Ze=0;function Ye(){Ze=0}function it(){const fe=Ze;return fe>=U&&console.warn("THREE.WebGLTextures: Trying to use "+fe+" texture units while this GPU supports only "+U),Ze+=1,fe}function _t(fe){const Se=[];return Se.push(fe.wrapS),Se.push(fe.wrapT),Se.push(fe.wrapR||0),Se.push(fe.magFilter),Se.push(fe.minFilter),Se.push(fe.anisotropy),Se.push(fe.internalFormat),Se.push(fe.format),Se.push(fe.type),Se.push(fe.generateMipmaps),Se.push(fe.premultiplyAlpha),Se.push(fe.flipY),Se.push(fe.unpackAlignment),Se.push(fe.colorSpace),Se.join()}function At(fe,Se){const Ve=v.get(fe);if(fe.isVideoTexture&&Fn(fe),fe.isRenderTargetTexture===!1&&fe.version>0&&Ve.__version!==fe.version){const We=fe.image;if(We===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(We.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{bn(Ve,fe,Se);return}}s.bindTexture(u.TEXTURE_2D,Ve.__webglTexture,u.TEXTURE0+Se)}function vt(fe,Se){const Ve=v.get(fe);if(fe.version>0&&Ve.__version!==fe.version){bn(Ve,fe,Se);return}s.bindTexture(u.TEXTURE_2D_ARRAY,Ve.__webglTexture,u.TEXTURE0+Se)}function ut(fe,Se){const Ve=v.get(fe);if(fe.version>0&&Ve.__version!==fe.version){bn(Ve,fe,Se);return}s.bindTexture(u.TEXTURE_3D,Ve.__webglTexture,u.TEXTURE0+Se)}function Nt(fe,Se){const Ve=v.get(fe);if(fe.version>0&&Ve.__version!==fe.version){Un(Ve,fe,Se);return}s.bindTexture(u.TEXTURE_CUBE_MAP,Ve.__webglTexture,u.TEXTURE0+Se)}const Qt={[RepeatWrapping]:u.REPEAT,[ClampToEdgeWrapping]:u.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:u.MIRRORED_REPEAT},Qe={[NearestFilter]:u.NEAREST,[NearestMipmapNearestFilter]:u.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:u.NEAREST_MIPMAP_LINEAR,[LinearFilter]:u.LINEAR,[LinearMipmapNearestFilter]:u.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:u.LINEAR_MIPMAP_LINEAR},ft={[NeverCompare]:u.NEVER,[AlwaysCompare]:u.ALWAYS,[LessCompare]:u.LESS,[LessEqualCompare]:u.LEQUAL,[EqualCompare]:u.EQUAL,[GreaterEqualCompare]:u.GEQUAL,[GreaterCompare]:u.GREATER,[NotEqualCompare]:u.NOTEQUAL};function bt(fe,Se,Ve){if(Ve?(u.texParameteri(fe,u.TEXTURE_WRAP_S,Qt[Se.wrapS]),u.texParameteri(fe,u.TEXTURE_WRAP_T,Qt[Se.wrapT]),(fe===u.TEXTURE_3D||fe===u.TEXTURE_2D_ARRAY)&&u.texParameteri(fe,u.TEXTURE_WRAP_R,Qt[Se.wrapR]),u.texParameteri(fe,u.TEXTURE_MAG_FILTER,Qe[Se.magFilter]),u.texParameteri(fe,u.TEXTURE_MIN_FILTER,Qe[Se.minFilter])):(u.texParameteri(fe,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(fe,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),(fe===u.TEXTURE_3D||fe===u.TEXTURE_2D_ARRAY)&&u.texParameteri(fe,u.TEXTURE_WRAP_R,u.CLAMP_TO_EDGE),(Se.wrapS!==ClampToEdgeWrapping||Se.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),u.texParameteri(fe,u.TEXTURE_MAG_FILTER,Re(Se.magFilter)),u.texParameteri(fe,u.TEXTURE_MIN_FILTER,Re(Se.minFilter)),Se.minFilter!==NearestFilter&&Se.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Se.compareFunction&&(u.texParameteri(fe,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.texParameteri(fe,u.TEXTURE_COMPARE_FUNC,ft[Se.compareFunction])),a.has("EXT_texture_filter_anisotropic")===!0){const We=a.get("EXT_texture_filter_anisotropic");if(Se.magFilter===NearestFilter||Se.minFilter!==NearestMipmapLinearFilter&&Se.minFilter!==LinearMipmapLinearFilter||Se.type===FloatType&&a.has("OES_texture_float_linear")===!1||B===!1&&Se.type===HalfFloatType&&a.has("OES_texture_half_float_linear")===!1)return;(Se.anisotropy>1||v.get(Se).__currentAnisotropy)&&(u.texParameterf(fe,We.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Se.anisotropy,x.getMaxAnisotropy())),v.get(Se).__currentAnisotropy=Se.anisotropy)}}function sn(fe,Se){let Ve=!1;fe.__webglInit===void 0&&(fe.__webglInit=!0,Se.addEventListener("dispose",pe));const We=Se.source;let pt=ce.get(We);pt===void 0&&(pt={},ce.set(We,pt));const It=_t(Se);if(It!==fe.__cacheKey){pt[It]===void 0&&(pt[It]={texture:u.createTexture(),usedTimes:0},I.memory.textures++,Ve=!0),pt[It].usedTimes++;const $t=pt[fe.__cacheKey];$t!==void 0&&(pt[fe.__cacheKey].usedTimes--,$t.usedTimes===0&&Ce(Se)),fe.__cacheKey=It,fe.__webglTexture=pt[It].texture}return Ve}function bn(fe,Se,Ve){let We=u.TEXTURE_2D;(Se.isDataArrayTexture||Se.isCompressedArrayTexture)&&(We=u.TEXTURE_2D_ARRAY),Se.isData3DTexture&&(We=u.TEXTURE_3D);const pt=sn(fe,Se),It=Se.source;s.bindTexture(We,fe.__webglTexture,u.TEXTURE0+Ve);const $t=v.get(It);if(It.version!==$t.__version||pt===!0){s.activeTexture(u.TEXTURE0+Ve),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,Se.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,Se.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,u.NONE);const nn=ge(Se)&&_e(Se.image)===!1;let Ht=W(Se.image,nn,!1,te);Ht=Hn(Se,Ht);const Wn=_e(Ht)||B,Ln=M.convert(Se.format,Se.colorSpace);let Qn=M.convert(Se.type),Nn=$(Se.internalFormat,Ln,Qn,Se.colorSpace);bt(We,Se,Wn);let Zn;const Qi=Se.mipmaps,Mr=B&&Se.isVideoTexture!==!0,ze=$t.__version===void 0||pt===!0,yi=ae(Se,Ht,Wn);if(Se.isDepthTexture)Nn=u.DEPTH_COMPONENT,B?Se.type===FloatType?Nn=u.DEPTH_COMPONENT32F:Se.type===UnsignedIntType?Nn=u.DEPTH_COMPONENT24:Se.type===UnsignedInt248Type?Nn=u.DEPTH24_STENCIL8:Nn=u.DEPTH_COMPONENT16:Se.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Se.format===DepthFormat&&Nn===u.DEPTH_COMPONENT&&Se.type!==UnsignedShortType&&Se.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Se.type=UnsignedIntType,Qn=M.convert(Se.type)),Se.format===DepthStencilFormat&&Nn===u.DEPTH_COMPONENT&&(Nn=u.DEPTH_STENCIL,Se.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Se.type=UnsignedInt248Type,Qn=M.convert(Se.type))),ze&&(Mr?s.texStorage2D(u.TEXTURE_2D,1,Nn,Ht.width,Ht.height):s.texImage2D(u.TEXTURE_2D,0,Nn,Ht.width,Ht.height,0,Ln,Qn,null));else if(Se.isDataTexture)if(Qi.length>0&&Wn){Mr&&ze&&s.texStorage2D(u.TEXTURE_2D,yi,Nn,Qi[0].width,Qi[0].height);for(let On=0,si=Qi.length;On<si;On++)Zn=Qi[On],Mr?s.texSubImage2D(u.TEXTURE_2D,On,0,0,Zn.width,Zn.height,Ln,Qn,Zn.data):s.texImage2D(u.TEXTURE_2D,On,Nn,Zn.width,Zn.height,0,Ln,Qn,Zn.data);Se.generateMipmaps=!1}else Mr?(ze&&s.texStorage2D(u.TEXTURE_2D,yi,Nn,Ht.width,Ht.height),s.texSubImage2D(u.TEXTURE_2D,0,0,0,Ht.width,Ht.height,Ln,Qn,Ht.data)):s.texImage2D(u.TEXTURE_2D,0,Nn,Ht.width,Ht.height,0,Ln,Qn,Ht.data);else if(Se.isCompressedTexture)if(Se.isCompressedArrayTexture){Mr&&ze&&s.texStorage3D(u.TEXTURE_2D_ARRAY,yi,Nn,Qi[0].width,Qi[0].height,Ht.depth);for(let On=0,si=Qi.length;On<si;On++)Zn=Qi[On],Se.format!==RGBAFormat?Ln!==null?Mr?s.compressedTexSubImage3D(u.TEXTURE_2D_ARRAY,On,0,0,0,Zn.width,Zn.height,Ht.depth,Ln,Zn.data,0,0):s.compressedTexImage3D(u.TEXTURE_2D_ARRAY,On,Nn,Zn.width,Zn.height,Ht.depth,0,Zn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Mr?s.texSubImage3D(u.TEXTURE_2D_ARRAY,On,0,0,0,Zn.width,Zn.height,Ht.depth,Ln,Qn,Zn.data):s.texImage3D(u.TEXTURE_2D_ARRAY,On,Nn,Zn.width,Zn.height,Ht.depth,0,Ln,Qn,Zn.data)}else{Mr&&ze&&s.texStorage2D(u.TEXTURE_2D,yi,Nn,Qi[0].width,Qi[0].height);for(let On=0,si=Qi.length;On<si;On++)Zn=Qi[On],Se.format!==RGBAFormat?Ln!==null?Mr?s.compressedTexSubImage2D(u.TEXTURE_2D,On,0,0,Zn.width,Zn.height,Ln,Zn.data):s.compressedTexImage2D(u.TEXTURE_2D,On,Nn,Zn.width,Zn.height,0,Zn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Mr?s.texSubImage2D(u.TEXTURE_2D,On,0,0,Zn.width,Zn.height,Ln,Qn,Zn.data):s.texImage2D(u.TEXTURE_2D,On,Nn,Zn.width,Zn.height,0,Ln,Qn,Zn.data)}else if(Se.isDataArrayTexture)Mr?(ze&&s.texStorage3D(u.TEXTURE_2D_ARRAY,yi,Nn,Ht.width,Ht.height,Ht.depth),s.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,0,Ht.width,Ht.height,Ht.depth,Ln,Qn,Ht.data)):s.texImage3D(u.TEXTURE_2D_ARRAY,0,Nn,Ht.width,Ht.height,Ht.depth,0,Ln,Qn,Ht.data);else if(Se.isData3DTexture)Mr?(ze&&s.texStorage3D(u.TEXTURE_3D,yi,Nn,Ht.width,Ht.height,Ht.depth),s.texSubImage3D(u.TEXTURE_3D,0,0,0,0,Ht.width,Ht.height,Ht.depth,Ln,Qn,Ht.data)):s.texImage3D(u.TEXTURE_3D,0,Nn,Ht.width,Ht.height,Ht.depth,0,Ln,Qn,Ht.data);else if(Se.isFramebufferTexture){if(ze)if(Mr)s.texStorage2D(u.TEXTURE_2D,yi,Nn,Ht.width,Ht.height);else{let On=Ht.width,si=Ht.height;for(let di=0;di<yi;di++)s.texImage2D(u.TEXTURE_2D,di,Nn,On,si,0,Ln,Qn,null),On>>=1,si>>=1}}else if(Qi.length>0&&Wn){Mr&&ze&&s.texStorage2D(u.TEXTURE_2D,yi,Nn,Qi[0].width,Qi[0].height);for(let On=0,si=Qi.length;On<si;On++)Zn=Qi[On],Mr?s.texSubImage2D(u.TEXTURE_2D,On,0,0,Ln,Qn,Zn):s.texImage2D(u.TEXTURE_2D,On,Nn,Ln,Qn,Zn);Se.generateMipmaps=!1}else Mr?(ze&&s.texStorage2D(u.TEXTURE_2D,yi,Nn,Ht.width,Ht.height),s.texSubImage2D(u.TEXTURE_2D,0,0,0,Ln,Qn,Ht)):s.texImage2D(u.TEXTURE_2D,0,Nn,Ln,Qn,Ht);Ae(Se,Wn)&&ee(We),$t.__version=It.version,Se.onUpdate&&Se.onUpdate(Se)}fe.__version=Se.version}function Un(fe,Se,Ve){if(Se.image.length!==6)return;const We=sn(fe,Se),pt=Se.source;s.bindTexture(u.TEXTURE_CUBE_MAP,fe.__webglTexture,u.TEXTURE0+Ve);const It=v.get(pt);if(pt.version!==It.__version||We===!0){s.activeTexture(u.TEXTURE0+Ve),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,Se.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,Se.unpackAlignment),u.pixelStorei(u.UNPACK_COLORSPACE_CONVERSION_WEBGL,u.NONE);const $t=Se.isCompressedTexture||Se.image[0].isCompressedTexture,nn=Se.image[0]&&Se.image[0].isDataTexture,Ht=[];for(let On=0;On<6;On++)!$t&&!nn?Ht[On]=W(Se.image[On],!1,!0,j):Ht[On]=nn?Se.image[On].image:Se.image[On],Ht[On]=Hn(Se,Ht[On]);const Wn=Ht[0],Ln=_e(Wn)||B,Qn=M.convert(Se.format,Se.colorSpace),Nn=M.convert(Se.type),Zn=$(Se.internalFormat,Qn,Nn,Se.colorSpace),Qi=B&&Se.isVideoTexture!==!0,Mr=It.__version===void 0||We===!0;let ze=ae(Se,Wn,Ln);bt(u.TEXTURE_CUBE_MAP,Se,Ln);let yi;if($t){Qi&&Mr&&s.texStorage2D(u.TEXTURE_CUBE_MAP,ze,Zn,Wn.width,Wn.height);for(let On=0;On<6;On++){yi=Ht[On].mipmaps;for(let si=0;si<yi.length;si++){const di=yi[si];Se.format!==RGBAFormat?Qn!==null?Qi?s.compressedTexSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si,0,0,di.width,di.height,Qn,di.data):s.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si,Zn,di.width,di.height,0,di.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Qi?s.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si,0,0,di.width,di.height,Qn,Nn,di.data):s.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si,Zn,di.width,di.height,0,Qn,Nn,di.data)}}}else{yi=Se.mipmaps,Qi&&Mr&&(yi.length>0&&ze++,s.texStorage2D(u.TEXTURE_CUBE_MAP,ze,Zn,Ht[0].width,Ht[0].height));for(let On=0;On<6;On++)if(nn){Qi?s.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,0,0,0,Ht[On].width,Ht[On].height,Qn,Nn,Ht[On].data):s.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,0,Zn,Ht[On].width,Ht[On].height,0,Qn,Nn,Ht[On].data);for(let si=0;si<yi.length;si++){const Mi=yi[si].image[On].image;Qi?s.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si+1,0,0,Mi.width,Mi.height,Qn,Nn,Mi.data):s.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si+1,Zn,Mi.width,Mi.height,0,Qn,Nn,Mi.data)}}else{Qi?s.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,0,0,0,Qn,Nn,Ht[On]):s.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,0,Zn,Qn,Nn,Ht[On]);for(let si=0;si<yi.length;si++){const di=yi[si];Qi?s.texSubImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si+1,0,0,Qn,Nn,di.image[On]):s.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+On,si+1,Zn,Qn,Nn,di.image[On])}}}Ae(Se,Ln)&&ee(u.TEXTURE_CUBE_MAP),It.__version=pt.version,Se.onUpdate&&Se.onUpdate(Se)}fe.__version=Se.version}function pi(fe,Se,Ve,We,pt,It){const $t=M.convert(Ve.format,Ve.colorSpace),nn=M.convert(Ve.type),Ht=$(Ve.internalFormat,$t,nn,Ve.colorSpace);if(!v.get(Se).__hasExternalTextures){const Ln=Math.max(1,Se.width>>It),Qn=Math.max(1,Se.height>>It);pt===u.TEXTURE_3D||pt===u.TEXTURE_2D_ARRAY?s.texImage3D(pt,It,Ht,Ln,Qn,Se.depth,0,$t,nn,null):s.texImage2D(pt,It,Ht,Ln,Qn,0,$t,nn,null)}s.bindFramebuffer(u.FRAMEBUFFER,fe),In(Se)?oe.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,We,pt,v.get(Ve).__webglTexture,0,vn(Se)):(pt===u.TEXTURE_2D||pt>=u.TEXTURE_CUBE_MAP_POSITIVE_X&&pt<=u.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&u.framebufferTexture2D(u.FRAMEBUFFER,We,pt,v.get(Ve).__webglTexture,It),s.bindFramebuffer(u.FRAMEBUFFER,null)}function Xe(fe,Se,Ve){if(u.bindRenderbuffer(u.RENDERBUFFER,fe),Se.depthBuffer&&!Se.stencilBuffer){let We=u.DEPTH_COMPONENT16;if(Ve||In(Se)){const pt=Se.depthTexture;pt&&pt.isDepthTexture&&(pt.type===FloatType?We=u.DEPTH_COMPONENT32F:pt.type===UnsignedIntType&&(We=u.DEPTH_COMPONENT24));const It=vn(Se);In(Se)?oe.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,It,We,Se.width,Se.height):u.renderbufferStorageMultisample(u.RENDERBUFFER,It,We,Se.width,Se.height)}else u.renderbufferStorage(u.RENDERBUFFER,We,Se.width,Se.height);u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,fe)}else if(Se.depthBuffer&&Se.stencilBuffer){const We=vn(Se);Ve&&In(Se)===!1?u.renderbufferStorageMultisample(u.RENDERBUFFER,We,u.DEPTH24_STENCIL8,Se.width,Se.height):In(Se)?oe.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,We,u.DEPTH24_STENCIL8,Se.width,Se.height):u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,Se.width,Se.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,fe)}else{const We=Se.isWebGLMultipleRenderTargets===!0?Se.texture:[Se.texture];for(let pt=0;pt<We.length;pt++){const It=We[pt],$t=M.convert(It.format,It.colorSpace),nn=M.convert(It.type),Ht=$(It.internalFormat,$t,nn,It.colorSpace),Wn=vn(Se);Ve&&In(Se)===!1?u.renderbufferStorageMultisample(u.RENDERBUFFER,Wn,Ht,Se.width,Se.height):In(Se)?oe.renderbufferStorageMultisampleEXT(u.RENDERBUFFER,Wn,Ht,Se.width,Se.height):u.renderbufferStorage(u.RENDERBUFFER,Ht,Se.width,Se.height)}}u.bindRenderbuffer(u.RENDERBUFFER,null)}function Xt(fe,Se){if(Se&&Se.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(s.bindFramebuffer(u.FRAMEBUFFER,fe),!(Se.depthTexture&&Se.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!v.get(Se.depthTexture).__webglTexture||Se.depthTexture.image.width!==Se.width||Se.depthTexture.image.height!==Se.height)&&(Se.depthTexture.image.width=Se.width,Se.depthTexture.image.height=Se.height,Se.depthTexture.needsUpdate=!0),At(Se.depthTexture,0);const We=v.get(Se.depthTexture).__webglTexture,pt=vn(Se);if(Se.depthTexture.format===DepthFormat)In(Se)?oe.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,We,0,pt):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,We,0);else if(Se.depthTexture.format===DepthStencilFormat)In(Se)?oe.framebufferTexture2DMultisampleEXT(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,We,0,pt):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,We,0);else throw new Error("Unknown depthTexture format")}function tn(fe){const Se=v.get(fe),Ve=fe.isWebGLCubeRenderTarget===!0;if(fe.depthTexture&&!Se.__autoAllocateDepthBuffer){if(Ve)throw new Error("target.depthTexture not supported in Cube render targets");Xt(Se.__webglFramebuffer,fe)}else if(Ve){Se.__webglDepthbuffer=[];for(let We=0;We<6;We++)s.bindFramebuffer(u.FRAMEBUFFER,Se.__webglFramebuffer[We]),Se.__webglDepthbuffer[We]=u.createRenderbuffer(),Xe(Se.__webglDepthbuffer[We],fe,!1)}else s.bindFramebuffer(u.FRAMEBUFFER,Se.__webglFramebuffer),Se.__webglDepthbuffer=u.createRenderbuffer(),Xe(Se.__webglDepthbuffer,fe,!1);s.bindFramebuffer(u.FRAMEBUFFER,null)}function dn(fe,Se,Ve){const We=v.get(fe);Se!==void 0&&pi(We.__webglFramebuffer,fe,fe.texture,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,0),Ve!==void 0&&tn(fe)}function pn(fe){const Se=fe.texture,Ve=v.get(fe),We=v.get(Se);fe.addEventListener("dispose",he),fe.isWebGLMultipleRenderTargets!==!0&&(We.__webglTexture===void 0&&(We.__webglTexture=u.createTexture()),We.__version=Se.version,I.memory.textures++);const pt=fe.isWebGLCubeRenderTarget===!0,It=fe.isWebGLMultipleRenderTargets===!0,$t=_e(fe)||B;if(pt){Ve.__webglFramebuffer=[];for(let nn=0;nn<6;nn++)if(B&&Se.mipmaps&&Se.mipmaps.length>0){Ve.__webglFramebuffer[nn]=[];for(let Ht=0;Ht<Se.mipmaps.length;Ht++)Ve.__webglFramebuffer[nn][Ht]=u.createFramebuffer()}else Ve.__webglFramebuffer[nn]=u.createFramebuffer()}else{if(B&&Se.mipmaps&&Se.mipmaps.length>0){Ve.__webglFramebuffer=[];for(let nn=0;nn<Se.mipmaps.length;nn++)Ve.__webglFramebuffer[nn]=u.createFramebuffer()}else Ve.__webglFramebuffer=u.createFramebuffer();if(It)if(x.drawBuffers){const nn=fe.texture;for(let Ht=0,Wn=nn.length;Ht<Wn;Ht++){const Ln=v.get(nn[Ht]);Ln.__webglTexture===void 0&&(Ln.__webglTexture=u.createTexture(),I.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(B&&fe.samples>0&&In(fe)===!1){const nn=It?Se:[Se];Ve.__webglMultisampledFramebuffer=u.createFramebuffer(),Ve.__webglColorRenderbuffer=[],s.bindFramebuffer(u.FRAMEBUFFER,Ve.__webglMultisampledFramebuffer);for(let Ht=0;Ht<nn.length;Ht++){const Wn=nn[Ht];Ve.__webglColorRenderbuffer[Ht]=u.createRenderbuffer(),u.bindRenderbuffer(u.RENDERBUFFER,Ve.__webglColorRenderbuffer[Ht]);const Ln=M.convert(Wn.format,Wn.colorSpace),Qn=M.convert(Wn.type),Nn=$(Wn.internalFormat,Ln,Qn,Wn.colorSpace,fe.isXRRenderTarget===!0),Zn=vn(fe);u.renderbufferStorageMultisample(u.RENDERBUFFER,Zn,Nn,fe.width,fe.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+Ht,u.RENDERBUFFER,Ve.__webglColorRenderbuffer[Ht])}u.bindRenderbuffer(u.RENDERBUFFER,null),fe.depthBuffer&&(Ve.__webglDepthRenderbuffer=u.createRenderbuffer(),Xe(Ve.__webglDepthRenderbuffer,fe,!0)),s.bindFramebuffer(u.FRAMEBUFFER,null)}}if(pt){s.bindTexture(u.TEXTURE_CUBE_MAP,We.__webglTexture),bt(u.TEXTURE_CUBE_MAP,Se,$t);for(let nn=0;nn<6;nn++)if(B&&Se.mipmaps&&Se.mipmaps.length>0)for(let Ht=0;Ht<Se.mipmaps.length;Ht++)pi(Ve.__webglFramebuffer[nn][Ht],fe,Se,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+nn,Ht);else pi(Ve.__webglFramebuffer[nn],fe,Se,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+nn,0);Ae(Se,$t)&&ee(u.TEXTURE_CUBE_MAP),s.unbindTexture()}else if(It){const nn=fe.texture;for(let Ht=0,Wn=nn.length;Ht<Wn;Ht++){const Ln=nn[Ht],Qn=v.get(Ln);s.bindTexture(u.TEXTURE_2D,Qn.__webglTexture),bt(u.TEXTURE_2D,Ln,$t),pi(Ve.__webglFramebuffer,fe,Ln,u.COLOR_ATTACHMENT0+Ht,u.TEXTURE_2D,0),Ae(Ln,$t)&&ee(u.TEXTURE_2D)}s.unbindTexture()}else{let nn=u.TEXTURE_2D;if((fe.isWebGL3DRenderTarget||fe.isWebGLArrayRenderTarget)&&(B?nn=fe.isWebGL3DRenderTarget?u.TEXTURE_3D:u.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),s.bindTexture(nn,We.__webglTexture),bt(nn,Se,$t),B&&Se.mipmaps&&Se.mipmaps.length>0)for(let Ht=0;Ht<Se.mipmaps.length;Ht++)pi(Ve.__webglFramebuffer[Ht],fe,Se,u.COLOR_ATTACHMENT0,nn,Ht);else pi(Ve.__webglFramebuffer,fe,Se,u.COLOR_ATTACHMENT0,nn,0);Ae(Se,$t)&&ee(nn),s.unbindTexture()}fe.depthBuffer&&tn(fe)}function Pn(fe){const Se=_e(fe)||B,Ve=fe.isWebGLMultipleRenderTargets===!0?fe.texture:[fe.texture];for(let We=0,pt=Ve.length;We<pt;We++){const It=Ve[We];if(Ae(It,Se)){const $t=fe.isWebGLCubeRenderTarget?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D,nn=v.get(It).__webglTexture;s.bindTexture($t,nn),ee($t),s.unbindTexture()}}}function Cn(fe){if(B&&fe.samples>0&&In(fe)===!1){const Se=fe.isWebGLMultipleRenderTargets?fe.texture:[fe.texture],Ve=fe.width,We=fe.height;let pt=u.COLOR_BUFFER_BIT;const It=[],$t=fe.stencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT,nn=v.get(fe),Ht=fe.isWebGLMultipleRenderTargets===!0;if(Ht)for(let Wn=0;Wn<Se.length;Wn++)s.bindFramebuffer(u.FRAMEBUFFER,nn.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+Wn,u.RENDERBUFFER,null),s.bindFramebuffer(u.FRAMEBUFFER,nn.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+Wn,u.TEXTURE_2D,null,0);s.bindFramebuffer(u.READ_FRAMEBUFFER,nn.__webglMultisampledFramebuffer),s.bindFramebuffer(u.DRAW_FRAMEBUFFER,nn.__webglFramebuffer);for(let Wn=0;Wn<Se.length;Wn++){It.push(u.COLOR_ATTACHMENT0+Wn),fe.depthBuffer&&It.push($t);const Ln=nn.__ignoreDepthValues!==void 0?nn.__ignoreDepthValues:!1;if(Ln===!1&&(fe.depthBuffer&&(pt|=u.DEPTH_BUFFER_BIT),fe.stencilBuffer&&(pt|=u.STENCIL_BUFFER_BIT)),Ht&&u.framebufferRenderbuffer(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,nn.__webglColorRenderbuffer[Wn]),Ln===!0&&(u.invalidateFramebuffer(u.READ_FRAMEBUFFER,[$t]),u.invalidateFramebuffer(u.DRAW_FRAMEBUFFER,[$t])),Ht){const Qn=v.get(Se[Wn]).__webglTexture;u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,Qn,0)}u.blitFramebuffer(0,0,Ve,We,0,0,Ve,We,pt,u.NEAREST),le&&u.invalidateFramebuffer(u.READ_FRAMEBUFFER,It)}if(s.bindFramebuffer(u.READ_FRAMEBUFFER,null),s.bindFramebuffer(u.DRAW_FRAMEBUFFER,null),Ht)for(let Wn=0;Wn<Se.length;Wn++){s.bindFramebuffer(u.FRAMEBUFFER,nn.__webglMultisampledFramebuffer),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0+Wn,u.RENDERBUFFER,nn.__webglColorRenderbuffer[Wn]);const Ln=v.get(Se[Wn]).__webglTexture;s.bindFramebuffer(u.FRAMEBUFFER,nn.__webglFramebuffer),u.framebufferTexture2D(u.DRAW_FRAMEBUFFER,u.COLOR_ATTACHMENT0+Wn,u.TEXTURE_2D,Ln,0)}s.bindFramebuffer(u.DRAW_FRAMEBUFFER,nn.__webglMultisampledFramebuffer)}}function vn(fe){return Math.min(Z,fe.samples)}function In(fe){const Se=v.get(fe);return B&&fe.samples>0&&a.has("WEBGL_multisampled_render_to_texture")===!0&&Se.__useRenderToTexture!==!1}function Fn(fe){const Se=I.render.frame;se.get(fe)!==Se&&(se.set(fe,Se),fe.update())}function Hn(fe,Se){const Ve=fe.colorSpace,We=fe.format,pt=fe.type;return fe.isCompressedTexture===!0||fe.format===_SRGBAFormat||Ve!==LinearSRGBColorSpace&&Ve!==NoColorSpace&&(Ve===SRGBColorSpace?B===!1?a.has("EXT_sRGB")===!0&&We===RGBAFormat?(fe.format=_SRGBAFormat,fe.minFilter=LinearFilter,fe.generateMipmaps=!1):Se=ImageUtils.sRGBToLinear(Se):(We!==RGBAFormat||pt!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ve)),Se}this.allocateTextureUnit=it,this.resetTextureUnits=Ye,this.setTexture2D=At,this.setTexture2DArray=vt,this.setTexture3D=ut,this.setTextureCube=Nt,this.rebindTextures=dn,this.setupRenderTarget=pn,this.updateRenderTargetMipmap=Pn,this.updateMultisampleRenderTarget=Cn,this.setupDepthRenderbuffer=tn,this.setupFrameBufferTexture=pi,this.useMultisampledRTT=In}function WebGLUtils(u,a,s){const v=s.isWebGL2;function x(M,I=NoColorSpace){let B;if(M===UnsignedByteType)return u.UNSIGNED_BYTE;if(M===UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(M===UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(M===ByteType)return u.BYTE;if(M===ShortType)return u.SHORT;if(M===UnsignedShortType)return u.UNSIGNED_SHORT;if(M===IntType)return u.INT;if(M===UnsignedIntType)return u.UNSIGNED_INT;if(M===FloatType)return u.FLOAT;if(M===HalfFloatType)return v?u.HALF_FLOAT:(B=a.get("OES_texture_half_float"),B!==null?B.HALF_FLOAT_OES:null);if(M===AlphaFormat)return u.ALPHA;if(M===RGBAFormat)return u.RGBA;if(M===LuminanceFormat)return u.LUMINANCE;if(M===LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(M===DepthFormat)return u.DEPTH_COMPONENT;if(M===DepthStencilFormat)return u.DEPTH_STENCIL;if(M===_SRGBAFormat)return B=a.get("EXT_sRGB"),B!==null?B.SRGB_ALPHA_EXT:null;if(M===RedFormat)return u.RED;if(M===RedIntegerFormat)return u.RED_INTEGER;if(M===RGFormat)return u.RG;if(M===RGIntegerFormat)return u.RG_INTEGER;if(M===RGBAIntegerFormat)return u.RGBA_INTEGER;if(M===RGB_S3TC_DXT1_Format||M===RGBA_S3TC_DXT1_Format||M===RGBA_S3TC_DXT3_Format||M===RGBA_S3TC_DXT5_Format)if(I===SRGBColorSpace)if(B=a.get("WEBGL_compressed_texture_s3tc_srgb"),B!==null){if(M===RGB_S3TC_DXT1_Format)return B.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(M===RGBA_S3TC_DXT1_Format)return B.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(M===RGBA_S3TC_DXT3_Format)return B.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(M===RGBA_S3TC_DXT5_Format)return B.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(B=a.get("WEBGL_compressed_texture_s3tc"),B!==null){if(M===RGB_S3TC_DXT1_Format)return B.COMPRESSED_RGB_S3TC_DXT1_EXT;if(M===RGBA_S3TC_DXT1_Format)return B.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(M===RGBA_S3TC_DXT3_Format)return B.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(M===RGBA_S3TC_DXT5_Format)return B.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(M===RGB_PVRTC_4BPPV1_Format||M===RGB_PVRTC_2BPPV1_Format||M===RGBA_PVRTC_4BPPV1_Format||M===RGBA_PVRTC_2BPPV1_Format)if(B=a.get("WEBGL_compressed_texture_pvrtc"),B!==null){if(M===RGB_PVRTC_4BPPV1_Format)return B.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(M===RGB_PVRTC_2BPPV1_Format)return B.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(M===RGBA_PVRTC_4BPPV1_Format)return B.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(M===RGBA_PVRTC_2BPPV1_Format)return B.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(M===RGB_ETC1_Format)return B=a.get("WEBGL_compressed_texture_etc1"),B!==null?B.COMPRESSED_RGB_ETC1_WEBGL:null;if(M===RGB_ETC2_Format||M===RGBA_ETC2_EAC_Format)if(B=a.get("WEBGL_compressed_texture_etc"),B!==null){if(M===RGB_ETC2_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ETC2:B.COMPRESSED_RGB8_ETC2;if(M===RGBA_ETC2_EAC_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:B.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(M===RGBA_ASTC_4x4_Format||M===RGBA_ASTC_5x4_Format||M===RGBA_ASTC_5x5_Format||M===RGBA_ASTC_6x5_Format||M===RGBA_ASTC_6x6_Format||M===RGBA_ASTC_8x5_Format||M===RGBA_ASTC_8x6_Format||M===RGBA_ASTC_8x8_Format||M===RGBA_ASTC_10x5_Format||M===RGBA_ASTC_10x6_Format||M===RGBA_ASTC_10x8_Format||M===RGBA_ASTC_10x10_Format||M===RGBA_ASTC_12x10_Format||M===RGBA_ASTC_12x12_Format)if(B=a.get("WEBGL_compressed_texture_astc"),B!==null){if(M===RGBA_ASTC_4x4_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:B.COMPRESSED_RGBA_ASTC_4x4_KHR;if(M===RGBA_ASTC_5x4_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:B.COMPRESSED_RGBA_ASTC_5x4_KHR;if(M===RGBA_ASTC_5x5_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:B.COMPRESSED_RGBA_ASTC_5x5_KHR;if(M===RGBA_ASTC_6x5_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:B.COMPRESSED_RGBA_ASTC_6x5_KHR;if(M===RGBA_ASTC_6x6_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:B.COMPRESSED_RGBA_ASTC_6x6_KHR;if(M===RGBA_ASTC_8x5_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:B.COMPRESSED_RGBA_ASTC_8x5_KHR;if(M===RGBA_ASTC_8x6_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:B.COMPRESSED_RGBA_ASTC_8x6_KHR;if(M===RGBA_ASTC_8x8_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:B.COMPRESSED_RGBA_ASTC_8x8_KHR;if(M===RGBA_ASTC_10x5_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:B.COMPRESSED_RGBA_ASTC_10x5_KHR;if(M===RGBA_ASTC_10x6_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:B.COMPRESSED_RGBA_ASTC_10x6_KHR;if(M===RGBA_ASTC_10x8_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:B.COMPRESSED_RGBA_ASTC_10x8_KHR;if(M===RGBA_ASTC_10x10_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:B.COMPRESSED_RGBA_ASTC_10x10_KHR;if(M===RGBA_ASTC_12x10_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:B.COMPRESSED_RGBA_ASTC_12x10_KHR;if(M===RGBA_ASTC_12x12_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:B.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(M===RGBA_BPTC_Format)if(B=a.get("EXT_texture_compression_bptc"),B!==null){if(M===RGBA_BPTC_Format)return I===SRGBColorSpace?B.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:B.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(M===RED_RGTC1_Format||M===SIGNED_RED_RGTC1_Format||M===RED_GREEN_RGTC2_Format||M===SIGNED_RED_GREEN_RGTC2_Format)if(B=a.get("EXT_texture_compression_rgtc"),B!==null){if(M===RGBA_BPTC_Format)return B.COMPRESSED_RED_RGTC1_EXT;if(M===SIGNED_RED_RGTC1_Format)return B.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(M===RED_GREEN_RGTC2_Format)return B.COMPRESSED_RED_GREEN_RGTC2_EXT;if(M===SIGNED_RED_GREEN_RGTC2_Format)return B.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return M===UnsignedInt248Type?v?u.UNSIGNED_INT_24_8:(B=a.get("WEBGL_depth_texture"),B!==null?B.UNSIGNED_INT_24_8_WEBGL:null):u[M]!==void 0?u[M]:null}return{convert:x}}class ArrayCamera extends PerspectiveCamera{constructor(a=[]){super(),this.isArrayCamera=!0,this.cameras=a}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(a){return this._targetRay!==null&&this._targetRay.dispatchEvent(a),this._grip!==null&&this._grip.dispatchEvent(a),this._hand!==null&&this._hand.dispatchEvent(a),this}connect(a){if(a&&a.hand){const s=this._hand;if(s)for(const v of a.hand.values())this._getHandJoint(s,v)}return this.dispatchEvent({type:"connected",data:a}),this}disconnect(a){return this.dispatchEvent({type:"disconnected",data:a}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(a,s,v){let x=null,M=null,I=null;const B=this._targetRay,U=this._grip,j=this._hand;if(a&&s.session.visibilityState!=="visible-blurred"){if(j&&a.hand){I=!0;for(const ve of a.hand.values()){const ce=s.getJointPose(ve,v),K=this._getHandJoint(j,ve);ce!==null&&(K.matrix.fromArray(ce.transform.matrix),K.matrix.decompose(K.position,K.rotation,K.scale),K.matrixWorldNeedsUpdate=!0,K.jointRadius=ce.radius),K.visible=ce!==null}const te=j.joints["index-finger-tip"],Z=j.joints["thumb-tip"],oe=te.position.distanceTo(Z.position),le=.02,se=.005;j.inputState.pinching&&oe>le+se?(j.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!j.inputState.pinching&&oe<=le-se&&(j.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:a.handedness,target:this}))}else U!==null&&a.gripSpace&&(M=s.getPose(a.gripSpace,v),M!==null&&(U.matrix.fromArray(M.transform.matrix),U.matrix.decompose(U.position,U.rotation,U.scale),U.matrixWorldNeedsUpdate=!0,M.linearVelocity?(U.hasLinearVelocity=!0,U.linearVelocity.copy(M.linearVelocity)):U.hasLinearVelocity=!1,M.angularVelocity?(U.hasAngularVelocity=!0,U.angularVelocity.copy(M.angularVelocity)):U.hasAngularVelocity=!1));B!==null&&(x=s.getPose(a.targetRaySpace,v),x===null&&M!==null&&(x=M),x!==null&&(B.matrix.fromArray(x.transform.matrix),B.matrix.decompose(B.position,B.rotation,B.scale),B.matrixWorldNeedsUpdate=!0,x.linearVelocity?(B.hasLinearVelocity=!0,B.linearVelocity.copy(x.linearVelocity)):B.hasLinearVelocity=!1,x.angularVelocity?(B.hasAngularVelocity=!0,B.angularVelocity.copy(x.angularVelocity)):B.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return B!==null&&(B.visible=x!==null),U!==null&&(U.visible=M!==null),j!==null&&(j.visible=I!==null),this}_getHandJoint(a,s){if(a.joints[s.jointName]===void 0){const v=new Group;v.matrixAutoUpdate=!1,v.visible=!1,a.joints[s.jointName]=v,a.add(v)}return a.joints[s.jointName]}}class DepthTexture extends Texture{constructor(a,s,v,x,M,I,B,U,j,te){if(te=te!==void 0?te:DepthFormat,te!==DepthFormat&&te!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");v===void 0&&te===DepthFormat&&(v=UnsignedIntType),v===void 0&&te===DepthStencilFormat&&(v=UnsignedInt248Type),super(null,x,M,I,B,U,te,v,j),this.isDepthTexture=!0,this.image={width:a,height:s},this.magFilter=B!==void 0?B:NearestFilter,this.minFilter=U!==void 0?U:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.compareFunction=a.compareFunction,this}toJSON(a){const s=super.toJSON(a);return this.compareFunction!==null&&(s.compareFunction=this.compareFunction),s}}class WebXRManager extends EventDispatcher{constructor(a,s){super();const v=this;let x=null,M=1,I=null,B="local-floor",U=1,j=null,te=null,Z=null,oe=null,le=null,se=null;const ve=s.getContextAttributes();let ce=null,K=null;const X=[],W=[],_e=new PerspectiveCamera;_e.layers.enable(1),_e.viewport=new Vector4;const ge=new PerspectiveCamera;ge.layers.enable(2),ge.viewport=new Vector4;const Ae=[_e,ge],ee=new ArrayCamera;ee.layers.enable(1),ee.layers.enable(2);let $=null,ae=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(vt){let ut=X[vt];return ut===void 0&&(ut=new WebXRController,X[vt]=ut),ut.getTargetRaySpace()},this.getControllerGrip=function(vt){let ut=X[vt];return ut===void 0&&(ut=new WebXRController,X[vt]=ut),ut.getGripSpace()},this.getHand=function(vt){let ut=X[vt];return ut===void 0&&(ut=new WebXRController,X[vt]=ut),ut.getHandSpace()};function Re(vt){const ut=W.indexOf(vt.inputSource);if(ut===-1)return;const Nt=X[ut];Nt!==void 0&&(Nt.update(vt.inputSource,vt.frame,j||I),Nt.dispatchEvent({type:vt.type,data:vt.inputSource}))}function pe(){x.removeEventListener("select",Re),x.removeEventListener("selectstart",Re),x.removeEventListener("selectend",Re),x.removeEventListener("squeeze",Re),x.removeEventListener("squeezestart",Re),x.removeEventListener("squeezeend",Re),x.removeEventListener("end",pe),x.removeEventListener("inputsourceschange",he);for(let vt=0;vt<X.length;vt++){const ut=W[vt];ut!==null&&(W[vt]=null,X[vt].disconnect(ut))}$=null,ae=null,a.setRenderTarget(ce),le=null,oe=null,Z=null,x=null,K=null,At.stop(),v.isPresenting=!1,v.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(vt){M=vt,v.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(vt){B=vt,v.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return j||I},this.setReferenceSpace=function(vt){j=vt},this.getBaseLayer=function(){return oe!==null?oe:le},this.getBinding=function(){return Z},this.getFrame=function(){return se},this.getSession=function(){return x},this.setSession=async function(vt){if(x=vt,x!==null){if(ce=a.getRenderTarget(),x.addEventListener("select",Re),x.addEventListener("selectstart",Re),x.addEventListener("selectend",Re),x.addEventListener("squeeze",Re),x.addEventListener("squeezestart",Re),x.addEventListener("squeezeend",Re),x.addEventListener("end",pe),x.addEventListener("inputsourceschange",he),ve.xrCompatible!==!0&&await s.makeXRCompatible(),x.renderState.layers===void 0||a.capabilities.isWebGL2===!1){const ut={antialias:x.renderState.layers===void 0?ve.antialias:!0,alpha:!0,depth:ve.depth,stencil:ve.stencil,framebufferScaleFactor:M};le=new XRWebGLLayer(x,s,ut),x.updateRenderState({baseLayer:le}),K=new WebGLRenderTarget(le.framebufferWidth,le.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:a.outputColorSpace,stencilBuffer:ve.stencil})}else{let ut=null,Nt=null,Qt=null;ve.depth&&(Qt=ve.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,ut=ve.stencil?DepthStencilFormat:DepthFormat,Nt=ve.stencil?UnsignedInt248Type:UnsignedIntType);const Qe={colorFormat:s.RGBA8,depthFormat:Qt,scaleFactor:M};Z=new XRWebGLBinding(x,s),oe=Z.createProjectionLayer(Qe),x.updateRenderState({layers:[oe]}),K=new WebGLRenderTarget(oe.textureWidth,oe.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(oe.textureWidth,oe.textureHeight,Nt,void 0,void 0,void 0,void 0,void 0,void 0,ut),stencilBuffer:ve.stencil,colorSpace:a.outputColorSpace,samples:ve.antialias?4:0});const ft=a.properties.get(K);ft.__ignoreDepthValues=oe.ignoreDepthValues}K.isXRRenderTarget=!0,this.setFoveation(U),j=null,I=await x.requestReferenceSpace(B),At.setContext(x),At.start(),v.isPresenting=!0,v.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(x!==null)return x.environmentBlendMode};function he(vt){for(let ut=0;ut<vt.removed.length;ut++){const Nt=vt.removed[ut],Qt=W.indexOf(Nt);Qt>=0&&(W[Qt]=null,X[Qt].disconnect(Nt))}for(let ut=0;ut<vt.added.length;ut++){const Nt=vt.added[ut];let Qt=W.indexOf(Nt);if(Qt===-1){for(let ft=0;ft<X.length;ft++)if(ft>=W.length){W.push(Nt),Qt=ft;break}else if(W[ft]===null){W[ft]=Nt,Qt=ft;break}if(Qt===-1)break}const Qe=X[Qt];Qe&&Qe.connect(Nt)}}const we=new Vector3,Ce=new Vector3;function Ne(vt,ut,Nt){we.setFromMatrixPosition(ut.matrixWorld),Ce.setFromMatrixPosition(Nt.matrixWorld);const Qt=we.distanceTo(Ce),Qe=ut.projectionMatrix.elements,ft=Nt.projectionMatrix.elements,bt=Qe[14]/(Qe[10]-1),sn=Qe[14]/(Qe[10]+1),bn=(Qe[9]+1)/Qe[5],Un=(Qe[9]-1)/Qe[5],pi=(Qe[8]-1)/Qe[0],Xe=(ft[8]+1)/ft[0],Xt=bt*pi,tn=bt*Xe,dn=Qt/(-pi+Xe),pn=dn*-pi;ut.matrixWorld.decompose(vt.position,vt.quaternion,vt.scale),vt.translateX(pn),vt.translateZ(dn),vt.matrixWorld.compose(vt.position,vt.quaternion,vt.scale),vt.matrixWorldInverse.copy(vt.matrixWorld).invert();const Pn=bt+dn,Cn=sn+dn,vn=Xt-pn,In=tn+(Qt-pn),Fn=bn*sn/Cn*Pn,Hn=Un*sn/Cn*Pn;vt.projectionMatrix.makePerspective(vn,In,Fn,Hn,Pn,Cn),vt.projectionMatrixInverse.copy(vt.projectionMatrix).invert()}function Ze(vt,ut){ut===null?vt.matrixWorld.copy(vt.matrix):vt.matrixWorld.multiplyMatrices(ut.matrixWorld,vt.matrix),vt.matrixWorldInverse.copy(vt.matrixWorld).invert()}this.updateCamera=function(vt){if(x===null)return;ee.near=ge.near=_e.near=vt.near,ee.far=ge.far=_e.far=vt.far,($!==ee.near||ae!==ee.far)&&(x.updateRenderState({depthNear:ee.near,depthFar:ee.far}),$=ee.near,ae=ee.far);const ut=vt.parent,Nt=ee.cameras;Ze(ee,ut);for(let Qt=0;Qt<Nt.length;Qt++)Ze(Nt[Qt],ut);Nt.length===2?Ne(ee,_e,ge):ee.projectionMatrix.copy(_e.projectionMatrix),Ye(vt,ee,ut)};function Ye(vt,ut,Nt){Nt===null?vt.matrix.copy(ut.matrixWorld):(vt.matrix.copy(Nt.matrixWorld),vt.matrix.invert(),vt.matrix.multiply(ut.matrixWorld)),vt.matrix.decompose(vt.position,vt.quaternion,vt.scale),vt.updateMatrixWorld(!0);const Qt=vt.children;for(let Qe=0,ft=Qt.length;Qe<ft;Qe++)Qt[Qe].updateMatrixWorld(!0);vt.projectionMatrix.copy(ut.projectionMatrix),vt.projectionMatrixInverse.copy(ut.projectionMatrixInverse),vt.isPerspectiveCamera&&(vt.fov=RAD2DEG*2*Math.atan(1/vt.projectionMatrix.elements[5]),vt.zoom=1)}this.getCamera=function(){return ee},this.getFoveation=function(){if(!(oe===null&&le===null))return U},this.setFoveation=function(vt){U=vt,oe!==null&&(oe.fixedFoveation=vt),le!==null&&le.fixedFoveation!==void 0&&(le.fixedFoveation=vt)};let it=null;function _t(vt,ut){if(te=ut.getViewerPose(j||I),se=ut,te!==null){const Nt=te.views;le!==null&&(a.setRenderTargetFramebuffer(K,le.framebuffer),a.setRenderTarget(K));let Qt=!1;Nt.length!==ee.cameras.length&&(ee.cameras.length=0,Qt=!0);for(let Qe=0;Qe<Nt.length;Qe++){const ft=Nt[Qe];let bt=null;if(le!==null)bt=le.getViewport(ft);else{const bn=Z.getViewSubImage(oe,ft);bt=bn.viewport,Qe===0&&(a.setRenderTargetTextures(K,bn.colorTexture,oe.ignoreDepthValues?void 0:bn.depthStencilTexture),a.setRenderTarget(K))}let sn=Ae[Qe];sn===void 0&&(sn=new PerspectiveCamera,sn.layers.enable(Qe),sn.viewport=new Vector4,Ae[Qe]=sn),sn.matrix.fromArray(ft.transform.matrix),sn.matrix.decompose(sn.position,sn.quaternion,sn.scale),sn.projectionMatrix.fromArray(ft.projectionMatrix),sn.projectionMatrixInverse.copy(sn.projectionMatrix).invert(),sn.viewport.set(bt.x,bt.y,bt.width,bt.height),Qe===0&&(ee.matrix.copy(sn.matrix),ee.matrix.decompose(ee.position,ee.quaternion,ee.scale)),Qt===!0&&ee.cameras.push(sn)}}for(let Nt=0;Nt<X.length;Nt++){const Qt=W[Nt],Qe=X[Nt];Qt!==null&&Qe!==void 0&&Qe.update(Qt,ut,j||I)}it&&it(vt,ut),ut.detectedPlanes&&v.dispatchEvent({type:"planesdetected",data:ut}),se=null}const At=new WebGLAnimation;At.setAnimationLoop(_t),this.setAnimationLoop=function(vt){it=vt},this.dispose=function(){}}}function WebGLMaterials(u,a){function s(ce,K){ce.matrixAutoUpdate===!0&&ce.updateMatrix(),K.value.copy(ce.matrix)}function v(ce,K){K.color.getRGB(ce.fogColor.value,getUnlitUniformColorSpace(u)),K.isFog?(ce.fogNear.value=K.near,ce.fogFar.value=K.far):K.isFogExp2&&(ce.fogDensity.value=K.density)}function x(ce,K,X,W,_e){K.isMeshBasicMaterial||K.isMeshLambertMaterial?M(ce,K):K.isMeshToonMaterial?(M(ce,K),Z(ce,K)):K.isMeshPhongMaterial?(M(ce,K),te(ce,K)):K.isMeshStandardMaterial?(M(ce,K),oe(ce,K),K.isMeshPhysicalMaterial&&le(ce,K,_e)):K.isMeshMatcapMaterial?(M(ce,K),se(ce,K)):K.isMeshDepthMaterial?M(ce,K):K.isMeshDistanceMaterial?(M(ce,K),ve(ce,K)):K.isMeshNormalMaterial?M(ce,K):K.isLineBasicMaterial?(I(ce,K),K.isLineDashedMaterial&&B(ce,K)):K.isPointsMaterial?U(ce,K,X,W):K.isSpriteMaterial?j(ce,K):K.isShadowMaterial?(ce.color.value.copy(K.color),ce.opacity.value=K.opacity):K.isShaderMaterial&&(K.uniformsNeedUpdate=!1)}function M(ce,K){ce.opacity.value=K.opacity,K.color&&ce.diffuse.value.copy(K.color),K.emissive&&ce.emissive.value.copy(K.emissive).multiplyScalar(K.emissiveIntensity),K.map&&(ce.map.value=K.map,s(K.map,ce.mapTransform)),K.alphaMap&&(ce.alphaMap.value=K.alphaMap,s(K.alphaMap,ce.alphaMapTransform)),K.bumpMap&&(ce.bumpMap.value=K.bumpMap,s(K.bumpMap,ce.bumpMapTransform),ce.bumpScale.value=K.bumpScale,K.side===BackSide&&(ce.bumpScale.value*=-1)),K.normalMap&&(ce.normalMap.value=K.normalMap,s(K.normalMap,ce.normalMapTransform),ce.normalScale.value.copy(K.normalScale),K.side===BackSide&&ce.normalScale.value.negate()),K.displacementMap&&(ce.displacementMap.value=K.displacementMap,s(K.displacementMap,ce.displacementMapTransform),ce.displacementScale.value=K.displacementScale,ce.displacementBias.value=K.displacementBias),K.emissiveMap&&(ce.emissiveMap.value=K.emissiveMap,s(K.emissiveMap,ce.emissiveMapTransform)),K.specularMap&&(ce.specularMap.value=K.specularMap,s(K.specularMap,ce.specularMapTransform)),K.alphaTest>0&&(ce.alphaTest.value=K.alphaTest);const X=a.get(K).envMap;if(X&&(ce.envMap.value=X,ce.flipEnvMap.value=X.isCubeTexture&&X.isRenderTargetTexture===!1?-1:1,ce.reflectivity.value=K.reflectivity,ce.ior.value=K.ior,ce.refractionRatio.value=K.refractionRatio),K.lightMap){ce.lightMap.value=K.lightMap;const W=u._useLegacyLights===!0?Math.PI:1;ce.lightMapIntensity.value=K.lightMapIntensity*W,s(K.lightMap,ce.lightMapTransform)}K.aoMap&&(ce.aoMap.value=K.aoMap,ce.aoMapIntensity.value=K.aoMapIntensity,s(K.aoMap,ce.aoMapTransform))}function I(ce,K){ce.diffuse.value.copy(K.color),ce.opacity.value=K.opacity,K.map&&(ce.map.value=K.map,s(K.map,ce.mapTransform))}function B(ce,K){ce.dashSize.value=K.dashSize,ce.totalSize.value=K.dashSize+K.gapSize,ce.scale.value=K.scale}function U(ce,K,X,W){ce.diffuse.value.copy(K.color),ce.opacity.value=K.opacity,ce.size.value=K.size*X,ce.scale.value=W*.5,K.map&&(ce.map.value=K.map,s(K.map,ce.uvTransform)),K.alphaMap&&(ce.alphaMap.value=K.alphaMap,s(K.alphaMap,ce.alphaMapTransform)),K.alphaTest>0&&(ce.alphaTest.value=K.alphaTest)}function j(ce,K){ce.diffuse.value.copy(K.color),ce.opacity.value=K.opacity,ce.rotation.value=K.rotation,K.map&&(ce.map.value=K.map,s(K.map,ce.mapTransform)),K.alphaMap&&(ce.alphaMap.value=K.alphaMap,s(K.alphaMap,ce.alphaMapTransform)),K.alphaTest>0&&(ce.alphaTest.value=K.alphaTest)}function te(ce,K){ce.specular.value.copy(K.specular),ce.shininess.value=Math.max(K.shininess,1e-4)}function Z(ce,K){K.gradientMap&&(ce.gradientMap.value=K.gradientMap)}function oe(ce,K){ce.metalness.value=K.metalness,K.metalnessMap&&(ce.metalnessMap.value=K.metalnessMap,s(K.metalnessMap,ce.metalnessMapTransform)),ce.roughness.value=K.roughness,K.roughnessMap&&(ce.roughnessMap.value=K.roughnessMap,s(K.roughnessMap,ce.roughnessMapTransform)),a.get(K).envMap&&(ce.envMapIntensity.value=K.envMapIntensity)}function le(ce,K,X){ce.ior.value=K.ior,K.sheen>0&&(ce.sheenColor.value.copy(K.sheenColor).multiplyScalar(K.sheen),ce.sheenRoughness.value=K.sheenRoughness,K.sheenColorMap&&(ce.sheenColorMap.value=K.sheenColorMap,s(K.sheenColorMap,ce.sheenColorMapTransform)),K.sheenRoughnessMap&&(ce.sheenRoughnessMap.value=K.sheenRoughnessMap,s(K.sheenRoughnessMap,ce.sheenRoughnessMapTransform))),K.clearcoat>0&&(ce.clearcoat.value=K.clearcoat,ce.clearcoatRoughness.value=K.clearcoatRoughness,K.clearcoatMap&&(ce.clearcoatMap.value=K.clearcoatMap,s(K.clearcoatMap,ce.clearcoatMapTransform)),K.clearcoatRoughnessMap&&(ce.clearcoatRoughnessMap.value=K.clearcoatRoughnessMap,s(K.clearcoatRoughnessMap,ce.clearcoatRoughnessMapTransform)),K.clearcoatNormalMap&&(ce.clearcoatNormalMap.value=K.clearcoatNormalMap,s(K.clearcoatNormalMap,ce.clearcoatNormalMapTransform),ce.clearcoatNormalScale.value.copy(K.clearcoatNormalScale),K.side===BackSide&&ce.clearcoatNormalScale.value.negate())),K.iridescence>0&&(ce.iridescence.value=K.iridescence,ce.iridescenceIOR.value=K.iridescenceIOR,ce.iridescenceThicknessMinimum.value=K.iridescenceThicknessRange[0],ce.iridescenceThicknessMaximum.value=K.iridescenceThicknessRange[1],K.iridescenceMap&&(ce.iridescenceMap.value=K.iridescenceMap,s(K.iridescenceMap,ce.iridescenceMapTransform)),K.iridescenceThicknessMap&&(ce.iridescenceThicknessMap.value=K.iridescenceThicknessMap,s(K.iridescenceThicknessMap,ce.iridescenceThicknessMapTransform))),K.transmission>0&&(ce.transmission.value=K.transmission,ce.transmissionSamplerMap.value=X.texture,ce.transmissionSamplerSize.value.set(X.width,X.height),K.transmissionMap&&(ce.transmissionMap.value=K.transmissionMap,s(K.transmissionMap,ce.transmissionMapTransform)),ce.thickness.value=K.thickness,K.thicknessMap&&(ce.thicknessMap.value=K.thicknessMap,s(K.thicknessMap,ce.thicknessMapTransform)),ce.attenuationDistance.value=K.attenuationDistance,ce.attenuationColor.value.copy(K.attenuationColor)),K.anisotropy>0&&(ce.anisotropyVector.value.set(K.anisotropy*Math.cos(K.anisotropyRotation),K.anisotropy*Math.sin(K.anisotropyRotation)),K.anisotropyMap&&(ce.anisotropyMap.value=K.anisotropyMap,s(K.anisotropyMap,ce.anisotropyMapTransform))),ce.specularIntensity.value=K.specularIntensity,ce.specularColor.value.copy(K.specularColor),K.specularColorMap&&(ce.specularColorMap.value=K.specularColorMap,s(K.specularColorMap,ce.specularColorMapTransform)),K.specularIntensityMap&&(ce.specularIntensityMap.value=K.specularIntensityMap,s(K.specularIntensityMap,ce.specularIntensityMapTransform))}function se(ce,K){K.matcap&&(ce.matcap.value=K.matcap)}function ve(ce,K){const X=a.get(K).light;ce.referencePosition.value.setFromMatrixPosition(X.matrixWorld),ce.nearDistance.value=X.shadow.camera.near,ce.farDistance.value=X.shadow.camera.far}return{refreshFogUniforms:v,refreshMaterialUniforms:x}}function WebGLUniformsGroups(u,a,s,v){let x={},M={},I=[];const B=s.isWebGL2?u.getParameter(u.MAX_UNIFORM_BUFFER_BINDINGS):0;function U(X,W){const _e=W.program;v.uniformBlockBinding(X,_e)}function j(X,W){let _e=x[X.id];_e===void 0&&(se(X),_e=te(X),x[X.id]=_e,X.addEventListener("dispose",ce));const ge=W.program;v.updateUBOMapping(X,ge);const Ae=a.render.frame;M[X.id]!==Ae&&(oe(X),M[X.id]=Ae)}function te(X){const W=Z();X.__bindingPointIndex=W;const _e=u.createBuffer(),ge=X.__size,Ae=X.usage;return u.bindBuffer(u.UNIFORM_BUFFER,_e),u.bufferData(u.UNIFORM_BUFFER,ge,Ae),u.bindBuffer(u.UNIFORM_BUFFER,null),u.bindBufferBase(u.UNIFORM_BUFFER,W,_e),_e}function Z(){for(let X=0;X<B;X++)if(I.indexOf(X)===-1)return I.push(X),X;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function oe(X){const W=x[X.id],_e=X.uniforms,ge=X.__cache;u.bindBuffer(u.UNIFORM_BUFFER,W);for(let Ae=0,ee=_e.length;Ae<ee;Ae++){const $=_e[Ae];if(le($,Ae,ge)===!0){const ae=$.__offset,Re=Array.isArray($.value)?$.value:[$.value];let pe=0;for(let he=0;he<Re.length;he++){const we=Re[he],Ce=ve(we);typeof we=="number"?($.__data[0]=we,u.bufferSubData(u.UNIFORM_BUFFER,ae+pe,$.__data)):we.isMatrix3?($.__data[0]=we.elements[0],$.__data[1]=we.elements[1],$.__data[2]=we.elements[2],$.__data[3]=we.elements[0],$.__data[4]=we.elements[3],$.__data[5]=we.elements[4],$.__data[6]=we.elements[5],$.__data[7]=we.elements[0],$.__data[8]=we.elements[6],$.__data[9]=we.elements[7],$.__data[10]=we.elements[8],$.__data[11]=we.elements[0]):(we.toArray($.__data,pe),pe+=Ce.storage/Float32Array.BYTES_PER_ELEMENT)}u.bufferSubData(u.UNIFORM_BUFFER,ae,$.__data)}}u.bindBuffer(u.UNIFORM_BUFFER,null)}function le(X,W,_e){const ge=X.value;if(_e[W]===void 0){if(typeof ge=="number")_e[W]=ge;else{const Ae=Array.isArray(ge)?ge:[ge],ee=[];for(let $=0;$<Ae.length;$++)ee.push(Ae[$].clone());_e[W]=ee}return!0}else if(typeof ge=="number"){if(_e[W]!==ge)return _e[W]=ge,!0}else{const Ae=Array.isArray(_e[W])?_e[W]:[_e[W]],ee=Array.isArray(ge)?ge:[ge];for(let $=0;$<Ae.length;$++){const ae=Ae[$];if(ae.equals(ee[$])===!1)return ae.copy(ee[$]),!0}}return!1}function se(X){const W=X.uniforms;let _e=0;const ge=16;let Ae=0;for(let ee=0,$=W.length;ee<$;ee++){const ae=W[ee],Re={boundary:0,storage:0},pe=Array.isArray(ae.value)?ae.value:[ae.value];for(let he=0,we=pe.length;he<we;he++){const Ce=pe[he],Ne=ve(Ce);Re.boundary+=Ne.boundary,Re.storage+=Ne.storage}if(ae.__data=new Float32Array(Re.storage/Float32Array.BYTES_PER_ELEMENT),ae.__offset=_e,ee>0){Ae=_e%ge;const he=ge-Ae;Ae!==0&&he-Re.boundary<0&&(_e+=ge-Ae,ae.__offset=_e)}_e+=Re.storage}return Ae=_e%ge,Ae>0&&(_e+=ge-Ae),X.__size=_e,X.__cache={},this}function ve(X){const W={boundary:0,storage:0};return typeof X=="number"?(W.boundary=4,W.storage=4):X.isVector2?(W.boundary=8,W.storage=8):X.isVector3||X.isColor?(W.boundary=16,W.storage=12):X.isVector4?(W.boundary=16,W.storage=16):X.isMatrix3?(W.boundary=48,W.storage=48):X.isMatrix4?(W.boundary=64,W.storage=64):X.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",X),W}function ce(X){const W=X.target;W.removeEventListener("dispose",ce);const _e=I.indexOf(W.__bindingPointIndex);I.splice(_e,1),u.deleteBuffer(x[W.id]),delete x[W.id],delete M[W.id]}function K(){for(const X in x)u.deleteBuffer(x[X]);I=[],x={},M={}}return{bind:U,update:j,dispose:K}}function createCanvasElement(){const u=createElementNS("canvas");return u.style.display="block",u}class WebGLRenderer{constructor(a={}){const{canvas:s=createCanvasElement(),context:v=null,depth:x=!0,stencil:M=!0,alpha:I=!1,antialias:B=!1,premultipliedAlpha:U=!0,preserveDrawingBuffer:j=!1,powerPreference:te="default",failIfMajorPerformanceCaveat:Z=!1}=a;this.isWebGLRenderer=!0;let oe;v!==null?oe=v.getContextAttributes().alpha:oe=I;const le=new Uint32Array(4),se=new Int32Array(4);let ve=null,ce=null;const K=[],X=[];this.domElement=s,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const W=this;let _e=!1,ge=0,Ae=0,ee=null,$=-1,ae=null;const Re=new Vector4,pe=new Vector4;let he=null;const we=new Color(0);let Ce=0,Ne=s.width,Ze=s.height,Ye=1,it=null,_t=null;const At=new Vector4(0,0,Ne,Ze),vt=new Vector4(0,0,Ne,Ze);let ut=!1;const Nt=new Frustum;let Qt=!1,Qe=!1,ft=null;const bt=new Matrix4,sn=new Vector2,bn=new Vector3,Un={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function pi(){return ee===null?Ye:1}let Xe=v;function Xt(Pt,wn){for(let Vn=0;Vn<Pt.length;Vn++){const un=Pt[Vn],Gn=s.getContext(un,wn);if(Gn!==null)return Gn}return null}try{const Pt={alpha:!0,depth:x,stencil:M,antialias:B,premultipliedAlpha:U,preserveDrawingBuffer:j,powerPreference:te,failIfMajorPerformanceCaveat:Z};if("setAttribute"in s&&s.setAttribute("data-engine",`three.js r${REVISION}`),s.addEventListener("webglcontextlost",yi,!1),s.addEventListener("webglcontextrestored",On,!1),s.addEventListener("webglcontextcreationerror",si,!1),Xe===null){const wn=["webgl2","webgl","experimental-webgl"];if(W.isWebGL1Renderer===!0&&wn.shift(),Xe=Xt(wn,Pt),Xe===null)throw Xt(wn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Xe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Xe.getShaderPrecisionFormat===void 0&&(Xe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Pt){throw console.error("THREE.WebGLRenderer: "+Pt.message),Pt}let tn,dn,pn,Pn,Cn,vn,In,Fn,Hn,fe,Se,Ve,We,pt,It,$t,nn,Ht,Wn,Ln,Qn,Nn,Zn,Qi;function Mr(){tn=new WebGLExtensions(Xe),dn=new WebGLCapabilities(Xe,tn,a),tn.init(dn),Nn=new WebGLUtils(Xe,tn,dn),pn=new WebGLState(Xe,tn,dn),Pn=new WebGLInfo(Xe),Cn=new WebGLProperties,vn=new WebGLTextures(Xe,tn,pn,Cn,dn,Nn,Pn),In=new WebGLCubeMaps(W),Fn=new WebGLCubeUVMaps(W),Hn=new WebGLAttributes(Xe,dn),Zn=new WebGLBindingStates(Xe,tn,Hn,dn),fe=new WebGLGeometries(Xe,Hn,Pn,Zn),Se=new WebGLObjects(Xe,fe,Hn,Pn),Wn=new WebGLMorphtargets(Xe,dn,vn),$t=new WebGLClipping(Cn),Ve=new WebGLPrograms(W,In,Fn,tn,dn,Zn,$t),We=new WebGLMaterials(W,Cn),pt=new WebGLRenderLists,It=new WebGLRenderStates(tn,dn),Ht=new WebGLBackground(W,In,Fn,pn,Se,oe,U),nn=new WebGLShadowMap(W,Se,dn),Qi=new WebGLUniformsGroups(Xe,Pn,dn,pn),Ln=new WebGLBufferRenderer(Xe,tn,Pn,dn),Qn=new WebGLIndexedBufferRenderer(Xe,tn,Pn,dn),Pn.programs=Ve.programs,W.capabilities=dn,W.extensions=tn,W.properties=Cn,W.renderLists=pt,W.shadowMap=nn,W.state=pn,W.info=Pn}Mr();const ze=new WebXRManager(W,Xe);this.xr=ze,this.getContext=function(){return Xe},this.getContextAttributes=function(){return Xe.getContextAttributes()},this.forceContextLoss=function(){const Pt=tn.get("WEBGL_lose_context");Pt&&Pt.loseContext()},this.forceContextRestore=function(){const Pt=tn.get("WEBGL_lose_context");Pt&&Pt.restoreContext()},this.getPixelRatio=function(){return Ye},this.setPixelRatio=function(Pt){Pt!==void 0&&(Ye=Pt,this.setSize(Ne,Ze,!1))},this.getSize=function(Pt){return Pt.set(Ne,Ze)},this.setSize=function(Pt,wn,Vn=!0){if(ze.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ne=Pt,Ze=wn,s.width=Math.floor(Pt*Ye),s.height=Math.floor(wn*Ye),Vn===!0&&(s.style.width=Pt+"px",s.style.height=wn+"px"),this.setViewport(0,0,Pt,wn)},this.getDrawingBufferSize=function(Pt){return Pt.set(Ne*Ye,Ze*Ye).floor()},this.setDrawingBufferSize=function(Pt,wn,Vn){Ne=Pt,Ze=wn,Ye=Vn,s.width=Math.floor(Pt*Vn),s.height=Math.floor(wn*Vn),this.setViewport(0,0,Pt,wn)},this.getCurrentViewport=function(Pt){return Pt.copy(Re)},this.getViewport=function(Pt){return Pt.copy(At)},this.setViewport=function(Pt,wn,Vn,un){Pt.isVector4?At.set(Pt.x,Pt.y,Pt.z,Pt.w):At.set(Pt,wn,Vn,un),pn.viewport(Re.copy(At).multiplyScalar(Ye).floor())},this.getScissor=function(Pt){return Pt.copy(vt)},this.setScissor=function(Pt,wn,Vn,un){Pt.isVector4?vt.set(Pt.x,Pt.y,Pt.z,Pt.w):vt.set(Pt,wn,Vn,un),pn.scissor(pe.copy(vt).multiplyScalar(Ye).floor())},this.getScissorTest=function(){return ut},this.setScissorTest=function(Pt){pn.setScissorTest(ut=Pt)},this.setOpaqueSort=function(Pt){it=Pt},this.setTransparentSort=function(Pt){_t=Pt},this.getClearColor=function(Pt){return Pt.copy(Ht.getClearColor())},this.setClearColor=function(){Ht.setClearColor.apply(Ht,arguments)},this.getClearAlpha=function(){return Ht.getClearAlpha()},this.setClearAlpha=function(){Ht.setClearAlpha.apply(Ht,arguments)},this.clear=function(Pt=!0,wn=!0,Vn=!0){let un=0;if(Pt){let Gn=!1;if(ee!==null){const Yi=ee.texture.format;Gn=Yi===RGBAIntegerFormat||Yi===RGIntegerFormat||Yi===RedIntegerFormat}if(Gn){const Yi=ee.texture.type,ji=Yi===UnsignedByteType||Yi===UnsignedIntType||Yi===UnsignedShortType||Yi===UnsignedInt248Type||Yi===UnsignedShort4444Type||Yi===UnsignedShort5551Type,Er=Ht.getClearColor(),ir=Ht.getClearAlpha(),Yn=Er.r,er=Er.g,Pe=Er.b;ji?(le[0]=Yn,le[1]=er,le[2]=Pe,le[3]=ir,Xe.clearBufferuiv(Xe.COLOR,0,le)):(se[0]=Yn,se[1]=er,se[2]=Pe,se[3]=ir,Xe.clearBufferiv(Xe.COLOR,0,se))}else un|=Xe.COLOR_BUFFER_BIT}wn&&(un|=Xe.DEPTH_BUFFER_BIT),Vn&&(un|=Xe.STENCIL_BUFFER_BIT),Xe.clear(un)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){s.removeEventListener("webglcontextlost",yi,!1),s.removeEventListener("webglcontextrestored",On,!1),s.removeEventListener("webglcontextcreationerror",si,!1),pt.dispose(),It.dispose(),Cn.dispose(),In.dispose(),Fn.dispose(),Se.dispose(),Zn.dispose(),Qi.dispose(),Ve.dispose(),ze.dispose(),ze.removeEventListener("sessionstart",cs),ze.removeEventListener("sessionend",ys),ft&&(ft.dispose(),ft=null),Zr.stop()};function yi(Pt){Pt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_e=!0}function On(){console.log("THREE.WebGLRenderer: Context Restored."),_e=!1;const Pt=Pn.autoReset,wn=nn.enabled,Vn=nn.autoUpdate,un=nn.needsUpdate,Gn=nn.type;Mr(),Pn.autoReset=Pt,nn.enabled=wn,nn.autoUpdate=Vn,nn.needsUpdate=un,nn.type=Gn}function si(Pt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Pt.statusMessage)}function di(Pt){const wn=Pt.target;wn.removeEventListener("dispose",di),Mi(wn)}function Mi(Pt){is(Pt),Cn.remove(Pt)}function is(Pt){const wn=Cn.get(Pt).programs;wn!==void 0&&(wn.forEach(function(Vn){Ve.releaseProgram(Vn)}),Pt.isShaderMaterial&&Ve.releaseShaderCache(Pt))}this.renderBufferDirect=function(Pt,wn,Vn,un,Gn,Yi){wn===null&&(wn=Un);const ji=Gn.isMesh&&Gn.matrixWorld.determinant()<0,Er=ja(Pt,wn,Vn,un,Gn);pn.setMaterial(un,ji);let ir=Vn.index,Yn=1;if(un.wireframe===!0){if(ir=fe.getWireframeAttribute(Vn),ir===void 0)return;Yn=2}const er=Vn.drawRange,Pe=Vn.attributes.position;let Le=er.start*Yn,ct=(er.start+er.count)*Yn;Yi!==null&&(Le=Math.max(Le,Yi.start*Yn),ct=Math.min(ct,(Yi.start+Yi.count)*Yn)),ir!==null?(Le=Math.max(Le,0),ct=Math.min(ct,ir.count)):Pe!=null&&(Le=Math.max(Le,0),ct=Math.min(ct,Pe.count));const ht=ct-Le;if(ht<0||ht===1/0)return;Zn.setup(Gn,un,Er,Vn,ir);let Ke,Lt=Ln;if(ir!==null&&(Ke=Hn.get(ir),Lt=Qn,Lt.setIndex(Ke)),Gn.isMesh)un.wireframe===!0?(pn.setLineWidth(un.wireframeLinewidth*pi()),Lt.setMode(Xe.LINES)):Lt.setMode(Xe.TRIANGLES);else if(Gn.isLine){let dt=un.linewidth;dt===void 0&&(dt=1),pn.setLineWidth(dt*pi()),Gn.isLineSegments?Lt.setMode(Xe.LINES):Gn.isLineLoop?Lt.setMode(Xe.LINE_LOOP):Lt.setMode(Xe.LINE_STRIP)}else Gn.isPoints?Lt.setMode(Xe.POINTS):Gn.isSprite&&Lt.setMode(Xe.TRIANGLES);if(Gn.isInstancedMesh)Lt.renderInstances(Le,ht,Gn.count);else if(Vn.isInstancedBufferGeometry){const dt=Vn._maxInstanceCount!==void 0?Vn._maxInstanceCount:1/0,Wt=Math.min(Vn.instanceCount,dt);Lt.renderInstances(Le,ht,Wt)}else Lt.render(Le,ht)},this.compile=function(Pt,wn){function Vn(un,Gn,Yi){un.transparent===!0&&un.side===DoubleSide&&un.forceSinglePass===!1?(un.side=BackSide,un.needsUpdate=!0,Bo(un,Gn,Yi),un.side=FrontSide,un.needsUpdate=!0,Bo(un,Gn,Yi),un.side=DoubleSide):Bo(un,Gn,Yi)}ce=It.get(Pt),ce.init(),X.push(ce),Pt.traverseVisible(function(un){un.isLight&&un.layers.test(wn.layers)&&(ce.pushLight(un),un.castShadow&&ce.pushShadow(un))}),ce.setupLights(W._useLegacyLights),Pt.traverse(function(un){const Gn=un.material;if(Gn)if(Array.isArray(Gn))for(let Yi=0;Yi<Gn.length;Yi++){const ji=Gn[Yi];Vn(ji,Pt,un)}else Vn(Gn,Pt,un)}),X.pop(),ce=null};let jr=null;function Xr(Pt){jr&&jr(Pt)}function cs(){Zr.stop()}function ys(){Zr.start()}const Zr=new WebGLAnimation;Zr.setAnimationLoop(Xr),typeof self<"u"&&Zr.setContext(self),this.setAnimationLoop=function(Pt){jr=Pt,ze.setAnimationLoop(Pt),Pt===null?Zr.stop():Zr.start()},ze.addEventListener("sessionstart",cs),ze.addEventListener("sessionend",ys),this.render=function(Pt,wn){if(wn!==void 0&&wn.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_e===!0)return;Pt.matrixWorldAutoUpdate===!0&&Pt.updateMatrixWorld(),wn.parent===null&&wn.matrixWorldAutoUpdate===!0&&wn.updateMatrixWorld(),ze.enabled===!0&&ze.isPresenting===!0&&(ze.cameraAutoUpdate===!0&&ze.updateCamera(wn),wn=ze.getCamera()),Pt.isScene===!0&&Pt.onBeforeRender(W,Pt,wn,ee),ce=It.get(Pt,X.length),ce.init(),X.push(ce),bt.multiplyMatrices(wn.projectionMatrix,wn.matrixWorldInverse),Nt.setFromProjectionMatrix(bt),Qe=this.localClippingEnabled,Qt=$t.init(this.clippingPlanes,Qe),ve=pt.get(Pt,K.length),ve.init(),K.push(ve),za(Pt,wn,0,W.sortObjects),ve.finish(),W.sortObjects===!0&&ve.sort(it,_t),this.info.render.frame++,Qt===!0&&$t.beginShadows();const Vn=ce.state.shadowsArray;if(nn.render(Vn,Pt,wn),Qt===!0&&$t.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ht.render(ve,Pt),ce.setupLights(W._useLegacyLights),wn.isArrayCamera){const un=wn.cameras;for(let Gn=0,Yi=un.length;Gn<Yi;Gn++){const ji=un[Gn];uo(ve,Pt,ji,ji.viewport)}}else uo(ve,Pt,wn);ee!==null&&(vn.updateMultisampleRenderTarget(ee),vn.updateRenderTargetMipmap(ee)),Pt.isScene===!0&&Pt.onAfterRender(W,Pt,wn),Zn.resetDefaultState(),$=-1,ae=null,X.pop(),X.length>0?ce=X[X.length-1]:ce=null,K.pop(),K.length>0?ve=K[K.length-1]:ve=null};function za(Pt,wn,Vn,un){if(Pt.visible===!1)return;if(Pt.layers.test(wn.layers)){if(Pt.isGroup)Vn=Pt.renderOrder;else if(Pt.isLOD)Pt.autoUpdate===!0&&Pt.update(wn);else if(Pt.isLight)ce.pushLight(Pt),Pt.castShadow&&ce.pushShadow(Pt);else if(Pt.isSprite){if(!Pt.frustumCulled||Nt.intersectsSprite(Pt)){un&&bn.setFromMatrixPosition(Pt.matrixWorld).applyMatrix4(bt);const ji=Se.update(Pt),Er=Pt.material;Er.visible&&ve.push(Pt,ji,Er,Vn,bn.z,null)}}else if((Pt.isMesh||Pt.isLine||Pt.isPoints)&&(!Pt.frustumCulled||Nt.intersectsObject(Pt))){const ji=Se.update(Pt),Er=Pt.material;if(un&&(Pt.boundingSphere!==void 0?(Pt.boundingSphere===null&&Pt.computeBoundingSphere(),bn.copy(Pt.boundingSphere.center)):(ji.boundingSphere===null&&ji.computeBoundingSphere(),bn.copy(ji.boundingSphere.center)),bn.applyMatrix4(Pt.matrixWorld).applyMatrix4(bt)),Array.isArray(Er)){const ir=ji.groups;for(let Yn=0,er=ir.length;Yn<er;Yn++){const Pe=ir[Yn],Le=Er[Pe.materialIndex];Le&&Le.visible&&ve.push(Pt,ji,Le,Vn,bn.z,Pe)}}else Er.visible&&ve.push(Pt,ji,Er,Vn,bn.z,null)}}const Yi=Pt.children;for(let ji=0,Er=Yi.length;ji<Er;ji++)za(Yi[ji],wn,Vn,un)}function uo(Pt,wn,Vn,un){const Gn=Pt.opaque,Yi=Pt.transmissive,ji=Pt.transparent;ce.setupLightsView(Vn),Qt===!0&&$t.setGlobalState(W.clippingPlanes,Vn),Yi.length>0&&sa(Gn,Yi,wn,Vn),un&&pn.viewport(Re.copy(un)),Gn.length>0&&oa(Gn,wn,Vn),Yi.length>0&&oa(Yi,wn,Vn),ji.length>0&&oa(ji,wn,Vn),pn.buffers.depth.setTest(!0),pn.buffers.depth.setMask(!0),pn.buffers.color.setMask(!0),pn.setPolygonOffset(!1)}function sa(Pt,wn,Vn,un){const Gn=dn.isWebGL2;ft===null&&(ft=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:tn.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:Gn?4:0})),W.getDrawingBufferSize(sn),Gn?ft.setSize(sn.x,sn.y):ft.setSize(floorPowerOfTwo(sn.x),floorPowerOfTwo(sn.y));const Yi=W.getRenderTarget();W.setRenderTarget(ft),W.getClearColor(we),Ce=W.getClearAlpha(),Ce<1&&W.setClearColor(16777215,.5),W.clear();const ji=W.toneMapping;W.toneMapping=NoToneMapping,oa(Pt,Vn,un),vn.updateMultisampleRenderTarget(ft),vn.updateRenderTargetMipmap(ft);let Er=!1;for(let ir=0,Yn=wn.length;ir<Yn;ir++){const er=wn[ir],Pe=er.object,Le=er.geometry,ct=er.material,ht=er.group;if(ct.side===DoubleSide&&Pe.layers.test(un.layers)){const Ke=ct.side;ct.side=BackSide,ct.needsUpdate=!0,Oo(Pe,Vn,un,Le,ct,ht),ct.side=Ke,ct.needsUpdate=!0,Er=!0}}Er===!0&&(vn.updateMultisampleRenderTarget(ft),vn.updateRenderTargetMipmap(ft)),W.setRenderTarget(Yi),W.setClearColor(we,Ce),W.toneMapping=ji}function oa(Pt,wn,Vn){const un=wn.isScene===!0?wn.overrideMaterial:null;for(let Gn=0,Yi=Pt.length;Gn<Yi;Gn++){const ji=Pt[Gn],Er=ji.object,ir=ji.geometry,Yn=un===null?ji.material:un,er=ji.group;Er.layers.test(Vn.layers)&&Oo(Er,wn,Vn,ir,Yn,er)}}function Oo(Pt,wn,Vn,un,Gn,Yi){Pt.onBeforeRender(W,wn,Vn,un,Gn,Yi),Pt.modelViewMatrix.multiplyMatrices(Vn.matrixWorldInverse,Pt.matrixWorld),Pt.normalMatrix.getNormalMatrix(Pt.modelViewMatrix),Gn.onBeforeRender(W,wn,Vn,un,Pt,Yi),Gn.transparent===!0&&Gn.side===DoubleSide&&Gn.forceSinglePass===!1?(Gn.side=BackSide,Gn.needsUpdate=!0,W.renderBufferDirect(Vn,wn,un,Gn,Pt,Yi),Gn.side=FrontSide,Gn.needsUpdate=!0,W.renderBufferDirect(Vn,wn,un,Gn,Pt,Yi),Gn.side=DoubleSide):W.renderBufferDirect(Vn,wn,un,Gn,Pt,Yi),Pt.onAfterRender(W,wn,Vn,un,Gn,Yi)}function Bo(Pt,wn,Vn){wn.isScene!==!0&&(wn=Un);const un=Cn.get(Pt),Gn=ce.state.lights,Yi=ce.state.shadowsArray,ji=Gn.state.version,Er=Ve.getParameters(Pt,Gn.state,Yi,wn,Vn),ir=Ve.getProgramCacheKey(Er);let Yn=un.programs;un.environment=Pt.isMeshStandardMaterial?wn.environment:null,un.fog=wn.fog,un.envMap=(Pt.isMeshStandardMaterial?Fn:In).get(Pt.envMap||un.environment),Yn===void 0&&(Pt.addEventListener("dispose",di),Yn=new Map,un.programs=Yn);let er=Yn.get(ir);if(er!==void 0){if(un.currentProgram===er&&un.lightsStateVersion===ji)return Hl(Pt,Er),er}else Er.uniforms=Ve.getUniforms(Pt),Pt.onBuild(Vn,Er,W),Pt.onBeforeCompile(Er,W),er=Ve.acquireProgram(Er,ir),Yn.set(ir,er),un.uniforms=Er.uniforms;const Pe=un.uniforms;(!Pt.isShaderMaterial&&!Pt.isRawShaderMaterial||Pt.clipping===!0)&&(Pe.clippingPlanes=$t.uniform),Hl(Pt,Er),un.needsLights=Lo(Pt),un.lightsStateVersion=ji,un.needsLights&&(Pe.ambientLightColor.value=Gn.state.ambient,Pe.lightProbe.value=Gn.state.probe,Pe.directionalLights.value=Gn.state.directional,Pe.directionalLightShadows.value=Gn.state.directionalShadow,Pe.spotLights.value=Gn.state.spot,Pe.spotLightShadows.value=Gn.state.spotShadow,Pe.rectAreaLights.value=Gn.state.rectArea,Pe.ltc_1.value=Gn.state.rectAreaLTC1,Pe.ltc_2.value=Gn.state.rectAreaLTC2,Pe.pointLights.value=Gn.state.point,Pe.pointLightShadows.value=Gn.state.pointShadow,Pe.hemisphereLights.value=Gn.state.hemi,Pe.directionalShadowMap.value=Gn.state.directionalShadowMap,Pe.directionalShadowMatrix.value=Gn.state.directionalShadowMatrix,Pe.spotShadowMap.value=Gn.state.spotShadowMap,Pe.spotLightMatrix.value=Gn.state.spotLightMatrix,Pe.spotLightMap.value=Gn.state.spotLightMap,Pe.pointShadowMap.value=Gn.state.pointShadowMap,Pe.pointShadowMatrix.value=Gn.state.pointShadowMatrix);const Le=er.getUniforms(),ct=WebGLUniforms.seqWithValue(Le.seq,Pe);return un.currentProgram=er,un.uniformsList=ct,er}function Hl(Pt,wn){const Vn=Cn.get(Pt);Vn.outputColorSpace=wn.outputColorSpace,Vn.instancing=wn.instancing,Vn.instancingColor=wn.instancingColor,Vn.skinning=wn.skinning,Vn.morphTargets=wn.morphTargets,Vn.morphNormals=wn.morphNormals,Vn.morphColors=wn.morphColors,Vn.morphTargetsCount=wn.morphTargetsCount,Vn.numClippingPlanes=wn.numClippingPlanes,Vn.numIntersection=wn.numClipIntersection,Vn.vertexAlphas=wn.vertexAlphas,Vn.vertexTangents=wn.vertexTangents,Vn.toneMapping=wn.toneMapping}function ja(Pt,wn,Vn,un,Gn){wn.isScene!==!0&&(wn=Un),vn.resetTextureUnits();const Yi=wn.fog,ji=un.isMeshStandardMaterial?wn.environment:null,Er=ee===null?W.outputColorSpace:ee.isXRRenderTarget===!0?ee.texture.colorSpace:LinearSRGBColorSpace,ir=(un.isMeshStandardMaterial?Fn:In).get(un.envMap||ji),Yn=un.vertexColors===!0&&!!Vn.attributes.color&&Vn.attributes.color.itemSize===4,er=!!Vn.attributes.tangent&&(!!un.normalMap||un.anisotropy>0),Pe=!!Vn.morphAttributes.position,Le=!!Vn.morphAttributes.normal,ct=!!Vn.morphAttributes.color;let ht=NoToneMapping;un.toneMapped&&(ee===null||ee.isXRRenderTarget===!0)&&(ht=W.toneMapping);const Ke=Vn.morphAttributes.position||Vn.morphAttributes.normal||Vn.morphAttributes.color,Lt=Ke!==void 0?Ke.length:0,dt=Cn.get(un),Wt=ce.state.lights;if(Qt===!0&&(Qe===!0||Pt!==ae)){const Kn=Pt===ae&&un.id===$;$t.setState(un,Pt,Kn)}let rn=!1;un.version===dt.__version?(dt.needsLights&&dt.lightsStateVersion!==Wt.state.version||dt.outputColorSpace!==Er||Gn.isInstancedMesh&&dt.instancing===!1||!Gn.isInstancedMesh&&dt.instancing===!0||Gn.isSkinnedMesh&&dt.skinning===!1||!Gn.isSkinnedMesh&&dt.skinning===!0||Gn.isInstancedMesh&&dt.instancingColor===!0&&Gn.instanceColor===null||Gn.isInstancedMesh&&dt.instancingColor===!1&&Gn.instanceColor!==null||dt.envMap!==ir||un.fog===!0&&dt.fog!==Yi||dt.numClippingPlanes!==void 0&&(dt.numClippingPlanes!==$t.numPlanes||dt.numIntersection!==$t.numIntersection)||dt.vertexAlphas!==Yn||dt.vertexTangents!==er||dt.morphTargets!==Pe||dt.morphNormals!==Le||dt.morphColors!==ct||dt.toneMapping!==ht||dn.isWebGL2===!0&&dt.morphTargetsCount!==Lt)&&(rn=!0):(rn=!0,dt.__version=un.version);let on=dt.currentProgram;rn===!0&&(on=Bo(un,wn,Gn));let gn=!1,Xn=!1,an=!1;const ui=on.getUniforms(),Ai=dt.uniforms;if(pn.useProgram(on.program)&&(gn=!0,Xn=!0,an=!0),un.id!==$&&($=un.id,Xn=!0),gn||ae!==Pt){if(ui.setValue(Xe,"projectionMatrix",Pt.projectionMatrix),dn.logarithmicDepthBuffer&&ui.setValue(Xe,"logDepthBufFC",2/(Math.log(Pt.far+1)/Math.LN2)),ae!==Pt&&(ae=Pt,Xn=!0,an=!0),un.isShaderMaterial||un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshStandardMaterial||un.envMap){const Kn=ui.map.cameraPosition;Kn!==void 0&&Kn.setValue(Xe,bn.setFromMatrixPosition(Pt.matrixWorld))}(un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshLambertMaterial||un.isMeshBasicMaterial||un.isMeshStandardMaterial||un.isShaderMaterial)&&ui.setValue(Xe,"isOrthographic",Pt.isOrthographicCamera===!0),(un.isMeshPhongMaterial||un.isMeshToonMaterial||un.isMeshLambertMaterial||un.isMeshBasicMaterial||un.isMeshStandardMaterial||un.isShaderMaterial||un.isShadowMaterial||Gn.isSkinnedMesh)&&ui.setValue(Xe,"viewMatrix",Pt.matrixWorldInverse)}if(Gn.isSkinnedMesh){ui.setOptional(Xe,Gn,"bindMatrix"),ui.setOptional(Xe,Gn,"bindMatrixInverse");const Kn=Gn.skeleton;Kn&&(dn.floatVertexTextures?(Kn.boneTexture===null&&Kn.computeBoneTexture(),ui.setValue(Xe,"boneTexture",Kn.boneTexture,vn),ui.setValue(Xe,"boneTextureSize",Kn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Bn=Vn.morphAttributes;if((Bn.position!==void 0||Bn.normal!==void 0||Bn.color!==void 0&&dn.isWebGL2===!0)&&Wn.update(Gn,Vn,on),(Xn||dt.receiveShadow!==Gn.receiveShadow)&&(dt.receiveShadow=Gn.receiveShadow,ui.setValue(Xe,"receiveShadow",Gn.receiveShadow)),un.isMeshGouraudMaterial&&un.envMap!==null&&(Ai.envMap.value=ir,Ai.flipEnvMap.value=ir.isCubeTexture&&ir.isRenderTargetTexture===!1?-1:1),Xn&&(ui.setValue(Xe,"toneMappingExposure",W.toneMappingExposure),dt.needsLights&&Ma(Ai,an),Yi&&un.fog===!0&&We.refreshFogUniforms(Ai,Yi),We.refreshMaterialUniforms(Ai,un,Ye,Ze,ft),WebGLUniforms.upload(Xe,dt.uniformsList,Ai,vn)),un.isShaderMaterial&&un.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Xe,dt.uniformsList,Ai,vn),un.uniformsNeedUpdate=!1),un.isSpriteMaterial&&ui.setValue(Xe,"center",Gn.center),ui.setValue(Xe,"modelViewMatrix",Gn.modelViewMatrix),ui.setValue(Xe,"normalMatrix",Gn.normalMatrix),ui.setValue(Xe,"modelMatrix",Gn.matrixWorld),un.isShaderMaterial||un.isRawShaderMaterial){const Kn=un.uniformsGroups;for(let Mn=0,Ci=Kn.length;Mn<Ci;Mn++)if(dn.isWebGL2){const Hi=Kn[Mn];Qi.update(Hi,on),Qi.bind(Hi,on)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return on}function Ma(Pt,wn){Pt.ambientLightColor.needsUpdate=wn,Pt.lightProbe.needsUpdate=wn,Pt.directionalLights.needsUpdate=wn,Pt.directionalLightShadows.needsUpdate=wn,Pt.pointLights.needsUpdate=wn,Pt.pointLightShadows.needsUpdate=wn,Pt.spotLights.needsUpdate=wn,Pt.spotLightShadows.needsUpdate=wn,Pt.rectAreaLights.needsUpdate=wn,Pt.hemisphereLights.needsUpdate=wn}function Lo(Pt){return Pt.isMeshLambertMaterial||Pt.isMeshToonMaterial||Pt.isMeshPhongMaterial||Pt.isMeshStandardMaterial||Pt.isShadowMaterial||Pt.isShaderMaterial&&Pt.lights===!0}this.getActiveCubeFace=function(){return ge},this.getActiveMipmapLevel=function(){return Ae},this.getRenderTarget=function(){return ee},this.setRenderTargetTextures=function(Pt,wn,Vn){Cn.get(Pt.texture).__webglTexture=wn,Cn.get(Pt.depthTexture).__webglTexture=Vn;const un=Cn.get(Pt);un.__hasExternalTextures=!0,un.__hasExternalTextures&&(un.__autoAllocateDepthBuffer=Vn===void 0,un.__autoAllocateDepthBuffer||tn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),un.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Pt,wn){const Vn=Cn.get(Pt);Vn.__webglFramebuffer=wn,Vn.__useDefaultFramebuffer=wn===void 0},this.setRenderTarget=function(Pt,wn=0,Vn=0){ee=Pt,ge=wn,Ae=Vn;let un=!0,Gn=null,Yi=!1,ji=!1;if(Pt){const ir=Cn.get(Pt);ir.__useDefaultFramebuffer!==void 0?(pn.bindFramebuffer(Xe.FRAMEBUFFER,null),un=!1):ir.__webglFramebuffer===void 0?vn.setupRenderTarget(Pt):ir.__hasExternalTextures&&vn.rebindTextures(Pt,Cn.get(Pt.texture).__webglTexture,Cn.get(Pt.depthTexture).__webglTexture);const Yn=Pt.texture;(Yn.isData3DTexture||Yn.isDataArrayTexture||Yn.isCompressedArrayTexture)&&(ji=!0);const er=Cn.get(Pt).__webglFramebuffer;Pt.isWebGLCubeRenderTarget?(Array.isArray(er[wn])?Gn=er[wn][Vn]:Gn=er[wn],Yi=!0):dn.isWebGL2&&Pt.samples>0&&vn.useMultisampledRTT(Pt)===!1?Gn=Cn.get(Pt).__webglMultisampledFramebuffer:Array.isArray(er)?Gn=er[Vn]:Gn=er,Re.copy(Pt.viewport),pe.copy(Pt.scissor),he=Pt.scissorTest}else Re.copy(At).multiplyScalar(Ye).floor(),pe.copy(vt).multiplyScalar(Ye).floor(),he=ut;if(pn.bindFramebuffer(Xe.FRAMEBUFFER,Gn)&&dn.drawBuffers&&un&&pn.drawBuffers(Pt,Gn),pn.viewport(Re),pn.scissor(pe),pn.setScissorTest(he),Yi){const ir=Cn.get(Pt.texture);Xe.framebufferTexture2D(Xe.FRAMEBUFFER,Xe.COLOR_ATTACHMENT0,Xe.TEXTURE_CUBE_MAP_POSITIVE_X+wn,ir.__webglTexture,Vn)}else if(ji){const ir=Cn.get(Pt.texture),Yn=wn||0;Xe.framebufferTextureLayer(Xe.FRAMEBUFFER,Xe.COLOR_ATTACHMENT0,ir.__webglTexture,Vn||0,Yn)}$=-1},this.readRenderTargetPixels=function(Pt,wn,Vn,un,Gn,Yi,ji){if(!(Pt&&Pt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Er=Cn.get(Pt).__webglFramebuffer;if(Pt.isWebGLCubeRenderTarget&&ji!==void 0&&(Er=Er[ji]),Er){pn.bindFramebuffer(Xe.FRAMEBUFFER,Er);try{const ir=Pt.texture,Yn=ir.format,er=ir.type;if(Yn!==RGBAFormat&&Nn.convert(Yn)!==Xe.getParameter(Xe.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Pe=er===HalfFloatType&&(tn.has("EXT_color_buffer_half_float")||dn.isWebGL2&&tn.has("EXT_color_buffer_float"));if(er!==UnsignedByteType&&Nn.convert(er)!==Xe.getParameter(Xe.IMPLEMENTATION_COLOR_READ_TYPE)&&!(er===FloatType&&(dn.isWebGL2||tn.has("OES_texture_float")||tn.has("WEBGL_color_buffer_float")))&&!Pe){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}wn>=0&&wn<=Pt.width-un&&Vn>=0&&Vn<=Pt.height-Gn&&Xe.readPixels(wn,Vn,un,Gn,Nn.convert(Yn),Nn.convert(er),Yi)}finally{const ir=ee!==null?Cn.get(ee).__webglFramebuffer:null;pn.bindFramebuffer(Xe.FRAMEBUFFER,ir)}}},this.copyFramebufferToTexture=function(Pt,wn,Vn=0){const un=Math.pow(2,-Vn),Gn=Math.floor(wn.image.width*un),Yi=Math.floor(wn.image.height*un);vn.setTexture2D(wn,0),Xe.copyTexSubImage2D(Xe.TEXTURE_2D,Vn,0,0,Pt.x,Pt.y,Gn,Yi),pn.unbindTexture()},this.copyTextureToTexture=function(Pt,wn,Vn,un=0){const Gn=wn.image.width,Yi=wn.image.height,ji=Nn.convert(Vn.format),Er=Nn.convert(Vn.type);vn.setTexture2D(Vn,0),Xe.pixelStorei(Xe.UNPACK_FLIP_Y_WEBGL,Vn.flipY),Xe.pixelStorei(Xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Vn.premultiplyAlpha),Xe.pixelStorei(Xe.UNPACK_ALIGNMENT,Vn.unpackAlignment),wn.isDataTexture?Xe.texSubImage2D(Xe.TEXTURE_2D,un,Pt.x,Pt.y,Gn,Yi,ji,Er,wn.image.data):wn.isCompressedTexture?Xe.compressedTexSubImage2D(Xe.TEXTURE_2D,un,Pt.x,Pt.y,wn.mipmaps[0].width,wn.mipmaps[0].height,ji,wn.mipmaps[0].data):Xe.texSubImage2D(Xe.TEXTURE_2D,un,Pt.x,Pt.y,ji,Er,wn.image),un===0&&Vn.generateMipmaps&&Xe.generateMipmap(Xe.TEXTURE_2D),pn.unbindTexture()},this.copyTextureToTexture3D=function(Pt,wn,Vn,un,Gn=0){if(W.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Yi=Pt.max.x-Pt.min.x+1,ji=Pt.max.y-Pt.min.y+1,Er=Pt.max.z-Pt.min.z+1,ir=Nn.convert(un.format),Yn=Nn.convert(un.type);let er;if(un.isData3DTexture)vn.setTexture3D(un,0),er=Xe.TEXTURE_3D;else if(un.isDataArrayTexture)vn.setTexture2DArray(un,0),er=Xe.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Xe.pixelStorei(Xe.UNPACK_FLIP_Y_WEBGL,un.flipY),Xe.pixelStorei(Xe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,un.premultiplyAlpha),Xe.pixelStorei(Xe.UNPACK_ALIGNMENT,un.unpackAlignment);const Pe=Xe.getParameter(Xe.UNPACK_ROW_LENGTH),Le=Xe.getParameter(Xe.UNPACK_IMAGE_HEIGHT),ct=Xe.getParameter(Xe.UNPACK_SKIP_PIXELS),ht=Xe.getParameter(Xe.UNPACK_SKIP_ROWS),Ke=Xe.getParameter(Xe.UNPACK_SKIP_IMAGES),Lt=Vn.isCompressedTexture?Vn.mipmaps[0]:Vn.image;Xe.pixelStorei(Xe.UNPACK_ROW_LENGTH,Lt.width),Xe.pixelStorei(Xe.UNPACK_IMAGE_HEIGHT,Lt.height),Xe.pixelStorei(Xe.UNPACK_SKIP_PIXELS,Pt.min.x),Xe.pixelStorei(Xe.UNPACK_SKIP_ROWS,Pt.min.y),Xe.pixelStorei(Xe.UNPACK_SKIP_IMAGES,Pt.min.z),Vn.isDataTexture||Vn.isData3DTexture?Xe.texSubImage3D(er,Gn,wn.x,wn.y,wn.z,Yi,ji,Er,ir,Yn,Lt.data):Vn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Xe.compressedTexSubImage3D(er,Gn,wn.x,wn.y,wn.z,Yi,ji,Er,ir,Lt.data)):Xe.texSubImage3D(er,Gn,wn.x,wn.y,wn.z,Yi,ji,Er,ir,Yn,Lt),Xe.pixelStorei(Xe.UNPACK_ROW_LENGTH,Pe),Xe.pixelStorei(Xe.UNPACK_IMAGE_HEIGHT,Le),Xe.pixelStorei(Xe.UNPACK_SKIP_PIXELS,ct),Xe.pixelStorei(Xe.UNPACK_SKIP_ROWS,ht),Xe.pixelStorei(Xe.UNPACK_SKIP_IMAGES,Ke),Gn===0&&un.generateMipmaps&&Xe.generateMipmap(er),pn.unbindTexture()},this.initTexture=function(Pt){Pt.isCubeTexture?vn.setTextureCube(Pt,0):Pt.isData3DTexture?vn.setTexture3D(Pt,0):Pt.isDataArrayTexture||Pt.isCompressedArrayTexture?vn.setTexture2DArray(Pt,0):vn.setTexture2D(Pt,0),pn.unbindTexture()},this.resetState=function(){ge=0,Ae=0,ee=null,pn.reset(),Zn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(a){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!a}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(a){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=a===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(a){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=a}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,s){return super.copy(a,s),a.background!==null&&(this.background=a.background.clone()),a.environment!==null&&(this.environment=a.environment.clone()),a.fog!==null&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,a.overrideMaterial!==null&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){const s=super.toJSON(a);return this.fog!==null&&(s.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(s.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(s.object.backgroundIntensity=this.backgroundIntensity),s}}const Cache$1={enabled:!1,files:{},add:function(u,a){this.enabled!==!1&&(this.files[u]=a)},get:function(u){if(this.enabled!==!1)return this.files[u]},remove:function(u){delete this.files[u]},clear:function(){this.files={}}};class LoadingManager{constructor(a,s,v){const x=this;let M=!1,I=0,B=0,U;const j=[];this.onStart=void 0,this.onLoad=a,this.onProgress=s,this.onError=v,this.itemStart=function(te){B++,M===!1&&x.onStart!==void 0&&x.onStart(te,I,B),M=!0},this.itemEnd=function(te){I++,x.onProgress!==void 0&&x.onProgress(te,I,B),I===B&&(M=!1,x.onLoad!==void 0&&x.onLoad())},this.itemError=function(te){x.onError!==void 0&&x.onError(te)},this.resolveURL=function(te){return U?U(te):te},this.setURLModifier=function(te){return U=te,this},this.addHandler=function(te,Z){return j.push(te,Z),this},this.removeHandler=function(te){const Z=j.indexOf(te);return Z!==-1&&j.splice(Z,2),this},this.getHandler=function(te){for(let Z=0,oe=j.length;Z<oe;Z+=2){const le=j[Z],se=j[Z+1];if(le.global&&(le.lastIndex=0),le.test(te))return se}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(a){this.manager=a!==void 0?a:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,s){const v=this;return new Promise(function(x,M){v.load(a,x,s,M)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";class ImageLoader extends Loader{constructor(a){super(a)}load(a,s,v,x){this.path!==void 0&&(a=this.path+a),a=this.manager.resolveURL(a);const M=this,I=Cache$1.get(a);if(I!==void 0)return M.manager.itemStart(a),setTimeout(function(){s&&s(I),M.manager.itemEnd(a)},0),I;const B=createElementNS("img");function U(){te(),Cache$1.add(a,this),s&&s(this),M.manager.itemEnd(a)}function j(Z){te(),x&&x(Z),M.manager.itemError(a),M.manager.itemEnd(a)}function te(){B.removeEventListener("load",U,!1),B.removeEventListener("error",j,!1)}return B.addEventListener("load",U,!1),B.addEventListener("error",j,!1),a.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(B.crossOrigin=this.crossOrigin),M.manager.itemStart(a),B.src=a,B}}class TextureLoader extends Loader{constructor(a){super(a)}load(a,s,v,x){const M=new Texture,I=new ImageLoader(this.manager);return I.setCrossOrigin(this.crossOrigin),I.setPath(this.path),I.load(a,function(B){M.image=B,M.needsUpdate=!0,s!==void 0&&s(M)},v,x),M}}class Clock{constructor(a=!0){this.autoStart=a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const s=now();a=(s-this.oldTime)/1e3,this.oldTime=s,this.elapsedTime+=a}return a}}function now(){return(typeof performance>"u"?Date:performance).now()}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);class Slider{constructor(){this.bindAll(),this.vert=`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
      `,this.frag=`
      varying vec2 vUv;
  
      uniform sampler2D texture1;
      uniform sampler2D texture2;
      uniform sampler2D disp;
  
      uniform float dispPower;
      uniform float intensity;
  
      uniform vec2 size;
      uniform vec2 res;
  
      vec2 backgroundCoverUv( vec2 screenSize, vec2 imageSize, vec2 uv ) {
        float screenRatio = screenSize.x / screenSize.y;
        float imageRatio = imageSize.x / imageSize.y;
        vec2 newSize = screenRatio < imageRatio 
            ? vec2(imageSize.x * (screenSize.y / imageSize.y), screenSize.y)
            : vec2(screenSize.x, imageSize.y * (screenSize.x / imageSize.x));
        vec2 newOffset = (screenRatio < imageRatio 
            ? vec2((newSize.x - screenSize.x) / 2.0, 0.0) 
            : vec2(0.0, (newSize.y - screenSize.y) / 2.0)) / newSize;
        return uv * screenSize / newSize + newOffset;
      }
  
      void main() {
        vec2 uv = vUv;
        
        vec4 disp = texture2D(disp, uv);
        vec2 dispVec = vec2(disp.x, disp.y);
        
        vec2 distPos1 = uv + (dispVec * intensity * dispPower);
        vec2 distPos2 = uv + (dispVec * -(intensity * (1.0 - dispPower)));
        
        vec4 _texture1 = texture2D(texture1, distPos1);
        vec4 _texture2 = texture2D(texture2, distPos2);
        
        gl_FragColor = mix(_texture1, _texture2, dispPower);
      }
      `,this.el=document.querySelector(".js-slider"),this.inner=this.el.querySelector(".js-slider__inner"),this.slides=[...this.el.querySelectorAll(".js-slide")],this.bullets=[...this.el.querySelectorAll(".js-slider-bullet")],this.renderer=null,this.scene=null,this.clock=null,this.camera=null,this.images=["./images/bg1.jpg","./images/bg2.jpg","./images/bg3.jpeg"],this.data={current:0,next:1,total:this.images.length-1,delta:0},this.state={animating:!1,text:!1,initial:!0},this.textures=null,this.init()}bindAll(){["render","nextSlide"].forEach(a=>this[a]=this[a].bind(this))}setStyles(){this.slides.forEach((a,s)=>{s!==0&&TweenMax.set(a,{autoAlpha:0})}),this.bullets.forEach((a,s)=>{if(s===0)return;const v=a.querySelector(".js-slider-bullet__text"),x=a.querySelector(".js-slider-bullet__line");TweenMax.set(v,{alpha:.25}),TweenMax.set(x,{scaleX:0,transformOrigin:"left"})})}cameraSetup(){this.camera=new OrthographicCamera(this.el.offsetWidth/-2,this.el.offsetWidth/2,this.el.offsetHeight/2,this.el.offsetHeight/-2,1,1e3),this.camera.lookAt(this.scene.position),this.camera.position.z=1}setup(){this.scene=new Scene,this.clock=new Clock(!0),this.renderer=new WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.el.offsetWidth,this.el.offsetHeight),this.inner.appendChild(this.renderer.domElement)}loadTextures(){const a=new TextureLoader;a.crossOrigin="",this.textures=[],this.images.forEach((s,v)=>{const x=a.load(s+"?v="+Date.now(),this.render);x.minFilter=LinearFilter,x.generateMipmaps=!1,v===0&&this.mat&&(this.mat.uniforms.size.value=[x.image.naturalWidth,x.image.naturalHeight]),this.textures.push(x)}),this.disp=a.load("https://s3-us-west-2.amazonaws.com/s.cdpn.io/58281/rock-_disp.png",this.render),this.disp.magFilter=this.disp.minFilter=LinearFilter,this.disp.wrapS=this.disp.wrapT=RepeatWrapping}createMesh(){this.mat=new ShaderMaterial({uniforms:{dispPower:{type:"f",value:0},intensity:{type:"f",value:.5},res:{value:new Vector2(window.innerWidth,window.innerHeight)},size:{value:new Vector2(1,1)},texture1:{type:"t",value:this.textures[0]},texture2:{type:"t",value:this.textures[1]},disp:{type:"t",value:this.disp}},transparent:!0,vertexShader:this.vert,fragmentShader:this.frag});const a=new PlaneGeometry(this.el.offsetWidth,this.el.offsetHeight,1),s=new Mesh(a,this.mat);this.scene.add(s)}transitionNext(){TweenMax.to(this.mat.uniforms.dispPower,2.5,{value:1,ease:Expo.easeInOut,onUpdate:this.render,onComplete:()=>{this.mat.uniforms.dispPower.value=0,this.changeTexture(),this.render.bind(this),this.state.animating=!1}});const a=this.slides[this.data.current],s=this.slides[this.data.next],v=a.querySelectorAll(".js-slide__img"),x=s.querySelectorAll(".js-slide__img"),M=a.querySelectorAll(".js-slider__text-line div"),I=s.querySelectorAll(".js-slider__text-line div"),B=this.bullets[this.data.current],U=this.bullets[this.data.next],j=B.querySelectorAll(".js-slider-bullet__text"),te=U.querySelectorAll(".js-slider-bullet__text"),Z=B.querySelectorAll(".js-slider-bullet__line"),oe=U.querySelectorAll(".js-slider-bullet__line"),le=new TimelineMax({paused:!0});this.state.initial&&(TweenMax.to(".js-scroll",1.5,{yPercent:100,alpha:0,ease:Power4.easeInOut}),this.state.initial=!1),le.staggerFromTo(v,1.5,{yPercent:0,scale:1},{yPercent:-185,scaleY:1.5,ease:Expo.easeInOut},.075).to(j,1.5,{alpha:.25,ease:Linear.easeNone},0).set(Z,{transformOrigin:"right"},0).to(Z,1.5,{scaleX:0,ease:Expo.easeInOut},0),M&&le.fromTo(M,2,{yPercent:0},{yPercent:-100,ease:Power4.easeInOut},0),le.set(a,{autoAlpha:0}).set(s,{autoAlpha:1},1),I&&le.fromTo(I,2,{yPercent:100},{yPercent:0,ease:Power4.easeOut},1.5),le.staggerFromTo(x,1.5,{yPercent:150,scaleY:1.5},{yPercent:0,scaleY:1,ease:Expo.easeInOut},.075,1).to(te,1.5,{alpha:1,ease:Linear.easeNone},1).set(oe,{transformOrigin:"left"},1).to(oe,1.5,{scaleX:1,ease:Expo.easeInOut},1),le.play()}prevSlide(){}nextSlide(){this.state.animating||(this.state.animating=!0,this.transitionNext(),this.data.current=this.data.current===this.data.total?0:this.data.current+1,this.data.next=this.data.current===this.data.total?0:this.data.current+1)}changeTexture(){this.mat.uniforms.texture1.value=this.textures[this.data.current],this.mat.uniforms.texture2.value=this.textures[this.data.next]}listeners(){window.addEventListener("wheel",this.nextSlide,{passive:!0})}render(){this.renderer.render(this.scene,this.camera)}init(){this.setup(),this.cameraSetup(),this.loadTextures(),this.createMesh(),this.setStyles(),this.render(),this.listeners()}}function makeMap(u,a){const s=Object.create(null),v=u.split(",");for(let x=0;x<v.length;x++)s[v[x]]=!0;return a?x=>!!s[x.toLowerCase()]:x=>!!s[x]}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,onRE=/^on[^a-z]/,isOn=u=>onRE.test(u),isModelListener=u=>u.startsWith("onUpdate:"),extend=Object.assign,remove=(u,a)=>{const s=u.indexOf(a);s>-1&&u.splice(s,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn=(u,a)=>hasOwnProperty$1.call(u,a),isArray=Array.isArray,isMap=u=>toTypeString(u)==="[object Map]",isSet=u=>toTypeString(u)==="[object Set]",isDate=u=>toTypeString(u)==="[object Date]",isRegExp=u=>toTypeString(u)==="[object RegExp]",isFunction=u=>typeof u=="function",isString=u=>typeof u=="string",isSymbol=u=>typeof u=="symbol",isObject=u=>u!==null&&typeof u=="object",isPromise=u=>isObject(u)&&isFunction(u.then)&&isFunction(u.catch),objectToString=Object.prototype.toString,toTypeString=u=>objectToString.call(u),toRawType=u=>toTypeString(u).slice(8,-1),isPlainObject=u=>toTypeString(u)==="[object Object]",isIntegerKey=u=>isString(u)&&u!=="NaN"&&u[0]!=="-"&&""+parseInt(u,10)===u,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),isBuiltInDirective=makeMap("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),cacheStringFunction=u=>{const a=Object.create(null);return s=>a[s]||(a[s]=u(s))},camelizeRE=/-(\w)/g,camelize=cacheStringFunction(u=>u.replace(camelizeRE,(a,s)=>s?s.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(u=>u.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(u=>u.charAt(0).toUpperCase()+u.slice(1)),toHandlerKey=cacheStringFunction(u=>u?`on${capitalize(u)}`:""),hasChanged=(u,a)=>!Object.is(u,a),invokeArrayFns=(u,a)=>{for(let s=0;s<u.length;s++)u[s](a)},def=(u,a,s)=>{Object.defineProperty(u,a,{configurable:!0,enumerable:!1,value:s})},looseToNumber=u=>{const a=parseFloat(u);return isNaN(a)?u:a},toNumber=u=>{const a=isString(u)?Number(u):NaN;return isNaN(a)?u:a};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),GLOBALS_WHITE_LISTED="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console",isGloballyWhitelisted=makeMap(GLOBALS_WHITE_LISTED);function normalizeStyle(u){if(isArray(u)){const a={};for(let s=0;s<u.length;s++){const v=u[s],x=isString(v)?parseStringStyle(v):normalizeStyle(v);if(x)for(const M in x)a[M]=x[M]}return a}else{if(isString(u))return u;if(isObject(u))return u}}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(u){const a={};return u.replace(styleCommentRE,"").split(listDelimiterRE).forEach(s=>{if(s){const v=s.split(propertyDelimiterRE);v.length>1&&(a[v[0].trim()]=v[1].trim())}}),a}function normalizeClass(u){let a="";if(isString(u))a=u;else if(isArray(u))for(let s=0;s<u.length;s++){const v=normalizeClass(u[s]);v&&(a+=v+" ")}else if(isObject(u))for(const s in u)u[s]&&(a+=s+" ");return a.trim()}function normalizeProps(u){if(!u)return null;let{class:a,style:s}=u;return a&&!isString(a)&&(u.class=normalizeClass(a)),s&&(u.style=normalizeStyle(s)),u}const HTML_TAGS="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,hgroup,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",SVG_TAGS="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",VOID_TAGS="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",isHTMLTag=makeMap(HTML_TAGS),isSVGTag=makeMap(SVG_TAGS),isVoidTag=makeMap(VOID_TAGS),specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(u){return!!u||u===""}function looseCompareArrays(u,a){if(u.length!==a.length)return!1;let s=!0;for(let v=0;s&&v<u.length;v++)s=looseEqual(u[v],a[v]);return s}function looseEqual(u,a){if(u===a)return!0;let s=isDate(u),v=isDate(a);if(s||v)return s&&v?u.getTime()===a.getTime():!1;if(s=isSymbol(u),v=isSymbol(a),s||v)return u===a;if(s=isArray(u),v=isArray(a),s||v)return s&&v?looseCompareArrays(u,a):!1;if(s=isObject(u),v=isObject(a),s||v){if(!s||!v)return!1;const x=Object.keys(u).length,M=Object.keys(a).length;if(x!==M)return!1;for(const I in u){const B=u.hasOwnProperty(I),U=a.hasOwnProperty(I);if(B&&!U||!B&&U||!looseEqual(u[I],a[I]))return!1}}return String(u)===String(a)}function looseIndexOf(u,a){return u.findIndex(s=>looseEqual(s,a))}const toDisplayString=u=>isString(u)?u:u==null?"":isArray(u)||isObject(u)&&(u.toString===objectToString||!isFunction(u.toString))?JSON.stringify(u,replacer,2):String(u),replacer=(u,a)=>a&&a.__v_isRef?replacer(u,a.value):isMap(a)?{[`Map(${a.size})`]:[...a.entries()].reduce((s,[v,x])=>(s[`${v} =>`]=x,s),{})}:isSet(a)?{[`Set(${a.size})`]:[...a.values()]}:isObject(a)&&!isArray(a)&&!isPlainObject(a)?String(a):a;let activeEffectScope;class EffectScope{constructor(a=!1){this.detached=a,this._active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!a&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}run(a){if(this._active){const s=activeEffectScope;try{return activeEffectScope=this,a()}finally{activeEffectScope=s}}}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(a){if(this._active){let s,v;for(s=0,v=this.effects.length;s<v;s++)this.effects[s].stop();for(s=0,v=this.cleanups.length;s<v;s++)this.cleanups[s]();if(this.scopes)for(s=0,v=this.scopes.length;s<v;s++)this.scopes[s].stop(!0);if(!this.detached&&this.parent&&!a){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.parent=void 0,this._active=!1}}}function effectScope(u){return new EffectScope(u)}function recordEffectScope(u,a=activeEffectScope){a&&a.active&&a.effects.push(u)}function getCurrentScope(){return activeEffectScope}function onScopeDispose(u){activeEffectScope&&activeEffectScope.cleanups.push(u)}const createDep=u=>{const a=new Set(u);return a.w=0,a.n=0,a},wasTracked=u=>(u.w&trackOpBit)>0,newTracked=u=>(u.n&trackOpBit)>0,initDepMarkers=({deps:u})=>{if(u.length)for(let a=0;a<u.length;a++)u[a].w|=trackOpBit},finalizeDepMarkers=u=>{const{deps:a}=u;if(a.length){let s=0;for(let v=0;v<a.length;v++){const x=a[v];wasTracked(x)&&!newTracked(x)?x.delete(u):a[s++]=x,x.w&=~trackOpBit,x.n&=~trackOpBit}a.length=s}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol("");class ReactiveEffect{constructor(a,s=null,v){this.fn=a,this.scheduler=s,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,v)}run(){if(!this.active)return this.fn();let a=activeEffect,s=shouldTrack;for(;a;){if(a===this)return;a=a.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,effectTrackDepth<=maxMarkerBits?initDepMarkers(this):cleanupEffect(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=s,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(u){const{deps:a}=u;if(a.length){for(let s=0;s<a.length;s++)a[s].delete(u);a.length=0}}function effect(u,a){u.effect&&(u=u.effect.fn);const s=new ReactiveEffect(u);a&&(extend(s,a),a.scope&&recordEffectScope(s,a.scope)),(!a||!a.lazy)&&s.run();const v=s.run.bind(s);return v.effect=s,v}function stop(u){u.effect.stop()}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const u=trackStack.pop();shouldTrack=u===void 0?!0:u}function track(u,a,s){if(shouldTrack&&activeEffect){let v=targetMap.get(u);v||targetMap.set(u,v=new Map);let x=v.get(s);x||v.set(s,x=createDep()),trackEffects(x)}}function trackEffects(u,a){let s=!1;effectTrackDepth<=maxMarkerBits?newTracked(u)||(u.n|=trackOpBit,s=!wasTracked(u)):s=!u.has(activeEffect),s&&(u.add(activeEffect),activeEffect.deps.push(u))}function trigger(u,a,s,v,x,M){const I=targetMap.get(u);if(!I)return;let B=[];if(a==="clear")B=[...I.values()];else if(s==="length"&&isArray(u)){const U=Number(v);I.forEach((j,te)=>{(te==="length"||te>=U)&&B.push(j)})}else switch(s!==void 0&&B.push(I.get(s)),a){case"add":isArray(u)?isIntegerKey(s)&&B.push(I.get("length")):(B.push(I.get(ITERATE_KEY)),isMap(u)&&B.push(I.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray(u)||(B.push(I.get(ITERATE_KEY)),isMap(u)&&B.push(I.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(u)&&B.push(I.get(ITERATE_KEY));break}if(B.length===1)B[0]&&triggerEffects(B[0]);else{const U=[];for(const j of B)j&&U.push(...j);triggerEffects(createDep(U))}}function triggerEffects(u,a){const s=isArray(u)?u:[...u];for(const v of s)v.computed&&triggerEffect(v);for(const v of s)v.computed||triggerEffect(v)}function triggerEffect(u,a){(u!==activeEffect||u.allowRecurse)&&(u.scheduler?u.scheduler():u.run())}function getDepFromReactive(u,a){var s;return(s=targetMap.get(u))==null?void 0:s.get(a)}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(u=>u!=="arguments"&&u!=="caller").map(u=>Symbol[u]).filter(isSymbol)),get$1=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),shallowReadonlyGet=createGetter(!0,!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const u={};return["includes","indexOf","lastIndexOf"].forEach(a=>{u[a]=function(...s){const v=toRaw(this);for(let M=0,I=this.length;M<I;M++)track(v,"get",M+"");const x=v[a](...s);return x===-1||x===!1?v[a](...s.map(toRaw)):x}}),["push","pop","shift","unshift","splice"].forEach(a=>{u[a]=function(...s){pauseTracking();const v=toRaw(this)[a].apply(this,s);return resetTracking(),v}}),u}function hasOwnProperty(u){const a=toRaw(this);return track(a,"has",u),a.hasOwnProperty(u)}function createGetter(u=!1,a=!1){return function(v,x,M){if(x==="__v_isReactive")return!u;if(x==="__v_isReadonly")return u;if(x==="__v_isShallow")return a;if(x==="__v_raw"&&M===(u?a?shallowReadonlyMap:readonlyMap:a?shallowReactiveMap:reactiveMap).get(v))return v;const I=isArray(v);if(!u){if(I&&hasOwn(arrayInstrumentations,x))return Reflect.get(arrayInstrumentations,x,M);if(x==="hasOwnProperty")return hasOwnProperty}const B=Reflect.get(v,x,M);return(isSymbol(x)?builtInSymbols.has(x):isNonTrackableKeys(x))||(u||track(v,"get",x),a)?B:isRef(B)?I&&isIntegerKey(x)?B:B.value:isObject(B)?u?readonly(B):reactive(B):B}}const set$1=createSetter(),shallowSet=createSetter(!0);function createSetter(u=!1){return function(s,v,x,M){let I=s[v];if(isReadonly(I)&&isRef(I)&&!isRef(x))return!1;if(!u&&(!isShallow(x)&&!isReadonly(x)&&(I=toRaw(I),x=toRaw(x)),!isArray(s)&&isRef(I)&&!isRef(x)))return I.value=x,!0;const B=isArray(s)&&isIntegerKey(v)?Number(v)<s.length:hasOwn(s,v),U=Reflect.set(s,v,x,M);return s===toRaw(M)&&(B?hasChanged(x,I)&&trigger(s,"set",v,x):trigger(s,"add",v,x)),U}}function deleteProperty(u,a){const s=hasOwn(u,a);u[a];const v=Reflect.deleteProperty(u,a);return v&&s&&trigger(u,"delete",a,void 0),v}function has$1(u,a){const s=Reflect.has(u,a);return(!isSymbol(a)||!builtInSymbols.has(a))&&track(u,"has",a),s}function ownKeys(u){return track(u,"iterate",isArray(u)?"length":ITERATE_KEY),Reflect.ownKeys(u)}const mutableHandlers={get:get$1,set:set$1,deleteProperty,has:has$1,ownKeys},readonlyHandlers={get:readonlyGet,set(u,a){return!0},deleteProperty(u,a){return!0}},shallowReactiveHandlers=extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),shallowReadonlyHandlers=extend({},readonlyHandlers,{get:shallowReadonlyGet}),toShallow=u=>u,getProto$1=u=>Reflect.getPrototypeOf(u);function get(u,a,s=!1,v=!1){u=u.__v_raw;const x=toRaw(u),M=toRaw(a);s||(a!==M&&track(x,"get",a),track(x,"get",M));const{has:I}=getProto$1(x),B=v?toShallow:s?toReadonly:toReactive;if(I.call(x,a))return B(u.get(a));if(I.call(x,M))return B(u.get(M));u!==x&&u.get(a)}function has(u,a=!1){const s=this.__v_raw,v=toRaw(s),x=toRaw(u);return a||(u!==x&&track(v,"has",u),track(v,"has",x)),u===x?s.has(u):s.has(u)||s.has(x)}function size(u,a=!1){return u=u.__v_raw,!a&&track(toRaw(u),"iterate",ITERATE_KEY),Reflect.get(u,"size",u)}function add(u){u=toRaw(u);const a=toRaw(this);return getProto$1(a).has.call(a,u)||(a.add(u),trigger(a,"add",u,u)),this}function set(u,a){a=toRaw(a);const s=toRaw(this),{has:v,get:x}=getProto$1(s);let M=v.call(s,u);M||(u=toRaw(u),M=v.call(s,u));const I=x.call(s,u);return s.set(u,a),M?hasChanged(a,I)&&trigger(s,"set",u,a):trigger(s,"add",u,a),this}function deleteEntry(u){const a=toRaw(this),{has:s,get:v}=getProto$1(a);let x=s.call(a,u);x||(u=toRaw(u),x=s.call(a,u)),v&&v.call(a,u);const M=a.delete(u);return x&&trigger(a,"delete",u,void 0),M}function clear(){const u=toRaw(this),a=u.size!==0,s=u.clear();return a&&trigger(u,"clear",void 0,void 0),s}function createForEach(u,a){return function(v,x){const M=this,I=M.__v_raw,B=toRaw(I),U=a?toShallow:u?toReadonly:toReactive;return!u&&track(B,"iterate",ITERATE_KEY),I.forEach((j,te)=>v.call(x,U(j),U(te),M))}}function createIterableMethod(u,a,s){return function(...v){const x=this.__v_raw,M=toRaw(x),I=isMap(M),B=u==="entries"||u===Symbol.iterator&&I,U=u==="keys"&&I,j=x[u](...v),te=s?toShallow:a?toReadonly:toReactive;return!a&&track(M,"iterate",U?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:Z,done:oe}=j.next();return oe?{value:Z,done:oe}:{value:B?[te(Z[0]),te(Z[1])]:te(Z),done:oe}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(u){return function(...a){return u==="delete"?!1:this}}function createInstrumentations(){const u={get(M){return get(this,M)},get size(){return size(this)},has,add,set,delete:deleteEntry,clear,forEach:createForEach(!1,!1)},a={get(M){return get(this,M,!1,!0)},get size(){return size(this)},has,add,set,delete:deleteEntry,clear,forEach:createForEach(!1,!0)},s={get(M){return get(this,M,!0)},get size(){return size(this,!0)},has(M){return has.call(this,M,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},v={get(M){return get(this,M,!0,!0)},get size(){return size(this,!0)},has(M){return has.call(this,M,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(M=>{u[M]=createIterableMethod(M,!1,!1),s[M]=createIterableMethod(M,!0,!1),a[M]=createIterableMethod(M,!1,!0),v[M]=createIterableMethod(M,!0,!0)}),[u,s,a,v]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(u,a){const s=a?u?shallowReadonlyInstrumentations:shallowInstrumentations:u?readonlyInstrumentations:mutableInstrumentations;return(v,x,M)=>x==="__v_isReactive"?!u:x==="__v_isReadonly"?u:x==="__v_raw"?v:Reflect.get(hasOwn(s,x)&&x in v?s:v,x,M)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(u){switch(u){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(u){return u.__v_skip||!Object.isExtensible(u)?0:targetTypeMap(toRawType(u))}function reactive(u){return isReadonly(u)?u:createReactiveObject(u,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(u){return createReactiveObject(u,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(u){return createReactiveObject(u,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(u){return createReactiveObject(u,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(u,a,s,v,x){if(!isObject(u)||u.__v_raw&&!(a&&u.__v_isReactive))return u;const M=x.get(u);if(M)return M;const I=getTargetType(u);if(I===0)return u;const B=new Proxy(u,I===2?v:s);return x.set(u,B),B}function isReactive(u){return isReadonly(u)?isReactive(u.__v_raw):!!(u&&u.__v_isReactive)}function isReadonly(u){return!!(u&&u.__v_isReadonly)}function isShallow(u){return!!(u&&u.__v_isShallow)}function isProxy(u){return isReactive(u)||isReadonly(u)}function toRaw(u){const a=u&&u.__v_raw;return a?toRaw(a):u}function markRaw(u){return def(u,"__v_skip",!0),u}const toReactive=u=>isObject(u)?reactive(u):u,toReadonly=u=>isObject(u)?readonly(u):u;function trackRefValue(u){shouldTrack&&activeEffect&&(u=toRaw(u),trackEffects(u.dep||(u.dep=createDep())))}function triggerRefValue(u,a){u=toRaw(u);const s=u.dep;s&&triggerEffects(s)}function isRef(u){return!!(u&&u.__v_isRef===!0)}function ref(u){return createRef(u,!1)}function shallowRef(u){return createRef(u,!0)}function createRef(u,a){return isRef(u)?u:new RefImpl(u,a)}class RefImpl{constructor(a,s){this.__v_isShallow=s,this.dep=void 0,this.__v_isRef=!0,this._rawValue=s?a:toRaw(a),this._value=s?a:toReactive(a)}get value(){return trackRefValue(this),this._value}set value(a){const s=this.__v_isShallow||isShallow(a)||isReadonly(a);a=s?a:toRaw(a),hasChanged(a,this._rawValue)&&(this._rawValue=a,this._value=s?a:toReactive(a),triggerRefValue(this))}}function triggerRef(u){triggerRefValue(u)}function unref(u){return isRef(u)?u.value:u}function toValue(u){return isFunction(u)?u():unref(u)}const shallowUnwrapHandlers={get:(u,a,s)=>unref(Reflect.get(u,a,s)),set:(u,a,s,v)=>{const x=u[a];return isRef(x)&&!isRef(s)?(x.value=s,!0):Reflect.set(u,a,s,v)}};function proxyRefs(u){return isReactive(u)?u:new Proxy(u,shallowUnwrapHandlers)}class CustomRefImpl{constructor(a){this.dep=void 0,this.__v_isRef=!0;const{get:s,set:v}=a(()=>trackRefValue(this),()=>triggerRefValue(this));this._get=s,this._set=v}get value(){return this._get()}set value(a){this._set(a)}}function customRef(u){return new CustomRefImpl(u)}function toRefs(u){const a=isArray(u)?new Array(u.length):{};for(const s in u)a[s]=propertyToRef(u,s);return a}class ObjectRefImpl{constructor(a,s,v){this._object=a,this._key=s,this._defaultValue=v,this.__v_isRef=!0}get value(){const a=this._object[this._key];return a===void 0?this._defaultValue:a}set value(a){this._object[this._key]=a}get dep(){return getDepFromReactive(toRaw(this._object),this._key)}}class GetterRefImpl{constructor(a){this._getter=a,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function toRef(u,a,s){return isRef(u)?u:isFunction(u)?new GetterRefImpl(u):isObject(u)&&arguments.length>1?propertyToRef(u,a,s):ref(u)}function propertyToRef(u,a,s){const v=u[a];return isRef(v)?v:new ObjectRefImpl(u,a,s)}class ComputedRefImpl{constructor(a,s,v,x){this._setter=s,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new ReactiveEffect(a,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=v}get value(){const a=toRaw(this);return trackRefValue(a),(a._dirty||!a._cacheable)&&(a._dirty=!1,a._value=a.effect.run()),a._value}set value(a){this._setter(a)}}function computed$1(u,a,s=!1){let v,x;const M=isFunction(u);return M?(v=u,x=NOOP):(v=u.get,x=u.set),new ComputedRefImpl(v,x,M||!x,s)}function warn(u,...a){}function assertNumber(u,a){}function callWithErrorHandling(u,a,s,v){let x;try{x=v?u(...v):u()}catch(M){handleError(M,a,s)}return x}function callWithAsyncErrorHandling(u,a,s,v){if(isFunction(u)){const M=callWithErrorHandling(u,a,s,v);return M&&isPromise(M)&&M.catch(I=>{handleError(I,a,s)}),M}const x=[];for(let M=0;M<u.length;M++)x.push(callWithAsyncErrorHandling(u[M],a,s,v));return x}function handleError(u,a,s,v=!0){const x=a?a.vnode:null;if(a){let M=a.parent;const I=a.proxy,B=s;for(;M;){const j=M.ec;if(j){for(let te=0;te<j.length;te++)if(j[te](u,I,B)===!1)return}M=M.parent}const U=a.appContext.config.errorHandler;if(U){callWithErrorHandling(U,null,10,[u,I,B]);return}}logError(u,s,x,v)}function logError(u,a,s,v=!0){console.error(u)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(u){const a=currentFlushPromise||resolvedPromise;return u?a.then(this?u.bind(this):u):a}function findInsertionIndex(u){let a=flushIndex+1,s=queue.length;for(;a<s;){const v=a+s>>>1;getId(queue[v])<u?a=v+1:s=v}return a}function queueJob(u){(!queue.length||!queue.includes(u,isFlushing&&u.allowRecurse?flushIndex+1:flushIndex))&&(u.id==null?queue.push(u):queue.splice(findInsertionIndex(u.id),0,u),queueFlush())}function queueFlush(){!isFlushing&&!isFlushPending&&(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function invalidateJob(u){const a=queue.indexOf(u);a>flushIndex&&queue.splice(a,1)}function queuePostFlushCb(u){isArray(u)?pendingPostFlushCbs.push(...u):(!activePostFlushCbs||!activePostFlushCbs.includes(u,u.allowRecurse?postFlushIndex+1:postFlushIndex))&&pendingPostFlushCbs.push(u),queueFlush()}function flushPreFlushCbs(u,a=isFlushing?flushIndex+1:0){for(;a<queue.length;a++){const s=queue[a];s&&s.pre&&(queue.splice(a,1),a--,s())}}function flushPostFlushCbs(u){if(pendingPostFlushCbs.length){const a=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...a);return}for(activePostFlushCbs=a,activePostFlushCbs.sort((s,v)=>getId(s)-getId(v)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}const getId=u=>u.id==null?1/0:u.id,comparator=(u,a)=>{const s=getId(u)-getId(a);if(s===0){if(u.pre&&!a.pre)return-1;if(a.pre&&!u.pre)return 1}return s};function flushJobs(u){isFlushPending=!1,isFlushing=!0,queue.sort(comparator);const a=NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const s=queue[flushIndex];s&&s.active!==!1&&callWithErrorHandling(s,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let devtools,buffer=[];function setDevtoolsHook(u,a){var s,v;devtools=u,devtools?(devtools.enabled=!0,buffer.forEach(({event:x,args:M})=>devtools.emit(x,...M)),buffer=[]):typeof window<"u"&&window.HTMLElement&&!((v=(s=window.navigator)==null?void 0:s.userAgent)!=null&&v.includes("jsdom"))?((a.__VUE_DEVTOOLS_HOOK_REPLAY__=a.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(M=>{setDevtoolsHook(M,a)}),setTimeout(()=>{devtools||(a.__VUE_DEVTOOLS_HOOK_REPLAY__=null,buffer=[])},3e3)):buffer=[]}function emit(u,a,...s){if(u.isUnmounted)return;const v=u.vnode.props||EMPTY_OBJ;let x=s;const M=a.startsWith("update:"),I=M&&a.slice(7);if(I&&I in v){const te=`${I==="modelValue"?"model":I}Modifiers`,{number:Z,trim:oe}=v[te]||EMPTY_OBJ;oe&&(x=s.map(le=>isString(le)?le.trim():le)),Z&&(x=s.map(looseToNumber))}let B,U=v[B=toHandlerKey(a)]||v[B=toHandlerKey(camelize(a))];!U&&M&&(U=v[B=toHandlerKey(hyphenate(a))]),U&&callWithAsyncErrorHandling(U,u,6,x);const j=v[B+"Once"];if(j){if(!u.emitted)u.emitted={};else if(u.emitted[B])return;u.emitted[B]=!0,callWithAsyncErrorHandling(j,u,6,x)}}function normalizeEmitsOptions(u,a,s=!1){const v=a.emitsCache,x=v.get(u);if(x!==void 0)return x;const M=u.emits;let I={},B=!1;if(!isFunction(u)){const U=j=>{const te=normalizeEmitsOptions(j,a,!0);te&&(B=!0,extend(I,te))};!s&&a.mixins.length&&a.mixins.forEach(U),u.extends&&U(u.extends),u.mixins&&u.mixins.forEach(U)}return!M&&!B?(isObject(u)&&v.set(u,null),null):(isArray(M)?M.forEach(U=>I[U]=null):extend(I,M),isObject(u)&&v.set(u,I),I)}function isEmitListener(u,a){return!u||!isOn(a)?!1:(a=a.slice(2).replace(/Once$/,""),hasOwn(u,a[0].toLowerCase()+a.slice(1))||hasOwn(u,hyphenate(a))||hasOwn(u,a))}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(u){const a=currentRenderingInstance;return currentRenderingInstance=u,currentScopeId=u&&u.type.__scopeId||null,a}function pushScopeId(u){currentScopeId=u}function popScopeId(){currentScopeId=null}const withScopeId=u=>withCtx;function withCtx(u,a=currentRenderingInstance,s){if(!a||u._n)return u;const v=(...x)=>{v._d&&setBlockTracking(-1);const M=setCurrentRenderingInstance(a);let I;try{I=u(...x)}finally{setCurrentRenderingInstance(M),v._d&&setBlockTracking(1)}return I};return v._n=!0,v._c=!0,v._d=!0,v}function markAttrsAccessed(){}function renderComponentRoot(u){const{type:a,vnode:s,proxy:v,withProxy:x,props:M,propsOptions:[I],slots:B,attrs:U,emit:j,render:te,renderCache:Z,data:oe,setupState:le,ctx:se,inheritAttrs:ve}=u;let ce,K;const X=setCurrentRenderingInstance(u);try{if(s.shapeFlag&4){const _e=x||v;ce=normalizeVNode(te.call(_e,_e,Z,M,le,oe,se)),K=U}else{const _e=a;ce=normalizeVNode(_e.length>1?_e(M,{attrs:U,slots:B,emit:j}):_e(M,null)),K=a.props?U:getFunctionalFallthrough(U)}}catch(_e){blockStack.length=0,handleError(_e,u,1),ce=createVNode(Comment)}let W=ce;if(K&&ve!==!1){const _e=Object.keys(K),{shapeFlag:ge}=W;_e.length&&ge&7&&(I&&_e.some(isModelListener)&&(K=filterModelListeners(K,I)),W=cloneVNode(W,K))}return s.dirs&&(W=cloneVNode(W),W.dirs=W.dirs?W.dirs.concat(s.dirs):s.dirs),s.transition&&(W.transition=s.transition),ce=W,setCurrentRenderingInstance(X),ce}function filterSingleRoot(u){let a;for(let s=0;s<u.length;s++){const v=u[s];if(isVNode(v)){if(v.type!==Comment||v.children==="v-if"){if(a)return;a=v}}else return}return a}const getFunctionalFallthrough=u=>{let a;for(const s in u)(s==="class"||s==="style"||isOn(s))&&((a||(a={}))[s]=u[s]);return a},filterModelListeners=(u,a)=>{const s={};for(const v in u)(!isModelListener(v)||!(v.slice(9)in a))&&(s[v]=u[v]);return s};function shouldUpdateComponent(u,a,s){const{props:v,children:x,component:M}=u,{props:I,children:B,patchFlag:U}=a,j=M.emitsOptions;if(a.dirs||a.transition)return!0;if(s&&U>=0){if(U&1024)return!0;if(U&16)return v?hasPropsChanged(v,I,j):!!I;if(U&8){const te=a.dynamicProps;for(let Z=0;Z<te.length;Z++){const oe=te[Z];if(I[oe]!==v[oe]&&!isEmitListener(j,oe))return!0}}}else return(x||B)&&(!B||!B.$stable)?!0:v===I?!1:v?I?hasPropsChanged(v,I,j):!0:!!I;return!1}function hasPropsChanged(u,a,s){const v=Object.keys(a);if(v.length!==Object.keys(u).length)return!0;for(let x=0;x<v.length;x++){const M=v[x];if(a[M]!==u[M]&&!isEmitListener(s,M))return!0}return!1}function updateHOCHostEl({vnode:u,parent:a},s){for(;a&&a.subTree===u;)(u=a.vnode).el=s,a=a.parent}const isSuspense=u=>u.__isSuspense,SuspenseImpl={name:"Suspense",__isSuspense:!0,process(u,a,s,v,x,M,I,B,U,j){u==null?mountSuspense(a,s,v,x,M,I,B,U,j):patchSuspense(u,a,s,v,x,I,B,U,j)},hydrate:hydrateSuspense,create:createSuspenseBoundary,normalize:normalizeSuspenseChildren},Suspense=SuspenseImpl;function triggerEvent(u,a){const s=u.props&&u.props[a];isFunction(s)&&s()}function mountSuspense(u,a,s,v,x,M,I,B,U){const{p:j,o:{createElement:te}}=U,Z=te("div"),oe=u.suspense=createSuspenseBoundary(u,x,v,a,Z,s,M,I,B,U);j(null,oe.pendingBranch=u.ssContent,Z,null,v,oe,M,I),oe.deps>0?(triggerEvent(u,"onPending"),triggerEvent(u,"onFallback"),j(null,u.ssFallback,a,s,v,null,M,I),setActiveBranch(oe,u.ssFallback)):oe.resolve(!1,!0)}function patchSuspense(u,a,s,v,x,M,I,B,{p:U,um:j,o:{createElement:te}}){const Z=a.suspense=u.suspense;Z.vnode=a,a.el=u.el;const oe=a.ssContent,le=a.ssFallback,{activeBranch:se,pendingBranch:ve,isInFallback:ce,isHydrating:K}=Z;if(ve)Z.pendingBranch=oe,isSameVNodeType(oe,ve)?(U(ve,oe,Z.hiddenContainer,null,x,Z,M,I,B),Z.deps<=0?Z.resolve():ce&&(U(se,le,s,v,x,null,M,I,B),setActiveBranch(Z,le))):(Z.pendingId++,K?(Z.isHydrating=!1,Z.activeBranch=ve):j(ve,x,Z),Z.deps=0,Z.effects.length=0,Z.hiddenContainer=te("div"),ce?(U(null,oe,Z.hiddenContainer,null,x,Z,M,I,B),Z.deps<=0?Z.resolve():(U(se,le,s,v,x,null,M,I,B),setActiveBranch(Z,le))):se&&isSameVNodeType(oe,se)?(U(se,oe,s,v,x,Z,M,I,B),Z.resolve(!0)):(U(null,oe,Z.hiddenContainer,null,x,Z,M,I,B),Z.deps<=0&&Z.resolve()));else if(se&&isSameVNodeType(oe,se))U(se,oe,s,v,x,Z,M,I,B),setActiveBranch(Z,oe);else if(triggerEvent(a,"onPending"),Z.pendingBranch=oe,Z.pendingId++,U(null,oe,Z.hiddenContainer,null,x,Z,M,I,B),Z.deps<=0)Z.resolve();else{const{timeout:X,pendingId:W}=Z;X>0?setTimeout(()=>{Z.pendingId===W&&Z.fallback(le)},X):X===0&&Z.fallback(le)}}function createSuspenseBoundary(u,a,s,v,x,M,I,B,U,j,te=!1){const{p:Z,m:oe,um:le,n:se,o:{parentNode:ve,remove:ce}}=j;let K;const X=isVNodeSuspensible(u);X&&a!=null&&a.pendingBranch&&(K=a.pendingId,a.deps++);const W=u.props?toNumber(u.props.timeout):void 0,_e={vnode:u,parent:a,parentComponent:s,isSVG:I,container:v,hiddenContainer:x,anchor:M,deps:0,pendingId:0,timeout:typeof W=="number"?W:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:te,isUnmounted:!1,effects:[],resolve(ge=!1,Ae=!1){const{vnode:ee,activeBranch:$,pendingBranch:ae,pendingId:Re,effects:pe,parentComponent:he,container:we}=_e;if(_e.isHydrating)_e.isHydrating=!1;else if(!ge){const Ze=$&&ae.transition&&ae.transition.mode==="out-in";Ze&&($.transition.afterLeave=()=>{Re===_e.pendingId&&oe(ae,we,Ye,0)});let{anchor:Ye}=_e;$&&(Ye=se($),le($,he,_e,!0)),Ze||oe(ae,we,Ye,0)}setActiveBranch(_e,ae),_e.pendingBranch=null,_e.isInFallback=!1;let Ce=_e.parent,Ne=!1;for(;Ce;){if(Ce.pendingBranch){Ce.effects.push(...pe),Ne=!0;break}Ce=Ce.parent}Ne||queuePostFlushCb(pe),_e.effects=[],X&&a&&a.pendingBranch&&K===a.pendingId&&(a.deps--,a.deps===0&&!Ae&&a.resolve()),triggerEvent(ee,"onResolve")},fallback(ge){if(!_e.pendingBranch)return;const{vnode:Ae,activeBranch:ee,parentComponent:$,container:ae,isSVG:Re}=_e;triggerEvent(Ae,"onFallback");const pe=se(ee),he=()=>{_e.isInFallback&&(Z(null,ge,ae,pe,$,null,Re,B,U),setActiveBranch(_e,ge))},we=ge.transition&&ge.transition.mode==="out-in";we&&(ee.transition.afterLeave=he),_e.isInFallback=!0,le(ee,$,null,!0),we||he()},move(ge,Ae,ee){_e.activeBranch&&oe(_e.activeBranch,ge,Ae,ee),_e.container=ge},next(){return _e.activeBranch&&se(_e.activeBranch)},registerDep(ge,Ae){const ee=!!_e.pendingBranch;ee&&_e.deps++;const $=ge.vnode.el;ge.asyncDep.catch(ae=>{handleError(ae,ge,0)}).then(ae=>{if(ge.isUnmounted||_e.isUnmounted||_e.pendingId!==ge.suspenseId)return;ge.asyncResolved=!0;const{vnode:Re}=ge;handleSetupResult(ge,ae,!1),$&&(Re.el=$);const pe=!$&&ge.subTree.el;Ae(ge,Re,ve($||ge.subTree.el),$?null:se(ge.subTree),_e,I,U),pe&&ce(pe),updateHOCHostEl(ge,Re.el),ee&&--_e.deps===0&&_e.resolve()})},unmount(ge,Ae){_e.isUnmounted=!0,_e.activeBranch&&le(_e.activeBranch,s,ge,Ae),_e.pendingBranch&&le(_e.pendingBranch,s,ge,Ae)}};return _e}function hydrateSuspense(u,a,s,v,x,M,I,B,U){const j=a.suspense=createSuspenseBoundary(a,v,s,u.parentNode,document.createElement("div"),null,x,M,I,B,!0),te=U(u,j.pendingBranch=a.ssContent,s,j,M,I);return j.deps===0&&j.resolve(!1,!0),te}function normalizeSuspenseChildren(u){const{shapeFlag:a,children:s}=u,v=a&32;u.ssContent=normalizeSuspenseSlot(v?s.default:s),u.ssFallback=v?normalizeSuspenseSlot(s.fallback):createVNode(Comment)}function normalizeSuspenseSlot(u){let a;if(isFunction(u)){const s=isBlockTreeEnabled&&u._c;s&&(u._d=!1,openBlock()),u=u(),s&&(u._d=!0,a=currentBlock,closeBlock())}return isArray(u)&&(u=filterSingleRoot(u)),u=normalizeVNode(u),a&&!u.dynamicChildren&&(u.dynamicChildren=a.filter(s=>s!==u)),u}function queueEffectWithSuspense(u,a){a&&a.pendingBranch?isArray(u)?a.effects.push(...u):a.effects.push(u):queuePostFlushCb(u)}function setActiveBranch(u,a){u.activeBranch=a;const{vnode:s,parentComponent:v}=u,x=s.el=a.el;v&&v.subTree===s&&(v.vnode.el=x,updateHOCHostEl(v,x))}function isVNodeSuspensible(u){var a;return((a=u.props)==null?void 0:a.suspensible)!=null&&u.props.suspensible!==!1}function watchEffect(u,a){return doWatch(u,null,a)}function watchPostEffect(u,a){return doWatch(u,null,{flush:"post"})}function watchSyncEffect(u,a){return doWatch(u,null,{flush:"sync"})}const INITIAL_WATCHER_VALUE={};function watch(u,a,s){return doWatch(u,a,s)}function doWatch(u,a,{immediate:s,deep:v,flush:x,onTrack:M,onTrigger:I}=EMPTY_OBJ){var B;const U=getCurrentScope()===((B=currentInstance)==null?void 0:B.scope)?currentInstance:null;let j,te=!1,Z=!1;if(isRef(u)?(j=()=>u.value,te=isShallow(u)):isReactive(u)?(j=()=>u,v=!0):isArray(u)?(Z=!0,te=u.some(_e=>isReactive(_e)||isShallow(_e)),j=()=>u.map(_e=>{if(isRef(_e))return _e.value;if(isReactive(_e))return traverse(_e);if(isFunction(_e))return callWithErrorHandling(_e,U,2)})):isFunction(u)?a?j=()=>callWithErrorHandling(u,U,2):j=()=>{if(!(U&&U.isUnmounted))return oe&&oe(),callWithAsyncErrorHandling(u,U,3,[le])}:j=NOOP,a&&v){const _e=j;j=()=>traverse(_e())}let oe,le=_e=>{oe=X.onStop=()=>{callWithErrorHandling(_e,U,4)}},se;if(isInSSRComponentSetup)if(le=NOOP,a?s&&callWithAsyncErrorHandling(a,U,3,[j(),Z?[]:void 0,le]):j(),x==="sync"){const _e=useSSRContext();se=_e.__watcherHandles||(_e.__watcherHandles=[])}else return NOOP;let ve=Z?new Array(u.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const ce=()=>{if(X.active)if(a){const _e=X.run();(v||te||(Z?_e.some((ge,Ae)=>hasChanged(ge,ve[Ae])):hasChanged(_e,ve)))&&(oe&&oe(),callWithAsyncErrorHandling(a,U,3,[_e,ve===INITIAL_WATCHER_VALUE?void 0:Z&&ve[0]===INITIAL_WATCHER_VALUE?[]:ve,le]),ve=_e)}else X.run()};ce.allowRecurse=!!a;let K;x==="sync"?K=ce:x==="post"?K=()=>queuePostRenderEffect(ce,U&&U.suspense):(ce.pre=!0,U&&(ce.id=U.uid),K=()=>queueJob(ce));const X=new ReactiveEffect(j,K);a?s?ce():ve=X.run():x==="post"?queuePostRenderEffect(X.run.bind(X),U&&U.suspense):X.run();const W=()=>{X.stop(),U&&U.scope&&remove(U.scope.effects,X)};return se&&se.push(W),W}function instanceWatch(u,a,s){const v=this.proxy,x=isString(u)?u.includes(".")?createPathGetter(v,u):()=>v[u]:u.bind(v,v);let M;isFunction(a)?M=a:(M=a.handler,s=a);const I=currentInstance;setCurrentInstance(this);const B=doWatch(x,M.bind(v),s);return I?setCurrentInstance(I):unsetCurrentInstance(),B}function createPathGetter(u,a){const s=a.split(".");return()=>{let v=u;for(let x=0;x<s.length&&v;x++)v=v[s[x]];return v}}function traverse(u,a){if(!isObject(u)||u.__v_skip||(a=a||new Set,a.has(u)))return u;if(a.add(u),isRef(u))traverse(u.value,a);else if(isArray(u))for(let s=0;s<u.length;s++)traverse(u[s],a);else if(isSet(u)||isMap(u))u.forEach(s=>{traverse(s,a)});else if(isPlainObject(u))for(const s in u)traverse(u[s],a);return u}function withDirectives(u,a){const s=currentRenderingInstance;if(s===null)return u;const v=getExposeProxy(s)||s.proxy,x=u.dirs||(u.dirs=[]);for(let M=0;M<a.length;M++){let[I,B,U,j=EMPTY_OBJ]=a[M];I&&(isFunction(I)&&(I={mounted:I,updated:I}),I.deep&&traverse(B),x.push({dir:I,instance:v,value:B,oldValue:void 0,arg:U,modifiers:j}))}return u}function invokeDirectiveHook(u,a,s,v){const x=u.dirs,M=a&&a.dirs;for(let I=0;I<x.length;I++){const B=x[I];M&&(B.oldValue=M[I].value);let U=B.dir[v];U&&(pauseTracking(),callWithAsyncErrorHandling(U,s,8,[u.el,B,u,a]),resetTracking())}}function useTransitionState(){const u={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{u.isMounted=!0}),onBeforeUnmount(()=>{u.isUnmounting=!0}),u}const TransitionHookValidator=[Function,Array],BaseTransitionPropsValidators={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},BaseTransitionImpl={name:"BaseTransition",props:BaseTransitionPropsValidators,setup(u,{slots:a}){const s=getCurrentInstance(),v=useTransitionState();let x;return()=>{const M=a.default&&getTransitionRawChildren(a.default(),!0);if(!M||!M.length)return;let I=M[0];if(M.length>1){for(const ve of M)if(ve.type!==Comment){I=ve;break}}const B=toRaw(u),{mode:U}=B;if(v.isLeaving)return emptyPlaceholder(I);const j=getKeepAliveChild(I);if(!j)return emptyPlaceholder(I);const te=resolveTransitionHooks(j,B,v,s);setTransitionHooks(j,te);const Z=s.subTree,oe=Z&&getKeepAliveChild(Z);let le=!1;const{getTransitionKey:se}=j.type;if(se){const ve=se();x===void 0?x=ve:ve!==x&&(x=ve,le=!0)}if(oe&&oe.type!==Comment&&(!isSameVNodeType(j,oe)||le)){const ve=resolveTransitionHooks(oe,B,v,s);if(setTransitionHooks(oe,ve),U==="out-in")return v.isLeaving=!0,ve.afterLeave=()=>{v.isLeaving=!1,s.update.active!==!1&&s.update()},emptyPlaceholder(I);U==="in-out"&&j.type!==Comment&&(ve.delayLeave=(ce,K,X)=>{const W=getLeavingNodesForType(v,oe);W[String(oe.key)]=oe,ce._leaveCb=()=>{K(),ce._leaveCb=void 0,delete te.delayedLeave},te.delayedLeave=X})}return I}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(u,a){const{leavingVNodes:s}=u;let v=s.get(a.type);return v||(v=Object.create(null),s.set(a.type,v)),v}function resolveTransitionHooks(u,a,s,v){const{appear:x,mode:M,persisted:I=!1,onBeforeEnter:B,onEnter:U,onAfterEnter:j,onEnterCancelled:te,onBeforeLeave:Z,onLeave:oe,onAfterLeave:le,onLeaveCancelled:se,onBeforeAppear:ve,onAppear:ce,onAfterAppear:K,onAppearCancelled:X}=a,W=String(u.key),_e=getLeavingNodesForType(s,u),ge=($,ae)=>{$&&callWithAsyncErrorHandling($,v,9,ae)},Ae=($,ae)=>{const Re=ae[1];ge($,ae),isArray($)?$.every(pe=>pe.length<=1)&&Re():$.length<=1&&Re()},ee={mode:M,persisted:I,beforeEnter($){let ae=B;if(!s.isMounted)if(x)ae=ve||B;else return;$._leaveCb&&$._leaveCb(!0);const Re=_e[W];Re&&isSameVNodeType(u,Re)&&Re.el._leaveCb&&Re.el._leaveCb(),ge(ae,[$])},enter($){let ae=U,Re=j,pe=te;if(!s.isMounted)if(x)ae=ce||U,Re=K||j,pe=X||te;else return;let he=!1;const we=$._enterCb=Ce=>{he||(he=!0,Ce?ge(pe,[$]):ge(Re,[$]),ee.delayedLeave&&ee.delayedLeave(),$._enterCb=void 0)};ae?Ae(ae,[$,we]):we()},leave($,ae){const Re=String(u.key);if($._enterCb&&$._enterCb(!0),s.isUnmounting)return ae();ge(Z,[$]);let pe=!1;const he=$._leaveCb=we=>{pe||(pe=!0,ae(),we?ge(se,[$]):ge(le,[$]),$._leaveCb=void 0,_e[Re]===u&&delete _e[Re])};_e[Re]=u,oe?Ae(oe,[$,he]):he()},clone($){return resolveTransitionHooks($,a,s,v)}};return ee}function emptyPlaceholder(u){if(isKeepAlive(u))return u=cloneVNode(u),u.children=null,u}function getKeepAliveChild(u){return isKeepAlive(u)?u.children?u.children[0]:void 0:u}function setTransitionHooks(u,a){u.shapeFlag&6&&u.component?setTransitionHooks(u.component.subTree,a):u.shapeFlag&128?(u.ssContent.transition=a.clone(u.ssContent),u.ssFallback.transition=a.clone(u.ssFallback)):u.transition=a}function getTransitionRawChildren(u,a=!1,s){let v=[],x=0;for(let M=0;M<u.length;M++){let I=u[M];const B=s==null?I.key:String(s)+String(I.key!=null?I.key:M);I.type===Fragment?(I.patchFlag&128&&x++,v=v.concat(getTransitionRawChildren(I.children,a,B))):(a||I.type!==Comment)&&v.push(B!=null?cloneVNode(I,{key:B}):I)}if(x>1)for(let M=0;M<v.length;M++)v[M].patchFlag=-2;return v}function defineComponent(u,a){return isFunction(u)?(()=>extend({name:u.name},a,{setup:u}))():u}const isAsyncWrapper=u=>!!u.type.__asyncLoader;function defineAsyncComponent(u){isFunction(u)&&(u={loader:u});const{loader:a,loadingComponent:s,errorComponent:v,delay:x=200,timeout:M,suspensible:I=!0,onError:B}=u;let U=null,j,te=0;const Z=()=>(te++,U=null,oe()),oe=()=>{let le;return U||(le=U=a().catch(se=>{if(se=se instanceof Error?se:new Error(String(se)),B)return new Promise((ve,ce)=>{B(se,()=>ve(Z()),()=>ce(se),te+1)});throw se}).then(se=>le!==U&&U?U:(se&&(se.__esModule||se[Symbol.toStringTag]==="Module")&&(se=se.default),j=se,se)))};return defineComponent({name:"AsyncComponentWrapper",__asyncLoader:oe,get __asyncResolved(){return j},setup(){const le=currentInstance;if(j)return()=>createInnerComp(j,le);const se=X=>{U=null,handleError(X,le,13,!v)};if(I&&le.suspense||isInSSRComponentSetup)return oe().then(X=>()=>createInnerComp(X,le)).catch(X=>(se(X),()=>v?createVNode(v,{error:X}):null));const ve=ref(!1),ce=ref(),K=ref(!!x);return x&&setTimeout(()=>{K.value=!1},x),M!=null&&setTimeout(()=>{if(!ve.value&&!ce.value){const X=new Error(`Async component timed out after ${M}ms.`);se(X),ce.value=X}},M),oe().then(()=>{ve.value=!0,le.parent&&isKeepAlive(le.parent.vnode)&&queueJob(le.parent.update)}).catch(X=>{se(X),ce.value=X}),()=>{if(ve.value&&j)return createInnerComp(j,le);if(ce.value&&v)return createVNode(v,{error:ce.value});if(s&&!K.value)return createVNode(s)}}})}function createInnerComp(u,a){const{ref:s,props:v,children:x,ce:M}=a.vnode,I=createVNode(u,v,x);return I.ref=s,I.ce=M,delete a.vnode.ce,I}const isKeepAlive=u=>u.type.__isKeepAlive,KeepAliveImpl={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(u,{slots:a}){const s=getCurrentInstance(),v=s.ctx;if(!v.renderer)return()=>{const X=a.default&&a.default();return X&&X.length===1?X[0]:X};const x=new Map,M=new Set;let I=null;const B=s.suspense,{renderer:{p:U,m:j,um:te,o:{createElement:Z}}}=v,oe=Z("div");v.activate=(X,W,_e,ge,Ae)=>{const ee=X.component;j(X,W,_e,0,B),U(ee.vnode,X,W,_e,ee,B,ge,X.slotScopeIds,Ae),queuePostRenderEffect(()=>{ee.isDeactivated=!1,ee.a&&invokeArrayFns(ee.a);const $=X.props&&X.props.onVnodeMounted;$&&invokeVNodeHook($,ee.parent,X)},B)},v.deactivate=X=>{const W=X.component;j(X,oe,null,1,B),queuePostRenderEffect(()=>{W.da&&invokeArrayFns(W.da);const _e=X.props&&X.props.onVnodeUnmounted;_e&&invokeVNodeHook(_e,W.parent,X),W.isDeactivated=!0},B)};function le(X){resetShapeFlag(X),te(X,s,B,!0)}function se(X){x.forEach((W,_e)=>{const ge=getComponentName(W.type);ge&&(!X||!X(ge))&&ve(_e)})}function ve(X){const W=x.get(X);!I||!isSameVNodeType(W,I)?le(W):I&&resetShapeFlag(I),x.delete(X),M.delete(X)}watch(()=>[u.include,u.exclude],([X,W])=>{X&&se(_e=>matches(X,_e)),W&&se(_e=>!matches(W,_e))},{flush:"post",deep:!0});let ce=null;const K=()=>{ce!=null&&x.set(ce,getInnerChild(s.subTree))};return onMounted(K),onUpdated(K),onBeforeUnmount(()=>{x.forEach(X=>{const{subTree:W,suspense:_e}=s,ge=getInnerChild(W);if(X.type===ge.type&&X.key===ge.key){resetShapeFlag(ge);const Ae=ge.component.da;Ae&&queuePostRenderEffect(Ae,_e);return}le(X)})}),()=>{if(ce=null,!a.default)return null;const X=a.default(),W=X[0];if(X.length>1)return I=null,X;if(!isVNode(W)||!(W.shapeFlag&4)&&!(W.shapeFlag&128))return I=null,W;let _e=getInnerChild(W);const ge=_e.type,Ae=getComponentName(isAsyncWrapper(_e)?_e.type.__asyncResolved||{}:ge),{include:ee,exclude:$,max:ae}=u;if(ee&&(!Ae||!matches(ee,Ae))||$&&Ae&&matches($,Ae))return I=_e,W;const Re=_e.key==null?ge:_e.key,pe=x.get(Re);return _e.el&&(_e=cloneVNode(_e),W.shapeFlag&128&&(W.ssContent=_e)),ce=Re,pe?(_e.el=pe.el,_e.component=pe.component,_e.transition&&setTransitionHooks(_e,_e.transition),_e.shapeFlag|=512,M.delete(Re),M.add(Re)):(M.add(Re),ae&&M.size>parseInt(ae,10)&&ve(M.values().next().value)),_e.shapeFlag|=256,I=_e,isSuspense(W.type)?W:_e}}},KeepAlive=KeepAliveImpl;function matches(u,a){return isArray(u)?u.some(s=>matches(s,a)):isString(u)?u.split(",").includes(a):isRegExp(u)?u.test(a):!1}function onActivated(u,a){registerKeepAliveHook(u,"a",a)}function onDeactivated(u,a){registerKeepAliveHook(u,"da",a)}function registerKeepAliveHook(u,a,s=currentInstance){const v=u.__wdc||(u.__wdc=()=>{let x=s;for(;x;){if(x.isDeactivated)return;x=x.parent}return u()});if(injectHook(a,v,s),s){let x=s.parent;for(;x&&x.parent;)isKeepAlive(x.parent.vnode)&&injectToKeepAliveRoot(v,a,s,x),x=x.parent}}function injectToKeepAliveRoot(u,a,s,v){const x=injectHook(a,u,v,!0);onUnmounted(()=>{remove(v[a],x)},s)}function resetShapeFlag(u){u.shapeFlag&=-257,u.shapeFlag&=-513}function getInnerChild(u){return u.shapeFlag&128?u.ssContent:u}function injectHook(u,a,s=currentInstance,v=!1){if(s){const x=s[u]||(s[u]=[]),M=a.__weh||(a.__weh=(...I)=>{if(s.isUnmounted)return;pauseTracking(),setCurrentInstance(s);const B=callWithAsyncErrorHandling(a,s,u,I);return unsetCurrentInstance(),resetTracking(),B});return v?x.unshift(M):x.push(M),M}}const createHook=u=>(a,s=currentInstance)=>(!isInSSRComponentSetup||u==="sp")&&injectHook(u,(...v)=>a(...v),s),onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(u,a=currentInstance){injectHook("ec",u,a)}const COMPONENTS="components",DIRECTIVES="directives";function resolveComponent(u,a){return resolveAsset(COMPONENTS,u,!0,a)||u}const NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDynamicComponent(u){return isString(u)?resolveAsset(COMPONENTS,u,!1)||u:u||NULL_DYNAMIC_COMPONENT}function resolveDirective(u){return resolveAsset(DIRECTIVES,u)}function resolveAsset(u,a,s=!0,v=!1){const x=currentRenderingInstance||currentInstance;if(x){const M=x.type;if(u===COMPONENTS){const B=getComponentName(M,!1);if(B&&(B===a||B===camelize(a)||B===capitalize(camelize(a))))return M}const I=resolve(x[u]||M[u],a)||resolve(x.appContext[u],a);return!I&&v?M:I}}function resolve(u,a){return u&&(u[a]||u[camelize(a)]||u[capitalize(camelize(a))])}function renderList(u,a,s,v){let x;const M=s&&s[v];if(isArray(u)||isString(u)){x=new Array(u.length);for(let I=0,B=u.length;I<B;I++)x[I]=a(u[I],I,void 0,M&&M[I])}else if(typeof u=="number"){x=new Array(u);for(let I=0;I<u;I++)x[I]=a(I+1,I,void 0,M&&M[I])}else if(isObject(u))if(u[Symbol.iterator])x=Array.from(u,(I,B)=>a(I,B,void 0,M&&M[B]));else{const I=Object.keys(u);x=new Array(I.length);for(let B=0,U=I.length;B<U;B++){const j=I[B];x[B]=a(u[j],j,B,M&&M[B])}}else x=[];return s&&(s[v]=x),x}function createSlots(u,a){for(let s=0;s<a.length;s++){const v=a[s];if(isArray(v))for(let x=0;x<v.length;x++)u[v[x].name]=v[x].fn;else v&&(u[v.name]=v.key?(...x)=>{const M=v.fn(...x);return M&&(M.key=v.key),M}:v.fn)}return u}function renderSlot(u,a,s={},v,x){if(currentRenderingInstance.isCE||currentRenderingInstance.parent&&isAsyncWrapper(currentRenderingInstance.parent)&&currentRenderingInstance.parent.isCE)return a!=="default"&&(s.name=a),createVNode("slot",s,v&&v());let M=u[a];M&&M._c&&(M._d=!1),openBlock();const I=M&&ensureValidVNode(M(s)),B=createBlock(Fragment,{key:s.key||I&&I.key||`_${a}`},I||(v?v():[]),I&&u._===1?64:-2);return!x&&B.scopeId&&(B.slotScopeIds=[B.scopeId+"-s"]),M&&M._c&&(M._d=!0),B}function ensureValidVNode(u){return u.some(a=>isVNode(a)?!(a.type===Comment||a.type===Fragment&&!ensureValidVNode(a.children)):!0)?u:null}function toHandlers(u,a){const s={};for(const v in u)s[a&&/[A-Z]/.test(v)?`on:${v}`:toHandlerKey(v)]=u[v];return s}const getPublicInstance=u=>u?isStatefulComponent(u)?getExposeProxy(u)||u.proxy:getPublicInstance(u.parent):null,publicPropertiesMap=extend(Object.create(null),{$:u=>u,$el:u=>u.vnode.el,$data:u=>u.data,$props:u=>u.props,$attrs:u=>u.attrs,$slots:u=>u.slots,$refs:u=>u.refs,$parent:u=>getPublicInstance(u.parent),$root:u=>getPublicInstance(u.root),$emit:u=>u.emit,$options:u=>resolveMergedOptions(u),$forceUpdate:u=>u.f||(u.f=()=>queueJob(u.update)),$nextTick:u=>u.n||(u.n=nextTick.bind(u.proxy)),$watch:u=>instanceWatch.bind(u)}),hasSetupBinding=(u,a)=>u!==EMPTY_OBJ&&!u.__isScriptSetup&&hasOwn(u,a),PublicInstanceProxyHandlers={get({_:u},a){const{ctx:s,setupState:v,data:x,props:M,accessCache:I,type:B,appContext:U}=u;let j;if(a[0]!=="$"){const le=I[a];if(le!==void 0)switch(le){case 1:return v[a];case 2:return x[a];case 4:return s[a];case 3:return M[a]}else{if(hasSetupBinding(v,a))return I[a]=1,v[a];if(x!==EMPTY_OBJ&&hasOwn(x,a))return I[a]=2,x[a];if((j=u.propsOptions[0])&&hasOwn(j,a))return I[a]=3,M[a];if(s!==EMPTY_OBJ&&hasOwn(s,a))return I[a]=4,s[a];shouldCacheAccess&&(I[a]=0)}}const te=publicPropertiesMap[a];let Z,oe;if(te)return a==="$attrs"&&track(u,"get",a),te(u);if((Z=B.__cssModules)&&(Z=Z[a]))return Z;if(s!==EMPTY_OBJ&&hasOwn(s,a))return I[a]=4,s[a];if(oe=U.config.globalProperties,hasOwn(oe,a))return oe[a]},set({_:u},a,s){const{data:v,setupState:x,ctx:M}=u;return hasSetupBinding(x,a)?(x[a]=s,!0):v!==EMPTY_OBJ&&hasOwn(v,a)?(v[a]=s,!0):hasOwn(u.props,a)||a[0]==="$"&&a.slice(1)in u?!1:(M[a]=s,!0)},has({_:{data:u,setupState:a,accessCache:s,ctx:v,appContext:x,propsOptions:M}},I){let B;return!!s[I]||u!==EMPTY_OBJ&&hasOwn(u,I)||hasSetupBinding(a,I)||(B=M[0])&&hasOwn(B,I)||hasOwn(v,I)||hasOwn(publicPropertiesMap,I)||hasOwn(x.config.globalProperties,I)},defineProperty(u,a,s){return s.get!=null?u._.accessCache[a]=0:hasOwn(s,"value")&&this.set(u,a,s.value,null),Reflect.defineProperty(u,a,s)}},RuntimeCompiledPublicInstanceProxyHandlers=extend({},PublicInstanceProxyHandlers,{get(u,a){if(a!==Symbol.unscopables)return PublicInstanceProxyHandlers.get(u,a,u)},has(u,a){return a[0]!=="_"&&!isGloballyWhitelisted(a)}});function defineProps(){return null}function defineEmits(){return null}function defineExpose(u){}function defineOptions(u){}function defineSlots(){return null}function defineModel(){}function withDefaults(u,a){return null}function useSlots(){return getContext().slots}function useAttrs(){return getContext().attrs}function useModel(u,a,s){const v=getCurrentInstance();if(s&&s.local){const x=ref(u[a]);return watch(()=>u[a],M=>x.value=M),watch(x,M=>{M!==u[a]&&v.emit(`update:${a}`,M)}),x}else return{__v_isRef:!0,get value(){return u[a]},set value(x){v.emit(`update:${a}`,x)}}}function getContext(){const u=getCurrentInstance();return u.setupContext||(u.setupContext=createSetupContext(u))}function normalizePropsOrEmits(u){return isArray(u)?u.reduce((a,s)=>(a[s]=null,a),{}):u}function mergeDefaults(u,a){const s=normalizePropsOrEmits(u);for(const v in a){if(v.startsWith("__skip"))continue;let x=s[v];x?isArray(x)||isFunction(x)?x=s[v]={type:x,default:a[v]}:x.default=a[v]:x===null&&(x=s[v]={default:a[v]}),x&&a[`__skip_${v}`]&&(x.skipFactory=!0)}return s}function mergeModels(u,a){return!u||!a?u||a:isArray(u)&&isArray(a)?u.concat(a):extend({},normalizePropsOrEmits(u),normalizePropsOrEmits(a))}function createPropsRestProxy(u,a){const s={};for(const v in u)a.includes(v)||Object.defineProperty(s,v,{enumerable:!0,get:()=>u[v]});return s}function withAsyncContext(u){const a=getCurrentInstance();let s=u();return unsetCurrentInstance(),isPromise(s)&&(s=s.catch(v=>{throw setCurrentInstance(a),v})),[s,()=>setCurrentInstance(a)]}let shouldCacheAccess=!0;function applyOptions(u){const a=resolveMergedOptions(u),s=u.proxy,v=u.ctx;shouldCacheAccess=!1,a.beforeCreate&&callHook$1(a.beforeCreate,u,"bc");const{data:x,computed:M,methods:I,watch:B,provide:U,inject:j,created:te,beforeMount:Z,mounted:oe,beforeUpdate:le,updated:se,activated:ve,deactivated:ce,beforeDestroy:K,beforeUnmount:X,destroyed:W,unmounted:_e,render:ge,renderTracked:Ae,renderTriggered:ee,errorCaptured:$,serverPrefetch:ae,expose:Re,inheritAttrs:pe,components:he,directives:we,filters:Ce}=a;if(j&&resolveInjections(j,v,null),I)for(const Ye in I){const it=I[Ye];isFunction(it)&&(v[Ye]=it.bind(s))}if(x){const Ye=x.call(s,s);isObject(Ye)&&(u.data=reactive(Ye))}if(shouldCacheAccess=!0,M)for(const Ye in M){const it=M[Ye],_t=isFunction(it)?it.bind(s,s):isFunction(it.get)?it.get.bind(s,s):NOOP,At=!isFunction(it)&&isFunction(it.set)?it.set.bind(s):NOOP,vt=computed({get:_t,set:At});Object.defineProperty(v,Ye,{enumerable:!0,configurable:!0,get:()=>vt.value,set:ut=>vt.value=ut})}if(B)for(const Ye in B)createWatcher(B[Ye],v,s,Ye);if(U){const Ye=isFunction(U)?U.call(s):U;Reflect.ownKeys(Ye).forEach(it=>{provide(it,Ye[it])})}te&&callHook$1(te,u,"c");function Ze(Ye,it){isArray(it)?it.forEach(_t=>Ye(_t.bind(s))):it&&Ye(it.bind(s))}if(Ze(onBeforeMount,Z),Ze(onMounted,oe),Ze(onBeforeUpdate,le),Ze(onUpdated,se),Ze(onActivated,ve),Ze(onDeactivated,ce),Ze(onErrorCaptured,$),Ze(onRenderTracked,Ae),Ze(onRenderTriggered,ee),Ze(onBeforeUnmount,X),Ze(onUnmounted,_e),Ze(onServerPrefetch,ae),isArray(Re))if(Re.length){const Ye=u.exposed||(u.exposed={});Re.forEach(it=>{Object.defineProperty(Ye,it,{get:()=>s[it],set:_t=>s[it]=_t})})}else u.exposed||(u.exposed={});ge&&u.render===NOOP&&(u.render=ge),pe!=null&&(u.inheritAttrs=pe),he&&(u.components=he),we&&(u.directives=we)}function resolveInjections(u,a,s=NOOP){isArray(u)&&(u=normalizeInject(u));for(const v in u){const x=u[v];let M;isObject(x)?"default"in x?M=inject(x.from||v,x.default,!0):M=inject(x.from||v):M=inject(x),isRef(M)?Object.defineProperty(a,v,{enumerable:!0,configurable:!0,get:()=>M.value,set:I=>M.value=I}):a[v]=M}}function callHook$1(u,a,s){callWithAsyncErrorHandling(isArray(u)?u.map(v=>v.bind(a.proxy)):u.bind(a.proxy),a,s)}function createWatcher(u,a,s,v){const x=v.includes(".")?createPathGetter(s,v):()=>s[v];if(isString(u)){const M=a[u];isFunction(M)&&watch(x,M)}else if(isFunction(u))watch(x,u.bind(s));else if(isObject(u))if(isArray(u))u.forEach(M=>createWatcher(M,a,s,v));else{const M=isFunction(u.handler)?u.handler.bind(s):a[u.handler];isFunction(M)&&watch(x,M,u)}}function resolveMergedOptions(u){const a=u.type,{mixins:s,extends:v}=a,{mixins:x,optionsCache:M,config:{optionMergeStrategies:I}}=u.appContext,B=M.get(a);let U;return B?U=B:!x.length&&!s&&!v?U=a:(U={},x.length&&x.forEach(j=>mergeOptions(U,j,I,!0)),mergeOptions(U,a,I)),isObject(a)&&M.set(a,U),U}function mergeOptions(u,a,s,v=!1){const{mixins:x,extends:M}=a;M&&mergeOptions(u,M,s,!0),x&&x.forEach(I=>mergeOptions(u,I,s,!0));for(const I in a)if(!(v&&I==="expose")){const B=internalOptionMergeStrats[I]||s&&s[I];u[I]=B?B(u[I],a[I]):a[I]}return u}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray$1,created:mergeAsArray$1,beforeMount:mergeAsArray$1,mounted:mergeAsArray$1,beforeUpdate:mergeAsArray$1,updated:mergeAsArray$1,beforeDestroy:mergeAsArray$1,beforeUnmount:mergeAsArray$1,destroyed:mergeAsArray$1,unmounted:mergeAsArray$1,activated:mergeAsArray$1,deactivated:mergeAsArray$1,errorCaptured:mergeAsArray$1,serverPrefetch:mergeAsArray$1,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(u,a){return a?u?function(){return extend(isFunction(u)?u.call(this,this):u,isFunction(a)?a.call(this,this):a)}:a:u}function mergeInject(u,a){return mergeObjectOptions(normalizeInject(u),normalizeInject(a))}function normalizeInject(u){if(isArray(u)){const a={};for(let s=0;s<u.length;s++)a[u[s]]=u[s];return a}return u}function mergeAsArray$1(u,a){return u?[...new Set([].concat(u,a))]:a}function mergeObjectOptions(u,a){return u?extend(Object.create(null),u,a):a}function mergeEmitsOrPropsOptions(u,a){return u?isArray(u)&&isArray(a)?[...new Set([...u,...a])]:extend(Object.create(null),normalizePropsOrEmits(u),normalizePropsOrEmits(a??{})):a}function mergeWatchOptions(u,a){if(!u)return a;if(!a)return u;const s=extend(Object.create(null),u);for(const v in a)s[v]=mergeAsArray$1(u[v],a[v]);return s}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(u,a){return function(v,x=null){isFunction(v)||(v=extend({},v)),x!=null&&!isObject(x)&&(x=null);const M=createAppContext(),I=new Set;let B=!1;const U=M.app={_uid:uid$1++,_component:v,_props:x,_container:null,_context:M,_instance:null,version,get config(){return M.config},set config(j){},use(j,...te){return I.has(j)||(j&&isFunction(j.install)?(I.add(j),j.install(U,...te)):isFunction(j)&&(I.add(j),j(U,...te))),U},mixin(j){return M.mixins.includes(j)||M.mixins.push(j),U},component(j,te){return te?(M.components[j]=te,U):M.components[j]},directive(j,te){return te?(M.directives[j]=te,U):M.directives[j]},mount(j,te,Z){if(!B){const oe=createVNode(v,x);return oe.appContext=M,te&&a?a(oe,j):u(oe,j,Z),B=!0,U._container=j,j.__vue_app__=U,getExposeProxy(oe.component)||oe.component.proxy}},unmount(){B&&(u(null,U._container),delete U._container.__vue_app__)},provide(j,te){return M.provides[j]=te,U},runWithContext(j){currentApp=U;try{return j()}finally{currentApp=null}}};return U}}let currentApp=null;function provide(u,a){if(currentInstance){let s=currentInstance.provides;const v=currentInstance.parent&&currentInstance.parent.provides;v===s&&(s=currentInstance.provides=Object.create(v)),s[u]=a}}function inject(u,a,s=!1){const v=currentInstance||currentRenderingInstance;if(v||currentApp){const x=v?v.parent==null?v.vnode.appContext&&v.vnode.appContext.provides:v.parent.provides:currentApp._context.provides;if(x&&u in x)return x[u];if(arguments.length>1)return s&&isFunction(a)?a.call(v&&v.proxy):a}}function hasInjectionContext(){return!!(currentInstance||currentRenderingInstance||currentApp)}function initProps(u,a,s,v=!1){const x={},M={};def(M,InternalObjectKey,1),u.propsDefaults=Object.create(null),setFullProps(u,a,x,M);for(const I in u.propsOptions[0])I in x||(x[I]=void 0);s?u.props=v?x:shallowReactive(x):u.type.props?u.props=x:u.props=M,u.attrs=M}function updateProps(u,a,s,v){const{props:x,attrs:M,vnode:{patchFlag:I}}=u,B=toRaw(x),[U]=u.propsOptions;let j=!1;if((v||I>0)&&!(I&16)){if(I&8){const te=u.vnode.dynamicProps;for(let Z=0;Z<te.length;Z++){let oe=te[Z];if(isEmitListener(u.emitsOptions,oe))continue;const le=a[oe];if(U)if(hasOwn(M,oe))le!==M[oe]&&(M[oe]=le,j=!0);else{const se=camelize(oe);x[se]=resolvePropValue(U,B,se,le,u,!1)}else le!==M[oe]&&(M[oe]=le,j=!0)}}}else{setFullProps(u,a,x,M)&&(j=!0);let te;for(const Z in B)(!a||!hasOwn(a,Z)&&((te=hyphenate(Z))===Z||!hasOwn(a,te)))&&(U?s&&(s[Z]!==void 0||s[te]!==void 0)&&(x[Z]=resolvePropValue(U,B,Z,void 0,u,!0)):delete x[Z]);if(M!==B)for(const Z in M)(!a||!hasOwn(a,Z))&&(delete M[Z],j=!0)}j&&trigger(u,"set","$attrs")}function setFullProps(u,a,s,v){const[x,M]=u.propsOptions;let I=!1,B;if(a)for(let U in a){if(isReservedProp(U))continue;const j=a[U];let te;x&&hasOwn(x,te=camelize(U))?!M||!M.includes(te)?s[te]=j:(B||(B={}))[te]=j:isEmitListener(u.emitsOptions,U)||(!(U in v)||j!==v[U])&&(v[U]=j,I=!0)}if(M){const U=toRaw(s),j=B||EMPTY_OBJ;for(let te=0;te<M.length;te++){const Z=M[te];s[Z]=resolvePropValue(x,U,Z,j[Z],u,!hasOwn(j,Z))}}return I}function resolvePropValue(u,a,s,v,x,M){const I=u[s];if(I!=null){const B=hasOwn(I,"default");if(B&&v===void 0){const U=I.default;if(I.type!==Function&&!I.skipFactory&&isFunction(U)){const{propsDefaults:j}=x;s in j?v=j[s]:(setCurrentInstance(x),v=j[s]=U.call(null,a),unsetCurrentInstance())}else v=U}I[0]&&(M&&!B?v=!1:I[1]&&(v===""||v===hyphenate(s))&&(v=!0))}return v}function normalizePropsOptions(u,a,s=!1){const v=a.propsCache,x=v.get(u);if(x)return x;const M=u.props,I={},B=[];let U=!1;if(!isFunction(u)){const te=Z=>{U=!0;const[oe,le]=normalizePropsOptions(Z,a,!0);extend(I,oe),le&&B.push(...le)};!s&&a.mixins.length&&a.mixins.forEach(te),u.extends&&te(u.extends),u.mixins&&u.mixins.forEach(te)}if(!M&&!U)return isObject(u)&&v.set(u,EMPTY_ARR),EMPTY_ARR;if(isArray(M))for(let te=0;te<M.length;te++){const Z=camelize(M[te]);validatePropName(Z)&&(I[Z]=EMPTY_OBJ)}else if(M)for(const te in M){const Z=camelize(te);if(validatePropName(Z)){const oe=M[te],le=I[Z]=isArray(oe)||isFunction(oe)?{type:oe}:extend({},oe);if(le){const se=getTypeIndex(Boolean,le.type),ve=getTypeIndex(String,le.type);le[0]=se>-1,le[1]=ve<0||se<ve,(se>-1||hasOwn(le,"default"))&&B.push(Z)}}}const j=[I,B];return isObject(u)&&v.set(u,j),j}function validatePropName(u){return u[0]!=="$"}function getType(u){const a=u&&u.toString().match(/^\s*(function|class) (\w+)/);return a?a[2]:u===null?"null":""}function isSameType(u,a){return getType(u)===getType(a)}function getTypeIndex(u,a){return isArray(a)?a.findIndex(s=>isSameType(s,u)):isFunction(a)&&isSameType(a,u)?0:-1}const isInternalKey=u=>u[0]==="_"||u==="$stable",normalizeSlotValue=u=>isArray(u)?u.map(normalizeVNode):[normalizeVNode(u)],normalizeSlot=(u,a,s)=>{if(a._n)return a;const v=withCtx((...x)=>normalizeSlotValue(a(...x)),s);return v._c=!1,v},normalizeObjectSlots=(u,a,s)=>{const v=u._ctx;for(const x in u){if(isInternalKey(x))continue;const M=u[x];if(isFunction(M))a[x]=normalizeSlot(x,M,v);else if(M!=null){const I=normalizeSlotValue(M);a[x]=()=>I}}},normalizeVNodeSlots=(u,a)=>{const s=normalizeSlotValue(a);u.slots.default=()=>s},initSlots=(u,a)=>{if(u.vnode.shapeFlag&32){const s=a._;s?(u.slots=toRaw(a),def(a,"_",s)):normalizeObjectSlots(a,u.slots={})}else u.slots={},a&&normalizeVNodeSlots(u,a);def(u.slots,InternalObjectKey,1)},updateSlots=(u,a,s)=>{const{vnode:v,slots:x}=u;let M=!0,I=EMPTY_OBJ;if(v.shapeFlag&32){const B=a._;B?s&&B===1?M=!1:(extend(x,a),!s&&B===1&&delete x._):(M=!a.$stable,normalizeObjectSlots(a,x)),I=a}else a&&(normalizeVNodeSlots(u,a),I={default:1});if(M)for(const B in x)!isInternalKey(B)&&!(B in I)&&delete x[B]};function setRef(u,a,s,v,x=!1){if(isArray(u)){u.forEach((oe,le)=>setRef(oe,a&&(isArray(a)?a[le]:a),s,v,x));return}if(isAsyncWrapper(v)&&!x)return;const M=v.shapeFlag&4?getExposeProxy(v.component)||v.component.proxy:v.el,I=x?null:M,{i:B,r:U}=u,j=a&&a.r,te=B.refs===EMPTY_OBJ?B.refs={}:B.refs,Z=B.setupState;if(j!=null&&j!==U&&(isString(j)?(te[j]=null,hasOwn(Z,j)&&(Z[j]=null)):isRef(j)&&(j.value=null)),isFunction(U))callWithErrorHandling(U,B,12,[I,te]);else{const oe=isString(U),le=isRef(U);if(oe||le){const se=()=>{if(u.f){const ve=oe?hasOwn(Z,U)?Z[U]:te[U]:U.value;x?isArray(ve)&&remove(ve,M):isArray(ve)?ve.includes(M)||ve.push(M):oe?(te[U]=[M],hasOwn(Z,U)&&(Z[U]=te[U])):(U.value=[M],u.k&&(te[u.k]=U.value))}else oe?(te[U]=I,hasOwn(Z,U)&&(Z[U]=I)):le&&(U.value=I,u.k&&(te[u.k]=I))};I?(se.id=-1,queuePostRenderEffect(se,s)):se()}}}let hasMismatch=!1;const isSVGContainer=u=>/svg/.test(u.namespaceURI)&&u.tagName!=="foreignObject",isComment=u=>u.nodeType===8;function createHydrationFunctions(u){const{mt:a,p:s,o:{patchProp:v,createText:x,nextSibling:M,parentNode:I,remove:B,insert:U,createComment:j}}=u,te=(K,X)=>{if(!X.hasChildNodes()){s(null,K,X),flushPostFlushCbs(),X._vnode=K;return}hasMismatch=!1,Z(X.firstChild,K,null,null,null),flushPostFlushCbs(),X._vnode=K,hasMismatch&&console.error("Hydration completed but contains mismatches.")},Z=(K,X,W,_e,ge,Ae=!1)=>{const ee=isComment(K)&&K.data==="[",$=()=>ve(K,X,W,_e,ge,ee),{type:ae,ref:Re,shapeFlag:pe,patchFlag:he}=X;let we=K.nodeType;X.el=K,he===-2&&(Ae=!1,X.dynamicChildren=null);let Ce=null;switch(ae){case Text:we!==3?X.children===""?(U(X.el=x(""),I(K),K),Ce=K):Ce=$():(K.data!==X.children&&(hasMismatch=!0,K.data=X.children),Ce=M(K));break;case Comment:we!==8||ee?Ce=$():Ce=M(K);break;case Static:if(ee&&(K=M(K),we=K.nodeType),we===1||we===3){Ce=K;const Ne=!X.children.length;for(let Ze=0;Ze<X.staticCount;Ze++)Ne&&(X.children+=Ce.nodeType===1?Ce.outerHTML:Ce.data),Ze===X.staticCount-1&&(X.anchor=Ce),Ce=M(Ce);return ee?M(Ce):Ce}else $();break;case Fragment:ee?Ce=se(K,X,W,_e,ge,Ae):Ce=$();break;default:if(pe&1)we!==1||X.type.toLowerCase()!==K.tagName.toLowerCase()?Ce=$():Ce=oe(K,X,W,_e,ge,Ae);else if(pe&6){X.slotScopeIds=ge;const Ne=I(K);if(a(X,Ne,null,W,_e,isSVGContainer(Ne),Ae),Ce=ee?ce(K):M(K),Ce&&isComment(Ce)&&Ce.data==="teleport end"&&(Ce=M(Ce)),isAsyncWrapper(X)){let Ze;ee?(Ze=createVNode(Fragment),Ze.anchor=Ce?Ce.previousSibling:Ne.lastChild):Ze=K.nodeType===3?createTextVNode(""):createVNode("div"),Ze.el=K,X.component.subTree=Ze}}else pe&64?we!==8?Ce=$():Ce=X.type.hydrate(K,X,W,_e,ge,Ae,u,le):pe&128&&(Ce=X.type.hydrate(K,X,W,_e,isSVGContainer(I(K)),ge,Ae,u,Z))}return Re!=null&&setRef(Re,null,_e,X),Ce},oe=(K,X,W,_e,ge,Ae)=>{Ae=Ae||!!X.dynamicChildren;const{type:ee,props:$,patchFlag:ae,shapeFlag:Re,dirs:pe}=X,he=ee==="input"&&pe||ee==="option";if(he||ae!==-1){if(pe&&invokeDirectiveHook(X,null,W,"created"),$)if(he||!Ae||ae&48)for(const Ce in $)(he&&Ce.endsWith("value")||isOn(Ce)&&!isReservedProp(Ce))&&v(K,Ce,null,$[Ce],!1,void 0,W);else $.onClick&&v(K,"onClick",null,$.onClick,!1,void 0,W);let we;if((we=$&&$.onVnodeBeforeMount)&&invokeVNodeHook(we,W,X),pe&&invokeDirectiveHook(X,null,W,"beforeMount"),((we=$&&$.onVnodeMounted)||pe)&&queueEffectWithSuspense(()=>{we&&invokeVNodeHook(we,W,X),pe&&invokeDirectiveHook(X,null,W,"mounted")},_e),Re&16&&!($&&($.innerHTML||$.textContent))){let Ce=le(K.firstChild,X,K,W,_e,ge,Ae);for(;Ce;){hasMismatch=!0;const Ne=Ce;Ce=Ce.nextSibling,B(Ne)}}else Re&8&&K.textContent!==X.children&&(hasMismatch=!0,K.textContent=X.children)}return K.nextSibling},le=(K,X,W,_e,ge,Ae,ee)=>{ee=ee||!!X.dynamicChildren;const $=X.children,ae=$.length;for(let Re=0;Re<ae;Re++){const pe=ee?$[Re]:$[Re]=normalizeVNode($[Re]);if(K)K=Z(K,pe,_e,ge,Ae,ee);else{if(pe.type===Text&&!pe.children)continue;hasMismatch=!0,s(null,pe,W,null,_e,ge,isSVGContainer(W),Ae)}}return K},se=(K,X,W,_e,ge,Ae)=>{const{slotScopeIds:ee}=X;ee&&(ge=ge?ge.concat(ee):ee);const $=I(K),ae=le(M(K),X,$,W,_e,ge,Ae);return ae&&isComment(ae)&&ae.data==="]"?M(X.anchor=ae):(hasMismatch=!0,U(X.anchor=j("]"),$,ae),ae)},ve=(K,X,W,_e,ge,Ae)=>{if(hasMismatch=!0,X.el=null,Ae){const ae=ce(K);for(;;){const Re=M(K);if(Re&&Re!==ae)B(Re);else break}}const ee=M(K),$=I(K);return B(K),s(null,X,$,ee,W,_e,isSVGContainer($),ge),ee},ce=K=>{let X=0;for(;K;)if(K=M(K),K&&isComment(K)&&(K.data==="["&&X++,K.data==="]")){if(X===0)return M(K);X--}return K};return[te,Z]}const queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(u){return baseCreateRenderer(u)}function createHydrationRenderer(u){return baseCreateRenderer(u,createHydrationFunctions)}function baseCreateRenderer(u,a){const s=getGlobalThis();s.__VUE__=!0;const{insert:v,remove:x,patchProp:M,createElement:I,createText:B,createComment:U,setText:j,setElementText:te,parentNode:Z,nextSibling:oe,setScopeId:le=NOOP,insertStaticContent:se}=u,ve=(Xe,Xt,tn,dn=null,pn=null,Pn=null,Cn=!1,vn=null,In=!!Xt.dynamicChildren)=>{if(Xe===Xt)return;Xe&&!isSameVNodeType(Xe,Xt)&&(dn=bt(Xe),ut(Xe,pn,Pn,!0),Xe=null),Xt.patchFlag===-2&&(In=!1,Xt.dynamicChildren=null);const{type:Fn,ref:Hn,shapeFlag:fe}=Xt;switch(Fn){case Text:ce(Xe,Xt,tn,dn);break;case Comment:K(Xe,Xt,tn,dn);break;case Static:Xe==null&&X(Xt,tn,dn,Cn);break;case Fragment:he(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In);break;default:fe&1?ge(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In):fe&6?we(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In):(fe&64||fe&128)&&Fn.process(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In,bn)}Hn!=null&&pn&&setRef(Hn,Xe&&Xe.ref,Pn,Xt||Xe,!Xt)},ce=(Xe,Xt,tn,dn)=>{if(Xe==null)v(Xt.el=B(Xt.children),tn,dn);else{const pn=Xt.el=Xe.el;Xt.children!==Xe.children&&j(pn,Xt.children)}},K=(Xe,Xt,tn,dn)=>{Xe==null?v(Xt.el=U(Xt.children||""),tn,dn):Xt.el=Xe.el},X=(Xe,Xt,tn,dn)=>{[Xe.el,Xe.anchor]=se(Xe.children,Xt,tn,dn,Xe.el,Xe.anchor)},W=({el:Xe,anchor:Xt},tn,dn)=>{let pn;for(;Xe&&Xe!==Xt;)pn=oe(Xe),v(Xe,tn,dn),Xe=pn;v(Xt,tn,dn)},_e=({el:Xe,anchor:Xt})=>{let tn;for(;Xe&&Xe!==Xt;)tn=oe(Xe),x(Xe),Xe=tn;x(Xt)},ge=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In)=>{Cn=Cn||Xt.type==="svg",Xe==null?Ae(Xt,tn,dn,pn,Pn,Cn,vn,In):ae(Xe,Xt,pn,Pn,Cn,vn,In)},Ae=(Xe,Xt,tn,dn,pn,Pn,Cn,vn)=>{let In,Fn;const{type:Hn,props:fe,shapeFlag:Se,transition:Ve,dirs:We}=Xe;if(In=Xe.el=I(Xe.type,Pn,fe&&fe.is,fe),Se&8?te(In,Xe.children):Se&16&&$(Xe.children,In,null,dn,pn,Pn&&Hn!=="foreignObject",Cn,vn),We&&invokeDirectiveHook(Xe,null,dn,"created"),ee(In,Xe,Xe.scopeId,Cn,dn),fe){for(const It in fe)It!=="value"&&!isReservedProp(It)&&M(In,It,null,fe[It],Pn,Xe.children,dn,pn,ft);"value"in fe&&M(In,"value",null,fe.value),(Fn=fe.onVnodeBeforeMount)&&invokeVNodeHook(Fn,dn,Xe)}We&&invokeDirectiveHook(Xe,null,dn,"beforeMount");const pt=(!pn||pn&&!pn.pendingBranch)&&Ve&&!Ve.persisted;pt&&Ve.beforeEnter(In),v(In,Xt,tn),((Fn=fe&&fe.onVnodeMounted)||pt||We)&&queuePostRenderEffect(()=>{Fn&&invokeVNodeHook(Fn,dn,Xe),pt&&Ve.enter(In),We&&invokeDirectiveHook(Xe,null,dn,"mounted")},pn)},ee=(Xe,Xt,tn,dn,pn)=>{if(tn&&le(Xe,tn),dn)for(let Pn=0;Pn<dn.length;Pn++)le(Xe,dn[Pn]);if(pn){let Pn=pn.subTree;if(Xt===Pn){const Cn=pn.vnode;ee(Xe,Cn,Cn.scopeId,Cn.slotScopeIds,pn.parent)}}},$=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In=0)=>{for(let Fn=In;Fn<Xe.length;Fn++){const Hn=Xe[Fn]=vn?cloneIfMounted(Xe[Fn]):normalizeVNode(Xe[Fn]);ve(null,Hn,Xt,tn,dn,pn,Pn,Cn,vn)}},ae=(Xe,Xt,tn,dn,pn,Pn,Cn)=>{const vn=Xt.el=Xe.el;let{patchFlag:In,dynamicChildren:Fn,dirs:Hn}=Xt;In|=Xe.patchFlag&16;const fe=Xe.props||EMPTY_OBJ,Se=Xt.props||EMPTY_OBJ;let Ve;tn&&toggleRecurse(tn,!1),(Ve=Se.onVnodeBeforeUpdate)&&invokeVNodeHook(Ve,tn,Xt,Xe),Hn&&invokeDirectiveHook(Xt,Xe,tn,"beforeUpdate"),tn&&toggleRecurse(tn,!0);const We=pn&&Xt.type!=="foreignObject";if(Fn?Re(Xe.dynamicChildren,Fn,vn,tn,dn,We,Pn):Cn||it(Xe,Xt,vn,null,tn,dn,We,Pn,!1),In>0){if(In&16)pe(vn,Xt,fe,Se,tn,dn,pn);else if(In&2&&fe.class!==Se.class&&M(vn,"class",null,Se.class,pn),In&4&&M(vn,"style",fe.style,Se.style,pn),In&8){const pt=Xt.dynamicProps;for(let It=0;It<pt.length;It++){const $t=pt[It],nn=fe[$t],Ht=Se[$t];(Ht!==nn||$t==="value")&&M(vn,$t,nn,Ht,pn,Xe.children,tn,dn,ft)}}In&1&&Xe.children!==Xt.children&&te(vn,Xt.children)}else!Cn&&Fn==null&&pe(vn,Xt,fe,Se,tn,dn,pn);((Ve=Se.onVnodeUpdated)||Hn)&&queuePostRenderEffect(()=>{Ve&&invokeVNodeHook(Ve,tn,Xt,Xe),Hn&&invokeDirectiveHook(Xt,Xe,tn,"updated")},dn)},Re=(Xe,Xt,tn,dn,pn,Pn,Cn)=>{for(let vn=0;vn<Xt.length;vn++){const In=Xe[vn],Fn=Xt[vn],Hn=In.el&&(In.type===Fragment||!isSameVNodeType(In,Fn)||In.shapeFlag&70)?Z(In.el):tn;ve(In,Fn,Hn,null,dn,pn,Pn,Cn,!0)}},pe=(Xe,Xt,tn,dn,pn,Pn,Cn)=>{if(tn!==dn){if(tn!==EMPTY_OBJ)for(const vn in tn)!isReservedProp(vn)&&!(vn in dn)&&M(Xe,vn,tn[vn],null,Cn,Xt.children,pn,Pn,ft);for(const vn in dn){if(isReservedProp(vn))continue;const In=dn[vn],Fn=tn[vn];In!==Fn&&vn!=="value"&&M(Xe,vn,Fn,In,Cn,Xt.children,pn,Pn,ft)}"value"in dn&&M(Xe,"value",tn.value,dn.value)}},he=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In)=>{const Fn=Xt.el=Xe?Xe.el:B(""),Hn=Xt.anchor=Xe?Xe.anchor:B("");let{patchFlag:fe,dynamicChildren:Se,slotScopeIds:Ve}=Xt;Ve&&(vn=vn?vn.concat(Ve):Ve),Xe==null?(v(Fn,tn,dn),v(Hn,tn,dn),$(Xt.children,tn,Hn,pn,Pn,Cn,vn,In)):fe>0&&fe&64&&Se&&Xe.dynamicChildren?(Re(Xe.dynamicChildren,Se,tn,pn,Pn,Cn,vn),(Xt.key!=null||pn&&Xt===pn.subTree)&&traverseStaticChildren(Xe,Xt,!0)):it(Xe,Xt,tn,Hn,pn,Pn,Cn,vn,In)},we=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In)=>{Xt.slotScopeIds=vn,Xe==null?Xt.shapeFlag&512?pn.ctx.activate(Xt,tn,dn,Cn,In):Ce(Xt,tn,dn,pn,Pn,Cn,In):Ne(Xe,Xt,In)},Ce=(Xe,Xt,tn,dn,pn,Pn,Cn)=>{const vn=Xe.component=createComponentInstance(Xe,dn,pn);if(isKeepAlive(Xe)&&(vn.ctx.renderer=bn),setupComponent(vn),vn.asyncDep){if(pn&&pn.registerDep(vn,Ze),!Xe.el){const In=vn.subTree=createVNode(Comment);K(null,In,Xt,tn)}return}Ze(vn,Xe,Xt,tn,pn,Pn,Cn)},Ne=(Xe,Xt,tn)=>{const dn=Xt.component=Xe.component;if(shouldUpdateComponent(Xe,Xt,tn))if(dn.asyncDep&&!dn.asyncResolved){Ye(dn,Xt,tn);return}else dn.next=Xt,invalidateJob(dn.update),dn.update();else Xt.el=Xe.el,dn.vnode=Xt},Ze=(Xe,Xt,tn,dn,pn,Pn,Cn)=>{const vn=()=>{if(Xe.isMounted){let{next:Hn,bu:fe,u:Se,parent:Ve,vnode:We}=Xe,pt=Hn,It;toggleRecurse(Xe,!1),Hn?(Hn.el=We.el,Ye(Xe,Hn,Cn)):Hn=We,fe&&invokeArrayFns(fe),(It=Hn.props&&Hn.props.onVnodeBeforeUpdate)&&invokeVNodeHook(It,Ve,Hn,We),toggleRecurse(Xe,!0);const $t=renderComponentRoot(Xe),nn=Xe.subTree;Xe.subTree=$t,ve(nn,$t,Z(nn.el),bt(nn),Xe,pn,Pn),Hn.el=$t.el,pt===null&&updateHOCHostEl(Xe,$t.el),Se&&queuePostRenderEffect(Se,pn),(It=Hn.props&&Hn.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(It,Ve,Hn,We),pn)}else{let Hn;const{el:fe,props:Se}=Xt,{bm:Ve,m:We,parent:pt}=Xe,It=isAsyncWrapper(Xt);if(toggleRecurse(Xe,!1),Ve&&invokeArrayFns(Ve),!It&&(Hn=Se&&Se.onVnodeBeforeMount)&&invokeVNodeHook(Hn,pt,Xt),toggleRecurse(Xe,!0),fe&&pi){const $t=()=>{Xe.subTree=renderComponentRoot(Xe),pi(fe,Xe.subTree,Xe,pn,null)};It?Xt.type.__asyncLoader().then(()=>!Xe.isUnmounted&&$t()):$t()}else{const $t=Xe.subTree=renderComponentRoot(Xe);ve(null,$t,tn,dn,Xe,pn,Pn),Xt.el=$t.el}if(We&&queuePostRenderEffect(We,pn),!It&&(Hn=Se&&Se.onVnodeMounted)){const $t=Xt;queuePostRenderEffect(()=>invokeVNodeHook(Hn,pt,$t),pn)}(Xt.shapeFlag&256||pt&&isAsyncWrapper(pt.vnode)&&pt.vnode.shapeFlag&256)&&Xe.a&&queuePostRenderEffect(Xe.a,pn),Xe.isMounted=!0,Xt=tn=dn=null}},In=Xe.effect=new ReactiveEffect(vn,()=>queueJob(Fn),Xe.scope),Fn=Xe.update=()=>In.run();Fn.id=Xe.uid,toggleRecurse(Xe,!0),Fn()},Ye=(Xe,Xt,tn)=>{Xt.component=Xe;const dn=Xe.vnode.props;Xe.vnode=Xt,Xe.next=null,updateProps(Xe,Xt.props,dn,tn),updateSlots(Xe,Xt.children,tn),pauseTracking(),flushPreFlushCbs(),resetTracking()},it=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In=!1)=>{const Fn=Xe&&Xe.children,Hn=Xe?Xe.shapeFlag:0,fe=Xt.children,{patchFlag:Se,shapeFlag:Ve}=Xt;if(Se>0){if(Se&128){At(Fn,fe,tn,dn,pn,Pn,Cn,vn,In);return}else if(Se&256){_t(Fn,fe,tn,dn,pn,Pn,Cn,vn,In);return}}Ve&8?(Hn&16&&ft(Fn,pn,Pn),fe!==Fn&&te(tn,fe)):Hn&16?Ve&16?At(Fn,fe,tn,dn,pn,Pn,Cn,vn,In):ft(Fn,pn,Pn,!0):(Hn&8&&te(tn,""),Ve&16&&$(fe,tn,dn,pn,Pn,Cn,vn,In))},_t=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In)=>{Xe=Xe||EMPTY_ARR,Xt=Xt||EMPTY_ARR;const Fn=Xe.length,Hn=Xt.length,fe=Math.min(Fn,Hn);let Se;for(Se=0;Se<fe;Se++){const Ve=Xt[Se]=In?cloneIfMounted(Xt[Se]):normalizeVNode(Xt[Se]);ve(Xe[Se],Ve,tn,null,pn,Pn,Cn,vn,In)}Fn>Hn?ft(Xe,pn,Pn,!0,!1,fe):$(Xt,tn,dn,pn,Pn,Cn,vn,In,fe)},At=(Xe,Xt,tn,dn,pn,Pn,Cn,vn,In)=>{let Fn=0;const Hn=Xt.length;let fe=Xe.length-1,Se=Hn-1;for(;Fn<=fe&&Fn<=Se;){const Ve=Xe[Fn],We=Xt[Fn]=In?cloneIfMounted(Xt[Fn]):normalizeVNode(Xt[Fn]);if(isSameVNodeType(Ve,We))ve(Ve,We,tn,null,pn,Pn,Cn,vn,In);else break;Fn++}for(;Fn<=fe&&Fn<=Se;){const Ve=Xe[fe],We=Xt[Se]=In?cloneIfMounted(Xt[Se]):normalizeVNode(Xt[Se]);if(isSameVNodeType(Ve,We))ve(Ve,We,tn,null,pn,Pn,Cn,vn,In);else break;fe--,Se--}if(Fn>fe){if(Fn<=Se){const Ve=Se+1,We=Ve<Hn?Xt[Ve].el:dn;for(;Fn<=Se;)ve(null,Xt[Fn]=In?cloneIfMounted(Xt[Fn]):normalizeVNode(Xt[Fn]),tn,We,pn,Pn,Cn,vn,In),Fn++}}else if(Fn>Se)for(;Fn<=fe;)ut(Xe[Fn],pn,Pn,!0),Fn++;else{const Ve=Fn,We=Fn,pt=new Map;for(Fn=We;Fn<=Se;Fn++){const Nn=Xt[Fn]=In?cloneIfMounted(Xt[Fn]):normalizeVNode(Xt[Fn]);Nn.key!=null&&pt.set(Nn.key,Fn)}let It,$t=0;const nn=Se-We+1;let Ht=!1,Wn=0;const Ln=new Array(nn);for(Fn=0;Fn<nn;Fn++)Ln[Fn]=0;for(Fn=Ve;Fn<=fe;Fn++){const Nn=Xe[Fn];if($t>=nn){ut(Nn,pn,Pn,!0);continue}let Zn;if(Nn.key!=null)Zn=pt.get(Nn.key);else for(It=We;It<=Se;It++)if(Ln[It-We]===0&&isSameVNodeType(Nn,Xt[It])){Zn=It;break}Zn===void 0?ut(Nn,pn,Pn,!0):(Ln[Zn-We]=Fn+1,Zn>=Wn?Wn=Zn:Ht=!0,ve(Nn,Xt[Zn],tn,null,pn,Pn,Cn,vn,In),$t++)}const Qn=Ht?getSequence(Ln):EMPTY_ARR;for(It=Qn.length-1,Fn=nn-1;Fn>=0;Fn--){const Nn=We+Fn,Zn=Xt[Nn],Qi=Nn+1<Hn?Xt[Nn+1].el:dn;Ln[Fn]===0?ve(null,Zn,tn,Qi,pn,Pn,Cn,vn,In):Ht&&(It<0||Fn!==Qn[It]?vt(Zn,tn,Qi,2):It--)}}},vt=(Xe,Xt,tn,dn,pn=null)=>{const{el:Pn,type:Cn,transition:vn,children:In,shapeFlag:Fn}=Xe;if(Fn&6){vt(Xe.component.subTree,Xt,tn,dn);return}if(Fn&128){Xe.suspense.move(Xt,tn,dn);return}if(Fn&64){Cn.move(Xe,Xt,tn,bn);return}if(Cn===Fragment){v(Pn,Xt,tn);for(let fe=0;fe<In.length;fe++)vt(In[fe],Xt,tn,dn);v(Xe.anchor,Xt,tn);return}if(Cn===Static){W(Xe,Xt,tn);return}if(dn!==2&&Fn&1&&vn)if(dn===0)vn.beforeEnter(Pn),v(Pn,Xt,tn),queuePostRenderEffect(()=>vn.enter(Pn),pn);else{const{leave:fe,delayLeave:Se,afterLeave:Ve}=vn,We=()=>v(Pn,Xt,tn),pt=()=>{fe(Pn,()=>{We(),Ve&&Ve()})};Se?Se(Pn,We,pt):pt()}else v(Pn,Xt,tn)},ut=(Xe,Xt,tn,dn=!1,pn=!1)=>{const{type:Pn,props:Cn,ref:vn,children:In,dynamicChildren:Fn,shapeFlag:Hn,patchFlag:fe,dirs:Se}=Xe;if(vn!=null&&setRef(vn,null,tn,Xe,!0),Hn&256){Xt.ctx.deactivate(Xe);return}const Ve=Hn&1&&Se,We=!isAsyncWrapper(Xe);let pt;if(We&&(pt=Cn&&Cn.onVnodeBeforeUnmount)&&invokeVNodeHook(pt,Xt,Xe),Hn&6)Qe(Xe.component,tn,dn);else{if(Hn&128){Xe.suspense.unmount(tn,dn);return}Ve&&invokeDirectiveHook(Xe,null,Xt,"beforeUnmount"),Hn&64?Xe.type.remove(Xe,Xt,tn,pn,bn,dn):Fn&&(Pn!==Fragment||fe>0&&fe&64)?ft(Fn,Xt,tn,!1,!0):(Pn===Fragment&&fe&384||!pn&&Hn&16)&&ft(In,Xt,tn),dn&&Nt(Xe)}(We&&(pt=Cn&&Cn.onVnodeUnmounted)||Ve)&&queuePostRenderEffect(()=>{pt&&invokeVNodeHook(pt,Xt,Xe),Ve&&invokeDirectiveHook(Xe,null,Xt,"unmounted")},tn)},Nt=Xe=>{const{type:Xt,el:tn,anchor:dn,transition:pn}=Xe;if(Xt===Fragment){Qt(tn,dn);return}if(Xt===Static){_e(Xe);return}const Pn=()=>{x(tn),pn&&!pn.persisted&&pn.afterLeave&&pn.afterLeave()};if(Xe.shapeFlag&1&&pn&&!pn.persisted){const{leave:Cn,delayLeave:vn}=pn,In=()=>Cn(tn,Pn);vn?vn(Xe.el,Pn,In):In()}else Pn()},Qt=(Xe,Xt)=>{let tn;for(;Xe!==Xt;)tn=oe(Xe),x(Xe),Xe=tn;x(Xt)},Qe=(Xe,Xt,tn)=>{const{bum:dn,scope:pn,update:Pn,subTree:Cn,um:vn}=Xe;dn&&invokeArrayFns(dn),pn.stop(),Pn&&(Pn.active=!1,ut(Cn,Xe,Xt,tn)),vn&&queuePostRenderEffect(vn,Xt),queuePostRenderEffect(()=>{Xe.isUnmounted=!0},Xt),Xt&&Xt.pendingBranch&&!Xt.isUnmounted&&Xe.asyncDep&&!Xe.asyncResolved&&Xe.suspenseId===Xt.pendingId&&(Xt.deps--,Xt.deps===0&&Xt.resolve())},ft=(Xe,Xt,tn,dn=!1,pn=!1,Pn=0)=>{for(let Cn=Pn;Cn<Xe.length;Cn++)ut(Xe[Cn],Xt,tn,dn,pn)},bt=Xe=>Xe.shapeFlag&6?bt(Xe.component.subTree):Xe.shapeFlag&128?Xe.suspense.next():oe(Xe.anchor||Xe.el),sn=(Xe,Xt,tn)=>{Xe==null?Xt._vnode&&ut(Xt._vnode,null,null,!0):ve(Xt._vnode||null,Xe,Xt,null,null,null,tn),flushPreFlushCbs(),flushPostFlushCbs(),Xt._vnode=Xe},bn={p:ve,um:ut,m:vt,r:Nt,mt:Ce,mc:$,pc:it,pbc:Re,n:bt,o:u};let Un,pi;return a&&([Un,pi]=a(bn)),{render:sn,hydrate:Un,createApp:createAppAPI(sn,Un)}}function toggleRecurse({effect:u,update:a},s){u.allowRecurse=a.allowRecurse=s}function traverseStaticChildren(u,a,s=!1){const v=u.children,x=a.children;if(isArray(v)&&isArray(x))for(let M=0;M<v.length;M++){const I=v[M];let B=x[M];B.shapeFlag&1&&!B.dynamicChildren&&((B.patchFlag<=0||B.patchFlag===32)&&(B=x[M]=cloneIfMounted(x[M]),B.el=I.el),s||traverseStaticChildren(I,B)),B.type===Text&&(B.el=I.el)}}function getSequence(u){const a=u.slice(),s=[0];let v,x,M,I,B;const U=u.length;for(v=0;v<U;v++){const j=u[v];if(j!==0){if(x=s[s.length-1],u[x]<j){a[v]=x,s.push(v);continue}for(M=0,I=s.length-1;M<I;)B=M+I>>1,u[s[B]]<j?M=B+1:I=B;j<u[s[M]]&&(M>0&&(a[v]=s[M-1]),s[M]=v)}}for(M=s.length,I=s[M-1];M-- >0;)s[M]=I,I=a[I];return s}const isTeleport=u=>u.__isTeleport,isTeleportDisabled=u=>u&&(u.disabled||u.disabled===""),isTargetSVG=u=>typeof SVGElement<"u"&&u instanceof SVGElement,resolveTarget=(u,a)=>{const s=u&&u.to;return isString(s)?a?a(s):null:s},TeleportImpl={__isTeleport:!0,process(u,a,s,v,x,M,I,B,U,j){const{mc:te,pc:Z,pbc:oe,o:{insert:le,querySelector:se,createText:ve,createComment:ce}}=j,K=isTeleportDisabled(a.props);let{shapeFlag:X,children:W,dynamicChildren:_e}=a;if(u==null){const ge=a.el=ve(""),Ae=a.anchor=ve("");le(ge,s,v),le(Ae,s,v);const ee=a.target=resolveTarget(a.props,se),$=a.targetAnchor=ve("");ee&&(le($,ee),I=I||isTargetSVG(ee));const ae=(Re,pe)=>{X&16&&te(W,Re,pe,x,M,I,B,U)};K?ae(s,Ae):ee&&ae(ee,$)}else{a.el=u.el;const ge=a.anchor=u.anchor,Ae=a.target=u.target,ee=a.targetAnchor=u.targetAnchor,$=isTeleportDisabled(u.props),ae=$?s:Ae,Re=$?ge:ee;if(I=I||isTargetSVG(Ae),_e?(oe(u.dynamicChildren,_e,ae,x,M,I,B),traverseStaticChildren(u,a,!0)):U||Z(u,a,ae,Re,x,M,I,B,!1),K)$||moveTeleport(a,s,ge,j,1);else if((a.props&&a.props.to)!==(u.props&&u.props.to)){const pe=a.target=resolveTarget(a.props,se);pe&&moveTeleport(a,pe,null,j,0)}else $&&moveTeleport(a,Ae,ee,j,1)}updateCssVars(a)},remove(u,a,s,v,{um:x,o:{remove:M}},I){const{shapeFlag:B,children:U,anchor:j,targetAnchor:te,target:Z,props:oe}=u;if(Z&&M(te),(I||!isTeleportDisabled(oe))&&(M(j),B&16))for(let le=0;le<U.length;le++){const se=U[le];x(se,a,s,!0,!!se.dynamicChildren)}},move:moveTeleport,hydrate:hydrateTeleport};function moveTeleport(u,a,s,{o:{insert:v},m:x},M=2){M===0&&v(u.targetAnchor,a,s);const{el:I,anchor:B,shapeFlag:U,children:j,props:te}=u,Z=M===2;if(Z&&v(I,a,s),(!Z||isTeleportDisabled(te))&&U&16)for(let oe=0;oe<j.length;oe++)x(j[oe],a,s,2);Z&&v(B,a,s)}function hydrateTeleport(u,a,s,v,x,M,{o:{nextSibling:I,parentNode:B,querySelector:U}},j){const te=a.target=resolveTarget(a.props,U);if(te){const Z=te._lpa||te.firstChild;if(a.shapeFlag&16)if(isTeleportDisabled(a.props))a.anchor=j(I(u),a,B(u),s,v,x,M),a.targetAnchor=Z;else{a.anchor=I(u);let oe=Z;for(;oe;)if(oe=I(oe),oe&&oe.nodeType===8&&oe.data==="teleport anchor"){a.targetAnchor=oe,te._lpa=a.targetAnchor&&I(a.targetAnchor);break}j(Z,a,te,s,v,x,M)}updateCssVars(a)}return a.anchor&&I(a.anchor)}const Teleport=TeleportImpl;function updateCssVars(u){const a=u.ctx;if(a&&a.ut){let s=u.children[0].el;for(;s!==u.targetAnchor;)s.nodeType===1&&s.setAttribute("data-v-owner",a.uid),s=s.nextSibling;a.ut()}}const Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock(u=!1){blockStack.push(currentBlock=u?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(u){isBlockTreeEnabled+=u}function setupBlock(u){return u.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(u),u}function createElementBlock(u,a,s,v,x,M){return setupBlock(createBaseVNode(u,a,s,v,x,M,!0))}function createBlock(u,a,s,v,x){return setupBlock(createVNode(u,a,s,v,x,!0))}function isVNode(u){return u?u.__v_isVNode===!0:!1}function isSameVNodeType(u,a){return u.type===a.type&&u.key===a.key}function transformVNodeArgs(u){}const InternalObjectKey="__vInternal",normalizeKey=({key:u})=>u??null,normalizeRef=({ref:u,ref_key:a,ref_for:s})=>(typeof u=="number"&&(u=""+u),u!=null?isString(u)||isRef(u)||isFunction(u)?{i:currentRenderingInstance,r:u,k:a,f:!!s}:u:null);function createBaseVNode(u,a=null,s=null,v=0,x=null,M=u===Fragment?0:1,I=!1,B=!1){const U={__v_isVNode:!0,__v_skip:!0,type:u,props:a,key:a&&normalizeKey(a),ref:a&&normalizeRef(a),scopeId:currentScopeId,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:M,patchFlag:v,dynamicProps:x,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return B?(normalizeChildren(U,s),M&128&&u.normalize(U)):s&&(U.shapeFlag|=isString(s)?8:16),isBlockTreeEnabled>0&&!I&&currentBlock&&(U.patchFlag>0||M&6)&&U.patchFlag!==32&&currentBlock.push(U),U}const createVNode=_createVNode;function _createVNode(u,a=null,s=null,v=0,x=null,M=!1){if((!u||u===NULL_DYNAMIC_COMPONENT)&&(u=Comment),isVNode(u)){const B=cloneVNode(u,a,!0);return s&&normalizeChildren(B,s),isBlockTreeEnabled>0&&!M&&currentBlock&&(B.shapeFlag&6?currentBlock[currentBlock.indexOf(u)]=B:currentBlock.push(B)),B.patchFlag|=-2,B}if(isClassComponent(u)&&(u=u.__vccOpts),a){a=guardReactiveProps(a);let{class:B,style:U}=a;B&&!isString(B)&&(a.class=normalizeClass(B)),isObject(U)&&(isProxy(U)&&!isArray(U)&&(U=extend({},U)),a.style=normalizeStyle(U))}const I=isString(u)?1:isSuspense(u)?128:isTeleport(u)?64:isObject(u)?4:isFunction(u)?2:0;return createBaseVNode(u,a,s,v,x,I,M,!0)}function guardReactiveProps(u){return u?isProxy(u)||InternalObjectKey in u?extend({},u):u:null}function cloneVNode(u,a,s=!1){const{props:v,ref:x,patchFlag:M,children:I}=u,B=a?mergeProps(v||{},a):v;return{__v_isVNode:!0,__v_skip:!0,type:u.type,props:B,key:B&&normalizeKey(B),ref:a&&a.ref?s&&x?isArray(x)?x.concat(normalizeRef(a)):[x,normalizeRef(a)]:normalizeRef(a):x,scopeId:u.scopeId,slotScopeIds:u.slotScopeIds,children:I,target:u.target,targetAnchor:u.targetAnchor,staticCount:u.staticCount,shapeFlag:u.shapeFlag,patchFlag:a&&u.type!==Fragment?M===-1?16:M|16:M,dynamicProps:u.dynamicProps,dynamicChildren:u.dynamicChildren,appContext:u.appContext,dirs:u.dirs,transition:u.transition,component:u.component,suspense:u.suspense,ssContent:u.ssContent&&cloneVNode(u.ssContent),ssFallback:u.ssFallback&&cloneVNode(u.ssFallback),el:u.el,anchor:u.anchor,ctx:u.ctx,ce:u.ce}}function createTextVNode(u=" ",a=0){return createVNode(Text,null,u,a)}function createStaticVNode(u,a){const s=createVNode(Static,null,u);return s.staticCount=a,s}function createCommentVNode(u="",a=!1){return a?(openBlock(),createBlock(Comment,null,u)):createVNode(Comment,null,u)}function normalizeVNode(u){return u==null||typeof u=="boolean"?createVNode(Comment):isArray(u)?createVNode(Fragment,null,u.slice()):typeof u=="object"?cloneIfMounted(u):createVNode(Text,null,String(u))}function cloneIfMounted(u){return u.el===null&&u.patchFlag!==-1||u.memo?u:cloneVNode(u)}function normalizeChildren(u,a){let s=0;const{shapeFlag:v}=u;if(a==null)a=null;else if(isArray(a))s=16;else if(typeof a=="object")if(v&65){const x=a.default;x&&(x._c&&(x._d=!1),normalizeChildren(u,x()),x._c&&(x._d=!0));return}else{s=32;const x=a._;!x&&!(InternalObjectKey in a)?a._ctx=currentRenderingInstance:x===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?a._=1:(a._=2,u.patchFlag|=1024))}else isFunction(a)?(a={default:a,_ctx:currentRenderingInstance},s=32):(a=String(a),v&64?(s=16,a=[createTextVNode(a)]):s=8);u.children=a,u.shapeFlag|=s}function mergeProps(...u){const a={};for(let s=0;s<u.length;s++){const v=u[s];for(const x in v)if(x==="class")a.class!==v.class&&(a.class=normalizeClass([a.class,v.class]));else if(x==="style")a.style=normalizeStyle([a.style,v.style]);else if(isOn(x)){const M=a[x],I=v[x];I&&M!==I&&!(isArray(M)&&M.includes(I))&&(a[x]=M?[].concat(M,I):I)}else x!==""&&(a[x]=v[x])}return a}function invokeVNodeHook(u,a,s,v=null){callWithAsyncErrorHandling(u,a,7,[s,v])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(u,a,s){const v=u.type,x=(a?a.appContext:u.appContext)||emptyAppContext,M={uid:uid++,vnode:u,type:v,parent:a,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:a?a.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(v,x),emitsOptions:normalizeEmitsOptions(v,x),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:v.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return M.ctx={_:M},M.root=a?a.root:M,M.emit=emit.bind(null,M),u.ce&&u.ce(M),M}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,globalCurrentInstanceSetters,settersKey="__VUE_INSTANCE_SETTERS__";(globalCurrentInstanceSetters=getGlobalThis()[settersKey])||(globalCurrentInstanceSetters=getGlobalThis()[settersKey]=[]),globalCurrentInstanceSetters.push(u=>currentInstance=u),internalSetCurrentInstance=u=>{globalCurrentInstanceSetters.length>1?globalCurrentInstanceSetters.forEach(a=>a(u)):globalCurrentInstanceSetters[0](u)};const setCurrentInstance=u=>{internalSetCurrentInstance(u),u.scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(u){return u.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(u,a=!1){isInSSRComponentSetup=a;const{props:s,children:v}=u.vnode,x=isStatefulComponent(u);initProps(u,s,x,a),initSlots(u,v);const M=x?setupStatefulComponent(u,a):void 0;return isInSSRComponentSetup=!1,M}function setupStatefulComponent(u,a){const s=u.type;u.accessCache=Object.create(null),u.proxy=markRaw(new Proxy(u.ctx,PublicInstanceProxyHandlers));const{setup:v}=s;if(v){const x=u.setupContext=v.length>1?createSetupContext(u):null;setCurrentInstance(u),pauseTracking();const M=callWithErrorHandling(v,u,0,[u.props,x]);if(resetTracking(),unsetCurrentInstance(),isPromise(M)){if(M.then(unsetCurrentInstance,unsetCurrentInstance),a)return M.then(I=>{handleSetupResult(u,I,a)}).catch(I=>{handleError(I,u,0)});u.asyncDep=M}else handleSetupResult(u,M,a)}else finishComponentSetup(u,a)}function handleSetupResult(u,a,s){isFunction(a)?u.type.__ssrInlineRender?u.ssrRender=a:u.render=a:isObject(a)&&(u.setupState=proxyRefs(a)),finishComponentSetup(u,s)}let compile$1,installWithProxy;function registerRuntimeCompiler(u){compile$1=u,installWithProxy=a=>{a.render._rc&&(a.withProxy=new Proxy(a.ctx,RuntimeCompiledPublicInstanceProxyHandlers))}}const isRuntimeOnly=()=>!compile$1;function finishComponentSetup(u,a,s){const v=u.type;if(!u.render){if(!a&&compile$1&&!v.render){const x=v.template||resolveMergedOptions(u).template;if(x){const{isCustomElement:M,compilerOptions:I}=u.appContext.config,{delimiters:B,compilerOptions:U}=v,j=extend(extend({isCustomElement:M,delimiters:B},I),U);v.render=compile$1(x,j)}}u.render=v.render||NOOP,installWithProxy&&installWithProxy(u)}setCurrentInstance(u),pauseTracking(),applyOptions(u),resetTracking(),unsetCurrentInstance()}function getAttrsProxy(u){return u.attrsProxy||(u.attrsProxy=new Proxy(u.attrs,{get(a,s){return track(u,"get","$attrs"),a[s]}}))}function createSetupContext(u){const a=s=>{u.exposed=s||{}};return{get attrs(){return getAttrsProxy(u)},slots:u.slots,emit:u.emit,expose:a}}function getExposeProxy(u){if(u.exposed)return u.exposeProxy||(u.exposeProxy=new Proxy(proxyRefs(markRaw(u.exposed)),{get(a,s){if(s in a)return a[s];if(s in publicPropertiesMap)return publicPropertiesMap[s](u)},has(a,s){return s in a||s in publicPropertiesMap}}))}function getComponentName(u,a=!0){return isFunction(u)?u.displayName||u.name:u.name||a&&u.__name}function isClassComponent(u){return isFunction(u)&&"__vccOpts"in u}const computed=(u,a)=>computed$1(u,a,isInSSRComponentSetup);function h(u,a,s){const v=arguments.length;return v===2?isObject(a)&&!isArray(a)?isVNode(a)?createVNode(u,null,[a]):createVNode(u,a):createVNode(u,null,a):(v>3?s=Array.prototype.slice.call(arguments,2):v===3&&isVNode(s)&&(s=[s]),createVNode(u,a,s))}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function initCustomFormatter(){}function withMemo(u,a,s,v){const x=s[v];if(x&&isMemoSame(x,u))return x;const M=a();return M.memo=u.slice(),s[v]=M}function isMemoSame(u,a){const s=u.memo;if(s.length!=a.length)return!1;for(let v=0;v<s.length;v++)if(hasChanged(s[v],a[v]))return!1;return isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(u),!0}const version="3.3.4",_ssrUtils={createComponentInstance,setupComponent,renderComponentRoot,setCurrentRenderingInstance,isVNode,normalizeVNode},ssrUtils=_ssrUtils,resolveFilter=null,compatUtils=null,svgNS="http://www.w3.org/2000/svg",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(u,a,s)=>{a.insertBefore(u,s||null)},remove:u=>{const a=u.parentNode;a&&a.removeChild(u)},createElement:(u,a,s,v)=>{const x=a?doc.createElementNS(svgNS,u):doc.createElement(u,s?{is:s}:void 0);return u==="select"&&v&&v.multiple!=null&&x.setAttribute("multiple",v.multiple),x},createText:u=>doc.createTextNode(u),createComment:u=>doc.createComment(u),setText:(u,a)=>{u.nodeValue=a},setElementText:(u,a)=>{u.textContent=a},parentNode:u=>u.parentNode,nextSibling:u=>u.nextSibling,querySelector:u=>doc.querySelector(u),setScopeId(u,a){u.setAttribute(a,"")},insertStaticContent(u,a,s,v,x,M){const I=s?s.previousSibling:a.lastChild;if(x&&(x===M||x.nextSibling))for(;a.insertBefore(x.cloneNode(!0),s),!(x===M||!(x=x.nextSibling)););else{templateContainer.innerHTML=v?`<svg>${u}</svg>`:u;const B=templateContainer.content;if(v){const U=B.firstChild;for(;U.firstChild;)B.appendChild(U.firstChild);B.removeChild(U)}a.insertBefore(B,s)}return[I?I.nextSibling:a.firstChild,s?s.previousSibling:a.lastChild]}};function patchClass(u,a,s){const v=u._vtc;v&&(a=(a?[a,...v]:[...v]).join(" ")),a==null?u.removeAttribute("class"):s?u.setAttribute("class",a):u.className=a}function patchStyle(u,a,s){const v=u.style,x=isString(s);if(s&&!x){if(a&&!isString(a))for(const M in a)s[M]==null&&setStyle(v,M,"");for(const M in s)setStyle(v,M,s[M])}else{const M=v.display;x?a!==s&&(v.cssText=s):a&&u.removeAttribute("style"),"_vod"in u&&(v.display=M)}}const importantRE=/\s*!important$/;function setStyle(u,a,s){if(isArray(s))s.forEach(v=>setStyle(u,a,v));else if(s==null&&(s=""),a.startsWith("--"))u.setProperty(a,s);else{const v=autoPrefix(u,a);importantRE.test(s)?u.setProperty(hyphenate(v),s.replace(importantRE,""),"important"):u[v]=s}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(u,a){const s=prefixCache[a];if(s)return s;let v=camelize(a);if(v!=="filter"&&v in u)return prefixCache[a]=v;v=capitalize(v);for(let x=0;x<prefixes.length;x++){const M=prefixes[x]+v;if(M in u)return prefixCache[a]=M}return a}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(u,a,s,v,x){if(v&&a.startsWith("xlink:"))s==null?u.removeAttributeNS(xlinkNS,a.slice(6,a.length)):u.setAttributeNS(xlinkNS,a,s);else{const M=isSpecialBooleanAttr(a);s==null||M&&!includeBooleanAttr(s)?u.removeAttribute(a):u.setAttribute(a,M?"":s)}}function patchDOMProp(u,a,s,v,x,M,I){if(a==="innerHTML"||a==="textContent"){v&&I(v,x,M),u[a]=s??"";return}const B=u.tagName;if(a==="value"&&B!=="PROGRESS"&&!B.includes("-")){u._value=s;const j=B==="OPTION"?u.getAttribute("value"):u.value,te=s??"";j!==te&&(u.value=te),s==null&&u.removeAttribute(a);return}let U=!1;if(s===""||s==null){const j=typeof u[a];j==="boolean"?s=includeBooleanAttr(s):s==null&&j==="string"?(s="",U=!0):j==="number"&&(s=0,U=!0)}try{u[a]=s}catch{}U&&u.removeAttribute(a)}function addEventListener(u,a,s,v){u.addEventListener(a,s,v)}function removeEventListener(u,a,s,v){u.removeEventListener(a,s,v)}function patchEvent(u,a,s,v,x=null){const M=u._vei||(u._vei={}),I=M[a];if(v&&I)I.value=v;else{const[B,U]=parseName(a);if(v){const j=M[a]=createInvoker(v,x);addEventListener(u,B,j,U)}else I&&(removeEventListener(u,B,I,U),M[a]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(u){let a;if(optionsModifierRE.test(u)){a={};let v;for(;v=u.match(optionsModifierRE);)u=u.slice(0,u.length-v[0].length),a[v[0].toLowerCase()]=!0}return[u[2]===":"?u.slice(3):hyphenate(u.slice(2)),a]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(u,a){const s=v=>{if(!v._vts)v._vts=Date.now();else if(v._vts<=s.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(v,s.value),a,5,[v])};return s.value=u,s.attached=getNow(),s}function patchStopImmediatePropagation(u,a){if(isArray(a)){const s=u.stopImmediatePropagation;return u.stopImmediatePropagation=()=>{s.call(u),u._stopped=!0},a.map(v=>x=>!x._stopped&&v&&v(x))}else return a}const nativeOnRE=/^on[a-z]/,patchProp=(u,a,s,v,x=!1,M,I,B,U)=>{a==="class"?patchClass(u,v,x):a==="style"?patchStyle(u,s,v):isOn(a)?isModelListener(a)||patchEvent(u,a,s,v,I):(a[0]==="."?(a=a.slice(1),!0):a[0]==="^"?(a=a.slice(1),!1):shouldSetAsProp(u,a,v,x))?patchDOMProp(u,a,v,M,I,B,U):(a==="true-value"?u._trueValue=v:a==="false-value"&&(u._falseValue=v),patchAttr(u,a,v,x))};function shouldSetAsProp(u,a,s,v){return v?!!(a==="innerHTML"||a==="textContent"||a in u&&nativeOnRE.test(a)&&isFunction(s)):a==="spellcheck"||a==="draggable"||a==="translate"||a==="form"||a==="list"&&u.tagName==="INPUT"||a==="type"&&u.tagName==="TEXTAREA"||nativeOnRE.test(a)&&isString(s)?!1:a in u}function defineCustomElement(u,a){const s=defineComponent(u);class v extends VueElement{constructor(M){super(s,M,a)}}return v.def=s,v}const defineSSRCustomElement=u=>defineCustomElement(u,hydrate),BaseClass=typeof HTMLElement<"u"?HTMLElement:class{};class VueElement extends BaseClass{constructor(a,s={},v){super(),this._def=a,this._props=s,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&v?v(this._createVNode(),this.shadowRoot):(this.attachShadow({mode:"open"}),this._def.__asyncLoader||this._resolveProps(this._def))}connectedCallback(){this._connected=!0,this._instance||(this._resolved?this._update():this._resolveDef())}disconnectedCallback(){this._connected=!1,nextTick(()=>{this._connected||(render(null,this.shadowRoot),this._instance=null)})}_resolveDef(){this._resolved=!0;for(let v=0;v<this.attributes.length;v++)this._setAttr(this.attributes[v].name);new MutationObserver(v=>{for(const x of v)this._setAttr(x.attributeName)}).observe(this,{attributes:!0});const a=(v,x=!1)=>{const{props:M,styles:I}=v;let B;if(M&&!isArray(M))for(const U in M){const j=M[U];(j===Number||j&&j.type===Number)&&(U in this._props&&(this._props[U]=toNumber(this._props[U])),(B||(B=Object.create(null)))[camelize(U)]=!0)}this._numberProps=B,x&&this._resolveProps(v),this._applyStyles(I),this._update()},s=this._def.__asyncLoader;s?s().then(v=>a(v,!0)):a(this._def)}_resolveProps(a){const{props:s}=a,v=isArray(s)?s:Object.keys(s||{});for(const x of Object.keys(this))x[0]!=="_"&&v.includes(x)&&this._setProp(x,this[x],!0,!1);for(const x of v.map(camelize))Object.defineProperty(this,x,{get(){return this._getProp(x)},set(M){this._setProp(x,M)}})}_setAttr(a){let s=this.getAttribute(a);const v=camelize(a);this._numberProps&&this._numberProps[v]&&(s=toNumber(s)),this._setProp(v,s,!1)}_getProp(a){return this._props[a]}_setProp(a,s,v=!0,x=!0){s!==this._props[a]&&(this._props[a]=s,x&&this._instance&&this._update(),v&&(s===!0?this.setAttribute(hyphenate(a),""):typeof s=="string"||typeof s=="number"?this.setAttribute(hyphenate(a),s+""):s||this.removeAttribute(hyphenate(a))))}_update(){render(this._createVNode(),this.shadowRoot)}_createVNode(){const a=createVNode(this._def,extend({},this._props));return this._instance||(a.ce=s=>{this._instance=s,s.isCE=!0;const v=(M,I)=>{this.dispatchEvent(new CustomEvent(M,{detail:I}))};s.emit=(M,...I)=>{v(M,I),hyphenate(M)!==M&&v(hyphenate(M),I)};let x=this;for(;x=x&&(x.parentNode||x.host);)if(x instanceof VueElement){s.parent=x._instance,s.provides=x._instance.provides;break}}),a}_applyStyles(a){a&&a.forEach(s=>{const v=document.createElement("style");v.textContent=s,this.shadowRoot.appendChild(v)})}}function useCssModule(u="$style"){{const a=getCurrentInstance();if(!a)return EMPTY_OBJ;const s=a.type.__cssModules;if(!s)return EMPTY_OBJ;const v=s[u];return v||EMPTY_OBJ}}function useCssVars(u){const a=getCurrentInstance();if(!a)return;const s=a.ut=(x=u(a.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${a.uid}"]`)).forEach(M=>setVarsOnNode(M,x))},v=()=>{const x=u(a.proxy);setVarsOnVNode(a.subTree,x),s(x)};watchPostEffect(v),onMounted(()=>{const x=new MutationObserver(v);x.observe(a.subTree.el.parentNode,{childList:!0}),onUnmounted(()=>x.disconnect())})}function setVarsOnVNode(u,a){if(u.shapeFlag&128){const s=u.suspense;u=s.activeBranch,s.pendingBranch&&!s.isHydrating&&s.effects.push(()=>{setVarsOnVNode(s.activeBranch,a)})}for(;u.component;)u=u.component.subTree;if(u.shapeFlag&1&&u.el)setVarsOnNode(u.el,a);else if(u.type===Fragment)u.children.forEach(s=>setVarsOnVNode(s,a));else if(u.type===Static){let{el:s,anchor:v}=u;for(;s&&(setVarsOnNode(s,a),s!==v);)s=s.nextSibling}}function setVarsOnNode(u,a){if(u.nodeType===1){const s=u.style;for(const v in a)s.setProperty(`--${v}`,a[v])}}const TRANSITION$1="transition",ANIMATION="animation",Transition=(u,{slots:a})=>h(BaseTransition,resolveTransitionProps(u),a);Transition.displayName="Transition";const DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},TransitionPropsValidators=Transition.props=extend({},BaseTransitionPropsValidators,DOMTransitionPropsValidators),callHook=(u,a=[])=>{isArray(u)?u.forEach(s=>s(...a)):u&&u(...a)},hasExplicitCallback=u=>u?isArray(u)?u.some(a=>a.length>1):u.length>1:!1;function resolveTransitionProps(u){const a={};for(const he in u)he in DOMTransitionPropsValidators||(a[he]=u[he]);if(u.css===!1)return a;const{name:s="v",type:v,duration:x,enterFromClass:M=`${s}-enter-from`,enterActiveClass:I=`${s}-enter-active`,enterToClass:B=`${s}-enter-to`,appearFromClass:U=M,appearActiveClass:j=I,appearToClass:te=B,leaveFromClass:Z=`${s}-leave-from`,leaveActiveClass:oe=`${s}-leave-active`,leaveToClass:le=`${s}-leave-to`}=u,se=normalizeDuration(x),ve=se&&se[0],ce=se&&se[1],{onBeforeEnter:K,onEnter:X,onEnterCancelled:W,onLeave:_e,onLeaveCancelled:ge,onBeforeAppear:Ae=K,onAppear:ee=X,onAppearCancelled:$=W}=a,ae=(he,we,Ce)=>{removeTransitionClass(he,we?te:B),removeTransitionClass(he,we?j:I),Ce&&Ce()},Re=(he,we)=>{he._isLeaving=!1,removeTransitionClass(he,Z),removeTransitionClass(he,le),removeTransitionClass(he,oe),we&&we()},pe=he=>(we,Ce)=>{const Ne=he?ee:X,Ze=()=>ae(we,he,Ce);callHook(Ne,[we,Ze]),nextFrame(()=>{removeTransitionClass(we,he?U:M),addTransitionClass(we,he?te:B),hasExplicitCallback(Ne)||whenTransitionEnds(we,v,ve,Ze)})};return extend(a,{onBeforeEnter(he){callHook(K,[he]),addTransitionClass(he,M),addTransitionClass(he,I)},onBeforeAppear(he){callHook(Ae,[he]),addTransitionClass(he,U),addTransitionClass(he,j)},onEnter:pe(!1),onAppear:pe(!0),onLeave(he,we){he._isLeaving=!0;const Ce=()=>Re(he,we);addTransitionClass(he,Z),forceReflow(),addTransitionClass(he,oe),nextFrame(()=>{he._isLeaving&&(removeTransitionClass(he,Z),addTransitionClass(he,le),hasExplicitCallback(_e)||whenTransitionEnds(he,v,ce,Ce))}),callHook(_e,[he,Ce])},onEnterCancelled(he){ae(he,!1),callHook(W,[he])},onAppearCancelled(he){ae(he,!0),callHook($,[he])},onLeaveCancelled(he){Re(he),callHook(ge,[he])}})}function normalizeDuration(u){if(u==null)return null;if(isObject(u))return[NumberOf(u.enter),NumberOf(u.leave)];{const a=NumberOf(u);return[a,a]}}function NumberOf(u){return toNumber(u)}function addTransitionClass(u,a){a.split(/\s+/).forEach(s=>s&&u.classList.add(s)),(u._vtc||(u._vtc=new Set)).add(a)}function removeTransitionClass(u,a){a.split(/\s+/).forEach(v=>v&&u.classList.remove(v));const{_vtc:s}=u;s&&(s.delete(a),s.size||(u._vtc=void 0))}function nextFrame(u){requestAnimationFrame(()=>{requestAnimationFrame(u)})}let endId=0;function whenTransitionEnds(u,a,s,v){const x=u._endId=++endId,M=()=>{x===u._endId&&v()};if(s)return setTimeout(M,s);const{type:I,timeout:B,propCount:U}=getTransitionInfo(u,a);if(!I)return v();const j=I+"end";let te=0;const Z=()=>{u.removeEventListener(j,oe),M()},oe=le=>{le.target===u&&++te>=U&&Z()};setTimeout(()=>{te<U&&Z()},B+1),u.addEventListener(j,oe)}function getTransitionInfo(u,a){const s=window.getComputedStyle(u),v=se=>(s[se]||"").split(", "),x=v(`${TRANSITION$1}Delay`),M=v(`${TRANSITION$1}Duration`),I=getTimeout(x,M),B=v(`${ANIMATION}Delay`),U=v(`${ANIMATION}Duration`),j=getTimeout(B,U);let te=null,Z=0,oe=0;a===TRANSITION$1?I>0&&(te=TRANSITION$1,Z=I,oe=M.length):a===ANIMATION?j>0&&(te=ANIMATION,Z=j,oe=U.length):(Z=Math.max(I,j),te=Z>0?I>j?TRANSITION$1:ANIMATION:null,oe=te?te===TRANSITION$1?M.length:U.length:0);const le=te===TRANSITION$1&&/\b(transform|all)(,|$)/.test(v(`${TRANSITION$1}Property`).toString());return{type:te,timeout:Z,propCount:oe,hasTransform:le}}function getTimeout(u,a){for(;u.length<a.length;)u=u.concat(u);return Math.max(...a.map((s,v)=>toMs(s)+toMs(u[v])))}function toMs(u){return Number(u.slice(0,-1).replace(",","."))*1e3}function forceReflow(){return document.body.offsetHeight}const positionMap=new WeakMap,newPositionMap=new WeakMap,TransitionGroupImpl={name:"TransitionGroup",props:extend({},TransitionPropsValidators,{tag:String,moveClass:String}),setup(u,{slots:a}){const s=getCurrentInstance(),v=useTransitionState();let x,M;return onUpdated(()=>{if(!x.length)return;const I=u.moveClass||`${u.name||"v"}-move`;if(!hasCSSTransform(x[0].el,s.vnode.el,I))return;x.forEach(callPendingCbs),x.forEach(recordPosition);const B=x.filter(applyTranslation);forceReflow(),B.forEach(U=>{const j=U.el,te=j.style;addTransitionClass(j,I),te.transform=te.webkitTransform=te.transitionDuration="";const Z=j._moveCb=oe=>{oe&&oe.target!==j||(!oe||/transform$/.test(oe.propertyName))&&(j.removeEventListener("transitionend",Z),j._moveCb=null,removeTransitionClass(j,I))};j.addEventListener("transitionend",Z)})}),()=>{const I=toRaw(u),B=resolveTransitionProps(I);let U=I.tag||Fragment;x=M,M=a.default?getTransitionRawChildren(a.default()):[];for(let j=0;j<M.length;j++){const te=M[j];te.key!=null&&setTransitionHooks(te,resolveTransitionHooks(te,B,v,s))}if(x)for(let j=0;j<x.length;j++){const te=x[j];setTransitionHooks(te,resolveTransitionHooks(te,B,v,s)),positionMap.set(te,te.el.getBoundingClientRect())}return createVNode(U,null,M)}}},removeMode=u=>delete u.mode;TransitionGroupImpl.props;const TransitionGroup=TransitionGroupImpl;function callPendingCbs(u){const a=u.el;a._moveCb&&a._moveCb(),a._enterCb&&a._enterCb()}function recordPosition(u){newPositionMap.set(u,u.el.getBoundingClientRect())}function applyTranslation(u){const a=positionMap.get(u),s=newPositionMap.get(u),v=a.left-s.left,x=a.top-s.top;if(v||x){const M=u.el.style;return M.transform=M.webkitTransform=`translate(${v}px,${x}px)`,M.transitionDuration="0s",u}}function hasCSSTransform(u,a,s){const v=u.cloneNode();u._vtc&&u._vtc.forEach(I=>{I.split(/\s+/).forEach(B=>B&&v.classList.remove(B))}),s.split(/\s+/).forEach(I=>I&&v.classList.add(I)),v.style.display="none";const x=a.nodeType===1?a:a.parentNode;x.appendChild(v);const{hasTransform:M}=getTransitionInfo(v);return x.removeChild(v),M}const getModelAssigner=u=>{const a=u.props["onUpdate:modelValue"]||!1;return isArray(a)?s=>invokeArrayFns(a,s):a};function onCompositionStart(u){u.target.composing=!0}function onCompositionEnd(u){const a=u.target;a.composing&&(a.composing=!1,a.dispatchEvent(new Event("input")))}const vModelText={created(u,{modifiers:{lazy:a,trim:s,number:v}},x){u._assign=getModelAssigner(x);const M=v||x.props&&x.props.type==="number";addEventListener(u,a?"change":"input",I=>{if(I.target.composing)return;let B=u.value;s&&(B=B.trim()),M&&(B=looseToNumber(B)),u._assign(B)}),s&&addEventListener(u,"change",()=>{u.value=u.value.trim()}),a||(addEventListener(u,"compositionstart",onCompositionStart),addEventListener(u,"compositionend",onCompositionEnd),addEventListener(u,"change",onCompositionEnd))},mounted(u,{value:a}){u.value=a??""},beforeUpdate(u,{value:a,modifiers:{lazy:s,trim:v,number:x}},M){if(u._assign=getModelAssigner(M),u.composing||document.activeElement===u&&u.type!=="range"&&(s||v&&u.value.trim()===a||(x||u.type==="number")&&looseToNumber(u.value)===a))return;const I=a??"";u.value!==I&&(u.value=I)}},vModelCheckbox={deep:!0,created(u,a,s){u._assign=getModelAssigner(s),addEventListener(u,"change",()=>{const v=u._modelValue,x=getValue(u),M=u.checked,I=u._assign;if(isArray(v)){const B=looseIndexOf(v,x),U=B!==-1;if(M&&!U)I(v.concat(x));else if(!M&&U){const j=[...v];j.splice(B,1),I(j)}}else if(isSet(v)){const B=new Set(v);M?B.add(x):B.delete(x),I(B)}else I(getCheckboxValue(u,M))})},mounted:setChecked,beforeUpdate(u,a,s){u._assign=getModelAssigner(s),setChecked(u,a,s)}};function setChecked(u,{value:a,oldValue:s},v){u._modelValue=a,isArray(a)?u.checked=looseIndexOf(a,v.props.value)>-1:isSet(a)?u.checked=a.has(v.props.value):a!==s&&(u.checked=looseEqual(a,getCheckboxValue(u,!0)))}const vModelRadio={created(u,{value:a},s){u.checked=looseEqual(a,s.props.value),u._assign=getModelAssigner(s),addEventListener(u,"change",()=>{u._assign(getValue(u))})},beforeUpdate(u,{value:a,oldValue:s},v){u._assign=getModelAssigner(v),a!==s&&(u.checked=looseEqual(a,v.props.value))}},vModelSelect={deep:!0,created(u,{value:a,modifiers:{number:s}},v){const x=isSet(a);addEventListener(u,"change",()=>{const M=Array.prototype.filter.call(u.options,I=>I.selected).map(I=>s?looseToNumber(getValue(I)):getValue(I));u._assign(u.multiple?x?new Set(M):M:M[0])}),u._assign=getModelAssigner(v)},mounted(u,{value:a}){setSelected(u,a)},beforeUpdate(u,a,s){u._assign=getModelAssigner(s)},updated(u,{value:a}){setSelected(u,a)}};function setSelected(u,a){const s=u.multiple;if(!(s&&!isArray(a)&&!isSet(a))){for(let v=0,x=u.options.length;v<x;v++){const M=u.options[v],I=getValue(M);if(s)isArray(a)?M.selected=looseIndexOf(a,I)>-1:M.selected=a.has(I);else if(looseEqual(getValue(M),a)){u.selectedIndex!==v&&(u.selectedIndex=v);return}}!s&&u.selectedIndex!==-1&&(u.selectedIndex=-1)}}function getValue(u){return"_value"in u?u._value:u.value}function getCheckboxValue(u,a){const s=a?"_trueValue":"_falseValue";return s in u?u[s]:a}const vModelDynamic={created(u,a,s){callModelHook(u,a,s,null,"created")},mounted(u,a,s){callModelHook(u,a,s,null,"mounted")},beforeUpdate(u,a,s,v){callModelHook(u,a,s,v,"beforeUpdate")},updated(u,a,s,v){callModelHook(u,a,s,v,"updated")}};function resolveDynamicModel(u,a){switch(u){case"SELECT":return vModelSelect;case"TEXTAREA":return vModelText;default:switch(a){case"checkbox":return vModelCheckbox;case"radio":return vModelRadio;default:return vModelText}}}function callModelHook(u,a,s,v,x){const I=resolveDynamicModel(u.tagName,s.props&&s.props.type)[x];I&&I(u,a,s,v)}function initVModelForSSR(){vModelText.getSSRProps=({value:u})=>({value:u}),vModelRadio.getSSRProps=({value:u},a)=>{if(a.props&&looseEqual(a.props.value,u))return{checked:!0}},vModelCheckbox.getSSRProps=({value:u},a)=>{if(isArray(u)){if(a.props&&looseIndexOf(u,a.props.value)>-1)return{checked:!0}}else if(isSet(u)){if(a.props&&u.has(a.props.value))return{checked:!0}}else if(u)return{checked:!0}},vModelDynamic.getSSRProps=(u,a)=>{if(typeof a.type!="string")return;const s=resolveDynamicModel(a.type.toUpperCase(),a.props&&a.props.type);if(s.getSSRProps)return s.getSSRProps(u,a)}}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:u=>u.stopPropagation(),prevent:u=>u.preventDefault(),self:u=>u.target!==u.currentTarget,ctrl:u=>!u.ctrlKey,shift:u=>!u.shiftKey,alt:u=>!u.altKey,meta:u=>!u.metaKey,left:u=>"button"in u&&u.button!==0,middle:u=>"button"in u&&u.button!==1,right:u=>"button"in u&&u.button!==2,exact:(u,a)=>systemModifiers.some(s=>u[`${s}Key`]&&!a.includes(s))},withModifiers=(u,a)=>(s,...v)=>{for(let x=0;x<a.length;x++){const M=modifierGuards[a[x]];if(M&&M(s,a))return}return u(s,...v)},keyNames={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},withKeys=(u,a)=>s=>{if(!("key"in s))return;const v=hyphenate(s.key);if(a.some(x=>x===v||keyNames[x]===v))return u(s)},vShow={beforeMount(u,{value:a},{transition:s}){u._vod=u.style.display==="none"?"":u.style.display,s&&a?s.beforeEnter(u):setDisplay(u,a)},mounted(u,{value:a},{transition:s}){s&&a&&s.enter(u)},updated(u,{value:a,oldValue:s},{transition:v}){!a!=!s&&(v?a?(v.beforeEnter(u),setDisplay(u,!0),v.enter(u)):v.leave(u,()=>{setDisplay(u,!1)}):setDisplay(u,a))},beforeUnmount(u,{value:a}){setDisplay(u,a)}};function setDisplay(u,a){u.style.display=a?u._vod:"none"}function initVShowForSSR(){vShow.getSSRProps=({value:u})=>{if(!u)return{style:{display:"none"}}}}const rendererOptions=extend({patchProp},nodeOps);let renderer,enabledHydration=!1;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}function ensureHydrationRenderer(){return renderer=enabledHydration?renderer:createHydrationRenderer(rendererOptions),enabledHydration=!0,renderer}const render=(...u)=>{ensureRenderer().render(...u)},hydrate=(...u)=>{ensureHydrationRenderer().hydrate(...u)},createApp=(...u)=>{const a=ensureRenderer().createApp(...u),{mount:s}=a;return a.mount=v=>{const x=normalizeContainer(v);if(!x)return;const M=a._component;!isFunction(M)&&!M.render&&!M.template&&(M.template=x.innerHTML),x.innerHTML="";const I=s(x,!1,x instanceof SVGElement);return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),I},a},createSSRApp=(...u)=>{const a=ensureHydrationRenderer().createApp(...u),{mount:s}=a;return a.mount=v=>{const x=normalizeContainer(v);if(x)return s(x,!0,x instanceof SVGElement)},a};function normalizeContainer(u){return isString(u)?document.querySelector(u):u}let ssrDirectiveInitialized=!1;const initDirectivesForSSR=()=>{ssrDirectiveInitialized||(ssrDirectiveInitialized=!0,initVModelForSSR(),initVShowForSSR())},runtimeDom=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition,BaseTransitionPropsValidators,Comment,EffectScope,Fragment,KeepAlive,ReactiveEffect,Static,Suspense,Teleport,Text,Transition,TransitionGroup,VueElement,assertNumber,callWithAsyncErrorHandling,callWithErrorHandling,camelize,capitalize,cloneVNode,compatUtils,computed,createApp,createBlock,createCommentVNode,createElementBlock,createElementVNode:createBaseVNode,createHydrationRenderer,createPropsRestProxy,createRenderer,createSSRApp,createSlots,createStaticVNode,createTextVNode,createVNode,customRef,defineAsyncComponent,defineComponent,defineCustomElement,defineEmits,defineExpose,defineModel,defineOptions,defineProps,defineSSRCustomElement,defineSlots,get devtools(){return devtools},effect,effectScope,getCurrentInstance,getCurrentScope,getTransitionRawChildren,guardReactiveProps,h,handleError,hasInjectionContext,hydrate,initCustomFormatter,initDirectivesForSSR,inject,isMemoSame,isProxy,isReactive,isReadonly,isRef,isRuntimeOnly,isShallow,isVNode,markRaw,mergeDefaults,mergeModels,mergeProps,nextTick,normalizeClass,normalizeProps,normalizeStyle,onActivated,onBeforeMount,onBeforeUnmount,onBeforeUpdate,onDeactivated,onErrorCaptured,onMounted,onRenderTracked,onRenderTriggered,onScopeDispose,onServerPrefetch,onUnmounted,onUpdated,openBlock,popScopeId,provide,proxyRefs,pushScopeId,queuePostFlushCb,reactive,readonly,ref,registerRuntimeCompiler,render,renderList,renderSlot,resolveComponent,resolveDirective,resolveDynamicComponent,resolveFilter,resolveTransitionHooks,setBlockTracking,setDevtoolsHook,setTransitionHooks,shallowReactive,shallowReadonly,shallowRef,ssrContextKey,ssrUtils,stop,toDisplayString,toHandlerKey,toHandlers,toRaw,toRef,toRefs,toValue,transformVNodeArgs,triggerRef,unref,useAttrs,useCssModule,useCssVars,useModel,useSSRContext,useSlots,useTransitionState,vModelCheckbox,vModelDynamic,vModelRadio,vModelSelect,vModelText,vShow,version,warn,watch,watchEffect,watchPostEffect,watchSyncEffect,withAsyncContext,withCtx,withDefaults,withDirectives,withKeys,withMemo,withModifiers,withScopeId},Symbol.toStringTag,{value:"Module"})),initMainApp=function(){const u=createApp({props:[]},{});return u.component("homebgscene",{props:[],data(){return{}},created(){},mounted(){new Slider},methods:{},template:`
            <nav id="navleft" class="nav js-nav">
                <ul class="slider-ul">
                <li class="slider-li">
                <a class="sliderA is-active" href="#"><span class="navSpan">Home</span></a>
                </li>
                <li class="slider-li">
                    <a class="sliderA" href="/ShopKart/collections.html"><span class="navSpan">Collections</span></a>
                </li>
                <li class="slider-li">
                        <a class="sliderA" href="#"><span class="navSpan">Contact Us</span></a>
                </li>
                </ul>
            </nav>
            <figure class="logo">
                <img src="./images/Diesel_logo.svg">
            </figure>
            <nav id="navright" class="nav">
                <ul class="slider-ul">
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Account</span>
                    </a>
                    </li>
                    <li class="slider-li">
                    <a class="sliderA" href="#">
                        <span>Cart</span>
                        <div class="cart-total">0</div>
                    </a>
                    </li>
                </ul>
            </nav>
            <div class="slider js-slider">
                <div class="slider__inner js-slider__inner"></div>
  
                <div class="slide js-slide">
                    <div class="slide__content">
                    <figure class="slide__img js-slide__img">
                        <img src="./images/p1.jpg">
                    </figure>
                    <figure class="slide__img js-slide__img">
                        <img src="./images/p2.jpg">
                    </figure>
                </div>
    
                <div class="slider__text js-slider__text">
                    <div class="slider__text-line js-slider__text-line"><div><span style="color:#82a882">Green</span> is</div></div>
                    <div class="slider__text-line js-slider__text-line"><div>timeless. Green is</div></div>
                    <div class="slider__text-line js-slider__text-line"><div>the colour of</div></div>
                    <div class="slider__text-line js-slider__text-line"><div>Eternity.</div></div>
                </div>
    
            </div>
  
  <div class="slide js-slide">
    <div class="slide__content">
      <figure class="slide__img js-slide__img">
        <img src="./images/p3.jpg">
      </figure>
       <figure class="slide__img js-slide__img">
        <img src="./images/p4.jpg">
      </figure>
    </div>
    <div class="slider__text js-slider__text">
        <div class="slider__text-line js-slider__text-line"><div><span style="color:#6799c2">Blue</span> is</div></div>
        <div class="slider__text-line js-slider__text-line"><div>the colour of</div></div>
        <div class="slider__text-line js-slider__text-line"><div>Mindfulness.</div></div>
    </div>
  </div>
  
  <div class="slide js-slide">
    <div class="slide__content">
      <figure class="slide__img js-slide__img">
        <img src="./images/p7.png">
      </figure>
       <figure class="slide__img js-slide__img">
        <img src="./images/p5.jpg">
      </figure>
    </div>
    <div class="slider__text js-slider__text">
    <div class="slider__text-line js-slider__text-line"><div style="color:#00e763">Celebrate</div></div>
    <div class="slider__text-line js-slider__text-line"><div><span style="color:rgb(217, 80, 253)">the</span> <span style="color:rgb(216, 255, 9)">colours</span></div></div>
    <div class="slider__text-line js-slider__text-line"><div><span style="color:rgb(4 ,255, 245)">of</span> <span style="color:#ff0000">World.</span></div></div>
    </div>
  </div>
  <nav class="slider__nav js-slider__nav">
    <div class="slider-bullet js-slider-bullet">
      <span class="slider-bullet__text js-slider-bullet__text">01</span>
      <span class="slider-bullet__line js-slider-bullet__line"></span>
    </div>
     <div class="slider-bullet js-slider-bullet">
      <span class="slider-bullet__text js-slider-bullet__text">02</span>
      <span class="slider-bullet__line js-slider-bullet__line"></span>
    </div>
     <div class="slider-bullet js-slider-bullet">
      <span class="slider-bullet__text js-slider-bullet__text">03</span>
      <span class="slider-bullet__line js-slider-bullet__line"></span>
    </div>
  </nav>
  
  <div class="scroll js-scroll">Scroll</div>
  
</div>
        `}),u},products=[{id:1,name:"S-Prank Blossom Sparkles",brand:"Diesel",category:"Topwear",size:"S,L,M,XL,XXL",color:"Pink",fabric:"cotton",producttype:"Gown",price:5999,imagename:"pr1.jpg",objModelName:"pr1.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:2,name:"S-Prank Jacket Shirt",brand:"Diesel",category:"Topwear",size:"S,L,M,XL,XXL",color:"Grey",fabric:"cotton",producttype:"shirts",price:5499,imagename:"pr2.jpg",objModelName:"pr2.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:3,name:"Netplay Red Wine Gown",brand:"Diesel",category:"Topwear",size:"L,M,XL",color:"Red",fabric:"Synthetic",producttype:"Gown",price:7499,imagename:"pr3.jpg",objModelName:"pr3.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:4,name:"Drake Floral Gown",brand:"Diesel",category:"Topwear",size:"L",color:"Tan",fabric:"Silk",producttype:"Clothing",price:4999,imagename:"pr4.jpg",objModelName:"pr4.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:5,name:"Chanal leather Vanity",brand:"Chanal",category:"Accessories",size:"os",color:"Red,Tan,Beige",fabric:"leather",producttype:"wallet",price:29999,imagename:"pr5.jpg",objModelName:"pr5.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:6,name:"Diesel Mega Cheif Watch",brand:"Diesel",category:"Accessories",size:"os",color:"Black,Tan,Beige",fabric:"leather",producttype:"Watch",price:19900,imagename:"pr6.jpg",objModelName:"pr6.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:7,name:"Nike Pro Run Shoe",brand:"Diesel",category:"Accessories",size:"os",color:"Black,Tan,Beige",fabric:"Mix",producttype:"apparels",price:9999,imagename:"pr7.jpg",objModelName:"pr7.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"},{id:8,name:"Diesel Turqiose Nectar",brand:"Diesel",category:"Gown",size:"os",color:"Black,Tan,Beige",fabric:"leather",producttype:"Clothing",price:4999,imagename:"pr8.jpg",objModelName:"pr8.glb",description:"Slim style with a clean construction and essential details. This versatile jean features a comfortable silhouette, finished with a zip fly. The fabric is made using 22% certified recycled cotton, reducing the use of virgin resources. Crafted from denim with partially recycled fibres and a hint of stretch. It features a medium blue wash with a classic, subtly lived-in look.",details:"Material:99%Cotton 1%Elastane-Spandex, Color:Blue,Occasion:Casual Wear,Fit: Slim,Waist: Mid Rise,Closure: Zip Fly",otherdetails:"Customer Support Details: Support Number: 022- 48930102, Support Email: support@dieselindia.com,Marketed And Imported By: Diesel Fashion India Reliance Pvt. Ltd., 8th Floor, Maker Tower E, Cuffe Parade, Mumbai, Maharashtra, 400005.,Net Quantity: 1 N,Country Of Origin: Mauritius,Name Of Commodity: Jeans,Style Code: A03558 0NFAJ"}];/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={109:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),a.Z=x},44:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),a.Z=x},798:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),a.Z=x},729:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,'.button-bar{background:var(--tp-base-background-color);border:1px solid #8f949c;width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:400;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:#ccc;transition:color .25s}.button-bar-button:hover{color:#eee}.button-bar-selected{color:#fff}.button-bar-selected-box{color:#fff}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:#413762}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:#ccc;transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px}.mode-button{font-weight:400}#webgi-logo{background-image:url("https://webgi.xyz/img/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:2.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.8rem !important;color:#ddd !important}#tweakpaneUiContainer{margin-top:7.5rem}@media only screen and (min-width: 480px){#tweakpaneUiContainer{margin-top:5.5rem}}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{background-color:#d1d4e7}',""]),a.Z=x},898:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:#eee;border:none}',""]),a.Z=x},513:function(u,a,s){var v=s(352),x=s.n(v)()(function(M){return M[1]});x.push([u.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),a.Z=x},476:function(u){var a;a=function(){return function(s){var v={};function x(M){if(v[M])return v[M].exports;var I=v[M]={i:M,l:!1,exports:{}};return s[M].call(I.exports,I,I.exports,x),I.l=!0,I.exports}return x.m=s,x.c=v,x.i=function(M){return M},x.d=function(M,I,B){x.o(M,I)||Object.defineProperty(M,I,{configurable:!1,enumerable:!0,get:B})},x.n=function(M){var I=M&&M.__esModule?function(){return M.default}:function(){return M};return x.d(I,"a",I),I},x.o=function(M,I){return Object.prototype.hasOwnProperty.call(M,I)},x.p="",x(x.s=5)}([function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0});var M={convertToObject:function(I){var B=I.substring(I.indexOf("{")+1).trim().slice(0,-1),U={};return B.split(";").map(function(j){if(j=j.trim()){var te=j.split(":");U[te[0].trim()]=te[1].trim()}}),U},getFromSheets:function(I){var B=document.styleSheets;for(var U in B){var j=null;try{j=B[U].rules||B[U].cssRules}catch{}if(j){for(var te in j)if(j[te].selectorText&&j[te].selectorText.split(",").indexOf(I)!=-1)return j[te].cssText?M.convertToObject(j[te].cssText):M.convertToObject(j[te].style.cssText)}}return{}},getPropertyDefault:function(I){return I=="timing-function"?"ease":I=="iteration-count"?1:I=="direction"?"normal":I=="fill-mode"?"none":null}};v.default=M},function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0});var M={generateId:function(){for(var I="",B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",U=0;U<8;++U)I+=B.charAt(Math.floor(Math.random()*B.length));return I},frameToString:function(I){var B="";for(var U in I)B+=U+":"+I[U]+";";return B},convertTimeToMs:function(I){if(!I)return 0;if(typeof I=="number")return I;var B=parseFloat(I);return I.indexOf("ms")!=-1?B:1e3*B},prefixes:["","-webkit-","-moz-","-o-"]};v.default=M},function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0});var M,I=(M=x(0))&&M.__esModule?M:{default:M};v.default=function B(U,j){if(function(oe,le){if(!(oe instanceof le))throw new TypeError("Cannot call a class as a function")}(this,B),this.styles=typeof U=="string"?I.default.getFromSheets(U):U,typeof j=="string"){var te=I.default.getFromSheets(j);for(var Z in this.options={},te)this.options[Z.replace("animation-","")]=te[Z]}else this.options=typeof j=="number"?{duration:j}:j}},function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0});var M=function(){function Z(oe,le){for(var se=0;se<le.length;se++){var ve=le[se];ve.enumerable=ve.enumerable||!1,ve.configurable=!0,"value"in ve&&(ve.writable=!0),Object.defineProperty(oe,ve.key,ve)}}return function(oe,le,se){return le&&Z(oe.prototype,le),se&&Z(oe,se),oe}}(),I=j(x(4)),B=j(x(1)),U=j(x(0));function j(Z){return Z&&Z.__esModule?Z:{default:Z}}var te=function(){function Z(oe,le,se,ve){if(function(X,W){if(!(X instanceof W))throw new TypeError("Cannot call a class as a function")}(this,Z),oe.constructor===Array?this.doms=oe:this.doms=[oe],le.constructor===Array?this.frames=le:this.frames=[le],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},se!=null&&se!=null)if(typeof se=="boolean")this.options.instant=se;else if(typeof se=="number")this.options.count=se,typeof ve=="boolean"&&(this.options.instant=ve);else for(var ce in se)ce=="pauseAt"&&se.pauseAt.constructor!==Array?this.options[ce]=[se[ce]]:this.options[ce]=se[ce];for(var K in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=B.default.prefixes:this.prefixes=[""],oe)this.countRemainder[K]=this.options.count-1;this.options.instant&&this.play()}return M(Z,[{key:"play",value:function(){var oe=this;for(var le in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(ve){oe.promiseResolve=ve})),this.doms){var se=this.makeAnimation(this.doms[le]);this.animations[le]=se.names,this.styleDoms[le]=se.styleDom,this.superSets[le]=this.makeSuperSet(this.doms[le],this.animations[le]),this.playAnimation(this.doms[le],this.superSets[le]),this.eventHandler[le]=this.handleAnimationEnd.bind(this,le),this.doms[le].addEventListener("animationend",this.eventHandler[le])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(oe){if(!oe){for(var le in this.doms)this.clear(le);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var se=this.styleDoms[oe];for(var ve in se&&se.parentNode&&se.parentNode.removeChild(se),this.superSets[oe])for(var ce in this.prefixes)this.doms[oe].style[this.prefixes[ce]+"animation-"+ve]=null;for(var K in this.prefixes)this.doms[oe].style[this.prefixes[K]+"animation-play-state"]=null;this.doms[oe].removeEventListener("animationend",this.eventHandler[oe]),this.countRemainder[oe]=this.options.count-1}},{key:"replay",value:function(oe){var le=this.doms[oe],se=le.cloneNode(!0);le.parentNode.replaceChild(se,le),this.doms[oe].removeEventListener("animationend",this.eventHandler[oe]),this.doms[oe]=se,this.doms[oe].addEventListener("animationend",this.eventHandler[oe])}},{key:"pause",value:function(){for(var oe in this.doms)this.pauseDom(this.doms[oe])}},{key:"resume",value:function(){for(var oe in this.doms)this.resumeDom(this.doms[oe])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(oe,le){var se=le.animationName,ve=se.substring(se.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(ve))&&this.pauseDom(this.doms[oe]),ve==this.frames.length&&(this.countRemainder[oe]==-1?this.replay(oe):this.countRemainder[oe]>0?(this.countRemainder[oe]--,this.replay(oe)):(this.options.applyOnEnd&&this.applyOnEnd(oe),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(oe){for(var le in this.prefixes)oe.style[this.prefixes[le]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(oe){for(var le in this.prefixes)oe.style[this.prefixes[le]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(oe){var le=this.newFrames[this.frames.length];for(var se in le)this.doms[oe].style[se]=le[se]}},{key:"makeAnimation",value:function(oe){var le={},se=[],ve={};for(var ce in this.frames)for(var K in se.push(this.frames[ce].styles),se[ce])ve[K]=!0;var X=window.getComputedStyle(oe);for(var W in ve)le[W]=X[W];se.unshift(le);for(var _e=[se[0]],ge=1;ge<se.length;++ge){var Ae=JSON.parse(JSON.stringify(_e[ge-1]));for(var ee in se[ge])Ae[ee]=se[ge][ee];_e.push(Ae)}return this.newFrames=_e,I.default.make(_e,this.prefixes)}},{key:"makeSuperSet",value:function(oe,le){var se=0,ve={};for(var ce in this.frames)for(var K in this.frames[ce].options)ve[K]="";ve.name="",ve.duration="",ve.delay="";for(var X=0;X<this.frames.length;++X){if(X)for(var W in ve)ve[W]+=",";var _e=B.default.convertTimeToMs(this.frames[X].options.duration),ge=B.default.convertTimeToMs(this.frames[X].options.delay);for(var Ae in X<this.options.startFrom&&(_e=0,ge=0),ve.name+=le[X],ve.duration+=_e+"ms",ve.delay+=se+ge+"ms",ve)Ae!="name"&&Ae!="duration"&&Ae!="delay"&&(ve[Ae]+=this.frames[X].options[Ae]?this.frames[X].options[Ae]:U.default.getPropertyDefault(Ae));var ee=this.frames[X].options["iteration-count"];se+=_e*parseInt(ee||1)+ge}return ve}},{key:"playAnimation",value:function(oe,le){for(var se in le)for(var ve in this.prefixes)oe.style[this.prefixes[ve]+"animation-"+se]=le[se];this.options.pauseAt.includes(0)&&this.pauseDom(oe)}}]),Z}();v.default=te},function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0});var M,I=(M=x(1))&&M.__esModule?M:{default:M},B={make:function(U,j){for(var te=[],Z="",oe="atr-"+I.default.generateId(),le=document.createElement("style"),se=0;se<U.length-1;++se)te.push(oe+"-"+(se+1)),Z+=B.makeFromTwoFrames(U[se],U[se+1],te[se],j);return le.innerHTML=Z,le.class="foo",document.getElementsByTagName("head")[0].appendChild(le),{names:te,styleDom:le}},makeFromTwoFrames:function(U,j,te,Z){var oe="";for(var le in Z)oe+="@"+Z[le]+"keyframes "+te+" {",oe+="0%",oe+="{"+I.default.frameToString(U)+"}",oe+="100%",oe+="{"+I.default.frameToString(j)+"}",oe+="}";return oe}};v.default=B},function(s,v,x){Object.defineProperty(v,"__esModule",{value:!0}),v.Queue=v.Frame=void 0;var M=B(x(2)),I=B(x(3));function B(U){return U&&U.__esModule?U:{default:U}}v.Frame=M.default,v.Queue=I.default}])},u.exports=a()},352:function(u){u.exports=function(a){var s=[];return s.toString=function(){return this.map(function(v){var x=a(v);return v[2]?"@media ".concat(v[2]," {").concat(x,"}"):x}).join("")},s.i=function(v,x,M){typeof v=="string"&&(v=[[null,v,""]]);var I={};if(M)for(var B=0;B<this.length;B++){var U=this[B][0];U!=null&&(I[U]=!0)}for(var j=0;j<v.length;j++){var te=[].concat(v[j]);M&&I[te[0]]||(x&&(te[2]?te[2]="".concat(x," and ").concat(te[2]):te[2]=x),s.push(te))}},s}},388:function(u){u.exports=function a(s,v,x){function M(U,j){if(!v[U]){if(!s[U]){if(I)return I(U,!0);throw new Error("Cannot find module '"+U+"'")}var te=v[U]={exports:{}};s[U][0].call(te.exports,function(Z){return M(s[U][1][Z]||Z)},te,te.exports,a,s,v,x)}return v[U].exports}for(var I=void 0,B=0;B<x.length;B++)M(x[B]);return M}({1:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){var le=a("crypto");function se(ge,Ae){return function(ee,$){var ae;if((ae=$.algorithm!=="passthrough"?le.createHash($.algorithm):new _e).write===void 0&&(ae.write=ae.update,ae.end=ae.update),W($,ae).dispatch(ee),ae.update||ae.end(""),ae.digest)return ae.digest($.encoding==="buffer"?void 0:$.encoding);var Re=ae.read();return $.encoding!=="buffer"?Re.toString($.encoding):Re}(ge,Ae=K(ge,Ae))}(v=s.exports=se).sha1=function(ge){return se(ge)},v.keys=function(ge){return se(ge,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},v.MD5=function(ge){return se(ge,{algorithm:"md5",encoding:"hex"})},v.keysMD5=function(ge){return se(ge,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var ve=le.getHashes?le.getHashes().slice():["sha1","md5"];ve.push("passthrough");var ce=["buffer","hex","binary","base64"];function K(ge,Ae){Ae=Ae||{};var ee={};if(ee.algorithm=Ae.algorithm||"sha1",ee.encoding=Ae.encoding||"hex",ee.excludeValues=!!Ae.excludeValues,ee.algorithm=ee.algorithm.toLowerCase(),ee.encoding=ee.encoding.toLowerCase(),ee.ignoreUnknown=Ae.ignoreUnknown===!0,ee.respectType=Ae.respectType!==!1,ee.respectFunctionNames=Ae.respectFunctionNames!==!1,ee.respectFunctionProperties=Ae.respectFunctionProperties!==!1,ee.unorderedArrays=Ae.unorderedArrays===!0,ee.unorderedSets=Ae.unorderedSets!==!1,ee.unorderedObjects=Ae.unorderedObjects!==!1,ee.replacer=Ae.replacer||void 0,ee.excludeKeys=Ae.excludeKeys||void 0,ge===void 0)throw new Error("Object argument required.");for(var $=0;$<ve.length;++$)ve[$].toLowerCase()===ee.algorithm.toLowerCase()&&(ee.algorithm=ve[$]);if(ve.indexOf(ee.algorithm)===-1)throw new Error('Algorithm "'+ee.algorithm+'"  not supported. supported values: '+ve.join(", "));if(ce.indexOf(ee.encoding)===-1&&ee.algorithm!=="passthrough")throw new Error('Encoding "'+ee.encoding+'"  not supported. supported values: '+ce.join(", "));return ee}function X(ge){if(typeof ge=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(ge))!=null}function W(ge,Ae,ee){function $(ae){return Ae.update?Ae.update(ae,"utf8"):Ae.write(ae,"utf8")}return ee=ee||[],{dispatch:function(ae){return ge.replacer&&(ae=ge.replacer(ae)),this["_"+(ae===null?"null":typeof ae)](ae)},_object:function(ae){var Re,pe=Object.prototype.toString.call(ae),he=/\[object (.*)\]/i.exec(pe);if(he=(he=he?he[1]:"unknown:["+pe+"]").toLowerCase(),0<=(Re=ee.indexOf(ae)))return this.dispatch("[CIRCULAR:"+Re+"]");if(ee.push(ae),I!==void 0&&I.isBuffer&&I.isBuffer(ae))return $("buffer:"),$(ae);if(he==="object"||he==="function"||he==="asyncfunction"){var we=Object.keys(ae);ge.unorderedObjects&&(we=we.sort()),ge.respectType===!1||X(ae)||we.splice(0,0,"prototype","__proto__","constructor"),ge.excludeKeys&&(we=we.filter(function(Ne){return!ge.excludeKeys(Ne)})),$("object:"+we.length+":");var Ce=this;return we.forEach(function(Ne){Ce.dispatch(Ne),$(":"),ge.excludeValues||Ce.dispatch(ae[Ne]),$(",")})}if(!this["_"+he]){if(ge.ignoreUnknown)return $("["+he+"]");throw new Error('Unknown object type "'+he+'"')}this["_"+he](ae)},_array:function(ae,Re){Re=Re!==void 0?Re:ge.unorderedArrays!==!1;var pe=this;if($("array:"+ae.length+":"),!Re||ae.length<=1)return ae.forEach(function(Ce){return pe.dispatch(Ce)});var he=[],we=ae.map(function(Ce){var Ne=new _e,Ze=ee.slice();return W(ge,Ne,Ze).dispatch(Ce),he=he.concat(Ze.slice(ee.length)),Ne.read().toString()});return ee=ee.concat(he),we.sort(),this._array(we,!1)},_date:function(ae){return $("date:"+ae.toJSON())},_symbol:function(ae){return $("symbol:"+ae.toString())},_error:function(ae){return $("error:"+ae.toString())},_boolean:function(ae){return $("bool:"+ae.toString())},_string:function(ae){$("string:"+ae.length+":"),$(ae.toString())},_function:function(ae){$("fn:"),X(ae)?this.dispatch("[native]"):this.dispatch(ae.toString()),ge.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(ae.name)),ge.respectFunctionProperties&&this._object(ae)},_number:function(ae){return $("number:"+ae.toString())},_xml:function(ae){return $("xml:"+ae.toString())},_null:function(){return $("Null")},_undefined:function(){return $("Undefined")},_regexp:function(ae){return $("regex:"+ae.toString())},_uint8array:function(ae){return $("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint8clampedarray:function(ae){return $("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(ae))},_int8array:function(ae){return $("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint16array:function(ae){return $("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_int16array:function(ae){return $("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint32array:function(ae){return $("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_int32array:function(ae){return $("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float32array:function(ae){return $("float32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float64array:function(ae){return $("float64array:"),this.dispatch(Array.prototype.slice.call(ae))},_arraybuffer:function(ae){return $("arraybuffer:"),this.dispatch(new Uint8Array(ae))},_url:function(ae){return $("url:"+ae.toString())},_map:function(ae){$("map:");var Re=Array.from(ae);return this._array(Re,ge.unorderedSets!==!1)},_set:function(ae){$("set:");var Re=Array.from(ae);return this._array(Re,ge.unorderedSets!==!1)},_file:function(ae){return $("file:"),this.dispatch([ae.name,ae.size,ae.type,ae.lastModfied])},_blob:function(){if(ge.ignoreUnknown)return $("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return $("domwindow")},_bigint:function(ae){return $("bigint:"+ae.toString())},_process:function(){return $("process")},_timer:function(){return $("timer")},_pipe:function(){return $("pipe")},_tcp:function(){return $("tcp")},_udp:function(){return $("udp")},_tty:function(){return $("tty")},_statwatcher:function(){return $("statwatcher")},_securecontext:function(){return $("securecontext")},_connection:function(){return $("connection")},_zlib:function(){return $("zlib")},_context:function(){return $("context")},_nodescript:function(){return $("nodescript")},_httpparser:function(){return $("httpparser")},_dataview:function(){return $("dataview")},_signal:function(){return $("signal")},_fsevent:function(){return $("fsevent")},_tlswrap:function(){return $("tlswrap")}}}function _e(){return{buf:"",write:function(ge){this.buf+=ge},end:function(ge){this.buf+=ge},read:function(){return this.buf}}}v.writeToStream=function(ge,Ae,ee){return ee===void 0&&(ee=Ae,Ae={}),W(Ae=K(ge,Ae),ee).dispatch(ge)}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){(function(le){var se=typeof Uint8Array<"u"?Uint8Array:Array,ve="+".charCodeAt(0),ce="/".charCodeAt(0),K="0".charCodeAt(0),X="a".charCodeAt(0),W="A".charCodeAt(0),_e="-".charCodeAt(0),ge="_".charCodeAt(0);function Ae(ee){var $=ee.charCodeAt(0);return $===ve||$===_e?62:$===ce||$===ge?63:$<K?-1:$<K+10?$-K+26+26:$<W+26?$-W:$<X+26?$-X+26:void 0}le.toByteArray=function(ee){var $,ae;if(0<ee.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Re=ee.length,pe=ee.charAt(Re-2)==="="?2:ee.charAt(Re-1)==="="?1:0,he=new se(3*ee.length/4-pe),we=0<pe?ee.length-4:ee.length,Ce=0;function Ne(Ze){he[Ce++]=Ze}for($=0;$<we;$+=4,0)Ne((16711680&(ae=Ae(ee.charAt($))<<18|Ae(ee.charAt($+1))<<12|Ae(ee.charAt($+2))<<6|Ae(ee.charAt($+3))))>>16),Ne((65280&ae)>>8),Ne(255&ae);return pe==2?Ne(255&(ae=Ae(ee.charAt($))<<2|Ae(ee.charAt($+1))>>4)):pe==1&&(Ne((ae=Ae(ee.charAt($))<<10|Ae(ee.charAt($+1))<<4|Ae(ee.charAt($+2))>>2)>>8&255),Ne(255&ae)),he},le.fromByteArray=function(ee){var $,ae,Re,pe,he=ee.length%3,we="";function Ce(Ne){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Ne)}for($=0,Re=ee.length-he;$<Re;$+=3)we+=Ce((pe=ae=(ee[$]<<16)+(ee[$+1]<<8)+ee[$+2])>>18&63)+Ce(pe>>12&63)+Ce(pe>>6&63)+Ce(63&pe);switch(he){case 1:we+=Ce((ae=ee[ee.length-1])>>2),we+=Ce(ae<<4&63),we+="==";break;case 2:we+=Ce((ae=(ee[ee.length-2]<<8)+ee[ee.length-1])>>10),we+=Ce(ae>>4&63),we+=Ce(ae<<2&63),we+="="}return we}})(v===void 0?this.base64js={}:v)}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(a,s,v){(function(x,M,ve,B,U,j,te,Z,oe){var le=a("base64-js"),se=a("ieee754");function ve(Qe,ft,bt){if(!(this instanceof ve))return new ve(Qe,ft,bt);var sn,bn,Un,pi,Xe,Xt=typeof Qe;if(ft==="base64"&&Xt=="string")for(Qe=(sn=Qe).trim?sn.trim():sn.replace(/^\s+|\s+$/g,"");Qe.length%4!=0;)Qe+="=";if(Xt=="number")bn=Ce(Qe);else if(Xt=="string")bn=ve.byteLength(Qe,ft);else{if(Xt!="object")throw new Error("First argument needs to be a number, array or string.");bn=Ce(Qe.length)}if(ve._useTypedArrays?Un=ve._augment(new Uint8Array(bn)):((Un=this).length=bn,Un._isBuffer=!0),ve._useTypedArrays&&typeof Qe.byteLength=="number")Un._set(Qe);else if(Ne(Xe=Qe)||ve.isBuffer(Xe)||Xe&&typeof Xe=="object"&&typeof Xe.length=="number")for(pi=0;pi<bn;pi++)ve.isBuffer(Qe)?Un[pi]=Qe.readUInt8(pi):Un[pi]=Qe[pi];else if(Xt=="string")Un.write(Qe,0,ft);else if(Xt=="number"&&!ve._useTypedArrays&&!bt)for(pi=0;pi<bn;pi++)Un[pi]=0;return Un}function ce(Qe,ft,bt,sn){sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft!=null,"missing offset"),Qt(ft+1<Qe.length,"Trying to read beyond buffer length"));var bn,Un=Qe.length;if(!(Un<=ft))return bt?(bn=Qe[ft],ft+1<Un&&(bn|=Qe[ft+1]<<8)):(bn=Qe[ft]<<8,ft+1<Un&&(bn|=Qe[ft+1])),bn}function K(Qe,ft,bt,sn){sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft!=null,"missing offset"),Qt(ft+3<Qe.length,"Trying to read beyond buffer length"));var bn,Un=Qe.length;if(!(Un<=ft))return bt?(ft+2<Un&&(bn=Qe[ft+2]<<16),ft+1<Un&&(bn|=Qe[ft+1]<<8),bn|=Qe[ft],ft+3<Un&&(bn+=Qe[ft+3]<<24>>>0)):(ft+1<Un&&(bn=Qe[ft+1]<<16),ft+2<Un&&(bn|=Qe[ft+2]<<8),ft+3<Un&&(bn|=Qe[ft+3]),bn+=Qe[ft]<<24>>>0),bn}function X(Qe,ft,bt,sn){if(sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft!=null,"missing offset"),Qt(ft+1<Qe.length,"Trying to read beyond buffer length")),!(Qe.length<=ft)){var bn=ce(Qe,ft,bt,!0);return 32768&bn?-1*(65535-bn+1):bn}}function W(Qe,ft,bt,sn){if(sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft!=null,"missing offset"),Qt(ft+3<Qe.length,"Trying to read beyond buffer length")),!(Qe.length<=ft)){var bn=K(Qe,ft,bt,!0);return 2147483648&bn?-1*(4294967295-bn+1):bn}}function _e(Qe,ft,bt,sn){return sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft+3<Qe.length,"Trying to read beyond buffer length")),se.read(Qe,ft,bt,23,4)}function ge(Qe,ft,bt,sn){return sn||(Qt(typeof bt=="boolean","missing or invalid endian"),Qt(ft+7<Qe.length,"Trying to read beyond buffer length")),se.read(Qe,ft,bt,52,8)}function Ae(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+1<Qe.length,"trying to write beyond buffer length"),vt(ft,65535));var Un=Qe.length;if(!(Un<=bt))for(var pi=0,Xe=Math.min(Un-bt,2);pi<Xe;pi++)Qe[bt+pi]=(ft&255<<8*(sn?pi:1-pi))>>>8*(sn?pi:1-pi)}function ee(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+3<Qe.length,"trying to write beyond buffer length"),vt(ft,4294967295));var Un=Qe.length;if(!(Un<=bt))for(var pi=0,Xe=Math.min(Un-bt,4);pi<Xe;pi++)Qe[bt+pi]=ft>>>8*(sn?pi:3-pi)&255}function $(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+1<Qe.length,"Trying to write beyond buffer length"),ut(ft,32767,-32768)),Qe.length<=bt||Ae(Qe,0<=ft?ft:65535+ft+1,bt,sn,bn)}function ae(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+3<Qe.length,"Trying to write beyond buffer length"),ut(ft,2147483647,-2147483648)),Qe.length<=bt||ee(Qe,0<=ft?ft:4294967295+ft+1,bt,sn,bn)}function Re(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+3<Qe.length,"Trying to write beyond buffer length"),Nt(ft,34028234663852886e22,-34028234663852886e22)),Qe.length<=bt||se.write(Qe,ft,bt,sn,23,4)}function pe(Qe,ft,bt,sn,bn){bn||(Qt(ft!=null,"missing value"),Qt(typeof sn=="boolean","missing or invalid endian"),Qt(bt!=null,"missing offset"),Qt(bt+7<Qe.length,"Trying to write beyond buffer length"),Nt(ft,17976931348623157e292,-17976931348623157e292)),Qe.length<=bt||se.write(Qe,ft,bt,sn,52,8)}v.Buffer=ve,v.SlowBuffer=ve,v.INSPECT_MAX_BYTES=50,ve.poolSize=8192,ve._useTypedArrays=function(){try{var Qe=new ArrayBuffer(0),ft=new Uint8Array(Qe);return ft.foo=function(){return 42},ft.foo()===42&&typeof ft.subarray=="function"}catch{return!1}}(),ve.isEncoding=function(Qe){switch(String(Qe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ve.isBuffer=function(Qe){return!(Qe==null||!Qe._isBuffer)},ve.byteLength=function(Qe,ft){var bt;switch(Qe+="",ft||"utf8"){case"hex":bt=Qe.length/2;break;case"utf8":case"utf-8":bt=Ye(Qe).length;break;case"ascii":case"binary":case"raw":bt=Qe.length;break;case"base64":bt=it(Qe).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":bt=2*Qe.length;break;default:throw new Error("Unknown encoding")}return bt},ve.concat=function(Qe,ft){if(Qt(Ne(Qe),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),Qe.length===0)return new ve(0);if(Qe.length===1)return Qe[0];if(typeof ft!="number")for(bn=ft=0;bn<Qe.length;bn++)ft+=Qe[bn].length;for(var bt=new ve(ft),sn=0,bn=0;bn<Qe.length;bn++){var Un=Qe[bn];Un.copy(bt,sn),sn+=Un.length}return bt},ve.prototype.write=function(Qe,ft,bt,sn){var bn;isFinite(ft)?isFinite(bt)||(sn=bt,bt=void 0):(bn=sn,sn=ft,ft=bt,bt=bn),ft=Number(ft)||0;var Un,pi,Xe,Xt,tn,dn,pn,Pn=this.length-ft;switch((!bt||Pn<(bt=Number(bt)))&&(bt=Pn),sn=String(sn||"utf8").toLowerCase()){case"hex":Un=function(Cn,vn,In,Fn){In=Number(In)||0;var Hn=Cn.length-In;(!Fn||Hn<(Fn=Number(Fn)))&&(Fn=Hn);var fe=vn.length;Qt(fe%2==0,"Invalid hex string"),fe/2<Fn&&(Fn=fe/2);for(var Se=0;Se<Fn;Se++){var Ve=parseInt(vn.substr(2*Se,2),16);Qt(!isNaN(Ve),"Invalid hex string"),Cn[In+Se]=Ve}return ve._charsWritten=2*Se,Se}(this,Qe,ft,bt);break;case"utf8":case"utf-8":tn=Qe,dn=ft,pn=bt,Un=ve._charsWritten=_t(Ye(tn),this,dn,pn);break;case"ascii":case"binary":Un=function(Cn,vn,In,Fn){return ve._charsWritten=_t(function(Hn){for(var fe=[],Se=0;Se<Hn.length;Se++)fe.push(255&Hn.charCodeAt(Se));return fe}(vn),Cn,In,Fn)}(this,Qe,ft,bt);break;case"base64":pi=Qe,Xe=ft,Xt=bt,Un=ve._charsWritten=_t(it(pi),this,Xe,Xt);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Un=function(Cn,vn,In,Fn){return ve._charsWritten=_t(function(Hn){for(var fe,Se,Ve,We=[],pt=0;pt<Hn.length;pt++)Se=(fe=Hn.charCodeAt(pt))>>8,Ve=fe%256,We.push(Ve),We.push(Se);return We}(vn),Cn,In,Fn)}(this,Qe,ft,bt);break;default:throw new Error("Unknown encoding")}return Un},ve.prototype.toString=function(Qe,ft,bt){var sn,bn,Un,pi,Xe=this;if(Qe=String(Qe||"utf8").toLowerCase(),ft=Number(ft)||0,(bt=bt!==void 0?Number(bt):bt=Xe.length)===ft)return"";switch(Qe){case"hex":sn=function(Xt,tn,dn){var pn=Xt.length;(!tn||tn<0)&&(tn=0),(!dn||dn<0||pn<dn)&&(dn=pn);for(var Pn="",Cn=tn;Cn<dn;Cn++)Pn+=Ze(Xt[Cn]);return Pn}(Xe,ft,bt);break;case"utf8":case"utf-8":sn=function(Xt,tn,dn){var pn="",Pn="";dn=Math.min(Xt.length,dn);for(var Cn=tn;Cn<dn;Cn++)Xt[Cn]<=127?(pn+=At(Pn)+String.fromCharCode(Xt[Cn]),Pn=""):Pn+="%"+Xt[Cn].toString(16);return pn+At(Pn)}(Xe,ft,bt);break;case"ascii":case"binary":sn=function(Xt,tn,dn){var pn="";dn=Math.min(Xt.length,dn);for(var Pn=tn;Pn<dn;Pn++)pn+=String.fromCharCode(Xt[Pn]);return pn}(Xe,ft,bt);break;case"base64":bn=Xe,pi=bt,sn=(Un=ft)===0&&pi===bn.length?le.fromByteArray(bn):le.fromByteArray(bn.slice(Un,pi));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":sn=function(Xt,tn,dn){for(var pn=Xt.slice(tn,dn),Pn="",Cn=0;Cn<pn.length;Cn+=2)Pn+=String.fromCharCode(pn[Cn]+256*pn[Cn+1]);return Pn}(Xe,ft,bt);break;default:throw new Error("Unknown encoding")}return sn},ve.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},ve.prototype.copy=function(Qe,ft,bt,sn){if(bt=bt||0,sn||sn===0||(sn=this.length),ft=ft||0,sn!==bt&&Qe.length!==0&&this.length!==0){Qt(bt<=sn,"sourceEnd < sourceStart"),Qt(0<=ft&&ft<Qe.length,"targetStart out of bounds"),Qt(0<=bt&&bt<this.length,"sourceStart out of bounds"),Qt(0<=sn&&sn<=this.length,"sourceEnd out of bounds"),sn>this.length&&(sn=this.length),Qe.length-ft<sn-bt&&(sn=Qe.length-ft+bt);var bn=sn-bt;if(bn<100||!ve._useTypedArrays)for(var Un=0;Un<bn;Un++)Qe[Un+ft]=this[Un+bt];else Qe._set(this.subarray(bt,bt+bn),ft)}},ve.prototype.slice=function(Qe,ft){var bt=this.length;if(Qe=we(Qe,bt,0),ft=we(ft,bt,bt),ve._useTypedArrays)return ve._augment(this.subarray(Qe,ft));for(var sn=ft-Qe,bn=new ve(sn,void 0,!0),Un=0;Un<sn;Un++)bn[Un]=this[Un+Qe];return bn},ve.prototype.get=function(Qe){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(Qe)},ve.prototype.set=function(Qe,ft){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(Qe,ft)},ve.prototype.readUInt8=function(Qe,ft){if(ft||(Qt(Qe!=null,"missing offset"),Qt(Qe<this.length,"Trying to read beyond buffer length")),!(Qe>=this.length))return this[Qe]},ve.prototype.readUInt16LE=function(Qe,ft){return ce(this,Qe,!0,ft)},ve.prototype.readUInt16BE=function(Qe,ft){return ce(this,Qe,!1,ft)},ve.prototype.readUInt32LE=function(Qe,ft){return K(this,Qe,!0,ft)},ve.prototype.readUInt32BE=function(Qe,ft){return K(this,Qe,!1,ft)},ve.prototype.readInt8=function(Qe,ft){if(ft||(Qt(Qe!=null,"missing offset"),Qt(Qe<this.length,"Trying to read beyond buffer length")),!(Qe>=this.length))return 128&this[Qe]?-1*(255-this[Qe]+1):this[Qe]},ve.prototype.readInt16LE=function(Qe,ft){return X(this,Qe,!0,ft)},ve.prototype.readInt16BE=function(Qe,ft){return X(this,Qe,!1,ft)},ve.prototype.readInt32LE=function(Qe,ft){return W(this,Qe,!0,ft)},ve.prototype.readInt32BE=function(Qe,ft){return W(this,Qe,!1,ft)},ve.prototype.readFloatLE=function(Qe,ft){return _e(this,Qe,!0,ft)},ve.prototype.readFloatBE=function(Qe,ft){return _e(this,Qe,!1,ft)},ve.prototype.readDoubleLE=function(Qe,ft){return ge(this,Qe,!0,ft)},ve.prototype.readDoubleBE=function(Qe,ft){return ge(this,Qe,!1,ft)},ve.prototype.writeUInt8=function(Qe,ft,bt){bt||(Qt(Qe!=null,"missing value"),Qt(ft!=null,"missing offset"),Qt(ft<this.length,"trying to write beyond buffer length"),vt(Qe,255)),ft>=this.length||(this[ft]=Qe)},ve.prototype.writeUInt16LE=function(Qe,ft,bt){Ae(this,Qe,ft,!0,bt)},ve.prototype.writeUInt16BE=function(Qe,ft,bt){Ae(this,Qe,ft,!1,bt)},ve.prototype.writeUInt32LE=function(Qe,ft,bt){ee(this,Qe,ft,!0,bt)},ve.prototype.writeUInt32BE=function(Qe,ft,bt){ee(this,Qe,ft,!1,bt)},ve.prototype.writeInt8=function(Qe,ft,bt){bt||(Qt(Qe!=null,"missing value"),Qt(ft!=null,"missing offset"),Qt(ft<this.length,"Trying to write beyond buffer length"),ut(Qe,127,-128)),ft>=this.length||(0<=Qe?this.writeUInt8(Qe,ft,bt):this.writeUInt8(255+Qe+1,ft,bt))},ve.prototype.writeInt16LE=function(Qe,ft,bt){$(this,Qe,ft,!0,bt)},ve.prototype.writeInt16BE=function(Qe,ft,bt){$(this,Qe,ft,!1,bt)},ve.prototype.writeInt32LE=function(Qe,ft,bt){ae(this,Qe,ft,!0,bt)},ve.prototype.writeInt32BE=function(Qe,ft,bt){ae(this,Qe,ft,!1,bt)},ve.prototype.writeFloatLE=function(Qe,ft,bt){Re(this,Qe,ft,!0,bt)},ve.prototype.writeFloatBE=function(Qe,ft,bt){Re(this,Qe,ft,!1,bt)},ve.prototype.writeDoubleLE=function(Qe,ft,bt){pe(this,Qe,ft,!0,bt)},ve.prototype.writeDoubleBE=function(Qe,ft,bt){pe(this,Qe,ft,!1,bt)},ve.prototype.fill=function(Qe,ft,bt){if(Qe=Qe||0,ft=ft||0,bt=bt||this.length,typeof Qe=="string"&&(Qe=Qe.charCodeAt(0)),Qt(typeof Qe=="number"&&!isNaN(Qe),"value is not a number"),Qt(ft<=bt,"end < start"),bt!==ft&&this.length!==0){Qt(0<=ft&&ft<this.length,"start out of bounds"),Qt(0<=bt&&bt<=this.length,"end out of bounds");for(var sn=ft;sn<bt;sn++)this[sn]=Qe}},ve.prototype.inspect=function(){for(var Qe=[],ft=this.length,bt=0;bt<ft;bt++)if(Qe[bt]=Ze(this[bt]),bt===v.INSPECT_MAX_BYTES){Qe[bt+1]="...";break}return"<Buffer "+Qe.join(" ")+">"},ve.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(ve._useTypedArrays)return new ve(this).buffer;for(var Qe=new Uint8Array(this.length),ft=0,bt=Qe.length;ft<bt;ft+=1)Qe[ft]=this[ft];return Qe.buffer};var he=ve.prototype;function we(Qe,ft,bt){return typeof Qe!="number"?bt:ft<=(Qe=~~Qe)?ft:0<=Qe||0<=(Qe+=ft)?Qe:0}function Ce(Qe){return(Qe=~~Math.ceil(+Qe))<0?0:Qe}function Ne(Qe){return(Array.isArray||function(ft){return Object.prototype.toString.call(ft)==="[object Array]"})(Qe)}function Ze(Qe){return Qe<16?"0"+Qe.toString(16):Qe.toString(16)}function Ye(Qe){for(var ft=[],bt=0;bt<Qe.length;bt++){var sn=Qe.charCodeAt(bt);if(sn<=127)ft.push(Qe.charCodeAt(bt));else{var bn=bt;55296<=sn&&sn<=57343&&bt++;for(var Un=encodeURIComponent(Qe.slice(bn,bt+1)).substr(1).split("%"),pi=0;pi<Un.length;pi++)ft.push(parseInt(Un[pi],16))}}return ft}function it(Qe){return le.toByteArray(Qe)}function _t(Qe,ft,bt,sn){for(var bn=0;bn<sn&&!(bn+bt>=ft.length||bn>=Qe.length);bn++)ft[bn+bt]=Qe[bn];return bn}function At(Qe){try{return decodeURIComponent(Qe)}catch{return String.fromCharCode(65533)}}function vt(Qe,ft){Qt(typeof Qe=="number","cannot write a non-number as a number"),Qt(0<=Qe,"specified a negative value for writing an unsigned value"),Qt(Qe<=ft,"value is larger than maximum value for type"),Qt(Math.floor(Qe)===Qe,"value has a fractional component")}function ut(Qe,ft,bt){Qt(typeof Qe=="number","cannot write a non-number as a number"),Qt(Qe<=ft,"value larger than maximum allowed value"),Qt(bt<=Qe,"value smaller than minimum allowed value"),Qt(Math.floor(Qe)===Qe,"value has a fractional component")}function Nt(Qe,ft,bt){Qt(typeof Qe=="number","cannot write a non-number as a number"),Qt(Qe<=ft,"value larger than maximum allowed value"),Qt(bt<=Qe,"value smaller than minimum allowed value")}function Qt(Qe,ft){if(!Qe)throw new Error(ft||"Failed assertion")}ve._augment=function(Qe){return Qe._isBuffer=!0,Qe._get=Qe.get,Qe._set=Qe.set,Qe.get=he.get,Qe.set=he.set,Qe.write=he.write,Qe.toString=he.toString,Qe.toLocaleString=he.toString,Qe.toJSON=he.toJSON,Qe.copy=he.copy,Qe.slice=he.slice,Qe.readUInt8=he.readUInt8,Qe.readUInt16LE=he.readUInt16LE,Qe.readUInt16BE=he.readUInt16BE,Qe.readUInt32LE=he.readUInt32LE,Qe.readUInt32BE=he.readUInt32BE,Qe.readInt8=he.readInt8,Qe.readInt16LE=he.readInt16LE,Qe.readInt16BE=he.readInt16BE,Qe.readInt32LE=he.readInt32LE,Qe.readInt32BE=he.readInt32BE,Qe.readFloatLE=he.readFloatLE,Qe.readFloatBE=he.readFloatBE,Qe.readDoubleLE=he.readDoubleLE,Qe.readDoubleBE=he.readDoubleBE,Qe.writeUInt8=he.writeUInt8,Qe.writeUInt16LE=he.writeUInt16LE,Qe.writeUInt16BE=he.writeUInt16BE,Qe.writeUInt32LE=he.writeUInt32LE,Qe.writeUInt32BE=he.writeUInt32BE,Qe.writeInt8=he.writeInt8,Qe.writeInt16LE=he.writeInt16LE,Qe.writeInt16BE=he.writeInt16BE,Qe.writeInt32LE=he.writeInt32LE,Qe.writeInt32BE=he.writeInt32BE,Qe.writeFloatLE=he.writeFloatLE,Qe.writeFloatBE=he.writeFloatBE,Qe.writeDoubleLE=he.writeDoubleLE,Qe.writeDoubleBE=he.writeDoubleBE,Qe.fill=he.fill,Qe.inspect=he.inspect,Qe.toArrayBuffer=he.toArrayBuffer,Qe}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){I=a("buffer").Buffer;var le=new I(4);le.fill(0),s.exports={hash:function(se,ve,ce,K){return I.isBuffer(se)||(se=new I(se)),function(X,W,_e){for(var ge=new I(W),Ae=_e?ge.writeInt32BE:ge.writeInt32LE,ee=0;ee<X.length;ee++)Ae.call(ge,X[ee],4*ee,!0);return ge}(ve(function(X,W){var _e;X.length%4!=0&&(_e=X.length+(4-X.length%4),X=I.concat([X,le],_e));for(var ge=[],Ae=W?X.readInt32BE:X.readInt32LE,ee=0;ee<X.length;ee+=4)ge.push(Ae.call(X,ee));return ge}(se,K),8*se.length),ce,K)}}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){I=a("buffer").Buffer;var le=a("./sha"),se=a("./sha256"),ve=a("./rng"),ce={sha1:le,sha256:se,md5:a("./md5")},K=64,X=new I(K);function W(ge,Ae){var ee=ce[ge=ge||"sha1"],$=[];return ee||_e("algorithm:",ge,"is not yet supported"),{update:function(ae){return I.isBuffer(ae)||(ae=new I(ae)),$.push(ae),ae.length,this},digest:function(ae){var Re=I.concat($),pe=Ae?function(he,we,Ce){I.isBuffer(we)||(we=new I(we)),I.isBuffer(Ce)||(Ce=new I(Ce)),we.length>K?we=he(we):we.length<K&&(we=I.concat([we,X],K));for(var Ne=new I(K),Ze=new I(K),Ye=0;Ye<K;Ye++)Ne[Ye]=54^we[Ye],Ze[Ye]=92^we[Ye];var it=he(I.concat([Ne,Ce]));return he(I.concat([Ze,it]))}(ee,Ae,Re):ee(Re);return $=null,ae?pe.toString(ae):pe}}}function _e(){var ge=[].slice.call(arguments).join(" ");throw new Error([ge,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}X.fill(0),v.createHash=function(ge){return W(ge)},v.createHmac=W,v.randomBytes=function(ge,Ae){if(!Ae||!Ae.call)return new I(ve(ge));try{Ae.call(this,void 0,new I(ve(ge)))}catch(ee){Ae(ee)}},function(ge,Ae){for(var ee in ge)Ae(ge[ee])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(ge){v[ge]=function(){_e("sorry,",ge,"is not implemented yet")}})}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){var le=a("./helpers");function se(ge,Ae){ge[Ae>>5]|=128<<Ae%32,ge[14+(Ae+64>>>9<<4)]=Ae;for(var ee=1732584193,$=-271733879,ae=-1732584194,Re=271733878,pe=0;pe<ge.length;pe+=16){var he=ee,we=$,Ce=ae,Ne=Re;ee=ce(ee,$,ae,Re,ge[pe+0],7,-680876936),Re=ce(Re,ee,$,ae,ge[pe+1],12,-389564586),ae=ce(ae,Re,ee,$,ge[pe+2],17,606105819),$=ce($,ae,Re,ee,ge[pe+3],22,-1044525330),ee=ce(ee,$,ae,Re,ge[pe+4],7,-176418897),Re=ce(Re,ee,$,ae,ge[pe+5],12,1200080426),ae=ce(ae,Re,ee,$,ge[pe+6],17,-1473231341),$=ce($,ae,Re,ee,ge[pe+7],22,-45705983),ee=ce(ee,$,ae,Re,ge[pe+8],7,1770035416),Re=ce(Re,ee,$,ae,ge[pe+9],12,-1958414417),ae=ce(ae,Re,ee,$,ge[pe+10],17,-42063),$=ce($,ae,Re,ee,ge[pe+11],22,-1990404162),ee=ce(ee,$,ae,Re,ge[pe+12],7,1804603682),Re=ce(Re,ee,$,ae,ge[pe+13],12,-40341101),ae=ce(ae,Re,ee,$,ge[pe+14],17,-1502002290),ee=K(ee,$=ce($,ae,Re,ee,ge[pe+15],22,1236535329),ae,Re,ge[pe+1],5,-165796510),Re=K(Re,ee,$,ae,ge[pe+6],9,-1069501632),ae=K(ae,Re,ee,$,ge[pe+11],14,643717713),$=K($,ae,Re,ee,ge[pe+0],20,-373897302),ee=K(ee,$,ae,Re,ge[pe+5],5,-701558691),Re=K(Re,ee,$,ae,ge[pe+10],9,38016083),ae=K(ae,Re,ee,$,ge[pe+15],14,-660478335),$=K($,ae,Re,ee,ge[pe+4],20,-405537848),ee=K(ee,$,ae,Re,ge[pe+9],5,568446438),Re=K(Re,ee,$,ae,ge[pe+14],9,-1019803690),ae=K(ae,Re,ee,$,ge[pe+3],14,-187363961),$=K($,ae,Re,ee,ge[pe+8],20,1163531501),ee=K(ee,$,ae,Re,ge[pe+13],5,-1444681467),Re=K(Re,ee,$,ae,ge[pe+2],9,-51403784),ae=K(ae,Re,ee,$,ge[pe+7],14,1735328473),ee=X(ee,$=K($,ae,Re,ee,ge[pe+12],20,-1926607734),ae,Re,ge[pe+5],4,-378558),Re=X(Re,ee,$,ae,ge[pe+8],11,-2022574463),ae=X(ae,Re,ee,$,ge[pe+11],16,1839030562),$=X($,ae,Re,ee,ge[pe+14],23,-35309556),ee=X(ee,$,ae,Re,ge[pe+1],4,-1530992060),Re=X(Re,ee,$,ae,ge[pe+4],11,1272893353),ae=X(ae,Re,ee,$,ge[pe+7],16,-155497632),$=X($,ae,Re,ee,ge[pe+10],23,-1094730640),ee=X(ee,$,ae,Re,ge[pe+13],4,681279174),Re=X(Re,ee,$,ae,ge[pe+0],11,-358537222),ae=X(ae,Re,ee,$,ge[pe+3],16,-722521979),$=X($,ae,Re,ee,ge[pe+6],23,76029189),ee=X(ee,$,ae,Re,ge[pe+9],4,-640364487),Re=X(Re,ee,$,ae,ge[pe+12],11,-421815835),ae=X(ae,Re,ee,$,ge[pe+15],16,530742520),ee=W(ee,$=X($,ae,Re,ee,ge[pe+2],23,-995338651),ae,Re,ge[pe+0],6,-198630844),Re=W(Re,ee,$,ae,ge[pe+7],10,1126891415),ae=W(ae,Re,ee,$,ge[pe+14],15,-1416354905),$=W($,ae,Re,ee,ge[pe+5],21,-57434055),ee=W(ee,$,ae,Re,ge[pe+12],6,1700485571),Re=W(Re,ee,$,ae,ge[pe+3],10,-1894986606),ae=W(ae,Re,ee,$,ge[pe+10],15,-1051523),$=W($,ae,Re,ee,ge[pe+1],21,-2054922799),ee=W(ee,$,ae,Re,ge[pe+8],6,1873313359),Re=W(Re,ee,$,ae,ge[pe+15],10,-30611744),ae=W(ae,Re,ee,$,ge[pe+6],15,-1560198380),$=W($,ae,Re,ee,ge[pe+13],21,1309151649),ee=W(ee,$,ae,Re,ge[pe+4],6,-145523070),Re=W(Re,ee,$,ae,ge[pe+11],10,-1120210379),ae=W(ae,Re,ee,$,ge[pe+2],15,718787259),$=W($,ae,Re,ee,ge[pe+9],21,-343485551),ee=_e(ee,he),$=_e($,we),ae=_e(ae,Ce),Re=_e(Re,Ne)}return Array(ee,$,ae,Re)}function ve(ge,Ae,ee,$,ae,Re){return _e((pe=_e(_e(Ae,ge),_e($,Re)))<<(he=ae)|pe>>>32-he,ee);var pe,he}function ce(ge,Ae,ee,$,ae,Re,pe){return ve(Ae&ee|~Ae&$,ge,Ae,ae,Re,pe)}function K(ge,Ae,ee,$,ae,Re,pe){return ve(Ae&$|ee&~$,ge,Ae,ae,Re,pe)}function X(ge,Ae,ee,$,ae,Re,pe){return ve(Ae^ee^$,ge,Ae,ae,Re,pe)}function W(ge,Ae,ee,$,ae,Re,pe){return ve(ee^(Ae|~$),ge,Ae,ae,Re,pe)}function _e(ge,Ae){var ee=(65535&ge)+(65535&Ae);return(ge>>16)+(Ae>>16)+(ee>>16)<<16|65535&ee}s.exports=function(ge){return le.hash(ge,se,16)}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){var le;le=function(se){for(var ve,ce=new Array(se),K=0;K<se;K++)!(3&K)&&(ve=4294967296*Math.random()),ce[K]=ve>>>((3&K)<<3)&255;return ce},s.exports=le}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){var le=a("./helpers");function se(K,X){K[X>>5]|=128<<24-X%32,K[15+(X+64>>9<<4)]=X;for(var W,_e,ge,Ae,ee,$=Array(80),ae=1732584193,Re=-271733879,pe=-1732584194,he=271733878,we=-1009589776,Ce=0;Ce<K.length;Ce+=16){for(var Ne=ae,Ze=Re,Ye=pe,it=he,_t=we,At=0;At<80;At++){$[At]=At<16?K[Ce+At]:ce($[At-3]^$[At-8]^$[At-14]^$[At-16],1);var vt=ve(ve(ce(ae,5),(ge=Re,Ae=pe,ee=he,(_e=At)<20?ge&Ae|~ge&ee:!(_e<40)&&_e<60?ge&Ae|ge&ee|Ae&ee:ge^Ae^ee)),ve(ve(we,$[At]),(W=At)<20?1518500249:W<40?1859775393:W<60?-1894007588:-899497514));we=he,he=pe,pe=ce(Re,30),Re=ae,ae=vt}ae=ve(ae,Ne),Re=ve(Re,Ze),pe=ve(pe,Ye),he=ve(he,it),we=ve(we,_t)}return Array(ae,Re,pe,he,we)}function ve(K,X){var W=(65535&K)+(65535&X);return(K>>16)+(X>>16)+(W>>16)<<16|65535&W}function ce(K,X){return K<<X|K>>>32-X}s.exports=function(K){return le.hash(K,se,20,!0)}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){function le(K,X){var W=(65535&K)+(65535&X);return(K>>16)+(X>>16)+(W>>16)<<16|65535&W}function se(K,X){return K>>>X|K<<32-X}function ve(K,X){var W,_e,ge,Ae,ee,$,ae,Re,pe,he,we=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),Ce=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),Ne=new Array(64);K[X>>5]|=128<<24-X%32,K[15+(X+64>>9<<4)]=X;for(var Ze,Ye,it,_t,At,vt,ut,Nt,Qt=0;Qt<K.length;Qt+=16){W=Ce[0],_e=Ce[1],ge=Ce[2],Ae=Ce[3],ee=Ce[4],$=Ce[5],ae=Ce[6],Re=Ce[7];for(var Qe=0;Qe<64;Qe++)Ne[Qe]=Qe<16?K[Qe+Qt]:le(le(le(se(Nt=Ne[Qe-2],17)^se(Nt,19)^Nt>>>10,Ne[Qe-7]),se(ut=Ne[Qe-15],7)^se(ut,18)^ut>>>3),Ne[Qe-16]),pe=le(le(le(le(Re,se(vt=ee,6)^se(vt,11)^se(vt,25)),(At=ee)&$^~At&ae),we[Qe]),Ne[Qe]),he=le(se(_t=W,2)^se(_t,13)^se(_t,22),(Ze=W)&(Ye=_e)^Ze&(it=ge)^Ye&it),Re=ae,ae=$,$=ee,ee=le(Ae,pe),Ae=ge,ge=_e,_e=W,W=le(pe,he);Ce[0]=le(W,Ce[0]),Ce[1]=le(_e,Ce[1]),Ce[2]=le(ge,Ce[2]),Ce[3]=le(Ae,Ce[3]),Ce[4]=le(ee,Ce[4]),Ce[5]=le($,Ce[5]),Ce[6]=le(ae,Ce[6]),Ce[7]=le(Re,Ce[7])}return Ce}var ce=a("./helpers");s.exports=function(K){return ce.hash(K,ve,32,!0)}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){function le(){}(x=s.exports={}).nextTick=function(){var se=typeof window<"u"&&window.setImmediate,ve=typeof window<"u"&&window.postMessage&&window.addEventListener;if(se)return function(K){return window.setImmediate(K)};if(ve){var ce=[];return window.addEventListener("message",function(K){var X=K.source;X!==window&&X!==null||K.data!=="process-tick"||(K.stopPropagation(),0<ce.length&&ce.shift()())},!0),function(K){ce.push(K),window.postMessage("process-tick","*")}}return function(K){setTimeout(K,0)}}(),x.title="browser",x.browser=!0,x.env={},x.argv=[],x.on=le,x.addListener=le,x.once=le,x.off=le,x.removeListener=le,x.removeAllListeners=le,x.emit=le,x.binding=function(se){throw new Error("process.binding is not supported")},x.cwd=function(){return"/"},x.chdir=function(se){throw new Error("process.chdir is not supported")}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(a,s,v){(function(x,M,I,B,U,j,te,Z,oe){v.read=function(le,se,ve,ce,K){var X,W,_e=8*K-ce-1,ge=(1<<_e)-1,Ae=ge>>1,ee=-7,$=ve?K-1:0,ae=ve?-1:1,Re=le[se+$];for($+=ae,X=Re&(1<<-ee)-1,Re>>=-ee,ee+=_e;0<ee;X=256*X+le[se+$],$+=ae,ee-=8);for(W=X&(1<<-ee)-1,X>>=-ee,ee+=ce;0<ee;W=256*W+le[se+$],$+=ae,ee-=8);if(X===0)X=1-Ae;else{if(X===ge)return W?NaN:1/0*(Re?-1:1);W+=Math.pow(2,ce),X-=Ae}return(Re?-1:1)*W*Math.pow(2,X-ce)},v.write=function(le,se,ve,ce,K,X){var W,_e,ge,Ae=8*X-K-1,ee=(1<<Ae)-1,$=ee>>1,ae=K===23?Math.pow(2,-24)-Math.pow(2,-77):0,Re=ce?0:X-1,pe=ce?1:-1,he=se<0||se===0&&1/se<0?1:0;for(se=Math.abs(se),isNaN(se)||se===1/0?(_e=isNaN(se)?1:0,W=ee):(W=Math.floor(Math.log(se)/Math.LN2),se*(ge=Math.pow(2,-W))<1&&(W--,ge*=2),2<=(se+=1<=W+$?ae/ge:ae*Math.pow(2,1-$))*ge&&(W++,ge/=2),ee<=W+$?(_e=0,W=ee):1<=W+$?(_e=(se*ge-1)*Math.pow(2,K),W+=$):(_e=se*Math.pow(2,$-1)*Math.pow(2,K),W=0));8<=K;le[ve+Re]=255&_e,Re+=pe,_e/=256,K-=8);for(W=W<<K|_e,Ae+=K;0<Ae;le[ve+Re]=255&W,Re+=pe,W/=256,Ae-=8);le[ve+Re-pe]|=128*he}}).call(this,a("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},a("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(u){var a=function(){function s(ve){return te(ve,Z(j(oe(ve.length),ve),1/ve.length))}function v(ve){return j(le(ve),ve)}function x(ve,ce){return Z(ve,ce?1/(ve.length-1):1/ve.length)}function M(ve){var ce=function(X){var W,_e=Math.pow(2,-52),ge=1e-64/_e,Ae=0,ee=0,$=0,ae=0,Re=0,pe=se(X),he=pe.length,we=pe[0].length;if(he<we)throw"Need more rows than columns";var Ce=new Array(we),Ne=new Array(we);for(ee=0;ee<we;ee++)Ce[ee]=Ne[ee]=0;var Ze=function sn(bn,Un,pi){pi===void 0&&(pi=0);var Xe,Xt=bn[pi],tn=Array(Xt);if(pi===bn.length-1){for(Xe=Xt-2;Xe>=0;Xe-=2)tn[Xe+1]=Un,tn[Xe]=Un;return Xe===-1&&(tn[0]=Un),tn}for(Xe=Xt-1;Xe>=0;Xe--)tn[Xe]=sn(bn,Un,pi+1);return tn}([we,we],0);function Ye(sn,bn){return(sn=Math.abs(sn))>(bn=Math.abs(bn))?sn*Math.sqrt(1+bn*bn/sn/sn):bn==0?sn:bn*Math.sqrt(1+sn*sn/bn/bn)}var it=0,_t=0,At=0,vt=0,ut=0,Nt=0,Qt=0;for(ee=0;ee<we;ee++){for(Ce[ee]=_t,Qt=0,Re=ee+1,$=ee;$<he;$++)Qt+=pe[$][ee]*pe[$][ee];if(Qt<=ge)_t=0;else for(it=pe[ee][ee],_t=Math.sqrt(Qt),it>=0&&(_t=-_t),At=it*_t-Qt,pe[ee][ee]=it-_t,$=Re;$<we;$++){for(Qt=0,ae=ee;ae<he;ae++)Qt+=pe[ae][ee]*pe[ae][$];for(it=Qt/At,ae=ee;ae<he;ae++)pe[ae][$]+=it*pe[ae][ee]}for(Ne[ee]=_t,Qt=0,$=Re;$<we;$++)Qt+=pe[ee][$]*pe[ee][$];if(Qt<=ge)_t=0;else{for(it=pe[ee][ee+1],_t=Math.sqrt(Qt),it>=0&&(_t=-_t),At=it*_t-Qt,pe[ee][ee+1]=it-_t,$=Re;$<we;$++)Ce[$]=pe[ee][$]/At;for($=Re;$<he;$++){for(Qt=0,ae=Re;ae<we;ae++)Qt+=pe[$][ae]*pe[ee][ae];for(ae=Re;ae<we;ae++)pe[$][ae]+=Qt*Ce[ae]}}(ut=Math.abs(Ne[ee])+Math.abs(Ce[ee]))>vt&&(vt=ut)}for(ee=we-1;ee!=-1;ee+=-1){if(_t!=0){for(At=_t*pe[ee][ee+1],$=Re;$<we;$++)Ze[$][ee]=pe[ee][$]/At;for($=Re;$<we;$++){for(Qt=0,ae=Re;ae<we;ae++)Qt+=pe[ee][ae]*Ze[ae][$];for(ae=Re;ae<we;ae++)Ze[ae][$]+=Qt*Ze[ae][ee]}}for($=Re;$<we;$++)Ze[ee][$]=0,Ze[$][ee]=0;Ze[ee][ee]=1,_t=Ce[ee],Re=ee}for(ee=we-1;ee!=-1;ee+=-1){for(Re=ee+1,_t=Ne[ee],$=Re;$<we;$++)pe[ee][$]=0;if(_t!=0){for(At=pe[ee][ee]*_t,$=Re;$<we;$++){for(Qt=0,ae=Re;ae<he;ae++)Qt+=pe[ae][ee]*pe[ae][$];for(it=Qt/At,ae=ee;ae<he;ae++)pe[ae][$]+=it*pe[ae][ee]}for($=ee;$<he;$++)pe[$][ee]=pe[$][ee]/_t}else for($=ee;$<he;$++)pe[$][ee]=0;pe[ee][ee]+=1}for(_e*=vt,ae=we-1;ae!=-1;ae+=-1)for(var Qe=0;Qe<50;Qe++){var ft=!1;for(Re=ae;Re!=-1;Re+=-1){if(Math.abs(Ce[Re])<=_e){ft=!0;break}if(Math.abs(Ne[Re-1])<=_e)break}if(!ft){Ae=0,Qt=1;var bt=Re-1;for(ee=Re;ee<ae+1&&(it=Qt*Ce[ee],Ce[ee]=Ae*Ce[ee],!(Math.abs(it)<=_e));ee++)for(At=Ye(it,_t=Ne[ee]),Ne[ee]=At,Ae=_t/At,Qt=-it/At,$=0;$<he;$++)ut=pe[$][bt],Nt=pe[$][ee],pe[$][bt]=ut*Ae+Nt*Qt,pe[$][ee]=-ut*Qt+Nt*Ae}if(Nt=Ne[ae],Re==ae){if(Nt<0)for(Ne[ae]=-Nt,$=0;$<we;$++)Ze[$][ae]=-Ze[$][ae];break}if(Qe>=49)throw"Error: no convergence.";for(vt=Ne[Re],_t=Ye(it=(((ut=Ne[ae-1])-Nt)*(ut+Nt)+((_t=Ce[ae-1])-(At=Ce[ae]))*(_t+At))/(2*At*ut),1),it=it<0?((vt-Nt)*(vt+Nt)+At*(ut/(it-_t)-At))/vt:((vt-Nt)*(vt+Nt)+At*(ut/(it+_t)-At))/vt,Ae=1,Qt=1,ee=Re+1;ee<ae+1;ee++){for(_t=Ce[ee],ut=Ne[ee],At=Qt*_t,_t*=Ae,Nt=Ye(it,At),Ce[ee-1]=Nt,it=vt*(Ae=it/Nt)+_t*(Qt=At/Nt),_t=-vt*Qt+_t*Ae,At=ut*Qt,ut*=Ae,$=0;$<we;$++)vt=Ze[$][ee-1],Nt=Ze[$][ee],Ze[$][ee-1]=vt*Ae+Nt*Qt,Ze[$][ee]=-vt*Qt+Nt*Ae;for(Nt=Ye(it,At),Ne[ee-1]=Nt,it=(Ae=it/Nt)*_t+(Qt=At/Nt)*ut,vt=-Qt*_t+Ae*ut,$=0;$<he;$++)ut=pe[$][ee-1],Nt=pe[$][ee],pe[$][ee-1]=ut*Ae+Nt*Qt,pe[$][ee]=-ut*Qt+Nt*Ae}Ce[Re]=0,Ce[ae]=it,Ne[ae]=vt}for(ee=0;ee<Ne.length;ee++)Ne[ee]<_e&&(Ne[ee]=0);for(ee=0;ee<we;ee++)for($=ee-1;$>=0;$--)if(Ne[$]<Ne[ee]){for(Ae=Ne[$],Ne[$]=Ne[ee],Ne[ee]=Ae,ae=0;ae<pe.length;ae++)W=pe[ae][ee],pe[ae][ee]=pe[ae][$],pe[ae][$]=W;for(ae=0;ae<Ze.length;ae++)W=Ze[ae][ee],Ze[ae][ee]=Ze[ae][$],Ze[ae][$]=W;ee=$}return{U:pe,S:Ne,V:Ze}}(ve);console.log(ce);var K=ce.U;return ce.S.map(function(X,W){var _e={};return _e.eigenvalue=X,_e.vector=K.map(function(ge,Ae){return-1*ge[W]}),_e})}function I(ve,...ce){var K=ce.map(function(_e){return _e.vector}),X=j(K,le(s(ve))),W=Z(j(oe(ve.length),ve),-1/ve.length);return{adjustedData:X,formattedAdjustedData:U(X,2),avgData:W,selectedVectors:K}}function B(ve){return M(x(v(s(ve)),!1))}function U(ve,ce){var K=Math.pow(10,ce||2);return ve.map(function(X,W){return X.map(function(_e){return Math.round(_e*K)/K})})}function j(ve,ce){if(!(ve[0]&&ce[0]&&ve.length&&ce.length))throw new Error("Both A and B should be matrices");if(ce.length!==ve[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var K=[],X=0;X<ve.length;X++){K[X]=[];for(var W=0;W<ce[0].length;W++)for(var _e=0;_e<ve[0].length;_e++)K[X][W]=K[X][W]?K[X][W]+ve[X][_e]*ce[_e][W]:ve[X][_e]*ce[_e][W]}return K}function te(ve,ce){if(ve.length!==ce.length||ve[0].length!==ce[0].length)throw new Error("Both A and B should have the same dimensions");for(var K=[],X=0;X<ve.length;X++){K[X]=[];for(var W=0;W<ce[0].length;W++)K[X][W]=ve[X][W]-ce[X][W]}return K}function Z(ve,ce){for(var K=[],X=0;X<ve.length;X++){K[X]=[];for(var W=0;W<ve[0].length;W++)K[X][W]=ve[X][W]*ce}return K}function oe(ve){for(var ce=[],K=0;K<ve;K++){ce[K]=[];for(var X=0;X<ve;X++)ce[K][X]=1}return ce}function le(ve){return se(ve)[0].map(function(ce,K){return ve.map(function(X){return X[K]})})}function se(ve){var ce=JSON.stringify(ve);return JSON.parse(ce)}return{computeDeviationScores:v,computeDeviationMatrix:s,computeSVD:M,computePercentageExplained:function(ve,...ce){var K=ve.map(function(X){return X.eigenvalue}).reduce(function(X,W){return X+W});return ce.map(function(X){return X.eigenvalue}).reduce(function(X,W){return X+W})/K},computeOriginalData:function(ve,ce,K){var X=te(le(j(le(ce),ve)),K);return{originalData:X,formattedOriginalData:U(X,2)}},computeVarianceCovariance:x,computeAdjustedData:I,getEigenVectors:B,analyseTopResult:function(ve){var ce=B(ve).sort(function(K,X){return X.eigenvalue-K.eigenvalue});return console.log("Sorted Vectors",ce),I(ve,ce[0].vector)},transpose:le,multiply:j,clone:se,scale:Z}}();u.exports=a},701:function(u){var a=[];function s(M){for(var I=-1,B=0;B<a.length;B++)if(a[B].identifier===M){I=B;break}return I}function v(M,I){for(var B={},U=[],j=0;j<M.length;j++){var te=M[j],Z=I.base?te[0]+I.base:te[0],oe=B[Z]||0,le="".concat(Z," ").concat(oe);B[Z]=oe+1;var se=s(le),ve={css:te[1],media:te[2],sourceMap:te[3],supports:te[4],layer:te[5]};if(se!==-1)a[se].references++,a[se].updater(ve);else{var ce=x(ve,I);I.byIndex=j,a.splice(j,0,{identifier:le,updater:ce,references:1})}U.push(le)}return U}function x(M,I){var B=I.domAPI(I);return B.update(M),function(U){if(U){if(U.css===M.css&&U.media===M.media&&U.sourceMap===M.sourceMap&&U.supports===M.supports&&U.layer===M.layer)return;B.update(M=U)}else B.remove()}}u.exports=function(M,I){var B=v(M=M||[],I=I||{});return function(U){U=U||[];for(var j=0;j<B.length;j++){var te=s(B[j]);a[te].references--}for(var Z=v(U,I),oe=0;oe<B.length;oe++){var le=s(B[oe]);a[le].references===0&&(a[le].updater(),a.splice(le,1))}B=Z}}},182:function(u){u.exports=function(a){var s=document.createElement("style");return a.setAttributes(s,a.attributes),a.insert(s,a.options),s}},850:function(u,a,s){u.exports=function(v){var x=s.nc;x&&v.setAttribute("nonce",x)}},236:function(u){u.exports=function(a){var s=a.insertStyleElement(a);return{update:function(v){(function(x,M,I){var B="";I.supports&&(B+="@supports (".concat(I.supports,") {")),I.media&&(B+="@media ".concat(I.media," {"));var U=I.layer!==void 0;U&&(B+="@layer".concat(I.layer.length>0?" ".concat(I.layer):""," {")),B+=I.css,U&&(B+="}"),I.media&&(B+="}"),I.supports&&(B+="}");var j=I.sourceMap;j&&typeof btoa<"u"&&(B+=`
/`,B+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(j))))," *"),B+="/"),M.styleTagTransform(B,x,M.options)})(s,a,v)},remove:function(){(function(v){if(v.parentNode===null)return!1;v.parentNode.removeChild(v)})(s)}}}},213:function(u){u.exports=function(a,s){if(s.styleSheet)s.styleSheet.cssText=a;else{for(;s.firstChild;)s.removeChild(s.firstChild);s.appendChild(document.createTextNode(a))}}},1:function(u){u.exports=function(){var a={820:function(M,I,B){var U=B(537),j=B.n(U),te=B(645),Z=B.n(te)()(j());Z.push([M.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),I.Z=Z},645:function(M){M.exports=function(I){var B=[];return B.toString=function(){return this.map(function(U){var j="",te=U[5]!==void 0;return U[4]&&(j+="@supports (".concat(U[4],") {")),U[2]&&(j+="@media ".concat(U[2]," {")),te&&(j+="@layer".concat(U[5].length>0?" ".concat(U[5]):""," {")),j+=I(U),te&&(j+="}"),U[2]&&(j+="}"),U[4]&&(j+="}"),j}).join("")},B.i=function(U,j,te,Z,oe){typeof U=="string"&&(U=[[null,U,void 0]]);var le={};if(te)for(var se=0;se<this.length;se++){var ve=this[se][0];ve!=null&&(le[ve]=!0)}for(var ce=0;ce<U.length;ce++){var K=[].concat(U[ce]);te&&le[K[0]]||(oe!==void 0&&(K[5]===void 0||(K[1]="@layer".concat(K[5].length>0?" ".concat(K[5]):""," {").concat(K[1],"}")),K[5]=oe),j&&(K[2]&&(K[1]="@media ".concat(K[2]," {").concat(K[1],"}")),K[2]=j),Z&&(K[4]?(K[1]="@supports (".concat(K[4],") {").concat(K[1],"}"),K[4]=Z):K[4]="".concat(Z)),B.push(K))}},B}},537:function(M){M.exports=function(I){var B=I[1],U=I[3];if(!U)return B;if(typeof btoa=="function"){var j=btoa(unescape(encodeURIComponent(JSON.stringify(U)))),te="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(j),Z="/*# ".concat(te," */"),oe=U.sources.map(function(le){return"/*# sourceURL=".concat(U.sourceRoot||"").concat(le," */")});return[B].concat(oe).concat([Z]).join(`
`)}return[B].join(`
`)}},379:function(M){var I=[];function B(te){for(var Z=-1,oe=0;oe<I.length;oe++)if(I[oe].identifier===te){Z=oe;break}return Z}function U(te,Z){for(var oe={},le=[],se=0;se<te.length;se++){var ve=te[se],ce=Z.base?ve[0]+Z.base:ve[0],K=oe[ce]||0,X="".concat(ce," ").concat(K);oe[ce]=K+1;var W=B(X),_e={css:ve[1],media:ve[2],sourceMap:ve[3],supports:ve[4],layer:ve[5]};if(W!==-1)I[W].references++,I[W].updater(_e);else{var ge=j(_e,Z);Z.byIndex=se,I.splice(se,0,{identifier:X,updater:ge,references:1})}le.push(X)}return le}function j(te,Z){var oe=Z.domAPI(Z);return oe.update(te),function(le){if(le){if(le.css===te.css&&le.media===te.media&&le.sourceMap===te.sourceMap&&le.supports===te.supports&&le.layer===te.layer)return;oe.update(te=le)}else oe.remove()}}M.exports=function(te,Z){var oe=U(te=te||[],Z=Z||{});return function(le){le=le||[];for(var se=0;se<oe.length;se++){var ve=B(oe[se]);I[ve].references--}for(var ce=U(le,Z),K=0;K<oe.length;K++){var X=B(oe[K]);I[X].references===0&&(I[X].updater(),I.splice(X,1))}oe=ce}}},216:function(M){M.exports=function(I){var B=document.createElement("style");return I.setAttributes(B,I.attributes),I.insert(B,I.options),B}},636:function(M,I,B){M.exports=function(U){var j=B.nc;j&&U.setAttribute("nonce",j)}},795:function(M){M.exports=function(I){var B=I.insertStyleElement(I);return{update:function(U){(function(j,te,Z){var oe="";Z.supports&&(oe+="@supports (".concat(Z.supports,") {")),Z.media&&(oe+="@media ".concat(Z.media," {"));var le=Z.layer!==void 0;le&&(oe+="@layer".concat(Z.layer.length>0?" ".concat(Z.layer):""," {")),oe+=Z.css,le&&(oe+="}"),Z.media&&(oe+="}"),Z.supports&&(oe+="}");var se=Z.sourceMap;se&&typeof btoa<"u"&&(oe+=`
/`,oe+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(se))))," *"),oe+="/"),te.styleTagTransform(oe,j,te.options)})(B,I,U)},remove:function(){(function(U){if(U.parentNode===null)return!1;U.parentNode.removeChild(U)})(B)}}}},589:function(M){M.exports=function(I,B){if(B.styleSheet)B.styleSheet.cssText=I;else{for(;B.firstChild;)B.removeChild(B.firstChild);B.appendChild(document.createTextNode(I))}}}},s={};function v(M){var I=s[M];if(I!==void 0)return I.exports;var B=s[M]={id:M,exports:{}};return a[M](B,B.exports,v),B.exports}v.n=function(M){var I=M&&M.__esModule?function(){return M.default}:function(){return M};return v.d(I,{a:I}),I},v.d=function(M,I){for(var B in I)v.o(I,B)&&!v.o(M,B)&&Object.defineProperty(M,B,{enumerable:!0,get:I[B]})},v.o=function(M,I){return Object.prototype.hasOwnProperty.call(M,I)},v.nc=void 0;var x={};return function(){v.d(x,{default:function(){return Ne}});var M=v(379),I=v.n(M),B=v(795),U=v.n(B),j=v(636),te=v.n(j),Z=v(216),oe=v.n(Z),le=v(589),se=v.n(le),ve=v(820),ce={};ve.Z&&ve.Z.locals&&(ce.locals=ve.Z.locals);var K,X=0,W={};W.styleTagTransform=se(),W.setAttributes=te(),W.insert=function(Ze,Ye){(Ye.target||document.head).appendChild(Ze)},W.domAPI=U(),W.insertStyleElement=oe(),ce.use=function(Ze){return W.options=Ze||{},X++||(K=I()(ve.Z,W)),ce},ce.unuse=function(){X>0&&!--X&&(K(),K=null)};var _e=ce;function ge(Ze,Ye){return function(it){if(Array.isArray(it))return it}(Ze)||function(it,_t){var At=it==null?null:typeof Symbol<"u"&&it[Symbol.iterator]||it["@@iterator"];if(At!=null){var vt,ut,Nt=[],Qt=!0,Qe=!1;try{for(At=At.call(it);!(Qt=(vt=At.next()).done)&&(Nt.push(vt.value),!_t||Nt.length!==_t);Qt=!0);}catch(ft){Qe=!0,ut=ft}finally{try{Qt||At.return==null||At.return()}finally{if(Qe)throw ut}}return Nt}}(Ze,Ye)||function(it,_t){if(it){if(typeof it=="string")return Ae(it,_t);var At=Object.prototype.toString.call(it).slice(8,-1);return At==="Object"&&it.constructor&&(At=it.constructor.name),At==="Map"||At==="Set"?Array.from(it):At==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(At)?Ae(it,_t):void 0}}(Ze,Ye)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ae(Ze,Ye){(Ye==null||Ye>Ze.length)&&(Ye=Ze.length);for(var it=0,_t=new Array(Ye);it<Ye;it++)_t[it]=Ze[it];return _t}function ee(Ze,Ye){var it=Object.keys(Ze);if(Object.getOwnPropertySymbols){var _t=Object.getOwnPropertySymbols(Ze);Ye&&(_t=_t.filter(function(At){return Object.getOwnPropertyDescriptor(Ze,At).enumerable})),it.push.apply(it,_t)}return it}function $(Ze){for(var Ye=1;Ye<arguments.length;Ye++){var it=arguments[Ye]!=null?arguments[Ye]:{};Ye%2?ee(Object(it),!0).forEach(function(_t){ae(Ze,_t,it[_t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ze,Object.getOwnPropertyDescriptors(it)):ee(Object(it)).forEach(function(_t){Object.defineProperty(Ze,_t,Object.getOwnPropertyDescriptor(it,_t))})}return Ze}function ae(Ze,Ye,it){return Ye in Ze?Object.defineProperty(Ze,Ye,{value:it,enumerable:!0,configurable:!0,writable:!0}):Ze[Ye]=it,Ze}function Re(Ze,Ye){for(var it=0;it<Ye.length;it++){var _t=Ye[it];_t.enumerable=_t.enumerable||!1,_t.configurable=!0,"value"in _t&&(_t.writable=!0),Object.defineProperty(Ze,_t.key,_t)}}function pe(Ze){var Ye={};return Ze.reduce(function(it,_t){return Ye[_t]||(Ye[_t]=!0,it.push(_t)),it},[])}function he(Ze,Ye){requestAnimationFrame(function(){Ye.enter(),requestAnimationFrame(function(){Ye.active(),setTimeout(function(){Ye.leave()},Ze)})})}function we(Ze,Ye){try{var it=Ze.liElementsById[Ye.parent.id];it.classList.contains("treejs-node__close")||it.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Ye,"parent")&&we(Ze,Ye.parent)}function Ce(Ze,Ye){var it=Ze.liElementsById[Ye.id];it.classList.contains("treejs-node__close")&&it.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Ye,"children")&&Ye.children.forEach(function(_t){return Ce(Ze,_t)})}var Ne=function(){function Ze(At,vt){(function(ut,Nt){if(!(ut instanceof Nt))throw new TypeError("Cannot call a class as a function")})(this,Ze),_e.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=At,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},vt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(ut){this.setValues(pe(ut))}},disables:{get:function(){return this.getDisables()},set:function(ut){this.setDisables(pe(ut))}},selectedNodes:{get:function(){var ut=[],Nt=this.nodesById;return Object.keys(Nt).forEach(function(Qt){if(Object.prototype.hasOwnProperty.call(Nt,Qt)&&(Nt[Qt].status===1||Nt[Qt].status===2)){var Qe=$({},Nt[Qt]);delete Qe.parent,delete Qe.children,ut.push(Qe)}}),ut}},disabledNodes:{get:function(){var ut=[],Nt=this.nodesById;return Object.keys(Nt).forEach(function(Qt){if(Object.prototype.hasOwnProperty.call(Nt,Qt)&&Nt[Qt].disabled){var Qe=$({},Nt[Qt]);delete Qe.parent,ut.push(Qe)}}),ut}}}),this.init(this.options.data)}var Ye,it,_t;return Ye=Ze,_t=[{key:"onSwitcherClick",value:function(At){var vt=At.parentNode,ut=vt.lastChild,Nt=ut.scrollHeight;vt.classList.contains("treejs-node__close")?he(150,{enter:function(){ut.style.height=0,ut.style.opacity=0},active:function(){ut.style.height="".concat(Nt,"px"),ut.style.opacity=1},leave:function(){ut.style.height="",ut.style.opacity="",vt.classList.remove("treejs-node__close")}}):he(150,{enter:function(){ut.style.height="".concat(Nt,"px"),ut.style.opacity=1},active:function(){ut.style.height=0,ut.style.opacity=0},leave:function(){ut.style.height="",ut.style.opacity="",vt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(At){var vt,ut=(vt=At,JSON.parse(JSON.stringify(vt))),Nt={},Qt={},Qe=[],ft=[];return function bt(sn,bn){sn.forEach(function(Un){Nt[Un.id]=Un,Un.checked&&Qe.push(Un.id),Un.disabled&&ft.push(Un.id),bn&&(Un.parent=bn),Un.children&&Un.children.length?bt(Un.children,Un):Qt[Un.id]=Un})}(ut),{treeNodes:ut,nodesById:Nt,leafNodesById:Qt,defaultValues:Qe,defaultDisables:ft}}},{key:"createRootEle",value:function(){var At=document.createElement("div");return At.classList.add("treejs"),At}},{key:"createUlEle",value:function(){var At=document.createElement("ul");return At.classList.add("treejs-nodes"),At}},{key:"createLiEle",value:function(At,vt){var ut=document.createElement("li");if(ut.classList.add("treejs-node"),vt&&ut.classList.add("treejs-node__close"),At.children&&At.children.length){var Nt=document.createElement("span");Nt.classList.add("treejs-switcher"),ut.appendChild(Nt)}else ut.classList.add("treejs-placeholder");var Qt=document.createElement("span");Qt.classList.add("treejs-checkbox"),ut.appendChild(Qt);var Qe=document.createElement("span");Qe.classList.add("treejs-label");var ft=document.createTextNode(At.text);return Qe.appendChild(ft),ut.appendChild(Qe),ut.nodeId=At.id,ut}}],(it=[{key:"init",value:function(At){var vt=Ze.parseTreeData(At),ut=vt.treeNodes,Nt=vt.nodesById,Qt=vt.leafNodesById,Qe=vt.defaultValues,ft=vt.defaultDisables;this.treeNodes=ut,this.nodesById=Nt,this.leafNodesById=Qt,this.render(this.treeNodes);var bt=this.options,sn=bt.values,bn=bt.disables,Un=bt.loaded;sn&&sn.length?this.setValues(sn):Qe&&Qe.length&&this.setValues(Qe),bn&&bn.length?this.setDisables(bn):ft&&ft.length&&this.setDisables(ft),typeof Un=="function"&&Un.call(this)}},{key:"render",value:function(At){var vt=Ze.createRootEle();vt.appendChild(this.buildTree(At,0)),this.bindEvent(vt);var ut=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Nt){for(;Nt.firstChild;)Nt.removeChild(Nt.firstChild)})(ut),ut.appendChild(vt)}},{key:"buildTree",value:function(At,vt){var ut=this,Nt=Ze.createUlEle();return At&&At.length&&At.forEach(function(Qt){var Qe=Ze.createLiEle(Qt,vt===ut.options.closeDepth-1);ut.liElementsById[Qt.id]=Qe;var ft=null;Qt.children&&Qt.children.length&&(ft=ut.buildTree(Qt.children,vt+1)),ft&&Qe.appendChild(ft),Nt.appendChild(Qe)}),Nt}},{key:"bindEvent",value:function(At){var vt=this;At.addEventListener("click",function(ut){var Nt=ut.target;Nt.nodeName==="SPAN"&&Nt.classList.contains("treejs-checkbox")?vt.onItemClick(Nt.parentNode.nodeId):Nt.nodeName==="SPAN"&&Nt.classList.contains("treejs-label")?vt.onItemLabelClick(Nt.parentNode.nodeId):Nt.nodeName==="LI"&&Nt.classList.contains("treejs-node")?vt.onItemClick(Nt.nodeId):Nt.nodeName==="SPAN"&&Nt.classList.contains("treejs-switcher")&&Ze.onSwitcherClick(Nt)},!1)}},{key:"onItemClick",value:function(At){var vt=this.nodesById[At],ut=this.options.onChange;vt.disabled||(this.setValue(At),this.updateLiElements()),ut&&ut.call(this)}},{key:"onItemLabelClick",value:function(At){var vt=this.options.onItemLabelClick;vt&&vt.call(this,At)}},{key:"setValue",value:function(At){var vt=this.nodesById[At];if(vt){var ut=vt.status,Nt=ut===1||ut===2?0:2;vt.status=Nt,this.markWillUpdateNode(vt),this.walkUp(vt,"status"),this.walkDown(vt,"status")}}},{key:"getValues",value:function(){var At=this,vt=[];return Object.keys(this.leafNodesById).forEach(function(ut){Object.prototype.hasOwnProperty.call(At.leafNodesById,ut)&&(At.leafNodesById[ut].status!==1&&At.leafNodesById[ut].status!==2||vt.push(ut))}),vt}},{key:"setValues",value:function(At){var vt=this;this.emptyNodesCheckStatus(),At.forEach(function(Nt){vt.setValue(Nt)}),this.updateLiElements();var ut=this.options.onChange;ut&&ut.call(this)}},{key:"setDisable",value:function(At){var vt=this.nodesById[At];vt&&(vt.disabled||(vt.disabled=!0,this.markWillUpdateNode(vt),this.walkUp(vt,"disabled"),this.walkDown(vt,"disabled")))}},{key:"getDisables",value:function(){var At=this,vt=[];return Object.keys(this.leafNodesById).forEach(function(ut){Object.prototype.hasOwnProperty.call(At.leafNodesById,ut)&&At.leafNodesById[ut].disabled&&vt.push(ut)}),vt}},{key:"setDisables",value:function(At){var vt=this;this.emptyNodesDisable(),At.forEach(function(ut){vt.setDisable(ut)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(At){At.disabled||(At.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(At){At.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(At,vt){var ut=ge(vt,2),Nt=ut[0],Qt=ut[1];return Qt.status!==1&&Qt.status!==2||(At[Nt]=Qt),At},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(At,vt){var ut=ge(vt,2),Nt=ut[0],Qt=ut[1];return Qt.disabled&&(At[Nt]=Qt),At},{})}},{key:"updateLiElements",value:function(){var At=this;Object.values(this.willUpdateNodesById).forEach(function(vt){At.updateLiElement(vt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(At){this.willUpdateNodesById[At.id]=At}},{key:"walkUp",value:function(At,vt){var ut=At.parent;if(ut){if(vt==="status"){var Nt,Qt=ut.children.reduce(function(ft,bt){return Number.isNaN(bt.status)?ft:ft+bt.status},0);if(Nt=Qt?Qt===2*ut.children.length?2:1:0,ut.status===Nt)return;ut.status=Nt}else{var Qe=ut.children.reduce(function(ft,bt){return ft&&bt.disabled},!0);if(ut.disabled===Qe)return;ut.disabled=Qe}this.markWillUpdateNode(ut),this.walkUp(ut,vt)}}},{key:"walkDown",value:function(At,vt){var ut=this;At.children&&At.children.length&&At.children.forEach(function(Nt){vt==="status"&&Nt.disabled||(Nt[vt]=At[vt],ut.markWillUpdateNode(Nt),ut.walkDown(Nt,vt))})}},{key:"updateLiElement",value:function(At){var vt=this.liElementsById[At.id].classList;switch(At.status){case 0:vt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:vt.remove("treejs-node__checked"),vt.add("treejs-node__halfchecked");break;case 2:vt.remove("treejs-node__halfchecked"),vt.add("treejs-node__checked")}switch(At.disabled){case!0:vt.contains("treejs-node__disabled")||vt.add("treejs-node__disabled");break;case!1:vt.contains("treejs-node__disabled")&&vt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var At=this;Object.keys(this.leafNodesById).forEach(function(vt){var ut=At.leafNodesById[vt];we(At,ut)})}},{key:"expandAll",value:function(){Ce(this,this.treeNodes[0])}}])&&Re(Ye.prototype,it),_t&&Re(Ye,_t),Object.defineProperty(Ye,"prototype",{writable:!1}),Ze}()}(),x.default}()},346:function(u,a){(function(s){class v{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(he,we){const Ce=this._eventListeners;Ce[he]===void 0&&(Ce[he]=[]),Ce[he].includes(we)||Ce[he].push(we)}hasEventListener(he,we){const Ce=this._eventListeners;return Ce[he]!==void 0&&Ce[he].includes(we)}removeEventListener(he,we){const Ce=this._eventListeners[he];if(Ce!==void 0){const Ne=Ce.indexOf(we);Ne!==-1&&Ce.splice(Ne,1)}}dispatchEvent(he){const we=this._eventListeners[he.type];if(we!==void 0){he.target=this;const Ce=we.slice(0);for(let Ne=0,Ze=Ce.length;Ne<Ze;Ne++)Ce[Ne].call(this,he)}}}function x(){return(typeof performance>"u"?Date:performance).now()}class M{constructor(he=M.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(he)}setDecayTime(he){this.naturalFrequency=1/Math.max(M.MIN_DECAY_MILLISECONDS,he)}update(he,we,Ce,Ne){const Ze=2e-4*this.naturalFrequency;if(he==null||Ne===0||he===we&&this.velocity===0)return we;if(Ce<0)return he;const Ye=he-we,it=this.velocity+this.naturalFrequency*Ye,_t=Ye+Ce*it,At=Math.exp(-this.naturalFrequency*Ce),vt=(it-this.naturalFrequency*_t)*At,ut=-this.naturalFrequency*(vt+it*At);return Math.abs(vt)<Ze*Math.abs(Ne)&&ut*Ye>=0?(this.velocity=0,we):(this.velocity=vt,we+_t*At)}}async function I(pe){return new Promise((he,we)=>{const Ce=new Image;Ce.onload=()=>he(Ce),Ce.onerror=we,Ce.crossOrigin="anonymous",Ce.decoding="sync",Ce.src=pe})}function B(pe,he=document.head){const we=document.createElement("style");return we.type="text/css",we.innerText=pe,he==null||he.appendChild(we),we}M.SETTLING_TIME=1e4,M.MIN_DECAY_MILLISECONDS=.001,M.DECAY_MILLISECONDS=50;const U={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function j(pe){return pe.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function te(pe,he,we){return pe.replace(new RegExp(j(he),"g"),we)}const Z=(pe,...he)=>String.raw({raw:pe},...he),oe=(pe,...he)=>{let we=String.raw({raw:pe},...he);return we=te(we,"%","%25"),we=te(we,"> <","><"),we=te(we,"; }",";}"),we=te(we,"<","%3c"),we=te(we,">","%3e"),we=te(we,'"',"'"),we=te(we,"#","%23"),we=te(we,"{","%7b"),we=te(we,"}","%7d"),we=te(we,"|","%7c"),we=te(we,"^","%5e"),we=te(we,"`","%60"),we=te(we,"@","%40"),we=te(we,"&","&amp;"),we=te(we,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+we};function le(pe,he){const we=window.URL.createObjectURL(pe),Ce=document.createElement("a");Ce.style.display="none",Ce.href=we,Ce.download=he,document.body.appendChild(Ce),Ce.click(),setTimeout(()=>{document.body.removeChild(Ce),window.URL.revokeObjectURL(we)},1e3)}async function se(pe){return new Promise((he,we)=>{const Ce=new FileReader;Ce.onload=Ne=>he(Ce.result),Ce.onerror=Ne=>we(Ce.error),Ce.onabort=Ne=>we(new Error("Read aborted")),Ce.readAsDataURL(pe)})}function ve(pe,he){let we;do we=Object.getOwnPropertyDescriptor(pe,he);while(!we&&(pe=Object.getPrototypeOf(pe)));return we}function ce(pe,he,we=!0,Ce=!1){const Ne=ve(pe,he);return!!(Ne!=null&&Ne.set)||we&&(Ne==null?void 0:Ne.writable)!==!1&&(Ne==null?void 0:Ne.get)===void 0||Ce&&!Ne}function K(pe,he,we,Ce=!0,Ne=!1){return!(!pe||!ce(pe,he,Ce,Ne)||(pe[he]=we,0))}function X(pe,he){for(let we=pe.length-1;we>=0;we--)if(he(pe[we]))return we;return-1}const W={priority:1/0,serialize:(pe,he)=>Object.fromEntries(Object.entries(pe).map(([we,Ce])=>[we,_e.Serialize(Ce,he,!1)])),deserialize:(pe,he,we)=>Object.assign(he||{},Object.fromEntries(Object.entries(pe).map(([Ce,Ne])=>[Ce,_e.Deserialize(Ne,he==null?void 0:he[Ce],we,!1)]))),isType:pe=>(pe.constructor||Object)===Object};class _e{static GetSerializer(he){return _e.Serializers.find(we=>we.isType(he))}static RegisterSerializer(...he){var we;for(const Ce of he){const Ne=(we=Ce.priority)!==null&&we!==void 0?we:1e10,Ze=X(_e.Serializers,Ye=>Ye.priority!==void 0&&Ye.priority<Ne);Ze>=0?_e.Serializers.splice(Ze+1,0,Ce):_e.Serializers.push(Ce)}}static UnregisterSerializer(...he){for(const we of he){const Ce=_e.Serializers.indexOf(we);Ce>=0&&_e.Serializers.splice(Ce,1)}}static Serialize(he,we,Ce=!1){var Ne,Ze;if(typeof he=="function")return;if(!Ce){const _t=_e.GetSerializer(he);if(_t)return _t.serialize(he,we);if(typeof he.toJSON=="function"){const At=he.toJSON(we);return he.serializableClassId&&At&&(At.serializableClassId=he.serializableClassId),At}}let Ye=(Ne=he.constructor)!==null&&Ne!==void 0?Ne:Object;const it={};for(;Ye&&Ye!==Object;){const _t=(Ze=_e.TypeMap.get(Ye))!==null&&Ze!==void 0?Ze:[];for(const[At,vt]of _t)it[At]=_e.Serialize(he[vt],we,!1);Ye=Object.getPrototypeOf(Ye)}return he.serializableClassId&&(it.serializableClassId=he.serializableClassId),it}static Deserialize(he,we,Ce,Ne=!1){var Ze,Ye;if(he===void 0||we===he)return we;if(he&&typeof he=="object"&&(he.constructor||Object)===Object&&he.resource&&typeof he.resource=="string"&&he.uuid){const _t=Ce==null?void 0:Ce[he.resource];if(!_t)return console.warn(`Resource ${he.resource} not found`),we;if(typeof(he=_t[he.uuid])=="object"&&(he.__useCount=he.__useCount?he.__useCount+1:1),he||console.warn(`Resource ${he.resource} with uuid ${he.uuid} not found`),we===he)return we;if(he&&typeof he=="object"){if((he.constructor||Object)!==Object)return we&&console.warn("replacing object",we,"with deserialized object from meta",he),he;console.error("Deserialize; meta should only have class instances, not js objects",he,we,Ce)}}if(he&&typeof he=="object"&&(he.constructor||Object)!==Object&&!Array.isArray(he)&&console.warn("Data might already be deserialized. It will be cloned, or copied to source",he,"source",we,he.constructor,he.constructor!==Object),he&&typeof he=="object")if(!he.serializableClassId||we&&we.serializableClassId===he.serializableClassId)(he.constructor||Object)!==Object||we?Array.isArray(he)&&!we&&(we=[]):we={};else{const _t=_e.SerializableClasses.get(he.serializableClassId);_t&&(we=_t.DataInConstructor?new _t(he):new _t)}if(typeof we=="function")return console.error("cannot deserialize over function",we,he),we;if(!Ne){const _t=_e.GetSerializer(he);if(_t&&_t!==W)return _t.deserialize(he,we,Ce)}if(!he||we==null||typeof we!="object")return he;if(!Ne&&typeof(we==null?void 0:we.fromJSON)=="function")return we.fromJSON(he,Ce),we;let it=(Ze=we.constructor)!==null&&Ze!==void 0?Ze:Object;if(it===Object)return W.deserialize(he,we,Ce);for(;it&&it!==Object;){const _t=(Ye=_e.TypeMap.get(it))!==null&&Ye!==void 0?Ye:[];for(const[At,vt]of _t){const ut=we[vt],Nt=_e.Deserialize(he[At],ut,Ce,!1);Nt!==ut&&K(we,vt,Nt,!0)}it=Object.getPrototypeOf(it)}return we}}function ge(pe,he="param"){if(!pe)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(we,Ce)=>{Object.defineProperty(we,Ce,{get(){return this[`_oc_${Ce}`]},set(Ne){var Ze;const Ye=this[`_oc_${Ce}`];if(Ye===Ne)return;this[`_oc_${Ce}`]=Ne;const it=he==="param"?[Ce,Ne,Ye]:he==="object"?[{key:Ce,value:Ne,oldValue:Ye}]:"";if(typeof pe=="string")(Ze=this[pe])===null||Ze===void 0||Ze.call(this,...it);else if(typeof pe=="function"){let _t=!1;if(pe.name){let At=this;for(;At;){if(At[pe.name]===pe){pe.call(this,...it),_t=!0;break}At=Object.getPrototypeOf(At)}}_t||(pe.name&&this[pe.name].name===`bound ${pe.name}`?this[pe.name](...it):pe(...it))}}})}}function Ae(pe,{backgroundColor:he="",scale:we=1,width:Ce=512,height:Ne=512}){const Ze=document.createElement("canvas"),Ye=Ze.getContext("2d"),it=we,_t=Ce,At=Ne;return Ze.width=_t*it,Ze.height=At*it,Ze.style.width=`${_t}`,Ze.style.height=`${At}`,(he==null?void 0:he.length)>0&&(Ye.fillStyle=he,Ye.fillRect(0,0,Ze.width,Ze.height)),Ye.drawImage(pe,0,0,Ze.width,Ze.height),Ze}_e.TypeMap=new Map,_e.SerializableClasses=new Map,_e.Serializers=[{priority:0,isType:pe=>Array.isArray(pe),serialize:(pe,he)=>pe.map(we=>_e.Serialize(we,he,!1)),deserialize:(pe,he,we)=>{const Ce=pe.length;Array.isArray(he)||(he=[]);for(let Ne=0;Ne<Ce;Ne++){const Ze=pe[Ne],Ye=he.length>Ne?_e.Deserialize(Ze,he[Ne],we,!1):_e.Deserialize(Ze,void 0,we,!1);he.length<=Ne?he.push(Ye):he[Ne]=Ye}return he}},{priority:0,isType:pe=>!pe||typeof pe!="object",serialize:pe=>{if(pe&&typeof pe=="number"){if(pe===1/0)return"Infinity";if(pe===-1/0)return"-Infinity";if(isNaN(pe))return"NaN"}return pe},deserialize:(pe,he)=>{if(typeof he=="number"){if(pe==="Infinity")return 1/0;if(pe==="-Infinity")return-1/0;if(pe==="NaN")return NaN;if(typeof pe=="number"||!pe)return pe}return pe}},W];const ee=async(pe,he)=>Ae(await I(pe),he),$=async(pe,he)=>await ee(pe,he).then(we=>we.toDataURL("image/png")),ae=async pe=>se(await(await fetch(pe)).blob());function Re(pe,he,{width:we,height:Ce},Ne=!0){const Ze=`
<svg viewBox="0 0 ${we} ${Ce}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${he}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${pe}
        </div>
    </foreignObject>
</svg>
    `;return Ne?oe(Ze):Ze}s.Damper=M,s.LinearToSRGB=function(pe){return pe<.0031308?12.92*pe:1.055*Math.pow(pe,.41666)-.055},s.PointerDragHelper=class extends v{constructor(){super(...arguments),this._onPointerDown=pe=>{if(pe.button!==0||!this._element)return;this._pointerUp=void 0;const he=pe.clientX/this._element.clientWidth*2-1,we=-pe.clientY/this._element.clientHeight*2+1,Ce=x();this._pointerDown={x:he,y:we,time:Ce},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=pe=>{if(!this._pointerDown||!this._pointer||!this._element)return;const he=pe.clientX/this._element.clientWidth*2-1,we=-pe.clientY/this._element.clientHeight*2+1,Ce=x();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:he-this._pointerDown.x,y:we-this._pointerDown.y,time:Ce-this._pointerDown.time},delta:{x:he-this._pointer.x,y:we-this._pointer.y,time:Ce-this._pointer.time}}),this._pointer={x:he,y:we,time:x()},pe.buttons%2==0&&this._onPointerUp(pe)},this._onPointerUp=pe=>{if(pe.button!==0||!this._pointerDown||!this._element)return;const he=pe.clientX/this._element.clientWidth*2-1,we=-pe.clientY/this._element.clientHeight*2+1,Ce=x();this._pointerUp={x:he,y:we,time:Ce},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(pe){this._element!==pe&&(this._element&&this._removeElement(),this._element=pe,this._element&&this._addElement())}_removeElement(){var pe,he,we,Ce,Ne;(pe=this._element)===null||pe===void 0||pe.removeEventListener("pointerdown",this._onPointerDown),(he=this._element)===null||he===void 0||he.removeEventListener("pointermove",this._onPointerMove),(we=this._element)===null||we===void 0||we.removeEventListener("pointerup",this._onPointerUp),(Ce=this._element)===null||Ce===void 0||Ce.removeEventListener("pointercancel",this._onPointerUp),(Ne=this._element)===null||Ne===void 0||Ne.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var pe,he,we,Ce,Ne;(pe=this._element)===null||pe===void 0||pe.addEventListener("pointerdown",this._onPointerDown),(he=this._element)===null||he===void 0||he.addEventListener("pointermove",this._onPointerMove),(we=this._element)===null||we===void 0||we.addEventListener("pointerup",this._onPointerUp),(Ce=this._element)===null||Ce===void 0||Ce.addEventListener("pointercancel",this._onPointerUp),(Ne=this._element)===null||Ne===void 0||Ne.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},s.SRGBToLinear=function(pe){return pe<.04045?.0773993808*pe:Math.pow(.9478672986*pe+.0521327014,2.4)},s.Serialization=_e,s.SimpleEventDispatcher=v,s.TYPED_ARRAYS=U,s.absMax=function(pe,he){return Math.abs(pe)>Math.abs(he)?pe:he},s.aesGcmDecrypt=async function(pe,he){const we=typeof he=="string"?new TextEncoder().encode(he):he,Ce=await crypto.subtle.digest("SHA-256",we),Ne=pe.slice(0,12),Ze={name:"AES-GCM",iv:typeof Ne=="string"?new Uint8Array(Array.from(Ne).map(At=>At.charCodeAt(0))):Ne},Ye=await crypto.subtle.importKey("raw",Ce,Ze,!1,["decrypt"]),it=pe.slice(12),_t=typeof it=="string"?new Uint8Array(Array.from(it).map(At=>At.charCodeAt(0))):it;try{const At=await crypto.subtle.decrypt(Ze,Ye,_t);return typeof pe=="string"?new TextDecoder().decode(At):new Uint8Array(At)}catch{throw new Error("Decrypt failed")}},s.aesGcmEncrypt=async function(pe,he,we){const Ce=typeof he=="string"?new TextEncoder().encode(he):he,Ne=await crypto.subtle.digest("SHA-256",Ce),Ze=crypto.getRandomValues(new Uint8Array(12)),Ye=Array.from(Ze).map(bt=>String.fromCharCode(bt)).join(""),it={name:"AES-GCM",iv:Ze},_t=await crypto.subtle.importKey("raw",Ne,it,!1,["encrypt"]),At=typeof pe=="string"?new TextEncoder().encode(pe):pe,vt=await crypto.subtle.encrypt(it,_t,At),ut=new Uint8Array(vt),Nt=Array.from(ut),Qt=Nt.map(bt=>String.fromCharCode(bt)).join(""),Qe=we?typeof we=="string"?we:new TextDecoder().decode(we):"",ft=we?typeof we=="string"?new TextEncoder().encode(we):Array.from(we):[];return typeof pe=="string"?Qe+Ye+Qt:new Uint8Array([...ft,...Ze,...Nt])},s.arrayBufferToBase64=function(pe){if(!window)return console.warn("window is required"),"";let he="";const we=new Uint8Array(pe),Ce=we.byteLength;for(let Ne=0;Ne<Ce;Ne++)he+=String.fromCharCode(we[Ne]);return window.btoa(he)},s.base64ToArrayBuffer=function(pe){if(!window)return console.warn("window is required"),new Uint8Array(0);const he=window.atob(pe),we=he.length,Ce=new Uint8Array(we);for(let Ne=0;Ne<we;Ne++)Ce[Ne]=he.charCodeAt(Ne);return Ce.buffer},s.blobToDataURL=se,s.canvasFlipY=function(pe){const he=document.createElement("canvas");he.width=pe.width,he.height=pe.height;const we=he.getContext("2d");if(!we)throw new Error("Unable to get 2d context");return we.translate(0,pe.height),we.scale(1,-1),we.drawImage(pe,0,0),he},s.clearBit=function(pe,he){return pe&~(1<<he)},s.colorToDataUrl=function(pe,he=1,we=1){const Ce=document.createElement("canvas");Ce.width=he,Ce.height=we;const Ne=Ce.getContext("2d");Ne.fillStyle="#"+pe,Ne.fillRect(0,0,he,we);const Ze=Ce.toDataURL();return Ce.remove(),Ze},s.copyProps=function(pe,he,we){for(const Ce of we){const Ne=pe[Ce];Ne!==void 0&&K(he,Ce,Ne,!0)}return he},s.createCanvasElement=function(){const pe=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return pe.style.display="block",pe},s.createDiv=function({innerHTML:pe="",id:he,classList:we,addToBody:Ce=!0,elementTag:Ne="div"}){const Ze=document.createElement(Ne);return he&&(Ze.id=he),Ze.innerHTML=pe,we&&Ze.classList.add(...we),Ce&&document.body.appendChild(Ze),Ze},s.createImage=I,s.createScriptFromURL=async function(pe,he=document.head){return new Promise((we,Ce)=>{const Ne=document.createElement("script");Ne.setAttribute("src",pe),Ne.addEventListener("load",()=>we(Ne)),Ne.addEventListener("error",Ce),he.appendChild(Ne)})},s.createStyles=B,s.css=Z,s.deepAccessObject=function(pe,he,we=!1){for(typeof pe=="string"&&(pe=pe.split("."));pe.length>0;){if(!he)return;const Ce=pe.splice(0,1)[0];if(!(Ce.length<1)){if(!(Ce in he)){if(we)throw new Error("invalid access, check "+Ce+" in "+he);return}he=he[Ce]}}return he},s.downloadBlob=le,s.downloadFile=function(pe,he){return le(pe,he??pe.name)},s.embedUrlRefs=async function(pe,he=ae){const we=pe.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(we)for(const Ce of we){const Ne=await he(Ce);pe=pe.replace(Ce,Ne)}return pe},s.escapeRegExp=j,s.getFileHandle=function(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(pe=>pe[0]):window.chooseFileSystemEntries()},s.getFilenameFromPath=function(pe){return pe.substring(pe.lastIndexOf("/")+1)},s.getKeyByValue=function(pe,he){return Object.keys(pe).find(we=>pe[we]===he)},s.getNewFileHandle=function(){if("showSaveFilePicker"in window){const pe={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(pe)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})},s.getOrCall=function(pe,...he){return typeof pe=="function"&&(pe=pe(...he)),pe},s.getPropertyDescriptor=ve,s.getTypedArray=function(pe,he){return new U[pe](he)},s.getUrlQueryParam=function(pe,he=null){var we;return(we=new URL(window.location.href).searchParams.get(pe))!==null&&we!==void 0?we:he},s.glsl=(pe,...he)=>String.raw({raw:pe},...he),s.html=(pe,...he)=>String.raw({raw:pe},...he),s.htmlToCanvas=async function(pe,he,we){const Ce=Re(pe,he,we);return await ee(Ce,we)},s.htmlToPng=async function(pe,he,we){const Ce=Re(pe,he,we);return await $(Ce,we)},s.htmlToSvg=Re,s.imageBitmapToBase64=function(pe,he=8192,we=!1){var Ce;if(!pe.width||!pe.height)return"";const Ne=document.createElement("canvas");Ne.width=Math.min(he,pe.width),Ne.height=Math.floor(1+Ne.width*pe.height/pe.width);const Ze=pe instanceof ImageBitmap,Ye=Ze&&we&&Math.abs(Ne.width-pe.width)<.5?Ne.getContext("bitmaprenderer"):void 0;Ye?Ye.transferFromImageBitmap(pe):(Ce=Ne.getContext("2d"))===null||Ce===void 0||Ce.drawImage(pe,0,0,Ne.width,Ne.height);const it=Ne.toDataURL("image/png");return Ne.remove(),Ze&&we&&pe.close(),it},s.imageDataToCanvas=function(pe){const he=document.createElement("canvas");return he.width=pe.width,he.height=pe.height,he.getContext("2d").putImageData(pe,0,0),he},s.imageToCanvas=Ae,s.imageUrlToImageData=async function(pe){return new Promise((he,we)=>{const Ce=new Image;Ce.addEventListener("load",()=>{const Ne=document.createElement("canvas");Ne.width=Ce.width,Ne.height=Ce.height;const Ze=Ne.getContext("2d");if(!Ze)return void we(new Error("Could not get 2d context"));Ze.drawImage(Ce,0,0,Ne.width,Ne.height);const Ye=Ze.getImageData(0,0,Ne.width,Ne.height);he(Ye),Ne.remove(),Ce.remove()},!1),Ce.addEventListener("error",Ne=>{Ce.remove(),we(Ne)},!1),Ce.src=pe})},s.includesAll=function(pe,he){for(const we of he)if(!pe.includes(we))return!1;return!0},s.isPropertyWritable=ce,s.isWebpExportSupported=function(){const pe=document.createElement("canvas");return!(!pe.getContext||!pe.getContext("2d"))&&pe.toDataURL("image/webp").startsWith("data:image/webp")},s.longestCommonPrefix=function(pe){return pe.sort(),pe[0].split("").map((he,we)=>pe[pe.length-1][we]===he?he:"\0").join("").split("\0").at(0)||""},s.makeColorSvg=pe=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${pe}'/%3E%3C/svg%3E%0A`,s.makeColorSvgCircle=pe=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${pe}'/%3E%3C/svg%3E%0A`,s.makeTextSvg=pe=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${pe}%3C/text%3E%3C/svg%3E%0A`,s.mobileAndTabletCheck=function(){let pe=!1;var he;return he=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(he)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(he.substr(0,4)))&&(pe=!0),pe},s.now=x,s.objectHasOwn=function(pe,he){return Object.hasOwn?Object.hasOwn(pe,he):pe.hasOwnProperty(he)},s.onChange=ge,s.onChange2=function(pe,he="void"){if(!pe)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ge(pe,he)},s.onChange3=function(pe,he="object"){if(!pe)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return ge(pe,he)},s.parseFileExtension=function(pe){var he;if(!pe||pe===""||pe.match(/__MACOSX\/.*\._/))return"";const we=(he=(pe=pe.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&he!==void 0?he:"",Ce=we.lastIndexOf(".");return we===""||Ce<1?"":we.slice(Ce+1)},s.pathJoin=function(pe,he="/"){return pe.join(he)},s.prettyScrollbar=function(pe=document.head){return B(Z`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,pe)},s.readFile=function(pe){return pe.text?pe.text():function(he){return new Promise(we=>{const Ce=new FileReader;Ce.addEventListener("loadend",Ne=>{const Ze=Ne.srcElement.result;we(Ze)}),Ce.readAsText(he)})}(pe)},s.remoteWorkerURL=function(pe,he){const we=(he?`var Module = { locateFile: function(s) { return "${he}"; } }; 
`:"")+`importScripts( "${pe}" );`;return URL.createObjectURL(new Blob([we],{type:"text/javascript"}))},s.replaceAll=te,s.safeSetProperty=K,s.serializable=function(pe){return he=>(he=class extends he{constructor(){super(...arguments),this.serializableClassId=pe}},_e.SerializableClasses.set(pe,he),he)},s.serialize=function(pe){return(he,we)=>{const Ce=he.constructor;if(Ce===Object)throw new Error("All properties in an object are serialized by default");_e.TypeMap.has(Ce)||_e.TypeMap.set(Ce,[]),_e.TypeMap.get(Ce).push([pe||we,we])}},s.setUrlQueryParam=function(pe,he,we=!1){const Ce=new URLSearchParams(location.search);he==null?Ce.has(pe)&&Ce.delete(pe):Ce.set(pe,he),we?window.location.search=Ce.toString():window.history.replaceState({},"","?"+Ce.toString())},s.svgToCanvas=ee,s.svgToPng=$,s.svgUrl=oe,s.timeout=async function(pe){return new Promise(he=>setTimeout(he,Math.max(0,pe)))},s.toTitleCase=function(pe){return pe.replace(/\w\S*/g,function(he){return he.charAt(0).toUpperCase()+he.substr(1).toLowerCase()})},s.updateBit=function(pe,he,we){return pe&~(1<<he)|(we?1:0)<<he},s.uploadFile=async function(pe=!1,he=!1,we){const Ce=document.createElement("input");Ce.type="file",Ce.multiple=pe,Ce.accept=we||"*",Ce.webkitdirectory=he,Ce.style.display="none",document.body.appendChild(Ce),Ce.click();const Ne=await new Promise(Ze=>{Ce.onchange=Ye=>{Ze(Array.from(Ce.files||[]))}});return document.body.removeChild(Ce),Ne},s.verifyPermission=async function(pe,he){const we={};return he&&(we.writable=!0,we.mode="readwrite"),await pe.queryPermission(we)==="granted"||await pe.requestPermission(we)==="granted"},s.writeFile=async function(pe,he){if(pe.createWriter){const Ce=await pe.createWriter();return await Ce.write(0,he),void await Ce.close()}const we=await pe.createWritable();await we.write(he),await we.close()}})(a)},819:function(u,a){(function(s){const v="tp";function x(Ae){return ee=>$=>{if(!ee&&$===void 0)return{succeeded:!1,value:void 0};if(ee&&$===void 0)return{succeeded:!0,value:void 0};const ae=Ae($);return ae!==void 0?{succeeded:!0,value:ae}:{succeeded:!1,value:void 0}}}function M(Ae){return{custom:ee=>x(ee)(Ae),boolean:x(ee=>typeof ee=="boolean"?ee:void 0)(Ae),number:x(ee=>typeof ee=="number"?ee:void 0)(Ae),string:x(ee=>typeof ee=="string"?ee:void 0)(Ae),function:x(ee=>typeof ee=="function"?ee:void 0)(Ae),constant:ee=>x($=>$===ee?ee:void 0)(Ae),raw:x(ee=>ee)(Ae),object:ee=>x($=>{if((ae=$)!==null&&typeof ae=="object")return function(Re,pe){return Object.keys(pe).reduce((he,we)=>{if(he===void 0)return;const Ce=(0,pe[we])(Re[we]);return Ce.succeeded?Object.assign(Object.assign({},he),{[we]:Ce.value}):void 0},{})}($,ee);var ae})(Ae),array:ee=>x($=>{if(Array.isArray($))return ae=ee,$.reduce((Re,pe)=>{if(Re===void 0)return;const he=ae(pe);return he.succeeded&&he.value!==void 0?[...Re,he.value]:void 0},[]);var ae})(Ae)}}const I={optional:M(!0),required:M(!1)};function B(Ae){return ee=>ee.toFixed(Math.max(Math.min(Ae,20),0))}function U(Ae){return[Ae[0],Ae[1],Ae[2]]}function j(Ae){return ee=>function($,ae){const Re=B(ae==="float"?2:0);return`rgb(${U($.getComponents("rgb",ae)).map(pe=>Re(pe)).join(", ")})`}(ee,Ae)}function te(Ae){return ee=>function($,ae){const Re=B(2),pe=B(ae==="float"?2:0);return`rgba(${$.getComponents("rgb",ae).map((he,we)=>(we===3?Re:pe)(he)).join(", ")})`}(ee,Ae)}function Z(Ae){return ee=>function($,ae){const Re=B(ae==="float"?2:0),pe=["r","g","b"];return`{${U($.getComponents("rgb",ae)).map((he,we)=>`${pe[we]}: ${Re(he)}`).join(", ")}}`}(ee,Ae)}function oe(Ae){return ee=>function($,ae){const Re=B(2),pe=B(ae==="float"?2:0),he=["r","g","b","a"];return`{${$.getComponents("rgb",ae).map((we,Ce)=>`${he[Ce]}: ${(Ce===3?Re:pe)(we)}`).join(", ")}}`}(ee,Ae)}function le(Ae,ee,$,ae){return new($||($=Promise))(function(Re,pe){function he(Ne){try{Ce(ae.next(Ne))}catch(Ze){pe(Ze)}}function we(Ne){try{Ce(ae.throw(Ne))}catch(Ze){pe(Ze)}}function Ce(Ne){var Ze;Ne.done?Re(Ne.value):(Ze=Ne.value,Ze instanceof $?Ze:new $(function(Ye){Ye(Ze)})).then(he,we)}Ce((ae=ae.apply(Ae,ee||[])).next())})}function se(Ae){return le(this,void 0,void 0,function*(){const ee=new Image;return ee.crossOrigin="anonymous",new Promise(($,ae)=>{ee.src=Ae,ee.onload=()=>{$(ee)},ee.onerror=ae})})}["int","float"].reduce((Ae,ee)=>[...Ae,{format:{alpha:!1,mode:"rgb",notation:"func",type:ee},stringifier:j(ee)},{format:{alpha:!0,mode:"rgb",notation:"func",type:ee},stringifier:te(ee)},{format:{alpha:!1,mode:"rgb",notation:"object",type:ee},stringifier:Z(ee)},{format:{alpha:!0,mode:"rgb",notation:"object",type:ee},stringifier:oe(ee)}],[]);const ve=(ce="img",(Ae,ee)=>[v,"-",ce,"v",Ae?`_${Ae}`:"",ee?`-${ee}`:""].join(""));var ce;class K{constructor(ee,$){this.element=ee.createElement("div"),this.element.classList.add(ve()),$.viewProps.bindClassModifiers(this.element),this.input=ee.createElement("input"),this.input.classList.add(ve("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",$.extensions.join(",")),this.image_=ee.createElement("img"),this.image_.classList.add(ve("image")),this.image_.classList.add(ve(`image_${$.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=ae=>{$.clickCallback?$.clickCallback(ae,this.input):this.input.click()},this.element.classList.add(ve("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(ee){this.image_.src=ee}changeDraggingState(ee){const $=this.element;ee?$==null||$.classList.add(ve("area_dragging")):$==null||$.classList.remove(ve("area_dragging"))}}let X=null;class W{constructor(ee,$){this.value=$.value,this.viewProps=$.viewProps,this.view=new K(ee,{viewProps:this.viewProps,extensions:$.extensions,imageFit:$.imageFit,clickCallback:$.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(ee){const $=(ee==null?void 0:ee.target).files;if(!$||!$.length)return;const ae=$[0];this.setValue(ae)}onDrop(ee){return le(this,void 0,void 0,function*(){ee.preventDefault();try{const{dataTransfer:$}=ee,ae=$==null?void 0:$.files[0];if(ae)this.setValue(ae);else{const Re=$==null?void 0:$.getData("url");if(!Re)throw new Error("No url");this.setValue(Re)}}catch($){console.error("Could not parse the dropped image",$)}finally{this.view.changeDraggingState(!1)}})}onDragOver(ee){ee.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(ee){return le(this,void 0,void 0,function*(){ee instanceof HTMLImageElement?this.updateImage(ee.src):typeof ee!="string"&&ee?yield this.setValue(ee):(ee!=="placeholder"&&ee||(ee=(yield this.handlePlaceholderImage()).src),this.updateImage(ee))})}updateImage(ee){this.view.changeImage(ee)}setValue(ee){return le(this,void 0,void 0,function*(){if(ee instanceof HTMLImageElement)this.value.setRawValue(ee);else if(ee instanceof File){const $=URL.createObjectURL(ee)+"#"+ee.name;ee.src=$;const ae=yield se($).catch(()=>{});this.value.setRawValue(ae||ee)}else ee?this.value.setRawValue(yield se(ee)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return le(this,void 0,void 0,function*(){return X||(X=yield function(){const ee=document.createElement("canvas");ee.width=320,ee.height=50;const $=ee.getContext("2d");return $.fillStyle="#00000004",$.fillRect(0,0,ee.width,ee.height),$.fillStyle="#eee",$.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',$.textAlign="center",$.textBaseline="middle",$.fillText("No image",.5*ee.width,.5*ee.height),new Promise(ae=>{ee.toBlob(Re=>{const pe=new Image;pe.src=URL.createObjectURL(Re),pe.isPlaceholder=!0,pe.onload=()=>{ae(pe)}})})}()),X})}}const _e=[".jpg",".png",".gif"],ge={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(Ae,ee){if(!(Ae instanceof HTMLImageElement||typeof Ae=="string"))return null;const $=I,ae=function(Re,pe){const he=I.required.object(pe)(Re);return he.succeeded?he.value:void 0}(ee,{view:$.required.constant("input-image"),acceptUrl:$.optional.boolean,clickCallback:$.optional.function,imageFit:$.optional.custom(Re=>Re==="contain"||Re==="cover"?Re:void 0),extensions:$.optional.array($.required.string)});return ae?{initialValue:Ae,params:ae}:null},binding:{reader(Ae){return ee=>ee.src!==void 0?ee.src===""?"placeholder":ee.src:ee},writer(Ae){return(ee,$)=>{ee.write($)}}},controller(Ae){var ee,$;return new W(Ae.document,{value:Ae.value,imageFit:(ee=Ae.params.imageFit)!==null&&ee!==void 0?ee:"cover",clickCallback:Ae.params.clickCallback,viewProps:Ae.viewProps,extensions:($=Ae.params.extensions)!==null&&$!==void 0?$:_e})}};s.plugin=ge,Object.defineProperty(s,"__esModule",{value:!0})})(a)},665:function(u,a){(function(s){class v{constructor(T){this.controller_=T}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(T){this.controller_.viewProps.set("disabled",T)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(T){this.controller_.viewProps.set("hidden",T)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class x{constructor(T){this.target=T}}class M extends x{constructor(T,F,de,Fe){super(T),this.value=F,this.presetKey=de,this.last=Fe==null||Fe}}class I extends x{constructor(T,F,de){super(T),this.value=F,this.presetKey=de}}class B extends x{constructor(T,F){super(T),this.expanded=F}}class U extends x{constructor(T,F){super(T),this.index=F}}function j(ie){return ie==null}function te(ie,T){if(ie.length!==T.length)return!1;for(let F=0;F<ie.length;F++)if(ie[F]!==T[F])return!1;return!0}function Z(ie,T){let F=ie;do{const de=Object.getOwnPropertyDescriptor(F,T);if(de&&(de.set!==void 0||de.writable===!0))return!0;F=Object.getPrototypeOf(F)}while(F!==null);return!1}const oe={alreadydisposed:()=>"View has been already disposed",invalidparams:ie=>`Invalid parameters for '${ie.name}'`,nomatchingcontroller:ie=>`No matching controller for '${ie.key}'`,nomatchingview:ie=>`No matching view for '${JSON.stringify(ie.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:ie=>`Property '${ie.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class le{static alreadyDisposed(){return new le({type:"alreadydisposed"})}static notBindable(){return new le({type:"notbindable"})}static propertyNotFound(T){return new le({type:"propertynotfound",context:{name:T}})}static shouldNeverHappen(){return new le({type:"shouldneverhappen"})}constructor(T){var F;this.message=(F=oe[T.type](T.context))!==null&&F!==void 0?F:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=T.type}}class se{constructor(T,F,de){this.obj_=T,this.key_=F,this.presetKey_=de??F}static isBindable(T){return T!==null&&typeof T=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(T){this.obj_[this.key_]=T}writeProperty(T,F){const de=this.read();if(!se.isBindable(de))throw le.notBindable();if(!(T in de))throw le.propertyNotFound(T);de[T]=F}}class ve extends v{get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}get title(){var T;return(T=this.controller_.valueController.props.get("title"))!==null&&T!==void 0?T:""}set title(T){this.controller_.valueController.props.set("title",T)}on(T,F){const de=F.bind(this);return this.controller_.valueController.emitter.on(T,()=>{de(new x(this))}),this}}class ce{constructor(){this.observers_={}}on(T,F){let de=this.observers_[T];return de||(de=this.observers_[T]=[]),de.push({handler:F}),this}off(T,F){const de=this.observers_[T];return de&&(this.observers_[T]=de.filter(Fe=>Fe.handler!==F)),this}emit(T,F){const de=this.observers_[T];de&&de.forEach(Fe=>{Fe.handler(F)})}}const K="tp";function X(ie){return(T,F)=>[K,"-",ie,"v",T?`_${T}`:"",F?`-${F}`:""].join("")}function W(ie){return ie.rawValue}function _e(ie,T){var F,de;ie.emitter.on("change",(F=W,de=T,Fe=>de(F(Fe)))),T(ie.rawValue)}function ge(ie,T,F){_e(ie.value(T),F)}function Ae(ie,T){return F=>{(function(de,Fe,Mt){Mt?de.classList.add(Fe):de.classList.remove(Fe)})(ie,T,F)}}function ee(ie,T){_e(ie,F=>{T.textContent=F??""})}const $=X("btn");class ae{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add($()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("button");de.classList.add($("b")),F.viewProps.bindDisabled(de),this.element.appendChild(de),this.buttonElement=de;const Fe=T.createElement("div");Fe.classList.add($("t")),ee(F.props.value("title"),Fe),this.buttonElement.appendChild(Fe)}}class Re{constructor(T,F){this.emitter=new ce,this.onClick_=this.onClick_.bind(this),this.props=F.props,this.viewProps=F.viewProps,this.view=new ae(T,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class pe{constructor(T,F){var de;this.constraint_=F==null?void 0:F.constraint,this.equals_=(de=F==null?void 0:F.equals)!==null&&de!==void 0?de:(Fe,Mt)=>Fe===Mt,this.emitter=new ce,this.rawValue_=T}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(T){this.setRawValue(T,{forceEmit:!1,last:!0})}setRawValue(T,F){const de=F??{forceEmit:!1,last:!0},Fe=this.constraint_?this.constraint_.constrain(T):T,Mt=this.rawValue_;(!this.equals_(Mt,Fe)||de.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Fe,this.emitter.emit("change",{options:de,previousRawValue:Mt,rawValue:Fe,sender:this}))}}class he{constructor(T){this.emitter=new ce,this.value_=T}get rawValue(){return this.value_}set rawValue(T){this.setRawValue(T,{forceEmit:!1,last:!0})}setRawValue(T,F){const de=F??{forceEmit:!1,last:!0},Fe=this.value_;(Fe!==T||de.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=T,this.emitter.emit("change",{options:de,previousRawValue:Fe,rawValue:this.value_,sender:this}))}}function we(ie,T){const F=T==null?void 0:T.constraint,de=T==null?void 0:T.equals;return F||de?new pe(ie,T):new he(ie)}class Ce{constructor(T){this.emitter=new ce,this.valMap_=T;for(const F in this.valMap_)this.valMap_[F].emitter.on("change",()=>{this.emitter.emit("change",{key:F,sender:this})})}static createCore(T){return Object.keys(T).reduce((F,de)=>Object.assign(F,{[de]:we(T[de])}),{})}static fromObject(T){const F=this.createCore(T);return new Ce(F)}get(T){return this.valMap_[T].rawValue}set(T,F){this.valMap_[T].rawValue=F}value(T){return this.valMap_[T]}}function Ne(ie){return T=>F=>{if(!T&&F===void 0)return{succeeded:!1,value:void 0};if(T&&F===void 0)return{succeeded:!0,value:void 0};const de=ie(F);return de!==void 0?{succeeded:!0,value:de}:{succeeded:!1,value:void 0}}}function Ze(ie){return{custom:T=>Ne(T)(ie),boolean:Ne(T=>typeof T=="boolean"?T:void 0)(ie),number:Ne(T=>typeof T=="number"?T:void 0)(ie),string:Ne(T=>typeof T=="string"?T:void 0)(ie),function:Ne(T=>typeof T=="function"?T:void 0)(ie),constant:T=>Ne(F=>F===T?T:void 0)(ie),raw:Ne(T=>T)(ie),object:T=>Ne(F=>{if((de=F)!==null&&typeof de=="object")return function(Fe,Mt){return Object.keys(Mt).reduce((kt,Tn)=>{if(kt===void 0)return;const gi=(0,Mt[Tn])(Fe[Tn]);return gi.succeeded?Object.assign(Object.assign({},kt),{[Tn]:gi.value}):void 0},{})}(F,T);var de})(ie),array:T=>Ne(F=>{if(Array.isArray(F))return de=T,F.reduce((Fe,Mt)=>{if(Fe===void 0)return;const kt=de(Mt);return kt.succeeded&&kt.value!==void 0?[...Fe,kt.value]:void 0},[]);var de})(ie)}}const Ye={optional:Ze(!0),required:Ze(!1)};function it(ie,T){const F=Ye.required.object(T)(ie);return F.succeeded?F.value:void 0}function _t(ie){console.warn([`Missing '${ie.key}' of ${ie.target} in ${ie.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class At{constructor(T){this.value_=T}static create(T){return[new At(T),(F,de)=>{T.setRawValue(F,de)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const vt=X("");function ut(ie,T){return Ae(ie,vt(void 0,T))}class Nt extends Ce{constructor(T){var F;super(T),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=At.create(we(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(F=this.get("parent"))===null||F===void 0||F.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(T){var F,de,Fe;const Mt=T??{};return new Nt(Ce.createCore({disabled:(F=Mt.disabled)!==null&&F!==void 0&&F,disposed:!1,hidden:(de=Mt.hidden)!==null&&de!==void 0&&de,parent:(Fe=Mt.parent)!==null&&Fe!==void 0?Fe:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(T){_e(this.globalDisabled_,ut(T,"disabled")),ge(this,"hidden",ut(T,"hidden"))}bindDisabled(T){_e(this.globalDisabled_,F=>{T.disabled=F})}bindTabIndex(T){_e(this.globalDisabled_,F=>{T.tabIndex=F?-1:0})}handleDispose(T){this.value("disposed").emitter.on("change",F=>{F&&T()})}getGlobalDisabled_(){const T=this.get("parent");return!!T&&T.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(T){var F;const de=T.previousRawValue;de==null||de.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(F=this.get("parent"))===null||F===void 0||F.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Qt=X(""),Qe={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ft{constructor(T){this.parent_=null,this.blade=T.blade,this.view=T.view,this.viewProps=T.viewProps;const F=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(de=>{F.classList.remove(Qt(void 0,Qe[de]))}),this.blade.get("positions").forEach(de=>{F.classList.add(Qt(void 0,Qe[de]))})}),this.viewProps.handleDispose(()=>{(function(de){de&&de.parentElement&&de.parentElement.removeChild(de)})(F)})}get parent(){return this.parent_}set parent(T){this.parent_=T,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):_t({key:"parent",target:Nt.name,place:"BladeController.parent"})}}const bt="http://www.w3.org/2000/svg";function sn(ie){ie.offsetHeight}function bn(ie){return ie.ontouchstart!==void 0}function Un(){return globalThis.document}const pi={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Xe(ie,T){const F=ie.createElementNS(bt,"svg");return F.innerHTML=pi[T],F}function Xt(ie,T,F){ie.insertBefore(T,ie.children[F])}function tn(ie){ie.parentElement&&ie.parentElement.removeChild(ie)}function dn(ie){for(;ie.children.length>0;)ie.removeChild(ie.children[0])}function pn(ie){return ie.relatedTarget?ie.relatedTarget:"explicitOriginalTarget"in ie?ie.explicitOriginalTarget:null}const Pn=X("lbl");class Cn{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(Pn()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(Pn("l")),ge(F.props,"label",Mt=>{j(Mt)?this.element.classList.add(Pn(void 0,"nol")):(this.element.classList.remove(Pn(void 0,"nol")),function(kt){for(;kt.childNodes.length>0;)kt.removeChild(kt.childNodes[0])}(de),de.appendChild(function(kt,Tn){const gi=kt.createDocumentFragment();return Tn.split(`
`).map(zi=>kt.createTextNode(zi)).forEach((zi,Tr)=>{Tr>0&&gi.appendChild(kt.createElement("br")),gi.appendChild(zi)}),gi}(T,Mt)))}),this.element.appendChild(de),this.labelElement=de;const Fe=T.createElement("div");Fe.classList.add(Pn("v")),this.element.appendChild(Fe),this.valueElement=Fe}}class vn extends ft{constructor(T,F){const de=F.valueController.viewProps;super(Object.assign(Object.assign({},F),{view:new Cn(T,{props:F.props,viewProps:de}),viewProps:de})),this.props=F.props,this.valueController=F.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const In={id:"button",type:"blade",accept(ie){const T=Ye,F=it(ie,{title:T.required.string,view:T.required.constant("button"),label:T.optional.string});return F?{params:F}:null},controller(ie){return new vn(ie.document,{blade:ie.blade,props:Ce.fromObject({label:ie.params.label}),valueController:new Re(ie.document,{props:Ce.fromObject({title:ie.params.title}),viewProps:ie.viewProps})})},api(ie){return ie.controller instanceof vn&&ie.controller.valueController instanceof Re?new ve(ie.controller):null}};class Fn extends ft{constructor(T){super(T),this.value=T.value}}function Hn(){return new Ce({positions:we([],{equals:te})})}class fe extends Ce{constructor(T){super(T)}static create(T){const F={completed:!0,expanded:T,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},de=Ce.createCore(F);return new fe(de)}get styleExpanded(){var T;return(T=this.get("temporaryExpanded"))!==null&&T!==void 0?T:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const T=this.get("expandedHeight");return this.get("shouldFixHeight")&&!j(T)?`${T}px`:"auto"}bindExpandedClass(T,F){const de=()=>{this.styleExpanded?T.classList.add(F):T.classList.remove(F)};ge(this,"expanded",de),ge(this,"temporaryExpanded",de)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Se(ie,T){T.style.height=ie.styleHeight}function Ve(ie,T){ie.value("expanded").emitter.on("beforechange",()=>{if(ie.set("completed",!1),j(ie.get("expandedHeight"))){const F=function(de,Fe){let Mt=0;return function(kt,Tn){const gi=kt.style.transition;kt.style.transition="none",Tn(),kt.style.transition=gi}(Fe,()=>{de.set("expandedHeight",null),de.set("temporaryExpanded",!0),sn(Fe),Mt=Fe.clientHeight,de.set("temporaryExpanded",null),sn(Fe)}),Mt}(ie,T);F>0&&ie.set("expandedHeight",F)}ie.set("shouldFixHeight",!0),sn(T)}),ie.emitter.on("change",()=>{Se(ie,T)}),Se(ie,T),T.addEventListener("transitionend",F=>{F.propertyName==="height"&&ie.cleanUpTransition()})}class We extends v{constructor(T,F){super(T),this.rackApi_=F}}class pt{constructor(T){this.emitter=new ce,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=T}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(T){for(const F of this.allItems())if(T(F))return F;return null}includes(T){return this.cache_.has(T)}add(T,F){if(this.includes(T))throw le.shouldNeverHappen();const de=F!==void 0?F:this.items_.length;this.items_.splice(de,0,T),this.cache_.add(T);const Fe=this.extract_(T);Fe&&(Fe.emitter.on("add",this.onSubListAdd_),Fe.emitter.on("remove",this.onSubListRemove_),Fe.allItems().forEach(Mt=>{this.cache_.add(Mt)})),this.emitter.emit("add",{index:de,item:T,root:this,target:this})}remove(T){const F=this.items_.indexOf(T);if(F<0)return;this.items_.splice(F,1),this.cache_.delete(T);const de=this.extract_(T);de&&(de.emitter.off("add",this.onSubListAdd_),de.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:F,item:T,root:this,target:this})}onSubListAdd_(T){this.cache_.add(T.item),this.emitter.emit("add",{index:T.index,item:T.item,root:this,target:T.target})}onSubListRemove_(T){this.cache_.delete(T.item),this.emitter.emit("remove",{index:T.index,item:T.item,root:this,target:T.target})}}class It extends v{constructor(T){super(T),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new ce,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(T){const F=T.sender.target.read();this.emitter_.emit("change",{event:new M(this,F,this.controller_.binding.target.presetKey,T.options.last)})}}class $t extends vn{constructor(T,F){super(T,F),this.binding=F.binding}}class nn extends v{constructor(T){super(T),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new ce,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(T){const F=T.sender.target.read();this.emitter_.emit("update",{event:new I(this,F,this.controller_.binding.target.presetKey)})}}class Ht extends vn{constructor(T,F){super(T,F),this.binding=F.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Wn(ie){return ie instanceof Nn?ie.apiSet_:ie instanceof We?ie.rackApi_.apiSet_:null}function Ln(ie,T){const F=ie.find(de=>de.controller_===T);if(!F)throw le.shouldNeverHappen();return F}function Qn(ie,T,F){if(!se.isBindable(ie))throw le.notBindable();return new se(ie,T,F)}class Nn extends v{constructor(T,F){super(T),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new ce,this.apiSet_=new pt(Wn),this.pool_=F;const de=this.controller_.rack;de.emitter.on("add",this.onRackAdd_),de.emitter.on("remove",this.onRackRemove_),de.emitter.on("inputchange",this.onRackInputChange_),de.emitter.on("monitorupdate",this.onRackMonitorUpdate_),de.children.forEach(Fe=>{this.setUpApi_(Fe)})}get children(){return this.controller_.rack.children.map(T=>Ln(this.apiSet_,T))}addInput(T,F,de){const Fe=de??{},Mt=this.controller_.view.element.ownerDocument,kt=this.pool_.createInput(Mt,Qn(T,F,Fe.presetKey),Fe),Tn=new It(kt);return this.add(Tn,Fe.index)}addMonitor(T,F,de){const Fe=de??{},Mt=this.controller_.view.element.ownerDocument,kt=this.pool_.createMonitor(Mt,Qn(T,F),Fe),Tn=new nn(kt);return this.add(Tn,Fe.index)}addFolder(T){return function(F,de){return F.addBlade(Object.assign(Object.assign({},de),{view:"folder"}))}(this,T)}addButton(T){return function(F,de){return F.addBlade(Object.assign(Object.assign({},de),{view:"button"}))}(this,T)}addSeparator(T){return function(F,de){const Fe=de??{};return F.addBlade(Object.assign(Object.assign({},Fe),{view:"separator"}))}(this,T)}addTab(T){return function(F,de){return F.addBlade(Object.assign(Object.assign({},de),{view:"tab"}))}(this,T)}add(T,F){this.controller_.rack.add(T.controller_,F);const de=this.apiSet_.find(Fe=>Fe.controller_===T.controller_);return de&&this.apiSet_.remove(de),this.apiSet_.add(T),T}remove(T){this.controller_.rack.remove(T.controller_)}addBlade(T){const F=this.controller_.view.element.ownerDocument,de=this.pool_.createBlade(F,T),Fe=this.pool_.createBladeApi(de);return this.add(Fe,T.index)}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}setUpApi_(T){this.apiSet_.find(F=>F.controller_===T)||this.apiSet_.add(this.pool_.createBladeApi(T))}onRackAdd_(T){this.setUpApi_(T.bladeController)}onRackRemove_(T){if(T.isRoot){const F=Ln(this.apiSet_,T.bladeController);this.apiSet_.remove(F)}}onRackInputChange_(T){const F=T.bladeController;if(F instanceof $t){const de=Ln(this.apiSet_,F),Fe=F.binding;this.emitter_.emit("change",{event:new M(de,Fe.target.read(),Fe.target.presetKey,T.options.last)})}else if(F instanceof Fn){const de=Ln(this.apiSet_,F);this.emitter_.emit("change",{event:new M(de,F.value.rawValue,void 0,T.options.last)})}}onRackMonitorUpdate_(T){if(!(T.bladeController instanceof Ht))throw le.shouldNeverHappen();const F=Ln(this.apiSet_,T.bladeController),de=T.bladeController.binding;this.emitter_.emit("update",{event:new I(F,de.target.read(),de.target.presetKey)})}}class Zn extends We{constructor(T,F){super(T,new Nn(T.rackController,F)),this.emitter_=new ce,this.controller_.foldable.value("expanded").emitter.on("change",de=>{this.emitter_.emit("fold",{event:new B(this,de.sender.rawValue)})}),this.rackApi_.on("change",de=>{this.emitter_.emit("change",{event:de})}),this.rackApi_.on("update",de=>{this.emitter_.emit("update",{event:de})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(T){this.controller_.foldable.set("expanded",T)}get title(){return this.controller_.props.get("title")}set title(T){this.controller_.props.set("title",T)}get children(){return this.rackApi_.children}addInput(T,F,de){return this.rackApi_.addInput(T,F,de)}addMonitor(T,F,de){return this.rackApi_.addMonitor(T,F,de)}addFolder(T){return this.rackApi_.addFolder(T)}addButton(T){return this.rackApi_.addButton(T)}addSeparator(T){return this.rackApi_.addSeparator(T)}addTab(T){return this.rackApi_.addTab(T)}add(T,F){return this.rackApi_.add(T,F)}remove(T){this.rackApi_.remove(T)}addBlade(T){return this.rackApi_.addBlade(T)}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}}class Qi extends ft{constructor(T){super({blade:T.blade,view:T.view,viewProps:T.rackController.viewProps}),this.rackController=T.rackController}}class Mr{constructor(T,F){const de=X(F.viewName);this.element=T.createElement("div"),this.element.classList.add(de()),F.viewProps.bindClassModifiers(this.element)}}function ze(ie){return ie instanceof si?ie.rack:ie instanceof Qi?ie.rackController.rack:null}function yi(ie){const T=ze(ie);return T?T.bcSet_:null}class On{constructor(T){var F,de;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new ce,this.blade_=(F=T.blade)!==null&&F!==void 0?F:null,(de=this.blade_)===null||de===void 0||de.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=T.viewProps,this.bcSet_=new pt(yi),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(T,F){var de;(de=T.parent)===null||de===void 0||de.remove(T),Z(T,"parent")?T.parent=this:(T.parent_=this,_t({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(T,F)}remove(T){Z(T,"parent")?T.parent=null:(T.parent_=null,_t({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(T)}find(T){return this.bcSet_.allItems().filter(F=>F instanceof T)}onSetAdd_(T){this.updatePositions_();const F=T.target===T.root;if(this.emitter.emit("add",{bladeController:T.item,index:T.index,isRoot:F,sender:this}),!F)return;const de=T.item;if(de.viewProps.emitter.on("change",this.onChildViewPropsChange_),de.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),de.viewProps.handleDispose(this.onChildDispose_),de instanceof $t)de.binding.emitter.on("change",this.onChildInputChange_);else if(de instanceof Ht)de.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(de instanceof Fn)de.value.emitter.on("change",this.onChildValueChange_);else{const Fe=ze(de);if(Fe){const Mt=Fe.emitter;Mt.on("layout",this.onDescendantLayout_),Mt.on("inputchange",this.onDescendantInputChange_),Mt.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(T){this.updatePositions_();const F=T.target===T.root;if(this.emitter.emit("remove",{bladeController:T.item,isRoot:F,sender:this}),!F)return;const de=T.item;if(de instanceof $t)de.binding.emitter.off("change",this.onChildInputChange_);else if(de instanceof Ht)de.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(de instanceof Fn)de.value.emitter.off("change",this.onChildValueChange_);else{const Fe=ze(de);if(Fe){const Mt=Fe.emitter;Mt.off("layout",this.onDescendantLayout_),Mt.off("inputchange",this.onDescendantInputChange_),Mt.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const T=this.bcSet_.items.filter(Fe=>!Fe.viewProps.get("hidden")),F=T[0],de=T[T.length-1];this.bcSet_.items.forEach(Fe=>{const Mt=[];Fe===F&&(Mt.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||Mt.push("veryfirst")),Fe===de&&(Mt.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||Mt.push("verylast")),Fe.blade.set("positions",Mt)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(T){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(T=>T.viewProps.get("disposed")).forEach(T=>{this.bcSet_.remove(T)})}onChildInputChange_(T){const F=function(de,Fe){for(let Mt=0;Mt<de.length;Mt++){const kt=de[Mt];if(kt instanceof $t&&kt.binding===Fe)return kt}return null}(this.find($t),T.sender);if(!F)throw le.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:F,options:T.options,sender:this})}onChildMonitorUpdate_(T){const F=function(de,Fe){for(let Mt=0;Mt<de.length;Mt++){const kt=de[Mt];if(kt instanceof Ht&&kt.binding===Fe)return kt}return null}(this.find(Ht),T.sender);if(!F)throw le.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:F,sender:this})}onChildValueChange_(T){const F=function(de,Fe){for(let Mt=0;Mt<de.length;Mt++){const kt=de[Mt];if(kt instanceof Fn&&kt.value===Fe)return kt}return null}(this.find(Fn),T.sender);if(!F)throw le.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:F,options:T.options,sender:this})}onDescendantLayout_(T){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(T){this.emitter.emit("inputchange",{bladeController:T.bladeController,options:T.options,sender:this})}onDescendantMonitorUpdate_(T){this.emitter.emit("monitorupdate",{bladeController:T.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class si extends ft{constructor(T,F){super(Object.assign(Object.assign({},F),{view:new Mr(T,{viewName:"brk",viewProps:F.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const de=new On({blade:F.root?void 0:F.blade,viewProps:F.viewProps});de.emitter.on("add",this.onRackAdd_),de.emitter.on("remove",this.onRackRemove_),this.rack=de,this.viewProps.handleDispose(()=>{for(let Fe=this.rack.children.length-1;Fe>=0;Fe--)this.rack.children[Fe].viewProps.set("disposed",!0)})}onRackAdd_(T){T.isRoot&&Xt(this.view.element,T.bladeController.view.element,T.index)}onRackRemove_(T){T.isRoot&&tn(T.bladeController.view.element)}}const di=X("cnt");class Mi{constructor(T,F){var de;this.className_=X((de=F.viewName)!==null&&de!==void 0?de:"fld"),this.element=T.createElement("div"),this.element.classList.add(this.className_(),di()),F.viewProps.bindClassModifiers(this.element),this.foldable_=F.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ge(this.foldable_,"completed",Ae(this.element,this.className_(void 0,"cpl")));const Fe=T.createElement("button");Fe.classList.add(this.className_("b")),ge(F.props,"title",zi=>{j(zi)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),F.viewProps.bindDisabled(Fe),this.element.appendChild(Fe),this.buttonElement=Fe;const Mt=T.createElement("div");Mt.classList.add(this.className_("i")),this.element.appendChild(Mt);const kt=T.createElement("div");kt.classList.add(this.className_("t")),ee(F.props.value("title"),kt),this.buttonElement.appendChild(kt),this.titleElement=kt;const Tn=T.createElement("div");Tn.classList.add(this.className_("m")),this.buttonElement.appendChild(Tn);const gi=F.containerElement;gi.classList.add(this.className_("c")),this.element.appendChild(gi),this.containerElement=gi}}class is extends Qi{constructor(T,F){var de;const Fe=fe.create((de=F.expanded)===null||de===void 0||de),Mt=new si(T,{blade:F.blade,root:F.root,viewProps:F.viewProps});super(Object.assign(Object.assign({},F),{rackController:Mt,view:new Mi(T,{containerElement:Mt.view.element,foldable:Fe,props:F.props,viewName:F.root?"rot":void 0,viewProps:F.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=F.props,this.foldable=Fe,Ve(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const jr={id:"folder",type:"blade",accept(ie){const T=Ye,F=it(ie,{title:T.required.string,view:T.required.constant("folder"),expanded:T.optional.boolean});return F?{params:F}:null},controller(ie){return new is(ie.document,{blade:ie.blade,expanded:ie.params.expanded,props:Ce.fromObject({title:ie.params.title}),viewProps:ie.viewProps})},api(ie){return ie.controller instanceof is?new Zn(ie.controller,ie.pool):null}};class Xr extends Fn{constructor(T,F){const de=F.valueController.viewProps;super(Object.assign(Object.assign({},F),{value:F.valueController.value,view:new Cn(T,{props:F.props,viewProps:de}),viewProps:de})),this.props=F.props,this.valueController=F.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class cs extends v{}const ys=X("spr");class Zr{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(ys()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("hr");de.classList.add(ys("r")),this.element.appendChild(de)}}class za extends ft{constructor(T,F){super(Object.assign(Object.assign({},F),{view:new Zr(T,{viewProps:F.viewProps})}))}}const uo={id:"separator",type:"blade",accept(ie){const T=it(ie,{view:Ye.required.constant("separator")});return T?{params:T}:null},controller(ie){return new za(ie.document,{blade:ie.blade,viewProps:ie.viewProps})},api(ie){return ie.controller instanceof za?new cs(ie.controller):null}},sa=X("tbi");class oa{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(sa()),F.viewProps.bindClassModifiers(this.element),ge(F.props,"selected",Mt=>{Mt?this.element.classList.add(sa(void 0,"sel")):this.element.classList.remove(sa(void 0,"sel"))});const de=T.createElement("button");de.classList.add(sa("b")),F.viewProps.bindDisabled(de),this.element.appendChild(de),this.buttonElement=de;const Fe=T.createElement("div");Fe.classList.add(sa("t")),ee(F.props.value("title"),Fe),this.buttonElement.appendChild(Fe),this.titleElement=Fe}}class Oo{constructor(T,F){this.emitter=new ce,this.onClick_=this.onClick_.bind(this),this.props=F.props,this.viewProps=F.viewProps,this.view=new oa(T,{props:F.props,viewProps:F.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Bo{constructor(T,F){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Oo(T,{props:F.itemProps,viewProps:Nt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new si(T,{blade:Hn(),viewProps:Nt.create()}),this.props=F.props,ge(this.props,"selected",de=>{this.itemController.props.set("selected",de),this.contentController.viewProps.set("hidden",!de)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Hl{constructor(T,F){this.controller_=T,this.rackApi_=F}get title(){var T;return(T=this.controller_.itemController.props.get("title"))!==null&&T!==void 0?T:""}set title(T){this.controller_.itemController.props.set("title",T)}get selected(){return this.controller_.props.get("selected")}set selected(T){this.controller_.props.set("selected",T)}get children(){return this.rackApi_.children}addButton(T){return this.rackApi_.addButton(T)}addFolder(T){return this.rackApi_.addFolder(T)}addSeparator(T){return this.rackApi_.addSeparator(T)}addTab(T){return this.rackApi_.addTab(T)}add(T,F){this.rackApi_.add(T,F)}remove(T){this.rackApi_.remove(T)}addInput(T,F,de){return this.rackApi_.addInput(T,F,de)}addMonitor(T,F,de){return this.rackApi_.addMonitor(T,F,de)}addBlade(T){return this.rackApi_.addBlade(T)}}class ja extends We{constructor(T,F){super(T,new Nn(T.rackController,F)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new ce,this.pageApiMap_=new Map,this.rackApi_.on("change",de=>{this.emitter_.emit("change",{event:de})}),this.rackApi_.on("update",de=>{this.emitter_.emit("update",{event:de})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(de=>{this.setUpPageApi_(de)})}get pages(){return this.controller_.pageSet.items.map(T=>{const F=this.pageApiMap_.get(T);if(!F)throw le.shouldNeverHappen();return F})}addPage(T){const F=this.controller_.view.element.ownerDocument,de=new Bo(F,{itemProps:Ce.fromObject({selected:!1,title:T.title}),props:Ce.fromObject({selected:!1})});this.controller_.add(de,T.index);const Fe=this.pageApiMap_.get(de);if(!Fe)throw le.shouldNeverHappen();return Fe}removePage(T){this.controller_.remove(T)}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}setUpPageApi_(T){const F=this.rackApi_.apiSet_.find(Fe=>Fe.controller_===T.contentController);if(!F)throw le.shouldNeverHappen();const de=new Hl(T,F);this.pageApiMap_.set(T,de)}onPageAdd_(T){this.setUpPageApi_(T.item)}onPageRemove_(T){if(!this.pageApiMap_.get(T.item))throw le.shouldNeverHappen();this.pageApiMap_.delete(T.item)}onSelect_(T){this.emitter_.emit("select",{event:new U(this,T.rawValue)})}}class Ma{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=we(!0),this.selectedIndex=we(-1),this.items_=[]}add(T,F){const de=F??this.items_.length;this.items_.splice(de,0,T),T.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(T){const F=this.items_.indexOf(T);F<0||(this.items_.splice(F,1),T.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const T=this.items_.findIndex(F=>F.rawValue);T<0?(this.items_.forEach((F,de)=>{F.rawValue=de===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((F,de)=>{F.rawValue=de===T}),this.selectedIndex.rawValue=T),this.empty.rawValue=!1}onItemSelectedChange_(T){if(T.rawValue){const F=this.items_.findIndex(de=>de===T.sender);this.items_.forEach((de,Fe)=>{de.rawValue=Fe===F}),this.selectedIndex.rawValue=F}else this.keepSelection_()}}const Lo=X("tab");class Pt{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(Lo(),di()),F.viewProps.bindClassModifiers(this.element),_e(F.empty,Ae(this.element,Lo(void 0,"nop")));const de=T.createElement("div");de.classList.add(Lo("t")),this.element.appendChild(de),this.itemsElement=de;const Fe=T.createElement("div");Fe.classList.add(Lo("i")),this.element.appendChild(Fe);const Mt=F.contentsElement;Mt.classList.add(Lo("c")),this.element.appendChild(Mt),this.contentsElement=Mt}}class wn extends Qi{constructor(T,F){const de=new si(T,{blade:F.blade,viewProps:F.viewProps}),Fe=new Ma;super({blade:F.blade,rackController:de,view:new Pt(T,{contentsElement:de.view.element,empty:Fe.empty,viewProps:F.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new pt(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=Fe}get pageSet(){return this.pageSet_}add(T,F){this.pageSet_.add(T,F)}remove(T){this.pageSet_.remove(this.pageSet_.items[T])}onPageAdd_(T){const F=T.item;Xt(this.view.itemsElement,F.itemController.view.element,T.index),F.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(F.contentController,T.index),this.tab.add(F.props.value("selected"))}onPageRemove_(T){const F=T.item;tn(F.itemController.view.element),F.itemController.viewProps.set("parent",null),this.rackController.rack.remove(F.contentController),this.tab.remove(F.props.value("selected"))}}const Vn={id:"tab",type:"blade",accept(ie){const T=Ye,F=it(ie,{pages:T.required.array(T.required.object({title:T.required.string})),view:T.required.constant("tab")});return F&&F.pages.length!==0?{params:F}:null},controller(ie){const T=new wn(ie.document,{blade:ie.blade,viewProps:ie.viewProps});return ie.params.pages.forEach(F=>{const de=new Bo(ie.document,{itemProps:Ce.fromObject({selected:!1,title:F.title}),props:Ce.fromObject({selected:!1})});T.add(de)}),T},api(ie){return ie.controller instanceof wn?new ja(ie.controller,ie.pool):null}};class un{constructor(){this.disabled=!1,this.emitter=new ce}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Gn{constructor(T,F){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=T,this.emitter=new ce,this.interval_=F,this.setTimer_()}get disabled(){return this.disabled_}set disabled(T){this.disabled_=T,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const T=this.doc_.defaultView;T&&T.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const T=this.doc_.defaultView;T&&(this.timerId_=T.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Yi{constructor(T){this.onValueChange_=this.onValueChange_.bind(this),this.reader=T.reader,this.writer=T.writer,this.emitter=new ce,this.value=T.value,this.value.emitter.on("change",this.onValueChange_),this.target=T.target,this.read()}read(){const T=this.target.read();T!==void 0&&(this.value.rawValue=this.reader(T))}write_(T){this.writer(this.target,T)}onValueChange_(T){this.write_(T.rawValue),this.emitter.emit("change",{options:T.options,rawValue:T.rawValue,sender:this})}}function ji(ie,T){for(;ie.length<T;)ie.push(void 0)}function Er(ie){const T=[];return ji(T,ie),we(T)}function ir(ie){const T=ie.indexOf(void 0);return T<0?ie:ie.slice(0,T)}class Yn{constructor(T){this.onTick_=this.onTick_.bind(this),this.reader_=T.reader,this.target=T.target,this.emitter=new ce,this.value=T.value,this.ticker=T.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const T=this.target.read();if(T===void 0)return;const F=this.value.rawValue,de=this.reader_(T);this.value.rawValue=function(Fe,Mt){const kt=[...ir(Fe),Mt];return kt.length>Fe.length?kt.splice(0,kt.length-Fe.length):ji(kt,Fe.length),kt}(F,de),this.emitter.emit("update",{rawValue:de,sender:this})}onTick_(T){this.read()}}class er{constructor(T){this.constraints=T}constrain(T){return this.constraints.reduce((F,de)=>de.constrain(F),T)}}function Pe(ie,T){if(ie instanceof T)return ie;if(ie instanceof er){const F=ie.constraints.reduce((de,Fe)=>de||(Fe instanceof T?Fe:null),null);if(F)return F}return null}class Le{constructor(T){this.values=Ce.fromObject({max:T.max,min:T.min})}constrain(T){const F=this.values.get("max"),de=this.values.get("min");return Math.min(Math.max(T,de),F)}}class ct{constructor(T){this.values=Ce.fromObject({options:T})}get options(){return this.values.get("options")}constrain(T){const F=this.values.get("options");return F.length===0||F.filter(de=>de.value===T).length>0?T:F[0].value}}class ht{constructor(T){this.values=Ce.fromObject({max:T.max,min:T.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(T){const F=this.values.get("max"),de=this.values.get("min");let Fe=T;return j(de)||(Fe=Math.max(Fe,de)),j(F)||(Fe=Math.min(Fe,F)),Fe}}class Ke{constructor(T,F=0){this.step=T,this.origin=F}constrain(T){const F=this.origin%this.step;return F+Math.round((T-F)/this.step)*this.step}}const Lt=X("lst");class dt{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),this.props_=F.props,this.element=T.createElement("div"),this.element.classList.add(Lt()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("select");de.classList.add(Lt("s")),ge(this.props_,"options",Mt=>{dn(de),Mt.forEach((kt,Tn)=>{const gi=T.createElement("option");gi.dataset.index=String(Tn),gi.textContent=kt.text,gi.value=String(kt.value),de.appendChild(gi)})}),F.viewProps.bindDisabled(de),this.element.appendChild(de),this.selectElement=de;const Fe=T.createElement("div");Fe.classList.add(Lt("m")),Fe.appendChild(Xe(T,"dropdown")),this.element.appendChild(Fe),F.value.emitter.on("change",this.onValueChange_),this.value_=F.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Wt{constructor(T,F){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=F.props,this.value=F.value,this.viewProps=F.viewProps,this.view=new dt(T,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(T){const F=T.currentTarget.selectedOptions.item(0);if(!F)return;const de=Number(F.dataset.index);this.value.rawValue=this.props.get("options")[de].value}}const rn=X("pop");class on{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(rn()),F.viewProps.bindClassModifiers(this.element),_e(F.shows,Ae(this.element,rn(void 0,"v")))}}class gn{constructor(T,F){this.shows=we(!1),this.viewProps=F.viewProps,this.view=new on(T,{shows:this.shows,viewProps:this.viewProps})}}const Xn=X("txt");class an{constructor(T,F){this.onChange_=this.onChange_.bind(this),this.element=T.createElement("div"),this.element.classList.add(Xn()),F.viewProps.bindClassModifiers(this.element),this.props_=F.props,this.props_.emitter.on("change",this.onChange_);const de=T.createElement("input");de.classList.add(Xn("i")),de.type="text",F.viewProps.bindDisabled(de),this.element.appendChild(de),this.inputElement=de,F.value.emitter.on("change",this.onChange_),this.value_=F.value,this.refresh()}refresh(){const T=this.props_.get("formatter");this.inputElement.value=T(this.value_.rawValue)}onChange_(){this.refresh()}}class ui{constructor(T,F){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=F.parser,this.props=F.props,this.value=F.value,this.viewProps=F.viewProps,this.view=new an(T,{props:F.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(T){const F=T.currentTarget.value,de=this.parser_(F);j(de)||(this.value.rawValue=de),this.view.refresh()}}function Ai(ie){return ie!=="false"&&!!ie}function Bn(ie){return function(T){return String(T)}(ie)}class Kn{constructor(T){this.text=T}evaluate(){return Number(this.text)}toString(){return this.text}}const Mn={"**":(ie,T)=>Math.pow(ie,T),"*":(ie,T)=>ie*T,"/":(ie,T)=>ie/T,"%":(ie,T)=>ie%T,"+":(ie,T)=>ie+T,"-":(ie,T)=>ie-T,"<<":(ie,T)=>ie<<T,">>":(ie,T)=>ie>>T,">>>":(ie,T)=>ie>>>T,"&":(ie,T)=>ie&T,"^":(ie,T)=>ie^T,"|":(ie,T)=>ie|T};class Ci{constructor(T,F,de){this.left=F,this.operator=T,this.right=de}evaluate(){const T=Mn[this.operator];if(!T)throw new Error(`unexpected binary operator: '${this.operator}`);return T(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Hi={"+":ie=>ie,"-":ie=>-ie,"~":ie=>~ie};class cr{constructor(T,F){this.operator=T,this.expression=F}evaluate(){const T=Hi[this.operator];if(!T)throw new Error(`unexpected unary operator: '${this.operator}`);return T(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Ki(ie){return(T,F)=>{for(let de=0;de<ie.length;de++){const Fe=ie[de](T,F);if(Fe!=="")return Fe}return""}}function ni(ie,T){var F;const de=ie.substr(T).match(/^\s+/);return(F=de&&de[0])!==null&&F!==void 0?F:""}function Wi(ie,T){var F;const de=ie.substr(T).match(/^[0-9]+/);return(F=de&&de[0])!==null&&F!==void 0?F:""}function Ir(ie,T){const F=ie.substr(T,1);if(T+=1,F.toLowerCase()!=="e")return"";const de=function(Fe,Mt){const kt=Wi(Fe,Mt);if(kt!=="")return kt;const Tn=Fe.substr(Mt,1);if(Tn!=="-"&&Tn!=="+")return"";const gi=Wi(Fe,Mt+=1);return gi===""?"":Tn+gi}(ie,T);return de===""?"":F+de}function Ar(ie,T){const F=ie.substr(T,1);if(F==="0")return F;const de=function(Fe,Mt){const kt=Fe.substr(Mt,1);return kt.match(/^[1-9]$/)?kt:""}(ie,T);return T+=de.length,de===""?"":de+Wi(ie,T)}const _s=Ki([function(ie,T){const F=Ar(ie,T);if(T+=F.length,F==="")return"";const de=ie.substr(T,1);if(T+=de.length,de!==".")return"";const Fe=Wi(ie,T);return F+de+Fe+Ir(ie,T+=Fe.length)},function(ie,T){const F=ie.substr(T,1);if(T+=F.length,F!==".")return"";const de=Wi(ie,T);return T+=de.length,de===""?"":F+de+Ir(ie,T)},function(ie,T){const F=Ar(ie,T);return T+=F.length,F===""?"":F+Ir(ie,T)}]),bo=Ki([function(ie,T){const F=ie.substr(T,2);if(T+=F.length,F.toLowerCase()!=="0b")return"";const de=function(Fe,Mt){var kt;const Tn=Fe.substr(Mt).match(/^[01]+/);return(kt=Tn&&Tn[0])!==null&&kt!==void 0?kt:""}(ie,T);return de===""?"":F+de},function(ie,T){const F=ie.substr(T,2);if(T+=F.length,F.toLowerCase()!=="0o")return"";const de=function(Fe,Mt){var kt;const Tn=Fe.substr(Mt).match(/^[0-7]+/);return(kt=Tn&&Tn[0])!==null&&kt!==void 0?kt:""}(ie,T);return de===""?"":F+de},function(ie,T){const F=ie.substr(T,2);if(T+=F.length,F.toLowerCase()!=="0x")return"";const de=function(Fe,Mt){var kt;const Tn=Fe.substr(Mt).match(/^[0-9a-f]+/i);return(kt=Tn&&Tn[0])!==null&&kt!==void 0?kt:""}(ie,T);return de===""?"":F+de}]),Ms=Ki([bo,_s]);function Ks(ie,T){var F;return(F=function(de,Fe){const Mt=Ms(de,Fe);return Fe+=Mt.length,Mt===""?null:{evaluable:new Kn(Mt),cursor:Fe}}(ie,T))!==null&&F!==void 0?F:function(de,Fe){const Mt=de.substr(Fe,1);if(Fe+=Mt.length,Mt!=="(")return null;const kt=As(de,Fe);if(!kt)return null;Fe=kt.cursor,Fe+=ni(de,Fe).length;const Tn=de.substr(Fe,1);return Fe+=Tn.length,Tn!==")"?null:{evaluable:kt.evaluable,cursor:Fe}}(ie,T)}function so(ie,T,F){F+=ni(T,F).length;const de=ie.filter(Fe=>T.startsWith(Fe,F))[0];return de?(F+=de.length,{cursor:F+=ni(T,F).length,operator:de}):null}const Zi=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((ie,T)=>function(F,de){return(Fe,Mt)=>{const kt=F(Fe,Mt);if(!kt)return null;Mt=kt.cursor;let Tn=kt.evaluable;for(;;){const gi=so(de,Fe,Mt);if(!gi)break;Mt=gi.cursor;const zi=F(Fe,Mt);if(!zi)return null;Mt=zi.cursor,Tn=new Ci(gi.operator,Tn,zi.evaluable)}return Tn?{cursor:Mt,evaluable:Tn}:null}}(ie,T),function ie(T,F){const de=Ks(T,F);if(de)return de;const Fe=T.substr(F,1);if(F+=Fe.length,Fe!=="+"&&Fe!=="-"&&Fe!=="~")return null;const Mt=ie(T,F);return Mt?{cursor:F=Mt.cursor,evaluable:new cr(Fe,Mt.evaluable)}:null});function As(ie,T){return T+=ni(ie,T).length,Zi(ie,T)}function Ri(ie){var T;const F=function(de){const Fe=As(de,0);return Fe?Fe.cursor+ni(de,Fe.cursor).length!==de.length?null:Fe.evaluable:null}(ie);return(T=F==null?void 0:F.evaluate())!==null&&T!==void 0?T:null}function No(ie){if(typeof ie=="number")return ie;if(typeof ie=="string"){const T=Ri(ie);if(!j(T))return T}return 0}function br(ie){return String(ie)}function rr(ie){return T=>T.toFixed(Math.max(Math.min(ie,20),0))}const oo=rr(0);function $s(ie){return oo(ie)+"%"}function vr(ie){return String(ie)}function Ta(ie){return ie}function xr({primary:ie,secondary:T,forward:F,backward:de}){let Fe=!1;function Mt(kt){Fe||(Fe=!0,kt(),Fe=!1)}ie.emitter.on("change",kt=>{Mt(()=>{T.setRawValue(F(ie,T),kt.options)})}),T.emitter.on("change",kt=>{Mt(()=>{ie.setRawValue(de(ie,T),kt.options)}),Mt(()=>{T.setRawValue(F(ie,T),kt.options)})}),Mt(()=>{T.setRawValue(F(ie,T),{forceEmit:!1,last:!0})})}function Is(ie,T){const F=ie*(T.altKey?.1:1)*(T.shiftKey?10:1);return T.upKey?+F:T.downKey?-F:0}function Vu(ie){return{altKey:ie.altKey,downKey:ie.key==="ArrowDown",shiftKey:ie.shiftKey,upKey:ie.key==="ArrowUp"}}function Wl(ie){return{altKey:ie.altKey,downKey:ie.key==="ArrowLeft",shiftKey:ie.shiftKey,upKey:ie.key==="ArrowRight"}}function fu(ie){return function(T){return T==="ArrowUp"||T==="ArrowDown"}(ie)||ie==="ArrowLeft"||ie==="ArrowRight"}function zc(ie,T){var F,de;const Fe=T.ownerDocument.defaultView,Mt=T.getBoundingClientRect();return{x:ie.pageX-(((F=Fe&&Fe.scrollX)!==null&&F!==void 0?F:0)+Mt.left),y:ie.pageY-(((de=Fe&&Fe.scrollY)!==null&&de!==void 0?de:0)+Mt.top)}}class Va{constructor(T){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=T,this.emitter=new ce,T.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),T.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),T.addEventListener("touchend",this.onTouchEnd_),T.addEventListener("mousedown",this.onMouseDown_)}computePosition_(T){const F=this.elem_.getBoundingClientRect();return{bounds:{width:F.width,height:F.height},point:T?{x:T.x,y:T.y}:null}}onMouseDown_(T){var F;T.preventDefault(),(F=T.currentTarget)===null||F===void 0||F.focus();const de=this.elem_.ownerDocument;de.addEventListener("mousemove",this.onDocumentMouseMove_),de.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:T.altKey,data:this.computePosition_(zc(T,this.elem_)),sender:this,shiftKey:T.shiftKey})}onDocumentMouseMove_(T){this.emitter.emit("move",{altKey:T.altKey,data:this.computePosition_(zc(T,this.elem_)),sender:this,shiftKey:T.shiftKey})}onDocumentMouseUp_(T){const F=this.elem_.ownerDocument;F.removeEventListener("mousemove",this.onDocumentMouseMove_),F.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:T.altKey,data:this.computePosition_(zc(T,this.elem_)),sender:this,shiftKey:T.shiftKey})}onTouchStart_(T){T.preventDefault();const F=T.targetTouches.item(0),de=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:T.altKey,data:this.computePosition_(F?{x:F.clientX-de.left,y:F.clientY-de.top}:void 0),sender:this,shiftKey:T.shiftKey}),this.lastTouch_=F}onTouchMove_(T){const F=T.targetTouches.item(0),de=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:T.altKey,data:this.computePosition_(F?{x:F.clientX-de.left,y:F.clientY-de.top}:void 0),sender:this,shiftKey:T.shiftKey}),this.lastTouch_=F}onTouchEnd_(T){var F;const de=(F=T.targetTouches.item(0))!==null&&F!==void 0?F:this.lastTouch_,Fe=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:T.altKey,data:this.computePosition_(de?{x:de.clientX-Fe.left,y:de.clientY-Fe.top}:void 0),sender:this,shiftKey:T.shiftKey})}}function Wr(ie,T,F,de,Fe){return de+(ie-T)/(F-T)*(Fe-de)}function Gu(ie){return String(ie.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ts(ie,T,F){return Math.min(Math.max(ie,T),F)}function Nr(ie,T){return(ie%T+T)%T}const Ga=X("txt");class qp{constructor(T,F){this.onChange_=this.onChange_.bind(this),this.props_=F.props,this.props_.emitter.on("change",this.onChange_),this.element=T.createElement("div"),this.element.classList.add(Ga(),Ga(void 0,"num")),F.arrayPosition&&this.element.classList.add(Ga(void 0,F.arrayPosition)),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("input");de.classList.add(Ga("i")),de.type="text",F.viewProps.bindDisabled(de),this.element.appendChild(de),this.inputElement=de,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=F.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ga()),this.inputElement.classList.add(Ga("i"));const Fe=T.createElement("div");Fe.classList.add(Ga("k")),this.element.appendChild(Fe),this.knobElement=Fe;const Mt=T.createElementNS(bt,"svg");Mt.classList.add(Ga("g")),this.knobElement.appendChild(Mt);const kt=T.createElementNS(bt,"path");kt.classList.add(Ga("gb")),Mt.appendChild(kt),this.guideBodyElem_=kt;const Tn=T.createElementNS(bt,"path");Tn.classList.add(Ga("gh")),Mt.appendChild(Tn),this.guideHeadElem_=Tn;const gi=T.createElement("div");gi.classList.add(X("tt")()),this.knobElement.appendChild(gi),this.tooltipElem_=gi,F.value.emitter.on("change",this.onChange_),this.value=F.value,this.refresh()}onDraggingChange_(T){if(T.rawValue===null)return void this.element.classList.remove(Ga(void 0,"drg"));this.element.classList.add(Ga(void 0,"drg"));const F=T.rawValue/this.props_.get("draggingScale"),de=F+(F>0?-1:F<0?1:0),Fe=Ts(-de,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${de+Fe},0 L${de},4 L${de+Fe},8`,`M ${F},-1 L${F},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${F},4`);const Mt=this.props_.get("formatter");this.tooltipElem_.textContent=Mt(this.value.rawValue),this.tooltipElem_.style.left=`${F}px`}refresh(){const T=this.props_.get("formatter");this.inputElement.value=T(this.value.rawValue)}onChange_(){this.refresh()}}class gh{constructor(T,F){var de;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=F.baseStep,this.parser_=F.parser,this.props=F.props,this.sliderProps_=(de=F.sliderProps)!==null&&de!==void 0?de:null,this.value=F.value,this.viewProps=F.viewProps,this.dragging_=we(null),this.view=new qp(T,{arrayPosition:F.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Fe=new Va(this.view.knobElement);Fe.emitter.on("down",this.onPointerDown_),Fe.emitter.on("move",this.onPointerMove_),Fe.emitter.on("up",this.onPointerUp_)}constrainValue_(T){var F,de;const Fe=(F=this.sliderProps_)===null||F===void 0?void 0:F.get("minValue"),Mt=(de=this.sliderProps_)===null||de===void 0?void 0:de.get("maxValue");let kt=T;return Fe!==void 0&&(kt=Math.max(kt,Fe)),Mt!==void 0&&(kt=Math.min(kt,Mt)),kt}onInputChange_(T){const F=T.currentTarget.value,de=this.parser_(F);j(de)||(this.value.rawValue=this.constrainValue_(de)),this.view.refresh()}onInputKeyDown_(T){const F=Is(this.baseStep_,Vu(T));F!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+F),{forceEmit:!1,last:!1})}onInputKeyUp_(T){Is(this.baseStep_,Vu(T))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(T){if(!T.point)return null;const F=T.point.x-T.bounds.width/2;return this.constrainValue_(this.originRawValue_+F*this.props.get("draggingScale"))}onPointerMove_(T){const F=this.computeDraggingValue_(T.data);F!==null&&(this.value.setRawValue(F,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(T){const F=this.computeDraggingValue_(T.data);F!==null&&(this.value.setRawValue(F,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Jd=X("sld");class Js{constructor(T,F){this.onChange_=this.onChange_.bind(this),this.props_=F.props,this.props_.emitter.on("change",this.onChange_),this.element=T.createElement("div"),this.element.classList.add(Jd()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(Jd("t")),F.viewProps.bindTabIndex(de),this.element.appendChild(de),this.trackElement=de;const Fe=T.createElement("div");Fe.classList.add(Jd("k")),this.trackElement.appendChild(Fe),this.knobElement=Fe,F.value.emitter.on("change",this.onChange_),this.value=F.value,this.update_()}update_(){const T=Ts(Wr(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${T}%`}onChange_(){this.update_()}}class ao{constructor(T,F){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=F.baseStep,this.value=F.value,this.viewProps=F.viewProps,this.props=F.props,this.view=new Js(T,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Va(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(T,F){T.point&&this.value.setRawValue(Wr(Ts(T.point.x,0,T.bounds.width),0,T.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),F)}onPointerDownOrMove_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerUp_(T){this.handlePointerEvent_(T.data,{forceEmit:!0,last:!0})}onKeyDown_(T){const F=Is(this.baseStep_,Wl(T));F!==0&&this.value.setRawValue(this.value.rawValue+F,{forceEmit:!1,last:!1})}onKeyUp_(T){Is(this.baseStep_,Wl(T))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ud=X("sldtxt");class xg{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(ud());const de=T.createElement("div");de.classList.add(ud("s")),this.sliderView_=F.sliderView,de.appendChild(this.sliderView_.element),this.element.appendChild(de);const Fe=T.createElement("div");Fe.classList.add(ud("t")),this.textView_=F.textView,Fe.appendChild(this.textView_.element),this.element.appendChild(Fe)}}class _h{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.sliderC_=new ao(T,{baseStep:F.baseStep,props:F.sliderProps,value:F.value,viewProps:this.viewProps}),this.textC_=new gh(T,{baseStep:F.baseStep,parser:F.parser,props:F.textProps,sliderProps:F.sliderProps,value:F.value,viewProps:F.viewProps}),this.view=new xg(T,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Hu(ie,T){ie.write(T)}function Xp(ie){const T=Ye;return Array.isArray(ie)?T.required.array(T.required.object({text:T.required.string,value:T.required.raw}))(ie).value:typeof ie=="object"?T.required.raw(ie).value:void 0}function wg(ie){if(ie==="inline"||ie==="popup")return ie}function vh(ie){const T=Ye;return T.required.object({max:T.optional.number,min:T.optional.number,step:T.optional.number})(ie).value}function fs(ie){if(Array.isArray(ie))return ie;const T=[];return Object.keys(ie).forEach(F=>{T.push({text:F,value:ie[F]})}),T}function Eg(ie){return j(ie)?null:new ct(fs(ie))}function qf(ie,T){const F=ie&&Pe(ie,Ke);return F?Gu(F.step):Math.max(Gu(T),2)}function Zd(ie){const T=function(F){const de=F?Pe(F,Ke):null;return de?de.step:null}(ie);return T??1}function ep(ie,T){var F;const de=ie&&Pe(ie,Ke),Fe=Math.abs((F=de==null?void 0:de.step)!==null&&F!==void 0?F:T);return Fe===0?.1:Math.pow(10,Math.floor(Math.log10(Fe))-1)}const Yp=X("ckb");class Sg{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),this.element=T.createElement("div"),this.element.classList.add(Yp()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("label");de.classList.add(Yp("l")),this.element.appendChild(de);const Fe=T.createElement("input");Fe.classList.add(Yp("i")),Fe.type="checkbox",de.appendChild(Fe),this.inputElement=Fe,F.viewProps.bindDisabled(this.inputElement);const Mt=T.createElement("div");Mt.classList.add(Yp("w")),de.appendChild(Mt);const kt=Xe(T,"check");Mt.appendChild(kt),F.value.emitter.on("change",this.onValueChange_),this.value=F.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Xf{constructor(T,F){this.onInputChange_=this.onInputChange_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.view=new Sg(T,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(T){const F=T.currentTarget;this.value.rawValue=F.checked}}const sl={id:"input-bool",type:"input",accept:(ie,T)=>{if(typeof ie!="boolean")return null;const F=it(T,{options:Ye.optional.custom(Xp)});return F?{initialValue:ie,params:F}:null},binding:{reader:ie=>Ai,constraint:ie=>function(T){const F=[],de=Eg(T.options);return de&&F.push(de),new er(F)}(ie.params),writer:ie=>Hu},controller:ie=>{const T=ie.document,F=ie.value,de=ie.constraint,Fe=de&&Pe(de,ct);return Fe?new Wt(T,{props:new Ce({options:Fe.values.value("options")}),value:F,viewProps:ie.viewProps}):new Xf(T,{value:F,viewProps:ie.viewProps})}},qs=X("col");class tp{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(qs()),F.foldable.bindExpandedClass(this.element,qs(void 0,"expanded")),ge(F.foldable,"completed",Ae(this.element,qs(void 0,"cpl")));const de=T.createElement("div");de.classList.add(qs("h")),this.element.appendChild(de);const Fe=T.createElement("div");Fe.classList.add(qs("s")),de.appendChild(Fe),this.swatchElement=Fe;const Mt=T.createElement("div");if(Mt.classList.add(qs("t")),de.appendChild(Mt),this.textElement=Mt,F.pickerLayout==="inline"){const kt=T.createElement("div");kt.classList.add(qs("p")),this.element.appendChild(kt),this.pickerElement=kt}else this.pickerElement=null}}function ei(ie,T,F){const de=Nr(ie,360),Fe=Ts(T/100,0,1),Mt=Ts(F/100,0,1),kt=Mt*Fe,Tn=kt*(1-Math.abs(de/60%2-1)),gi=Mt-kt;let zi,Tr,eo;return[zi,Tr,eo]=de>=0&&de<60?[kt,Tn,0]:de>=60&&de<120?[Tn,kt,0]:de>=120&&de<180?[0,kt,Tn]:de>=180&&de<240?[0,Tn,kt]:de>=240&&de<300?[Tn,0,kt]:[kt,0,Tn],[255*(zi+gi),255*(Tr+gi),255*(eo+gi)]}function uc(ie){return[ie[0],ie[1],ie[2]]}function Cl(ie,T){return[ie[0],ie[1],ie[2],T]}const xo={hsl:{hsl:(ie,T,F)=>[ie,T,F],hsv:function(ie,T,F){const de=F+T*(100-Math.abs(2*F-100))/200;return[ie,de!==0?T*(100-Math.abs(2*F-100))/de:0,F+T*(100-Math.abs(2*F-100))/200]},rgb:function(ie,T,F){const de=(ie%360+360)%360,Fe=Ts(T/100,0,1),Mt=Ts(F/100,0,1),kt=(1-Math.abs(2*Mt-1))*Fe,Tn=kt*(1-Math.abs(de/60%2-1)),gi=Mt-kt/2;let zi,Tr,eo;return[zi,Tr,eo]=de>=0&&de<60?[kt,Tn,0]:de>=60&&de<120?[Tn,kt,0]:de>=120&&de<180?[0,kt,Tn]:de>=180&&de<240?[0,Tn,kt]:de>=240&&de<300?[Tn,0,kt]:[kt,0,Tn],[255*(zi+gi),255*(Tr+gi),255*(eo+gi)]}},hsv:{hsl:function(ie,T,F){const de=100-Math.abs(F*(200-T)/100-100);return[ie,de!==0?T*F/de:0,F*(200-T)/200]},hsv:(ie,T,F)=>[ie,T,F],rgb:ei},rgb:{hsl:function(ie,T,F){const de=Ts(ie/255,0,1),Fe=Ts(T/255,0,1),Mt=Ts(F/255,0,1),kt=Math.max(de,Fe,Mt),Tn=Math.min(de,Fe,Mt),gi=kt-Tn;let zi=0,Tr=0;const eo=(Tn+kt)/2;return gi!==0&&(Tr=gi/(1-Math.abs(kt+Tn-1)),zi=de===kt?(Fe-Mt)/gi:Fe===kt?2+(Mt-de)/gi:4+(de-Fe)/gi,zi=zi/6+(zi<0?1:0)),[360*zi,100*Tr,100*eo]},hsv:function(ie,T,F){const de=Ts(ie/255,0,1),Fe=Ts(T/255,0,1),Mt=Ts(F/255,0,1),kt=Math.max(de,Fe,Mt),Tn=kt-Math.min(de,Fe,Mt);let gi;return gi=Tn===0?0:kt===de?((Fe-Mt)/Tn%6+6)%6*60:kt===Fe?60*((Mt-de)/Tn+2):60*((de-Fe)/Tn+4),[gi,100*(kt===0?0:Tn/kt),100*kt]},rgb:(ie,T,F)=>[ie,T,F]}};function np(ie,T){return[T==="float"?1:ie==="rgb"?255:360,T==="float"?1:ie==="rgb"?255:100,T==="float"?1:ie==="rgb"?255:100]}function yh(ie,T,F,de){const Fe=np(T,F),Mt=np(T,de);return ie.map((kt,Tn)=>kt/Fe[Tn]*Mt[Tn])}function Wu(ie,T){return typeof ie=="object"&&!j(ie)&&T in ie&&typeof ie[T]=="number"}class kr{static black(T="int"){return new kr([0,0,0],"rgb",T)}static fromObject(T,F="int"){const de="a"in T?[T.r,T.g,T.b,T.a]:[T.r,T.g,T.b];return new kr(de,"rgb",F)}static toRgbaObject(T,F="int"){return T.toRgbaObject(F)}static isRgbColorObject(T){return Wu(T,"r")&&Wu(T,"g")&&Wu(T,"b")}static isRgbaColorObject(T){return this.isRgbColorObject(T)&&Wu(T,"a")}static isColorObject(T){return this.isRgbColorObject(T)}static equals(T,F){if(T.mode!==F.mode)return!1;const de=T.comps_,Fe=F.comps_;for(let Mt=0;Mt<de.length;Mt++)if(de[Mt]!==Fe[Mt])return!1;return!0}constructor(T,F,de="int"){this.mode=F,this.type=de,this.comps_=function(Fe,Mt,kt){var Tn;const gi=np(Mt,kt);return[Mt==="rgb"?Ts(Fe[0],0,gi[0]):(zi=Fe[0],Tr=gi[0],zi===Tr?Tr:Nr(zi,Tr)),Ts(Fe[1],0,gi[1]),Ts(Fe[2],0,gi[2]),Ts((Tn=Fe[3])!==null&&Tn!==void 0?Tn:1,0,1)];var zi,Tr}(T,F,de)}getComponents(T,F="int"){return Cl(function(de,Fe,Mt){const kt=yh(de,Fe.mode,Fe.type,"int");return yh(xo[Fe.mode][Mt.mode](...kt),Mt.mode,"int",Mt.type)}(uc(this.comps_),{mode:this.mode,type:this.type},{mode:T??this.mode,type:F}),this.comps_[3])}toRgbaObject(T="int"){const F=this.getComponents("rgb",T);return{r:F[0],g:F[1],b:F[2],a:F[3]}}}const qo=X("colp");class aa{constructor(T,F){this.alphaViews_=null,this.element=T.createElement("div"),this.element.classList.add(qo()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(qo("hsv"));const Fe=T.createElement("div");Fe.classList.add(qo("sv")),this.svPaletteView_=F.svPaletteView,Fe.appendChild(this.svPaletteView_.element),de.appendChild(Fe);const Mt=T.createElement("div");Mt.classList.add(qo("h")),this.hPaletteView_=F.hPaletteView,Mt.appendChild(this.hPaletteView_.element),de.appendChild(Mt),this.element.appendChild(de);const kt=T.createElement("div");if(kt.classList.add(qo("rgb")),this.textView_=F.textView,kt.appendChild(this.textView_.element),this.element.appendChild(kt),F.alphaViews){this.alphaViews_={palette:F.alphaViews.palette,text:F.alphaViews.text};const Tn=T.createElement("div");Tn.classList.add(qo("a"));const gi=T.createElement("div");gi.classList.add(qo("ap")),gi.appendChild(this.alphaViews_.palette.element),Tn.appendChild(gi);const zi=T.createElement("div");zi.classList.add(qo("at")),zi.appendChild(this.alphaViews_.text.element),Tn.appendChild(zi),this.element.appendChild(Tn)}}get allFocusableElements(){const T=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(F=>F.inputElement)];return this.alphaViews_&&T.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),T}}function rs(ie){return ie==="int"?"int":ie==="float"?"float":void 0}function ip(ie){const T=Ye;return it(ie,{alpha:T.optional.boolean,color:T.optional.object({alpha:T.optional.boolean,type:T.optional.custom(rs)}),expanded:T.optional.boolean,picker:T.optional.custom(wg)})}function li(ie){return ie?.1:1}function Ji(ie){var T;return(T=ie.color)===null||T===void 0?void 0:T.type}function Gs(ie,T){const F=ie.match(/^(.+)%$/);return Math.min(F?.01*parseFloat(F[1])*T:parseFloat(ie),T)}const hd={deg:ie=>ie,grad:ie=>360*ie/400,rad:ie=>360*ie/(2*Math.PI),turn:ie=>360*ie};function Ah(ie){const T=ie.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!T)return parseFloat(ie);const F=parseFloat(T[1]),de=T[2];return hd[de](F)}function ol(ie){const T=ie.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!T)return null;const F=[Gs(T[1],255),Gs(T[2],255),Gs(T[3],255)];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])?null:F}function hc(ie){return T=>{const F=ol(T);return F?new kr(F,"rgb",ie):null}}function Ha(ie){const T=ie.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!T)return null;const F=[Gs(T[1],255),Gs(T[2],255),Gs(T[3],255),Gs(T[4],1)];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])||isNaN(F[3])?null:F}function dc(ie){return T=>{const F=Ha(T);return F?new kr(F,"rgb",ie):null}}function Rl(ie){const T=ie.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!T)return null;const F=[Ah(T[1]),Gs(T[2],100),Gs(T[3],100)];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])?null:F}function Il(ie){return T=>{const F=Rl(T);return F?new kr(F,"hsl",ie):null}}function Yf(ie){const T=ie.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!T)return null;const F=[Ah(T[1]),Gs(T[2],100),Gs(T[3],100),Gs(T[4],1)];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])||isNaN(F[3])?null:F}function rv(ie){return T=>{const F=Yf(T);return F?new kr(F,"hsl",ie):null}}function Kp(ie){const T=ie.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(T)return[parseInt(T[1]+T[1],16),parseInt(T[2]+T[2],16),parseInt(T[3]+T[3],16)];const F=ie.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return F?[parseInt(F[1],16),parseInt(F[2],16),parseInt(F[3],16)]:null}function Kf(ie){const T=ie.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(T)return[parseInt(T[1]+T[1],16),parseInt(T[2]+T[2],16),parseInt(T[3]+T[3],16),Wr(parseInt(T[4]+T[4],16),0,255,0,1)];const F=ie.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return F?[parseInt(F[1],16),parseInt(F[2],16),parseInt(F[3],16),Wr(parseInt(F[4],16),0,255,0,1)]:null}function Wa(ie){const T=ie.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!T)return null;const F=[parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])?null:F}function bh(ie){return T=>{const F=Wa(T);return F?new kr(F,"rgb",ie):null}}function $p(ie){const T=ie.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!T)return null;const F=[parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3]),parseFloat(T[4])];return isNaN(F[0])||isNaN(F[1])||isNaN(F[2])||isNaN(F[3])?null:F}function mu(ie){return T=>{const F=$p(T);return F?new kr(F,"rgb",ie):null}}const $f=[{parser:Kp,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Kf,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:ol,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ha,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Rl,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Yf,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Wa,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:$p,result:{alpha:!0,mode:"rgb",notation:"object"}}];function dd(ie,T="int"){const F=function(de){return $f.reduce((Fe,{parser:Mt,result:kt})=>Fe||(Mt(de)?kt:null),null)}(ie);return F?F.notation==="hex"&&T!=="float"?Object.assign(Object.assign({},F),{type:"int"}):F.notation==="func"?Object.assign(Object.assign({},F),{type:T}):null:null}const Us={int:[function(ie){const T=Kp(ie);return T?new kr(T,"rgb","int"):null},function(ie){const T=Kf(ie);return T?new kr(T,"rgb","int"):null},hc("int"),dc("int"),Il("int"),rv("int"),bh("int"),mu("int")],float:[hc("float"),dc("float"),Il("float"),rv("float"),bh("float"),mu("float")]};function Vr(ie){const T=Us[ie];return F=>T.reduce((de,Fe)=>de||Fe(F),null)}function va(ie){const T=Ts(Math.floor(ie),0,255).toString(16);return T.length===1?`0${T}`:T}function pc(ie,T="#"){return`${T}${uc(ie.getComponents("rgb")).map(va).join("")}`}function jc(ie,T="#"){const F=ie.getComponents("rgb");return`${T}${[F[0],F[1],F[2],255*F[3]].map(va).join("")}`}function ko(ie,T){const F=rr(T==="float"?2:0);return`rgb(${uc(ie.getComponents("rgb",T)).map(de=>F(de)).join(", ")})`}function rp(ie){return T=>ko(T,ie)}function gu(ie,T){const F=rr(2),de=rr(T==="float"?2:0);return`rgba(${ie.getComponents("rgb",T).map((Fe,Mt)=>(Mt===3?F:de)(Fe)).join(", ")})`}function Pl(ie){return T=>gu(T,ie)}function zt(ie,T){const F=rr(T==="float"?2:0),de=["r","g","b"];return`{${uc(ie.getComponents("rgb",T)).map((Fe,Mt)=>`${de[Mt]}: ${F(Fe)}`).join(", ")}}`}function pd(ie){return T=>zt(T,ie)}function _u(ie,T){const F=rr(2),de=rr(T==="float"?2:0),Fe=["r","g","b","a"];return`{${ie.getComponents("rgb",T).map((Mt,kt)=>`${Fe[kt]}: ${(kt===3?F:de)(Mt)}`).join(", ")}}`}function Ql(ie){return T=>_u(T,ie)}const fc=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:pc},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:jc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(ie){const T=[rr(0),$s,$s];return`hsl(${uc(ie.getComponents("hsl")).map((F,de)=>T[de](F)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(ie){const T=[rr(0),$s,$s,rr(2)];return`hsla(${ie.getComponents("hsl").map((F,de)=>T[de](F)).join(", ")})`}},...["int","float"].reduce((ie,T)=>[...ie,{format:{alpha:!1,mode:"rgb",notation:"func",type:T},stringifier:rp(T)},{format:{alpha:!0,mode:"rgb",notation:"func",type:T},stringifier:Pl(T)},{format:{alpha:!1,mode:"rgb",notation:"object",type:T},stringifier:pd(T)},{format:{alpha:!0,mode:"rgb",notation:"object",type:T},stringifier:Ql(T)}],[])];function mc(ie){return fc.reduce((T,F)=>{return T||(de=F.format,Fe=ie,de.alpha===Fe.alpha&&de.mode===Fe.mode&&de.notation===Fe.notation&&de.type===Fe.type?F.stringifier:null);var de,Fe},null)}const gc=X("apl");class vu{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),this.value=F.value,this.value.emitter.on("change",this.onValueChange_),this.element=T.createElement("div"),this.element.classList.add(gc()),F.viewProps.bindClassModifiers(this.element),F.viewProps.bindTabIndex(this.element);const de=T.createElement("div");de.classList.add(gc("b")),this.element.appendChild(de);const Fe=T.createElement("div");Fe.classList.add(gc("c")),de.appendChild(Fe),this.colorElem_=Fe;const Mt=T.createElement("div");Mt.classList.add(gc("m")),this.element.appendChild(Mt),this.markerElem_=Mt;const kt=T.createElement("div");kt.classList.add(gc("p")),this.markerElem_.appendChild(kt),this.previewElem_=kt,this.update_()}update_(){const T=this.value.rawValue,F=T.getComponents("rgb"),de=new kr([F[0],F[1],F[2],0],"rgb"),Fe=new kr([F[0],F[1],F[2],255],"rgb"),Mt=["to right",gu(de),gu(Fe)];this.colorElem_.style.background=`linear-gradient(${Mt.join(",")})`,this.previewElem_.style.backgroundColor=gu(T);const kt=Wr(F[3],0,1,0,100);this.markerElem_.style.left=`${kt}%`}onValueChange_(){this.update_()}}class xh{constructor(T,F){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.view=new vu(T,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Va(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(T,F){if(!T.point)return;const de=T.point.x/T.bounds.width,Fe=this.value.rawValue,[Mt,kt,Tn]=Fe.getComponents("hsv");this.value.setRawValue(new kr([Mt,kt,Tn,de],"hsv"),F)}onPointerDown_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerMove_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerUp_(T){this.handlePointerEvent_(T.data,{forceEmit:!0,last:!0})}onKeyDown_(T){const F=Is(li(!0),Wl(T));if(F===0)return;const de=this.value.rawValue,[Fe,Mt,kt,Tn]=de.getComponents("hsv");this.value.setRawValue(new kr([Fe,Mt,kt,Tn+F],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(T){Is(li(!0),Wl(T))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Qa=X("coltxt");class Vc{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(Qa()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(Qa("m")),this.modeElem_=function(kt){const Tn=kt.createElement("select");return Tn.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((gi,zi)=>{const Tr=kt.createElement("option");return Tr.textContent=zi.text,Tr.value=zi.value,gi.appendChild(Tr),gi},kt.createDocumentFragment())),Tn}(T),this.modeElem_.classList.add(Qa("ms")),de.appendChild(this.modeSelectElement),F.viewProps.bindDisabled(this.modeElem_);const Fe=T.createElement("div");Fe.classList.add(Qa("mm")),Fe.appendChild(Xe(T,"dropdown")),de.appendChild(Fe),this.element.appendChild(de);const Mt=T.createElement("div");Mt.classList.add(Qa("w")),this.element.appendChild(Mt),this.textsElem_=Mt,this.textViews_=F.textViews,this.applyTextViews_(),_e(F.colorMode,kt=>{this.modeElem_.value=kt})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(T){this.textViews_=T,this.applyTextViews_()}applyTextViews_(){dn(this.textsElem_);const T=this.element.ownerDocument;this.textViews_.forEach(F=>{const de=T.createElement("div");de.classList.add(Qa("c")),de.appendChild(F.element),this.textsElem_.appendChild(de)})}}function Gc(ie,T,F){const de=np(ie,T)[F];return new Le({min:0,max:de})}function yu(ie,T,F){return new gh(ie,{arrayPosition:F===0?"fst":F===2?"lst":"mid",baseStep:li(!1),parser:T.parser,props:Ce.fromObject({draggingScale:T.colorType==="float"?.01:1,formatter:(de=T.colorType,rr(de==="float"?2:0))}),value:we(0,{constraint:Gc(T.colorMode,T.colorType,F)}),viewProps:T.viewProps});var de}class wh{constructor(T,F){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=F.colorType,this.parser_=F.parser,this.value=F.value,this.viewProps=F.viewProps,this.colorMode=we(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(T),this.view=new Vc(T,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(T){const F={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},de=[yu(T,F,0),yu(T,F,1),yu(T,F,2)];return de.forEach((Fe,Mt)=>{xr({primary:this.value,secondary:Fe.value,forward:kt=>kt.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[Mt],backward:(kt,Tn)=>{const gi=this.colorMode.rawValue,zi=kt.rawValue.getComponents(gi,this.colorType_);return zi[Mt]=Tn.rawValue,new kr(Cl(uc(zi),zi[3]),gi,this.colorType_)}})}),de}onModeSelectChange_(T){const F=T.currentTarget;this.colorMode.rawValue=F.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Eh=X("hpl");class Jf{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),this.value=F.value,this.value.emitter.on("change",this.onValueChange_),this.element=T.createElement("div"),this.element.classList.add(Eh()),F.viewProps.bindClassModifiers(this.element),F.viewProps.bindTabIndex(this.element);const de=T.createElement("div");de.classList.add(Eh("c")),this.element.appendChild(de);const Fe=T.createElement("div");Fe.classList.add(Eh("m")),this.element.appendChild(Fe),this.markerElem_=Fe,this.update_()}update_(){const T=this.value.rawValue,[F]=T.getComponents("hsv");this.markerElem_.style.backgroundColor=ko(new kr([F,100,100],"hsv"));const de=Wr(F,0,360,0,100);this.markerElem_.style.left=`${de}%`}onValueChange_(){this.update_()}}class Hc{constructor(T,F){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.view=new Jf(T,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Va(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(T,F){if(!T.point)return;const de=Wr(Ts(T.point.x,0,T.bounds.width),0,T.bounds.width,0,360),Fe=this.value.rawValue,[,Mt,kt,Tn]=Fe.getComponents("hsv");this.value.setRawValue(new kr([de,Mt,kt,Tn],"hsv"),F)}onPointerDown_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerMove_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerUp_(T){this.handlePointerEvent_(T.data,{forceEmit:!0,last:!0})}onKeyDown_(T){const F=Is(li(!1),Wl(T));if(F===0)return;const de=this.value.rawValue,[Fe,Mt,kt,Tn]=de.getComponents("hsv");this.value.setRawValue(new kr([Fe+F,Mt,kt,Tn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(T){Is(li(!1),Wl(T))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Jp=X("svp");class sv{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),this.value=F.value,this.value.emitter.on("change",this.onValueChange_),this.element=T.createElement("div"),this.element.classList.add(Jp()),F.viewProps.bindClassModifiers(this.element),F.viewProps.bindTabIndex(this.element);const de=T.createElement("canvas");de.height=64,de.width=64,de.classList.add(Jp("c")),this.element.appendChild(de),this.canvasElement=de;const Fe=T.createElement("div");Fe.classList.add(Jp("m")),this.element.appendChild(Fe),this.markerElem_=Fe,this.update_()}update_(){const T=function(zi){const Tr=zi.ownerDocument.defaultView;return Tr&&"document"in Tr?zi.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!T)return;const F=this.value.rawValue.getComponents("hsv"),de=this.canvasElement.width,Fe=this.canvasElement.height,Mt=T.getImageData(0,0,de,Fe),kt=Mt.data;for(let zi=0;zi<Fe;zi++)for(let Tr=0;Tr<de;Tr++){const eo=Wr(Tr,0,de,0,100),Xa=Wr(zi,0,Fe,100,0),Yo=ei(F[0],eo,Xa),Dl=4*(zi*de+Tr);kt[Dl]=Yo[0],kt[Dl+1]=Yo[1],kt[Dl+2]=Yo[2],kt[Dl+3]=255}T.putImageData(Mt,0,0);const Tn=Wr(F[1],0,100,0,100);this.markerElem_.style.left=`${Tn}%`;const gi=Wr(F[2],0,100,100,0);this.markerElem_.style.top=`${gi}%`}onValueChange_(){this.update_()}}class ss{constructor(T,F){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.view=new sv(T,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Va(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(T,F){if(!T.point)return;const de=Wr(T.point.x,0,T.bounds.width,0,100),Fe=Wr(T.point.y,0,T.bounds.height,100,0),[Mt,,,kt]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new kr([Mt,de,Fe,kt],"hsv"),F)}onPointerDown_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerMove_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerUp_(T){this.handlePointerEvent_(T.data,{forceEmit:!0,last:!0})}onKeyDown_(T){fu(T.key)&&T.preventDefault();const[F,de,Fe,Mt]=this.value.rawValue.getComponents("hsv"),kt=li(!1),Tn=Is(kt,Wl(T)),gi=Is(kt,Vu(T));Tn===0&&gi===0||this.value.setRawValue(new kr([F,de+Tn,Fe+gi,Mt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(T){const F=li(!1),de=Is(F,Wl(T)),Fe=Is(F,Vu(T));de===0&&Fe===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Xo{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.hPaletteC_=new Hc(T,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ss(T,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=F.supportsAlpha?{palette:new xh(T,{value:this.value,viewProps:this.viewProps}),text:new gh(T,{parser:Ri,baseStep:.1,props:Ce.fromObject({draggingScale:.01,formatter:rr(2)}),value:we(0,{constraint:new Le({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&xr({primary:this.value,secondary:this.alphaIcs_.text.value,forward:de=>de.rawValue.getComponents()[3],backward:(de,Fe)=>{const Mt=de.rawValue.getComponents();return Mt[3]=Fe.rawValue,new kr(Mt,de.rawValue.mode)}}),this.textC_=new wh(T,{colorType:F.colorType,parser:Ri,value:this.value,viewProps:this.viewProps}),this.view=new aa(T,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:F.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const la=X("colsw");class al{constructor(T,F){this.onValueChange_=this.onValueChange_.bind(this),F.value.emitter.on("change",this.onValueChange_),this.value=F.value,this.element=T.createElement("div"),this.element.classList.add(la()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(la("sw")),this.element.appendChild(de),this.swatchElem_=de;const Fe=T.createElement("button");Fe.classList.add(la("b")),F.viewProps.bindDisabled(Fe),this.element.appendChild(Fe),this.buttonElement=Fe,this.update_()}update_(){const T=this.value.rawValue;this.swatchElem_.style.backgroundColor=jc(T)}onValueChange_(){this.update_()}}class Au{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.view=new al(T,{value:this.value,viewProps:this.viewProps})}}class Zs{constructor(T,F){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.foldable_=fe.create(F.expanded),this.swatchC_=new Au(T,{value:this.value,viewProps:this.viewProps});const de=this.swatchC_.view.buttonElement;de.addEventListener("blur",this.onButtonBlur_),de.addEventListener("click",this.onButtonClick_),this.textC_=new ui(T,{parser:F.parser,props:Ce.fromObject({formatter:F.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new tp(T,{foldable:this.foldable_,pickerLayout:F.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=F.pickerLayout==="popup"?new gn(T,{viewProps:this.viewProps}):null;const Fe=new Xo(T,{colorType:F.colorType,supportsAlpha:F.supportsAlpha,value:this.value,viewProps:this.viewProps});Fe.view.allFocusableElements.forEach(Mt=>{Mt.addEventListener("blur",this.onPopupChildBlur_),Mt.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Fe,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Fe.view.element),xr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Mt=>Mt.rawValue,backward:(Mt,kt)=>kt.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ve(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(T){if(!this.popC_)return;const F=this.view.element,de=T.relatedTarget;de&&F.contains(de)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(T){if(!this.popC_)return;const F=this.popC_.view.element,de=pn(T);de&&F.contains(de)||de&&de===this.swatchC_.view.buttonElement&&!bn(F.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(T){this.popC_?T.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&T.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function _c(ie){return uc(ie.getComponents("rgb")).reduce((T,F)=>T<<8|255&Math.floor(F),0)}function fd(ie){return ie.getComponents("rgb").reduce((T,F,de)=>T<<8|255&Math.floor(de===3?255*F:F),0)>>>0}function sp(ie){return typeof ie!="number"?kr.black():new kr([(T=ie)>>16&255,T>>8&255,255&T],"rgb");var T}function op(ie){return typeof ie!="number"?kr.black():new kr([(T=ie)>>24&255,T>>16&255,T>>8&255,Wr(255&T,0,255,0,1)],"rgb");var T}function Sh(ie){var T;return!(!(ie!=null&&ie.alpha)&&!(!((T=ie==null?void 0:ie.color)===null||T===void 0)&&T.alpha))}function Gr(ie){return ie?T=>jc(T,"0x"):T=>pc(T,"0x")}const bu={id:"input-color-number",type:"input",accept:(ie,T)=>{if(typeof ie!="number"||!function(de){return"color"in de||"view"in de&&de.view==="color"}(T))return null;const F=ip(T);return F?{initialValue:ie,params:F}:null},binding:{reader:ie=>Sh(ie.params)?op:sp,equals:kr.equals,writer:ie=>function(T){const F=T?fd:_c;return(de,Fe)=>{Hu(de,F(Fe))}}(Sh(ie.params))},controller:ie=>{const T=Sh(ie.params),F="expanded"in ie.params?ie.params.expanded:void 0,de="picker"in ie.params?ie.params.picker:void 0;return new Zs(ie.document,{colorType:"int",expanded:F!=null&&F,formatter:Gr(T),parser:Vr("int"),pickerLayout:de??"popup",supportsAlpha:T,value:ie.value,viewProps:ie.viewProps})}};function ya(ie){return T=>function(F,de){return kr.isColorObject(F)?kr.fromObject(F,de):kr.black(de)}(T,ie)}function Hs(ie,T){return F=>ie?_u(F,T):zt(F,T)}const md={id:"input-color-object",type:"input",accept:(ie,T)=>{if(!kr.isColorObject(ie))return null;const F=ip(T);return F?{initialValue:ie,params:F}:null},binding:{reader:ie=>ya(Ji(ie.params)),equals:kr.equals,writer:ie=>{return de=ie.initialValue,T=kr.isRgbaColorObject(de),F=Ji(ie.params),(Fe,Mt)=>{T?function(kt,Tn,gi){const zi=Tn.toRgbaObject(gi);kt.writeProperty("r",zi.r),kt.writeProperty("g",zi.g),kt.writeProperty("b",zi.b),kt.writeProperty("a",zi.a)}(Fe,Mt,F):function(kt,Tn,gi){const zi=Tn.toRgbaObject(gi);kt.writeProperty("r",zi.r),kt.writeProperty("g",zi.g),kt.writeProperty("b",zi.b)}(Fe,Mt,F)};var T,F,de}},controller:ie=>{var T;const F=kr.isRgbaColorObject(ie.initialValue),de="expanded"in ie.params?ie.params.expanded:void 0,Fe="picker"in ie.params?ie.params.picker:void 0,Mt=(T=Ji(ie.params))!==null&&T!==void 0?T:"int";return new Zs(ie.document,{colorType:Mt,expanded:de!=null&&de,formatter:Hs(F,Mt),parser:Vr(Mt),pickerLayout:Fe??"popup",supportsAlpha:F,value:ie.value,viewProps:ie.viewProps})}},Uo={id:"input-color-string",type:"input",accept:(ie,T)=>{if(typeof ie!="string"||"view"in T&&T.view==="text")return null;const F=dd(ie,Ji(T));if(!F||!mc(F))return null;const de=ip(T);return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>{var T;return function(F){const de=Us[F];return Fe=>{if(typeof Fe!="string")return kr.black(F);const Mt=de.reduce((kt,Tn)=>kt||Tn(Fe),null);return Mt??kr.black(F)}}((T=Ji(ie.params))!==null&&T!==void 0?T:"int")},equals:kr.equals,writer:ie=>{const T=dd(ie.initialValue,Ji(ie.params));if(!T)throw le.shouldNeverHappen();const F=function(de){const Fe=mc(de);return Fe?(Mt,kt)=>{Hu(Mt,Fe(kt))}:null}(T);if(!F)throw le.notBindable();return F}},controller:ie=>{const T=dd(ie.initialValue,Ji(ie.params));if(!T)throw le.shouldNeverHappen();const F=mc(T);if(!F)throw le.shouldNeverHappen();const de="expanded"in ie.params?ie.params.expanded:void 0,Fe="picker"in ie.params?ie.params.picker:void 0;return new Zs(ie.document,{colorType:T.type,expanded:de!=null&&de,formatter:F,parser:Vr(T.type),pickerLayout:Fe??"popup",supportsAlpha:T.alpha,value:ie.value,viewProps:ie.viewProps})}};class ca{constructor(T){this.components=T.components,this.asm_=T.assembly}constrain(T){const F=this.asm_.toComponents(T).map((de,Fe)=>{var Mt,kt;return(kt=(Mt=this.components[Fe])===null||Mt===void 0?void 0:Mt.constrain(de))!==null&&kt!==void 0?kt:de});return this.asm_.fromComponents(F)}}const ua=X("pndtxt");class Zf{constructor(T,F){this.textViews=F.textViews,this.element=T.createElement("div"),this.element.classList.add(ua()),this.textViews.forEach(de=>{const Fe=T.createElement("div");Fe.classList.add(ua("a")),Fe.appendChild(de.element),this.element.appendChild(Fe)})}}class Zp{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.acs_=F.axes.map((de,Fe)=>function(Mt,kt,Tn){return new gh(Mt,{arrayPosition:Tn===0?"fst":Tn===kt.axes.length-1?"lst":"mid",baseStep:kt.axes[Tn].baseStep,parser:kt.parser,props:kt.axes[Tn].textProps,value:we(0,{constraint:kt.axes[Tn].constraint}),viewProps:kt.viewProps})}(T,F,Fe)),this.acs_.forEach((de,Fe)=>{xr({primary:this.value,secondary:de.value,forward:Mt=>F.assembly.toComponents(Mt.rawValue)[Fe],backward:(Mt,kt)=>{const Tn=F.assembly.toComponents(Mt.rawValue);return Tn[Fe]=kt.rawValue,F.assembly.fromComponents(Tn)}})}),this.view=new Zf(T,{textViews:this.acs_.map(de=>de.view)})}}function Mh(ie,T){return"step"in ie&&!j(ie.step)?new Ke(ie.step,T):null}function Th(ie){return j(ie.max)||j(ie.min)?j(ie.max)&&j(ie.min)?null:new ht({max:ie.max,min:ie.min}):new Le({max:ie.max,min:ie.min})}const em={id:"input-number",type:"input",accept:(ie,T)=>{if(typeof ie!="number")return null;const F=Ye,de=it(T,{format:F.optional.function,max:F.optional.number,min:F.optional.number,options:F.optional.custom(Xp),step:F.optional.number});return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>No,constraint:ie=>function(T,F){const de=[],Fe=Mh(T,F);Fe&&de.push(Fe);const Mt=Th(T);Mt&&de.push(Mt);const kt=Eg(T.options);return kt&&de.push(kt),new er(de)}(ie.params,ie.initialValue),writer:ie=>Hu},controller:ie=>{var T;const F=ie.value,de=ie.constraint,Fe=de&&Pe(de,ct);if(Fe)return new Wt(ie.document,{props:new Ce({options:Fe.values.value("options")}),value:F,viewProps:ie.viewProps});const Mt=(T="format"in ie.params?ie.params.format:void 0)!==null&&T!==void 0?T:rr(qf(de,F.rawValue)),kt=de&&Pe(de,Le);return kt?new _h(ie.document,{baseStep:Zd(de),parser:Ri,sliderProps:new Ce({maxValue:kt.values.value("max"),minValue:kt.values.value("min")}),textProps:Ce.fromObject({draggingScale:ep(de,F.rawValue),formatter:Mt}),value:F,viewProps:ie.viewProps}):new gh(ie.document,{baseStep:Zd(de),parser:Ri,props:Ce.fromObject({draggingScale:ep(de,F.rawValue),formatter:Mt}),value:F,viewProps:ie.viewProps})}};class ha{constructor(T=0,F=0){this.x=T,this.y=F}getComponents(){return[this.x,this.y]}static isObject(T){if(j(T))return!1;const F=T.x,de=T.y;return typeof F=="number"&&typeof de=="number"}static equals(T,F){return T.x===F.x&&T.y===F.y}toObject(){return{x:this.x,y:this.y}}}const xu={toComponents:ie=>ie.getComponents(),fromComponents:ie=>new ha(...ie)},wo=X("p2d");class ll{constructor(T,F){this.element=T.createElement("div"),this.element.classList.add(wo()),F.viewProps.bindClassModifiers(this.element),_e(F.expanded,Ae(this.element,wo(void 0,"expanded")));const de=T.createElement("div");de.classList.add(wo("h")),this.element.appendChild(de);const Fe=T.createElement("button");Fe.classList.add(wo("b")),Fe.appendChild(Xe(T,"p2dpad")),F.viewProps.bindDisabled(Fe),de.appendChild(Fe),this.buttonElement=Fe;const Mt=T.createElement("div");if(Mt.classList.add(wo("t")),de.appendChild(Mt),this.textElement=Mt,F.pickerLayout==="inline"){const kt=T.createElement("div");kt.classList.add(wo("p")),this.element.appendChild(kt),this.pickerElement=kt}else this.pickerElement=null}}const qa=X("p2dp");class Wc{constructor(T,F){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=F.invertsY,this.maxValue_=F.maxValue,this.element=T.createElement("div"),this.element.classList.add(qa()),F.layout==="popup"&&this.element.classList.add(qa(void 0,"p")),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("div");de.classList.add(qa("p")),F.viewProps.bindTabIndex(de),this.element.appendChild(de),this.padElement=de;const Fe=T.createElementNS(bt,"svg");Fe.classList.add(qa("g")),this.padElement.appendChild(Fe),this.svgElem_=Fe;const Mt=T.createElementNS(bt,"line");Mt.classList.add(qa("ax")),Mt.setAttributeNS(null,"x1","0"),Mt.setAttributeNS(null,"y1","50%"),Mt.setAttributeNS(null,"x2","100%"),Mt.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(Mt);const kt=T.createElementNS(bt,"line");kt.classList.add(qa("ax")),kt.setAttributeNS(null,"x1","50%"),kt.setAttributeNS(null,"y1","0"),kt.setAttributeNS(null,"x2","50%"),kt.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(kt);const Tn=T.createElementNS(bt,"line");Tn.classList.add(qa("l")),Tn.setAttributeNS(null,"x1","50%"),Tn.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(Tn),this.lineElem_=Tn;const gi=T.createElement("div");gi.classList.add(qa("m")),this.padElement.appendChild(gi),this.markerElem_=gi,F.value.emitter.on("change",this.onValueChange_),this.value=F.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[T,F]=this.value.rawValue.getComponents(),de=this.maxValue_,Fe=Wr(T,-de,+de,0,100),Mt=Wr(F,-de,+de,0,100),kt=this.invertsY_?100-Mt:Mt;this.lineElem_.setAttributeNS(null,"x2",`${Fe}%`),this.lineElem_.setAttributeNS(null,"y2",`${kt}%`),this.markerElem_.style.left=`${Fe}%`,this.markerElem_.style.top=`${kt}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Qu(ie,T,F){return[Is(T[0],Wl(ie)),Is(T[1],Vu(ie))*(F?1:-1)]}class ef{constructor(T,F){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.baseSteps_=F.baseSteps,this.maxValue_=F.maxValue,this.invertsY_=F.invertsY,this.view=new Wc(T,{invertsY:this.invertsY_,layout:F.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Va(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(T,F){if(!T.point)return;const de=this.maxValue_,Fe=Wr(T.point.x,0,T.bounds.width,-de,+de),Mt=Wr(this.invertsY_?T.bounds.height-T.point.y:T.point.y,0,T.bounds.height,-de,+de);this.value.setRawValue(new ha(Fe,Mt),F)}onPointerDown_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerMove_(T){this.handlePointerEvent_(T.data,{forceEmit:!1,last:!1})}onPointerUp_(T){this.handlePointerEvent_(T.data,{forceEmit:!0,last:!0})}onPadKeyDown_(T){fu(T.key)&&T.preventDefault();const[F,de]=Qu(T,this.baseSteps_,this.invertsY_);F===0&&de===0||this.value.setRawValue(new ha(this.value.rawValue.x+F,this.value.rawValue.y+de),{forceEmit:!1,last:!1})}onPadKeyUp_(T){const[F,de]=Qu(T,this.baseSteps_,this.invertsY_);F===0&&de===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class tf{constructor(T,F){var de,Fe;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=F.value,this.viewProps=F.viewProps,this.foldable_=fe.create(F.expanded),this.popC_=F.pickerLayout==="popup"?new gn(T,{viewProps:this.viewProps}):null;const Mt=new ef(T,{baseSteps:[F.axes[0].baseStep,F.axes[1].baseStep],invertsY:F.invertsY,layout:F.pickerLayout,maxValue:F.maxValue,value:this.value,viewProps:this.viewProps});Mt.view.allFocusableElements.forEach(kt=>{kt.addEventListener("blur",this.onPopupChildBlur_),kt.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Mt,this.textC_=new Zp(T,{assembly:xu,axes:F.axes,parser:F.parser,value:this.value,viewProps:this.viewProps}),this.view=new ll(T,{expanded:this.foldable_.value("expanded"),pickerLayout:F.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(de=this.view.buttonElement)===null||de===void 0||de.addEventListener("blur",this.onPadButtonBlur_),(Fe=this.view.buttonElement)===null||Fe===void 0||Fe.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),xr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:kt=>kt.rawValue,backward:(kt,Tn)=>Tn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ve(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(T){if(!this.popC_)return;const F=this.view.element,de=T.relatedTarget;de&&F.contains(de)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(T){if(!this.popC_)return;const F=this.popC_.view.element,de=pn(T);de&&F.contains(de)||de&&de===this.view.buttonElement&&!bn(F.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(T){this.popC_?T.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&T.key==="Escape"&&this.view.buttonElement.focus()}}class wu{constructor(T=0,F=0,de=0){this.x=T,this.y=F,this.z=de}getComponents(){return[this.x,this.y,this.z]}static isObject(T){if(j(T))return!1;const F=T.x,de=T.y,Fe=T.z;return typeof F=="number"&&typeof de=="number"&&typeof Fe=="number"}static equals(T,F){return T.x===F.x&&T.y===F.y&&T.z===F.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ch={toComponents:ie=>ie.getComponents(),fromComponents:ie=>new wu(...ie)};function Qc(ie){return wu.isObject(ie)?new wu(ie.x,ie.y,ie.z):new wu}function bs(ie,T){ie.writeProperty("x",T.x),ie.writeProperty("y",T.y),ie.writeProperty("z",T.z)}function Ca(ie,T){return{baseStep:Zd(T),constraint:T,textProps:Ce.fromObject({draggingScale:ep(T,ie),formatter:rr(qf(T,ie))})}}const Ra={id:"input-point3d",type:"input",accept:(ie,T)=>{if(!wu.isObject(ie))return null;const F=Ye,de=it(T,{x:F.optional.custom(vh),y:F.optional.custom(vh),z:F.optional.custom(vh)});return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>Qc,constraint:ie=>{return T=ie.params,F=ie.initialValue,new ca({assembly:Ch,components:[ws("x"in T?T.x:void 0,F.x),ws("y"in T?T.y:void 0,F.y),ws("z"in T?T.z:void 0,F.z)]});var T,F},equals:wu.equals,writer:ie=>bs},controller:ie=>{const T=ie.value,F=ie.constraint;if(!(F instanceof ca))throw le.shouldNeverHappen();return new Zp(ie.document,{assembly:Ch,axes:[Ca(T.rawValue.x,F.components[0]),Ca(T.rawValue.y,F.components[1]),Ca(T.rawValue.z,F.components[2])],parser:Ri,value:T,viewProps:ie.viewProps})}};class Eu{constructor(T=0,F=0,de=0,Fe=0){this.x=T,this.y=F,this.z=de,this.w=Fe}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(T){if(j(T))return!1;const F=T.x,de=T.y,Fe=T.z,Mt=T.w;return typeof F=="number"&&typeof de=="number"&&typeof Fe=="number"&&typeof Mt=="number"}static equals(T,F){return T.x===F.x&&T.y===F.y&&T.z===F.z&&T.w===F.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const qc={toComponents:ie=>ie.getComponents(),fromComponents:ie=>new Eu(...ie)};function vc(ie){return Eu.isObject(ie)?new Eu(ie.x,ie.y,ie.z,ie.w):new Eu}function yc(ie,T){ie.writeProperty("x",T.x),ie.writeProperty("y",T.y),ie.writeProperty("z",T.z),ie.writeProperty("w",T.w)}const Ac={id:"input-point4d",type:"input",accept:(ie,T)=>{if(!Eu.isObject(ie))return null;const F=Ye,de=it(T,{x:F.optional.custom(vh),y:F.optional.custom(vh),z:F.optional.custom(vh),w:F.optional.custom(vh)});return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>vc,constraint:ie=>{return T=ie.params,F=ie.initialValue,new ca({assembly:qc,components:[ws("x"in T?T.x:void 0,F.x),ws("y"in T?T.y:void 0,F.y),ws("z"in T?T.z:void 0,F.z),ws("w"in T?T.w:void 0,F.w)]});var T,F},equals:Eu.equals,writer:ie=>yc},controller:ie=>{const T=ie.value,F=ie.constraint;if(!(F instanceof ca))throw le.shouldNeverHappen();return new Zp(ie.document,{assembly:qc,axes:T.rawValue.getComponents().map((de,Fe)=>{return Mt=de,{baseStep:Zd(kt=F.components[Fe]),constraint:kt,textProps:Ce.fromObject({draggingScale:ep(kt,Mt),formatter:rr(qf(kt,Mt))})};var Mt,kt}),parser:Ri,value:T,viewProps:ie.viewProps})}},gd={id:"input-string",type:"input",accept:(ie,T)=>{if(typeof ie!="string")return null;const F=it(T,{options:Ye.optional.custom(Xp)});return F?{initialValue:ie,params:F}:null},binding:{reader:ie=>vr,constraint:ie=>function(T){const F=[],de=Eg(T.options);return de&&F.push(de),new er(F)}(ie.params),writer:ie=>Hu},controller:ie=>{const T=ie.document,F=ie.value,de=ie.constraint,Fe=de&&Pe(de,ct);return Fe?new Wt(T,{props:new Ce({options:Fe.values.value("options")}),value:F,viewProps:ie.viewProps}):new ui(T,{parser:Mt=>Mt,props:Ce.fromObject({formatter:Ta}),value:F,viewProps:ie.viewProps})}},qu={monitor:{defaultInterval:200,defaultLineCount:3}},ql=X("mll");class _d{constructor(T,F){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=F.formatter,this.element=T.createElement("div"),this.element.classList.add(ql()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("textarea");de.classList.add(ql("i")),de.style.height=`calc(var(--bld-us) * ${F.lineCount})`,de.readOnly=!0,F.viewProps.bindDisabled(de),this.element.appendChild(de),this.textareaElem_=de,F.value.emitter.on("change",this.onValueUpdate_),this.value=F.value,this.update_()}update_(){const T=this.textareaElem_,F=T.scrollTop===T.scrollHeight-T.clientHeight,de=[];this.value.rawValue.forEach(Fe=>{Fe!==void 0&&de.push(this.formatter_(Fe))}),T.textContent=de.join(`
`),F&&(T.scrollTop=T.scrollHeight)}onValueUpdate_(){this.update_()}}class Cs{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.view=new _d(T,{formatter:F.formatter,lineCount:F.lineCount,value:this.value,viewProps:this.viewProps})}}const ap=X("sgl");class da{constructor(T,F){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=F.formatter,this.element=T.createElement("div"),this.element.classList.add(ap()),F.viewProps.bindClassModifiers(this.element);const de=T.createElement("input");de.classList.add(ap("i")),de.readOnly=!0,de.type="text",F.viewProps.bindDisabled(de),this.element.appendChild(de),this.inputElement=de,F.value.emitter.on("change",this.onValueUpdate_),this.value=F.value,this.update_()}update_(){const T=this.value.rawValue,F=T[T.length-1];this.inputElement.value=F!==void 0?this.formatter_(F):""}onValueUpdate_(){this.update_()}}class lp{constructor(T,F){this.value=F.value,this.viewProps=F.viewProps,this.view=new da(T,{formatter:F.formatter,value:this.value,viewProps:this.viewProps})}}const Rh={id:"monitor-bool",type:"monitor",accept:(ie,T)=>{if(typeof ie!="boolean")return null;const F=it(T,{lineCount:Ye.optional.number});return F?{initialValue:ie,params:F}:null},binding:{reader:ie=>Ai},controller:ie=>{var T;return ie.value.rawValue.length===1?new lp(ie.document,{formatter:Bn,value:ie.value,viewProps:ie.viewProps}):new Cs(ie.document,{formatter:Bn,lineCount:(T=ie.params.lineCount)!==null&&T!==void 0?T:qu.monitor.defaultLineCount,value:ie.value,viewProps:ie.viewProps})}},Fo=X("grl");class bc{constructor(T,F){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=T.createElement("div"),this.element.classList.add(Fo()),F.viewProps.bindClassModifiers(this.element),this.formatter_=F.formatter,this.props_=F.props,this.cursor_=F.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const de=T.createElementNS(bt,"svg");de.classList.add(Fo("g")),de.style.height=`calc(var(--bld-us) * ${F.lineCount})`,this.element.appendChild(de),this.svgElem_=de;const Fe=T.createElementNS(bt,"polyline");this.svgElem_.appendChild(Fe),this.lineElem_=Fe;const Mt=T.createElement("div");Mt.classList.add(Fo("t"),X("tt")()),this.element.appendChild(Mt),this.tooltipElem_=Mt,F.value.emitter.on("change",this.onValueUpdate_),this.value=F.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const T=this.svgElem_.getBoundingClientRect(),F=this.value.rawValue.length-1,de=this.props_.get("minValue"),Fe=this.props_.get("maxValue"),Mt=[];this.value.rawValue.forEach((Tr,eo)=>{if(Tr===void 0)return;const Xa=Wr(eo,0,F,0,T.width),Yo=Wr(Tr,de,Fe,T.height,0);Mt.push([Xa,Yo].join(","))}),this.lineElem_.setAttributeNS(null,"points",Mt.join(" "));const kt=this.tooltipElem_,Tn=this.value.rawValue[this.cursor_.rawValue];if(Tn===void 0)return void kt.classList.remove(Fo("t","a"));const gi=Wr(this.cursor_.rawValue,0,F,0,T.width),zi=Wr(Tn,de,Fe,T.height,0);kt.style.left=`${gi}px`,kt.style.top=`${zi}px`,kt.textContent=`${this.formatter_(Tn)}`,kt.classList.contains(Fo("t","a"))||(kt.classList.add(Fo("t","a"),Fo("t","in")),sn(kt),kt.classList.remove(Fo("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Xc{constructor(T,F){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=F.props,this.value=F.value,this.viewProps=F.viewProps,this.cursor_=we(-1),this.view=new bc(T,{cursor:this.cursor_,formatter:F.formatter,lineCount:F.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),bn(T)){const de=new Va(this.view.element);de.emitter.on("down",this.onGraphPointerDown_),de.emitter.on("move",this.onGraphPointerMove_),de.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(T){const F=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Wr(T.offsetX,0,F.width,0,this.value.rawValue.length))}onGraphPointerDown_(T){this.onGraphPointerMove_(T)}onGraphPointerMove_(T){T.data.point?this.cursor_.rawValue=Math.floor(Wr(T.data.point.x,0,T.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Fi(ie){return"format"in ie&&!j(ie.format)?ie.format:rr(2)}function Ls(ie){return"view"in ie&&ie.view==="graph"}const Ia={id:"monitor-number",type:"monitor",accept:(ie,T)=>{if(typeof ie!="number")return null;const F=Ye,de=it(T,{format:F.optional.function,lineCount:F.optional.number,max:F.optional.number,min:F.optional.number,view:F.optional.string});return de?{initialValue:ie,params:de}:null},binding:{defaultBufferSize:ie=>Ls(ie)?64:1,reader:ie=>No},controller:ie=>Ls(ie.params)?function(T){var F,de,Fe;return new Xc(T.document,{formatter:Fi(T.params),lineCount:(F=T.params.lineCount)!==null&&F!==void 0?F:qu.monitor.defaultLineCount,props:Ce.fromObject({maxValue:(de="max"in T.params?T.params.max:null)!==null&&de!==void 0?de:100,minValue:(Fe="min"in T.params?T.params.min:null)!==null&&Fe!==void 0?Fe:0}),value:T.value,viewProps:T.viewProps})}(ie):function(T){var F;return T.value.rawValue.length===1?new lp(T.document,{formatter:Fi(T.params),value:T.value,viewProps:T.viewProps}):new Cs(T.document,{formatter:Fi(T.params),lineCount:(F=T.params.lineCount)!==null&&F!==void 0?F:qu.monitor.defaultLineCount,value:T.value,viewProps:T.viewProps})}(ie)},ho={id:"monitor-string",type:"monitor",accept:(ie,T)=>{if(typeof ie!="string")return null;const F=Ye,de=it(T,{lineCount:F.optional.number,multiline:F.optional.boolean});return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>vr},controller:ie=>{var T;const F=ie.value;return F.rawValue.length>1||"multiline"in ie.params&&ie.params.multiline?new Cs(ie.document,{formatter:Ta,lineCount:(T=ie.params.lineCount)!==null&&T!==void 0?T:qu.monitor.defaultLineCount,value:F,viewProps:ie.viewProps}):new lp(ie.document,{formatter:Ta,value:F,viewProps:ie.viewProps})}};function po(ie,T){return T===0?new un:new Gn(ie,T??qu.monitor.defaultInterval)}class zo{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(T){T.type==="blade"?this.pluginsMap_.blades.unshift(T):T.type==="input"?this.pluginsMap_.inputs.unshift(T):T.type==="monitor"&&this.pluginsMap_.monitors.unshift(T)}createInput(T,F,de){if(j(F.read()))throw new le({context:{key:F.key},type:"nomatchingcontroller"});const Fe=this.pluginsMap_.inputs.reduce((Mt,kt)=>Mt??function(Tn,gi){const zi=Tn.accept(gi.target.read(),gi.params);if(j(zi))return null;const Tr=Ye,eo={target:gi.target,initialValue:zi.initialValue,params:zi.params},Xa=Tn.binding.reader(eo),Yo=Tn.binding.constraint?Tn.binding.constraint(eo):void 0,Dl=we(Xa(zi.initialValue),{constraint:Yo,equals:Tn.binding.equals}),jo=new Yi({reader:Xa,target:gi.target,value:Dl,writer:Tn.binding.writer(eo)}),xc=Tr.optional.boolean(gi.params.disabled).value,tm=Tr.optional.boolean(gi.params.hidden).value,yd=Tn.controller({constraint:Yo,document:gi.document,initialValue:zi.initialValue,params:zi.params,value:jo.value,viewProps:Nt.create({disabled:xc,hidden:tm})}),up=Tr.optional.string(gi.params.label).value;return new $t(gi.document,{binding:jo,blade:Hn(),props:Ce.fromObject({label:up??gi.target.key}),valueController:yd})}(kt,{document:T,target:F,params:de}),null);if(Fe)return Fe;throw new le({context:{key:F.key},type:"nomatchingcontroller"})}createMonitor(T,F,de){const Fe=this.pluginsMap_.monitors.reduce((Mt,kt)=>Mt??function(Tn,gi){var zi,Tr,eo;const Xa=Ye,Yo=Tn.accept(gi.target.read(),gi.params);if(j(Yo))return null;const Dl={target:gi.target,initialValue:Yo.initialValue,params:Yo.params},jo=Tn.binding.reader(Dl),xc=(Tr=(zi=Xa.optional.number(gi.params.bufferSize).value)!==null&&zi!==void 0?zi:Tn.binding.defaultBufferSize&&Tn.binding.defaultBufferSize(Yo.params))!==null&&Tr!==void 0?Tr:1,tm=Xa.optional.number(gi.params.interval).value,yd=new Yn({reader:jo,target:gi.target,ticker:po(gi.document,tm),value:Er(xc)}),up=Xa.optional.boolean(gi.params.disabled).value,Ad=Xa.optional.boolean(gi.params.hidden).value,bd=Tn.controller({document:gi.document,params:Yo.params,value:yd.value,viewProps:Nt.create({disabled:up,hidden:Ad})}),Ko=(eo=Xa.optional.string(gi.params.label).value)!==null&&eo!==void 0?eo:gi.target.key;return new Ht(gi.document,{binding:yd,blade:Hn(),props:Ce.fromObject({label:Ko}),valueController:bd})}(kt,{document:T,params:de,target:F}),null);if(Fe)return Fe;throw new le({context:{key:F.key},type:"nomatchingcontroller"})}createBlade(T,F){const de=this.pluginsMap_.blades.reduce((Fe,Mt)=>Fe??function(kt,Tn){const gi=kt.accept(Tn.params);if(!gi)return null;const zi=Ye.optional.boolean(Tn.params.disabled).value,Tr=Ye.optional.boolean(Tn.params.hidden).value;return kt.controller({blade:Hn(),document:Tn.document,params:Object.assign(Object.assign({},gi.params),{disabled:zi,hidden:Tr}),viewProps:Nt.create({disabled:zi,hidden:Tr})})}(Mt,{document:T,params:F}),null);if(!de)throw new le({type:"nomatchingview",context:{params:F}});return de}createBladeApi(T){if(T instanceof $t)return new It(T);if(T instanceof Ht)return new nn(T);if(T instanceof si)return new Nn(T,this);const F=this.pluginsMap_.blades.reduce((de,Fe)=>de??Fe.api({controller:T,pool:this}),null);if(!F)throw le.shouldNeverHappen();return F}}function Es(ie){return ha.isObject(ie)?new ha(ie.x,ie.y):new ha}function Mg(ie,T){ie.writeProperty("x",T.x),ie.writeProperty("y",T.y)}function ws(ie,T){if(!ie)return;const F=[],de=Mh(ie,T);de&&F.push(de);const Fe=Th(ie);return Fe&&F.push(Fe),new er(F)}function vd(ie,T){const[F,de]=ie?function(Mt){const kt=Pe(Mt,Le);if(kt)return[kt.values.get("min"),kt.values.get("max")];const Tn=Pe(Mt,ht);return Tn?[Tn.minValue,Tn.maxValue]:[void 0,void 0]}(ie):[];if(!j(F)||!j(de))return Math.max(Math.abs(F??0),Math.abs(de??0));const Fe=Zd(ie);return Math.max(10*Math.abs(Fe),10*Math.abs(T))}function Ns(ie,T){const F=T instanceof ca?T.components[0]:void 0,de=T instanceof ca?T.components[1]:void 0,Fe=vd(F,ie.x),Mt=vd(de,ie.y);return Math.max(Fe,Mt)}function nf(ie,T){return{baseStep:Zd(T),constraint:T,textProps:Ce.fromObject({draggingScale:ep(T,ie),formatter:rr(qf(T,ie))})}}function ov(ie){if(!("y"in ie))return!1;const T=ie.y;return!!T&&"inverted"in T&&!!T.inverted}const rf={id:"input-point2d",type:"input",accept:(ie,T)=>{if(!ha.isObject(ie))return null;const F=Ye,de=it(T,{expanded:F.optional.boolean,picker:F.optional.custom(wg),x:F.optional.custom(vh),y:F.optional.object({inverted:F.optional.boolean,max:F.optional.number,min:F.optional.number,step:F.optional.number})});return de?{initialValue:ie,params:de}:null},binding:{reader:ie=>Es,constraint:ie=>{return T=ie.params,F=ie.initialValue,new ca({assembly:xu,components:[ws("x"in T?T.x:void 0,F.x),ws("y"in T?T.y:void 0,F.y)]});var T,F},equals:ha.equals,writer:ie=>Mg},controller:ie=>{const T=ie.document,F=ie.value,de=ie.constraint;if(!(de instanceof ca))throw le.shouldNeverHappen();const Fe="expanded"in ie.params?ie.params.expanded:void 0,Mt="picker"in ie.params?ie.params.picker:void 0;return new tf(T,{axes:[nf(F.rawValue.x,de.components[0]),nf(F.rawValue.y,de.components[1])],expanded:Fe!=null&&Fe,invertsY:ov(ie.params),maxValue:Ns(F.rawValue,de),parser:Ri,pickerLayout:Mt??"popup",value:F,viewProps:ie.viewProps})}};class Xl extends v{constructor(T){super(T),this.emitter_=new ce,this.controller_.valueController.value.emitter.on("change",F=>{this.emitter_.emit("change",{event:new M(this,F.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}get options(){return this.controller_.valueController.props.get("options")}set options(T){this.controller_.valueController.props.set("options",T)}get value(){return this.controller_.valueController.value.rawValue}set value(T){this.controller_.valueController.value.rawValue=T}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}}class Ih extends v{constructor(T){super(T),this.emitter_=new ce,this.controller_.valueController.value.emitter.on("change",F=>{this.emitter_.emit("change",{event:new M(this,F.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(T){this.controller_.valueController.sliderController.props.set("maxValue",T)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(T){this.controller_.valueController.sliderController.props.set("minValue",T)}get value(){return this.controller_.valueController.value.rawValue}set value(T){this.controller_.valueController.value.rawValue=T}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}}class Yc extends v{constructor(T){super(T),this.emitter_=new ce,this.controller_.valueController.value.emitter.on("change",F=>{this.emitter_.emit("change",{event:new M(this,F.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(T){this.controller_.props.set("label",T)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(T){this.controller_.valueController.props.set("formatter",T)}get value(){return this.controller_.valueController.value.rawValue}set value(T){this.controller_.valueController.value.rawValue=T}on(T,F){const de=F.bind(this);return this.emitter_.on(T,Fe=>{de(Fe.event)}),this}}const Ph={id:"list",type:"blade",accept(ie){const T=Ye,F=it(ie,{options:T.required.custom(Xp),value:T.required.raw,view:T.required.constant("list"),label:T.optional.string});return F?{params:F}:null},controller(ie){const T=new ct(fs(ie.params.options)),F=we(ie.params.value,{constraint:T}),de=new Wt(ie.document,{props:new Ce({options:T.values.value("options")}),value:F,viewProps:ie.viewProps});return new Xr(ie.document,{blade:ie.blade,props:Ce.fromObject({label:ie.params.label}),valueController:de})},api(ie){return ie.controller instanceof Xr&&ie.controller.valueController instanceof Wt?new Xl(ie.controller):null}};class Aa extends Zn{constructor(T,F){super(T,F)}get element(){return this.controller_.view.element}importPreset(T){(function(F,de){F.forEach(Fe=>{const Mt=de[Fe.target.presetKey];Mt!==void 0&&Fe.writer(Fe.target,Fe.reader(Mt))})})(this.controller_.rackController.rack.find($t).map(F=>F.binding),T),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find($t).map(T=>T.binding.target).reduce((T,F)=>Object.assign(T,{[F.presetKey]:F.read()}),{})}refresh(){this.controller_.rackController.rack.find($t).forEach(T=>{T.binding.read()}),this.controller_.rackController.rack.find(Ht).forEach(T=>{T.binding.read()})}}class tr extends is{constructor(T,F){super(T,{expanded:F.expanded,blade:F.blade,props:F.props,root:!0,viewProps:F.viewProps})}}const cp={id:"slider",type:"blade",accept(ie){const T=Ye,F=it(ie,{max:T.required.number,min:T.required.number,view:T.required.constant("slider"),format:T.optional.function,label:T.optional.string,value:T.optional.number});return F?{params:F}:null},controller(ie){var T,F;const de=(T=ie.params.value)!==null&&T!==void 0?T:0,Fe=new Le({max:ie.params.max,min:ie.params.min}),Mt=new _h(ie.document,{baseStep:1,parser:Ri,sliderProps:new Ce({maxValue:Fe.values.value("max"),minValue:Fe.values.value("min")}),textProps:Ce.fromObject({draggingScale:ep(void 0,de),formatter:(F=ie.params.format)!==null&&F!==void 0?F:br}),value:we(de,{constraint:Fe}),viewProps:ie.viewProps});return new Xr(ie.document,{blade:ie.blade,props:Ce.fromObject({label:ie.params.label}),valueController:Mt})},api(ie){return ie.controller instanceof Xr&&ie.controller.valueController instanceof _h?new Ih(ie.controller):null}},Xu={id:"text",type:"blade",accept(ie){const T=Ye,F=it(ie,{parse:T.required.function,value:T.required.raw,view:T.required.constant("text"),format:T.optional.function,label:T.optional.string});return F?{params:F}:null},controller(ie){var T;const F=new ui(ie.document,{parser:ie.params.parse,props:Ce.fromObject({formatter:(T=ie.params.format)!==null&&T!==void 0?T:de=>String(de)}),value:we(ie.params.value),viewProps:ie.viewProps});return new Xr(ie.document,{blade:ie.blade,props:Ce.fromObject({label:ie.params.label}),valueController:F})},api(ie){return ie.controller instanceof Xr&&ie.controller.valueController instanceof ui?new Yc(ie.controller):null}};function pa(ie,T,F){if(ie.querySelector(`style[data-tp-style=${T}]`))return;const de=ie.createElement("style");de.dataset.tpStyle=T,de.textContent=F,ie.head.appendChild(de)}const sf=new class{constructor(ie){const[T,F]=ie.split("-"),de=T.split(".");this.major=parseInt(de[0],10),this.minor=parseInt(de[1],10),this.patch=parseInt(de[2],10),this.prerelease=F??null}toString(){const ie=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[ie,this.prerelease].join("-"):ie}}("3.1.6");s.BladeApi=v,s.ButtonApi=ve,s.FolderApi=Zn,s.InputBindingApi=It,s.ListApi=Xl,s.MonitorBindingApi=nn,s.Pane=class extends Aa{constructor(ie){var T,F;const de=ie??{},Fe=(T=de.document)!==null&&T!==void 0?T:Un(),Mt=function(){const kt=new zo;return[rf,Ra,Ac,gd,em,Uo,md,bu,sl,Rh,ho,Ia,In,jr,uo,Vn].forEach(Tn=>{kt.register(Tn)}),kt}();super(new tr(Fe,{expanded:de.expanded,blade:Hn(),props:Ce.fromObject({title:de.title}),viewProps:Nt.create()}),Mt),this.pool_=Mt,this.containerElem_=(F=de.container)!==null&&F!==void 0?F:function(kt){const Tn=kt.createElement("div");return Tn.classList.add(X("dfw")()),kt.body&&kt.body.appendChild(Tn),Tn}(Fe),this.containerElem_.appendChild(this.element),this.doc_=Fe,this.usesDefaultWrapper_=!de.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw le.alreadyDisposed();return this.doc_}dispose(){const ie=this.containerElem_;if(!ie)throw le.alreadyDisposed();if(this.usesDefaultWrapper_){const T=ie.parentElement;T&&T.removeChild(ie)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(ie){("plugin"in ie?[ie.plugin]:"plugins"in ie?ie.plugins:[]).forEach(T=>{this.pool_.register(T),this.embedPluginStyle_(T)})}embedPluginStyle_(ie){ie.css&&pa(this.document,`plugin-${ie.id}`,ie.css)}setUpDefaultPlugins_(){pa(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(ie=>{this.embedPluginStyle_(ie)}),this.registerPlugin({plugins:[cp,Ph,Vn,Xu]})}},s.SeparatorApi=cs,s.SliderApi=Ih,s.TabApi=ja,s.TabPageApi=Hl,s.TextApi=Yc,s.TpChangeEvent=M,s.VERSION=sf,Object.defineProperty(s,"__esModule",{value:!0})})(a)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(u){super(u),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}transform(u,a){return u?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(u,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(u=!0,a=!1){return u&&super.preload(),a&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var u;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(u=eval(jsContent+`
DracoEncoderModule;`))==null?void 0:u()}),this.encoderPending}async initDecoder(){var u;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async a=>a.text()).then(a=>{const s=a.indexOf("/* worker */");if(s<1)throw new Error("unable to load decoder module");return a.substring(0,s-1)});return(u=eval(jsContent+`
DracoDecoderModule;`))==null?void 0:u()}async _loadLibrary(u,a){return DRACOLoader2.LibraryValueMap[u]?DRACOLoader2.LibraryValueMap[u]:DRACOLoader2.LibraryValueMap[u]=await super._loadLibrary(u,a)}static SetDecoderJsString(u){this.LibraryValueMap["draco_decoder.js"]=u}}DRACOLoader2.LibraryValueMap={}},988:function(u,a,s){s.d(a,{$TI:function(){return Fd},$V:function(){return SA},$Vf:function(){return o0},$YQ:function(){return Sv},A5E:function(){return Mg},AXT:function(){return Tp},Aip:function(){return uy},B02:function(){return j},BFQ:function(){return Vn},BG$:function(){return dt},BKK:function(){return a0},BVF:function(){return Qt},BVQ:function(){return Os},BbS:function(){return Df},Bf4:function(){return Ve},BtG:function(){return xd},CJI:function(){return Cs},CP7:function(){return Tv},CaW:function(){return ir},CdI:function(){return Pn},Cne:function(){return Ym},CtA:function(){return Lo},CtF:function(){return Jh},D1R:function(){return Mr},D9w:function(){return ja},DT1:function(){return ly},Djp:function(){return Lt},DqL:function(){return ru},DvJ:function(){return Yu},E2K:function(){return Pt},EB7:function(){return Iv},EJi:function(){return Jl},EoG:function(){return pn},F5T:function(){return da},FDw:function(){return ze},FE5:function(){return _o},FIo:function(){return If},FM8:function(){return li},FT0:function(){return q0},FUD:function(){return an},FvO:function(){return n0},GG6:function(){return gn},GQ:function(){return M_},GUF:function(){return Is},GVz:function(){return jc},GZb:function(){return Xm},G_r:function(){return Wl},Gih:function(){return Xn},Gql:function(){return Al},H$k:function(){return Dd},HTd:function(){return Wn},HW6:function(){return OA},HdW:function(){return Kn},HgB:function(){return qf},HkE:function(){return mm},Hmr:function(){return Xv},Hw6:function(){return mu},Hy8:function(){return At},Hyl:function(){return ih},IEO:function(){return Ep},IFH:function(){return Ks},IKL:function(){return ks},ILR:function(){return Gn},IOt:function(){return $s},Ilk:function(){return Fi},Ir4:function(){return Eg},JOQ:function(){return Ku},JQ4:function(){return is},JUT:function(){return ko},JWc:function(){return vh},KI_:function(){return xr},Kgo:function(){return Cp},KhW:function(){return Ne},Kj0:function(){return Ko},Kz5:function(){return Mi},L5g:function(){return BA},L5s:function(){return zs},LBq:function(){return MA},LSk:function(){return Sg},LY2:function(){return vn},L_r:function(){return Xf},Lcc:function(){return P_},LgZ:function(){return it},LsT:function(){return di},Ltg:function(){return Vr},Lun:function(){return xv},M5h:function(){return Ae},M6v:function(){return pi},M8C:function(){return ip},Mig:function(){return su},MyG:function(){return qp},N$j:function(){return zh},N4l:function(){return ge},NDo:function(){return tn},NMF:function(){return Ir},NYV:function(){return Wt},Ns1:function(){return Xe},NwF:function(){return Dp},Ny0:function(){return Dv},O7d:function(){return Pd},OAl:function(){return ao},OM3:function(){return cp},OTo:function(){return za},OdW:function(){return Cd},OoA:function(){return $t},Ox3:function(){return Oc},PA7:function(){return vr},PMe:function(){return yA},Pa4:function(){return zt},PeU:function(){return I},Pnf:function(){return _s},PpQ:function(){return $p},QM0:function(){return fs},QRU:function(){return Bc},QZ1:function(){return wg},QmN:function(){return M},Qpg:function(){return Qm},R2R:function(){return Pc},REq:function(){return I_},RNb:function(){return nf},ROQ:function(){return Pv},RSm:function(){return km},Rki:function(){return vo},RlZ:function(){return Nt},RsA:function(){return x},RvT:function(){return ud},S2y:function(){return U},S3k:function(){return Fm},S9g:function(){return Th},SJI:function(){return wA},SPe:function(){return Kg},SUY:function(){return g_},Se2:function(){return Qe},Sm8:function(){return he},So8:function(){return Yv},SvJ:function(){return Ai},Syv:function(){return Wi},T95:function(){return On},TOt:function(){return o_},TUj:function(){return TA},TUv:function(){return pA},T_1:function(){return s0},T_J:function(){return Nr},T__:function(){return Ov},T_f:function(){return zl},TlE:function(){return Ns},Tme:function(){return bs},Tn7:function(){return Nm},TyD:function(){return nn},U7:function(){return Tm},USm:function(){return Mh},UY4:function(){return e_},UZH:function(){return v},Uk6:function(){return Ul},UlW:function(){return As},Uol:function(){return rh},V1s:function(){return Cg},V4E:function(){return l0},VLJ:function(){return ny},VYz:function(){return Pb},Vdb:function(){return vt},Vj0:function(){return Ol},Vkp:function(){return Ji},VzW:function(){return jr},W2J:function(){return Hu},WMw:function(){return _e},WTc:function(){return ov},WXh:function(){return Yr},Wbm:function(){return ae},WdD:function(){return os},Wid:function(){return To},Wjw:function(){return cy},Wl3:function(){return se},Wpd:function(){return ut},Wqd:function(){return mA},WwZ:function(){return Zi},Wzm:function(){return Sp},XZw:function(){return Nb},Xaj:function(){return ee},Xcj:function(){return ey},XvJ:function(){return _l},Y8D:function(){return sa},YBo:function(){return Pp},YGz:function(){return Cn},YKA:function(){return Ki},YLQ:function(){return Ht},YN5:function(){return ay},YT8:function(){return Mp},Ywn:function(){return rp},Z6B:function(){return ep},ZAu:function(){return Tc},ZQ6:function(){return wf},ZRs:function(){return Wr},ZTh:function(){return Ci},ZZA:function(){return Zl},Z_g:function(){return Tb},Zp0:function(){return qv},Zr5:function(){return ft},ZzF:function(){return Ql},Zzh:function(){return CA},_12:function(){return Da},_3:function(){return jd},_AM:function(){return Yi},_C8:function(){return vl},_Li:function(){return ve},_MY:function(){return te},_YM:function(){return nu},_YX:function(){return RA},_am:function(){return Rg},_fP:function(){return Pl},_iA:function(){return Z},_kC:function(){return Ou},_lf:function(){return bo},_sL:function(){return Ms},a$l:function(){return tr},aCh:function(){return Ta},aH4:function(){return Ln},aLr:function(){return la},aNw:function(){return tc},aVm:function(){return Xl},ad5:function(){return fu},anP:function(){return $u},aq0:function(){return iy},av9:function(){return Ma},b5g:function(){return hA},bBp:function(){return Wm},bGH:function(){return $},b_z:function(){return Rc},bdR:function(){return W},blk:function(){return G0},bnF:function(){return Wh},brP:function(){return Bo},bsb:function(){return Bn},c8b:function(){return we},cBI:function(){return sy},cBK:function(){return zm},cJO:function(){return Pu},cLu:function(){return Xr},cPb:function(){return Eo},cRx:function(){return oa},cU9:function(){return Um},ce8:function(){return Va},cek:function(){return Nu},cum:function(){return _h},dSO:function(){return Se},dUE:function(){return $h},dYG:function(){return Kh},dZ3:function(){return In},dd2:function(){return va},dj0:function(){return Xp},dpR:function(){return Wv},dwk:function(){return le},e62:function(){return Aa},eD:function(){return sn},eMJ:function(){return Ga},eaV:function(){return Er},ehD:function(){return ce},ejS:function(){return Ja},ekQ:function(){return Pe},epp:function(){return Wa},fHI:function(){return $l},fO1:function(){return Mm},fQA:function(){return Fp},fQK:function(){return Mc},fSK:function(){return _t},fY$:function(){return Hn},fto:function(){return Yn},g8_:function(){return We},gH0:function(){return Lc},gSk:function(){return so},g_z:function(){return Nv},ghN:function(){return Ce},gi4:function(){return Ke},gti:function(){return Cm},hEm:function(){return Hl},hH6:function(){return Dc},iAb:function(){return si},iDF:function(){return Ic},iKG:function(){return So},iLg:function(){return iu},iMs:function(){return Bb},iUV:function(){return ms},iWC:function(){return Ze},iWj:function(){return cv},i_9:function(){return Kv},iiP:function(){return ui},irR:function(){return ys},j4z:function(){return xg},j87:function(){return Yc},jAl:function(){return cr},jFi:function(){return X},jZA:function(){return ct},jfJ:function(){return Gu},jwo:function(){return Jd},jyi:function(){return mf},jyz:function(){return Su},k0A:function(){return cs},k74:function(){return Ye},kB5:function(){return Nl},kFz:function(){return gu},kaV:function(){return _A},knz:function(){return br},kqm:function(){return Bf},ksN:function(){return bn},l0P:function(){return er},l8J:function(){return Zd},lCJ:function(){return Ph},lDi:function(){return ka},lGU:function(){return Hi},lLk:function(){return yl},lRF:function(){return U0},lRj:function(){return Qi},lb7:function(){return Fs},lfu:function(){return Bd},lk7:function(){return Zo},m7l:function(){return ec},mSO:function(){return oo},mTL:function(){return K0},mXe:function(){return r_},m_w:function(){return R_},mzJ:function(){return Jv},nls:function(){return gl},ntZ:function(){return oe},ntt:function(){return Vu},nvb:function(){return C_},o8S:function(){return Za},oAp:function(){return C0},oa8:function(){return h_},oqc:function(){return Ts},p3g:function(){return pc},p7y:function(){return Ru},pBf:function(){return sl},pIN:function(){return Ar},pKu:function(){return on},pQR:function(){return Lm},ptH:function(){return Le},qhX:function(){return Xt},qkB:function(){return Oo},qlB:function(){return Ih},qyh:function(){return Zn},rAo:function(){return rf},rBU:function(){return Vi},rDY:function(){return T0},rOj:function(){return Re},r_:function(){return pe},rnI:function(){return No},rpg:function(){return pt},s4_:function(){return Gm},sYA:function(){return Hv},tEQ:function(){return Gv},tGC:function(){return r0},tJx:function(){return IA},tUh:function(){return ba},tf:function(){return y_},tm_:function(){return B},trn:function(){return Lb},u37:function(){return $0},u7G:function(){return Op},u9r:function(){return Fe},uEv:function(){return ni},uL9:function(){return dn},uWy:function(){return It},uXU:function(){return gh},ub3:function(){return K},ujx:function(){return DA},v3W:function(){return un},v9Y:function(){return Yp},vBJ:function(){return Ia},vCF:function(){return bt},vCx:function(){return ji},vZf:function(){return Qn},vmT:function(){return X0},vpT:function(){return Ap},vuL:function(){return Mn},vxC:function(){return fe},w$m:function(){return Un},wJv:function(){return Zr},wem:function(){return Nn},wk1:function(){return uo},woe:function(){return Rv},wuA:function(){return wn},x12:function(){return Vh},x5V:function(){return zc},xEZ:function(){return Us},xG9:function(){return ic},xJs:function(){return rn},xWb:function(){return Ud},xeV:function(){return Cv},xfE:function(){return Fn},xo$:function(){return oh},xoR:function(){return Jo},xsS:function(){return gm},y$t:function(){return Id},y2t:function(){return ht},y8_:function(){return lh},yC1:function(){return Ld},yGw:function(){return Gr},ybr:function(){return qg},yj7:function(){return i_},ylh:function(){return Zv},yo9:function(){return Qg},yt0:function(){return Js},ywz:function(){return yi},yxD:function(){return vA},z$h:function(){return Ri},z81:function(){return rr},z8B:function(){return wp},zHn:function(){return Sh},zbs:function(){return Co},zf8:function(){return s_}});const v="152",x={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},M={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},I=0,B=1,U=2,j=3,te=0,Z=1,oe=2,le=3,se=0,ve=1,ce=2,K=2,X=0,W=1,_e=2,ge=3,Ae=4,ee=5,$=100,ae=101,Re=102,pe=103,he=104,we=200,Ce=201,Ne=202,Ze=203,Ye=204,it=205,_t=206,At=207,vt=208,ut=209,Nt=210,Qt=0,Qe=1,ft=2,bt=3,sn=4,bn=5,Un=6,pi=7,Xe=0,Xt=1,tn=2,dn=0,pn=1,Pn=2,Cn=3,vn=4,In=5,Fn=300,Hn=301,fe=302,Se=303,Ve=304,We=306,pt=1e3,It=1001,$t=1002,nn=1003,Ht=1004,Wn=1004,Ln=1005,Qn=1005,Nn=1006,Zn=1007,Qi=1007,Mr=1008,ze=1008,yi=1009,On=1010,si=1011,di=1012,Mi=1013,is=1014,jr=1015,Xr=1016,cs=1017,ys=1018,Zr=1020,za=1021,uo=1023,sa=1024,oa=1025,Oo=1026,Bo=1027,Hl=1028,ja=1029,Ma=1030,Lo=1031,Pt=1033,wn=33776,Vn=33777,un=33778,Gn=33779,Yi=35840,ji=35841,Er=35842,ir=35843,Yn=36196,er=37492,Pe=37496,Le=37808,ct=37809,ht=37810,Ke=37811,Lt=37812,dt=37813,Wt=37814,rn=37815,on=37816,gn=37817,Xn=37818,an=37819,ui=37820,Ai=37821,Bn=36492,Kn=36283,Mn=36284,Ci=36285,Hi=36286,cr=2200,Ki=2201,ni=2202,Wi=2300,Ir=2301,Ar=2302,_s=2400,bo=2401,Ms=2402,Ks=2500,so=2501,Zi=0,As=1,Ri=2,No=3e3,br=3001,rr=3200,oo=3201,$s=0,vr=1,Ta="",xr="srgb",Is="srgb-linear",Vu="display-p3",Wl="rgbm-16",fu=0,zc=7680,Va=7681,Wr=7682,Gu=7683,Ts=34055,Nr=34056,Ga=5386,qp=512,gh=513,Jd=514,Js=515,ao=516,ud=517,xg=518,_h=519,Hu=35044,Xp=35048,wg=35040,vh=35045,fs=35049,Eg=35041,qf=35046,Zd=35050,ep=35042,Yp="100",Sg="300 es",Xf=1035;class sl{addEventListener(r,d){this._listeners===void 0&&(this._listeners={});const _=this._listeners;_[r]===void 0&&(_[r]=[]),_[r].indexOf(d)===-1&&_[r].push(d)}hasEventListener(r,d){if(this._listeners===void 0)return!1;const _=this._listeners;return _[r]!==void 0&&_[r].indexOf(d)!==-1}removeEventListener(r,d){if(this._listeners===void 0)return;const _=this._listeners[r];if(_!==void 0){const A=_.indexOf(d);A!==-1&&_.splice(A,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const d=this._listeners[r.type];if(d!==void 0){r.target=this;const _=d.slice(0);for(let A=0,E=_.length;A<E;A++)_[A].call(this,r);r.target=null}}}const qs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let tp=1234567;const ei=Math.PI/180,uc=180/Math.PI;function Cl(){const R=4294967295*Math.random()|0,r=4294967295*Math.random()|0,d=4294967295*Math.random()|0,_=4294967295*Math.random()|0;return(qs[255&R]+qs[R>>8&255]+qs[R>>16&255]+qs[R>>24&255]+"-"+qs[255&r]+qs[r>>8&255]+"-"+qs[r>>16&15|64]+qs[r>>24&255]+"-"+qs[63&d|128]+qs[d>>8&255]+"-"+qs[d>>16&255]+qs[d>>24&255]+qs[255&_]+qs[_>>8&255]+qs[_>>16&255]+qs[_>>24&255]).toLowerCase()}function xo(R,r,d){return Math.max(r,Math.min(d,R))}function np(R,r){return(R%r+r)%r}function yh(R,r,d){return(1-d)*R+d*r}function Wu(R){return(R&R-1)==0&&R!==0}function kr(R){return Math.pow(2,Math.ceil(Math.log(R)/Math.LN2))}function qo(R){return Math.pow(2,Math.floor(Math.log(R)/Math.LN2))}function aa(R,r){switch(r.constructor){case Float32Array:return R;case Uint16Array:return R/65535;case Uint8Array:return R/255;case Int16Array:return Math.max(R/32767,-1);case Int8Array:return Math.max(R/127,-1);default:throw new Error("Invalid component type.")}}function rs(R,r){switch(r.constructor){case Float32Array:return R;case Uint16Array:return Math.round(65535*R);case Uint8Array:return Math.round(255*R);case Int16Array:return Math.round(32767*R);case Int8Array:return Math.round(127*R);default:throw new Error("Invalid component type.")}}const ip={DEG2RAD:ei,RAD2DEG:uc,generateUUID:Cl,clamp:xo,euclideanModulo:np,mapLinear:function(R,r,d,_,A){return _+(R-r)*(A-_)/(d-r)},inverseLerp:function(R,r,d){return R!==r?(d-R)/(r-R):0},lerp:yh,damp:function(R,r,d,_){return yh(R,r,1-Math.exp(-d*_))},pingpong:function(R,r=1){return r-Math.abs(np(R,2*r)-r)},smoothstep:function(R,r,d){return R<=r?0:R>=d?1:(R=(R-r)/(d-r))*R*(3-2*R)},smootherstep:function(R,r,d){return R<=r?0:R>=d?1:(R=(R-r)/(d-r))*R*R*(R*(6*R-15)+10)},randInt:function(R,r){return R+Math.floor(Math.random()*(r-R+1))},randFloat:function(R,r){return R+Math.random()*(r-R)},randFloatSpread:function(R){return R*(.5-Math.random())},seededRandom:function(R){R!==void 0&&(tp=R);let r=tp+=1831565813;return r=Math.imul(r^r>>>15,1|r),r^=r+Math.imul(r^r>>>7,61|r),((r^r>>>14)>>>0)/4294967296},degToRad:function(R){return R*ei},radToDeg:function(R){return R*uc},isPowerOfTwo:Wu,ceilPowerOfTwo:kr,floorPowerOfTwo:qo,setQuaternionFromProperEuler:function(R,r,d,_,A){const E=Math.cos,P=Math.sin,k=E(d/2),Q=P(d/2),G=E((r+_)/2),re=P((r+_)/2),xe=E((r-_)/2),ye=P((r-_)/2),Ee=E((_-r)/2),Ie=P((_-r)/2);switch(A){case"XYX":R.set(k*re,Q*xe,Q*ye,k*G);break;case"YZY":R.set(Q*ye,k*re,Q*xe,k*G);break;case"ZXZ":R.set(Q*xe,Q*ye,k*re,k*G);break;case"XZX":R.set(k*re,Q*Ie,Q*Ee,k*G);break;case"YXY":R.set(Q*Ee,k*re,Q*Ie,k*G);break;case"ZYZ":R.set(Q*Ie,Q*Ee,k*re,k*G);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+A)}},normalize:rs,denormalize:aa};class li{constructor(r=0,d=0){li.prototype.isVector2=!0,this.x=r,this.y=d}get width(){return this.x}set width(r){this.x=r}get height(){return this.y}set height(r){this.y=r}set(r,d){return this.x=r,this.y=d,this}setScalar(r){return this.x=r,this.y=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setComponent(r,d){switch(r){case 0:this.x=d;break;case 1:this.y=d;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y)}copy(r){return this.x=r.x,this.y=r.y,this}add(r){return this.x+=r.x,this.y+=r.y,this}addScalar(r){return this.x+=r,this.y+=r,this}addVectors(r,d){return this.x=r.x+d.x,this.y=r.y+d.y,this}addScaledVector(r,d){return this.x+=r.x*d,this.y+=r.y*d,this}sub(r){return this.x-=r.x,this.y-=r.y,this}subScalar(r){return this.x-=r,this.y-=r,this}subVectors(r,d){return this.x=r.x-d.x,this.y=r.y-d.y,this}multiply(r){return this.x*=r.x,this.y*=r.y,this}multiplyScalar(r){return this.x*=r,this.y*=r,this}divide(r){return this.x/=r.x,this.y/=r.y,this}divideScalar(r){return this.multiplyScalar(1/r)}applyMatrix3(r){const d=this.x,_=this.y,A=r.elements;return this.x=A[0]*d+A[3]*_+A[6],this.y=A[1]*d+A[4]*_+A[7],this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this}clamp(r,d){return this.x=Math.max(r.x,Math.min(d.x,this.x)),this.y=Math.max(r.y,Math.min(d.y,this.y)),this}clampScalar(r,d){return this.x=Math.max(r,Math.min(d,this.x)),this.y=Math.max(r,Math.min(d,this.y)),this}clampLength(r,d){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(r,Math.min(d,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(r){return this.x*r.x+this.y*r.y}cross(r){return this.x*r.y-this.y*r.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(r){const d=Math.sqrt(this.lengthSq()*r.lengthSq());if(d===0)return Math.PI/2;const _=this.dot(r)/d;return Math.acos(xo(_,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const d=this.x-r.x,_=this.y-r.y;return d*d+_*_}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,d){return this.x+=(r.x-this.x)*d,this.y+=(r.y-this.y)*d,this}lerpVectors(r,d,_){return this.x=r.x+(d.x-r.x)*_,this.y=r.y+(d.y-r.y)*_,this}equals(r){return r.x===this.x&&r.y===this.y}fromArray(r,d=0){return this.x=r[d],this.y=r[d+1],this}toArray(r=[],d=0){return r[d]=this.x,r[d+1]=this.y,r}fromBufferAttribute(r,d){return this.x=r.getX(d),this.y=r.getY(d),this}rotateAround(r,d){const _=Math.cos(d),A=Math.sin(d),E=this.x-r.x,P=this.y-r.y;return this.x=E*_-P*A+r.x,this.y=E*A+P*_+r.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ji{constructor(){Ji.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(r,d,_,A,E,P,k,Q,G){const re=this.elements;return re[0]=r,re[1]=A,re[2]=k,re[3]=d,re[4]=E,re[5]=Q,re[6]=_,re[7]=P,re[8]=G,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const d=this.elements,_=r.elements;return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[3],d[4]=_[4],d[5]=_[5],d[6]=_[6],d[7]=_[7],d[8]=_[8],this}extractBasis(r,d,_){return r.setFromMatrix3Column(this,0),d.setFromMatrix3Column(this,1),_.setFromMatrix3Column(this,2),this}setFromMatrix4(r){const d=r.elements;return this.set(d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]),this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,d){const _=r.elements,A=d.elements,E=this.elements,P=_[0],k=_[3],Q=_[6],G=_[1],re=_[4],xe=_[7],ye=_[2],Ee=_[5],Ie=_[8],Ue=A[0],Oe=A[3],ke=A[6],Ge=A[1],Je=A[4],Rt=A[7],Et=A[2],xt=A[5],Zt=A[8];return E[0]=P*Ue+k*Ge+Q*Et,E[3]=P*Oe+k*Je+Q*xt,E[6]=P*ke+k*Rt+Q*Zt,E[1]=G*Ue+re*Ge+xe*Et,E[4]=G*Oe+re*Je+xe*xt,E[7]=G*ke+re*Rt+xe*Zt,E[2]=ye*Ue+Ee*Ge+Ie*Et,E[5]=ye*Oe+Ee*Je+Ie*xt,E[8]=ye*ke+Ee*Rt+Ie*Zt,this}multiplyScalar(r){const d=this.elements;return d[0]*=r,d[3]*=r,d[6]*=r,d[1]*=r,d[4]*=r,d[7]*=r,d[2]*=r,d[5]*=r,d[8]*=r,this}determinant(){const r=this.elements,d=r[0],_=r[1],A=r[2],E=r[3],P=r[4],k=r[5],Q=r[6],G=r[7],re=r[8];return d*P*re-d*k*G-_*E*re+_*k*Q+A*E*G-A*P*Q}invert(){const r=this.elements,d=r[0],_=r[1],A=r[2],E=r[3],P=r[4],k=r[5],Q=r[6],G=r[7],re=r[8],xe=re*P-k*G,ye=k*Q-re*E,Ee=G*E-P*Q,Ie=d*xe+_*ye+A*Ee;if(Ie===0)return this.set(0,0,0,0,0,0,0,0,0);const Ue=1/Ie;return r[0]=xe*Ue,r[1]=(A*G-re*_)*Ue,r[2]=(k*_-A*P)*Ue,r[3]=ye*Ue,r[4]=(re*d-A*Q)*Ue,r[5]=(A*E-k*d)*Ue,r[6]=Ee*Ue,r[7]=(_*Q-G*d)*Ue,r[8]=(P*d-_*E)*Ue,this}transpose(){let r;const d=this.elements;return r=d[1],d[1]=d[3],d[3]=r,r=d[2],d[2]=d[6],d[6]=r,r=d[5],d[5]=d[7],d[7]=r,this}getNormalMatrix(r){return this.setFromMatrix4(r).invert().transpose()}transposeIntoArray(r){const d=this.elements;return r[0]=d[0],r[1]=d[3],r[2]=d[6],r[3]=d[1],r[4]=d[4],r[5]=d[7],r[6]=d[2],r[7]=d[5],r[8]=d[8],this}setUvTransform(r,d,_,A,E,P,k){const Q=Math.cos(E),G=Math.sin(E);return this.set(_*Q,_*G,-_*(Q*P+G*k)+P+r,-A*G,A*Q,-A*(-G*P+Q*k)+k+d,0,0,1),this}scale(r,d){return this.premultiply(Gs.makeScale(r,d)),this}rotate(r){return this.premultiply(Gs.makeRotation(-r)),this}translate(r,d){return this.premultiply(Gs.makeTranslation(r,d)),this}makeTranslation(r,d){return this.set(1,0,r,0,1,d,0,0,1),this}makeRotation(r){const d=Math.cos(r),_=Math.sin(r);return this.set(d,-_,0,_,d,0,0,0,1),this}makeScale(r,d){return this.set(r,0,0,0,d,0,0,0,1),this}equals(r){const d=this.elements,_=r.elements;for(let A=0;A<9;A++)if(d[A]!==_[A])return!1;return!0}fromArray(r,d=0){for(let _=0;_<9;_++)this.elements[_]=r[_+d];return this}toArray(r=[],d=0){const _=this.elements;return r[d]=_[0],r[d+1]=_[1],r[d+2]=_[2],r[d+3]=_[3],r[d+4]=_[4],r[d+5]=_[5],r[d+6]=_[6],r[d+7]=_[7],r[d+8]=_[8],r}clone(){return new this.constructor().fromArray(this.elements)}}const Gs=new Ji;function hd(R){for(let r=R.length-1;r>=0;--r)if(R[r]>=65535)return!0;return!1}const Ah={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ol(R,r){return new Ah[R](r)}function hc(R){return document.createElementNS("http://www.w3.org/1999/xhtml",R)}const Ha={};function dc(R){R in Ha||(Ha[R]=!0,console.warn(R))}function Rl(R){return R<.04045?.0773993808*R:Math.pow(.9478672986*R+.0521327014,2.4)}function Il(R){return R<.0031308?12.92*R:1.055*Math.pow(R,.41666)-.055}const Yf=new Ji().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),rv=new Ji().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),Kp={[Is]:R=>R,[xr]:R=>R.convertSRGBToLinear(),[Vu]:function(R){return R.convertSRGBToLinear().applyMatrix3(rv)}},Kf={[Is]:R=>R,[xr]:R=>R.convertLinearToSRGB(),[Vu]:function(R){return R.applyMatrix3(Yf).convertLinearToSRGB()}},Wa={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(R){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!R},get workingColorSpace(){return Is},set workingColorSpace(R){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(R,r,d){if(this.enabled===!1||r===d||!r||!d)return R;const _=Kp[r],A=Kf[d];if(_===void 0||A===void 0)throw new Error(`Unsupported color space conversion, "${r}" to "${d}".`);return A(_(R))},fromWorkingColorSpace:function(R,r){return this.convert(R,this.workingColorSpace,r)},toWorkingColorSpace:function(R,r){return this.convert(R,r,this.workingColorSpace)}};let bh;class $p{static getDataURL(r,d=!1){if(/^data:/i.test(r.src)||typeof HTMLCanvasElement>"u")return r.src;let _;if(r instanceof HTMLCanvasElement)_=r;else{bh===void 0&&(bh=hc("canvas")),bh.width=r.width,bh.height=r.height;const A=bh.getContext("2d");r instanceof ImageData?A.putImageData(r,0,0):A.drawImage(r,0,0,r.width,r.height),_=bh}return!d&&(_.width>2048||_.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",r),_.toDataURL("image/jpeg",.6)):_.toDataURL("image/png")}static sRGBToLinear(r){if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap){const d=hc("canvas");d.width=r.width,d.height=r.height;const _=d.getContext("2d");_.drawImage(r,0,0,r.width,r.height);const A=_.getImageData(0,0,r.width,r.height),E=A.data;for(let P=0;P<E.length;P++)E[P]=255*Rl(E[P]/255);return _.putImageData(A,0,0),d}if(r.data){const d=r.data.slice(0);for(let _=0;_<d.length;_++)d instanceof Uint8Array||d instanceof Uint8ClampedArray?d[_]=Math.floor(255*Rl(d[_]/255)):d[_]=Rl(d[_]);return{data:d,width:r.width,height:r.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),r}}class mu{constructor(r=null){this.isSource=!0,this.uuid=Cl(),this.data=r,this.version=0}set needsUpdate(r){r===!0&&this.version++}toJSON(r){const d=r===void 0||typeof r=="string";if(!d&&r.images[this.uuid]!==void 0)return r.images[this.uuid];const _={uuid:this.uuid,url:""},A=this.data;if(A!==null){let E;if(Array.isArray(A)){E=[];for(let P=0,k=A.length;P<k;P++)A[P].isDataTexture?E.push($f(A[P].image)):E.push($f(A[P]))}else E=$f(A);_.url=E}return d||(r.images[this.uuid]=_),_}}function $f(R){if(typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&R instanceof ImageBitmap)return $p.getDataURL(R);if(R.data){let r=[];try{r=Array.from(R.data)}catch(d){d.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(d),r=R.data}return{data:r,width:R.width,height:R.height,type:R.data.constructor.name}}return R.url!==void 0?R.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let dd=0;class Us extends sl{constructor(r=Us.DEFAULT_IMAGE,d=Us.DEFAULT_MAPPING,_=It,A=It,E=Nn,P=Mr,k=uo,Q=yi,G=Us.DEFAULT_ANISOTROPY,re=Ta){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dd++}),this.uuid=Cl(),this.name="",this.source=new mu(r),this.mipmaps=[],this.mapping=d,this.channel=0,this.wrapS=_,this.wrapT=A,this.magFilter=E,this.minFilter=P,this.anisotropy=G,this.format=k,this.internalFormat=null,this.type=Q,this.offset=new li(0,0),this.repeat=new li(1,1),this.center=new li(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ji,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof re=="string"?this.colorSpace=re:(dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=re===br?xr:Ta),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(r=null){this.source.data=r}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(r){return this.name=r.name,this.source=r.source,this.mipmaps=r.mipmaps.slice(0),this.mapping=r.mapping,this.channel=r.channel,this.wrapS=r.wrapS,this.wrapT=r.wrapT,this.magFilter=r.magFilter,this.minFilter=r.minFilter,this.anisotropy=r.anisotropy,this.format=r.format,this.internalFormat=r.internalFormat,this.type=r.type,this.offset.copy(r.offset),this.repeat.copy(r.repeat),this.center.copy(r.center),this.rotation=r.rotation,this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrix.copy(r.matrix),this.generateMipmaps=r.generateMipmaps,this.premultiplyAlpha=r.premultiplyAlpha,this.flipY=r.flipY,this.unpackAlignment=r.unpackAlignment,this.colorSpace=r.colorSpace,this.userData=JSON.parse(JSON.stringify(r.userData)),this.needsUpdate=!0,this}toJSON(r){const d=r===void 0||typeof r=="string";if(!d&&r.textures[this.uuid]!==void 0)return r.textures[this.uuid];const _={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(r).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===xr?br:No,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(_.userData=this.userData),d||(r.textures[this.uuid]=_),_}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(r){if(this.mapping!==Fn)return r;if(r.applyMatrix3(this.matrix),r.x<0||r.x>1)switch(this.wrapS){case pt:r.x=r.x-Math.floor(r.x);break;case It:r.x=r.x<0?0:1;break;case $t:Math.abs(Math.floor(r.x)%2)===1?r.x=Math.ceil(r.x)-r.x:r.x=r.x-Math.floor(r.x)}if(r.y<0||r.y>1)switch(this.wrapT){case pt:r.y=r.y-Math.floor(r.y);break;case It:r.y=r.y<0?0:1;break;case $t:Math.abs(Math.floor(r.y)%2)===1?r.y=Math.ceil(r.y)-r.y:r.y=r.y-Math.floor(r.y)}return this.flipY&&(r.y=1-r.y),r}set needsUpdate(r){r===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===xr?br:No}set encoding(r){dc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=r===br?xr:Ta}}Us.DEFAULT_IMAGE=null,Us.DEFAULT_MAPPING=Fn,Us.DEFAULT_ANISOTROPY=1;class Vr{constructor(r=0,d=0,_=0,A=1){Vr.prototype.isVector4=!0,this.x=r,this.y=d,this.z=_,this.w=A}get width(){return this.z}set width(r){this.z=r}get height(){return this.w}set height(r){this.w=r}set(r,d,_,A){return this.x=r,this.y=d,this.z=_,this.w=A,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this.w=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setW(r){return this.w=r,this}setComponent(r,d){switch(r){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;case 3:this.w=d;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w!==void 0?r.w:1,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this.w+=r,this}addVectors(r,d){return this.x=r.x+d.x,this.y=r.y+d.y,this.z=r.z+d.z,this.w=r.w+d.w,this}addScaledVector(r,d){return this.x+=r.x*d,this.y+=r.y*d,this.z+=r.z*d,this.w+=r.w*d,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this.w-=r,this}subVectors(r,d){return this.x=r.x-d.x,this.y=r.y-d.y,this.z=r.z-d.z,this.w=r.w-d.w,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this.w*=r.w,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this}applyMatrix4(r){const d=this.x,_=this.y,A=this.z,E=this.w,P=r.elements;return this.x=P[0]*d+P[4]*_+P[8]*A+P[12]*E,this.y=P[1]*d+P[5]*_+P[9]*A+P[13]*E,this.z=P[2]*d+P[6]*_+P[10]*A+P[14]*E,this.w=P[3]*d+P[7]*_+P[11]*A+P[15]*E,this}divideScalar(r){return this.multiplyScalar(1/r)}setAxisAngleFromQuaternion(r){this.w=2*Math.acos(r.w);const d=Math.sqrt(1-r.w*r.w);return d<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=r.x/d,this.y=r.y/d,this.z=r.z/d),this}setAxisAngleFromRotationMatrix(r){let d,_,A,E;const Q=r.elements,G=Q[0],re=Q[4],xe=Q[8],ye=Q[1],Ee=Q[5],Ie=Q[9],Ue=Q[2],Oe=Q[6],ke=Q[10];if(Math.abs(re-ye)<.01&&Math.abs(xe-Ue)<.01&&Math.abs(Ie-Oe)<.01){if(Math.abs(re+ye)<.1&&Math.abs(xe+Ue)<.1&&Math.abs(Ie+Oe)<.1&&Math.abs(G+Ee+ke-3)<.1)return this.set(1,0,0,0),this;d=Math.PI;const Je=(G+1)/2,Rt=(Ee+1)/2,Et=(ke+1)/2,xt=(re+ye)/4,Zt=(xe+Ue)/4,g=(Ie+Oe)/4;return Je>Rt&&Je>Et?Je<.01?(_=0,A=.707106781,E=.707106781):(_=Math.sqrt(Je),A=xt/_,E=Zt/_):Rt>Et?Rt<.01?(_=.707106781,A=0,E=.707106781):(A=Math.sqrt(Rt),_=xt/A,E=g/A):Et<.01?(_=.707106781,A=.707106781,E=0):(E=Math.sqrt(Et),_=Zt/E,A=g/E),this.set(_,A,E,d),this}let Ge=Math.sqrt((Oe-Ie)*(Oe-Ie)+(xe-Ue)*(xe-Ue)+(ye-re)*(ye-re));return Math.abs(Ge)<.001&&(Ge=1),this.x=(Oe-Ie)/Ge,this.y=(xe-Ue)/Ge,this.z=(ye-re)/Ge,this.w=Math.acos((G+Ee+ke-1)/2),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this.w=Math.min(this.w,r.w),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this.w=Math.max(this.w,r.w),this}clamp(r,d){return this.x=Math.max(r.x,Math.min(d.x,this.x)),this.y=Math.max(r.y,Math.min(d.y,this.y)),this.z=Math.max(r.z,Math.min(d.z,this.z)),this.w=Math.max(r.w,Math.min(d.w,this.w)),this}clampScalar(r,d){return this.x=Math.max(r,Math.min(d,this.x)),this.y=Math.max(r,Math.min(d,this.y)),this.z=Math.max(r,Math.min(d,this.z)),this.w=Math.max(r,Math.min(d,this.w)),this}clampLength(r,d){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(r,Math.min(d,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,d){return this.x+=(r.x-this.x)*d,this.y+=(r.y-this.y)*d,this.z+=(r.z-this.z)*d,this.w+=(r.w-this.w)*d,this}lerpVectors(r,d,_){return this.x=r.x+(d.x-r.x)*_,this.y=r.y+(d.y-r.y)*_,this.z=r.z+(d.z-r.z)*_,this.w=r.w+(d.w-r.w)*_,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z&&r.w===this.w}fromArray(r,d=0){return this.x=r[d],this.y=r[d+1],this.z=r[d+2],this.w=r[d+3],this}toArray(r=[],d=0){return r[d]=this.x,r[d+1]=this.y,r[d+2]=this.z,r[d+3]=this.w,r}fromBufferAttribute(r,d){return this.x=r.getX(d),this.y=r.getY(d),this.z=r.getZ(d),this.w=r.getW(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class va extends sl{constructor(r=1,d=1,_={}){super(),this.isWebGLRenderTarget=!0,this.width=r,this.height=d,this.depth=1,this.scissor=new Vr(0,0,r,d),this.scissorTest=!1,this.viewport=new Vr(0,0,r,d);const A={width:r,height:d,depth:1};_.encoding!==void 0&&(dc("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),_.colorSpace=_.encoding===br?xr:Ta),this.texture=new Us(A,_.mapping,_.wrapS,_.wrapT,_.magFilter,_.minFilter,_.format,_.type,_.anisotropy,_.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=_.generateMipmaps!==void 0&&_.generateMipmaps,this.texture.internalFormat=_.internalFormat!==void 0?_.internalFormat:null,this.texture.minFilter=_.minFilter!==void 0?_.minFilter:Nn,this.depthBuffer=_.depthBuffer===void 0||_.depthBuffer,this.stencilBuffer=_.stencilBuffer!==void 0&&_.stencilBuffer,this.depthTexture=_.depthTexture!==void 0?_.depthTexture:null,this.samples=_.samples!==void 0?_.samples:0}setSize(r,d,_=1){this.width===r&&this.height===d&&this.depth===_||(this.width=r,this.height=d,this.depth=_,this.texture.image.width=r,this.texture.image.height=d,this.texture.image.depth=_,this.dispose()),this.viewport.set(0,0,r,d),this.scissor.set(0,0,r,d)}clone(){return new this.constructor().copy(this)}copy(r){this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.texture=r.texture.clone(),this.texture.isRenderTargetTexture=!0;const d=Object.assign({},r.texture.image);return this.texture.source=new mu(d),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.samples=r.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pc extends Us{constructor(r=null,d=1,_=1,A=1){super(null),this.isDataArrayTexture=!0,this.image={data:r,width:d,height:_,depth:A},this.magFilter=nn,this.minFilter=nn,this.wrapR=It,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jc extends va{constructor(r=1,d=1,_=1){super(r,d),this.isWebGLArrayRenderTarget=!0,this.depth=_,this.texture=new pc(null,r,d,_),this.texture.isRenderTargetTexture=!0}}class ko extends Us{constructor(r=null,d=1,_=1,A=1){super(null),this.isData3DTexture=!0,this.image={data:r,width:d,height:_,depth:A},this.magFilter=nn,this.minFilter=nn,this.wrapR=It,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class rp extends va{constructor(r=1,d=1,_=1){super(r,d),this.isWebGL3DRenderTarget=!0,this.depth=_,this.texture=new ko(null,r,d,_),this.texture.isRenderTargetTexture=!0}}class gu extends va{constructor(r=1,d=1,_=1,A={}){super(r,d,A),this.isWebGLMultipleRenderTargets=!0;const E=this.texture;this.texture=[];for(let P=0;P<_;P++)this.texture[P]=E.clone(),this.texture[P].isRenderTargetTexture=!0}setSize(r,d,_=1){if(this.width!==r||this.height!==d||this.depth!==_){this.width=r,this.height=d,this.depth=_;for(let A=0,E=this.texture.length;A<E;A++)this.texture[A].image.width=r,this.texture[A].image.height=d,this.texture[A].image.depth=_;this.dispose()}return this.viewport.set(0,0,r,d),this.scissor.set(0,0,r,d),this}copy(r){this.dispose(),this.width=r.width,this.height=r.height,this.depth=r.depth,this.scissor.copy(r.scissor),this.scissorTest=r.scissorTest,this.viewport.copy(r.viewport),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,r.depthTexture!==null&&(this.depthTexture=r.depthTexture.clone()),this.texture.length=0;for(let d=0,_=r.texture.length;d<_;d++)this.texture[d]=r.texture[d].clone(),this.texture[d].isRenderTargetTexture=!0;return this}}class Pl{constructor(r=0,d=0,_=0,A=1){this.isQuaternion=!0,this._x=r,this._y=d,this._z=_,this._w=A}static slerpFlat(r,d,_,A,E,P,k){let Q=_[A+0],G=_[A+1],re=_[A+2],xe=_[A+3];const ye=E[P+0],Ee=E[P+1],Ie=E[P+2],Ue=E[P+3];if(k===0)return r[d+0]=Q,r[d+1]=G,r[d+2]=re,void(r[d+3]=xe);if(k===1)return r[d+0]=ye,r[d+1]=Ee,r[d+2]=Ie,void(r[d+3]=Ue);if(xe!==Ue||Q!==ye||G!==Ee||re!==Ie){let Oe=1-k;const ke=Q*ye+G*Ee+re*Ie+xe*Ue,Ge=ke>=0?1:-1,Je=1-ke*ke;if(Je>Number.EPSILON){const Et=Math.sqrt(Je),xt=Math.atan2(Et,ke*Ge);Oe=Math.sin(Oe*xt)/Et,k=Math.sin(k*xt)/Et}const Rt=k*Ge;if(Q=Q*Oe+ye*Rt,G=G*Oe+Ee*Rt,re=re*Oe+Ie*Rt,xe=xe*Oe+Ue*Rt,Oe===1-k){const Et=1/Math.sqrt(Q*Q+G*G+re*re+xe*xe);Q*=Et,G*=Et,re*=Et,xe*=Et}}r[d]=Q,r[d+1]=G,r[d+2]=re,r[d+3]=xe}static multiplyQuaternionsFlat(r,d,_,A,E,P){const k=_[A],Q=_[A+1],G=_[A+2],re=_[A+3],xe=E[P],ye=E[P+1],Ee=E[P+2],Ie=E[P+3];return r[d]=k*Ie+re*xe+Q*Ee-G*ye,r[d+1]=Q*Ie+re*ye+G*xe-k*Ee,r[d+2]=G*Ie+re*Ee+k*ye-Q*xe,r[d+3]=re*Ie-k*xe-Q*ye-G*Ee,r}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get w(){return this._w}set w(r){this._w=r,this._onChangeCallback()}set(r,d,_,A){return this._x=r,this._y=d,this._z=_,this._w=A,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(r){return this._x=r.x,this._y=r.y,this._z=r.z,this._w=r.w,this._onChangeCallback(),this}setFromEuler(r,d){const _=r._x,A=r._y,E=r._z,P=r._order,k=Math.cos,Q=Math.sin,G=k(_/2),re=k(A/2),xe=k(E/2),ye=Q(_/2),Ee=Q(A/2),Ie=Q(E/2);switch(P){case"XYZ":this._x=ye*re*xe+G*Ee*Ie,this._y=G*Ee*xe-ye*re*Ie,this._z=G*re*Ie+ye*Ee*xe,this._w=G*re*xe-ye*Ee*Ie;break;case"YXZ":this._x=ye*re*xe+G*Ee*Ie,this._y=G*Ee*xe-ye*re*Ie,this._z=G*re*Ie-ye*Ee*xe,this._w=G*re*xe+ye*Ee*Ie;break;case"ZXY":this._x=ye*re*xe-G*Ee*Ie,this._y=G*Ee*xe+ye*re*Ie,this._z=G*re*Ie+ye*Ee*xe,this._w=G*re*xe-ye*Ee*Ie;break;case"ZYX":this._x=ye*re*xe-G*Ee*Ie,this._y=G*Ee*xe+ye*re*Ie,this._z=G*re*Ie-ye*Ee*xe,this._w=G*re*xe+ye*Ee*Ie;break;case"YZX":this._x=ye*re*xe+G*Ee*Ie,this._y=G*Ee*xe+ye*re*Ie,this._z=G*re*Ie-ye*Ee*xe,this._w=G*re*xe-ye*Ee*Ie;break;case"XZY":this._x=ye*re*xe-G*Ee*Ie,this._y=G*Ee*xe-ye*re*Ie,this._z=G*re*Ie+ye*Ee*xe,this._w=G*re*xe+ye*Ee*Ie;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+P)}return d!==!1&&this._onChangeCallback(),this}setFromAxisAngle(r,d){const _=d/2,A=Math.sin(_);return this._x=r.x*A,this._y=r.y*A,this._z=r.z*A,this._w=Math.cos(_),this._onChangeCallback(),this}setFromRotationMatrix(r){const d=r.elements,_=d[0],A=d[4],E=d[8],P=d[1],k=d[5],Q=d[9],G=d[2],re=d[6],xe=d[10],ye=_+k+xe;if(ye>0){const Ee=.5/Math.sqrt(ye+1);this._w=.25/Ee,this._x=(re-Q)*Ee,this._y=(E-G)*Ee,this._z=(P-A)*Ee}else if(_>k&&_>xe){const Ee=2*Math.sqrt(1+_-k-xe);this._w=(re-Q)/Ee,this._x=.25*Ee,this._y=(A+P)/Ee,this._z=(E+G)/Ee}else if(k>xe){const Ee=2*Math.sqrt(1+k-_-xe);this._w=(E-G)/Ee,this._x=(A+P)/Ee,this._y=.25*Ee,this._z=(Q+re)/Ee}else{const Ee=2*Math.sqrt(1+xe-_-k);this._w=(P-A)/Ee,this._x=(E+G)/Ee,this._y=(Q+re)/Ee,this._z=.25*Ee}return this._onChangeCallback(),this}setFromUnitVectors(r,d){let _=r.dot(d)+1;return _<Number.EPSILON?(_=0,Math.abs(r.x)>Math.abs(r.z)?(this._x=-r.y,this._y=r.x,this._z=0,this._w=_):(this._x=0,this._y=-r.z,this._z=r.y,this._w=_)):(this._x=r.y*d.z-r.z*d.y,this._y=r.z*d.x-r.x*d.z,this._z=r.x*d.y-r.y*d.x,this._w=_),this.normalize()}angleTo(r){return 2*Math.acos(Math.abs(xo(this.dot(r),-1,1)))}rotateTowards(r,d){const _=this.angleTo(r);if(_===0)return this;const A=Math.min(1,d/_);return this.slerp(r,A),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(r){return this._x*r._x+this._y*r._y+this._z*r._z+this._w*r._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let r=this.length();return r===0?(this._x=0,this._y=0,this._z=0,this._w=1):(r=1/r,this._x=this._x*r,this._y=this._y*r,this._z=this._z*r,this._w=this._w*r),this._onChangeCallback(),this}multiply(r){return this.multiplyQuaternions(this,r)}premultiply(r){return this.multiplyQuaternions(r,this)}multiplyQuaternions(r,d){const _=r._x,A=r._y,E=r._z,P=r._w,k=d._x,Q=d._y,G=d._z,re=d._w;return this._x=_*re+P*k+A*G-E*Q,this._y=A*re+P*Q+E*k-_*G,this._z=E*re+P*G+_*Q-A*k,this._w=P*re-_*k-A*Q-E*G,this._onChangeCallback(),this}slerp(r,d){if(d===0)return this;if(d===1)return this.copy(r);const _=this._x,A=this._y,E=this._z,P=this._w;let k=P*r._w+_*r._x+A*r._y+E*r._z;if(k<0?(this._w=-r._w,this._x=-r._x,this._y=-r._y,this._z=-r._z,k=-k):this.copy(r),k>=1)return this._w=P,this._x=_,this._y=A,this._z=E,this;const Q=1-k*k;if(Q<=Number.EPSILON){const Ee=1-d;return this._w=Ee*P+d*this._w,this._x=Ee*_+d*this._x,this._y=Ee*A+d*this._y,this._z=Ee*E+d*this._z,this.normalize(),this._onChangeCallback(),this}const G=Math.sqrt(Q),re=Math.atan2(G,k),xe=Math.sin((1-d)*re)/G,ye=Math.sin(d*re)/G;return this._w=P*xe+this._w*ye,this._x=_*xe+this._x*ye,this._y=A*xe+this._y*ye,this._z=E*xe+this._z*ye,this._onChangeCallback(),this}slerpQuaternions(r,d,_){return this.copy(r).slerp(d,_)}random(){const r=Math.random(),d=Math.sqrt(1-r),_=Math.sqrt(r),A=2*Math.PI*Math.random(),E=2*Math.PI*Math.random();return this.set(d*Math.cos(A),_*Math.sin(E),_*Math.cos(E),d*Math.sin(A))}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._w===this._w}fromArray(r,d=0){return this._x=r[d],this._y=r[d+1],this._z=r[d+2],this._w=r[d+3],this._onChangeCallback(),this}toArray(r=[],d=0){return r[d]=this._x,r[d+1]=this._y,r[d+2]=this._z,r[d+3]=this._w,r}fromBufferAttribute(r,d){return this._x=r.getX(d),this._y=r.getY(d),this._z=r.getZ(d),this._w=r.getW(d),this}toJSON(){return this.toArray()}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class zt{constructor(r=0,d=0,_=0){zt.prototype.isVector3=!0,this.x=r,this.y=d,this.z=_}set(r,d,_){return _===void 0&&(_=this.z),this.x=r,this.y=d,this.z=_,this}setScalar(r){return this.x=r,this.y=r,this.z=r,this}setX(r){return this.x=r,this}setY(r){return this.y=r,this}setZ(r){return this.z=r,this}setComponent(r,d){switch(r){case 0:this.x=d;break;case 1:this.y=d;break;case 2:this.z=d;break;default:throw new Error("index is out of range: "+r)}return this}getComponent(r){switch(r){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+r)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addScalar(r){return this.x+=r,this.y+=r,this.z+=r,this}addVectors(r,d){return this.x=r.x+d.x,this.y=r.y+d.y,this.z=r.z+d.z,this}addScaledVector(r,d){return this.x+=r.x*d,this.y+=r.y*d,this.z+=r.z*d,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subScalar(r){return this.x-=r,this.y-=r,this.z-=r,this}subVectors(r,d){return this.x=r.x-d.x,this.y=r.y-d.y,this.z=r.z-d.z,this}multiply(r){return this.x*=r.x,this.y*=r.y,this.z*=r.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}multiplyVectors(r,d){return this.x=r.x*d.x,this.y=r.y*d.y,this.z=r.z*d.z,this}applyEuler(r){return this.applyQuaternion(_u.setFromEuler(r))}applyAxisAngle(r,d){return this.applyQuaternion(_u.setFromAxisAngle(r,d))}applyMatrix3(r){const d=this.x,_=this.y,A=this.z,E=r.elements;return this.x=E[0]*d+E[3]*_+E[6]*A,this.y=E[1]*d+E[4]*_+E[7]*A,this.z=E[2]*d+E[5]*_+E[8]*A,this}applyNormalMatrix(r){return this.applyMatrix3(r).normalize()}applyMatrix4(r){const d=this.x,_=this.y,A=this.z,E=r.elements,P=1/(E[3]*d+E[7]*_+E[11]*A+E[15]);return this.x=(E[0]*d+E[4]*_+E[8]*A+E[12])*P,this.y=(E[1]*d+E[5]*_+E[9]*A+E[13])*P,this.z=(E[2]*d+E[6]*_+E[10]*A+E[14])*P,this}applyQuaternion(r){const d=this.x,_=this.y,A=this.z,E=r.x,P=r.y,k=r.z,Q=r.w,G=Q*d+P*A-k*_,re=Q*_+k*d-E*A,xe=Q*A+E*_-P*d,ye=-E*d-P*_-k*A;return this.x=G*Q+ye*-E+re*-k-xe*-P,this.y=re*Q+ye*-P+xe*-E-G*-k,this.z=xe*Q+ye*-k+G*-P-re*-E,this}project(r){return this.applyMatrix4(r.matrixWorldInverse).applyMatrix4(r.projectionMatrix)}unproject(r){return this.applyMatrix4(r.projectionMatrixInverse).applyMatrix4(r.matrixWorld)}transformDirection(r){const d=this.x,_=this.y,A=this.z,E=r.elements;return this.x=E[0]*d+E[4]*_+E[8]*A,this.y=E[1]*d+E[5]*_+E[9]*A,this.z=E[2]*d+E[6]*_+E[10]*A,this.normalize()}divide(r){return this.x/=r.x,this.y/=r.y,this.z/=r.z,this}divideScalar(r){return this.multiplyScalar(1/r)}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}clamp(r,d){return this.x=Math.max(r.x,Math.min(d.x,this.x)),this.y=Math.max(r.y,Math.min(d.y,this.y)),this.z=Math.max(r.z,Math.min(d.z,this.z)),this}clampScalar(r,d){return this.x=Math.max(r,Math.min(d,this.x)),this.y=Math.max(r,Math.min(d,this.y)),this.z=Math.max(r,Math.min(d,this.z)),this}clampLength(r,d){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(r,Math.min(d,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(r){return this.normalize().multiplyScalar(r)}lerp(r,d){return this.x+=(r.x-this.x)*d,this.y+=(r.y-this.y)*d,this.z+=(r.z-this.z)*d,this}lerpVectors(r,d,_){return this.x=r.x+(d.x-r.x)*_,this.y=r.y+(d.y-r.y)*_,this.z=r.z+(d.z-r.z)*_,this}cross(r){return this.crossVectors(this,r)}crossVectors(r,d){const _=r.x,A=r.y,E=r.z,P=d.x,k=d.y,Q=d.z;return this.x=A*Q-E*k,this.y=E*P-_*Q,this.z=_*k-A*P,this}projectOnVector(r){const d=r.lengthSq();if(d===0)return this.set(0,0,0);const _=r.dot(this)/d;return this.copy(r).multiplyScalar(_)}projectOnPlane(r){return pd.copy(this).projectOnVector(r),this.sub(pd)}reflect(r){return this.sub(pd.copy(r).multiplyScalar(2*this.dot(r)))}angleTo(r){const d=Math.sqrt(this.lengthSq()*r.lengthSq());if(d===0)return Math.PI/2;const _=this.dot(r)/d;return Math.acos(xo(_,-1,1))}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const d=this.x-r.x,_=this.y-r.y,A=this.z-r.z;return d*d+_*_+A*A}manhattanDistanceTo(r){return Math.abs(this.x-r.x)+Math.abs(this.y-r.y)+Math.abs(this.z-r.z)}setFromSpherical(r){return this.setFromSphericalCoords(r.radius,r.phi,r.theta)}setFromSphericalCoords(r,d,_){const A=Math.sin(d)*r;return this.x=A*Math.sin(_),this.y=Math.cos(d)*r,this.z=A*Math.cos(_),this}setFromCylindrical(r){return this.setFromCylindricalCoords(r.radius,r.theta,r.y)}setFromCylindricalCoords(r,d,_){return this.x=r*Math.sin(d),this.y=_,this.z=r*Math.cos(d),this}setFromMatrixPosition(r){const d=r.elements;return this.x=d[12],this.y=d[13],this.z=d[14],this}setFromMatrixScale(r){const d=this.setFromMatrixColumn(r,0).length(),_=this.setFromMatrixColumn(r,1).length(),A=this.setFromMatrixColumn(r,2).length();return this.x=d,this.y=_,this.z=A,this}setFromMatrixColumn(r,d){return this.fromArray(r.elements,4*d)}setFromMatrix3Column(r,d){return this.fromArray(r.elements,3*d)}setFromEuler(r){return this.x=r._x,this.y=r._y,this.z=r._z,this}setFromColor(r){return this.x=r.r,this.y=r.g,this.z=r.b,this}equals(r){return r.x===this.x&&r.y===this.y&&r.z===this.z}fromArray(r,d=0){return this.x=r[d],this.y=r[d+1],this.z=r[d+2],this}toArray(r=[],d=0){return r[d]=this.x,r[d+1]=this.y,r[d+2]=this.z,r}fromBufferAttribute(r,d){return this.x=r.getX(d),this.y=r.getY(d),this.z=r.getZ(d),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const r=2*(Math.random()-.5),d=Math.random()*Math.PI*2,_=Math.sqrt(1-r**2);return this.x=_*Math.cos(d),this.y=_*Math.sin(d),this.z=r,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pd=new zt,_u=new Pl;class Ql{constructor(r=new zt(1/0,1/0,1/0),d=new zt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=r,this.max=d}set(r,d){return this.min.copy(r),this.max.copy(d),this}setFromArray(r){this.makeEmpty();for(let d=0,_=r.length;d<_;d+=3)this.expandByPoint(mc.fromArray(r,d));return this}setFromBufferAttribute(r){this.makeEmpty();for(let d=0,_=r.count;d<_;d++)this.expandByPoint(mc.fromBufferAttribute(r,d));return this}setFromPoints(r){this.makeEmpty();for(let d=0,_=r.length;d<_;d++)this.expandByPoint(r[d]);return this}setFromCenterAndSize(r,d){const _=mc.copy(d).multiplyScalar(.5);return this.min.copy(r).sub(_),this.max.copy(r).add(_),this}setFromObject(r,d=!1){return this.makeEmpty(),this.expandByObject(r,d)}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(r){return this.isEmpty()?r.set(0,0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}expandByObject(r,d=!1){if(r.updateWorldMatrix(!1,!1),r.boundingBox!==void 0)r.boundingBox===null&&r.computeBoundingBox(),gc.copy(r.boundingBox),gc.applyMatrix4(r.matrixWorld),this.union(gc);else{const A=r.geometry;if(A!==void 0)if(d&&A.attributes!==void 0&&A.attributes.position!==void 0){const E=A.attributes.position;for(let P=0,k=E.count;P<k;P++)mc.fromBufferAttribute(E,P).applyMatrix4(r.matrixWorld),this.expandByPoint(mc)}else A.boundingBox===null&&A.computeBoundingBox(),gc.copy(A.boundingBox),gc.applyMatrix4(r.matrixWorld),this.union(gc)}const _=r.children;for(let A=0,E=_.length;A<E;A++)this.expandByObject(_[A],d);return this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y||r.z<this.min.z||r.z>this.max.z)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y&&this.min.z<=r.min.z&&r.max.z<=this.max.z}getParameter(r,d){return d.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y),(r.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y||r.max.z<this.min.z||r.min.z>this.max.z)}intersectsSphere(r){return this.clampPoint(r.center,mc),mc.distanceToSquared(r.center)<=r.radius*r.radius}intersectsPlane(r){let d,_;return r.normal.x>0?(d=r.normal.x*this.min.x,_=r.normal.x*this.max.x):(d=r.normal.x*this.max.x,_=r.normal.x*this.min.x),r.normal.y>0?(d+=r.normal.y*this.min.y,_+=r.normal.y*this.max.y):(d+=r.normal.y*this.max.y,_+=r.normal.y*this.min.y),r.normal.z>0?(d+=r.normal.z*this.min.z,_+=r.normal.z*this.max.z):(d+=r.normal.z*this.max.z,_+=r.normal.z*this.min.z),d<=-r.constant&&_>=-r.constant}intersectsTriangle(r){if(this.isEmpty())return!1;this.getCenter(wh),Eh.subVectors(this.max,wh),vu.subVectors(r.a,wh),xh.subVectors(r.b,wh),Qa.subVectors(r.c,wh),Vc.subVectors(xh,vu),Gc.subVectors(Qa,xh),yu.subVectors(vu,Qa);let d=[0,-Vc.z,Vc.y,0,-Gc.z,Gc.y,0,-yu.z,yu.y,Vc.z,0,-Vc.x,Gc.z,0,-Gc.x,yu.z,0,-yu.x,-Vc.y,Vc.x,0,-Gc.y,Gc.x,0,-yu.y,yu.x,0];return!!Jp(d,vu,xh,Qa,Eh)&&(d=[1,0,0,0,1,0,0,0,1],!!Jp(d,vu,xh,Qa,Eh)&&(Jf.crossVectors(Vc,Gc),d=[Jf.x,Jf.y,Jf.z],Jp(d,vu,xh,Qa,Eh)))}clampPoint(r,d){return d.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,mc).distanceTo(r)}getBoundingSphere(r){return this.isEmpty()?r.makeEmpty():(this.getCenter(r.center),r.radius=.5*this.getSize(mc).length()),r}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}applyMatrix4(r){return this.isEmpty()||(fc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),fc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),fc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),fc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),fc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),fc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),fc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),fc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.setFromPoints(fc)),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const fc=[new zt,new zt,new zt,new zt,new zt,new zt,new zt,new zt],mc=new zt,gc=new Ql,vu=new zt,xh=new zt,Qa=new zt,Vc=new zt,Gc=new zt,yu=new zt,wh=new zt,Eh=new zt,Jf=new zt,Hc=new zt;function Jp(R,r,d,_,A){for(let E=0,P=R.length-3;E<=P;E+=3){Hc.fromArray(R,E);const k=A.x*Math.abs(Hc.x)+A.y*Math.abs(Hc.y)+A.z*Math.abs(Hc.z),Q=r.dot(Hc),G=d.dot(Hc),re=_.dot(Hc);if(Math.max(-Math.max(Q,G,re),Math.min(Q,G,re))>k)return!1}return!0}const sv=new Ql,ss=new zt,Xo=new zt;class la{constructor(r=new zt,d=-1){this.center=r,this.radius=d}set(r,d){return this.center.copy(r),this.radius=d,this}setFromPoints(r,d){const _=this.center;d!==void 0?_.copy(d):sv.setFromPoints(r).getCenter(_);let A=0;for(let E=0,P=r.length;E<P;E++)A=Math.max(A,_.distanceToSquared(r[E]));return this.radius=Math.sqrt(A),this}copy(r){return this.center.copy(r.center),this.radius=r.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(r){return r.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(r){return r.distanceTo(this.center)-this.radius}intersectsSphere(r){const d=this.radius+r.radius;return r.center.distanceToSquared(this.center)<=d*d}intersectsBox(r){return r.intersectsSphere(this)}intersectsPlane(r){return Math.abs(r.distanceToPoint(this.center))<=this.radius}clampPoint(r,d){const _=this.center.distanceToSquared(r);return d.copy(r),_>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center)),d}getBoundingBox(r){return this.isEmpty()?(r.makeEmpty(),r):(r.set(this.center,this.center),r.expandByScalar(this.radius),r)}applyMatrix4(r){return this.center.applyMatrix4(r),this.radius=this.radius*r.getMaxScaleOnAxis(),this}translate(r){return this.center.add(r),this}expandByPoint(r){if(this.isEmpty())return this.center.copy(r),this.radius=0,this;ss.subVectors(r,this.center);const d=ss.lengthSq();if(d>this.radius*this.radius){const _=Math.sqrt(d),A=.5*(_-this.radius);this.center.addScaledVector(ss,A/_),this.radius+=A}return this}union(r){return r.isEmpty()?this:this.isEmpty()?(this.copy(r),this):(this.center.equals(r.center)===!0?this.radius=Math.max(this.radius,r.radius):(Xo.subVectors(r.center,this.center).setLength(r.radius),this.expandByPoint(ss.copy(r.center).add(Xo)),this.expandByPoint(ss.copy(r.center).sub(Xo))),this)}equals(r){return r.center.equals(this.center)&&r.radius===this.radius}clone(){return new this.constructor().copy(this)}}const al=new zt,Au=new zt,Zs=new zt,_c=new zt,fd=new zt,sp=new zt,op=new zt;class Sh{constructor(r=new zt,d=new zt(0,0,-1)){this.origin=r,this.direction=d}set(r,d){return this.origin.copy(r),this.direction.copy(d),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,d){return d.copy(this.origin).addScaledVector(this.direction,r)}lookAt(r){return this.direction.copy(r).sub(this.origin).normalize(),this}recast(r){return this.origin.copy(this.at(r,al)),this}closestPointToPoint(r,d){d.subVectors(r,this.origin);const _=d.dot(this.direction);return _<0?d.copy(this.origin):d.copy(this.origin).addScaledVector(this.direction,_)}distanceToPoint(r){return Math.sqrt(this.distanceSqToPoint(r))}distanceSqToPoint(r){const d=al.subVectors(r,this.origin).dot(this.direction);return d<0?this.origin.distanceToSquared(r):(al.copy(this.origin).addScaledVector(this.direction,d),al.distanceToSquared(r))}distanceSqToSegment(r,d,_,A){Au.copy(r).add(d).multiplyScalar(.5),Zs.copy(d).sub(r).normalize(),_c.copy(this.origin).sub(Au);const E=.5*r.distanceTo(d),P=-this.direction.dot(Zs),k=_c.dot(this.direction),Q=-_c.dot(Zs),G=_c.lengthSq(),re=Math.abs(1-P*P);let xe,ye,Ee,Ie;if(re>0)if(xe=P*Q-k,ye=P*k-Q,Ie=E*re,xe>=0)if(ye>=-Ie)if(ye<=Ie){const Ue=1/re;xe*=Ue,ye*=Ue,Ee=xe*(xe+P*ye+2*k)+ye*(P*xe+ye+2*Q)+G}else ye=E,xe=Math.max(0,-(P*ye+k)),Ee=-xe*xe+ye*(ye+2*Q)+G;else ye=-E,xe=Math.max(0,-(P*ye+k)),Ee=-xe*xe+ye*(ye+2*Q)+G;else ye<=-Ie?(xe=Math.max(0,-(-P*E+k)),ye=xe>0?-E:Math.min(Math.max(-E,-Q),E),Ee=-xe*xe+ye*(ye+2*Q)+G):ye<=Ie?(xe=0,ye=Math.min(Math.max(-E,-Q),E),Ee=ye*(ye+2*Q)+G):(xe=Math.max(0,-(P*E+k)),ye=xe>0?E:Math.min(Math.max(-E,-Q),E),Ee=-xe*xe+ye*(ye+2*Q)+G);else ye=P>0?-E:E,xe=Math.max(0,-(P*ye+k)),Ee=-xe*xe+ye*(ye+2*Q)+G;return _&&_.copy(this.origin).addScaledVector(this.direction,xe),A&&A.copy(Au).addScaledVector(Zs,ye),Ee}intersectSphere(r,d){al.subVectors(r.center,this.origin);const _=al.dot(this.direction),A=al.dot(al)-_*_,E=r.radius*r.radius;if(A>E)return null;const P=Math.sqrt(E-A),k=_-P,Q=_+P;return Q<0?null:k<0?this.at(Q,d):this.at(k,d)}intersectsSphere(r){return this.distanceSqToPoint(r.center)<=r.radius*r.radius}distanceToPlane(r){const d=r.normal.dot(this.direction);if(d===0)return r.distanceToPoint(this.origin)===0?0:null;const _=-(this.origin.dot(r.normal)+r.constant)/d;return _>=0?_:null}intersectPlane(r,d){const _=this.distanceToPlane(r);return _===null?null:this.at(_,d)}intersectsPlane(r){const d=r.distanceToPoint(this.origin);return d===0||r.normal.dot(this.direction)*d<0}intersectBox(r,d){let _,A,E,P,k,Q;const G=1/this.direction.x,re=1/this.direction.y,xe=1/this.direction.z,ye=this.origin;return G>=0?(_=(r.min.x-ye.x)*G,A=(r.max.x-ye.x)*G):(_=(r.max.x-ye.x)*G,A=(r.min.x-ye.x)*G),re>=0?(E=(r.min.y-ye.y)*re,P=(r.max.y-ye.y)*re):(E=(r.max.y-ye.y)*re,P=(r.min.y-ye.y)*re),_>P||E>A?null:((E>_||isNaN(_))&&(_=E),(P<A||isNaN(A))&&(A=P),xe>=0?(k=(r.min.z-ye.z)*xe,Q=(r.max.z-ye.z)*xe):(k=(r.max.z-ye.z)*xe,Q=(r.min.z-ye.z)*xe),_>Q||k>A?null:((k>_||_!=_)&&(_=k),(Q<A||A!=A)&&(A=Q),A<0?null:this.at(_>=0?_:A,d)))}intersectsBox(r){return this.intersectBox(r,al)!==null}intersectTriangle(r,d,_,A,E){fd.subVectors(d,r),sp.subVectors(_,r),op.crossVectors(fd,sp);let P,k=this.direction.dot(op);if(k>0){if(A)return null;P=1}else{if(!(k<0))return null;P=-1,k=-k}_c.subVectors(this.origin,r);const Q=P*this.direction.dot(sp.crossVectors(_c,sp));if(Q<0)return null;const G=P*this.direction.dot(fd.cross(_c));if(G<0||Q+G>k)return null;const re=-P*_c.dot(op);return re<0?null:this.at(re/k,E)}applyMatrix4(r){return this.origin.applyMatrix4(r),this.direction.transformDirection(r),this}equals(r){return r.origin.equals(this.origin)&&r.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Gr{constructor(){Gr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(r,d,_,A,E,P,k,Q,G,re,xe,ye,Ee,Ie,Ue,Oe){const ke=this.elements;return ke[0]=r,ke[4]=d,ke[8]=_,ke[12]=A,ke[1]=E,ke[5]=P,ke[9]=k,ke[13]=Q,ke[2]=G,ke[6]=re,ke[10]=xe,ke[14]=ye,ke[3]=Ee,ke[7]=Ie,ke[11]=Ue,ke[15]=Oe,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Gr().fromArray(this.elements)}copy(r){const d=this.elements,_=r.elements;return d[0]=_[0],d[1]=_[1],d[2]=_[2],d[3]=_[3],d[4]=_[4],d[5]=_[5],d[6]=_[6],d[7]=_[7],d[8]=_[8],d[9]=_[9],d[10]=_[10],d[11]=_[11],d[12]=_[12],d[13]=_[13],d[14]=_[14],d[15]=_[15],this}copyPosition(r){const d=this.elements,_=r.elements;return d[12]=_[12],d[13]=_[13],d[14]=_[14],this}setFromMatrix3(r){const d=r.elements;return this.set(d[0],d[3],d[6],0,d[1],d[4],d[7],0,d[2],d[5],d[8],0,0,0,0,1),this}extractBasis(r,d,_){return r.setFromMatrixColumn(this,0),d.setFromMatrixColumn(this,1),_.setFromMatrixColumn(this,2),this}makeBasis(r,d,_){return this.set(r.x,d.x,_.x,0,r.y,d.y,_.y,0,r.z,d.z,_.z,0,0,0,0,1),this}extractRotation(r){const d=this.elements,_=r.elements,A=1/bu.setFromMatrixColumn(r,0).length(),E=1/bu.setFromMatrixColumn(r,1).length(),P=1/bu.setFromMatrixColumn(r,2).length();return d[0]=_[0]*A,d[1]=_[1]*A,d[2]=_[2]*A,d[3]=0,d[4]=_[4]*E,d[5]=_[5]*E,d[6]=_[6]*E,d[7]=0,d[8]=_[8]*P,d[9]=_[9]*P,d[10]=_[10]*P,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromEuler(r){const d=this.elements,_=r.x,A=r.y,E=r.z,P=Math.cos(_),k=Math.sin(_),Q=Math.cos(A),G=Math.sin(A),re=Math.cos(E),xe=Math.sin(E);if(r.order==="XYZ"){const ye=P*re,Ee=P*xe,Ie=k*re,Ue=k*xe;d[0]=Q*re,d[4]=-Q*xe,d[8]=G,d[1]=Ee+Ie*G,d[5]=ye-Ue*G,d[9]=-k*Q,d[2]=Ue-ye*G,d[6]=Ie+Ee*G,d[10]=P*Q}else if(r.order==="YXZ"){const ye=Q*re,Ee=Q*xe,Ie=G*re,Ue=G*xe;d[0]=ye+Ue*k,d[4]=Ie*k-Ee,d[8]=P*G,d[1]=P*xe,d[5]=P*re,d[9]=-k,d[2]=Ee*k-Ie,d[6]=Ue+ye*k,d[10]=P*Q}else if(r.order==="ZXY"){const ye=Q*re,Ee=Q*xe,Ie=G*re,Ue=G*xe;d[0]=ye-Ue*k,d[4]=-P*xe,d[8]=Ie+Ee*k,d[1]=Ee+Ie*k,d[5]=P*re,d[9]=Ue-ye*k,d[2]=-P*G,d[6]=k,d[10]=P*Q}else if(r.order==="ZYX"){const ye=P*re,Ee=P*xe,Ie=k*re,Ue=k*xe;d[0]=Q*re,d[4]=Ie*G-Ee,d[8]=ye*G+Ue,d[1]=Q*xe,d[5]=Ue*G+ye,d[9]=Ee*G-Ie,d[2]=-G,d[6]=k*Q,d[10]=P*Q}else if(r.order==="YZX"){const ye=P*Q,Ee=P*G,Ie=k*Q,Ue=k*G;d[0]=Q*re,d[4]=Ue-ye*xe,d[8]=Ie*xe+Ee,d[1]=xe,d[5]=P*re,d[9]=-k*re,d[2]=-G*re,d[6]=Ee*xe+Ie,d[10]=ye-Ue*xe}else if(r.order==="XZY"){const ye=P*Q,Ee=P*G,Ie=k*Q,Ue=k*G;d[0]=Q*re,d[4]=-xe,d[8]=G*re,d[1]=ye*xe+Ue,d[5]=P*re,d[9]=Ee*xe-Ie,d[2]=Ie*xe-Ee,d[6]=k*re,d[10]=Ue*xe+ye}return d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this}makeRotationFromQuaternion(r){return this.compose(Hs,r,md)}lookAt(r,d,_){const A=this.elements;return ua.subVectors(r,d),ua.lengthSq()===0&&(ua.z=1),ua.normalize(),Uo.crossVectors(_,ua),Uo.lengthSq()===0&&(Math.abs(_.z)===1?ua.x+=1e-4:ua.z+=1e-4,ua.normalize(),Uo.crossVectors(_,ua)),Uo.normalize(),ca.crossVectors(ua,Uo),A[0]=Uo.x,A[4]=ca.x,A[8]=ua.x,A[1]=Uo.y,A[5]=ca.y,A[9]=ua.y,A[2]=Uo.z,A[6]=ca.z,A[10]=ua.z,this}multiply(r){return this.multiplyMatrices(this,r)}premultiply(r){return this.multiplyMatrices(r,this)}multiplyMatrices(r,d){const _=r.elements,A=d.elements,E=this.elements,P=_[0],k=_[4],Q=_[8],G=_[12],re=_[1],xe=_[5],ye=_[9],Ee=_[13],Ie=_[2],Ue=_[6],Oe=_[10],ke=_[14],Ge=_[3],Je=_[7],Rt=_[11],Et=_[15],xt=A[0],Zt=A[4],g=A[8],b=A[12],D=A[1],L=A[5],Y=A[9],ne=A[13],be=A[2],Me=A[6],De=A[10],je=A[14],st=A[3],nt=A[7],ot=A[11],Vt=A[15];return E[0]=P*xt+k*D+Q*be+G*st,E[4]=P*Zt+k*L+Q*Me+G*nt,E[8]=P*g+k*Y+Q*De+G*ot,E[12]=P*b+k*ne+Q*je+G*Vt,E[1]=re*xt+xe*D+ye*be+Ee*st,E[5]=re*Zt+xe*L+ye*Me+Ee*nt,E[9]=re*g+xe*Y+ye*De+Ee*ot,E[13]=re*b+xe*ne+ye*je+Ee*Vt,E[2]=Ie*xt+Ue*D+Oe*be+ke*st,E[6]=Ie*Zt+Ue*L+Oe*Me+ke*nt,E[10]=Ie*g+Ue*Y+Oe*De+ke*ot,E[14]=Ie*b+Ue*ne+Oe*je+ke*Vt,E[3]=Ge*xt+Je*D+Rt*be+Et*st,E[7]=Ge*Zt+Je*L+Rt*Me+Et*nt,E[11]=Ge*g+Je*Y+Rt*De+Et*ot,E[15]=Ge*b+Je*ne+Rt*je+Et*Vt,this}multiplyScalar(r){const d=this.elements;return d[0]*=r,d[4]*=r,d[8]*=r,d[12]*=r,d[1]*=r,d[5]*=r,d[9]*=r,d[13]*=r,d[2]*=r,d[6]*=r,d[10]*=r,d[14]*=r,d[3]*=r,d[7]*=r,d[11]*=r,d[15]*=r,this}determinant(){const r=this.elements,d=r[0],_=r[4],A=r[8],E=r[12],P=r[1],k=r[5],Q=r[9],G=r[13],re=r[2],xe=r[6],ye=r[10],Ee=r[14];return r[3]*(+E*Q*xe-A*G*xe-E*k*ye+_*G*ye+A*k*Ee-_*Q*Ee)+r[7]*(+d*Q*Ee-d*G*ye+E*P*ye-A*P*Ee+A*G*re-E*Q*re)+r[11]*(+d*G*xe-d*k*Ee-E*P*xe+_*P*Ee+E*k*re-_*G*re)+r[15]*(-A*k*re-d*Q*xe+d*k*ye+A*P*xe-_*P*ye+_*Q*re)}transpose(){const r=this.elements;let d;return d=r[1],r[1]=r[4],r[4]=d,d=r[2],r[2]=r[8],r[8]=d,d=r[6],r[6]=r[9],r[9]=d,d=r[3],r[3]=r[12],r[12]=d,d=r[7],r[7]=r[13],r[13]=d,d=r[11],r[11]=r[14],r[14]=d,this}setPosition(r,d,_){const A=this.elements;return r.isVector3?(A[12]=r.x,A[13]=r.y,A[14]=r.z):(A[12]=r,A[13]=d,A[14]=_),this}invert(){const r=this.elements,d=r[0],_=r[1],A=r[2],E=r[3],P=r[4],k=r[5],Q=r[6],G=r[7],re=r[8],xe=r[9],ye=r[10],Ee=r[11],Ie=r[12],Ue=r[13],Oe=r[14],ke=r[15],Ge=xe*Oe*G-Ue*ye*G+Ue*Q*Ee-k*Oe*Ee-xe*Q*ke+k*ye*ke,Je=Ie*ye*G-re*Oe*G-Ie*Q*Ee+P*Oe*Ee+re*Q*ke-P*ye*ke,Rt=re*Ue*G-Ie*xe*G+Ie*k*Ee-P*Ue*Ee-re*k*ke+P*xe*ke,Et=Ie*xe*Q-re*Ue*Q-Ie*k*ye+P*Ue*ye+re*k*Oe-P*xe*Oe,xt=d*Ge+_*Je+A*Rt+E*Et;if(xt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Zt=1/xt;return r[0]=Ge*Zt,r[1]=(Ue*ye*E-xe*Oe*E-Ue*A*Ee+_*Oe*Ee+xe*A*ke-_*ye*ke)*Zt,r[2]=(k*Oe*E-Ue*Q*E+Ue*A*G-_*Oe*G-k*A*ke+_*Q*ke)*Zt,r[3]=(xe*Q*E-k*ye*E-xe*A*G+_*ye*G+k*A*Ee-_*Q*Ee)*Zt,r[4]=Je*Zt,r[5]=(re*Oe*E-Ie*ye*E+Ie*A*Ee-d*Oe*Ee-re*A*ke+d*ye*ke)*Zt,r[6]=(Ie*Q*E-P*Oe*E-Ie*A*G+d*Oe*G+P*A*ke-d*Q*ke)*Zt,r[7]=(P*ye*E-re*Q*E+re*A*G-d*ye*G-P*A*Ee+d*Q*Ee)*Zt,r[8]=Rt*Zt,r[9]=(Ie*xe*E-re*Ue*E-Ie*_*Ee+d*Ue*Ee+re*_*ke-d*xe*ke)*Zt,r[10]=(P*Ue*E-Ie*k*E+Ie*_*G-d*Ue*G-P*_*ke+d*k*ke)*Zt,r[11]=(re*k*E-P*xe*E-re*_*G+d*xe*G+P*_*Ee-d*k*Ee)*Zt,r[12]=Et*Zt,r[13]=(re*Ue*A-Ie*xe*A+Ie*_*ye-d*Ue*ye-re*_*Oe+d*xe*Oe)*Zt,r[14]=(Ie*k*A-P*Ue*A-Ie*_*Q+d*Ue*Q+P*_*Oe-d*k*Oe)*Zt,r[15]=(P*xe*A-re*k*A+re*_*Q-d*xe*Q-P*_*ye+d*k*ye)*Zt,this}scale(r){const d=this.elements,_=r.x,A=r.y,E=r.z;return d[0]*=_,d[4]*=A,d[8]*=E,d[1]*=_,d[5]*=A,d[9]*=E,d[2]*=_,d[6]*=A,d[10]*=E,d[3]*=_,d[7]*=A,d[11]*=E,this}getMaxScaleOnAxis(){const r=this.elements,d=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],_=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],A=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(d,_,A))}makeTranslation(r,d,_){return this.set(1,0,0,r,0,1,0,d,0,0,1,_,0,0,0,1),this}makeRotationX(r){const d=Math.cos(r),_=Math.sin(r);return this.set(1,0,0,0,0,d,-_,0,0,_,d,0,0,0,0,1),this}makeRotationY(r){const d=Math.cos(r),_=Math.sin(r);return this.set(d,0,_,0,0,1,0,0,-_,0,d,0,0,0,0,1),this}makeRotationZ(r){const d=Math.cos(r),_=Math.sin(r);return this.set(d,-_,0,0,_,d,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(r,d){const _=Math.cos(d),A=Math.sin(d),E=1-_,P=r.x,k=r.y,Q=r.z,G=E*P,re=E*k;return this.set(G*P+_,G*k-A*Q,G*Q+A*k,0,G*k+A*Q,re*k+_,re*Q-A*P,0,G*Q-A*k,re*Q+A*P,E*Q*Q+_,0,0,0,0,1),this}makeScale(r,d,_){return this.set(r,0,0,0,0,d,0,0,0,0,_,0,0,0,0,1),this}makeShear(r,d,_,A,E,P){return this.set(1,_,E,0,r,1,P,0,d,A,1,0,0,0,0,1),this}compose(r,d,_){const A=this.elements,E=d._x,P=d._y,k=d._z,Q=d._w,G=E+E,re=P+P,xe=k+k,ye=E*G,Ee=E*re,Ie=E*xe,Ue=P*re,Oe=P*xe,ke=k*xe,Ge=Q*G,Je=Q*re,Rt=Q*xe,Et=_.x,xt=_.y,Zt=_.z;return A[0]=(1-(Ue+ke))*Et,A[1]=(Ee+Rt)*Et,A[2]=(Ie-Je)*Et,A[3]=0,A[4]=(Ee-Rt)*xt,A[5]=(1-(ye+ke))*xt,A[6]=(Oe+Ge)*xt,A[7]=0,A[8]=(Ie+Je)*Zt,A[9]=(Oe-Ge)*Zt,A[10]=(1-(ye+Ue))*Zt,A[11]=0,A[12]=r.x,A[13]=r.y,A[14]=r.z,A[15]=1,this}decompose(r,d,_){const A=this.elements;let E=bu.set(A[0],A[1],A[2]).length();const P=bu.set(A[4],A[5],A[6]).length(),k=bu.set(A[8],A[9],A[10]).length();this.determinant()<0&&(E=-E),r.x=A[12],r.y=A[13],r.z=A[14],ya.copy(this);const Q=1/E,G=1/P,re=1/k;return ya.elements[0]*=Q,ya.elements[1]*=Q,ya.elements[2]*=Q,ya.elements[4]*=G,ya.elements[5]*=G,ya.elements[6]*=G,ya.elements[8]*=re,ya.elements[9]*=re,ya.elements[10]*=re,d.setFromRotationMatrix(ya),_.x=E,_.y=P,_.z=k,this}makePerspective(r,d,_,A,E,P){const k=this.elements,Q=2*E/(d-r),G=2*E/(_-A),re=(d+r)/(d-r),xe=(_+A)/(_-A),ye=-(P+E)/(P-E),Ee=-2*P*E/(P-E);return k[0]=Q,k[4]=0,k[8]=re,k[12]=0,k[1]=0,k[5]=G,k[9]=xe,k[13]=0,k[2]=0,k[6]=0,k[10]=ye,k[14]=Ee,k[3]=0,k[7]=0,k[11]=-1,k[15]=0,this}makeOrthographic(r,d,_,A,E,P){const k=this.elements,Q=1/(d-r),G=1/(_-A),re=1/(P-E),xe=(d+r)*Q,ye=(_+A)*G,Ee=(P+E)*re;return k[0]=2*Q,k[4]=0,k[8]=0,k[12]=-xe,k[1]=0,k[5]=2*G,k[9]=0,k[13]=-ye,k[2]=0,k[6]=0,k[10]=-2*re,k[14]=-Ee,k[3]=0,k[7]=0,k[11]=0,k[15]=1,this}equals(r){const d=this.elements,_=r.elements;for(let A=0;A<16;A++)if(d[A]!==_[A])return!1;return!0}fromArray(r,d=0){for(let _=0;_<16;_++)this.elements[_]=r[_+d];return this}toArray(r=[],d=0){const _=this.elements;return r[d]=_[0],r[d+1]=_[1],r[d+2]=_[2],r[d+3]=_[3],r[d+4]=_[4],r[d+5]=_[5],r[d+6]=_[6],r[d+7]=_[7],r[d+8]=_[8],r[d+9]=_[9],r[d+10]=_[10],r[d+11]=_[11],r[d+12]=_[12],r[d+13]=_[13],r[d+14]=_[14],r[d+15]=_[15],r}}const bu=new zt,ya=new Gr,Hs=new zt(0,0,0),md=new zt(1,1,1),Uo=new zt,ca=new zt,ua=new zt,Zf=new Gr,Zp=new Pl;class Mh{constructor(r=0,d=0,_=0,A=Mh.DEFAULT_ORDER){this.isEuler=!0,this._x=r,this._y=d,this._z=_,this._order=A}get x(){return this._x}set x(r){this._x=r,this._onChangeCallback()}get y(){return this._y}set y(r){this._y=r,this._onChangeCallback()}get z(){return this._z}set z(r){this._z=r,this._onChangeCallback()}get order(){return this._order}set order(r){this._order=r,this._onChangeCallback()}set(r,d,_,A=this._order){return this._x=r,this._y=d,this._z=_,this._order=A,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(r){return this._x=r._x,this._y=r._y,this._z=r._z,this._order=r._order,this._onChangeCallback(),this}setFromRotationMatrix(r,d=this._order,_=!0){const A=r.elements,E=A[0],P=A[4],k=A[8],Q=A[1],G=A[5],re=A[9],xe=A[2],ye=A[6],Ee=A[10];switch(d){case"XYZ":this._y=Math.asin(xo(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(-re,Ee),this._z=Math.atan2(-P,E)):(this._x=Math.atan2(ye,G),this._z=0);break;case"YXZ":this._x=Math.asin(-xo(re,-1,1)),Math.abs(re)<.9999999?(this._y=Math.atan2(k,Ee),this._z=Math.atan2(Q,G)):(this._y=Math.atan2(-xe,E),this._z=0);break;case"ZXY":this._x=Math.asin(xo(ye,-1,1)),Math.abs(ye)<.9999999?(this._y=Math.atan2(-xe,Ee),this._z=Math.atan2(-P,G)):(this._y=0,this._z=Math.atan2(Q,E));break;case"ZYX":this._y=Math.asin(-xo(xe,-1,1)),Math.abs(xe)<.9999999?(this._x=Math.atan2(ye,Ee),this._z=Math.atan2(Q,E)):(this._x=0,this._z=Math.atan2(-P,G));break;case"YZX":this._z=Math.asin(xo(Q,-1,1)),Math.abs(Q)<.9999999?(this._x=Math.atan2(-re,G),this._y=Math.atan2(-xe,E)):(this._x=0,this._y=Math.atan2(k,Ee));break;case"XZY":this._z=Math.asin(-xo(P,-1,1)),Math.abs(P)<.9999999?(this._x=Math.atan2(ye,G),this._y=Math.atan2(k,E)):(this._x=Math.atan2(-re,Ee),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+d)}return this._order=d,_===!0&&this._onChangeCallback(),this}setFromQuaternion(r,d,_){return Zf.makeRotationFromQuaternion(r),this.setFromRotationMatrix(Zf,d,_)}setFromVector3(r,d=this._order){return this.set(r.x,r.y,r.z,d)}reorder(r){return Zp.setFromEuler(this),this.setFromQuaternion(Zp,r)}equals(r){return r._x===this._x&&r._y===this._y&&r._z===this._z&&r._order===this._order}fromArray(r){return this._x=r[0],this._y=r[1],this._z=r[2],r[3]!==void 0&&(this._order=r[3]),this._onChangeCallback(),this}toArray(r=[],d=0){return r[d]=this._x,r[d+1]=this._y,r[d+2]=this._z,r[d+3]=this._order,r}_onChange(r){return this._onChangeCallback=r,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Mh.DEFAULT_ORDER="XYZ";class Th{constructor(){this.mask=1}set(r){this.mask=(1<<r|0)>>>0}enable(r){this.mask|=1<<r|0}enableAll(){this.mask=-1}toggle(r){this.mask^=1<<r|0}disable(r){this.mask&=~(1<<r|0)}disableAll(){this.mask=0}test(r){return(this.mask&r.mask)!=0}isEnabled(r){return(this.mask&(1<<r|0))!=0}}let em=0;const ha=new zt,xu=new Pl,wo=new Gr,ll=new zt,qa=new zt,Wc=new zt,Qu=new Pl,ef=new zt(1,0,0),tf=new zt(0,1,0),wu=new zt(0,0,1),Ch={type:"added"},Qc={type:"removed"};class bs extends sl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:em++}),this.uuid=Cl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bs.DEFAULT_UP.clone();const r=new zt,d=new Mh,_=new Pl,A=new zt(1,1,1);d._onChange(function(){_.setFromEuler(d,!1)}),_._onChange(function(){d.setFromQuaternion(_,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:d},quaternion:{configurable:!0,enumerable:!0,value:_},scale:{configurable:!0,enumerable:!0,value:A},modelViewMatrix:{value:new Gr},normalMatrix:{value:new Ji}}),this.matrix=new Gr,this.matrixWorld=new Gr,this.matrixAutoUpdate=bs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=bs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Th,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(r,d,_,A,E,P){this.dispatchEvent({type:"beforeRender",renderer:r,scene:d,camera:_,geometry:A,material:E,group:P})}onAfterRender(){}applyMatrix4(r){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(r),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(r){return this.quaternion.premultiply(r),this}setRotationFromAxisAngle(r,d){this.quaternion.setFromAxisAngle(r,d)}setRotationFromEuler(r){this.quaternion.setFromEuler(r,!0)}setRotationFromMatrix(r){this.quaternion.setFromRotationMatrix(r)}setRotationFromQuaternion(r){this.quaternion.copy(r)}rotateOnAxis(r,d){return xu.setFromAxisAngle(r,d),this.quaternion.multiply(xu),this}rotateOnWorldAxis(r,d){return xu.setFromAxisAngle(r,d),this.quaternion.premultiply(xu),this}rotateX(r){return this.rotateOnAxis(ef,r)}rotateY(r){return this.rotateOnAxis(tf,r)}rotateZ(r){return this.rotateOnAxis(wu,r)}translateOnAxis(r,d){return ha.copy(r).applyQuaternion(this.quaternion),this.position.add(ha.multiplyScalar(d)),this}translateX(r){return this.translateOnAxis(ef,r)}translateY(r){return this.translateOnAxis(tf,r)}translateZ(r){return this.translateOnAxis(wu,r)}localToWorld(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(this.matrixWorld)}worldToLocal(r){return this.updateWorldMatrix(!0,!1),r.applyMatrix4(wo.copy(this.matrixWorld).invert())}lookAt(r,d,_){r.isVector3?ll.copy(r):ll.set(r,d,_);const A=this.parent;this.updateWorldMatrix(!0,!1),qa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wo.lookAt(qa,ll,this.up):wo.lookAt(ll,qa,this.up),this.quaternion.setFromRotationMatrix(wo),A&&(wo.extractRotation(A.matrixWorld),xu.setFromRotationMatrix(wo),this.quaternion.premultiply(xu.invert()))}add(r){if(arguments.length>1){for(let d=0;d<arguments.length;d++)this.add(arguments[d]);return this}return r===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",r),this):(r&&r.isObject3D?(r.parent!==null&&r.parent.remove(r),r.parent=this,this.children.push(r),r.dispatchEvent(Ch)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",r),this)}remove(r){if(arguments.length>1){for(let _=0;_<arguments.length;_++)this.remove(arguments[_]);return this}const d=this.children.indexOf(r);return d!==-1&&(r.parent=null,this.children.splice(d,1),r.dispatchEvent(Qc)),this}removeFromParent(){const r=this.parent;return r!==null&&r.remove(this),this}clear(){for(let r=0;r<this.children.length;r++){const d=this.children[r];d.parent=null,d.dispatchEvent(Qc)}return this.children.length=0,this}attach(r){return this.updateWorldMatrix(!0,!1),wo.copy(this.matrixWorld).invert(),r.parent!==null&&(r.parent.updateWorldMatrix(!0,!1),wo.multiply(r.parent.matrixWorld)),r.applyMatrix4(wo),this.add(r),r.updateWorldMatrix(!1,!0),this}getObjectById(r){return this.getObjectByProperty("id",r)}getObjectByName(r){return this.getObjectByProperty("name",r)}getObjectByProperty(r,d){if(this[r]===d)return this;for(let _=0,A=this.children.length;_<A;_++){const E=this.children[_].getObjectByProperty(r,d);if(E!==void 0)return E}}getObjectsByProperty(r,d){let _=[];this[r]===d&&_.push(this);for(let A=0,E=this.children.length;A<E;A++){const P=this.children[A].getObjectsByProperty(r,d);P.length>0&&(_=_.concat(P))}return _}getWorldPosition(r){return this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qa,r,Wc),r}getWorldScale(r){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qa,Qu,r),r}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return r.set(d[8],d[9],d[10]).normalize()}raycast(){}traverse(r){r(this);const d=this.children;for(let _=0,A=d.length;_<A;_++)d[_].traverse(r)}traverseVisible(r){if(this.visible===!1)return;r(this);const d=this.children;for(let _=0,A=d.length;_<A;_++)d[_].traverseVisible(r)}traverseAncestors(r){const d=this.parent;d!==null&&(r(d),d.traverseAncestors(r))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(r){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||r)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,r=!0);const d=this.children;for(let _=0,A=d.length;_<A;_++){const E=d[_];E.matrixWorldAutoUpdate!==!0&&r!==!0||E.updateMatrixWorld(r)}}updateWorldMatrix(r,d){const _=this.parent;if(r===!0&&_!==null&&_.matrixWorldAutoUpdate===!0&&_.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),d===!0){const A=this.children;for(let E=0,P=A.length;E<P;E++){const k=A[E];k.matrixWorldAutoUpdate===!0&&k.updateWorldMatrix(!1,!0)}}}toJSON(r){const d=r===void 0||typeof r=="string",_={};d&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},_.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const A={};function E(k,Q){return k[Q.uuid]===void 0&&(k[Q.uuid]=Q.toJSON(r)),Q.uuid}if(A.uuid=this.uuid,A.type=this.type,this.name!==""&&(A.name=this.name),this.castShadow===!0&&(A.castShadow=!0),this.receiveShadow===!0&&(A.receiveShadow=!0),this.visible===!1&&(A.visible=!1),this.frustumCulled===!1&&(A.frustumCulled=!1),this.renderOrder!==0&&(A.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(A.userData=this.userData),A.layers=this.layers.mask,A.matrix=this.matrix.toArray(),A.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(A.matrixAutoUpdate=!1),this.isInstancedMesh&&(A.type="InstancedMesh",A.count=this.count,A.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(A.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?A.background=this.background.toJSON():this.background.isTexture&&(A.background=this.background.toJSON(r).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(A.environment=this.environment.toJSON(r).uuid);else if(this.isMesh||this.isLine||this.isPoints){A.geometry=E(r.geometries,this.geometry);const k=this.geometry.parameters;if(k!==void 0&&k.shapes!==void 0){const Q=k.shapes;if(Array.isArray(Q))for(let G=0,re=Q.length;G<re;G++){const xe=Q[G];E(r.shapes,xe)}else E(r.shapes,Q)}}if(this.isSkinnedMesh&&(A.bindMode=this.bindMode,A.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(E(r.skeletons,this.skeleton),A.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const k=[];for(let Q=0,G=this.material.length;Q<G;Q++)k.push(E(r.materials,this.material[Q]));A.material=k}else A.material=E(r.materials,this.material);if(this.children.length>0){A.children=[];for(let k=0;k<this.children.length;k++)A.children.push(this.children[k].toJSON(r).object)}if(this.animations.length>0){A.animations=[];for(let k=0;k<this.animations.length;k++){const Q=this.animations[k];A.animations.push(E(r.animations,Q))}}if(d){const k=P(r.geometries),Q=P(r.materials),G=P(r.textures),re=P(r.images),xe=P(r.shapes),ye=P(r.skeletons),Ee=P(r.animations),Ie=P(r.nodes);k.length>0&&(_.geometries=k),Q.length>0&&(_.materials=Q),G.length>0&&(_.textures=G),re.length>0&&(_.images=re),xe.length>0&&(_.shapes=xe),ye.length>0&&(_.skeletons=ye),Ee.length>0&&(_.animations=Ee),Ie.length>0&&(_.nodes=Ie)}return _.object=A,_;function P(k){const Q=[];for(const G in k){const re=k[G];delete re.metadata,Q.push(re)}return Q}}clone(r){return new this.constructor().copy(this,r)}copy(r,d=!0){this.name=r.name,this.up.copy(r.up),this.position.copy(r.position),this.rotation.order=r.rotation.order,this.quaternion.copy(r.quaternion),this.scale.copy(r.scale),this.matrix.copy(r.matrix),this.matrixWorld.copy(r.matrixWorld),this.matrixAutoUpdate=r.matrixAutoUpdate,this.matrixWorldNeedsUpdate=r.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=r.matrixWorldAutoUpdate,this.layers.mask=r.layers.mask,this.visible=r.visible,this.castShadow=r.castShadow,this.receiveShadow=r.receiveShadow,this.frustumCulled=r.frustumCulled,this.renderOrder=r.renderOrder,this.animations=r.animations,this.userData={};for(const[_,A]of Object.entries(r.userData))this.userData[_]=!A||A&&(A.isTexture||A.isObject3D)?A:JSON.parse(JSON.stringify(A));if(d===!0)for(let _=0;_<r.children.length;_++){const A=r.children[_];this.add(A.clone())}return this}}bs.DEFAULT_UP=new zt(0,1,0),bs.DEFAULT_MATRIX_AUTO_UPDATE=!0,bs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ca=new zt,Ra=new zt,Eu=new zt,qc=new zt,vc=new zt,yc=new zt,Ac=new zt,gd=new zt,qu=new zt,ql=new zt;let _d=!1;class Cs{constructor(r=new zt,d=new zt,_=new zt){this.a=r,this.b=d,this.c=_}static getNormal(r,d,_,A){A.subVectors(_,d),Ca.subVectors(r,d),A.cross(Ca);const E=A.lengthSq();return E>0?A.multiplyScalar(1/Math.sqrt(E)):A.set(0,0,0)}static getBarycoord(r,d,_,A,E){Ca.subVectors(A,d),Ra.subVectors(_,d),Eu.subVectors(r,d);const P=Ca.dot(Ca),k=Ca.dot(Ra),Q=Ca.dot(Eu),G=Ra.dot(Ra),re=Ra.dot(Eu),xe=P*G-k*k;if(xe===0)return E.set(-2,-1,-1);const ye=1/xe,Ee=(G*Q-k*re)*ye,Ie=(P*re-k*Q)*ye;return E.set(1-Ee-Ie,Ie,Ee)}static containsPoint(r,d,_,A){return this.getBarycoord(r,d,_,A,qc),qc.x>=0&&qc.y>=0&&qc.x+qc.y<=1}static getUV(r,d,_,A,E,P,k,Q){return _d===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),_d=!0),this.getInterpolation(r,d,_,A,E,P,k,Q)}static getInterpolation(r,d,_,A,E,P,k,Q){return this.getBarycoord(r,d,_,A,qc),Q.setScalar(0),Q.addScaledVector(E,qc.x),Q.addScaledVector(P,qc.y),Q.addScaledVector(k,qc.z),Q}static isFrontFacing(r,d,_,A){return Ca.subVectors(_,d),Ra.subVectors(r,d),Ca.cross(Ra).dot(A)<0}set(r,d,_){return this.a.copy(r),this.b.copy(d),this.c.copy(_),this}setFromPointsAndIndices(r,d,_,A){return this.a.copy(r[d]),this.b.copy(r[_]),this.c.copy(r[A]),this}setFromAttributeAndIndices(r,d,_,A){return this.a.fromBufferAttribute(r,d),this.b.fromBufferAttribute(r,_),this.c.fromBufferAttribute(r,A),this}clone(){return new this.constructor().copy(this)}copy(r){return this.a.copy(r.a),this.b.copy(r.b),this.c.copy(r.c),this}getArea(){return Ca.subVectors(this.c,this.b),Ra.subVectors(this.a,this.b),.5*Ca.cross(Ra).length()}getMidpoint(r){return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(r){return Cs.getNormal(this.a,this.b,this.c,r)}getPlane(r){return r.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(r,d){return Cs.getBarycoord(r,this.a,this.b,this.c,d)}getUV(r,d,_,A,E){return _d===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),_d=!0),Cs.getInterpolation(r,this.a,this.b,this.c,d,_,A,E)}getInterpolation(r,d,_,A,E){return Cs.getInterpolation(r,this.a,this.b,this.c,d,_,A,E)}containsPoint(r){return Cs.containsPoint(r,this.a,this.b,this.c)}isFrontFacing(r){return Cs.isFrontFacing(this.a,this.b,this.c,r)}intersectsBox(r){return r.intersectsTriangle(this)}closestPointToPoint(r,d){const _=this.a,A=this.b,E=this.c;let P,k;vc.subVectors(A,_),yc.subVectors(E,_),gd.subVectors(r,_);const Q=vc.dot(gd),G=yc.dot(gd);if(Q<=0&&G<=0)return d.copy(_);qu.subVectors(r,A);const re=vc.dot(qu),xe=yc.dot(qu);if(re>=0&&xe<=re)return d.copy(A);const ye=Q*xe-re*G;if(ye<=0&&Q>=0&&re<=0)return P=Q/(Q-re),d.copy(_).addScaledVector(vc,P);ql.subVectors(r,E);const Ee=vc.dot(ql),Ie=yc.dot(ql);if(Ie>=0&&Ee<=Ie)return d.copy(E);const Ue=Ee*G-Q*Ie;if(Ue<=0&&G>=0&&Ie<=0)return k=G/(G-Ie),d.copy(_).addScaledVector(yc,k);const Oe=re*Ie-Ee*xe;if(Oe<=0&&xe-re>=0&&Ee-Ie>=0)return Ac.subVectors(E,A),k=(xe-re)/(xe-re+(Ee-Ie)),d.copy(A).addScaledVector(Ac,k);const ke=1/(Oe+Ue+ye);return P=Ue*ke,k=ye*ke,d.copy(_).addScaledVector(vc,P).addScaledVector(yc,k)}equals(r){return r.a.equals(this.a)&&r.b.equals(this.b)&&r.c.equals(this.c)}}let ap=0;class da extends sl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ap++}),this.uuid=Cl(),this.name="",this.type="Material",this.blending=W,this.side=se,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Ye,this.blendDst=it,this.blendEquation=$,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=bt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=_h,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zc,this.stencilZFail=zc,this.stencilZPass=zc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(r){this._alphaTest>0!=r>0&&this.version++,this._alphaTest=r}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(r){if(r!==void 0)for(const d in r){const _=r[d];if(_===void 0){console.warn(`THREE.Material: parameter '${d}' has value of undefined.`);continue}const A=this[d];A!==void 0&&(A&&A.isColor?A.set(_):A&&A.isVector3&&_&&_.isVector3?A.copy(_):Array.isArray(_)&&A&&typeof A.fromArray=="function"?A.fromArray(_):this[d]=_)}}toJSON(r){const d=r===void 0||typeof r=="string";d&&(r={textures:{},images:{}});const _={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function A(E){const P=[];for(const k in E){const Q=E[k];delete Q.metadata,P.push(Q)}return P}if(_.uuid=this.uuid,_.type=this.type,this.name!==""&&(_.name=this.name),this.color&&this.color.isColor&&(_.color=this.color.getHex()),this.roughness!==void 0&&(_.roughness=this.roughness),this.metalness!==void 0&&(_.metalness=this.metalness),this.sheen!==void 0&&(_.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(_.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(_.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(_.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(_.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(_.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(_.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(_.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(_.shininess=this.shininess),this.clearcoat!==void 0&&(_.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(_.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(_.clearcoatMap=this.clearcoatMap.toJSON(r).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(_.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(r).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(_.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(r).uuid,_.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(_.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(_.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(_.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(_.iridescenceMap=this.iridescenceMap.toJSON(r).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(_.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(r).uuid),this.map&&this.map.isTexture&&(_.map=this.map.toJSON(r).uuid),this.matcap&&this.matcap.isTexture&&(_.matcap=this.matcap.toJSON(r).uuid),this.alphaMap&&this.alphaMap.isTexture&&(_.alphaMap=this.alphaMap.toJSON(r).uuid),this.lightMap&&this.lightMap.isTexture&&(_.lightMap=this.lightMap.toJSON(r).uuid,_.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(_.aoMap=this.aoMap.toJSON(r).uuid,_.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(_.bumpMap=this.bumpMap.toJSON(r).uuid,_.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(_.normalMap=this.normalMap.toJSON(r).uuid,_.normalMapType=this.normalMapType,_.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(_.displacementMap=this.displacementMap.toJSON(r).uuid,_.displacementScale=this.displacementScale,_.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(_.roughnessMap=this.roughnessMap.toJSON(r).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(_.metalnessMap=this.metalnessMap.toJSON(r).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(_.emissiveMap=this.emissiveMap.toJSON(r).uuid),this.specularMap&&this.specularMap.isTexture&&(_.specularMap=this.specularMap.toJSON(r).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(_.specularIntensityMap=this.specularIntensityMap.toJSON(r).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(_.specularColorMap=this.specularColorMap.toJSON(r).uuid),this.envMap&&this.envMap.isTexture&&(_.envMap=this.envMap.toJSON(r).uuid,this.combine!==void 0&&(_.combine=this.combine)),this.envMapIntensity!==void 0&&(_.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(_.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(_.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(_.gradientMap=this.gradientMap.toJSON(r).uuid),this.transmission!==void 0&&(_.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(_.transmissionMap=this.transmissionMap.toJSON(r).uuid),this.thickness!==void 0&&(_.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(_.thicknessMap=this.thicknessMap.toJSON(r).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(_.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(_.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(_.size=this.size),this.shadowSide!==null&&(_.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(_.sizeAttenuation=this.sizeAttenuation),this.blending!==W&&(_.blending=this.blending),this.side!==se&&(_.side=this.side),this.vertexColors&&(_.vertexColors=!0),this.opacity<1&&(_.opacity=this.opacity),this.transparent===!0&&(_.transparent=this.transparent),_.depthFunc=this.depthFunc,_.depthTest=this.depthTest,_.depthWrite=this.depthWrite,_.colorWrite=this.colorWrite,_.stencilWrite=this.stencilWrite,_.stencilWriteMask=this.stencilWriteMask,_.stencilFunc=this.stencilFunc,_.stencilRef=this.stencilRef,_.stencilFuncMask=this.stencilFuncMask,_.stencilFail=this.stencilFail,_.stencilZFail=this.stencilZFail,_.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(_.rotation=this.rotation),this.polygonOffset===!0&&(_.polygonOffset=!0),this.polygonOffsetFactor!==0&&(_.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(_.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(_.linewidth=this.linewidth),this.dashSize!==void 0&&(_.dashSize=this.dashSize),this.gapSize!==void 0&&(_.gapSize=this.gapSize),this.scale!==void 0&&(_.scale=this.scale),this.dithering===!0&&(_.dithering=!0),this.alphaTest>0&&(_.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(_.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(_.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(_.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(_.wireframe=this.wireframe),this.wireframeLinewidth>1&&(_.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(_.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(_.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(_.flatShading=this.flatShading),this.visible===!1&&(_.visible=!1),this.toneMapped===!1&&(_.toneMapped=!1),this.fog===!1&&(_.fog=!1),Object.keys(this.userData).length>0&&(_.userData=this.userData),d){const E=A(r.textures),P=A(r.images);E.length>0&&(_.textures=E),P.length>0&&(_.images=P)}return _}clone(){return new this.constructor().copy(this)}copy(r){this.name=r.name,this.blending=r.blending,this.side=r.side,this.vertexColors=r.vertexColors,this.opacity=r.opacity,this.transparent=r.transparent,this.blendSrc=r.blendSrc,this.blendDst=r.blendDst,this.blendEquation=r.blendEquation,this.blendSrcAlpha=r.blendSrcAlpha,this.blendDstAlpha=r.blendDstAlpha,this.blendEquationAlpha=r.blendEquationAlpha,this.depthFunc=r.depthFunc,this.depthTest=r.depthTest,this.depthWrite=r.depthWrite,this.stencilWriteMask=r.stencilWriteMask,this.stencilFunc=r.stencilFunc,this.stencilRef=r.stencilRef,this.stencilFuncMask=r.stencilFuncMask,this.stencilFail=r.stencilFail,this.stencilZFail=r.stencilZFail,this.stencilZPass=r.stencilZPass,this.stencilWrite=r.stencilWrite;const d=r.clippingPlanes;let _=null;if(d!==null){const A=d.length;_=new Array(A);for(let E=0;E!==A;++E)_[E]=d[E].clone()}return this.clippingPlanes=_,this.clipIntersection=r.clipIntersection,this.clipShadows=r.clipShadows,this.shadowSide=r.shadowSide,this.colorWrite=r.colorWrite,this.precision=r.precision,this.polygonOffset=r.polygonOffset,this.polygonOffsetFactor=r.polygonOffsetFactor,this.polygonOffsetUnits=r.polygonOffsetUnits,this.dithering=r.dithering,this.alphaTest=r.alphaTest,this.alphaToCoverage=r.alphaToCoverage,this.premultipliedAlpha=r.premultipliedAlpha,this.forceSinglePass=r.forceSinglePass,this.visible=r.visible,this.toneMapped=r.toneMapped,this.userData=lp({},r.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(r){r===!0&&this.version++}}function lp(R,r){if(!r)return R;for(const d of Object.keys(r)){if(d.startsWith("__")||typeof R[d]=="function"||typeof r[d]=="function")continue;const _=r[d],A=!_||_.isTexture||_.isObject3D||_.isMaterial;A||typeof r[d].clone!="function"?A||typeof r[d]!="object"&&!Array.isArray(r[d])?R[d]=r[d]:R[d]=lp(Array.isArray(r[d])?[]:{},r[d]):R[d]=r[d].clone()}return R}const Rh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fo={h:0,s:0,l:0},bc={h:0,s:0,l:0};function Xc(R,r,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?R+6*(r-R)*d:d<.5?r:d<2/3?R+6*(r-R)*(2/3-d):R}class Fi{constructor(r,d,_){return this.isColor=!0,this.r=1,this.g=1,this.b=1,d===void 0&&_===void 0?this.set(r):this.setRGB(r,d,_)}set(r){return r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r),this}setScalar(r){return this.r=r,this.g=r,this.b=r,this}setHex(r,d=xr){return r=Math.floor(r),this.r=(r>>16&255)/255,this.g=(r>>8&255)/255,this.b=(255&r)/255,Wa.toWorkingColorSpace(this,d),this}setRGB(r,d,_,A=Wa.workingColorSpace){return this.r=r,this.g=d,this.b=_,Wa.toWorkingColorSpace(this,A),this}setHSL(r,d,_,A=Wa.workingColorSpace){if(r=np(r,1),d=xo(d,0,1),_=xo(_,0,1),d===0)this.r=this.g=this.b=_;else{const E=_<=.5?_*(1+d):_+d-_*d,P=2*_-E;this.r=Xc(P,E,r+1/3),this.g=Xc(P,E,r),this.b=Xc(P,E,r-1/3)}return Wa.toWorkingColorSpace(this,A),this}setStyle(r,d=xr){function _(E){E!==void 0&&parseFloat(E)<1&&console.warn("THREE.Color: Alpha component of "+r+" will be ignored.")}let A;if(A=/^(\w+)\(([^\)]*)\)/.exec(r)){let E;const P=A[1],k=A[2];switch(P){case"rgb":case"rgba":if(E=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k))return _(E[4]),this.setRGB(Math.min(255,parseInt(E[1],10))/255,Math.min(255,parseInt(E[2],10))/255,Math.min(255,parseInt(E[3],10))/255,d);if(E=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k))return _(E[4]),this.setRGB(Math.min(100,parseInt(E[1],10))/100,Math.min(100,parseInt(E[2],10))/100,Math.min(100,parseInt(E[3],10))/100,d);break;case"hsl":case"hsla":if(E=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(k))return _(E[4]),this.setHSL(parseFloat(E[1])/360,parseFloat(E[2])/100,parseFloat(E[3])/100,d);break;default:console.warn("THREE.Color: Unknown color model "+r)}}else if(A=/^\#([A-Fa-f\d]+)$/.exec(r)){const E=A[1],P=E.length;if(P===3)return this.setRGB(parseInt(E.charAt(0),16)/15,parseInt(E.charAt(1),16)/15,parseInt(E.charAt(2),16)/15,d);if(P===6)return this.setHex(parseInt(E,16),d);console.warn("THREE.Color: Invalid hex color "+r)}else if(r&&r.length>0)return this.setColorName(r,d);return this}setColorName(r,d=xr){const _=Rh[r.toLowerCase()];return _!==void 0?this.setHex(_,d):console.warn("THREE.Color: Unknown color "+r),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(r){return this.r=r.r,this.g=r.g,this.b=r.b,this}copySRGBToLinear(r){return this.r=Rl(r.r),this.g=Rl(r.g),this.b=Rl(r.b),this}copyLinearToSRGB(r){return this.r=Il(r.r),this.g=Il(r.g),this.b=Il(r.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(r=xr){return Wa.fromWorkingColorSpace(Ls.copy(this),r),65536*Math.round(xo(255*Ls.r,0,255))+256*Math.round(xo(255*Ls.g,0,255))+Math.round(xo(255*Ls.b,0,255))}getHexString(r=xr){return("000000"+this.getHex(r).toString(16)).slice(-6)}getHSL(r,d=Wa.workingColorSpace){Wa.fromWorkingColorSpace(Ls.copy(this),d);const _=Ls.r,A=Ls.g,E=Ls.b,P=Math.max(_,A,E),k=Math.min(_,A,E);let Q,G;const re=(k+P)/2;if(k===P)Q=0,G=0;else{const xe=P-k;switch(G=re<=.5?xe/(P+k):xe/(2-P-k),P){case _:Q=(A-E)/xe+(A<E?6:0);break;case A:Q=(E-_)/xe+2;break;case E:Q=(_-A)/xe+4}Q/=6}return r.h=Q,r.s=G,r.l=re,r}getRGB(r,d=Wa.workingColorSpace){return Wa.fromWorkingColorSpace(Ls.copy(this),d),r.r=Ls.r,r.g=Ls.g,r.b=Ls.b,r}getStyle(r=xr){Wa.fromWorkingColorSpace(Ls.copy(this),r);const d=Ls.r,_=Ls.g,A=Ls.b;return r!==xr?`color(${r} ${d.toFixed(3)} ${_.toFixed(3)} ${A.toFixed(3)})`:`rgb(${Math.round(255*d)},${Math.round(255*_)},${Math.round(255*A)})`}offsetHSL(r,d,_){return this.getHSL(Fo),Fo.h+=r,Fo.s+=d,Fo.l+=_,this.setHSL(Fo.h,Fo.s,Fo.l),this}add(r){return this.r+=r.r,this.g+=r.g,this.b+=r.b,this}addColors(r,d){return this.r=r.r+d.r,this.g=r.g+d.g,this.b=r.b+d.b,this}addScalar(r){return this.r+=r,this.g+=r,this.b+=r,this}sub(r){return this.r=Math.max(0,this.r-r.r),this.g=Math.max(0,this.g-r.g),this.b=Math.max(0,this.b-r.b),this}multiply(r){return this.r*=r.r,this.g*=r.g,this.b*=r.b,this}multiplyScalar(r){return this.r*=r,this.g*=r,this.b*=r,this}lerp(r,d){return this.r+=(r.r-this.r)*d,this.g+=(r.g-this.g)*d,this.b+=(r.b-this.b)*d,this}lerpColors(r,d,_){return this.r=r.r+(d.r-r.r)*_,this.g=r.g+(d.g-r.g)*_,this.b=r.b+(d.b-r.b)*_,this}lerpHSL(r,d){this.getHSL(Fo),r.getHSL(bc);const _=yh(Fo.h,bc.h,d),A=yh(Fo.s,bc.s,d),E=yh(Fo.l,bc.l,d);return this.setHSL(_,A,E),this}setFromVector3(r){return this.r=r.x,this.g=r.y,this.b=r.z,this}applyMatrix3(r){const d=this.r,_=this.g,A=this.b,E=r.elements;return this.r=E[0]*d+E[3]*_+E[6]*A,this.g=E[1]*d+E[4]*_+E[7]*A,this.b=E[2]*d+E[5]*_+E[8]*A,this}equals(r){return r.r===this.r&&r.g===this.g&&r.b===this.b}fromArray(r,d=0){return this.r=r[d],this.g=r[d+1],this.b=r[d+2],this}toArray(r=[],d=0){return r[d]=this.r,r[d+1]=this.g,r[d+2]=this.b,r}fromBufferAttribute(r,d){return this.r=r.getX(d),this.g=r.getY(d),this.b=r.getZ(d),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ls=new Fi;Fi.NAMES=Rh;class Ia extends da{constructor(r){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}const ho=po();function po(){const R=new ArrayBuffer(4),r=new Float32Array(R),d=new Uint32Array(R),_=new Uint32Array(512),A=new Uint32Array(512);for(let Q=0;Q<256;++Q){const G=Q-127;G<-27?(_[Q]=0,_[256|Q]=32768,A[Q]=24,A[256|Q]=24):G<-14?(_[Q]=1024>>-G-14,_[256|Q]=1024>>-G-14|32768,A[Q]=-G-1,A[256|Q]=-G-1):G<=15?(_[Q]=G+15<<10,_[256|Q]=G+15<<10|32768,A[Q]=13,A[256|Q]=13):G<128?(_[Q]=31744,_[256|Q]=64512,A[Q]=24,A[256|Q]=24):(_[Q]=31744,_[256|Q]=64512,A[Q]=13,A[256|Q]=13)}const E=new Uint32Array(2048),P=new Uint32Array(64),k=new Uint32Array(64);for(let Q=1;Q<1024;++Q){let G=Q<<13,re=0;for(;!(8388608&G);)G<<=1,re-=8388608;G&=-8388609,re+=947912704,E[Q]=G|re}for(let Q=1024;Q<2048;++Q)E[Q]=939524096+(Q-1024<<13);for(let Q=1;Q<31;++Q)P[Q]=Q<<23;P[31]=1199570944,P[32]=2147483648;for(let Q=33;Q<63;++Q)P[Q]=2147483648+(Q-32<<23);P[63]=3347054592;for(let Q=1;Q<64;++Q)Q!==32&&(k[Q]=1024);return{floatView:r,uint32View:d,baseTable:_,shiftTable:A,mantissaTable:E,exponentTable:P,offsetTable:k}}function zo(R){Math.abs(R)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),R=xo(R,-65504,65504),ho.floatView[0]=R;const r=ho.uint32View[0],d=r>>23&511;return ho.baseTable[d]+((8388607&r)>>ho.shiftTable[d])}function Es(R){const r=R>>10;return ho.uint32View[0]=ho.mantissaTable[ho.offsetTable[r]+(1023&R)]+ho.exponentTable[r],ho.floatView[0]}const Mg={toHalfFloat:zo,fromHalfFloat:Es},ws=new zt,vd=new li;class Ns{constructor(r,d,_=!1){if(Array.isArray(r))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=r,this.itemSize=d,this.count=r!==void 0?r.length/d:0,this.normalized=_,this.usage=Hu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.name=r.name,this.array=new r.array.constructor(r.array),this.itemSize=r.itemSize,this.count=r.count,this.normalized=r.normalized,this.usage=r.usage,this}copyAt(r,d,_){r*=this.itemSize,_*=d.itemSize;for(let A=0,E=this.itemSize;A<E;A++)this.array[r+A]=d.array[_+A];return this}copyArray(r){return this.array.set(r),this}applyMatrix3(r){if(this.itemSize===2)for(let d=0,_=this.count;d<_;d++)vd.fromBufferAttribute(this,d),vd.applyMatrix3(r),this.setXY(d,vd.x,vd.y);else if(this.itemSize===3)for(let d=0,_=this.count;d<_;d++)ws.fromBufferAttribute(this,d),ws.applyMatrix3(r),this.setXYZ(d,ws.x,ws.y,ws.z);return this}applyMatrix4(r){for(let d=0,_=this.count;d<_;d++)ws.fromBufferAttribute(this,d),ws.applyMatrix4(r),this.setXYZ(d,ws.x,ws.y,ws.z);return this}applyNormalMatrix(r){for(let d=0,_=this.count;d<_;d++)ws.fromBufferAttribute(this,d),ws.applyNormalMatrix(r),this.setXYZ(d,ws.x,ws.y,ws.z);return this}transformDirection(r){for(let d=0,_=this.count;d<_;d++)ws.fromBufferAttribute(this,d),ws.transformDirection(r),this.setXYZ(d,ws.x,ws.y,ws.z);return this}set(r,d=0){return this.array.set(r,d),this}getX(r){let d=this.array[r*this.itemSize];return this.normalized&&(d=aa(d,this.array)),d}setX(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize]=d,this}getY(r){let d=this.array[r*this.itemSize+1];return this.normalized&&(d=aa(d,this.array)),d}setY(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+1]=d,this}getZ(r){let d=this.array[r*this.itemSize+2];return this.normalized&&(d=aa(d,this.array)),d}setZ(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+2]=d,this}getW(r){let d=this.array[r*this.itemSize+3];return this.normalized&&(d=aa(d,this.array)),d}setW(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+3]=d,this}setXY(r,d,_){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array)),this.array[r+0]=d,this.array[r+1]=_,this}setXYZ(r,d,_,A){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array)),this.array[r+0]=d,this.array[r+1]=_,this.array[r+2]=A,this}setXYZW(r,d,_,A,E){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array),E=rs(E,this.array)),this.array[r+0]=d,this.array[r+1]=_,this.array[r+2]=A,this.array[r+3]=E,this}onUpload(r){return this.onUploadCallback=r,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const r={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(r.name=this.name),this.usage!==Hu&&(r.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(r.updateRange=this.updateRange),r}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class nf extends Ns{constructor(r,d,_){super(new Int8Array(r),d,_)}}class ov extends Ns{constructor(r,d,_){super(new Uint8Array(r),d,_)}}class rf extends Ns{constructor(r,d,_){super(new Uint8ClampedArray(r),d,_)}}class Xl extends Ns{constructor(r,d,_){super(new Int16Array(r),d,_)}}class Ih extends Ns{constructor(r,d,_){super(new Uint16Array(r),d,_)}}class Yc extends Ns{constructor(r,d,_){super(new Int32Array(r),d,_)}}class Ph extends Ns{constructor(r,d,_){super(new Uint32Array(r),d,_)}}class Aa extends Ns{constructor(r,d,_){super(new Uint16Array(r),d,_),this.isFloat16BufferAttribute=!0}getX(r){let d=Es(this.array[r*this.itemSize]);return this.normalized&&(d=aa(d,this.array)),d}setX(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize]=zo(d),this}getY(r){let d=Es(this.array[r*this.itemSize+1]);return this.normalized&&(d=aa(d,this.array)),d}setY(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+1]=zo(d),this}getZ(r){let d=Es(this.array[r*this.itemSize+2]);return this.normalized&&(d=aa(d,this.array)),d}setZ(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+2]=zo(d),this}getW(r){let d=Es(this.array[r*this.itemSize+3]);return this.normalized&&(d=aa(d,this.array)),d}setW(r,d){return this.normalized&&(d=rs(d,this.array)),this.array[r*this.itemSize+3]=zo(d),this}setXY(r,d,_){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array)),this.array[r+0]=zo(d),this.array[r+1]=zo(_),this}setXYZ(r,d,_,A){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array)),this.array[r+0]=zo(d),this.array[r+1]=zo(_),this.array[r+2]=zo(A),this}setXYZW(r,d,_,A,E){return r*=this.itemSize,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array),E=rs(E,this.array)),this.array[r+0]=zo(d),this.array[r+1]=zo(_),this.array[r+2]=zo(A),this.array[r+3]=zo(E),this}}class tr extends Ns{constructor(r,d,_){super(new Float32Array(r),d,_)}}class cp extends Ns{constructor(r,d,_){super(new Float64Array(r),d,_)}}let Xu=0;const pa=new Gr,sf=new bs,ie=new zt,T=new Ql,F=new Ql,de=new zt;class Fe extends sl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xu++}),this.uuid=Cl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(r){return Array.isArray(r)?this.index=new(hd(r)?Ph:Ih)(r,1):this.index=r,this}getAttribute(r){return this.attributes[r]}setAttribute(r,d){return this.attributes[r]=d,this}deleteAttribute(r){return delete this.attributes[r],this}hasAttribute(r){return this.attributes[r]!==void 0}addGroup(r,d,_=0){this.groups.push({start:r,count:d,materialIndex:_})}clearGroups(){this.groups=[]}setDrawRange(r,d){this.drawRange.start=r,this.drawRange.count=d}applyMatrix4(r){const d=this.attributes.position;d!==void 0&&(d.applyMatrix4(r),d.needsUpdate=!0);const _=this.attributes.normal;if(_!==void 0){const E=new Ji().getNormalMatrix(r);_.applyNormalMatrix(E),_.needsUpdate=!0}const A=this.attributes.tangent;return A!==void 0&&(A.transformDirection(r),A.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(r){return pa.makeRotationFromQuaternion(r),this.applyMatrix4(pa),this}rotateX(r){return pa.makeRotationX(r),this.applyMatrix4(pa),this}rotateY(r){return pa.makeRotationY(r),this.applyMatrix4(pa),this}rotateZ(r){return pa.makeRotationZ(r),this.applyMatrix4(pa),this}translate(r,d,_){return pa.makeTranslation(r,d,_),this.applyMatrix4(pa),this}scale(r,d,_){return pa.makeScale(r,d,_),this.applyMatrix4(pa),this}lookAt(r){return sf.lookAt(r),sf.updateMatrix(),this.applyMatrix4(sf.matrix),this}center(r=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(ie).negate(),this.translate(ie.x,ie.y,ie.z),r&&r.copy(ie),this}setFromPoints(r){const d=[];for(let _=0,A=r.length;_<A;_++){const E=r[_];d.push(E.x,E.y,E.z||0)}return this.setAttribute("position",new tr(d,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ql);const r=this.attributes.position,d=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new zt(-1/0,-1/0,-1/0),new zt(1/0,1/0,1/0));if(r!==void 0){if(this.boundingBox.setFromBufferAttribute(r),d)for(let _=0,A=d.length;_<A;_++){const E=d[_];T.setFromBufferAttribute(E),this.morphTargetsRelative?(de.addVectors(this.boundingBox.min,T.min),this.boundingBox.expandByPoint(de),de.addVectors(this.boundingBox.max,T.max),this.boundingBox.expandByPoint(de)):(this.boundingBox.expandByPoint(T.min),this.boundingBox.expandByPoint(T.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new la);const r=this.attributes.position,d=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new zt,1/0);if(r){const _=this.boundingSphere.center;if(T.setFromBufferAttribute(r),d)for(let E=0,P=d.length;E<P;E++){const k=d[E];F.setFromBufferAttribute(k),this.morphTargetsRelative?(de.addVectors(T.min,F.min),T.expandByPoint(de),de.addVectors(T.max,F.max),T.expandByPoint(de)):(T.expandByPoint(F.min),T.expandByPoint(F.max))}T.getCenter(_);let A=0;for(let E=0,P=r.count;E<P;E++)de.fromBufferAttribute(r,E),A=Math.max(A,_.distanceToSquared(de));if(d)for(let E=0,P=d.length;E<P;E++){const k=d[E],Q=this.morphTargetsRelative;for(let G=0,re=k.count;G<re;G++)de.fromBufferAttribute(k,G),Q&&(ie.fromBufferAttribute(r,G),de.add(ie)),A=Math.max(A,_.distanceToSquared(de))}this.boundingSphere.radius=Math.sqrt(A),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const r=this.index,d=this.attributes;if(r===null||d.position===void 0||d.normal===void 0||d.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const _=r.array,A=d.position.array,E=d.normal.array,P=d.uv.array,k=A.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ns(new Float32Array(4*k),4));const Q=this.getAttribute("tangent").array,G=[],re=[];for(let D=0;D<k;D++)G[D]=new zt,re[D]=new zt;const xe=new zt,ye=new zt,Ee=new zt,Ie=new li,Ue=new li,Oe=new li,ke=new zt,Ge=new zt;function Je(D,L,Y){xe.fromArray(A,3*D),ye.fromArray(A,3*L),Ee.fromArray(A,3*Y),Ie.fromArray(P,2*D),Ue.fromArray(P,2*L),Oe.fromArray(P,2*Y),ye.sub(xe),Ee.sub(xe),Ue.sub(Ie),Oe.sub(Ie);const ne=1/(Ue.x*Oe.y-Oe.x*Ue.y);isFinite(ne)&&(ke.copy(ye).multiplyScalar(Oe.y).addScaledVector(Ee,-Ue.y).multiplyScalar(ne),Ge.copy(Ee).multiplyScalar(Ue.x).addScaledVector(ye,-Oe.x).multiplyScalar(ne),G[D].add(ke),G[L].add(ke),G[Y].add(ke),re[D].add(Ge),re[L].add(Ge),re[Y].add(Ge))}let Rt=this.groups;Rt.length===0&&(Rt=[{start:0,count:_.length}]);for(let D=0,L=Rt.length;D<L;++D){const Y=Rt[D],ne=Y.start;for(let be=ne,Me=ne+Y.count;be<Me;be+=3)Je(_[be+0],_[be+1],_[be+2])}const Et=new zt,xt=new zt,Zt=new zt,g=new zt;function b(D){Zt.fromArray(E,3*D),g.copy(Zt);const L=G[D];Et.copy(L),Et.sub(Zt.multiplyScalar(Zt.dot(L))).normalize(),xt.crossVectors(g,L);const Y=xt.dot(re[D])<0?-1:1;Q[4*D]=Et.x,Q[4*D+1]=Et.y,Q[4*D+2]=Et.z,Q[4*D+3]=Y}for(let D=0,L=Rt.length;D<L;++D){const Y=Rt[D],ne=Y.start;for(let be=ne,Me=ne+Y.count;be<Me;be+=3)b(_[be+0]),b(_[be+1]),b(_[be+2])}}computeVertexNormals(){const r=this.index,d=this.getAttribute("position");if(d!==void 0){let _=this.getAttribute("normal");if(_===void 0)_=new Ns(new Float32Array(3*d.count),3),this.setAttribute("normal",_);else for(let ye=0,Ee=_.count;ye<Ee;ye++)_.setXYZ(ye,0,0,0);const A=new zt,E=new zt,P=new zt,k=new zt,Q=new zt,G=new zt,re=new zt,xe=new zt;if(r)for(let ye=0,Ee=r.count;ye<Ee;ye+=3){const Ie=r.getX(ye+0),Ue=r.getX(ye+1),Oe=r.getX(ye+2);A.fromBufferAttribute(d,Ie),E.fromBufferAttribute(d,Ue),P.fromBufferAttribute(d,Oe),re.subVectors(P,E),xe.subVectors(A,E),re.cross(xe),k.fromBufferAttribute(_,Ie),Q.fromBufferAttribute(_,Ue),G.fromBufferAttribute(_,Oe),k.add(re),Q.add(re),G.add(re),_.setXYZ(Ie,k.x,k.y,k.z),_.setXYZ(Ue,Q.x,Q.y,Q.z),_.setXYZ(Oe,G.x,G.y,G.z)}else for(let ye=0,Ee=d.count;ye<Ee;ye+=3)A.fromBufferAttribute(d,ye+0),E.fromBufferAttribute(d,ye+1),P.fromBufferAttribute(d,ye+2),re.subVectors(P,E),xe.subVectors(A,E),re.cross(xe),_.setXYZ(ye+0,re.x,re.y,re.z),_.setXYZ(ye+1,re.x,re.y,re.z),_.setXYZ(ye+2,re.x,re.y,re.z);this.normalizeNormals(),_.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const r=this.attributes.normal;for(let d=0,_=r.count;d<_;d++)de.fromBufferAttribute(r,d),de.normalize(),r.setXYZ(d,de.x,de.y,de.z)}toNonIndexed(){function r(k,Q){const G=k.array,re=k.itemSize,xe=k.normalized,ye=new G.constructor(Q.length*re);let Ee=0,Ie=0;for(let Ue=0,Oe=Q.length;Ue<Oe;Ue++){Ee=k.isInterleavedBufferAttribute?Q[Ue]*k.data.stride+k.offset:Q[Ue]*re;for(let ke=0;ke<re;ke++)ye[Ie++]=G[Ee++]}return new Ns(ye,re,xe)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const d=new Fe,_=this.index.array,A=this.attributes;for(const k in A){const Q=r(A[k],_);d.setAttribute(k,Q)}const E=this.morphAttributes;for(const k in E){const Q=[],G=E[k];for(let re=0,xe=G.length;re<xe;re++){const ye=r(G[re],_);Q.push(ye)}d.morphAttributes[k]=Q}d.morphTargetsRelative=this.morphTargetsRelative;const P=this.groups;for(let k=0,Q=P.length;k<Q;k++){const G=P[k];d.addGroup(G.start,G.count,G.materialIndex)}return d}toJSON(){const r={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),Object.keys(this.userData).length>0&&(r.userData=this.userData),this.parameters!==void 0){const Q=this.parameters;for(const G in Q)Q[G]!==void 0&&(r[G]=Q[G]);return r}r.data={attributes:{}};const d=this.index;d!==null&&(r.data.index={type:d.array.constructor.name,array:Array.prototype.slice.call(d.array)});const _=this.attributes;for(const Q in _){const G=_[Q];r.data.attributes[Q]=G.toJSON(r.data)}const A={};let E=!1;for(const Q in this.morphAttributes){const G=this.morphAttributes[Q],re=[];for(let xe=0,ye=G.length;xe<ye;xe++){const Ee=G[xe];re.push(Ee.toJSON(r.data))}re.length>0&&(A[Q]=re,E=!0)}E&&(r.data.morphAttributes=A,r.data.morphTargetsRelative=this.morphTargetsRelative);const P=this.groups;P.length>0&&(r.data.groups=JSON.parse(JSON.stringify(P)));const k=this.boundingSphere;return k!==null&&(r.data.boundingSphere={center:k.center.toArray(),radius:k.radius}),r}clone(){return new this.constructor().copy(this)}copy(r){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const d={};this.name=r.name;const _=r.index;_!==null&&this.setIndex(_.clone(d));const A=r.attributes;for(const G in A){const re=A[G];this.setAttribute(G,re.clone(d))}const E=r.morphAttributes;for(const G in E){const re=[],xe=E[G];for(let ye=0,Ee=xe.length;ye<Ee;ye++)re.push(xe[ye].clone(d));this.morphAttributes[G]=re}this.morphTargetsRelative=r.morphTargetsRelative;const P=r.groups;for(let G=0,re=P.length;G<re;G++){const xe=P[G];this.addGroup(xe.start,xe.count,xe.materialIndex)}const k=r.boundingBox;k!==null&&(this.boundingBox=k.clone());const Q=r.boundingSphere;return Q!==null&&(this.boundingSphere=Q.clone()),this.drawRange.start=r.drawRange.start,this.drawRange.count=r.drawRange.count,this.userData=r.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Mt=new Gr,kt=new Sh,Tn=new la,gi=new zt,zi=new zt,Tr=new zt,eo=new zt,Xa=new zt,Yo=new zt,Dl=new li,jo=new li,xc=new li,tm=new zt,yd=new zt,up=new zt,Ad=new zt,bd=new zt;class Ko extends bs{constructor(r=new Fe,d=new Ia){super(),this.isMesh=!0,this.type="Mesh",this.geometry=r,this.material=d,this.updateMorphTargets()}copy(r,d){return super.copy(r,d),r.isMesh?(r.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=r.morphTargetInfluences.slice()),r.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},r.morphTargetDictionary)),this.material=r.material,this.geometry=r.geometry,this):this}updateMorphTargets(){const r=this.geometry.morphAttributes,d=Object.keys(r);if(d.length>0){const _=r[d[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,E=_.length;A<E;A++){const P=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=A}}}}getVertexPosition(r,d){const _=this.geometry,A=_.attributes.position,E=_.morphAttributes.position,P=_.morphTargetsRelative;d.fromBufferAttribute(A,r);const k=this.morphTargetInfluences;if(E&&k){Yo.set(0,0,0);for(let Q=0,G=E.length;Q<G;Q++){const re=k[Q],xe=E[Q];re!==0&&(Xa.fromBufferAttribute(xe,r),P?Yo.addScaledVector(Xa,re):Yo.addScaledVector(Xa.sub(d),re))}d.add(Yo)}return d}raycast(r,d){const _=this.geometry,A=this.material,E=this.matrixWorld;if(A!==void 0){if(_.boundingSphere===null&&_.computeBoundingSphere(),Tn.copy(_.boundingSphere),Tn.applyMatrix4(E),kt.copy(r.ray).recast(r.near),Tn.containsPoint(kt.origin)===!1&&(kt.intersectSphere(Tn,gi)===null||kt.origin.distanceToSquared(gi)>(r.far-r.near)**2))return;Mt.copy(E).invert(),kt.copy(r.ray).applyMatrix4(Mt),_.boundingBox!==null&&kt.intersectsBox(_.boundingBox)===!1||this._computeIntersections(r,d)}}_computeIntersections(r,d){let _;const A=this.geometry,E=this.material,P=A.index,k=A.attributes.position,Q=A.attributes.uv,G=A.attributes.uv1,re=A.attributes.normal,xe=A.groups,ye=A.drawRange;if(P!==null)if(Array.isArray(E))for(let Ee=0,Ie=xe.length;Ee<Ie;Ee++){const Ue=xe[Ee],Oe=E[Ue.materialIndex];for(let ke=Math.max(Ue.start,ye.start),Ge=Math.min(P.count,Math.min(Ue.start+Ue.count,ye.start+ye.count));ke<Ge;ke+=3){const Je=P.getX(ke),Rt=P.getX(ke+1),Et=P.getX(ke+2);_=Tg(this,Oe,r,kt,Q,G,re,Je,Rt,Et),_&&(_.faceIndex=Math.floor(ke/3),_.face.materialIndex=Ue.materialIndex,d.push(_))}}else for(let Ee=Math.max(0,ye.start),Ie=Math.min(P.count,ye.start+ye.count);Ee<Ie;Ee+=3){const Ue=P.getX(Ee),Oe=P.getX(Ee+1),ke=P.getX(Ee+2);_=Tg(this,E,r,kt,Q,G,re,Ue,Oe,ke),_&&(_.faceIndex=Math.floor(Ee/3),d.push(_))}else if(k!==void 0)if(Array.isArray(E))for(let Ee=0,Ie=xe.length;Ee<Ie;Ee++){const Ue=xe[Ee],Oe=E[Ue.materialIndex];for(let ke=Math.max(Ue.start,ye.start),Ge=Math.min(k.count,Math.min(Ue.start+Ue.count,ye.start+ye.count));ke<Ge;ke+=3)_=Tg(this,Oe,r,kt,Q,G,re,ke,ke+1,ke+2),_&&(_.faceIndex=Math.floor(ke/3),_.face.materialIndex=Ue.materialIndex,d.push(_))}else for(let Ee=Math.max(0,ye.start),Ie=Math.min(k.count,ye.start+ye.count);Ee<Ie;Ee+=3)_=Tg(this,E,r,kt,Q,G,re,Ee,Ee+1,Ee+2),_&&(_.faceIndex=Math.floor(Ee/3),d.push(_))}}function Tg(R,r,d,_,A,E,P,k,Q,G){R.getVertexPosition(k,zi),R.getVertexPosition(Q,Tr),R.getVertexPosition(G,eo);const re=function(xe,ye,Ee,Ie,Ue,Oe,ke,Ge){let Je;if(Je=ye.side===ve?Ie.intersectTriangle(ke,Oe,Ue,!0,Ge):Ie.intersectTriangle(Ue,Oe,ke,ye.side===se,Ge),Je===null)return null;bd.copy(Ge),bd.applyMatrix4(xe.matrixWorld);const Rt=Ee.ray.origin.distanceTo(bd);return Rt<Ee.near||Rt>Ee.far?null:{distance:Rt,point:bd.clone(),object:xe}}(R,r,d,_,zi,Tr,eo,Ad);if(re){A&&(Dl.fromBufferAttribute(A,k),jo.fromBufferAttribute(A,Q),xc.fromBufferAttribute(A,G),re.uv=Cs.getInterpolation(Ad,zi,Tr,eo,Dl,jo,xc,new li)),E&&(Dl.fromBufferAttribute(E,k),jo.fromBufferAttribute(E,Q),xc.fromBufferAttribute(E,G),re.uv1=Cs.getInterpolation(Ad,zi,Tr,eo,Dl,jo,xc,new li),re.uv2=re.uv1),P&&(tm.fromBufferAttribute(P,k),yd.fromBufferAttribute(P,Q),up.fromBufferAttribute(P,G),re.normal=Cs.getInterpolation(Ad,zi,Tr,eo,tm,yd,up,new zt),re.normal.dot(_.direction)>0&&re.normal.multiplyScalar(-1));const xe={a:k,b:Q,c:G,normal:new zt,materialIndex:0};Cs.getNormal(zi,Tr,eo,xe.normal),re.face=xe}return re}class Yu extends Fe{constructor(r=1,d=1,_=1,A=1,E=1,P=1){super(),this.type="BoxGeometry",this.parameters={width:r,height:d,depth:_,widthSegments:A,heightSegments:E,depthSegments:P};const k=this;A=Math.floor(A),E=Math.floor(E),P=Math.floor(P);const Q=[],G=[],re=[],xe=[];let ye=0,Ee=0;function Ie(Ue,Oe,ke,Ge,Je,Rt,Et,xt,Zt,g,b){const D=Rt/Zt,L=Et/g,Y=Rt/2,ne=Et/2,be=xt/2,Me=Zt+1,De=g+1;let je=0,st=0;const nt=new zt;for(let ot=0;ot<De;ot++){const Vt=ot*L-ne;for(let Jt=0;Jt<Me;Jt++){const en=Jt*D-Y;nt[Ue]=en*Ge,nt[Oe]=Vt*Je,nt[ke]=be,G.push(nt.x,nt.y,nt.z),nt[Ue]=0,nt[Oe]=0,nt[ke]=xt>0?1:-1,re.push(nt.x,nt.y,nt.z),xe.push(Jt/Zt),xe.push(1-ot/g),je+=1}}for(let ot=0;ot<g;ot++)for(let Vt=0;Vt<Zt;Vt++){const Jt=ye+Vt+Me*ot,en=ye+Vt+Me*(ot+1),Yt=ye+(Vt+1)+Me*(ot+1),ln=ye+(Vt+1)+Me*ot;Q.push(Jt,en,ln),Q.push(en,Yt,ln),st+=6}k.addGroup(Ee,st,b),Ee+=st,ye+=je}Ie("z","y","x",-1,-1,_,d,r,P,E,0),Ie("z","y","x",1,-1,_,d,-r,P,E,1),Ie("x","z","y",1,1,r,_,d,A,P,2),Ie("x","z","y",1,-1,r,_,-d,A,P,3),Ie("x","y","z",1,-1,r,d,_,A,E,4),Ie("x","y","z",-1,-1,r,d,-_,A,E,5),this.setIndex(Q),this.setAttribute("position",new tr(G,3)),this.setAttribute("normal",new tr(re,3)),this.setAttribute("uv",new tr(xe,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Yu(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments)}}function cl(R){const r={};for(const d in R){r[d]={};for(const _ in R[d]){const A=R[d][_];A&&(A.isColor||A.isMatrix3||A.isMatrix4||A.isVector2||A.isVector3||A.isVector4||A.isTexture||A.isQuaternion)?A.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),r[d][_]=null):r[d][_]=A.clone():Array.isArray(A)?r[d][_]=A.slice():r[d][_]=A}}return r}function Pa(R){const r={};for(let d=0;d<R.length;d++){const _=cl(R[d]);for(const A in _)r[A]=_[A]}return r}function av(R){return R.getRenderTarget()===null?R.outputColorSpace:Is}const T0={clone:cl,merge:Pa};class Su extends da{constructor(r){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,r!==void 0&&this.setValues(r)}copy(r){return super.copy(r),this.fragmentShader=r.fragmentShader,this.vertexShader=r.vertexShader,this.uniforms=cl(r.uniforms),this.uniformsGroups=function(d){const _=[];for(let A=0;A<d.length;A++)_.push(d[A].clone());return _}(r.uniformsGroups),this.defines=Object.assign({},r.defines),this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.fog=r.fog,this.lights=r.lights,this.clipping=r.clipping,this.extensions=Object.assign({},r.extensions),this.glslVersion=r.glslVersion,this}toJSON(r){const d=super.toJSON(r);d.glslVersion=this.glslVersion,d.uniforms={};for(const A in this.uniforms){const E=this.uniforms[A].value;E&&E.isTexture?d.uniforms[A]={type:"t",value:E.toJSON(r).uuid}:E&&E.isColor?d.uniforms[A]={type:"c",value:E.getHex()}:E&&E.isVector2?d.uniforms[A]={type:"v2",value:E.toArray()}:E&&E.isVector3?d.uniforms[A]={type:"v3",value:E.toArray()}:E&&E.isVector4?d.uniforms[A]={type:"v4",value:E.toArray()}:E&&E.isMatrix3?d.uniforms[A]={type:"m3",value:E.toArray()}:E&&E.isMatrix4?d.uniforms[A]={type:"m4",value:E.toArray()}:d.uniforms[A]={value:E}}Object.keys(this.defines).length>0&&(d.defines=this.defines),d.vertexShader=this.vertexShader,d.fragmentShader=this.fragmentShader,d.lights=this.lights,d.clipping=this.clipping;const _={};for(const A in this.extensions)this.extensions[A]===!0&&(_[A]=!0);return Object.keys(_).length>0&&(d.extensions=_),d}}class Cg extends bs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Gr,this.projectionMatrix=new Gr,this.projectionMatrixInverse=new Gr}copy(r,d){return super.copy(r,d),this.matrixWorldInverse.copy(r.matrixWorldInverse),this.projectionMatrix.copy(r.projectionMatrix),this.projectionMatrixInverse.copy(r.projectionMatrixInverse),this}getWorldDirection(r){this.updateWorldMatrix(!0,!1);const d=this.matrixWorld.elements;return r.set(-d[8],-d[9],-d[10]).normalize()}updateMatrixWorld(r){super.updateMatrixWorld(r),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(r,d){super.updateWorldMatrix(r,d),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Eo extends Cg{constructor(r=50,d=1,_=.1,A=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=r,this.zoom=1,this.near=_,this.far=A,this.focus=10,this.aspect=d,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(r,d){return super.copy(r,d),this.fov=r.fov,this.zoom=r.zoom,this.near=r.near,this.far=r.far,this.focus=r.focus,this.aspect=r.aspect,this.view=r.view===null?null:Object.assign({},r.view),this.filmGauge=r.filmGauge,this.filmOffset=r.filmOffset,this}setFocalLength(r){const d=.5*this.getFilmHeight()/r;this.fov=2*uc*Math.atan(d),this.updateProjectionMatrix()}getFocalLength(){const r=Math.tan(.5*ei*this.fov);return .5*this.getFilmHeight()/r}getEffectiveFOV(){return 2*uc*Math.atan(Math.tan(.5*ei*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(r,d,_,A,E,P){this.aspect=r/d,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=d,this.view.offsetX=_,this.view.offsetY=A,this.view.width=E,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=this.near;let d=r*Math.tan(.5*ei*this.fov)/this.zoom,_=2*d,A=this.aspect*_,E=-.5*A;const P=this.view;if(this.view!==null&&this.view.enabled){const Q=P.fullWidth,G=P.fullHeight;E+=P.offsetX*A/Q,d-=P.offsetY*_/G,A*=P.width/Q,_*=P.height/G}const k=this.filmOffset;k!==0&&(E+=r*k/this.getFilmWidth()),this.projectionMatrix.makePerspective(E,E+A,d,d-_,r,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const d=super.toJSON(r);return d.object.fov=this.fov,d.object.zoom=this.zoom,d.object.near=this.near,d.object.far=this.far,d.object.focus=this.focus,d.object.aspect=this.aspect,this.view!==null&&(d.object.view=Object.assign({},this.view)),d.object.filmGauge=this.filmGauge,d.object.filmOffset=this.filmOffset,d}}const Mu=-90;class Rg extends bs{constructor(r,d,_){super(),this.type="CubeCamera",this.renderTarget=_;const A=new Eo(Mu,1,r,d);A.layers=this.layers,A.up.set(0,1,0),A.lookAt(1,0,0),this.add(A);const E=new Eo(Mu,1,r,d);E.layers=this.layers,E.up.set(0,1,0),E.lookAt(-1,0,0),this.add(E);const P=new Eo(Mu,1,r,d);P.layers=this.layers,P.up.set(0,0,-1),P.lookAt(0,1,0),this.add(P);const k=new Eo(Mu,1,r,d);k.layers=this.layers,k.up.set(0,0,1),k.lookAt(0,-1,0),this.add(k);const Q=new Eo(Mu,1,r,d);Q.layers=this.layers,Q.up.set(0,1,0),Q.lookAt(0,0,1),this.add(Q);const G=new Eo(Mu,1,r,d);G.layers=this.layers,G.up.set(0,1,0),G.lookAt(0,0,-1),this.add(G)}update(r,d){this.parent===null&&this.updateMatrixWorld();const _=this.renderTarget,[A,E,P,k,Q,G]=this.children,re=r.getRenderTarget(),xe=r.toneMapping,ye=r.xr.enabled;r.toneMapping=dn,r.xr.enabled=!1;const Ee=_.texture.generateMipmaps;_.texture.generateMipmaps=!1,r.setRenderTarget(_,0),r.render(d,A),r.setRenderTarget(_,1),r.render(d,E),r.setRenderTarget(_,2),r.render(d,P),r.setRenderTarget(_,3),r.render(d,k),r.setRenderTarget(_,4),r.render(d,Q),_.texture.generateMipmaps=Ee,r.setRenderTarget(_,5),r.render(d,G),r.setRenderTarget(re),r.toneMapping=xe,r.xr.enabled=ye,_.texture.needsPMREMUpdate=!0}}class xd extends Us{constructor(r,d,_,A,E,P,k,Q,G,re){super(r=r!==void 0?r:[],d=d!==void 0?d:Hn,_,A,E,P,k,Q,G,re),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(r){this.image=r}}class C0 extends va{constructor(r=1,d={}){super(r,r,d),this.isWebGLCubeRenderTarget=!0;const _={width:r,height:r,depth:1},A=[_,_,_,_,_,_];d.encoding!==void 0&&(dc("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),d.colorSpace=d.encoding===br?xr:Ta),this.texture=new xd(A,d.mapping,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=d.generateMipmaps!==void 0&&d.generateMipmaps,this.texture.minFilter=d.minFilter!==void 0?d.minFilter:Nn}fromEquirectangularTexture(r,d){this.texture.type=d.type,this.texture.colorSpace=d.colorSpace,this.texture.generateMipmaps=d.generateMipmaps,this.texture.minFilter=d.minFilter,this.texture.magFilter=d.magFilter;const _={tEquirect:{value:null}},A=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,E=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,P=new Yu(5,5,5),k=new Su({name:"CubemapFromEquirect",uniforms:cl(_),vertexShader:A,fragmentShader:E,side:ve,blending:X});k.uniforms.tEquirect.value=d;const Q=new Ko(P,k),G=d.minFilter;return d.minFilter===Mr&&(d.minFilter=Nn),new Rg(1,10,this).update(r,Q),d.minFilter=G,Q.geometry.dispose(),Q.material.dispose(),this}clear(r,d,_,A){const E=r.getRenderTarget();for(let P=0;P<6;P++)r.setRenderTarget(this,P),r.clear(d,_,A);r.setRenderTarget(E)}}const Ig=new zt,xb=new zt,Zy=new Ji;class Ku{constructor(r=new zt(1,0,0),d=0){this.isPlane=!0,this.normal=r,this.constant=d}set(r,d){return this.normal.copy(r),this.constant=d,this}setComponents(r,d,_,A){return this.normal.set(r,d,_),this.constant=A,this}setFromNormalAndCoplanarPoint(r,d){return this.normal.copy(r),this.constant=-d.dot(this.normal),this}setFromCoplanarPoints(r,d,_){const A=Ig.subVectors(_,d).cross(xb.subVectors(r,d)).normalize();return this.setFromNormalAndCoplanarPoint(A,r),this}copy(r){return this.normal.copy(r.normal),this.constant=r.constant,this}normalize(){const r=1/this.normal.length();return this.normal.multiplyScalar(r),this.constant*=r,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(r){return this.normal.dot(r)+this.constant}distanceToSphere(r){return this.distanceToPoint(r.center)-r.radius}projectPoint(r,d){return d.copy(r).addScaledVector(this.normal,-this.distanceToPoint(r))}intersectLine(r,d){const _=r.delta(Ig),A=this.normal.dot(_);if(A===0)return this.distanceToPoint(r.start)===0?d.copy(r.start):null;const E=-(r.start.dot(this.normal)+this.constant)/A;return E<0||E>1?null:d.copy(r.start).addScaledVector(_,E)}intersectsLine(r){const d=this.distanceToPoint(r.start),_=this.distanceToPoint(r.end);return d<0&&_>0||_<0&&d>0}intersectsBox(r){return r.intersectsPlane(this)}intersectsSphere(r){return r.intersectsPlane(this)}coplanarPoint(r){return r.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(r,d){const _=d||Zy.getNormalMatrix(r),A=this.coplanarPoint(Ig).applyMatrix4(r),E=this.normal.applyMatrix3(_).normalize();return this.constant=-A.dot(E),this}translate(r){return this.constant-=r.dot(this.normal),this}equals(r){return r.normal.equals(this.normal)&&r.constant===this.constant}clone(){return new this.constructor().copy(this)}}const hp=new la,lv=new zt;class cv{constructor(r=new Ku,d=new Ku,_=new Ku,A=new Ku,E=new Ku,P=new Ku){this.planes=[r,d,_,A,E,P]}set(r,d,_,A,E,P){const k=this.planes;return k[0].copy(r),k[1].copy(d),k[2].copy(_),k[3].copy(A),k[4].copy(E),k[5].copy(P),this}copy(r){const d=this.planes;for(let _=0;_<6;_++)d[_].copy(r.planes[_]);return this}setFromProjectionMatrix(r){const d=this.planes,_=r.elements,A=_[0],E=_[1],P=_[2],k=_[3],Q=_[4],G=_[5],re=_[6],xe=_[7],ye=_[8],Ee=_[9],Ie=_[10],Ue=_[11],Oe=_[12],ke=_[13],Ge=_[14],Je=_[15];return d[0].setComponents(k-A,xe-Q,Ue-ye,Je-Oe).normalize(),d[1].setComponents(k+A,xe+Q,Ue+ye,Je+Oe).normalize(),d[2].setComponents(k+E,xe+G,Ue+Ee,Je+ke).normalize(),d[3].setComponents(k-E,xe-G,Ue-Ee,Je-ke).normalize(),d[4].setComponents(k-P,xe-re,Ue-Ie,Je-Ge).normalize(),d[5].setComponents(k+P,xe+re,Ue+Ie,Je+Ge).normalize(),this}intersectsObject(r){if(r.boundingSphere!==void 0)r.boundingSphere===null&&r.computeBoundingSphere(),hp.copy(r.boundingSphere).applyMatrix4(r.matrixWorld);else{const d=r.geometry;d.boundingSphere===null&&d.computeBoundingSphere(),hp.copy(d.boundingSphere).applyMatrix4(r.matrixWorld)}return this.intersectsSphere(hp)}intersectsSprite(r){return hp.center.set(0,0,0),hp.radius=.7071067811865476,hp.applyMatrix4(r.matrixWorld),this.intersectsSphere(hp)}intersectsSphere(r){const d=this.planes,_=r.center,A=-r.radius;for(let E=0;E<6;E++)if(d[E].distanceToPoint(_)<A)return!1;return!0}intersectsBox(r){const d=this.planes;for(let _=0;_<6;_++){const A=d[_];if(lv.x=A.normal.x>0?r.max.x:r.min.x,lv.y=A.normal.y>0?r.max.y:r.min.y,lv.z=A.normal.z>0?r.max.z:r.min.z,A.distanceToPoint(lv)<0)return!1}return!0}containsPoint(r){const d=this.planes;for(let _=0;_<6;_++)if(d[_].distanceToPoint(r)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function R0(){let R=null,r=!1,d=null,_=null;function A(E,P){d(E,P),_=R.requestAnimationFrame(A)}return{start:function(){r!==!0&&d!==null&&(_=R.requestAnimationFrame(A),r=!0)},stop:function(){R.cancelAnimationFrame(_),r=!1},setAnimationLoop:function(E){d=E},setContext:function(E){R=E}}}function wb(R,r){const d=r.isWebGL2,_=new WeakMap;return{get:function(A){return A.isInterleavedBufferAttribute&&(A=A.data),_.get(A)},remove:function(A){A.isInterleavedBufferAttribute&&(A=A.data);const E=_.get(A);E&&(R.deleteBuffer(E.buffer),_.delete(A))},update:function(A,E){if(A.isGLBufferAttribute){const k=_.get(A);return void((!k||k.version<A.version)&&_.set(A,{buffer:A.buffer,type:A.type,bytesPerElement:A.elementSize,version:A.version}))}A.isInterleavedBufferAttribute&&(A=A.data);const P=_.get(A);P===void 0?_.set(A,function(k,Q){const G=k.array,re=k.usage,xe=R.createBuffer();let ye;if(R.bindBuffer(Q,xe),R.bufferData(Q,G,re),k.onUploadCallback(),G instanceof Float32Array)ye=R.FLOAT;else if(G instanceof Uint16Array)if(k.isFloat16BufferAttribute){if(!d)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");ye=R.HALF_FLOAT}else ye=R.UNSIGNED_SHORT;else if(G instanceof Int16Array)ye=R.SHORT;else if(G instanceof Uint32Array)ye=R.UNSIGNED_INT;else if(G instanceof Int32Array)ye=R.INT;else if(G instanceof Int8Array)ye=R.BYTE;else if(G instanceof Uint8Array)ye=R.UNSIGNED_BYTE;else{if(!(G instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+G);ye=R.UNSIGNED_BYTE}return{buffer:xe,type:ye,bytesPerElement:G.BYTES_PER_ELEMENT,version:k.version}}(A,E)):P.version<A.version&&(function(k,Q,G){const re=Q.array,xe=Q.updateRange;R.bindBuffer(G,k),xe.count===-1?R.bufferSubData(G,0,re):(d?R.bufferSubData(G,xe.offset*re.BYTES_PER_ELEMENT,re,xe.offset,xe.count):R.bufferSubData(G,xe.offset*re.BYTES_PER_ELEMENT,re.subarray(xe.offset,xe.offset+xe.count)),xe.count=-1),Q.onUploadCallback()}(P.buffer,A,E),P.version=A.version)}}}class Da extends Fe{constructor(r=1,d=1,_=1,A=1){super(),this.type="PlaneGeometry",this.parameters={width:r,height:d,widthSegments:_,heightSegments:A};const E=r/2,P=d/2,k=Math.floor(_),Q=Math.floor(A),G=k+1,re=Q+1,xe=r/k,ye=d/Q,Ee=[],Ie=[],Ue=[],Oe=[];for(let ke=0;ke<re;ke++){const Ge=ke*ye-P;for(let Je=0;Je<G;Je++){const Rt=Je*xe-E;Ie.push(Rt,-Ge,0),Ue.push(0,0,1),Oe.push(Je/k),Oe.push(1-ke/Q)}}for(let ke=0;ke<Q;ke++)for(let Ge=0;Ge<k;Ge++){const Je=Ge+G*ke,Rt=Ge+G*(ke+1),Et=Ge+1+G*(ke+1),xt=Ge+1+G*ke;Ee.push(Je,Rt,xt),Ee.push(Rt,Et,xt)}this.setIndex(Ee),this.setAttribute("position",new tr(Ie,3)),this.setAttribute("normal",new tr(Ue,3)),this.setAttribute("uv",new tr(Oe,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Da(r.width,r.height,r.widthSegments,r.heightSegments)}}const os={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Vi={common:{diffuse:{value:new Fi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ji},alphaMap:{value:null},alphaMapTransform:{value:new Ji},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ji}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ji}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ji}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ji},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ji},normalScale:{value:new li(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ji},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ji}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ji}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ji}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Fi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ji}},sprite:{diffuse:{value:new Fi(16777215)},opacity:{value:1},center:{value:new li(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ji},alphaMap:{value:null},alphaTest:{value:0}}},Ol={basic:{uniforms:Pa([Vi.common,Vi.specularmap,Vi.envmap,Vi.aomap,Vi.lightmap,Vi.fog]),vertexShader:os.meshbasic_vert,fragmentShader:os.meshbasic_frag},lambert:{uniforms:Pa([Vi.common,Vi.specularmap,Vi.envmap,Vi.aomap,Vi.lightmap,Vi.emissivemap,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,Vi.fog,Vi.lights,{emissive:{value:new Fi(0)}}]),vertexShader:os.meshlambert_vert,fragmentShader:os.meshlambert_frag},phong:{uniforms:Pa([Vi.common,Vi.specularmap,Vi.envmap,Vi.aomap,Vi.lightmap,Vi.emissivemap,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,Vi.fog,Vi.lights,{emissive:{value:new Fi(0)},specular:{value:new Fi(1118481)},shininess:{value:30}}]),vertexShader:os.meshphong_vert,fragmentShader:os.meshphong_frag},standard:{uniforms:Pa([Vi.common,Vi.envmap,Vi.aomap,Vi.lightmap,Vi.emissivemap,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,Vi.roughnessmap,Vi.metalnessmap,Vi.fog,Vi.lights,{emissive:{value:new Fi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag},toon:{uniforms:Pa([Vi.common,Vi.aomap,Vi.lightmap,Vi.emissivemap,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,Vi.gradientmap,Vi.fog,Vi.lights,{emissive:{value:new Fi(0)}}]),vertexShader:os.meshtoon_vert,fragmentShader:os.meshtoon_frag},matcap:{uniforms:Pa([Vi.common,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,Vi.fog,{matcap:{value:null}}]),vertexShader:os.meshmatcap_vert,fragmentShader:os.meshmatcap_frag},points:{uniforms:Pa([Vi.points,Vi.fog]),vertexShader:os.points_vert,fragmentShader:os.points_frag},dashed:{uniforms:Pa([Vi.common,Vi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:os.linedashed_vert,fragmentShader:os.linedashed_frag},depth:{uniforms:Pa([Vi.common,Vi.displacementmap]),vertexShader:os.depth_vert,fragmentShader:os.depth_frag},normal:{uniforms:Pa([Vi.common,Vi.bumpmap,Vi.normalmap,Vi.displacementmap,{opacity:{value:1}}]),vertexShader:os.meshnormal_vert,fragmentShader:os.meshnormal_frag},sprite:{uniforms:Pa([Vi.sprite,Vi.fog]),vertexShader:os.sprite_vert,fragmentShader:os.sprite_frag},background:{uniforms:{uvTransform:{value:new Ji},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new Fi(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:os.background_vert,fragmentShader:os.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:os.backgroundCube_vert,fragmentShader:os.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:os.cube_vert,fragmentShader:os.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:os.equirect_vert,fragmentShader:os.equirect_frag},distanceRGBA:{uniforms:Pa([Vi.common,Vi.displacementmap,{referencePosition:{value:new zt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:os.distanceRGBA_vert,fragmentShader:os.distanceRGBA_frag},shadow:{uniforms:Pa([Vi.lights,Vi.fog,{color:{value:new Fi(0)},opacity:{value:1}}]),vertexShader:os.shadow_vert,fragmentShader:os.shadow_frag}};Ol.physical={uniforms:Pa([Ol.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ji},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ji},clearcoatNormalScale:{value:new li(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ji},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ji},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ji},sheen:{value:0},sheenColor:{value:new Fi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ji},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ji},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ji},transmissionSamplerSize:{value:new li},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ji},attenuationDistance:{value:0},attenuationColor:{value:new Fi(0)},specularColor:{value:new Fi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ji},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ji}}]),vertexShader:os.meshphysical_vert,fragmentShader:os.meshphysical_frag};const dp={r:0,b:0,g:0};function wd(R,r,d,_,A,E,P){const k=new Fi(0);let Q,G,re=E===!0?0:1,xe=null,ye=0,Ee=null;function Ie(Ue,Oe){Ue.getRGB(dp,av(R)),_.buffers.color.setClear(dp.r,dp.g,dp.b,Oe,P)}return{getClearColor:function(){return k},setClearColor:function(Ue,Oe=1){k.set(Ue),re=Oe,Ie(k,re)},getClearAlpha:function(){return re},setClearAlpha:function(Ue){re=Ue,Ie(k,re)},getPlaneMesh:function(){return Q},getBoxMesh:function(){return G},getBoxMesh2:function(){return G===void 0&&(G=new Ko(new Yu(1,1,1),new Su({name:"BackgroundCubeMaterial",uniforms:cl(Ol.backgroundCube.uniforms),vertexShader:Ol.backgroundCube.vertexShader,fragmentShader:Ol.backgroundCube.fragmentShader,side:ve,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function(Ue,Oe,ke){this.matrixWorld.copyPosition(ke.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),A.update(G)),G},render:function(Ue,Oe){let ke=!1,Ge=Oe.isScene===!0?Oe.background:null;const Je=Oe.isScene&&Oe.backgroundColor!==void 0?Oe.backgroundColor:null;switch(Ge==="environment"&&(Ge=Oe.environment),Ge&&Ge.isTexture&&(Ge=(Oe.backgroundBlurriness>0?d:r).get(Ge)),Ge===null?Ie(k,re):Ge&&Ge.isColor&&(Ie(Ge,1),ke=!0),R.xr.getEnvironmentBlendMode()){case"opaque":ke=!0;break;case"additive":_.buffers.color.setClear(0,0,0,1,P),ke=!0;break;case"alpha-blend":_.buffers.color.setClear(0,0,0,0,P),ke=!0}if((R.autoClear||ke)&&R.clear(R.autoClearColor,R.autoClearDepth,R.autoClearStencil),Ge&&(Ge.isCubeTexture||Ge.mapping===We))G===void 0&&(G=new Ko(new Yu(1,1,1),new Su({name:"BackgroundCubeMaterial",uniforms:cl(Ol.backgroundCube.uniforms),vertexShader:Ol.backgroundCube.vertexShader,fragmentShader:Ol.backgroundCube.fragmentShader,side:ve,depthTest:!1,depthWrite:!1,fog:!1})),G.geometry.deleteAttribute("normal"),G.geometry.deleteAttribute("uv"),G.onBeforeRender=function(Rt,Et,xt){this.matrixWorld.copyPosition(xt.matrixWorld)},Object.defineProperty(G.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),A.update(G)),G.material.uniforms.envMap.value=Ge,G.material.uniforms.envMapRotation.value=Ge&&Ge.rotation||0,G.material.uniforms.envMapIntensity.value=Ge===Oe.environment&&Oe.envMapIntensity||1,G.material.uniforms.flipEnvMap.value=Ge.isCubeTexture&&Ge.isRenderTargetTexture===!1?-1:1,G.material.uniforms.backgroundBlurriness.value=Oe.backgroundBlurriness,G.material.uniforms.backgroundIntensity.value=Oe.backgroundIntensity,G.material.toneMapped=Ge.colorSpace!==xr,xe===Ge&&ye===Ge.version&&Ee===R.toneMapping||(G.material.needsUpdate=!0,xe=Ge,ye=Ge.version,Ee=R.toneMapping),G.layers.enableAll(),Ue.unshift(G,G.geometry,G.material,0,0,null);else if(Ge&&Ge.isTexture||!Ge&&Je){Q===void 0&&(Q=new Ko(new Da(2,2),new Su({name:"BackgroundMaterial",uniforms:cl(Ol.background.uniforms),vertexShader:Ol.background.vertexShader,fragmentShader:Ol.background.fragmentShader,side:se,depthTest:!1,depthWrite:!1,fog:!1})),Q.geometry.deleteAttribute("normal"),Object.defineProperty(Q.material,"map",{get:function(){return this.uniforms.t2D.value}}),A.update(Q)),Q.material.uniforms.backgroundColor.value.set(Je||16777215),Q.material.uniforms.t2D.value=Ge,Q.material.uniforms.backgroundIntensity.value=Oe.backgroundIntensity,Ge?(Q.material.toneMapped=Ge.colorSpace!==xr,Q.material.uniforms.flipX.value=Ge.userData.flipX||!1,Q.material.uniforms.flipY.value=Ge.userData.flipY||!1,Ge.matrixAutoUpdate===!0&&Ge.updateMatrix(),Q.material.uniforms.uvTransform.value.copy(Ge.matrix),Q.material.defines.HAS_TEXTURE="1"):Q.material.defines.HAS_TEXTURE&&delete Q.material.defines.HAS_TEXTURE;const Rt=Ge?Ge.version:-1;xe===Ge&&ye===Rt&&Ee===R.toneMapping||(Q.material.needsUpdate=!0,xe=Ge,ye=Rt,Ee=R.toneMapping),Q.layers.enableAll(),Ue.unshift(Q,Q.geometry,Q.material,0,0,null)}}}}function fi(R,r,d,_){const A=R.getParameter(R.MAX_VERTEX_ATTRIBS),E=_.isWebGL2?null:r.get("OES_vertex_array_object"),P=_.isWebGL2||E!==null,k={},Q=Ee(null);let G=Q,re=!1;function xe(Et){return _.isWebGL2?R.bindVertexArray(Et):E.bindVertexArrayOES(Et)}function ye(Et){return _.isWebGL2?R.deleteVertexArray(Et):E.deleteVertexArrayOES(Et)}function Ee(Et){const xt=[],Zt=[],g=[];for(let b=0;b<A;b++)xt[b]=0,Zt[b]=0,g[b]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:xt,enabledAttributes:Zt,attributeDivisors:g,object:Et,attributes:{},index:null}}function Ie(){const Et=G.newAttributes;for(let xt=0,Zt=Et.length;xt<Zt;xt++)Et[xt]=0}function Ue(Et){Oe(Et,0)}function Oe(Et,xt){const Zt=G.newAttributes,g=G.enabledAttributes,b=G.attributeDivisors;Zt[Et]=1,g[Et]===0&&(R.enableVertexAttribArray(Et),g[Et]=1),b[Et]!==xt&&((_.isWebGL2?R:r.get("ANGLE_instanced_arrays"))[_.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Et,xt),b[Et]=xt)}function ke(){const Et=G.newAttributes,xt=G.enabledAttributes;for(let Zt=0,g=xt.length;Zt<g;Zt++)xt[Zt]!==Et[Zt]&&(R.disableVertexAttribArray(Zt),xt[Zt]=0)}function Ge(Et,xt,Zt,g,b,D){_.isWebGL2!==!0||Zt!==R.INT&&Zt!==R.UNSIGNED_INT?R.vertexAttribPointer(Et,xt,Zt,g,b,D):R.vertexAttribIPointer(Et,xt,Zt,b,D)}function Je(){Rt(),re=!0,G!==Q&&(G=Q,xe(G.object))}function Rt(){Q.geometry=null,Q.program=null,Q.wireframe=!1}return{setup:function(Et,xt,Zt,g,b){let D=!1;if(P){const L=function(Y,ne,be){const Me=be.wireframe===!0;let De=k[Y.id];De===void 0&&(De={},k[Y.id]=De);let je=De[ne.id];je===void 0&&(je={},De[ne.id]=je);let st=je[Me];return st===void 0&&(st=Ee(_.isWebGL2?R.createVertexArray():E.createVertexArrayOES()),je[Me]=st),st}(g,Zt,xt);G!==L&&(G=L,xe(G.object)),D=function(Y,ne,be,Me){const De=G.attributes,je=ne.attributes;let st=0;const nt=be.getAttributes();for(const ot in nt)if(nt[ot].location>=0){const Vt=De[ot];let Jt=je[ot];if(Jt===void 0&&(ot==="instanceMatrix"&&Y.instanceMatrix&&(Jt=Y.instanceMatrix),ot==="instanceColor"&&Y.instanceColor&&(Jt=Y.instanceColor)),Vt===void 0||Vt.attribute!==Jt||Jt&&Vt.data!==Jt.data)return!0;st++}return G.attributesNum!==st||G.index!==Me}(Et,g,Zt,b),D&&function(Y,ne,be,Me){const De={},je=ne.attributes;let st=0;const nt=be.getAttributes();for(const ot in nt)if(nt[ot].location>=0){let Vt=je[ot];Vt===void 0&&(ot==="instanceMatrix"&&Y.instanceMatrix&&(Vt=Y.instanceMatrix),ot==="instanceColor"&&Y.instanceColor&&(Vt=Y.instanceColor));const Jt={};Jt.attribute=Vt,Vt&&Vt.data&&(Jt.data=Vt.data),De[ot]=Jt,st++}G.attributes=De,G.attributesNum=st,G.index=Me}(Et,g,Zt,b)}else{const L=xt.wireframe===!0;G.geometry===g.id&&G.program===Zt.id&&G.wireframe===L||(G.geometry=g.id,G.program=Zt.id,G.wireframe=L,D=!0)}b!==null&&d.update(b,R.ELEMENT_ARRAY_BUFFER),(D||re)&&(re=!1,function(L,Y,ne,be){if(_.isWebGL2===!1&&(L.isInstancedMesh||be.isInstancedBufferGeometry)&&r.get("ANGLE_instanced_arrays")===null)return;Ie();const Me=be.attributes,De=ne.getAttributes(),je=Y.defaultAttributeValues;for(const st in De){const nt=De[st];if(nt.location>=0){let ot=Me[st];if(ot===void 0&&(st==="instanceMatrix"&&L.instanceMatrix&&(ot=L.instanceMatrix),st==="instanceColor"&&L.instanceColor&&(ot=L.instanceColor)),ot!==void 0){const Vt=ot.normalized,Jt=ot.itemSize,en=d.get(ot);if(en===void 0)continue;const Yt=en.buffer,ln=en.type,et=en.bytesPerElement;if(ot.isInterleavedBufferAttribute){const $e=ot.data,Gt=$e.stride,Ut=ot.offset;if($e.isInstancedInterleavedBuffer){for(let yt=0;yt<nt.locationSize;yt++)Oe(nt.location+yt,$e.meshPerAttribute);L.isInstancedMesh!==!0&&be._maxInstanceCount===void 0&&(be._maxInstanceCount=$e.meshPerAttribute*$e.count)}else for(let yt=0;yt<nt.locationSize;yt++)Ue(nt.location+yt);R.bindBuffer(R.ARRAY_BUFFER,Yt);for(let yt=0;yt<nt.locationSize;yt++)Ge(nt.location+yt,Jt/nt.locationSize,ln,Vt,Gt*et,(Ut+Jt/nt.locationSize*yt)*et)}else{if(ot.isInstancedBufferAttribute){for(let $e=0;$e<nt.locationSize;$e++)Oe(nt.location+$e,ot.meshPerAttribute);L.isInstancedMesh!==!0&&be._maxInstanceCount===void 0&&(be._maxInstanceCount=ot.meshPerAttribute*ot.count)}else for(let $e=0;$e<nt.locationSize;$e++)Ue(nt.location+$e);R.bindBuffer(R.ARRAY_BUFFER,Yt);for(let $e=0;$e<nt.locationSize;$e++)Ge(nt.location+$e,Jt/nt.locationSize,ln,Vt,Jt*et,Jt/nt.locationSize*$e*et)}}else if(je!==void 0){const Vt=je[st];if(Vt!==void 0)switch(Vt.length){case 2:R.vertexAttrib2fv(nt.location,Vt);break;case 3:R.vertexAttrib3fv(nt.location,Vt);break;case 4:R.vertexAttrib4fv(nt.location,Vt);break;default:R.vertexAttrib1fv(nt.location,Vt)}}}}ke()}(Et,xt,Zt,g),b!==null&&R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,d.get(b).buffer))},reset:Je,resetDefaultState:Rt,dispose:function(){Je();for(const Et in k){const xt=k[Et];for(const Zt in xt){const g=xt[Zt];for(const b in g)ye(g[b].object),delete g[b];delete xt[Zt]}delete k[Et]}},releaseStatesOfGeometry:function(Et){if(k[Et.id]===void 0)return;const xt=k[Et.id];for(const Zt in xt){const g=xt[Zt];for(const b in g)ye(g[b].object),delete g[b];delete xt[Zt]}delete k[Et.id]},releaseStatesOfProgram:function(Et){for(const xt in k){const Zt=k[xt];if(Zt[Et.id]===void 0)continue;const g=Zt[Et.id];for(const b in g)ye(g[b].object),delete g[b];delete Zt[Et.id]}},initAttributes:Ie,enableAttribute:Ue,disableUnusedAttributes:ke}}function Pg(R,r,d,_){const A=_.isWebGL2;let E;this.setMode=function(P){E=P},this.render=function(P,k){R.drawArrays(E,P,k),d.update(k,E,1)},this.renderInstances=function(P,k,Q){if(Q===0)return;let G,re;if(A)G=R,re="drawArraysInstanced";else if(G=r.get("ANGLE_instanced_arrays"),re="drawArraysInstancedANGLE",G===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G[re](E,P,k,Q),d.update(k,E,Q)}}function of(R,r,d){let _;function A(Rt){if(Rt==="highp"){if(R.getShaderPrecisionFormat(R.VERTEX_SHADER,R.HIGH_FLOAT).precision>0&&R.getShaderPrecisionFormat(R.FRAGMENT_SHADER,R.HIGH_FLOAT).precision>0)return"highp";Rt="mediump"}return Rt==="mediump"&&R.getShaderPrecisionFormat(R.VERTEX_SHADER,R.MEDIUM_FLOAT).precision>0&&R.getShaderPrecisionFormat(R.FRAGMENT_SHADER,R.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const E=typeof WebGL2RenderingContext<"u"&&R.constructor.name==="WebGL2RenderingContext";let P=d.precision!==void 0?d.precision:"highp";const k=A(P);k!==P&&(console.warn("THREE.WebGLRenderer:",P,"not supported, using",k,"instead."),P=k);const Q=E||r.has("WEBGL_draw_buffers"),G=d.logarithmicDepthBuffer===!0,re=R.getParameter(R.MAX_TEXTURE_IMAGE_UNITS),xe=R.getParameter(R.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ye=R.getParameter(R.MAX_TEXTURE_SIZE),Ee=R.getParameter(R.MAX_CUBE_MAP_TEXTURE_SIZE),Ie=R.getParameter(R.MAX_VERTEX_ATTRIBS),Ue=R.getParameter(R.MAX_VERTEX_UNIFORM_VECTORS),Oe=R.getParameter(R.MAX_VARYING_VECTORS),ke=R.getParameter(R.MAX_FRAGMENT_UNIFORM_VECTORS),Ge=xe>0,Je=E||r.has("OES_texture_float");return{isWebGL2:E,drawBuffers:Q,getMaxAnisotropy:function(){if(_!==void 0)return _;if(r.has("EXT_texture_filter_anisotropic")===!0){const Rt=r.get("EXT_texture_filter_anisotropic");_=R.getParameter(Rt.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else _=0;return _},getMaxPrecision:A,precision:P,logarithmicDepthBuffer:G,maxTextures:re,maxVertexTextures:xe,maxTextureSize:ye,maxCubemapSize:Ee,maxAttributes:Ie,maxVertexUniforms:Ue,maxVaryings:Oe,maxFragmentUniforms:ke,vertexTextures:Ge,floatFragmentTextures:Je,floatVertexTextures:Ge&&Je,maxSamples:E?R.getParameter(R.MAX_SAMPLES):0}}function Ed(R){const r=this;let d=null,_=0,A=!1,E=!1;const P=new Ku,k=new Ji,Q={value:null,needsUpdate:!1};function G(re,xe,ye,Ee){const Ie=re!==null?re.length:0;let Ue=null;if(Ie!==0){if(Ue=Q.value,Ee!==!0||Ue===null){const Oe=ye+4*Ie,ke=xe.matrixWorldInverse;k.getNormalMatrix(ke),(Ue===null||Ue.length<Oe)&&(Ue=new Float32Array(Oe));for(let Ge=0,Je=ye;Ge!==Ie;++Ge,Je+=4)P.copy(re[Ge]).applyMatrix4(ke,k),P.normal.toArray(Ue,Je),Ue[Je+3]=P.constant}Q.value=Ue,Q.needsUpdate=!0}return r.numPlanes=Ie,r.numIntersection=0,Ue}this.uniform=Q,this.numPlanes=0,this.numIntersection=0,this.init=function(re,xe){const ye=re.length!==0||xe||_!==0||A;return A=xe,_=re.length,ye},this.beginShadows=function(){E=!0,G(null)},this.endShadows=function(){E=!1},this.setGlobalState=function(re,xe){d=G(re,xe,0)},this.setState=function(re,xe,ye){const Ee=re.clippingPlanes,Ie=re.clipIntersection,Ue=re.clipShadows,Oe=R.get(re);if(!A||Ee===null||Ee.length===0||E&&!Ue)E?G(null):(Q.value!==d&&(Q.value=d,Q.needsUpdate=_>0),r.numPlanes=_,r.numIntersection=0);else{const ke=E?0:_,Ge=4*ke;let Je=Oe.clippingState||null;Q.value=Je,Je=G(Ee,xe,Ge,ye);for(let Rt=0;Rt!==Ge;++Rt)Je[Rt]=d[Rt];Oe.clippingState=Je,this.numIntersection=Ie?this.numPlanes:0,this.numPlanes+=ke}}}function Kc(R){let r=new WeakMap;function d(A,E){return E===Se?A.mapping=Hn:E===Ve&&(A.mapping=fe),A}function _(A){const E=A.target;E.removeEventListener("dispose",_);const P=r.get(E);P!==void 0&&(r.delete(E),P.dispose())}return{get:function(A){if(A&&A.isTexture&&A.isRenderTargetTexture===!1){const E=A.mapping;if(E===Se||E===Ve){if(r.has(A)){const P=r.get(A).texture;return P.rotation=A.rotation,d(P,A.mapping)}{const P=A.image;if(P&&P.height>0){const k=new C0(P.height/2);return k.fromEquirectangularTexture(R,A),k.texture.rotation=A.rotation,r.set(A,k),A.addEventListener("dispose",_),d(k.texture,A.mapping)}return null}}}return A},dispose:function(){r=new WeakMap}}}class So extends Cg{constructor(r=-1,d=1,_=1,A=-1,E=.1,P=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=r,this.right=d,this.top=_,this.bottom=A,this.near=E,this.far=P,this.updateProjectionMatrix()}copy(r,d){return super.copy(r,d),this.left=r.left,this.right=r.right,this.top=r.top,this.bottom=r.bottom,this.near=r.near,this.far=r.far,this.zoom=r.zoom,this.view=r.view===null?null:Object.assign({},r.view),this}setViewOffset(r,d,_,A,E,P){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=d,this.view.offsetX=_,this.view.offsetY=A,this.view.width=E,this.view.height=P,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const r=(this.right-this.left)/(2*this.zoom),d=(this.top-this.bottom)/(2*this.zoom),_=(this.right+this.left)/2,A=(this.top+this.bottom)/2;let E=_-r,P=_+r,k=A+d,Q=A-d;if(this.view!==null&&this.view.enabled){const G=(this.right-this.left)/this.view.fullWidth/this.zoom,re=(this.top-this.bottom)/this.view.fullHeight/this.zoom;E+=G*this.view.offsetX,P=E+G*this.view.width,k-=re*this.view.offsetY,Q=k-re*this.view.height}this.projectionMatrix.makeOrthographic(E,P,k,Q,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(r){const d=super.toJSON(r);return d.object.zoom=this.zoom,d.object.left=this.left,d.object.right=this.right,d.object.top=this.top,d.object.bottom=this.bottom,d.object.near=this.near,d.object.far=this.far,this.view!==null&&(d.object.view=Object.assign({},this.view)),d}}const $c=[.125,.215,.35,.446,.526,.582],nm=20,Oa=new So,Jc=new Fi;let Dg=null;const Bl=(1+Math.sqrt(5))/2,Yl=1/Bl,af=[new zt(1,1,1),new zt(-1,1,1),new zt(1,1,-1),new zt(-1,1,-1),new zt(0,Bl,Yl),new zt(0,Bl,-Yl),new zt(Yl,0,Bl),new zt(-Yl,0,Bl),new zt(Bl,Yl,0),new zt(-Bl,Yl,0)];class $u{constructor(r){this._renderer=r,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(r,d=0,_=.1,A=100){Dg=this._renderer.getRenderTarget(),this._setSize(256);const E=this._allocateTargets();return E.depthBuffer=!0,this._sceneToCubeUV(r,_,A,E),d>0&&this._blur(E,0,0,d),this._applyPMREM(E),this._cleanup(E),E}fromEquirectangular(r,d=null){return this._fromTexture(r,d)}fromCubemap(r,d=null){return this._fromTexture(r,d)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=pp(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Zc(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(r){this._lodMax=Math.floor(Math.log2(r)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let r=0;r<this._lodPlanes.length;r++)this._lodPlanes[r].dispose()}_cleanup(r){this._renderer.setRenderTarget(Dg),r.scissorTest=!1,Dh(r,0,0,r.width,r.height)}_fromTexture(r,d){r.mapping===Hn||r.mapping===fe?this._setSize(r.image.length===0?16:r.image[0].width||r.image[0].image.width):this._setSize(r.image.width/4),Dg=this._renderer.getRenderTarget();const _=d||this._allocateTargets();return this._textureToCubeUV(r,_),this._applyPMREM(_),this._cleanup(_),_}_allocateTargets(){const r=3*Math.max(this._cubeSize,112),d=4*this._cubeSize,_={magFilter:Nn,minFilter:Nn,generateMipmaps:!1,type:Xr,format:uo,colorSpace:Is,depthBuffer:!1},A=Sd(r,d,_);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==r||this._pingPongRenderTarget.height!==d){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Sd(r,d,_);const{_lodMax:E}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(P){const k=[],Q=[],G=[];let re=P;const xe=P-4+1+$c.length;for(let ye=0;ye<xe;ye++){const Ee=Math.pow(2,re);Q.push(Ee);let Ie=1/Ee;ye>P-4?Ie=$c[ye-P+4-1]:ye===0&&(Ie=0),G.push(Ie);const Ue=1/(Ee-2),Oe=-Ue,ke=1+Ue,Ge=[Oe,Oe,ke,Oe,ke,ke,Oe,Oe,ke,ke,Oe,ke],Je=6,Rt=6,Et=3,xt=2,Zt=1,g=new Float32Array(Et*Rt*Je),b=new Float32Array(xt*Rt*Je),D=new Float32Array(Zt*Rt*Je);for(let Y=0;Y<Je;Y++){const ne=Y%3*2/3-1,be=Y>2?0:-1,Me=[ne,be,0,ne+2/3,be,0,ne+2/3,be+1,0,ne,be,0,ne+2/3,be+1,0,ne,be+1,0];g.set(Me,Et*Rt*Y),b.set(Ge,xt*Rt*Y);const De=[Y,Y,Y,Y,Y,Y];D.set(De,Zt*Rt*Y)}const L=new Fe;L.setAttribute("position",new Ns(g,Et)),L.setAttribute("uv",new Ns(b,xt)),L.setAttribute("faceIndex",new Ns(D,Zt)),k.push(L),re>4&&re--}return{lodPlanes:k,sizeLods:Q,sigmas:G}}(E)),this._blurMaterial=function(P,k,Q){const G=new Float32Array(nm),re=new zt(0,1,0);return new Su({name:"SphericalGaussianBlur",defines:{n:nm,CUBEUV_TEXEL_WIDTH:1/k,CUBEUV_TEXEL_HEIGHT:1/Q,CUBEUV_MAX_MIP:`${P}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:G},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:re}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:X,depthTest:!1,depthWrite:!1})}(E,r,d)}return A}_compileMaterial(r){const d=new Ko(this._lodPlanes[0],r);this._renderer.compile(d,Oa)}_sceneToCubeUV(r,d,_,A){const E=new Eo(90,1,d,_),P=[1,-1,1,1,1,1],k=[1,1,1,-1,-1,-1],Q=this._renderer,G=Q.autoClear,re=Q.toneMapping;Q.getClearColor(Jc),Q.toneMapping=dn,Q.autoClear=!1;const xe=new Ia({name:"PMREM.Background",side:ve,depthWrite:!1,depthTest:!1}),ye=new Ko(new Yu,xe);let Ee=!1;const Ie=r.background;Ie?Ie.isColor&&(xe.color.copy(Ie),r.background=null,Ee=!0):(xe.color.copy(Jc),Ee=!0);for(let Ue=0;Ue<6;Ue++){const Oe=Ue%3;Oe===0?(E.up.set(0,P[Ue],0),E.lookAt(k[Ue],0,0)):Oe===1?(E.up.set(0,0,P[Ue]),E.lookAt(0,k[Ue],0)):(E.up.set(0,P[Ue],0),E.lookAt(0,0,k[Ue]));const ke=this._cubeSize;Dh(A,Oe*ke,Ue>2?ke:0,ke,ke),Q.setRenderTarget(A),Ee&&Q.render(ye,E),Q.render(r,E)}ye.geometry.dispose(),ye.material.dispose(),Q.toneMapping=re,Q.autoClear=G,r.background=Ie}_textureToCubeUV(r,d){const _=this._renderer,A=r.mapping===Hn||r.mapping===fe;A?(this._cubemapMaterial===null&&(this._cubemapMaterial=pp()),this._cubemapMaterial.uniforms.flipEnvMap.value=r.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Zc());const E=A?this._cubemapMaterial:this._equirectMaterial,P=new Ko(this._lodPlanes[0],E);E.uniforms.envMap.value=r;const k=this._cubeSize;Dh(d,0,0,3*k,2*k),_.setRenderTarget(d),_.render(P,Oa)}_applyPMREM(r){const d=this._renderer,_=d.autoClear;d.autoClear=!1;for(let A=1;A<this._lodPlanes.length;A++){const E=Math.sqrt(this._sigmas[A]*this._sigmas[A]-this._sigmas[A-1]*this._sigmas[A-1]),P=af[(A-1)%af.length];this._blur(r,A-1,A,E,P)}d.autoClear=_}_blur(r,d,_,A,E){const P=this._pingPongRenderTarget;this._halfBlur(r,P,d,_,A,"latitudinal",E),this._halfBlur(P,r,_,_,A,"longitudinal",E)}_halfBlur(r,d,_,A,E,P,k){const Q=this._renderer,G=this._blurMaterial;P!=="latitudinal"&&P!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const re=new Ko(this._lodPlanes[A],G),xe=G.uniforms,ye=this._sizeLods[_]-1,Ee=isFinite(E)?Math.PI/(2*ye):2*Math.PI/39,Ie=E/Ee,Ue=isFinite(E)?1+Math.floor(3*Ie):nm;Ue>nm&&console.warn(`sigmaRadians, ${E}, is too large and will clip, as it requested ${Ue} samples when the maximum is set to 20`);const Oe=[];let ke=0;for(let Rt=0;Rt<nm;++Rt){const Et=Rt/Ie,xt=Math.exp(-Et*Et/2);Oe.push(xt),Rt===0?ke+=xt:Rt<Ue&&(ke+=2*xt)}for(let Rt=0;Rt<Oe.length;Rt++)Oe[Rt]=Oe[Rt]/ke;xe.envMap.value=r.texture,xe.samples.value=Ue,xe.weights.value=Oe,xe.latitudinal.value=P==="latitudinal",k&&(xe.poleAxis.value=k);const{_lodMax:Ge}=this;xe.dTheta.value=Ee,xe.mipInt.value=Ge-_;const Je=this._sizeLods[A];Dh(d,3*Je*(A>Ge-4?A-Ge+4:0),4*(this._cubeSize-Je),3*Je,2*Je),Q.setRenderTarget(d),Q.render(re,Oa)}}function Sd(R,r,d){const _=new va(R,r,d);return _.texture.mapping=We,_.texture.name="PMREM.cubeUv",_.scissorTest=!0,_}function Dh(R,r,d,_,A){R.viewport.set(r,d,_,A),R.scissor.set(r,d,_,A)}function Zc(){return new Su({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:X,depthTest:!1,depthWrite:!1})}function pp(){return new Su({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:X,depthTest:!1,depthWrite:!1})}function uv(R){let r=new WeakMap,d=null;function _(A){const E=A.target;E.removeEventListener("dispose",_);const P=r.get(E);P!==void 0&&(r.delete(E),P.dispose())}return{get:function(A){if(A&&A.isTexture){const E=A.mapping,P=E===Se||E===Ve,k=E===Hn||E===fe;if(P||k){if(A.isRenderTargetTexture&&A.needsPMREMUpdate===!0){A.needsPMREMUpdate=!1;let Q=r.get(A);return d===null&&(d=new $u(R)),Q=P?d.fromEquirectangular(A,Q):d.fromCubemap(A,Q),r.set(A,Q),Q.texture}if(r.has(A))return r.get(A).texture;{const Q=A.image;if(P&&Q&&Q.height>0||k&&Q&&function(G){let re=0;for(let xe=0;xe<6;xe++)G[xe]!==void 0&&re++;return re===6}(Q)){d===null&&(d=new $u(R));const G=P?d.fromEquirectangular(A):d.fromCubemap(A);return r.set(A,G),A.addEventListener("dispose",_),G.texture}return null}}}return A},dispose:function(){r=new WeakMap,d!==null&&(d.dispose(),d=null)}}}function im(R){const r={};function d(_){if(r[_]!==void 0)return r[_];let A;switch(_){case"WEBGL_depth_texture":A=R.getExtension("WEBGL_depth_texture")||R.getExtension("MOZ_WEBGL_depth_texture")||R.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":A=R.getExtension("EXT_texture_filter_anisotropic")||R.getExtension("MOZ_EXT_texture_filter_anisotropic")||R.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":A=R.getExtension("WEBGL_compressed_texture_s3tc")||R.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||R.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":A=R.getExtension("WEBGL_compressed_texture_pvrtc")||R.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:A=R.getExtension(_)}return r[_]=A,A}return{has:function(_){return d(_)!==null},init:function(_){_.isWebGL2?d("EXT_color_buffer_float"):(d("WEBGL_depth_texture"),d("OES_texture_float"),d("OES_texture_half_float"),d("OES_texture_half_float_linear"),d("OES_standard_derivatives"),d("OES_element_index_uint"),d("OES_vertex_array_object"),d("ANGLE_instanced_arrays")),d("OES_texture_float_linear"),d("EXT_color_buffer_half_float"),d("WEBGL_multisampled_render_to_texture")},get:function(_){const A=d(_);return A===null&&console.warn("THREE.WebGLRenderer: "+_+" extension not supported."),A}}}function rm(R,r,d,_){const A={},E=new WeakMap;function P(Q){const G=Q.target;G.index!==null&&r.remove(G.index);for(const xe in G.attributes)r.remove(G.attributes[xe]);G.removeEventListener("dispose",P),delete A[G.id];const re=E.get(G);re&&(r.remove(re),E.delete(G)),_.releaseStatesOfGeometry(G),G.isInstancedBufferGeometry===!0&&delete G._maxInstanceCount,d.memory.geometries--}function k(Q){const G=[],re=Q.index,xe=Q.attributes.position;let ye=0;if(re!==null){const Ue=re.array;ye=re.version;for(let Oe=0,ke=Ue.length;Oe<ke;Oe+=3){const Ge=Ue[Oe+0],Je=Ue[Oe+1],Rt=Ue[Oe+2];G.push(Ge,Je,Je,Rt,Rt,Ge)}}else{const Ue=xe.array;ye=xe.version;for(let Oe=0,ke=Ue.length/3-1;Oe<ke;Oe+=3){const Ge=Oe+0,Je=Oe+1,Rt=Oe+2;G.push(Ge,Je,Je,Rt,Rt,Ge)}}const Ee=new(hd(G)?Ph:Ih)(G,1);Ee.version=ye;const Ie=E.get(Q);Ie&&r.remove(Ie),E.set(Q,Ee)}return{get:function(Q,G){return A[G.id]===!0||(G.addEventListener("dispose",P),A[G.id]=!0,d.memory.geometries++),G},update:function(Q){const G=Q.attributes;for(const xe in G)r.update(G[xe],R.ARRAY_BUFFER);const re=Q.morphAttributes;for(const xe in re){const ye=re[xe];for(let Ee=0,Ie=ye.length;Ee<Ie;Ee++)r.update(ye[Ee],R.ARRAY_BUFFER)}},getWireframeAttribute:function(Q){const G=E.get(Q);if(G){const re=Q.index;re!==null&&G.version<re.version&&k(Q)}else k(Q);return E.get(Q)}}}function Og(R,r,d,_){const A=_.isWebGL2;let E,P,k;this.setMode=function(Q){E=Q},this.setIndex=function(Q){P=Q.type,k=Q.bytesPerElement},this.render=function(Q,G){R.drawElements(E,G,P,Q*k),d.update(G,E,1)},this.renderInstances=function(Q,G,re){if(re===0)return;let xe,ye;if(A)xe=R,ye="drawElementsInstanced";else if(xe=r.get("ANGLE_instanced_arrays"),ye="drawElementsInstancedANGLE",xe===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");xe[ye](E,G,P,Q*k,re),d.update(G,E,re)}}function fp(R){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(d,_,A){switch(r.calls++,_){case R.TRIANGLES:r.triangles+=A*(d/3);break;case R.LINES:r.lines+=A*(d/2);break;case R.LINE_STRIP:r.lines+=A*(d-1);break;case R.LINE_LOOP:r.lines+=A*d;break;case R.POINTS:r.points+=A*d;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",_)}}}}function eA(R,r){return R[0]-r[0]}function hv(R,r){return Math.abs(r[1])-Math.abs(R[1])}function eu(R,r,d){const _={},A=new Float32Array(8),E=new WeakMap,P=new Vr,k=[];for(let Q=0;Q<8;Q++)k[Q]=[Q,0];return{update:function(Q,G,re){const xe=Q.morphTargetInfluences;if(r.isWebGL2===!0){const ye=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,Ee=ye!==void 0?ye.length:0;let Ie=E.get(G);if(Ie===void 0||Ie.count!==Ee){Ie!==void 0&&Ie.texture.dispose();const ke=G.morphAttributes.position!==void 0,Ge=G.morphAttributes.normal!==void 0,Je=G.morphAttributes.color!==void 0,Rt=G.morphAttributes.position||[],Et=G.morphAttributes.normal||[],xt=G.morphAttributes.color||[];let Zt=0;ke===!0&&(Zt=1),Ge===!0&&(Zt=2),Je===!0&&(Zt=3);let g=G.attributes.position.count*Zt,b=1;g>r.maxTextureSize&&(b=Math.ceil(g/r.maxTextureSize),g=r.maxTextureSize);const D=new Float32Array(g*b*4*Ee),L=new pc(D,g,b,Ee);L.type=jr,L.needsUpdate=!0;const Y=4*Zt;for(let ne=0;ne<Ee;ne++){const be=Rt[ne],Me=Et[ne],De=xt[ne],je=g*b*4*ne;for(let st=0;st<be.count;st++){const nt=st*Y;ke===!0&&(P.fromBufferAttribute(be,st),D[je+nt+0]=P.x,D[je+nt+1]=P.y,D[je+nt+2]=P.z,D[je+nt+3]=0),Ge===!0&&(P.fromBufferAttribute(Me,st),D[je+nt+4]=P.x,D[je+nt+5]=P.y,D[je+nt+6]=P.z,D[je+nt+7]=0),Je===!0&&(P.fromBufferAttribute(De,st),D[je+nt+8]=P.x,D[je+nt+9]=P.y,D[je+nt+10]=P.z,D[je+nt+11]=De.itemSize===4?P.w:1)}}Ie={count:Ee,texture:L,size:new li(g,b)},E.set(G,Ie),G.addEventListener("dispose",function ne(){L.dispose(),E.delete(G),G.removeEventListener("dispose",ne)})}let Ue=0;for(let ke=0;ke<xe.length;ke++)Ue+=xe[ke];const Oe=G.morphTargetsRelative?1:1-Ue;re.getUniforms().setValue(R,"morphTargetBaseInfluence",Oe),re.getUniforms().setValue(R,"morphTargetInfluences",xe),re.getUniforms().setValue(R,"morphTargetsTexture",Ie.texture,d),re.getUniforms().setValue(R,"morphTargetsTextureSize",Ie.size)}else{const ye=xe===void 0?0:xe.length;let Ee=_[G.id];if(Ee===void 0||Ee.length!==ye){Ee=[];for(let Ge=0;Ge<ye;Ge++)Ee[Ge]=[Ge,0];_[G.id]=Ee}for(let Ge=0;Ge<ye;Ge++){const Je=Ee[Ge];Je[0]=Ge,Je[1]=xe[Ge]}Ee.sort(hv);for(let Ge=0;Ge<8;Ge++)Ge<ye&&Ee[Ge][1]?(k[Ge][0]=Ee[Ge][0],k[Ge][1]=Ee[Ge][1]):(k[Ge][0]=Number.MAX_SAFE_INTEGER,k[Ge][1]=0);k.sort(eA);const Ie=G.morphAttributes.position,Ue=G.morphAttributes.normal;let Oe=0;for(let Ge=0;Ge<8;Ge++){const Je=k[Ge],Rt=Je[0],Et=Je[1];Rt!==Number.MAX_SAFE_INTEGER&&Et?(Ie&&G.getAttribute("morphTarget"+Ge)!==Ie[Rt]&&G.setAttribute("morphTarget"+Ge,Ie[Rt]),Ue&&G.getAttribute("morphNormal"+Ge)!==Ue[Rt]&&G.setAttribute("morphNormal"+Ge,Ue[Rt]),A[Ge]=Et,Oe+=Et):(Ie&&G.hasAttribute("morphTarget"+Ge)===!0&&G.deleteAttribute("morphTarget"+Ge),Ue&&G.hasAttribute("morphNormal"+Ge)===!0&&G.deleteAttribute("morphNormal"+Ge),A[Ge]=0)}const ke=G.morphTargetsRelative?1:1-Oe;re.getUniforms().setValue(R,"morphTargetBaseInfluence",ke),re.getUniforms().setValue(R,"morphTargetInfluences",A)}}}}function Ju(R,r,d,_){let A=new WeakMap;function E(P){const k=P.target;k.removeEventListener("dispose",E),d.remove(k.instanceMatrix),k.instanceColor!==null&&d.remove(k.instanceColor)}return{update:function(P){const k=_.render.frame,Q=P.geometry,G=r.get(P,Q);return A.get(G)!==k&&(r.update(G),A.set(G,k)),P.isInstancedMesh&&(P.hasEventListener("dispose",E)===!1&&P.addEventListener("dispose",E),d.update(P.instanceMatrix,R.ARRAY_BUFFER),P.instanceColor!==null&&d.update(P.instanceColor,R.ARRAY_BUFFER)),G},dispose:function(){A=new WeakMap}}}const sm=new Us,Bg=new pc,Lg=new ko,Vo=new xd,wc=[],Xs=[],Ba=new Float32Array(16),lf=new Float32Array(9),Go=new Float32Array(4);function Oh(R,r,d){const _=R[0];if(_<=0||_>0)return R;const A=r*d;let E=wc[A];if(E===void 0&&(E=new Float32Array(A),wc[A]=E),r!==0){_.toArray(E,0);for(let P=1,k=0;P!==r;++P)k+=d,R[P].toArray(E,k)}return E}function fo(R,r){if(R.length!==r.length)return!1;for(let d=0,_=R.length;d<_;d++)if(R[d]!==r[d])return!1;return!0}function mo(R,r){for(let d=0,_=r.length;d<_;d++)R[d]=r[d]}function om(R,r){let d=Xs[r];d===void 0&&(d=new Int32Array(r),Xs[r]=d);for(let _=0;_!==r;++_)d[_]=R.allocateTextureUnit();return d}function Md(R,r){const d=this.cache;d[0]!==r&&(R.uniform1f(this.addr,r),d[0]=r)}function I0(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y||(R.uniform2f(this.addr,r.x,r.y),d[0]=r.x,d[1]=r.y);else{if(fo(d,r))return;R.uniform2fv(this.addr,r),mo(d,r)}}function dv(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z||(R.uniform3f(this.addr,r.x,r.y,r.z),d[0]=r.x,d[1]=r.y,d[2]=r.z);else if(r.r!==void 0)d[0]===r.r&&d[1]===r.g&&d[2]===r.b||(R.uniform3f(this.addr,r.r,r.g,r.b),d[0]=r.r,d[1]=r.g,d[2]=r.b);else{if(fo(d,r))return;R.uniform3fv(this.addr,r),mo(d,r)}}function Bh(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z&&d[3]===r.w||(R.uniform4f(this.addr,r.x,r.y,r.z,r.w),d[0]=r.x,d[1]=r.y,d[2]=r.z,d[3]=r.w);else{if(fo(d,r))return;R.uniform4fv(this.addr,r),mo(d,r)}}function to(R,r){const d=this.cache,_=r.elements;if(_===void 0){if(fo(d,r))return;R.uniformMatrix2fv(this.addr,!1,r),mo(d,r)}else{if(fo(d,_))return;Go.set(_),R.uniformMatrix2fv(this.addr,!1,Go),mo(d,_)}}function Zu(R,r){const d=this.cache,_=r.elements;if(_===void 0){if(fo(d,r))return;R.uniformMatrix3fv(this.addr,!1,r),mo(d,r)}else{if(fo(d,_))return;lf.set(_),R.uniformMatrix3fv(this.addr,!1,lf),mo(d,_)}}function P0(R,r){const d=this.cache,_=r.elements;if(_===void 0){if(fo(d,r))return;R.uniformMatrix4fv(this.addr,!1,r),mo(d,r)}else{if(fo(d,_))return;Ba.set(_),R.uniformMatrix4fv(this.addr,!1,Ba),mo(d,_)}}function mp(R,r){const d=this.cache;d[0]!==r&&(R.uniform1i(this.addr,r),d[0]=r)}function Ng(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y||(R.uniform2i(this.addr,r.x,r.y),d[0]=r.x,d[1]=r.y);else{if(fo(d,r))return;R.uniform2iv(this.addr,r),mo(d,r)}}function Ec(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z||(R.uniform3i(this.addr,r.x,r.y,r.z),d[0]=r.x,d[1]=r.y,d[2]=r.z);else{if(fo(d,r))return;R.uniform3iv(this.addr,r),mo(d,r)}}function am(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z&&d[3]===r.w||(R.uniform4i(this.addr,r.x,r.y,r.z,r.w),d[0]=r.x,d[1]=r.y,d[2]=r.z,d[3]=r.w);else{if(fo(d,r))return;R.uniform4iv(this.addr,r),mo(d,r)}}function D0(R,r){const d=this.cache;d[0]!==r&&(R.uniform1ui(this.addr,r),d[0]=r)}function go(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y||(R.uniform2ui(this.addr,r.x,r.y),d[0]=r.x,d[1]=r.y);else{if(fo(d,r))return;R.uniform2uiv(this.addr,r),mo(d,r)}}function kg(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z||(R.uniform3ui(this.addr,r.x,r.y,r.z),d[0]=r.x,d[1]=r.y,d[2]=r.z);else{if(fo(d,r))return;R.uniform3uiv(this.addr,r),mo(d,r)}}function O0(R,r){const d=this.cache;if(r.x!==void 0)d[0]===r.x&&d[1]===r.y&&d[2]===r.z&&d[3]===r.w||(R.uniform4ui(this.addr,r.x,r.y,r.z,r.w),d[0]=r.x,d[1]=r.y,d[2]=r.z,d[3]=r.w);else{if(fo(d,r))return;R.uniform4uiv(this.addr,r),mo(d,r)}}function eh(R,r,d){const _=this.cache,A=d.allocateTextureUnit();_[0]!==A&&(R.uniform1i(this.addr,A),_[0]=A),d.setTexture2D(r||sm,A)}function B0(R,r,d){const _=this.cache,A=d.allocateTextureUnit();_[0]!==A&&(R.uniform1i(this.addr,A),_[0]=A),d.setTexture3D(r||Lg,A)}function cf(R,r,d){const _=this.cache,A=d.allocateTextureUnit();_[0]!==A&&(R.uniform1i(this.addr,A),_[0]=A),d.setTextureCube(r||Vo,A)}function tA(R,r,d){const _=this.cache,A=d.allocateTextureUnit();_[0]!==A&&(R.uniform1i(this.addr,A),_[0]=A),d.setTexture2DArray(r||Bg,A)}function uf(R,r){R.uniform1fv(this.addr,r)}function ul(R,r){const d=Oh(r,this.size,2);R.uniform2fv(this.addr,d)}function th(R,r){const d=Oh(r,this.size,3);R.uniform3fv(this.addr,d)}function gp(R,r){const d=Oh(r,this.size,4);R.uniform4fv(this.addr,d)}function lm(R,r){const d=Oh(r,this.size,4);R.uniformMatrix2fv(this.addr,!1,d)}function Kl(R,r){const d=Oh(r,this.size,9);R.uniformMatrix3fv(this.addr,!1,d)}function nA(R,r){const d=Oh(r,this.size,16);R.uniformMatrix4fv(this.addr,!1,d)}function pv(R,r){R.uniform1iv(this.addr,r)}function Ug(R,r){R.uniform2iv(this.addr,r)}function L0(R,r){R.uniform3iv(this.addr,r)}function Fg(R,r){R.uniform4iv(this.addr,r)}function fv(R,r){R.uniform1uiv(this.addr,r)}function hf(R,r){R.uniform2uiv(this.addr,r)}function cm(R,r){R.uniform3uiv(this.addr,r)}function N0(R,r){R.uniform4uiv(this.addr,r)}function k0(R,r,d){const _=this.cache,A=r.length,E=om(d,A);fo(_,E)||(R.uniform1iv(this.addr,E),mo(_,E));for(let P=0;P!==A;++P)d.setTexture2D(r[P]||sm,E[P])}function df(R,r,d){const _=this.cache,A=r.length,E=om(d,A);fo(_,E)||(R.uniform1iv(this.addr,E),mo(_,E));for(let P=0;P!==A;++P)d.setTexture3D(r[P]||Lg,E[P])}function Sc(R,r,d){const _=this.cache,A=r.length,E=om(d,A);fo(_,E)||(R.uniform1iv(this.addr,E),mo(_,E));for(let P=0;P!==A;++P)d.setTextureCube(r[P]||Vo,E[P])}function _p(R,r,d){const _=this.cache,A=r.length,E=om(d,A);fo(_,E)||(R.uniform1iv(this.addr,E),mo(_,E));for(let P=0;P!==A;++P)d.setTexture2DArray(r[P]||Bg,E[P])}class Mo{constructor(r,d,_){this.id=r,this.addr=_,this.cache=[],this.setValue=function(A){switch(A){case 5126:return Md;case 35664:return I0;case 35665:return dv;case 35666:return Bh;case 35674:return to;case 35675:return Zu;case 35676:return P0;case 5124:case 35670:return mp;case 35667:case 35671:return Ng;case 35668:case 35672:return Ec;case 35669:case 35673:return am;case 5125:return D0;case 36294:return go;case 36295:return kg;case 36296:return O0;case 35678:case 36198:case 36298:case 36306:case 35682:return eh;case 35679:case 36299:case 36307:return B0;case 35680:case 36300:case 36308:case 36293:return cf;case 36289:case 36303:case 36311:case 36292:return tA}}(d.type)}}class iA{constructor(r,d,_){this.id=r,this.addr=_,this.cache=[],this.size=d.size,this.setValue=function(A){switch(A){case 5126:return uf;case 35664:return ul;case 35665:return th;case 35666:return gp;case 35674:return lm;case 35675:return Kl;case 35676:return nA;case 5124:case 35670:return pv;case 35667:case 35671:return Ug;case 35668:case 35672:return L0;case 35669:case 35673:return Fg;case 5125:return fv;case 36294:return hf;case 36295:return cm;case 36296:return N0;case 35678:case 36198:case 36298:case 36306:case 35682:return k0;case 35679:case 36299:case 36307:return df;case 35680:case 36300:case 36308:case 36293:return Sc;case 36289:case 36303:case 36311:case 36292:return _p}}(d.type)}}class $o{constructor(r){this.id=r,this.seq=[],this.map={}}setValue(r,d,_){const A=this.seq;for(let E=0,P=A.length;E!==P;++E){const k=A[E];k.setValue(r,d[k.id],_)}}}const Lh=/(\w+)(\])?(\[|\.)?/g;function Nh(R,r){R.seq.push(r),R.map[r.id]=r}function Td(R,r,d){const _=R.name,A=_.length;for(Lh.lastIndex=0;;){const E=Lh.exec(_),P=Lh.lastIndex;let k=E[1];const Q=E[2]==="]",G=E[3];if(Q&&(k|=0),G===void 0||G==="["&&P+2===A){Nh(d,G===void 0?new Mo(k,R,r):new iA(k,R,r));break}{let re=d.map[k];re===void 0&&(re=new $o(k),Nh(d,re)),d=re}}}class mv{constructor(r,d){this.seq=[],this.map={};const _=r.getProgramParameter(d,r.ACTIVE_UNIFORMS);for(let A=0;A<_;++A){const E=r.getActiveUniform(d,A);Td(E,r.getUniformLocation(d,E.name),this)}}setValue(r,d,_,A){const E=this.map[d];E!==void 0&&E.setValue(r,_,A)}setOptional(r,d,_){const A=d[_];A!==void 0&&this.setValue(r,_,A)}static upload(r,d,_,A){for(let E=0,P=d.length;E!==P;++E){const k=d[E],Q=_[k.id];Q.needsUpdate!==!1&&k.setValue(r,Q.value,A)}}static seqWithValue(r,d){const _=[];for(let A=0,E=r.length;A!==E;++A){const P=r[A];P.id in d&&_.push(P)}return _}}function gv(R,r,d){const _=R.createShader(r);return R.shaderSource(_,d),R.compileShader(_),_}let rA=0;function zg(R){switch(R){case Ta:case Is:return["Linear","( value )"];case xr:return["sRGB","( value )"];case Wl:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",R),["Linear","( value )"]}}function sA(R,r,d){const _=R.getShaderParameter(r,R.COMPILE_STATUS),A=R.getShaderInfoLog(r).trim();if(_&&A==="")return"";const E=/ERROR: 0:(\d+)/.exec(A);if(E){const P=parseInt(E[1]);return d.toUpperCase()+`

`+A+`

`+function(k,Q){const G=k.split(`
`),re=[],xe=Math.max(Q-6,0),ye=Math.min(Q+6,G.length);for(let Ee=xe;Ee<ye;Ee++){const Ie=Ee+1;re.push(`${Ie===Q?">":" "} ${Ie}: ${G[Ee]}`)}return re.join(`
`)}(R.getShaderSource(r),P)}return A}function Eb(R,r){const d=zg(r);return"vec4 "+R+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function jg(R,r){const d=zg(r);return"vec4 "+R+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function vp(R,r){let d;switch(r){case pn:d="Linear";break;case Pn:d="Reinhard";break;case Cn:d="OptimizedCineon";break;case vn:d="ACESFilmic";break;case In:d="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",r),d="Linear"}return"vec3 "+R+"( vec3 color ) { return "+d+"ToneMapping( color ); }"}function Ps(R){return R!==""}function _v(R,r){const d=r.numSpotLightShadows+r.numSpotLightMaps-r.numSpotLightShadowsWithMaps;return R.replace(/NUM_DIR_LIGHTS/g,r.numDirLights).replace(/NUM_SPOT_LIGHTS/g,r.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,r.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,d).replace(/NUM_RECT_AREA_LIGHTS/g,r.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,r.numPointLights).replace(/NUM_HEMI_LIGHTS/g,r.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,r.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,r.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,r.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,r.numPointLightShadows)}function Vg(R,r){return R.replace(/NUM_CLIPPING_PLANES/g,r.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,r.numClippingPlanes-r.numClipIntersection)}const Gg=/^[ \t]*#include +<([\w\d./]+)>/gm;function um(R){return R.replace(Gg,nh)}function nh(R,r){const d=os[r];if(d===void 0)throw new Error("Can not resolve #include <"+r+">");return um(d)}const vv=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hm(R){return R.replace(vv,pf)}function pf(R,r,d,_){let A="";for(let E=parseInt(r);E<parseInt(d);E++)A+=_.replace(/\[\s*i\s*\]/g,"[ "+E+" ]").replace(/UNROLLED_LOOP_INDEX/g,E);return A}function kh(R){let r="precision "+R.precision+` float;
precision `+R.precision+" int;";return R.precision==="highp"?r+=`
#define HIGH_PRECISION`:R.precision==="mediump"?r+=`
#define MEDIUM_PRECISION`:R.precision==="lowp"&&(r+=`
#define LOW_PRECISION`),r}function ff(R,r,d,_){const A=R.getContext(),E=d.defines;let P=d.vertexShader,k=d.fragmentShader;const Q=function(b){let D="SHADOWMAP_TYPE_BASIC";return b.shadowMapType===Z?D="SHADOWMAP_TYPE_PCF":b.shadowMapType===oe?D="SHADOWMAP_TYPE_PCF_SOFT":b.shadowMapType===le&&(D="SHADOWMAP_TYPE_VSM"),D}(d),G=function(b){let D="ENVMAP_TYPE_CUBE";if(b.envMap)switch(b.envMapMode){case Hn:case fe:D="ENVMAP_TYPE_CUBE";break;case We:D="ENVMAP_TYPE_CUBE_UV"}return D}(d),re=function(b){let D="ENVMAP_MODE_REFLECTION";return b.envMap&&b.envMapMode===fe&&(D="ENVMAP_MODE_REFRACTION"),D}(d),xe=function(b){let D="ENVMAP_BLENDING_NONE";if(b.envMap)switch(b.combine){case Xe:D="ENVMAP_BLENDING_MULTIPLY";break;case Xt:D="ENVMAP_BLENDING_MIX";break;case tn:D="ENVMAP_BLENDING_ADD"}return D}(d),ye=function(b){const D=b.envMapCubeUVHeight;if(D===null)return null;const L=Math.log2(D)-2,Y=1/D;return{texelWidth:1/(3*Math.max(Math.pow(2,L),112)),texelHeight:Y,maxMip:L}}(d),Ee=d.isWebGL2?"":function(b){return[b.extensionDerivatives||b.envMapCubeUVHeight||b.bumpMap||b.normalMapTangentSpace||b.clearcoatNormalMap||b.flatShading||b.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(b.extensionFragDepth||b.logarithmicDepthBuffer)&&b.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",b.extensionDrawBuffers&&b.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(b.extensionShaderTextureLOD||b.envMap||b.transmission)&&b.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ps).join(`
`)}(d),Ie=function(b){const D=[];for(const L in b){const Y=b[L];Y!==!1&&D.push("#define "+L+" "+Y)}return D.join(`
`)}(E),Ue=A.createProgram();let Oe,ke,Ge=d.glslVersion?"#version "+d.glslVersion+`
`:"";d.isRawShaderMaterial?(Oe=[Ie].filter(Ps).join(`
`),Oe.length>0&&(Oe+=`
`),ke=[Ee,Ie].filter(Ps).join(`
`),ke.length>0&&(ke+=`
`)):(Oe=[kh(d),"#define SHADER_NAME "+d.shaderName,Ie,d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+re:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.displacementMap?"#define USE_DISPLACEMENTMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.mapUv?"#define MAP_UV "+d.mapUv:"",d.alphaMapUv?"#define ALPHAMAP_UV "+d.alphaMapUv:"",d.lightMapUv?"#define LIGHTMAP_UV "+d.lightMapUv:"",d.aoMapUv?"#define AOMAP_UV "+d.aoMapUv:"",d.emissiveMapUv?"#define EMISSIVEMAP_UV "+d.emissiveMapUv:"",d.bumpMapUv?"#define BUMPMAP_UV "+d.bumpMapUv:"",d.normalMapUv?"#define NORMALMAP_UV "+d.normalMapUv:"",d.displacementMapUv?"#define DISPLACEMENTMAP_UV "+d.displacementMapUv:"",d.metalnessMapUv?"#define METALNESSMAP_UV "+d.metalnessMapUv:"",d.roughnessMapUv?"#define ROUGHNESSMAP_UV "+d.roughnessMapUv:"",d.clearcoatMapUv?"#define CLEARCOATMAP_UV "+d.clearcoatMapUv:"",d.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+d.clearcoatNormalMapUv:"",d.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+d.clearcoatRoughnessMapUv:"",d.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+d.iridescenceMapUv:"",d.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+d.iridescenceThicknessMapUv:"",d.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+d.sheenColorMapUv:"",d.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+d.sheenRoughnessMapUv:"",d.specularMapUv?"#define SPECULARMAP_UV "+d.specularMapUv:"",d.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+d.specularColorMapUv:"",d.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+d.specularIntensityMapUv:"",d.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+d.transmissionMapUv:"",d.thicknessMapUv?"#define THICKNESSMAP_UV "+d.thicknessMapUv:"",d.vertexTangents?"#define USE_TANGENT":"",d.vertexColors?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&d.flatShading===!1?"#define USE_MORPHNORMALS":"",d.morphColors&&d.isWebGL2?"#define USE_MORPHCOLORS":"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+d.morphTextureStride:"",d.morphTargetsCount>0&&d.isWebGL2?"#define MORPHTARGETS_COUNT "+d.morphTargetsCount:"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+Q:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&d.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ps).join(`
`),ke=[Ee,kh(d),"#define SHADER_NAME "+d.shaderName,Ie,d.instancing?"#define USE_INSTANCING":"",d.instancingColor?"#define USE_INSTANCING_COLOR":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp2?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.matcap?"#define USE_MATCAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+G:"",d.envMap?"#define "+re:"",d.envMap?"#define "+xe:"",ye?"#define CUBEUV_TEXEL_WIDTH "+ye.texelWidth:"",ye?"#define CUBEUV_TEXEL_HEIGHT "+ye.texelHeight:"",ye?"#define CUBEUV_MAX_MIP "+ye.maxMip+".0":"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",d.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.clearcoat?"#define USE_CLEARCOAT":"",d.clearcoatMap?"#define USE_CLEARCOATMAP":"",d.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",d.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",d.iridescence?"#define USE_IRIDESCENCE":"",d.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",d.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",d.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.alphaTest?"#define USE_ALPHATEST":"",d.sheen?"#define USE_SHEEN":"",d.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",d.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",d.transmission?"#define USE_TRANSMISSION":"",d.transmissionMap?"#define USE_TRANSMISSIONMAP":"",d.thicknessMap?"#define USE_THICKNESSMAP":"",d.vertexTangents?"#define USE_TANGENT":"",d.vertexColors||d.instancingColor?"#define USE_COLOR":"",d.vertexAlphas?"#define USE_COLOR_ALPHA":"",d.vertexUv1s?"#define USE_UV1":"",d.vertexUv2s?"#define USE_UV2":"",d.vertexUv3s?"#define USE_UV3":"",d.pointsUvs?"#define USE_POINTS_UV":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+Q:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.useLegacyLights?"#define LEGACY_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&d.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",d.toneMapping!==dn?"#define TONE_MAPPING":"",d.toneMapping!==dn?os.tonemapping_pars_fragment:"",d.toneMapping!==dn?vp("toneMapping",d.toneMapping):"",d.dithering?"#define DITHERING":"",d.opaque?"#define OPAQUE":"",os.encodings_pars_fragment,jg("linearToOutputTexel",d.outputColorSpace),d.transmissionSamplerMapEncoding?Eb("transmissionSamplerMapTexelToLinear",d.transmissionSamplerMapEncoding):"",d.useDepthPacking?"#define DEPTH_PACKING "+d.depthPacking:"",`
`].filter(Ps).join(`
`)),P=um(P),P=_v(P,d),P=Vg(P,d),k=um(k),k=_v(k,d),k=Vg(k,d),P=hm(P),k=hm(k),d.isWebGL2&&d.isRawShaderMaterial!==!0&&(Ge=`#version 300 es
`,Oe=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Oe,ke=["#define varying in",d.glslVersion===Sg?"":"layout(location = 0) out highp vec4 pc_fragColor;",d.glslVersion===Sg?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ke);const Je=Ge+Oe+P,Rt=Ge+ke+k,Et=gv(A,A.VERTEX_SHADER,Je),xt=gv(A,A.FRAGMENT_SHADER,Rt);if(A.attachShader(Ue,Et),A.attachShader(Ue,xt),d.index0AttributeName!==void 0?A.bindAttribLocation(Ue,0,d.index0AttributeName):d.morphTargets===!0&&A.bindAttribLocation(Ue,0,"position"),A.linkProgram(Ue),R.debug.checkShaderErrors){const b=A.getProgramInfoLog(Ue).trim(),D=A.getShaderInfoLog(Et).trim(),L=A.getShaderInfoLog(xt).trim();let Y=!0,ne=!0;if(A.getProgramParameter(Ue,A.LINK_STATUS)===!1)if(Y=!1,typeof R.debug.onShaderError=="function")R.debug.onShaderError(A,Ue,Et,xt);else{const be=sA(A,Et,"vertex"),Me=sA(A,xt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+A.getError()+" - VALIDATE_STATUS "+A.getProgramParameter(Ue,A.VALIDATE_STATUS)+`

Program Info Log: `+b+`
`+be+`
`+Me)}else b!==""?console.warn("THREE.WebGLProgram: Program Info Log:",b):D!==""&&L!==""||(ne=!1);ne&&(this.diagnostics={runnable:Y,programLog:b,vertexShader:{log:D,prefix:Oe},fragmentShader:{log:L,prefix:ke}})}let Zt,g;return A.deleteShader(Et),A.deleteShader(xt),this.getUniforms=function(){return Zt===void 0&&(Zt=new mv(A,Ue)),Zt},this.getAttributes=function(){return g===void 0&&(g=function(b,D){const L={},Y=b.getProgramParameter(D,b.ACTIVE_ATTRIBUTES);for(let ne=0;ne<Y;ne++){const be=b.getActiveAttrib(D,ne),Me=be.name;let De=1;be.type===b.FLOAT_MAT2&&(De=2),be.type===b.FLOAT_MAT3&&(De=3),be.type===b.FLOAT_MAT4&&(De=4),L[Me]={type:be.type,location:b.getAttribLocation(D,Me),locationSize:De}}return L}(A,Ue)),g},this.destroy=function(){_.releaseStatesOfProgram(this),A.deleteProgram(Ue),this.program=void 0},this.name=d.shaderName,this.id=rA++,this.cacheKey=r,this.usedTimes=1,this.program=Ue,this.vertexShader=Et,this.fragmentShader=xt,this}let dm=0;class pm{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(r){const d=r.vertexShader,_=r.fragmentShader,A=this._getShaderStage(d),E=this._getShaderStage(_),P=this._getShaderCacheForMaterial(r);return P.has(A)===!1&&(P.add(A),A.usedTimes++),P.has(E)===!1&&(P.add(E),E.usedTimes++),this}remove(r){const d=this.materialCache.get(r);for(const _ of d)_.usedTimes--,_.usedTimes===0&&this.shaderCache.delete(_.code);return this.materialCache.delete(r),this}getVertexShaderID(r){return this._getShaderStage(r.vertexShader).id}getFragmentShaderID(r){return this._getShaderStage(r.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(r){const d=this.materialCache;let _=d.get(r);return _===void 0&&(_=new Set,d.set(r,_)),_}_getShaderStage(r){const d=this.shaderCache;let _=d.get(r);return _===void 0&&(_=new yv(r),d.set(r,_)),_}}class yv{constructor(r){this.id=dm++,this.code=r,this.usedTimes=0}}function Sb(R,r,d,_,A,E,P){const k=new Th,Q=new pm,G=[],re=A.isWebGL2,xe=A.logarithmicDepthBuffer,ye=A.vertexTextures;let Ee=A.precision;const Ie={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Ue(Oe){return Oe===1?"uv1":Oe===2?"uv2":Oe===3?"uv3":"uv"}return{getParameters:function(Oe,ke,Ge,Je,Rt){const Et=Je.fog,xt=Rt.geometry,Zt=Oe.isMeshStandardMaterial?Je.environment:null,g=(Oe.isMeshStandardMaterial?d:r).get(Oe.envMap||Zt),b=g&&g.mapping===We?g.image.height:null,D=Ie[Oe.type];Oe.precision!==null&&(Ee=A.getMaxPrecision(Oe.precision),Ee!==Oe.precision&&console.warn("THREE.WebGLProgram.getParameters:",Oe.precision,"not supported, using",Ee,"instead."));const L=xt.morphAttributes.position||xt.morphAttributes.normal||xt.morphAttributes.color,Y=L!==void 0?L.length:0;let ne,be,Me,De,je=0;if(xt.morphAttributes.position!==void 0&&(je=1),xt.morphAttributes.normal!==void 0&&(je=2),xt.morphAttributes.color!==void 0&&(je=3),D){const zp=Ol[D];ne=zp.vertexShader,be=zp.fragmentShader}else ne=Oe.vertexShader,be=Oe.fragmentShader,Q.update(Oe),Me=Q.getVertexShaderID(Oe),De=Q.getFragmentShaderID(Oe);const st=R.getRenderTarget(),nt=R.userData&&R.userData.transmissionRenderTarget,ot=st?Array.isArray(st.texture)?st.texture[0]:st.texture:null,Vt=Rt.isInstancedMesh===!0,Jt=!!Oe.map,en=!!Oe.matcap,Yt=!!g,ln=!!Oe.aoMap,et=!!Oe.lightMap,$e=!!Oe.bumpMap,Gt=!!Oe.normalMap,Ut=!!Oe.displacementMap,yt=!!Oe.emissiveMap,wt=!!Oe.metalnessMap,qe=!!Oe.roughnessMap,Ct=Oe.clearcoat>0,Dt=Oe.iridescence>0,hn=Oe.sheen>0,Kt=Oe.transmission>0,yn=Ct&&!!Oe.clearcoatMap,ii=Ct&&!!Oe.clearcoatNormalMap,Ui=Ct&&!!Oe.clearcoatRoughnessMap,Bi=Dt&&!!Oe.iridescenceMap,ci=Dt&&!!Oe.iridescenceThicknessMap,Ii=hn&&!!Oe.sheenColorMap,$i=hn&&!!Oe.sheenRoughnessMap,sr=!!Oe.specularMap,xs=!!Oe.specularColorMap,yo=!!Oe.specularIntensityMap,Pr=Kt&&!!Oe.transmissionMap,ds=Kt&&!!Oe.thicknessMap,Ss=!!Oe.gradientMap,lu=!!Oe.alphaMap,Jn=Oe.alphaTest>0,xl=!!Oe.extensions,Vd=!!xt.attributes.uv1,wl=!!xt.attributes.uv2,Zh=!!xt.attributes.uv3;return{isWebGL2:re,shaderID:D,shaderName:Oe.type,vertexShader:ne,fragmentShader:be,defines:Oe.defines,customVertexShaderID:Me,customFragmentShaderID:De,isRawShaderMaterial:Oe.isRawShaderMaterial===!0,glslVersion:Oe.glslVersion,precision:Ee,instancing:Vt,instancingColor:Vt&&Rt.instanceColor!==null,supportsVertexTextures:ye,outputColorSpace:st===null?R.outputColorSpace:st.isXRRenderTarget===!0||ot.colorSpace&&ot.colorSpace!==xr?ot.colorSpace:Is,map:Jt,matcap:en,envMap:Yt,envMapMode:Yt&&g.mapping,envMapCubeUVHeight:b,aoMap:ln,lightMap:et,bumpMap:$e,normalMap:Gt,displacementMap:ye&&Ut,emissiveMap:yt,normalMapObjectSpace:Gt&&Oe.normalMapType===vr,normalMapTangentSpace:Gt&&Oe.normalMapType===$s,metalnessMap:wt,roughnessMap:qe,clearcoat:Ct,clearcoatMap:yn,clearcoatNormalMap:ii,clearcoatRoughnessMap:Ui,iridescence:Dt,iridescenceMap:Bi,iridescenceThicknessMap:ci,sheen:hn,sheenColorMap:Ii,sheenRoughnessMap:$i,specularMap:sr,specularColorMap:xs,specularIntensityMap:yo,transmission:Kt,transmissionMap:Pr,thicknessMap:ds,transmissionSamplerMapEncoding:nt&&nt.texture.colorSpace||Is,gradientMap:Ss,opaque:Oe.transparent===!1&&Oe.blending===W&&!(Oe.transmission>0),alphaMap:lu,alphaTest:Jn,combine:Oe.combine,mapUv:Jt&&Ue(Oe.map.channel),aoMapUv:ln&&Ue(Oe.aoMap.channel),lightMapUv:et&&Ue(Oe.lightMap.channel),bumpMapUv:$e&&Ue(Oe.bumpMap.channel),normalMapUv:Gt&&Ue(Oe.normalMap.channel),displacementMapUv:Ut&&Ue(Oe.displacementMap.channel),emissiveMapUv:yt&&Ue(Oe.emissiveMap.channel),metalnessMapUv:wt&&Ue(Oe.metalnessMap.channel),roughnessMapUv:qe&&Ue(Oe.roughnessMap.channel),clearcoatMapUv:yn&&Ue(Oe.clearcoatMap.channel),clearcoatNormalMapUv:ii&&Ue(Oe.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ui&&Ue(Oe.clearcoatRoughnessMap.channel),iridescenceMapUv:Bi&&Ue(Oe.iridescenceMap.channel),iridescenceThicknessMapUv:ci&&Ue(Oe.iridescenceThicknessMap.channel),sheenColorMapUv:Ii&&Ue(Oe.sheenColorMap.channel),sheenRoughnessMapUv:$i&&Ue(Oe.sheenRoughnessMap.channel),specularMapUv:sr&&Ue(Oe.specularMap.channel),specularColorMapUv:xs&&Ue(Oe.specularColorMap.channel),specularIntensityMapUv:yo&&Ue(Oe.specularIntensityMap.channel),transmissionMapUv:Pr&&Ue(Oe.transmissionMap.channel),thicknessMapUv:ds&&Ue(Oe.thicknessMap.channel),alphaMapUv:lu&&Ue(Oe.alphaMap.channel),vertexTangents:Gt&&!!xt.attributes.tangent,vertexColors:Oe.vertexColors,vertexAlphas:Oe.vertexColors===!0&&!!xt.attributes.color&&xt.attributes.color.itemSize===4,vertexUv1s:Vd,vertexUv2s:wl,vertexUv3s:Zh,pointsUvs:Rt.isPoints===!0&&!!xt.attributes.uv&&(Jt||lu),fog:!!Et,useFog:Oe.fog===!0,fogExp2:Et&&Et.isFogExp2,flatShading:Oe.flatShading===!0,sizeAttenuation:Oe.sizeAttenuation===!0,logarithmicDepthBuffer:xe,skinning:Rt.isSkinnedMesh===!0,morphTargets:xt.morphAttributes.position!==void 0,morphNormals:xt.morphAttributes.normal!==void 0,morphColors:xt.morphAttributes.color!==void 0,morphTargetsCount:Y,morphTextureStride:je,numDirLights:ke.directional.length,numPointLights:ke.point.length,numSpotLights:ke.spot.length,numSpotLightMaps:ke.spotLightMap.length,numRectAreaLights:ke.rectArea.length,numHemiLights:ke.hemi.length,numDirLightShadows:ke.directionalShadowMap.length,numPointLightShadows:ke.pointShadowMap.length,numSpotLightShadows:ke.spotShadowMap.length,numSpotLightShadowsWithMaps:ke.numSpotLightShadowsWithMaps,numClippingPlanes:P.numPlanes,numClipIntersection:P.numIntersection,dithering:Oe.dithering,shadowMapEnabled:R.shadowMap.enabled&&Ge.length>0,shadowMapType:R.shadowMap.type,toneMapping:Oe.toneMapped?R.toneMapping:dn,useLegacyLights:R.useLegacyLights,premultipliedAlpha:Oe.premultipliedAlpha,doubleSided:Oe.side===ce,flipSided:Oe.side===ve,useDepthPacking:Oe.depthPacking>=0,depthPacking:Oe.depthPacking||0,index0AttributeName:Oe.index0AttributeName,extensionDerivatives:xl&&Oe.extensions.derivatives===!0,extensionFragDepth:xl&&Oe.extensions.fragDepth===!0,extensionDrawBuffers:xl&&Oe.extensions.drawBuffers===!0,extensionShaderTextureLOD:xl&&Oe.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:re||_.has("EXT_frag_depth"),rendererExtensionDrawBuffers:re||_.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:re||_.has("EXT_shader_texture_lod"),customProgramCacheKey:Oe.customProgramCacheKey()}},getProgramCacheKey:function(Oe){const ke=[];if(Oe.shaderID?ke.push(Oe.shaderID):(ke.push(Oe.customVertexShaderID),ke.push(Oe.customFragmentShaderID)),Oe.defines!==void 0)for(const Ge in Oe.defines)ke.push(Ge),ke.push(Oe.defines[Ge]);return Oe.isRawShaderMaterial===!1&&(function(Ge,Je){Ge.push(Je.precision),Ge.push(Je.outputColorSpace),Ge.push(Je.envMapMode),Ge.push(Je.envMapCubeUVHeight),Ge.push(Je.mapUv),Ge.push(Je.alphaMapUv),Ge.push(Je.lightMapUv),Ge.push(Je.aoMapUv),Ge.push(Je.bumpMapUv),Ge.push(Je.normalMapUv),Ge.push(Je.displacementMapUv),Ge.push(Je.emissiveMapUv),Ge.push(Je.metalnessMapUv),Ge.push(Je.roughnessMapUv),Ge.push(Je.clearcoatMapUv),Ge.push(Je.clearcoatNormalMapUv),Ge.push(Je.clearcoatRoughnessMapUv),Ge.push(Je.iridescenceMapUv),Ge.push(Je.iridescenceThicknessMapUv),Ge.push(Je.sheenColorMapUv),Ge.push(Je.sheenRoughnessMapUv),Ge.push(Je.specularMapUv),Ge.push(Je.specularColorMapUv),Ge.push(Je.specularIntensityMapUv),Ge.push(Je.transmissionMapUv),Ge.push(Je.thicknessMapUv),Ge.push(Je.combine),Ge.push(Je.fogExp2),Ge.push(Je.sizeAttenuation),Ge.push(Je.morphTargetsCount),Ge.push(Je.morphAttributeCount),Ge.push(Je.numDirLights),Ge.push(Je.numPointLights),Ge.push(Je.numSpotLights),Ge.push(Je.numSpotLightMaps),Ge.push(Je.numHemiLights),Ge.push(Je.numRectAreaLights),Ge.push(Je.numDirLightShadows),Ge.push(Je.numPointLightShadows),Ge.push(Je.numSpotLightShadows),Ge.push(Je.numSpotLightShadowsWithMaps),Ge.push(Je.shadowMapType),Ge.push(Je.toneMapping),Ge.push(Je.numClippingPlanes),Ge.push(Je.numClipIntersection),Ge.push(Je.depthPacking)}(ke,Oe),function(Ge,Je){k.disableAll(),Je.isWebGL2&&k.enable(0),Je.supportsVertexTextures&&k.enable(1),Je.instancing&&k.enable(2),Je.instancingColor&&k.enable(3),Je.matcap&&k.enable(4),Je.envMap&&k.enable(5),Je.normalMapObjectSpace&&k.enable(6),Je.normalMapTangentSpace&&k.enable(7),Je.clearcoat&&k.enable(8),Je.iridescence&&k.enable(9),Je.alphaTest&&k.enable(10),Je.vertexColors&&k.enable(11),Je.vertexAlphas&&k.enable(12),Je.vertexUv1s&&k.enable(13),Je.vertexUv2s&&k.enable(14),Je.vertexUv3s&&k.enable(15),Je.vertexTangents&&k.enable(16),Ge.push(k.mask),k.disableAll(),Je.fog&&k.enable(0),Je.useFog&&k.enable(1),Je.flatShading&&k.enable(2),Je.logarithmicDepthBuffer&&k.enable(3),Je.skinning&&k.enable(4),Je.morphTargets&&k.enable(5),Je.morphNormals&&k.enable(6),Je.morphColors&&k.enable(7),Je.premultipliedAlpha&&k.enable(8),Je.shadowMapEnabled&&k.enable(9),Je.useLegacyLights&&k.enable(10),Je.doubleSided&&k.enable(11),Je.flipSided&&k.enable(12),Je.useDepthPacking&&k.enable(13),Je.dithering&&k.enable(14),Je.transmission&&k.enable(15),Je.sheen&&k.enable(16),Je.opaque&&k.enable(17),Je.pointsUvs&&k.enable(18),Ge.push(k.mask)}(ke,Oe),ke.push(R.outputColorSpace)),ke.push(Oe.customProgramCacheKey),ke.join()},getUniforms:function(Oe){const ke=Ie[Oe.type];let Ge;if(ke){const Je=Ol[ke];Ge=T0.clone(Je.uniforms)}else Ge=Oe.uniforms;return Ge},acquireProgram:function(Oe,ke){let Ge;for(let Je=0,Rt=G.length;Je<Rt;Je++){const Et=G[Je];if(Et.cacheKey===ke){Ge=Et,++Ge.usedTimes;break}}return Ge===void 0&&(Ge=new ff(R,ke,Oe,E),G.push(Ge)),Ge},releaseProgram:function(Oe){if(--Oe.usedTimes==0){const ke=G.indexOf(Oe);G[ke]=G[G.length-1],G.pop(),Oe.destroy()}},releaseShaderCache:function(Oe){Q.remove(Oe)},programs:G,dispose:function(){Q.dispose()}}}function oA(){let R=new WeakMap;return{get:function(r){let d=R.get(r);return d===void 0&&(d={},R.set(r,d)),d},remove:function(r){R.delete(r)},update:function(r,d,_){R.get(r)[d]=_},dispose:function(){R=new WeakMap}}}function aA(R,r){return R.groupOrder!==r.groupOrder?R.groupOrder-r.groupOrder:R.renderOrder!==r.renderOrder?R.renderOrder-r.renderOrder:R.material.id!==r.material.id?R.material.id-r.material.id:R.z!==r.z?R.z-r.z:R.id-r.id}function us(R,r){return R.groupOrder!==r.groupOrder?R.groupOrder-r.groupOrder:R.renderOrder!==r.renderOrder?R.renderOrder-r.renderOrder:R.z!==r.z?r.z-R.z:R.id-r.id}function Av(){const R=[];let r=0;const d=[],_=[],A=[];function E(P,k,Q,G,re,xe){let ye=R[r];return ye===void 0?(ye={id:P.id,object:P,geometry:k,material:Q,groupOrder:G,renderOrder:P.renderOrder,z:re,group:xe},R[r]=ye):(ye.id=P.id,ye.object=P,ye.geometry=k,ye.material=Q,ye.groupOrder=G,ye.renderOrder=P.renderOrder,ye.z=re,ye.group=xe),r++,ye}return{opaque:d,transmissive:_,transparent:A,init:function(){r=0,d.length=0,_.length=0,A.length=0},push:function(P,k,Q,G,re,xe){const ye=E(P,k,Q,G,re,xe);Q.transmission>0?_.push(ye):Q.transparent===!0?A.push(ye):d.push(ye)},unshift:function(P,k,Q,G,re,xe){const ye=E(P,k,Q,G,re,xe);Q.transmission>0?_.unshift(ye):Q.transparent===!0?A.unshift(ye):d.unshift(ye)},finish:function(){for(let P=r,k=R.length;P<k;P++){const Q=R[P];if(Q.id===null)break;Q.id=null,Q.object=null,Q.geometry=null,Q.material=null,Q.group=null}},sort:function(P,k){d.length>1&&d.sort(P||aA),_.length>1&&_.sort(k||us),A.length>1&&A.sort(k||us)}}}function bv(){let R=new WeakMap;return{get:function(r,d){const _=R.get(r);let A;return _===void 0?(A=new Av,R.set(r,[A])):d>=_.length?(A=new Av,_.push(A)):A=_[d],A},dispose:function(){R=new WeakMap}}}function Ll(){const R={};return{get:function(r){if(R[r.id]!==void 0)return R[r.id];let d;switch(r.type){case"DirectionalLight":d={direction:new zt,color:new Fi};break;case"SpotLight":d={position:new zt,direction:new zt,color:new Fi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":d={position:new zt,color:new Fi,distance:0,decay:0};break;case"HemisphereLight":d={direction:new zt,skyColor:new Fi,groundColor:new Fi};break;case"RectAreaLight":d={color:new Fi,position:new zt,halfWidth:new zt,halfHeight:new zt}}return R[r.id]=d,d}}}let Mb=0;function lA(R,r){return(r.castShadow?2:0)-(R.castShadow?2:0)+(r.map?1:0)-(R.map?1:0)}function yp(R,r){const d=new Ll,_=function(){const Q={};return{get:function(G){if(Q[G.id]!==void 0)return Q[G.id];let re;switch(G.type){case"DirectionalLight":case"SpotLight":re={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li};break;case"PointLight":re={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new li,shadowCameraNear:1,shadowCameraFar:1e3}}return Q[G.id]=re,re}}}(),A={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let Q=0;Q<9;Q++)A.probe.push(new zt);const E=new zt,P=new Gr,k=new Gr;return{setup:function(Q,G){let re=0,xe=0,ye=0;for(let b=0;b<9;b++)A.probe[b].set(0,0,0);let Ee=0,Ie=0,Ue=0,Oe=0,ke=0,Ge=0,Je=0,Rt=0,Et=0,xt=0;Q.sort(lA);const Zt=G===!0?Math.PI:1;for(let b=0,D=Q.length;b<D;b++){const L=Q[b],Y=L.color,ne=L.intensity,be=L.distance,Me=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)re+=Y.r*ne*Zt,xe+=Y.g*ne*Zt,ye+=Y.b*ne*Zt;else if(L.isLightProbe)for(let De=0;De<9;De++)A.probe[De].addScaledVector(L.sh.coefficients[De],ne);else if(L.isDirectionalLight){const De=d.get(L);if(De.color.copy(L.color).multiplyScalar(L.intensity*Zt),L.castShadow){const je=L.shadow,st=_.get(L);st.shadowBias=je.bias,st.shadowNormalBias=je.normalBias,st.shadowRadius=je.radius,st.shadowMapSize=je.mapSize,A.directionalShadow[Ee]=st,A.directionalShadowMap[Ee]=Me,A.directionalShadowMatrix[Ee]=L.shadow.matrix,Ge++}A.directional[Ee]=De,Ee++}else if(L.isSpotLight){const De=d.get(L);De.position.setFromMatrixPosition(L.matrixWorld),De.color.copy(Y).multiplyScalar(ne*Zt),De.distance=be,De.coneCos=Math.cos(L.angle),De.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),De.decay=L.decay,A.spot[Ue]=De;const je=L.shadow;if(L.map&&(A.spotLightMap[Et]=L.map,Et++,je.updateMatrices(L),L.castShadow&&xt++),A.spotLightMatrix[Ue]=je.matrix,L.castShadow){const st=_.get(L);st.shadowBias=je.bias,st.shadowNormalBias=je.normalBias,st.shadowRadius=je.radius,st.shadowMapSize=je.mapSize,A.spotShadow[Ue]=st,A.spotShadowMap[Ue]=Me,Rt++}Ue++}else if(L.isRectAreaLight){const De=d.get(L);De.color.copy(Y).multiplyScalar(ne),De.halfWidth.set(.5*L.width,0,0),De.halfHeight.set(0,.5*L.height,0),A.rectArea[Oe]=De,Oe++}else if(L.isPointLight){const De=d.get(L);if(De.color.copy(L.color).multiplyScalar(L.intensity*Zt),De.distance=L.distance,De.decay=L.decay,L.castShadow){const je=L.shadow,st=_.get(L);st.shadowBias=je.bias,st.shadowNormalBias=je.normalBias,st.shadowRadius=je.radius,st.shadowMapSize=je.mapSize,st.shadowCameraNear=je.camera.near,st.shadowCameraFar=je.camera.far,A.pointShadow[Ie]=st,A.pointShadowMap[Ie]=Me,A.pointShadowMatrix[Ie]=L.shadow.matrix,Je++}A.point[Ie]=De,Ie++}else if(L.isHemisphereLight){const De=d.get(L);De.skyColor.copy(L.color).multiplyScalar(ne*Zt),De.groundColor.copy(L.groundColor).multiplyScalar(ne*Zt),A.hemi[ke]=De,ke++}}Oe>0&&(r.isWebGL2||R.has("OES_texture_float_linear")===!0?(A.rectAreaLTC1=Vi.LTC_FLOAT_1,A.rectAreaLTC2=Vi.LTC_FLOAT_2):R.has("OES_texture_half_float_linear")===!0?(A.rectAreaLTC1=Vi.LTC_HALF_1,A.rectAreaLTC2=Vi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),A.ambient[0]=re,A.ambient[1]=xe,A.ambient[2]=ye;const g=A.hash;g.directionalLength===Ee&&g.pointLength===Ie&&g.spotLength===Ue&&g.rectAreaLength===Oe&&g.hemiLength===ke&&g.numDirectionalShadows===Ge&&g.numPointShadows===Je&&g.numSpotShadows===Rt&&g.numSpotMaps===Et||(A.directional.length=Ee,A.spot.length=Ue,A.rectArea.length=Oe,A.point.length=Ie,A.hemi.length=ke,A.directionalShadow.length=Ge,A.directionalShadowMap.length=Ge,A.pointShadow.length=Je,A.pointShadowMap.length=Je,A.spotShadow.length=Rt,A.spotShadowMap.length=Rt,A.directionalShadowMatrix.length=Ge,A.pointShadowMatrix.length=Je,A.spotLightMatrix.length=Rt+Et-xt,A.spotLightMap.length=Et,A.numSpotLightShadowsWithMaps=xt,g.directionalLength=Ee,g.pointLength=Ie,g.spotLength=Ue,g.rectAreaLength=Oe,g.hemiLength=ke,g.numDirectionalShadows=Ge,g.numPointShadows=Je,g.numSpotShadows=Rt,g.numSpotMaps=Et,A.version=Mb++)},setupView:function(Q,G){let re=0,xe=0,ye=0,Ee=0,Ie=0;const Ue=G.matrixWorldInverse;for(let Oe=0,ke=Q.length;Oe<ke;Oe++){const Ge=Q[Oe];if(Ge.isDirectionalLight){const Je=A.directional[re];Je.direction.setFromMatrixPosition(Ge.matrixWorld),E.setFromMatrixPosition(Ge.target.matrixWorld),Je.direction.sub(E),Je.direction.transformDirection(Ue),re++}else if(Ge.isSpotLight){const Je=A.spot[ye];Je.position.setFromMatrixPosition(Ge.matrixWorld),Je.position.applyMatrix4(Ue),Je.direction.setFromMatrixPosition(Ge.matrixWorld),E.setFromMatrixPosition(Ge.target.matrixWorld),Je.direction.sub(E),Je.direction.transformDirection(Ue),ye++}else if(Ge.isRectAreaLight){const Je=A.rectArea[Ee];Je.position.setFromMatrixPosition(Ge.matrixWorld),Je.position.applyMatrix4(Ue),k.identity(),P.copy(Ge.matrixWorld),P.premultiply(Ue),k.extractRotation(P),Je.halfWidth.set(.5*Ge.width,0,0),Je.halfHeight.set(0,.5*Ge.height,0),Je.halfWidth.applyMatrix4(k),Je.halfHeight.applyMatrix4(k),Ee++}else if(Ge.isPointLight){const Je=A.point[xe];Je.position.setFromMatrixPosition(Ge.matrixWorld),Je.position.applyMatrix4(Ue),xe++}else if(Ge.isHemisphereLight){const Je=A.hemi[Ie];Je.direction.setFromMatrixPosition(Ge.matrixWorld),Je.direction.transformDirection(Ue),Ie++}}},state:A}}function La(R,r){const d=new yp(R,r),_=[],A=[];return{init:function(){_.length=0,A.length=0},state:{lightsArray:_,shadowsArray:A,lights:d},setupLights:function(E){d.setup(_,E)},setupLightsView:function(E){d.setupView(_,E)},pushLight:function(E){_.push(E)},pushShadow:function(E){A.push(E)}}}function Ws(R,r){let d=new WeakMap;return{get:function(_,A=0){const E=d.get(_);let P;return E===void 0?(P=new La(R,r),d.set(_,[P])):A>=E.length?(P=new La(R,r),E.push(P)):P=E[A],P},dispose:function(){d=new WeakMap}}}class U0 extends da{constructor(r){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=rr,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(r)}copy(r){return super.copy(r),this.depthPacking=r.depthPacking,this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this}}class xv extends da{constructor(r){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(r)}copy(r){return super.copy(r),this.map=r.map,this.alphaMap=r.alphaMap,this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this}}const Hg=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,wv=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function fm(R,r,d){let _=new cv;const A=new li,E=new li,P=new Vr,k=new U0({depthPacking:oo}),Q=new xv,G={},re=d.maxTextureSize,xe={[se]:ve,[ve]:se,[ce]:ce},ye=new Su({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new li},radius:{value:4}},vertexShader:Hg,fragmentShader:wv}),Ee=ye.clone();Ee.defines.HORIZONTAL_PASS=1;const Ie=new Fe;Ie.setAttribute("position",new Ns(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Ue=new Ko(Ie,ye),Oe=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Z;let ke=this.type;function Ge(Et,xt){const Zt=r.update(Ue);ye.defines.VSM_SAMPLES!==Et.blurSamples&&(ye.defines.VSM_SAMPLES=Et.blurSamples,Ee.defines.VSM_SAMPLES=Et.blurSamples,ye.needsUpdate=!0,Ee.needsUpdate=!0),Et.mapPass===null&&(Et.mapPass=new va(A.x,A.y)),ye.uniforms.shadow_pass.value=Et.map.texture,ye.uniforms.resolution.value=Et.mapSize,ye.uniforms.radius.value=Et.radius,R.setRenderTarget(Et.mapPass),R.clear(),R.renderBufferDirect(xt,null,Zt,ye,Ue,null),Ee.uniforms.shadow_pass.value=Et.mapPass.texture,Ee.uniforms.resolution.value=Et.mapSize,Ee.uniforms.radius.value=Et.radius,R.setRenderTarget(Et.map),R.clear(),R.renderBufferDirect(xt,null,Zt,Ee,Ue,null)}function Je(Et,xt,Zt,g){let b=null;const D=Zt.isPointLight===!0?Et.customDistanceMaterial:Et.customDepthMaterial;if(D!==void 0)b=D;else if(b=Zt.isPointLight===!0?Q:k,R.localClippingEnabled&&xt.clipShadows===!0&&Array.isArray(xt.clippingPlanes)&&xt.clippingPlanes.length!==0||xt.displacementMap&&xt.displacementScale!==0||xt.alphaMap&&xt.alphaTest>0||xt.map&&xt.alphaTest>0){const L=b.uuid,Y=xt.uuid;let ne=G[L];ne===void 0&&(ne={},G[L]=ne);let be=ne[Y];be===void 0&&(be=b.clone(),ne[Y]=be),b=be}return b.visible=xt.visible,b.wireframe=xt.wireframe,b.side=g===le?xt.shadowSide!==null?xt.shadowSide:xt.side:xt.shadowSide!==null?xt.shadowSide:xe[xt.side],b.alphaMap=xt.alphaMap,b.alphaTest=xt.alphaTest,b.map=xt.map,b.clipShadows=xt.clipShadows,b.clippingPlanes=xt.clippingPlanes,b.clipIntersection=xt.clipIntersection,b.displacementMap=xt.displacementMap,b.displacementScale=xt.displacementScale,b.displacementBias=xt.displacementBias,b.wireframeLinewidth=xt.wireframeLinewidth,b.linewidth=xt.linewidth,Zt.isPointLight===!0&&b.isMeshDistanceMaterial===!0&&(R.properties.get(b).light=Zt),b}function Rt(Et,xt,Zt,g,b){if(Et.visible===!1)return;if(Et.layers.test(xt.layers)&&(Et.isMesh||Et.isLine||Et.isPoints)&&(Et.castShadow||Et.receiveShadow&&b===le)&&(!Et.frustumCulled||_.intersectsObject(Et))){Et.modelViewMatrix.multiplyMatrices(Zt.matrixWorldInverse,Et.matrixWorld);const L=r.update(Et),Y=Et.material;if(Array.isArray(Y)){const ne=L.groups;for(let be=0,Me=ne.length;be<Me;be++){const De=ne[be],je=Y[De.materialIndex];if(je&&je.visible){const st=Je(Et,je,g,b);R.renderBufferDirect(Zt,null,L,st,Et,De)}}}else if(Y.visible){const ne=Je(Et,Y,g,b);R.renderBufferDirect(Zt,null,L,ne,Et,null)}}const D=Et.children;for(let L=0,Y=D.length;L<Y;L++)Rt(D[L],xt,Zt,g,b)}this.render=function(Et,xt,Zt){if(Oe.enabled===!1||Oe.autoUpdate===!1&&Oe.needsUpdate===!1||Et.length===0)return;const g=R.getRenderTarget(),b=R.getActiveCubeFace(),D=R.getActiveMipmapLevel(),L=R.state;L.setBlending(X),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const Y=ke!==le&&this.type===le,ne=ke===le&&this.type!==le;for(let be=0,Me=Et.length;be<Me;be++){const De=Et[be],je=De.shadow;if(je===void 0){console.warn("THREE.WebGLShadowMap:",De,"has no shadow.");continue}if(je.autoUpdate===!1&&je.needsUpdate===!1)continue;A.copy(je.mapSize);const st=je.getFrameExtents();if(A.multiply(st),E.copy(je.mapSize),(A.x>re||A.y>re)&&(A.x>re&&(E.x=Math.floor(re/st.x),A.x=E.x*st.x,je.mapSize.x=E.x),A.y>re&&(E.y=Math.floor(re/st.y),A.y=E.y*st.y,je.mapSize.y=E.y)),je.map===null||Y===!0||ne===!0){const ot=this.type!==le?{minFilter:nn,magFilter:nn}:{};je.map!==null&&je.map.dispose(),je.map=new va(A.x,A.y,ot),je.map.texture.name=De.name+".shadowMap",je.camera.updateProjectionMatrix()}R.setRenderTarget(je.map),R.clear();const nt=je.getViewportCount();for(let ot=0;ot<nt;ot++){const Vt=je.getViewport(ot);P.set(E.x*Vt.x,E.y*Vt.y,E.x*Vt.z,E.y*Vt.w),L.viewport(P),je.updateMatrices(De,ot),_=je.getFrustum(),Rt(xt,Zt,je.camera,De,this.type)}je.isPointLightShadow!==!0&&this.type===le&&Ge(je,Zt),je.needsUpdate=!1}ke=this.type,Oe.needsUpdate=!1,R.setRenderTarget(g,b,D)}}function Ev(R,r,d){const _=d.isWebGL2,A=new function(){let qe=!1;const Ct=new Vr;let Dt=null;const hn=new Vr(0,0,0,0);return{setMask:function(Kt){Dt===Kt||qe||(R.colorMask(Kt,Kt,Kt,Kt),Dt=Kt)},setLocked:function(Kt){qe=Kt},setClear:function(Kt,yn,ii,Ui,Bi){Bi===!0&&(Kt*=Ui,yn*=Ui,ii*=Ui),Ct.set(Kt,yn,ii,Ui),hn.equals(Ct)===!1&&(R.clearColor(Kt,yn,ii,Ui),hn.copy(Ct))},reset:function(){qe=!1,Dt=null,hn.set(-1,0,0,0)}}},E=new function(){let qe=!1,Ct=null,Dt=null,hn=null;return{setTest:function(Kt){Kt?Yt(R.DEPTH_TEST):ln(R.DEPTH_TEST)},setMask:function(Kt){Ct===Kt||qe||(R.depthMask(Kt),Ct=Kt)},setFunc:function(Kt){if(Dt!==Kt){switch(Kt){case Qt:R.depthFunc(R.NEVER);break;case Qe:R.depthFunc(R.ALWAYS);break;case ft:R.depthFunc(R.LESS);break;case bt:R.depthFunc(R.LEQUAL);break;case sn:R.depthFunc(R.EQUAL);break;case bn:R.depthFunc(R.GEQUAL);break;case Un:R.depthFunc(R.GREATER);break;case pi:R.depthFunc(R.NOTEQUAL);break;default:R.depthFunc(R.LEQUAL)}Dt=Kt}},setLocked:function(Kt){qe=Kt},setClear:function(Kt){hn!==Kt&&(R.clearDepth(Kt),hn=Kt)},reset:function(){qe=!1,Ct=null,Dt=null,hn=null}}},P=new function(){let qe=!1,Ct=null,Dt=null,hn=null,Kt=null,yn=null,ii=null,Ui=null,Bi=null;return{setTest:function(ci){qe||(ci?Yt(R.STENCIL_TEST):ln(R.STENCIL_TEST))},setMask:function(ci){Ct===ci||qe||(R.stencilMask(ci),Ct=ci)},setFunc:function(ci,Ii,$i){Dt===ci&&hn===Ii&&Kt===$i||(R.stencilFunc(ci,Ii,$i),Dt=ci,hn=Ii,Kt=$i)},setOp:function(ci,Ii,$i){yn===ci&&ii===Ii&&Ui===$i||(R.stencilOp(ci,Ii,$i),yn=ci,ii=Ii,Ui=$i)},setLocked:function(ci){qe=ci},setClear:function(ci){Bi!==ci&&(R.clearStencil(ci),Bi=ci)},reset:function(){qe=!1,Ct=null,Dt=null,hn=null,Kt=null,yn=null,ii=null,Ui=null,Bi=null}}},k=new WeakMap,Q=new WeakMap;let G={},re={},xe=new WeakMap,ye=[],Ee=null,Ie=!1,Ue=null,Oe=null,ke=null,Ge=null,Je=null,Rt=null,Et=null,xt=!1,Zt=null,g=null,b=null,D=null,L=null;const Y=R.getParameter(R.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ne=!1,be=0;const Me=R.getParameter(R.VERSION);Me.indexOf("WebGL")!==-1?(be=parseFloat(/^WebGL (\d)/.exec(Me)[1]),ne=be>=1):Me.indexOf("OpenGL ES")!==-1&&(be=parseFloat(/^OpenGL ES (\d)/.exec(Me)[1]),ne=be>=2);let De=null,je={};const st=R.getParameter(R.SCISSOR_BOX),nt=R.getParameter(R.VIEWPORT),ot=new Vr().fromArray(st),Vt=new Vr().fromArray(nt);function Jt(qe,Ct,Dt,hn){const Kt=new Uint8Array(4),yn=R.createTexture();R.bindTexture(qe,yn),R.texParameteri(qe,R.TEXTURE_MIN_FILTER,R.NEAREST),R.texParameteri(qe,R.TEXTURE_MAG_FILTER,R.NEAREST);for(let ii=0;ii<Dt;ii++)!_||qe!==R.TEXTURE_3D&&qe!==R.TEXTURE_2D_ARRAY?R.texImage2D(Ct+ii,0,R.RGBA,1,1,0,R.RGBA,R.UNSIGNED_BYTE,Kt):R.texImage3D(Ct,0,R.RGBA,1,1,hn,0,R.RGBA,R.UNSIGNED_BYTE,Kt);return yn}const en={};function Yt(qe){G[qe]!==!0&&(R.enable(qe),G[qe]=!0)}function ln(qe){G[qe]!==!1&&(R.disable(qe),G[qe]=!1)}en[R.TEXTURE_2D]=Jt(R.TEXTURE_2D,R.TEXTURE_2D,1),en[R.TEXTURE_CUBE_MAP]=Jt(R.TEXTURE_CUBE_MAP,R.TEXTURE_CUBE_MAP_POSITIVE_X,6),_&&(en[R.TEXTURE_2D_ARRAY]=Jt(R.TEXTURE_2D_ARRAY,R.TEXTURE_2D_ARRAY,1,1),en[R.TEXTURE_3D]=Jt(R.TEXTURE_3D,R.TEXTURE_3D,1,1)),A.setClear(0,0,0,1),E.setClear(1),P.setClear(0),Yt(R.DEPTH_TEST),E.setFunc(bt),Ut(!1),yt(B),Yt(R.CULL_FACE),Gt(X);const et={[$]:R.FUNC_ADD,[ae]:R.FUNC_SUBTRACT,[Re]:R.FUNC_REVERSE_SUBTRACT};if(_)et[pe]=R.MIN,et[he]=R.MAX;else{const qe=r.get("EXT_blend_minmax");qe!==null&&(et[pe]=qe.MIN_EXT,et[he]=qe.MAX_EXT)}const $e={[we]:R.ZERO,[Ce]:R.ONE,[Ne]:R.SRC_COLOR,[Ye]:R.SRC_ALPHA,[Nt]:R.SRC_ALPHA_SATURATE,[vt]:R.DST_COLOR,[_t]:R.DST_ALPHA,[Ze]:R.ONE_MINUS_SRC_COLOR,[it]:R.ONE_MINUS_SRC_ALPHA,[ut]:R.ONE_MINUS_DST_COLOR,[At]:R.ONE_MINUS_DST_ALPHA};function Gt(qe,Ct,Dt,hn,Kt,yn,ii,Ui){if(qe!==X){if(Ie===!1&&(Yt(R.BLEND),Ie=!0),qe===ee)Kt=Kt||Ct,yn=yn||Dt,ii=ii||hn,Ct===Oe&&Kt===Je||(R.blendEquationSeparate(et[Ct],et[Kt]),Oe=Ct,Je=Kt),Dt===ke&&hn===Ge&&yn===Rt&&ii===Et||(R.blendFuncSeparate($e[Dt],$e[hn],$e[yn],$e[ii]),ke=Dt,Ge=hn,Rt=yn,Et=ii),Ue=qe,xt=!1;else if(qe!==Ue||Ui!==xt){if(Oe===$&&Je===$||(R.blendEquation(R.FUNC_ADD),Oe=$,Je=$),Ui)switch(qe){case W:R.blendFuncSeparate(R.ONE,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA);break;case _e:R.blendFunc(R.ONE,R.ONE);break;case ge:R.blendFuncSeparate(R.ZERO,R.ONE_MINUS_SRC_COLOR,R.ZERO,R.ONE);break;case Ae:R.blendFuncSeparate(R.ZERO,R.SRC_COLOR,R.ZERO,R.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",qe)}else switch(qe){case W:R.blendFuncSeparate(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA);break;case _e:R.blendFunc(R.SRC_ALPHA,R.ONE);break;case ge:R.blendFuncSeparate(R.ZERO,R.ONE_MINUS_SRC_COLOR,R.ZERO,R.ONE);break;case Ae:R.blendFunc(R.ZERO,R.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",qe)}ke=null,Ge=null,Rt=null,Et=null,Ue=qe,xt=Ui}}else Ie===!0&&(ln(R.BLEND),Ie=!1)}function Ut(qe){Zt!==qe&&(qe?R.frontFace(R.CW):R.frontFace(R.CCW),Zt=qe)}function yt(qe){qe!==I?(Yt(R.CULL_FACE),qe!==g&&(qe===B?R.cullFace(R.BACK):qe===U?R.cullFace(R.FRONT):R.cullFace(R.FRONT_AND_BACK))):ln(R.CULL_FACE),g=qe}function wt(qe,Ct,Dt){qe?(Yt(R.POLYGON_OFFSET_FILL),D===Ct&&L===Dt||(R.polygonOffset(Ct,Dt),D=Ct,L=Dt)):ln(R.POLYGON_OFFSET_FILL)}return{buffers:{color:A,depth:E,stencil:P},enable:Yt,disable:ln,bindFramebuffer:function(qe,Ct){return re[qe]!==Ct&&(R.bindFramebuffer(qe,Ct),re[qe]=Ct,_&&(qe===R.DRAW_FRAMEBUFFER&&(re[R.FRAMEBUFFER]=Ct),qe===R.FRAMEBUFFER&&(re[R.DRAW_FRAMEBUFFER]=Ct)),!0)},drawBuffers:function(qe,Ct){let Dt=ye,hn=!1;if(qe)if(Dt=xe.get(Ct),Dt===void 0&&(Dt=[],xe.set(Ct,Dt)),qe.isWebGLMultipleRenderTargets){const Kt=qe.texture;if(Dt.length!==Kt.length||Dt[0]!==R.COLOR_ATTACHMENT0){for(let yn=0,ii=Kt.length;yn<ii;yn++)Dt[yn]=R.COLOR_ATTACHMENT0+yn;Dt.length=Kt.length,hn=!0}}else Dt[0]!==R.COLOR_ATTACHMENT0&&(Dt[0]=R.COLOR_ATTACHMENT0,hn=!0);else Dt[0]!==R.BACK&&(Dt[0]=R.BACK,hn=!0);hn&&(d.isWebGL2?R.drawBuffers(Dt):r.get("WEBGL_draw_buffers").drawBuffersWEBGL(Dt))},useProgram:function(qe){return Ee!==qe&&(R.useProgram(qe),Ee=qe,!0)},setBlending:Gt,setMaterial:function(qe,Ct){qe.side===ce?ln(R.CULL_FACE):Yt(R.CULL_FACE);let Dt=qe.side===ve;Ct&&(Dt=!Dt),Ut(Dt),qe.blending===W&&qe.transparent===!1?Gt(X):Gt(qe.blending,qe.blendEquation,qe.blendSrc,qe.blendDst,qe.blendEquationAlpha,qe.blendSrcAlpha,qe.blendDstAlpha,qe.premultipliedAlpha),E.setFunc(qe.depthFunc),E.setTest(qe.depthTest),E.setMask(qe.depthWrite),A.setMask(qe.colorWrite);const hn=qe.stencilWrite;P.setTest(hn),hn&&(P.setMask(qe.stencilWriteMask),P.setFunc(qe.stencilFunc,qe.stencilRef,qe.stencilFuncMask),P.setOp(qe.stencilFail,qe.stencilZFail,qe.stencilZPass)),wt(qe.polygonOffset,qe.polygonOffsetFactor,qe.polygonOffsetUnits),qe.alphaToCoverage===!0?Yt(R.SAMPLE_ALPHA_TO_COVERAGE):ln(R.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ut,setCullFace:yt,setLineWidth:function(qe){qe!==b&&(ne&&R.lineWidth(qe),b=qe)},setPolygonOffset:wt,setScissorTest:function(qe){qe?Yt(R.SCISSOR_TEST):ln(R.SCISSOR_TEST)},activeTexture:function(qe){qe===void 0&&(qe=R.TEXTURE0+Y-1),De!==qe&&(R.activeTexture(qe),De=qe)},bindTexture:function(qe,Ct,Dt){Dt===void 0&&(Dt=De===null?R.TEXTURE0+Y-1:De);let hn=je[Dt];hn===void 0&&(hn={type:void 0,texture:void 0},je[Dt]=hn),hn.type===qe&&hn.texture===Ct||(De!==Dt&&(R.activeTexture(Dt),De=Dt),R.bindTexture(qe,Ct||en[qe]),hn.type=qe,hn.texture=Ct)},unbindTexture:function(){const qe=je[De];qe!==void 0&&qe.type!==void 0&&(R.bindTexture(qe.type,null),qe.type=void 0,qe.texture=void 0)},compressedTexImage2D:function(){try{R.compressedTexImage2D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},compressedTexImage3D:function(){try{R.compressedTexImage3D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},texImage2D:function(){try{R.texImage2D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},texImage3D:function(){try{R.texImage3D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},updateUBOMapping:function(qe,Ct){let Dt=Q.get(Ct);Dt===void 0&&(Dt=new WeakMap,Q.set(Ct,Dt));let hn=Dt.get(qe);hn===void 0&&(hn=R.getUniformBlockIndex(Ct,qe.name),Dt.set(qe,hn))},uniformBlockBinding:function(qe,Ct){const Dt=Q.get(Ct).get(qe);k.get(Ct)!==Dt&&(R.uniformBlockBinding(Ct,Dt,qe.__bindingPointIndex),k.set(Ct,Dt))},texStorage2D:function(){try{R.texStorage2D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},texStorage3D:function(){try{R.texStorage3D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},texSubImage2D:function(){try{R.texSubImage2D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},texSubImage3D:function(){try{R.texSubImage3D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},compressedTexSubImage2D:function(){try{R.compressedTexSubImage2D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},compressedTexSubImage3D:function(){try{R.compressedTexSubImage3D.apply(R,arguments)}catch(qe){console.error("THREE.WebGLState:",qe)}},scissor:function(qe){ot.equals(qe)===!1&&(R.scissor(qe.x,qe.y,qe.z,qe.w),ot.copy(qe))},viewport:function(qe){Vt.equals(qe)===!1&&(R.viewport(qe.x,qe.y,qe.z,qe.w),Vt.copy(qe))},reset:function(){R.disable(R.BLEND),R.disable(R.CULL_FACE),R.disable(R.DEPTH_TEST),R.disable(R.POLYGON_OFFSET_FILL),R.disable(R.SCISSOR_TEST),R.disable(R.STENCIL_TEST),R.disable(R.SAMPLE_ALPHA_TO_COVERAGE),R.blendEquation(R.FUNC_ADD),R.blendFunc(R.ONE,R.ZERO),R.blendFuncSeparate(R.ONE,R.ZERO,R.ONE,R.ZERO),R.colorMask(!0,!0,!0,!0),R.clearColor(0,0,0,0),R.depthMask(!0),R.depthFunc(R.LESS),R.clearDepth(1),R.stencilMask(4294967295),R.stencilFunc(R.ALWAYS,0,4294967295),R.stencilOp(R.KEEP,R.KEEP,R.KEEP),R.clearStencil(0),R.cullFace(R.BACK),R.frontFace(R.CCW),R.polygonOffset(0,0),R.activeTexture(R.TEXTURE0),R.bindFramebuffer(R.FRAMEBUFFER,null),_===!0&&(R.bindFramebuffer(R.DRAW_FRAMEBUFFER,null),R.bindFramebuffer(R.READ_FRAMEBUFFER,null)),R.useProgram(null),R.lineWidth(1),R.scissor(0,0,R.canvas.width,R.canvas.height),R.viewport(0,0,R.canvas.width,R.canvas.height),G={},De=null,je={},re={},xe=new WeakMap,ye=[],Ee=null,Ie=!1,Ue=null,Oe=null,ke=null,Ge=null,Je=null,Rt=null,Et=null,xt=!1,Zt=null,g=null,b=null,D=null,L=null,ot.set(0,0,R.canvas.width,R.canvas.height),Vt.set(0,0,R.canvas.width,R.canvas.height),A.reset(),E.reset(),P.reset()}}}function Tu(R,r,d,_,A,E,P){const k=A.isWebGL2,Q=A.maxTextures,G=A.maxCubemapSize,re=A.maxTextureSize,xe=A.maxSamples,ye=r.has("WEBGL_multisampled_render_to_texture")?r.get("WEBGL_multisampled_render_to_texture"):null,Ee=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),Ie=new WeakMap;let Ue;const Oe=new WeakMap;let ke=!1;try{ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Ge(et,$e){return ke?new OffscreenCanvas(et,$e):hc("canvas")}function Je(et,$e,Gt,Ut){let yt=1;if((et.width>Ut||et.height>Ut)&&(yt=Ut/Math.max(et.width,et.height)),yt<1||$e===!0){if(typeof HTMLImageElement<"u"&&et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&et instanceof ImageBitmap){const wt=$e?qo:Math.floor,qe=wt(yt*et.width),Ct=wt(yt*et.height);Ue===void 0&&(Ue=Ge(qe,Ct));const Dt=Gt?Ge(qe,Ct):Ue;return Dt.width=qe,Dt.height=Ct,Dt.getContext("2d").drawImage(et,0,0,qe,Ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+et.width+"x"+et.height+") to ("+qe+"x"+Ct+")."),Dt}return"data"in et&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+et.width+"x"+et.height+")."),et}return et}function Rt(et){return Wu(et.width)&&Wu(et.height)}function Et(et,$e){return et.generateMipmaps&&$e&&et.minFilter!==nn&&et.minFilter!==Nn}function xt(et){R.generateMipmap(et)}function Zt(et,$e,Gt,Ut,yt=!1){if(k===!1)return $e;if(et!==null){if(R[et]!==void 0)return R[et];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+et+"'")}let wt=$e;return $e===R.RED&&(Gt===R.FLOAT&&(wt=R.R32F),Gt===R.HALF_FLOAT&&(wt=R.R16F),Gt===R.UNSIGNED_BYTE&&(wt=R.R8)),$e===R.RG&&(Gt===R.FLOAT&&(wt=R.RG32F),Gt===R.HALF_FLOAT&&(wt=R.RG16F),Gt===R.UNSIGNED_BYTE&&(wt=R.RG8)),$e===R.RGBA&&(Gt===R.FLOAT&&(wt=R.RGBA32F),Gt===R.HALF_FLOAT&&(wt=R.RGBA16F),Gt===R.UNSIGNED_BYTE&&(wt=Ut===xr&&yt===!1?R.SRGB8_ALPHA8:R.RGBA8),Gt===R.UNSIGNED_SHORT_4_4_4_4&&(wt=R.RGBA4),Gt===R.UNSIGNED_SHORT_5_5_5_1&&(wt=R.RGB5_A1)),wt!==R.R16F&&wt!==R.R32F&&wt!==R.RG16F&&wt!==R.RG32F&&wt!==R.RGBA16F&&wt!==R.RGBA32F||r.get("EXT_color_buffer_float"),wt}function g(et,$e,Gt){return Et(et,Gt)===!0||et.isFramebufferTexture&&et.minFilter!==nn&&et.minFilter!==Nn?Math.log2(Math.max($e.width,$e.height))+1:et.mipmaps!==void 0&&et.mipmaps.length>0?et.mipmaps.length:et.isCompressedTexture&&Array.isArray(et.image)?$e.mipmaps.length:1}function b(et){return et===nn||et===Ht||et===Ln?R.NEAREST:R.LINEAR}function D(et){const $e=et.target;$e.removeEventListener("dispose",D),function(Gt){const Ut=_.get(Gt);if(Ut.__webglInit===void 0)return;const yt=Gt.source,wt=Oe.get(yt);if(wt){const qe=wt[Ut.__cacheKey];qe.usedTimes--,qe.usedTimes===0&&Y(Gt),Object.keys(wt).length===0&&Oe.delete(yt)}_.remove(Gt)}($e),$e.isVideoTexture&&Ie.delete($e)}function L(et){const $e=et.target;$e.removeEventListener("dispose",L),function(Gt){const Ut=Gt.texture,yt=_.get(Gt),wt=_.get(Ut);if(wt.__webglTexture!==void 0&&(R.deleteTexture(wt.__webglTexture),P.memory.textures--),Gt.depthTexture&&Gt.depthTexture.dispose(),Gt.isWebGLCubeRenderTarget)for(let qe=0;qe<6;qe++)R.deleteFramebuffer(yt.__webglFramebuffer[qe]),yt.__webglDepthbuffer&&R.deleteRenderbuffer(yt.__webglDepthbuffer[qe]);else{if(R.deleteFramebuffer(yt.__webglFramebuffer),yt.__webglDepthbuffer&&R.deleteRenderbuffer(yt.__webglDepthbuffer),yt.__webglMultisampledFramebuffer&&R.deleteFramebuffer(yt.__webglMultisampledFramebuffer),yt.__webglColorRenderbuffer)for(let qe=0;qe<yt.__webglColorRenderbuffer.length;qe++)yt.__webglColorRenderbuffer[qe]&&R.deleteRenderbuffer(yt.__webglColorRenderbuffer[qe]);yt.__webglDepthRenderbuffer&&R.deleteRenderbuffer(yt.__webglDepthRenderbuffer)}if(Gt.isWebGLMultipleRenderTargets)for(let qe=0,Ct=Ut.length;qe<Ct;qe++){const Dt=_.get(Ut[qe]);Dt.__webglTexture&&(R.deleteTexture(Dt.__webglTexture),P.memory.textures--),_.remove(Ut[qe])}_.remove(Ut),_.remove(Gt)}($e)}function Y(et){const $e=_.get(et);R.deleteTexture($e.__webglTexture);const Gt=et.source;delete Oe.get(Gt)[$e.__cacheKey],P.memory.textures--}let ne=0;function be(et,$e){const Gt=_.get(et);if(et.isVideoTexture&&function(Ut){const yt=P.render.frame;Ie.get(Ut)!==yt&&(Ie.set(Ut,yt),Ut.update())}(et),et.isRenderTargetTexture===!1&&et.version>0&&Gt.__version!==et.version){const Ut=et.image;if(Ut===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Ut.complete!==!1)return void nt(Gt,et,$e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}d.bindTexture(R.TEXTURE_2D,Gt.__webglTexture,R.TEXTURE0+$e)}const Me={[pt]:R.REPEAT,[It]:R.CLAMP_TO_EDGE,[$t]:R.MIRRORED_REPEAT},De={[nn]:R.NEAREST,[Ht]:R.NEAREST_MIPMAP_NEAREST,[Ln]:R.NEAREST_MIPMAP_LINEAR,[Nn]:R.LINEAR,[Zn]:R.LINEAR_MIPMAP_NEAREST,[Mr]:R.LINEAR_MIPMAP_LINEAR};function je(et,$e,Gt){if(Gt?(R.texParameteri(et,R.TEXTURE_WRAP_S,Me[$e.wrapS]),R.texParameteri(et,R.TEXTURE_WRAP_T,Me[$e.wrapT]),et!==R.TEXTURE_3D&&et!==R.TEXTURE_2D_ARRAY||R.texParameteri(et,R.TEXTURE_WRAP_R,Me[$e.wrapR]),R.texParameteri(et,R.TEXTURE_MAG_FILTER,De[$e.magFilter]),R.texParameteri(et,R.TEXTURE_MIN_FILTER,De[$e.minFilter])):(R.texParameteri(et,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(et,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),et!==R.TEXTURE_3D&&et!==R.TEXTURE_2D_ARRAY||R.texParameteri(et,R.TEXTURE_WRAP_R,R.CLAMP_TO_EDGE),$e.wrapS===It&&$e.wrapT===It||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),R.texParameteri(et,R.TEXTURE_MAG_FILTER,b($e.magFilter)),R.texParameteri(et,R.TEXTURE_MIN_FILTER,b($e.minFilter)),$e.minFilter!==nn&&$e.minFilter!==Nn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),r.has("EXT_texture_filter_anisotropic")===!0){const Ut=r.get("EXT_texture_filter_anisotropic");if($e.magFilter===nn||$e.minFilter!==Ln&&$e.minFilter!==Mr||$e.type===jr&&r.has("OES_texture_float_linear")===!1||k===!1&&$e.type===Xr&&r.has("OES_texture_half_float_linear")===!1)return;($e.anisotropy>1||_.get($e).__currentAnisotropy)&&(R.texParameterf(et,Ut.TEXTURE_MAX_ANISOTROPY_EXT,Math.min($e.anisotropy,A.getMaxAnisotropy())),_.get($e).__currentAnisotropy=$e.anisotropy)}}function st(et,$e){let Gt=!1;et.__webglInit===void 0&&(et.__webglInit=!0,$e.addEventListener("dispose",D));const Ut=$e.source;let yt=Oe.get(Ut);yt===void 0&&(yt={},Oe.set(Ut,yt));const wt=function(qe){const Ct=[];return Ct.push(qe.wrapS),Ct.push(qe.wrapT),Ct.push(qe.wrapR||0),Ct.push(qe.magFilter),Ct.push(qe.minFilter),Ct.push(qe.anisotropy),Ct.push(qe.internalFormat),Ct.push(qe.format),Ct.push(qe.type),Ct.push(qe.generateMipmaps),Ct.push(qe.premultiplyAlpha),Ct.push(qe.flipY),Ct.push(qe.unpackAlignment),Ct.push(qe.colorSpace),Ct.join()}($e);if(wt!==et.__cacheKey){yt[wt]===void 0&&(yt[wt]={texture:R.createTexture(),usedTimes:0},P.memory.textures++,Gt=!0),yt[wt].usedTimes++;const qe=yt[et.__cacheKey];qe!==void 0&&(yt[et.__cacheKey].usedTimes--,qe.usedTimes===0&&Y($e)),et.__cacheKey=wt,et.__webglTexture=yt[wt].texture}return Gt}function nt(et,$e,Gt){let Ut=R.TEXTURE_2D;($e.isDataArrayTexture||$e.isCompressedArrayTexture)&&(Ut=R.TEXTURE_2D_ARRAY),$e.isData3DTexture&&(Ut=R.TEXTURE_3D);const yt=st(et,$e),wt=$e.source;d.bindTexture(Ut,et.__webglTexture,R.TEXTURE0+Gt);const qe=_.get(wt);if(wt.version!==qe.__version||yt===!0){d.activeTexture(R.TEXTURE0+Gt),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,$e.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$e.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,$e.unpackAlignment),R.pixelStorei(R.UNPACK_COLORSPACE_CONVERSION_WEBGL,R.NONE);const Ct=function(sr){return!k&&(sr.wrapS!==It||sr.wrapT!==It||sr.minFilter!==nn&&sr.minFilter!==Nn)}($e)&&Rt($e.image)===!1;let Dt=Je($e.image,Ct,!1,re);Dt=ln($e,Dt);const hn=Rt(Dt)||k,Kt=E.convert($e.format,$e.colorSpace);let yn,ii=E.convert($e.type),Ui=Zt($e.internalFormat,Kt,ii,$e.colorSpace);je(Ut,$e,hn);const Bi=$e.mipmaps,ci=k&&$e.isVideoTexture!==!0,Ii=qe.__version===void 0||yt===!0,$i=g($e,Dt,hn);if($e.isDepthTexture)Ui=R.DEPTH_COMPONENT,k?Ui=$e.type===jr?R.DEPTH_COMPONENT32F:$e.type===is?R.DEPTH_COMPONENT24:$e.type===Zr?R.DEPTH24_STENCIL8:R.DEPTH_COMPONENT16:$e.type===jr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),$e.format===Oo&&Ui===R.DEPTH_COMPONENT&&$e.type!==di&&$e.type!==is&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),$e.type=is,ii=E.convert($e.type)),$e.format===Bo&&Ui===R.DEPTH_COMPONENT&&(Ui=R.DEPTH_STENCIL,$e.type!==Zr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),$e.type=Zr,ii=E.convert($e.type))),Ii&&(ci?d.texStorage2D(R.TEXTURE_2D,1,Ui,Dt.width,Dt.height):d.texImage2D(R.TEXTURE_2D,0,Ui,Dt.width,Dt.height,0,Kt,ii,null));else if($e.isDataTexture)if(Bi.length>0&&hn){ci&&Ii&&d.texStorage2D(R.TEXTURE_2D,$i,Ui,Bi[0].width,Bi[0].height);for(let sr=0,xs=Bi.length;sr<xs;sr++)yn=Bi[sr],ci?d.texSubImage2D(R.TEXTURE_2D,sr,0,0,yn.width,yn.height,Kt,ii,yn.data):d.texImage2D(R.TEXTURE_2D,sr,Ui,yn.width,yn.height,0,Kt,ii,yn.data);$e.generateMipmaps=!1}else ci?(Ii&&d.texStorage2D(R.TEXTURE_2D,$i,Ui,Dt.width,Dt.height),d.texSubImage2D(R.TEXTURE_2D,0,0,0,Dt.width,Dt.height,Kt,ii,Dt.data)):d.texImage2D(R.TEXTURE_2D,0,Ui,Dt.width,Dt.height,0,Kt,ii,Dt.data);else if($e.isCompressedTexture)if($e.isCompressedArrayTexture){ci&&Ii&&d.texStorage3D(R.TEXTURE_2D_ARRAY,$i,Ui,Bi[0].width,Bi[0].height,Dt.depth);for(let sr=0,xs=Bi.length;sr<xs;sr++)yn=Bi[sr],$e.format!==uo?Kt!==null?ci?d.compressedTexSubImage3D(R.TEXTURE_2D_ARRAY,sr,0,0,0,yn.width,yn.height,Dt.depth,Kt,yn.data,0,0):d.compressedTexImage3D(R.TEXTURE_2D_ARRAY,sr,Ui,yn.width,yn.height,Dt.depth,0,yn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ci?d.texSubImage3D(R.TEXTURE_2D_ARRAY,sr,0,0,0,yn.width,yn.height,Dt.depth,Kt,ii,yn.data):d.texImage3D(R.TEXTURE_2D_ARRAY,sr,Ui,yn.width,yn.height,Dt.depth,0,Kt,ii,yn.data)}else{ci&&Ii&&d.texStorage2D(R.TEXTURE_2D,$i,Ui,Bi[0].width,Bi[0].height);for(let sr=0,xs=Bi.length;sr<xs;sr++)yn=Bi[sr],$e.format!==uo?Kt!==null?ci?d.compressedTexSubImage2D(R.TEXTURE_2D,sr,0,0,yn.width,yn.height,Kt,yn.data):d.compressedTexImage2D(R.TEXTURE_2D,sr,Ui,yn.width,yn.height,0,yn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ci?d.texSubImage2D(R.TEXTURE_2D,sr,0,0,yn.width,yn.height,Kt,ii,yn.data):d.texImage2D(R.TEXTURE_2D,sr,Ui,yn.width,yn.height,0,Kt,ii,yn.data)}else if($e.isDataArrayTexture)ci?(Ii&&d.texStorage3D(R.TEXTURE_2D_ARRAY,$i,Ui,Dt.width,Dt.height,Dt.depth),d.texSubImage3D(R.TEXTURE_2D_ARRAY,0,0,0,0,Dt.width,Dt.height,Dt.depth,Kt,ii,Dt.data)):d.texImage3D(R.TEXTURE_2D_ARRAY,0,Ui,Dt.width,Dt.height,Dt.depth,0,Kt,ii,Dt.data);else if($e.isData3DTexture)ci?(Ii&&d.texStorage3D(R.TEXTURE_3D,$i,Ui,Dt.width,Dt.height,Dt.depth),d.texSubImage3D(R.TEXTURE_3D,0,0,0,0,Dt.width,Dt.height,Dt.depth,Kt,ii,Dt.data)):d.texImage3D(R.TEXTURE_3D,0,Ui,Dt.width,Dt.height,Dt.depth,0,Kt,ii,Dt.data);else if($e.isFramebufferTexture){if(Ii)if(ci)d.texStorage2D(R.TEXTURE_2D,$i,Ui,Dt.width,Dt.height);else{let sr=Dt.width,xs=Dt.height;for(let yo=0;yo<$i;yo++)d.texImage2D(R.TEXTURE_2D,yo,Ui,sr,xs,0,Kt,ii,null),sr>>=1,xs>>=1}}else if(Bi.length>0&&hn){ci&&Ii&&d.texStorage2D(R.TEXTURE_2D,$i,Ui,Bi[0].width,Bi[0].height);for(let sr=0,xs=Bi.length;sr<xs;sr++)yn=Bi[sr],ci?d.texSubImage2D(R.TEXTURE_2D,sr,0,0,Kt,ii,yn):d.texImage2D(R.TEXTURE_2D,sr,Ui,Kt,ii,yn);$e.generateMipmaps=!1}else ci?(Ii&&d.texStorage2D(R.TEXTURE_2D,$i,Ui,Dt.width,Dt.height),d.texSubImage2D(R.TEXTURE_2D,0,0,0,Kt,ii,Dt)):d.texImage2D(R.TEXTURE_2D,0,Ui,Kt,ii,Dt);Et($e,hn)&&xt(Ut),qe.__version=wt.version,$e.onUpdate&&$e.onUpdate($e)}et.__version=$e.version}function ot(et,$e,Gt,Ut,yt){const wt=E.convert(Gt.format,Gt.colorSpace),qe=E.convert(Gt.type),Ct=Zt(Gt.internalFormat,wt,qe,Gt.colorSpace);_.get($e).__hasExternalTextures||(yt===R.TEXTURE_3D||yt===R.TEXTURE_2D_ARRAY?d.texImage3D(yt,0,Ct,$e.width,$e.height,$e.depth,0,wt,qe,null):d.texImage2D(yt,0,Ct,$e.width,$e.height,0,wt,qe,null)),d.bindFramebuffer(R.FRAMEBUFFER,et),Yt($e)?ye.framebufferTexture2DMultisampleEXT(R.FRAMEBUFFER,Ut,yt,_.get(Gt).__webglTexture,0,en($e)):(yt===R.TEXTURE_2D||yt>=R.TEXTURE_CUBE_MAP_POSITIVE_X&&yt<=R.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&R.framebufferTexture2D(R.FRAMEBUFFER,Ut,yt,_.get(Gt).__webglTexture,0),d.bindFramebuffer(R.FRAMEBUFFER,null)}function Vt(et,$e,Gt){if(R.bindRenderbuffer(R.RENDERBUFFER,et),$e.depthBuffer&&!$e.stencilBuffer){let Ut=R.DEPTH_COMPONENT16;if(Gt||Yt($e)){const yt=$e.depthTexture;yt&&yt.isDepthTexture&&(yt.type===jr?Ut=R.DEPTH_COMPONENT32F:yt.type===is&&(Ut=R.DEPTH_COMPONENT24));const wt=en($e);Yt($e)?ye.renderbufferStorageMultisampleEXT(R.RENDERBUFFER,wt,Ut,$e.width,$e.height):R.renderbufferStorageMultisample(R.RENDERBUFFER,wt,Ut,$e.width,$e.height)}else R.renderbufferStorage(R.RENDERBUFFER,Ut,$e.width,$e.height);R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.RENDERBUFFER,et)}else if($e.depthBuffer&&$e.stencilBuffer){const Ut=en($e);Gt&&Yt($e)===!1?R.renderbufferStorageMultisample(R.RENDERBUFFER,Ut,R.DEPTH24_STENCIL8,$e.width,$e.height):Yt($e)?ye.renderbufferStorageMultisampleEXT(R.RENDERBUFFER,Ut,R.DEPTH24_STENCIL8,$e.width,$e.height):R.renderbufferStorage(R.RENDERBUFFER,R.DEPTH_STENCIL,$e.width,$e.height),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_STENCIL_ATTACHMENT,R.RENDERBUFFER,et)}else{const Ut=$e.isWebGLMultipleRenderTargets===!0?$e.texture:[$e.texture];for(let yt=0;yt<Ut.length;yt++){const wt=Ut[yt],qe=E.convert(wt.format,wt.colorSpace),Ct=E.convert(wt.type),Dt=Zt(wt.internalFormat,qe,Ct,wt.colorSpace),hn=en($e);Gt&&Yt($e)===!1?R.renderbufferStorageMultisample(R.RENDERBUFFER,hn,Dt,$e.width,$e.height):Yt($e)?ye.renderbufferStorageMultisampleEXT(R.RENDERBUFFER,hn,Dt,$e.width,$e.height):R.renderbufferStorage(R.RENDERBUFFER,Dt,$e.width,$e.height)}}R.bindRenderbuffer(R.RENDERBUFFER,null)}function Jt(et){const $e=_.get(et),Gt=et.isWebGLCubeRenderTarget===!0;if(et.depthTexture&&!$e.__autoAllocateDepthBuffer){if(Gt)throw new Error("target.depthTexture not supported in Cube render targets");(function(Ut,yt){if(yt&&yt.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(d.bindFramebuffer(R.FRAMEBUFFER,Ut),!yt.depthTexture||!yt.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");_.get(yt.depthTexture).__webglTexture&&yt.depthTexture.image.width===yt.width&&yt.depthTexture.image.height===yt.height||(yt.depthTexture.image.width=yt.width,yt.depthTexture.image.height=yt.height,yt.depthTexture.needsUpdate=!0),be(yt.depthTexture,0);const wt=_.get(yt.depthTexture).__webglTexture,qe=en(yt);if(yt.depthTexture.format===Oo)Yt(yt)?ye.framebufferTexture2DMultisampleEXT(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.TEXTURE_2D,wt,0,qe):R.framebufferTexture2D(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.TEXTURE_2D,wt,0);else{if(yt.depthTexture.format!==Bo)throw new Error("Unknown depthTexture format");Yt(yt)?ye.framebufferTexture2DMultisampleEXT(R.FRAMEBUFFER,R.DEPTH_STENCIL_ATTACHMENT,R.TEXTURE_2D,wt,0,qe):R.framebufferTexture2D(R.FRAMEBUFFER,R.DEPTH_STENCIL_ATTACHMENT,R.TEXTURE_2D,wt,0)}})($e.__webglFramebuffer,et)}else if(Gt){$e.__webglDepthbuffer=[];for(let Ut=0;Ut<6;Ut++)d.bindFramebuffer(R.FRAMEBUFFER,$e.__webglFramebuffer[Ut]),$e.__webglDepthbuffer[Ut]=R.createRenderbuffer(),Vt($e.__webglDepthbuffer[Ut],et,!1)}else d.bindFramebuffer(R.FRAMEBUFFER,$e.__webglFramebuffer),$e.__webglDepthbuffer=R.createRenderbuffer(),Vt($e.__webglDepthbuffer,et,!1);d.bindFramebuffer(R.FRAMEBUFFER,null)}function en(et){return Math.min(xe,et.samples)}function Yt(et){const $e=_.get(et);return k&&et.samples>0&&r.has("WEBGL_multisampled_render_to_texture")===!0&&$e.__useRenderToTexture!==!1}function ln(et,$e){const Gt=et.colorSpace,Ut=et.format,yt=et.type;return et.isCompressedTexture===!0||et.format===Xf||Gt!==Is&&Gt!==Ta&&(Gt===xr?k===!1?r.has("EXT_sRGB")===!0&&Ut===uo?(et.format=Xf,et.minFilter=Nn,et.generateMipmaps=!1):$e=$p.sRGBToLinear($e):Ut===uo&&yt===yi||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Gt===Wl||console.error("THREE.WebGLTextures: Unsupported texture color space:",Gt)),$e}this.allocateTextureUnit=function(){const et=ne;return et>=Q&&console.warn("THREE.WebGLTextures: Trying to use "+et+" texture units while this GPU supports only "+Q),ne+=1,et},this.resetTextureUnits=function(){ne=0},this.setTexture2D=be,this.setTexture2DArray=function(et,$e){const Gt=_.get(et);et.version>0&&Gt.__version!==et.version?nt(Gt,et,$e):d.bindTexture(R.TEXTURE_2D_ARRAY,Gt.__webglTexture,R.TEXTURE0+$e)},this.setTexture3D=function(et,$e){const Gt=_.get(et);et.version>0&&Gt.__version!==et.version?nt(Gt,et,$e):d.bindTexture(R.TEXTURE_3D,Gt.__webglTexture,R.TEXTURE0+$e)},this.setTextureCube=function(et,$e){const Gt=_.get(et);et.version>0&&Gt.__version!==et.version?function(Ut,yt,wt){if(yt.image.length!==6)return;const qe=st(Ut,yt),Ct=yt.source;d.bindTexture(R.TEXTURE_CUBE_MAP,Ut.__webglTexture,R.TEXTURE0+wt);const Dt=_.get(Ct);if(Ct.version!==Dt.__version||qe===!0){d.activeTexture(R.TEXTURE0+wt),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,yt.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,yt.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,yt.unpackAlignment),R.pixelStorei(R.UNPACK_COLORSPACE_CONVERSION_WEBGL,R.NONE);const hn=yt.isCompressedTexture||yt.image[0].isCompressedTexture,Kt=yt.image[0]&&yt.image[0].isDataTexture,yn=[];for(let Pr=0;Pr<6;Pr++)yn[Pr]=hn||Kt?Kt?yt.image[Pr].image:yt.image[Pr]:Je(yt.image[Pr],!1,!0,G),yn[Pr]=ln(yt,yn[Pr]);const ii=yn[0],Ui=Rt(ii)||k,Bi=E.convert(yt.format,yt.colorSpace),ci=E.convert(yt.type),Ii=Zt(yt.internalFormat,Bi,ci,yt.colorSpace),$i=k&&yt.isVideoTexture!==!0,sr=Dt.__version===void 0||qe===!0;let xs,yo=g(yt,ii,Ui);if(je(R.TEXTURE_CUBE_MAP,yt,Ui),hn){$i&&sr&&d.texStorage2D(R.TEXTURE_CUBE_MAP,yo,Ii,ii.width,ii.height);for(let Pr=0;Pr<6;Pr++){xs=yn[Pr].mipmaps;for(let ds=0;ds<xs.length;ds++){const Ss=xs[ds];yt.format!==uo?Bi!==null?$i?d.compressedTexSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds,0,0,Ss.width,Ss.height,Bi,Ss.data):d.compressedTexImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds,Ii,Ss.width,Ss.height,0,Ss.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):$i?d.texSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds,0,0,Ss.width,Ss.height,Bi,ci,Ss.data):d.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds,Ii,Ss.width,Ss.height,0,Bi,ci,Ss.data)}}}else{xs=yt.mipmaps,$i&&sr&&(xs.length>0&&yo++,d.texStorage2D(R.TEXTURE_CUBE_MAP,yo,Ii,yn[0].width,yn[0].height));for(let Pr=0;Pr<6;Pr++)if(Kt){$i?d.texSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,0,0,0,yn[Pr].width,yn[Pr].height,Bi,ci,yn[Pr].data):d.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,0,Ii,yn[Pr].width,yn[Pr].height,0,Bi,ci,yn[Pr].data);for(let ds=0;ds<xs.length;ds++){const Ss=xs[ds].image[Pr].image;$i?d.texSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds+1,0,0,Ss.width,Ss.height,Bi,ci,Ss.data):d.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds+1,Ii,Ss.width,Ss.height,0,Bi,ci,Ss.data)}}else{$i?d.texSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,0,0,0,Bi,ci,yn[Pr]):d.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,0,Ii,Bi,ci,yn[Pr]);for(let ds=0;ds<xs.length;ds++){const Ss=xs[ds];$i?d.texSubImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds+1,0,0,Bi,ci,Ss.image[Pr]):d.texImage2D(R.TEXTURE_CUBE_MAP_POSITIVE_X+Pr,ds+1,Ii,Bi,ci,Ss.image[Pr])}}}Et(yt,Ui)&&xt(R.TEXTURE_CUBE_MAP),Dt.__version=Ct.version,yt.onUpdate&&yt.onUpdate(yt)}Ut.__version=yt.version}(Gt,et,$e):d.bindTexture(R.TEXTURE_CUBE_MAP,Gt.__webglTexture,R.TEXTURE0+$e)},this.rebindTextures=function(et,$e,Gt){const Ut=_.get(et);$e!==void 0&&ot(Ut.__webglFramebuffer,et,et.texture,R.COLOR_ATTACHMENT0,R.TEXTURE_2D),Gt!==void 0&&Jt(et)},this.setupRenderTarget=function(et){const $e=et.texture,Gt=_.get(et),Ut=_.get($e);et.addEventListener("dispose",L),et.isWebGLMultipleRenderTargets!==!0&&(Ut.__webglTexture===void 0&&(Ut.__webglTexture=R.createTexture()),Ut.__version=$e.version,P.memory.textures++);const yt=et.isWebGLCubeRenderTarget===!0,wt=et.isWebGLMultipleRenderTargets===!0,qe=Rt(et)||k;if(yt){Gt.__webglFramebuffer=[];for(let Ct=0;Ct<6;Ct++)Gt.__webglFramebuffer[Ct]=R.createFramebuffer()}else{if(Gt.__webglFramebuffer=R.createFramebuffer(),wt)if(A.drawBuffers){const Ct=et.texture;for(let Dt=0,hn=Ct.length;Dt<hn;Dt++){const Kt=_.get(Ct[Dt]);Kt.__webglTexture===void 0&&(Kt.__webglTexture=R.createTexture(),P.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(k&&et.samples>0&&Yt(et)===!1){const Ct=wt?$e:[$e];Gt.__webglMultisampledFramebuffer=R.createFramebuffer(),Gt.__webglColorRenderbuffer=[],d.bindFramebuffer(R.FRAMEBUFFER,Gt.__webglMultisampledFramebuffer);for(let Dt=0;Dt<Ct.length;Dt++){const hn=Ct[Dt];Gt.__webglColorRenderbuffer[Dt]=R.createRenderbuffer(),R.bindRenderbuffer(R.RENDERBUFFER,Gt.__webglColorRenderbuffer[Dt]);const Kt=E.convert(hn.format,hn.colorSpace),yn=E.convert(hn.type),ii=Zt(hn.internalFormat,Kt,yn,hn.colorSpace,et.isXRRenderTarget===!0),Ui=en(et);R.renderbufferStorageMultisample(R.RENDERBUFFER,Ui,ii,et.width,et.height),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0+Dt,R.RENDERBUFFER,Gt.__webglColorRenderbuffer[Dt])}R.bindRenderbuffer(R.RENDERBUFFER,null),et.depthBuffer&&(Gt.__webglDepthRenderbuffer=R.createRenderbuffer(),Vt(Gt.__webglDepthRenderbuffer,et,!0)),d.bindFramebuffer(R.FRAMEBUFFER,null)}}if(yt){d.bindTexture(R.TEXTURE_CUBE_MAP,Ut.__webglTexture),je(R.TEXTURE_CUBE_MAP,$e,qe);for(let Ct=0;Ct<6;Ct++)ot(Gt.__webglFramebuffer[Ct],et,$e,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+Ct);Et($e,qe)&&xt(R.TEXTURE_CUBE_MAP),d.unbindTexture()}else if(wt){const Ct=et.texture;for(let Dt=0,hn=Ct.length;Dt<hn;Dt++){const Kt=Ct[Dt],yn=_.get(Kt);d.bindTexture(R.TEXTURE_2D,yn.__webglTexture),je(R.TEXTURE_2D,Kt,qe),ot(Gt.__webglFramebuffer,et,Kt,R.COLOR_ATTACHMENT0+Dt,R.TEXTURE_2D),Et(Kt,qe)&&xt(R.TEXTURE_2D)}d.unbindTexture()}else{let Ct=R.TEXTURE_2D;(et.isWebGL3DRenderTarget||et.isWebGLArrayRenderTarget)&&(k?Ct=et.isWebGL3DRenderTarget?R.TEXTURE_3D:R.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),d.bindTexture(Ct,Ut.__webglTexture),je(Ct,$e,qe),ot(Gt.__webglFramebuffer,et,$e,R.COLOR_ATTACHMENT0,Ct),Et($e,qe)&&xt(Ct),d.unbindTexture()}et.depthBuffer&&Jt(et)},this.updateRenderTargetMipmap=function(et){const $e=Rt(et)||k,Gt=et.isWebGLMultipleRenderTargets===!0?et.texture:[et.texture],Ut=et.isWebGLCubeRenderTarget?R.TEXTURE_CUBE_MAP:R.TEXTURE_2D;for(let yt=0,wt=Gt.length;yt<wt;yt++){const qe=Gt[yt],Ct=_.get(qe),Dt=Ct.__webglTexture;Ct.__version!==qe.version&&(d.bindTexture(Ut,Dt),je(Ut,qe,$e),d.unbindTexture(),Ct.__version=qe.version),Et(qe,$e)&&(d.bindTexture(Ut,Dt),xt(Ut),d.unbindTexture())}},this.updateMultisampleRenderTarget=function(et){if(k&&et.samples>0&&Yt(et)===!1){const $e=et.isWebGLMultipleRenderTargets?et.texture:[et.texture],Gt=et.width,Ut=et.height;let yt=R.COLOR_BUFFER_BIT;const wt=[],qe=et.stencilBuffer?R.DEPTH_STENCIL_ATTACHMENT:R.DEPTH_ATTACHMENT,Ct=_.get(et),Dt=et.isWebGLMultipleRenderTargets===!0;if(Dt)for(let hn=0;hn<$e.length;hn++)d.bindFramebuffer(R.FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0+hn,R.RENDERBUFFER,null),d.bindFramebuffer(R.FRAMEBUFFER,Ct.__webglFramebuffer),R.framebufferTexture2D(R.DRAW_FRAMEBUFFER,R.COLOR_ATTACHMENT0+hn,R.TEXTURE_2D,null,0);d.bindFramebuffer(R.READ_FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),d.bindFramebuffer(R.DRAW_FRAMEBUFFER,Ct.__webglFramebuffer);for(let hn=0;hn<$e.length;hn++){wt.push(R.COLOR_ATTACHMENT0+hn),et.depthBuffer&&wt.push(qe);const Kt=Ct.__ignoreDepthValues!==void 0&&Ct.__ignoreDepthValues;if(Kt===!1&&(et.depthBuffer&&(yt|=R.DEPTH_BUFFER_BIT),et.stencilBuffer&&(yt|=R.STENCIL_BUFFER_BIT)),Dt&&R.framebufferRenderbuffer(R.READ_FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.RENDERBUFFER,Ct.__webglColorRenderbuffer[hn]),Kt===!0&&(R.invalidateFramebuffer(R.READ_FRAMEBUFFER,[qe]),R.invalidateFramebuffer(R.DRAW_FRAMEBUFFER,[qe])),Dt){const yn=_.get($e[hn]).__webglTexture;R.framebufferTexture2D(R.DRAW_FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_2D,yn,0)}R.blitFramebuffer(0,0,Gt,Ut,0,0,Gt,Ut,yt,R.NEAREST),Ee&&R.invalidateFramebuffer(R.READ_FRAMEBUFFER,wt)}if(d.bindFramebuffer(R.READ_FRAMEBUFFER,null),d.bindFramebuffer(R.DRAW_FRAMEBUFFER,null),Dt)for(let hn=0;hn<$e.length;hn++){d.bindFramebuffer(R.FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),R.framebufferRenderbuffer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0+hn,R.RENDERBUFFER,Ct.__webglColorRenderbuffer[hn]);const Kt=_.get($e[hn]).__webglTexture;d.bindFramebuffer(R.FRAMEBUFFER,Ct.__webglFramebuffer),R.framebufferTexture2D(R.DRAW_FRAMEBUFFER,R.COLOR_ATTACHMENT0+hn,R.TEXTURE_2D,Kt,0)}d.bindFramebuffer(R.DRAW_FRAMEBUFFER,Ct.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Jt,this.setupFrameBufferTexture=ot,this.useMultisampledRTT=Yt}function Mc(R,r,d){const _=d.isWebGL2;return{convert:function(A,E=Ta){let P;if(A===yi)return R.UNSIGNED_BYTE;if(A===cs)return R.UNSIGNED_SHORT_4_4_4_4;if(A===ys)return R.UNSIGNED_SHORT_5_5_5_1;if(A===On)return R.BYTE;if(A===si)return R.SHORT;if(A===di)return R.UNSIGNED_SHORT;if(A===Mi)return R.INT;if(A===is)return R.UNSIGNED_INT;if(A===jr)return R.FLOAT;if(A===Xr)return _?R.HALF_FLOAT:(P=r.get("OES_texture_half_float"),P!==null?P.HALF_FLOAT_OES:null);if(A===za)return R.ALPHA;if(A===uo)return R.RGBA;if(A===sa)return R.LUMINANCE;if(A===oa)return R.LUMINANCE_ALPHA;if(A===Oo)return R.DEPTH_COMPONENT;if(A===Bo)return R.DEPTH_STENCIL;if(A===Xf)return P=r.get("EXT_sRGB"),P!==null?P.SRGB_ALPHA_EXT:null;if(A===Hl)return R.RED;if(A===ja)return R.RED_INTEGER;if(A===Ma)return R.RG;if(A===Lo)return R.RG_INTEGER;if(A===Pt)return R.RGBA_INTEGER;if(A===wn||A===Vn||A===un||A===Gn)if(E===xr){if(P=r.get("WEBGL_compressed_texture_s3tc_srgb"),P===null)return null;if(A===wn)return P.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(A===Vn)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(A===un)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(A===Gn)return P.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(P=r.get("WEBGL_compressed_texture_s3tc"),P===null)return null;if(A===wn)return P.COMPRESSED_RGB_S3TC_DXT1_EXT;if(A===Vn)return P.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(A===un)return P.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(A===Gn)return P.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(A===Yi||A===ji||A===Er||A===ir){if(P=r.get("WEBGL_compressed_texture_pvrtc"),P===null)return null;if(A===Yi)return P.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(A===ji)return P.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(A===Er)return P.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(A===ir)return P.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(A===Yn)return P=r.get("WEBGL_compressed_texture_etc1"),P!==null?P.COMPRESSED_RGB_ETC1_WEBGL:null;if(A===er||A===Pe){if(P=r.get("WEBGL_compressed_texture_etc"),P===null)return null;if(A===er)return E===xr?P.COMPRESSED_SRGB8_ETC2:P.COMPRESSED_RGB8_ETC2;if(A===Pe)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:P.COMPRESSED_RGBA8_ETC2_EAC}if(A===Le||A===ct||A===ht||A===Ke||A===Lt||A===dt||A===Wt||A===rn||A===on||A===gn||A===Xn||A===an||A===ui||A===Ai){if(P=r.get("WEBGL_compressed_texture_astc"),P===null)return null;if(A===Le)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:P.COMPRESSED_RGBA_ASTC_4x4_KHR;if(A===ct)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:P.COMPRESSED_RGBA_ASTC_5x4_KHR;if(A===ht)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:P.COMPRESSED_RGBA_ASTC_5x5_KHR;if(A===Ke)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:P.COMPRESSED_RGBA_ASTC_6x5_KHR;if(A===Lt)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:P.COMPRESSED_RGBA_ASTC_6x6_KHR;if(A===dt)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:P.COMPRESSED_RGBA_ASTC_8x5_KHR;if(A===Wt)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:P.COMPRESSED_RGBA_ASTC_8x6_KHR;if(A===rn)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:P.COMPRESSED_RGBA_ASTC_8x8_KHR;if(A===on)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:P.COMPRESSED_RGBA_ASTC_10x5_KHR;if(A===gn)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:P.COMPRESSED_RGBA_ASTC_10x6_KHR;if(A===Xn)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:P.COMPRESSED_RGBA_ASTC_10x8_KHR;if(A===an)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:P.COMPRESSED_RGBA_ASTC_10x10_KHR;if(A===ui)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:P.COMPRESSED_RGBA_ASTC_12x10_KHR;if(A===Ai)return E===xr?P.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:P.COMPRESSED_RGBA_ASTC_12x12_KHR}if(A===Bn){if(P=r.get("EXT_texture_compression_bptc"),P===null)return null;if(A===Bn)return E===xr?P.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:P.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(A===Kn||A===Mn||A===Ci||A===Hi){if(P=r.get("EXT_texture_compression_rgtc"),P===null)return null;if(A===Bn)return P.COMPRESSED_RED_RGTC1_EXT;if(A===Mn)return P.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(A===Ci)return P.COMPRESSED_RED_GREEN_RGTC2_EXT;if(A===Hi)return P.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return A===Zr?_?R.UNSIGNED_INT_24_8:(P=r.get("WEBGL_depth_texture"),P!==null?P.UNSIGNED_INT_24_8_WEBGL:null):R[A]!==void 0?R[A]:null}}}class mm extends Eo{constructor(r=[]){super(),this.isArrayCamera=!0,this.cameras=r}}class Tc extends bs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const cA={type:"move"};class Uh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Tc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Tc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new zt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new zt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Tc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new zt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new zt),this._grip}dispatchEvent(r){return this._targetRay!==null&&this._targetRay.dispatchEvent(r),this._grip!==null&&this._grip.dispatchEvent(r),this._hand!==null&&this._hand.dispatchEvent(r),this}connect(r){if(r&&r.hand){const d=this._hand;if(d)for(const _ of r.hand.values())this._getHandJoint(d,_)}return this.dispatchEvent({type:"connected",data:r}),this}disconnect(r){return this.dispatchEvent({type:"disconnected",data:r}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(r,d,_){let A=null,E=null,P=null;const k=this._targetRay,Q=this._grip,G=this._hand;if(r&&d.session.visibilityState!=="visible-blurred"){if(G&&r.hand){P=!0;for(const Ue of r.hand.values()){const Oe=d.getJointPose(Ue,_),ke=this._getHandJoint(G,Ue);Oe!==null&&(ke.matrix.fromArray(Oe.transform.matrix),ke.matrix.decompose(ke.position,ke.rotation,ke.scale),ke.matrixWorldNeedsUpdate=!0,ke.jointRadius=Oe.radius),ke.visible=Oe!==null}const re=G.joints["index-finger-tip"],xe=G.joints["thumb-tip"],ye=re.position.distanceTo(xe.position),Ee=.02,Ie=.005;G.inputState.pinching&&ye>Ee+Ie?(G.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:r.handedness,target:this})):!G.inputState.pinching&&ye<=Ee-Ie&&(G.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:r.handedness,target:this}))}else Q!==null&&r.gripSpace&&(E=d.getPose(r.gripSpace,_),E!==null&&(Q.matrix.fromArray(E.transform.matrix),Q.matrix.decompose(Q.position,Q.rotation,Q.scale),Q.matrixWorldNeedsUpdate=!0,E.linearVelocity?(Q.hasLinearVelocity=!0,Q.linearVelocity.copy(E.linearVelocity)):Q.hasLinearVelocity=!1,E.angularVelocity?(Q.hasAngularVelocity=!0,Q.angularVelocity.copy(E.angularVelocity)):Q.hasAngularVelocity=!1));k!==null&&(A=d.getPose(r.targetRaySpace,_),A===null&&E!==null&&(A=E),A!==null&&(k.matrix.fromArray(A.transform.matrix),k.matrix.decompose(k.position,k.rotation,k.scale),k.matrixWorldNeedsUpdate=!0,A.linearVelocity?(k.hasLinearVelocity=!0,k.linearVelocity.copy(A.linearVelocity)):k.hasLinearVelocity=!1,A.angularVelocity?(k.hasAngularVelocity=!0,k.angularVelocity.copy(A.angularVelocity)):k.hasAngularVelocity=!1,this.dispatchEvent(cA)))}return k!==null&&(k.visible=A!==null),Q!==null&&(Q.visible=E!==null),G!==null&&(G.visible=P!==null),this}_getHandJoint(r,d){if(r.joints[d.jointName]===void 0){const _=new Tc;_.matrixAutoUpdate=!1,_.visible=!1,r.joints[d.jointName]=_,r.add(_)}return r.joints[d.jointName]}}class Sv extends Us{constructor(r,d,_,A,E,P,k,Q,G,re){if((re=re!==void 0?re:Oo)!==Oo&&re!==Bo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");_===void 0&&re===Oo&&(_=is),_===void 0&&re===Bo&&(_=Zr),super(null,A,E,P,k,Q,re,_,G),this.isDepthTexture=!0,this.image={width:r,height:d},this.magFilter=k!==void 0?k:nn,this.minFilter=Q!==void 0?Q:nn,this.flipY=!1,this.generateMipmaps=!1}}class F0 extends sl{constructor(r,d){super();const _=this;let A=null,E=1,P=null,k="local-floor",Q=1,G=null,re=null,xe=null,ye=null,Ee=null,Ie=null;const Ue=d.getContextAttributes();let Oe=null,ke=null;const Ge=[],Je=[],Rt=new Set,Et=new Map,xt=new Eo;xt.layers.enable(1),xt.viewport=new Vr;const Zt=new Eo;Zt.layers.enable(2),Zt.viewport=new Vr;const g=[xt,Zt],b=new mm;b.layers.enable(1),b.layers.enable(2);let D=null,L=null;function Y(ot){const Vt=Je.indexOf(ot.inputSource);if(Vt===-1)return;const Jt=Ge[Vt];Jt!==void 0&&(Jt.update(ot.inputSource,ot.frame,G||P),Jt.dispatchEvent({type:ot.type,data:ot.inputSource}))}function ne(){A.removeEventListener("select",Y),A.removeEventListener("selectstart",Y),A.removeEventListener("selectend",Y),A.removeEventListener("squeeze",Y),A.removeEventListener("squeezestart",Y),A.removeEventListener("squeezeend",Y),A.removeEventListener("end",ne),A.removeEventListener("inputsourceschange",be);for(let ot=0;ot<Ge.length;ot++){const Vt=Je[ot];Vt!==null&&(Je[ot]=null,Ge[ot].disconnect(Vt))}D=null,L=null,r.setRenderTarget(Oe),Ee=null,ye=null,xe=null,A=null,ke=null,nt.stop(),_.isPresenting=!1,_.dispatchEvent({type:"sessionend"})}function be(ot){for(let Vt=0;Vt<ot.removed.length;Vt++){const Jt=ot.removed[Vt],en=Je.indexOf(Jt);en>=0&&(Je[en]=null,Ge[en].disconnect(Jt))}for(let Vt=0;Vt<ot.added.length;Vt++){const Jt=ot.added[Vt];let en=Je.indexOf(Jt);if(en===-1){for(let ln=0;ln<Ge.length;ln++){if(ln>=Je.length){Je.push(Jt),en=ln;break}if(Je[ln]===null){Je[ln]=Jt,en=ln;break}}if(en===-1)break}const Yt=Ge[en];Yt&&Yt.connect(Jt)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ot){let Vt=Ge[ot];return Vt===void 0&&(Vt=new Uh,Ge[ot]=Vt),Vt.getTargetRaySpace()},this.getControllerGrip=function(ot){let Vt=Ge[ot];return Vt===void 0&&(Vt=new Uh,Ge[ot]=Vt),Vt.getGripSpace()},this.getHand=function(ot){let Vt=Ge[ot];return Vt===void 0&&(Vt=new Uh,Ge[ot]=Vt),Vt.getHandSpace()},this.setFramebufferScaleFactor=function(ot){E=ot,_.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ot){k=ot,_.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return G||P},this.setReferenceSpace=function(ot){G=ot},this.getBaseLayer=function(){return ye!==null?ye:Ee},this.getBinding=function(){return xe},this.getFrame=function(){return Ie},this.getSession=function(){return A},this.setSession=async function(ot){if(A=ot,A!==null){if(Oe=r.getRenderTarget(),A.addEventListener("select",Y),A.addEventListener("selectstart",Y),A.addEventListener("selectend",Y),A.addEventListener("squeeze",Y),A.addEventListener("squeezestart",Y),A.addEventListener("squeezeend",Y),A.addEventListener("end",ne),A.addEventListener("inputsourceschange",be),Ue.xrCompatible!==!0&&await d.makeXRCompatible(),A.renderState.layers===void 0||r.capabilities.isWebGL2===!1){const Vt={antialias:A.renderState.layers!==void 0||Ue.antialias,alpha:!0,depth:Ue.depth,stencil:Ue.stencil,framebufferScaleFactor:E};Ee=new XRWebGLLayer(A,d,Vt),A.updateRenderState({baseLayer:Ee}),ke=new va(Ee.framebufferWidth,Ee.framebufferHeight,{format:uo,type:yi,colorSpace:r.outputColorSpace,stencilBuffer:Ue.stencil})}else{let Vt=null,Jt=null,en=null;Ue.depth&&(en=Ue.stencil?d.DEPTH24_STENCIL8:d.DEPTH_COMPONENT24,Vt=Ue.stencil?Bo:Oo,Jt=Ue.stencil?Zr:is);const Yt={colorFormat:d.RGBA8,depthFormat:en,scaleFactor:E};xe=new XRWebGLBinding(A,d),ye=xe.createProjectionLayer(Yt),A.updateRenderState({layers:[ye]}),ke=new va(ye.textureWidth,ye.textureHeight,{format:uo,type:yi,depthTexture:new Sv(ye.textureWidth,ye.textureHeight,Jt,void 0,void 0,void 0,void 0,void 0,void 0,Vt),stencilBuffer:Ue.stencil,colorSpace:r.outputColorSpace,samples:Ue.antialias?4:0}),r.properties.get(ke).__ignoreDepthValues=ye.ignoreDepthValues}ke.isXRRenderTarget=!0,this.setFoveation(Q),G=null,P=await A.requestReferenceSpace(k),nt.setContext(A),nt.start(),_.isPresenting=!0,_.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(A!==null)return A.environmentBlendMode};const Me=new zt,De=new zt;function je(ot,Vt){Vt===null?ot.matrixWorld.copy(ot.matrix):ot.matrixWorld.multiplyMatrices(Vt.matrixWorld,ot.matrix),ot.matrixWorldInverse.copy(ot.matrixWorld).invert()}this.updateCamera=function(ot){if(A===null)return;b.near=Zt.near=xt.near=ot.near,b.far=Zt.far=xt.far=ot.far,D===b.near&&L===b.far||(A.updateRenderState({depthNear:b.near,depthFar:b.far}),D=b.near,L=b.far);const Vt=ot.parent,Jt=b.cameras;je(b,Vt);for(let en=0;en<Jt.length;en++)je(Jt[en],Vt);Jt.length===2?function(en,Yt,ln){Me.setFromMatrixPosition(Yt.matrixWorld),De.setFromMatrixPosition(ln.matrixWorld);const et=Me.distanceTo(De),$e=Yt.projectionMatrix.elements,Gt=ln.projectionMatrix.elements,Ut=$e[14]/($e[10]-1),yt=$e[14]/($e[10]+1),wt=($e[9]+1)/$e[5],qe=($e[9]-1)/$e[5],Ct=($e[8]-1)/$e[0],Dt=(Gt[8]+1)/Gt[0],hn=Ut*Ct,Kt=Ut*Dt,yn=et/(-Ct+Dt),ii=yn*-Ct;Yt.matrixWorld.decompose(en.position,en.quaternion,en.scale),en.translateX(ii),en.translateZ(yn),en.matrixWorld.compose(en.position,en.quaternion,en.scale),en.matrixWorldInverse.copy(en.matrixWorld).invert();const Ui=Ut+yn,Bi=yt+yn,ci=hn-ii,Ii=Kt+(et-ii),$i=wt*yt/Bi*Ui,sr=qe*yt/Bi*Ui;en.projectionMatrix.makePerspective(ci,Ii,$i,sr,Ui,Bi),en.projectionMatrixInverse.copy(en.projectionMatrix).invert()}(b,xt,Zt):b.projectionMatrix.copy(xt.projectionMatrix),function(en,Yt,ln){ln===null?en.matrix.copy(Yt.matrixWorld):(en.matrix.copy(ln.matrixWorld),en.matrix.invert(),en.matrix.multiply(Yt.matrixWorld)),en.matrix.decompose(en.position,en.quaternion,en.scale),en.updateMatrixWorld(!0);const et=en.children;for(let $e=0,Gt=et.length;$e<Gt;$e++)et[$e].updateMatrixWorld(!0);en.projectionMatrix.copy(Yt.projectionMatrix),en.projectionMatrixInverse.copy(Yt.projectionMatrixInverse),en.isPerspectiveCamera&&(en.fov=2*uc*Math.atan(1/en.projectionMatrix.elements[5]),en.zoom=1)}(ot,b,Vt)},this.getCamera=function(){return b},this.getFoveation=function(){if(ye!==null||Ee!==null)return Q},this.setFoveation=function(ot){Q=ot,ye!==null&&(ye.fixedFoveation=ot),Ee!==null&&Ee.fixedFoveation!==void 0&&(Ee.fixedFoveation=ot)},this.getPlanes=function(){return Rt};let st=null;this.onPreAnimationFrameCallback=null;const nt=new R0;nt.setAnimationLoop(function(ot,Vt){if(_.onPreAnimationFrameCallback&&_.onPreAnimationFrameCallback(ot,Vt),re=Vt.getViewerPose(G||P),Ie=Vt,re!==null){const Jt=re.views;Ee!==null&&(r.setRenderTargetFramebuffer(ke,Ee.framebuffer),r.setRenderTarget(ke));let en=!1;Jt.length!==b.cameras.length&&(b.cameras.length=0,en=!0);for(let Yt=0;Yt<Jt.length;Yt++){const ln=Jt[Yt];let et=null;if(Ee!==null)et=Ee.getViewport(ln);else{const Gt=xe.getViewSubImage(ye,ln);et=Gt.viewport,Yt===0&&(r.setRenderTargetTextures(ke,Gt.colorTexture,ye.ignoreDepthValues?void 0:Gt.depthStencilTexture),r.setRenderTarget(ke))}let $e=g[Yt];$e===void 0&&($e=new Eo,$e.layers.enable(Yt),$e.viewport=new Vr,g[Yt]=$e),$e.matrix.fromArray(ln.transform.matrix),$e.matrix.decompose($e.position,$e.quaternion,$e.scale),$e.projectionMatrix.fromArray(ln.projectionMatrix),$e.projectionMatrixInverse.copy($e.projectionMatrix).invert(),$e.viewport.set(et.x,et.y,et.width,et.height),Yt===0&&(b.matrix.copy($e.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale)),en===!0&&b.cameras.push($e)}}for(let Jt=0;Jt<Ge.length;Jt++){const en=Je[Jt],Yt=Ge[Jt];en!==null&&Yt!==void 0&&Yt.update(en,Vt,G||P)}if(st&&st(ot,Vt),Vt.detectedPlanes){_.dispatchEvent({type:"planesdetected",data:Vt.detectedPlanes});let Jt=null;for(const en of Rt)Vt.detectedPlanes.has(en)||(Jt===null&&(Jt=[]),Jt.push(en));if(Jt!==null)for(const en of Jt)Rt.delete(en),Et.delete(en),_.dispatchEvent({type:"planeremoved",data:en});for(const en of Vt.detectedPlanes)if(Rt.has(en)){const Yt=Et.get(en);en.lastChangedTime>Yt&&(Et.set(en,en.lastChangedTime),_.dispatchEvent({type:"planechanged",data:en}))}else Rt.add(en),Et.set(en,Vt.lastChangedTime),_.dispatchEvent({type:"planeadded",data:en})}Ie=null}),this.setAnimationLoop=function(ot){st=ot},this.dispose=function(){}}}function Mv(R,r){function d(A,E){A.matrixAutoUpdate===!0&&A.updateMatrix(),E.value.copy(A.matrix)}function _(A,E){A.opacity.value=E.opacity,E.color&&A.diffuse.value.copy(E.color),E.emissive&&A.emissive.value.copy(E.emissive).multiplyScalar(E.emissiveIntensity),E.map&&(A.map.value=E.map,d(E.map,A.mapTransform)),E.alphaMap&&(A.alphaMap.value=E.alphaMap,d(E.alphaMap,A.alphaMapTransform)),E.bumpMap&&(A.bumpMap.value=E.bumpMap,d(E.bumpMap,A.bumpMapTransform),A.bumpScale.value=E.bumpScale,E.side===ve&&(A.bumpScale.value*=-1)),E.normalMap&&(A.normalMap.value=E.normalMap,d(E.normalMap,A.normalMapTransform),A.normalScale.value.copy(E.normalScale),E.side===ve&&A.normalScale.value.negate()),E.displacementMap&&(A.displacementMap.value=E.displacementMap,d(E.displacementMap,A.displacementMapTransform),A.displacementScale.value=E.displacementScale,A.displacementBias.value=E.displacementBias),E.emissiveMap&&(A.emissiveMap.value=E.emissiveMap,d(E.emissiveMap,A.emissiveMapTransform)),E.specularMap&&(A.specularMap.value=E.specularMap,d(E.specularMap,A.specularMapTransform)),E.alphaTest>0&&(A.alphaTest.value=E.alphaTest);const P=r.get(E).envMap;if(P){A.envMap.value=P;const k=r.get(E).environment||P;A.envMapRotation.value=k?k.rotation:0,A.flipEnvMap.value=P.isCubeTexture&&P.isRenderTargetTexture===!1?-1:1,A.reflectivity.value=E.reflectivity,A.ior.value=E.ior,A.refractionRatio.value=E.refractionRatio}if(E.lightMap){A.lightMap.value=E.lightMap;const k=R.useLegacyLights===!0?Math.PI:1;A.lightMapIntensity.value=E.lightMapIntensity*k,d(E.lightMap,A.lightMapTransform)}E.aoMap&&(A.aoMap.value=E.aoMap,A.aoMapIntensity.value=E.aoMapIntensity,d(E.aoMap,A.aoMapTransform))}return{refreshTransformUniform:d,refreshFogUniforms:function(A,E){E.color.getRGB(A.fogColor.value,av(R)),E.isFog?(A.fogNear.value=E.near,A.fogFar.value=E.far):E.isFogExp2&&(A.fogDensity.value=E.density)},refreshMaterialUniforms:function(A,E,P,k,Q){E.isMeshBasicMaterial||E.isMeshLambertMaterial?_(A,E):E.isMeshToonMaterial?(_(A,E),function(G,re){re.gradientMap&&(G.gradientMap.value=re.gradientMap)}(A,E)):E.isMeshPhongMaterial?(_(A,E),function(G,re){G.specular.value.copy(re.specular),G.shininess.value=Math.max(re.shininess,1e-4)}(A,E)):E.isMeshStandardMaterial?(_(A,E),function(G,re){G.metalness.value=re.metalness,re.metalnessMap&&(G.metalnessMap.value=re.metalnessMap,d(re.metalnessMap,G.metalnessMapTransform)),G.roughness.value=re.roughness,re.roughnessMap&&(G.roughnessMap.value=re.roughnessMap,d(re.roughnessMap,G.roughnessMapTransform)),r.get(re).envMap&&(G.envMapIntensity.value=re.envMapIntensity)}(A,E),E.isMeshPhysicalMaterial&&function(G,re,xe){G.ior.value=re.ior,re.sheen>0&&(G.sheenColor.value.copy(re.sheenColor).multiplyScalar(re.sheen),G.sheenRoughness.value=re.sheenRoughness,re.sheenColorMap&&(G.sheenColorMap.value=re.sheenColorMap,d(re.sheenColorMap,G.sheenColorMapTransform)),re.sheenRoughnessMap&&(G.sheenRoughnessMap.value=re.sheenRoughnessMap,d(re.sheenRoughnessMap,G.sheenRoughnessMapTransform))),re.clearcoat>0&&(G.clearcoat.value=re.clearcoat,G.clearcoatRoughness.value=re.clearcoatRoughness,re.clearcoatMap&&(G.clearcoatMap.value=re.clearcoatMap,d(re.clearcoatMap,G.clearcoatMapTransform)),re.clearcoatRoughnessMap&&(G.clearcoatRoughnessMap.value=re.clearcoatRoughnessMap,d(re.clearcoatRoughnessMap,G.clearcoatRoughnessMapTransform)),re.clearcoatNormalMap&&(G.clearcoatNormalMap.value=re.clearcoatNormalMap,d(re.clearcoatNormalMap,G.clearcoatNormalMapTransform),G.clearcoatNormalScale.value.copy(re.clearcoatNormalScale),re.side===ve&&G.clearcoatNormalScale.value.negate())),re.iridescence>0&&(G.iridescence.value=re.iridescence,G.iridescenceIOR.value=re.iridescenceIOR,G.iridescenceThicknessMinimum.value=re.iridescenceThicknessRange[0],G.iridescenceThicknessMaximum.value=re.iridescenceThicknessRange[1],re.iridescenceMap&&(G.iridescenceMap.value=re.iridescenceMap,d(re.iridescenceMap,G.iridescenceMapTransform)),re.iridescenceThicknessMap&&(G.iridescenceThicknessMap.value=re.iridescenceThicknessMap,d(re.iridescenceThicknessMap,G.iridescenceThicknessMapTransform))),re.transmission>0&&(G.transmission.value=re.transmission,G.transmissionSamplerMap.value=xe.texture,G.transmissionSamplerSize.value.set(xe.width,xe.height),re.transmissionMap&&(G.transmissionMap.value=re.transmissionMap,d(re.transmissionMap,G.transmissionMapTransform)),G.thickness.value=re.thickness,re.thicknessMap&&(G.thicknessMap.value=re.thicknessMap,d(re.thicknessMap,G.thicknessMapTransform)),G.attenuationDistance.value=re.attenuationDistance,G.attenuationColor.value.copy(re.attenuationColor)),G.specularIntensity.value=re.specularIntensity,G.specularColor.value.copy(re.specularColor),re.specularColorMap&&(G.specularColorMap.value=re.specularColorMap,d(re.specularColorMap,G.specularColorMapTransform)),re.specularIntensityMap&&(G.specularIntensityMap.value=re.specularIntensityMap,d(re.specularIntensityMap,G.specularIntensityMapTransform))}(A,E,Q)):E.isMeshMatcapMaterial?(_(A,E),function(G,re){re.matcap&&(G.matcap.value=re.matcap)}(A,E)):E.isMeshDepthMaterial?_(A,E):E.isMeshDistanceMaterial?(_(A,E),function(G,re){const xe=r.get(re).light;G.referencePosition.value.setFromMatrixPosition(xe.matrixWorld),G.nearDistance.value=xe.shadow.camera.near,G.farDistance.value=xe.shadow.camera.far}(A,E)):E.isMeshNormalMaterial?_(A,E):E.isLineBasicMaterial?(function(G,re){G.diffuse.value.copy(re.color),G.opacity.value=re.opacity,re.map&&(G.map.value=re.map,d(re.map,G.mapTransform))}(A,E),E.isLineDashedMaterial&&function(G,re){G.dashSize.value=re.dashSize,G.totalSize.value=re.dashSize+re.gapSize,G.scale.value=re.scale}(A,E)):E.isPointsMaterial?function(G,re,xe,ye){G.diffuse.value.copy(re.color),G.opacity.value=re.opacity,G.size.value=re.size*xe,G.scale.value=.5*ye,re.map&&(G.map.value=re.map,d(re.map,G.uvTransform)),re.alphaMap&&(G.alphaMap.value=re.alphaMap),re.alphaTest>0&&(G.alphaTest.value=re.alphaTest)}(A,E,P,k):E.isSpriteMaterial?function(G,re){G.diffuse.value.copy(re.color),G.opacity.value=re.opacity,G.rotation.value=re.rotation,re.map&&(G.map.value=re.map,d(re.map,G.mapTransform)),re.alphaMap&&(G.alphaMap.value=re.alphaMap),re.alphaTest>0&&(G.alphaTest.value=re.alphaTest)}(A,E):E.isShadowMaterial?(A.color.value.copy(E.color),A.opacity.value=E.opacity):E.isShaderMaterial&&(E.transmission!==void 0&&(A.transmission&&(A.transmission.value=E.transmission),A.transmissionSamplerMap&&Q&&(A.transmissionSamplerMap.value=Q?Q.texture:null),A.transmissionSamplerSize&&Q&&A.transmissionSamplerSize.value.set(Q.width,Q.height)),E.uniformsNeedUpdate=!1)}}}function Wg(R,r,d,_){let A={},E={},P=[];const k=d.isWebGL2?R.getParameter(R.MAX_UNIFORM_BUFFER_BINDINGS):0;function Q(xe,ye,Ee){const Ie=xe.value;if(Ee[ye]===void 0){if(typeof Ie=="number")Ee[ye]=Ie;else{const Ue=Array.isArray(Ie)?Ie:[Ie],Oe=[];for(let ke=0;ke<Ue.length;ke++)Oe.push(Ue[ke].clone());Ee[ye]=Oe}return!0}if(typeof Ie=="number"){if(Ee[ye]!==Ie)return Ee[ye]=Ie,!0}else{const Ue=Array.isArray(Ee[ye])?Ee[ye]:[Ee[ye]],Oe=Array.isArray(Ie)?Ie:[Ie];for(let ke=0;ke<Ue.length;ke++){const Ge=Ue[ke];if(Ge.equals(Oe[ke])===!1)return Ge.copy(Oe[ke]),!0}}return!1}function G(xe){const ye={boundary:0,storage:0};return typeof xe=="number"?(ye.boundary=4,ye.storage=4):xe.isVector2?(ye.boundary=8,ye.storage=8):xe.isVector3||xe.isColor?(ye.boundary=16,ye.storage=12):xe.isVector4?(ye.boundary=16,ye.storage=16):xe.isMatrix3?(ye.boundary=48,ye.storage=48):xe.isMatrix4?(ye.boundary=64,ye.storage=64):xe.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",xe),ye}function re(xe){const ye=xe.target;ye.removeEventListener("dispose",re);const Ee=P.indexOf(ye.__bindingPointIndex);P.splice(Ee,1),R.deleteBuffer(A[ye.id]),delete A[ye.id],delete E[ye.id]}return{bind:function(xe,ye){const Ee=ye.program;_.uniformBlockBinding(xe,Ee)},update:function(xe,ye){let Ee=A[xe.id];Ee===void 0&&(function(Oe){const ke=Oe.uniforms;let Ge=0,Je=0;for(let Rt=0,Et=ke.length;Rt<Et;Rt++){const xt=ke[Rt],Zt={boundary:0,storage:0},g=Array.isArray(xt.value)?xt.value:[xt.value];for(let b=0,D=g.length;b<D;b++){const L=G(g[b]);Zt.boundary+=L.boundary,Zt.storage+=L.storage}xt.__data=new Float32Array(Zt.storage/Float32Array.BYTES_PER_ELEMENT),xt.__offset=Ge,Rt>0&&(Je=Ge%16,Je!==0&&16-Je-Zt.boundary<0&&(Ge+=16-Je,xt.__offset=Ge)),Ge+=Zt.storage}Je=Ge%16,Je>0&&(Ge+=16-Je),Oe.__size=Ge,Oe.__cache={}}(xe),Ee=function(Oe){const ke=function(){for(let Et=0;Et<k;Et++)if(P.indexOf(Et)===-1)return P.push(Et),Et;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Oe.__bindingPointIndex=ke;const Ge=R.createBuffer(),Je=Oe.__size,Rt=Oe.usage;return R.bindBuffer(R.UNIFORM_BUFFER,Ge),R.bufferData(R.UNIFORM_BUFFER,Je,Rt),R.bindBuffer(R.UNIFORM_BUFFER,null),R.bindBufferBase(R.UNIFORM_BUFFER,ke,Ge),Ge}(xe),A[xe.id]=Ee,xe.addEventListener("dispose",re));const Ie=ye.program;_.updateUBOMapping(xe,Ie);const Ue=r.render.frame;E[xe.id]!==Ue&&(function(Oe){const ke=A[Oe.id],Ge=Oe.uniforms,Je=Oe.__cache;R.bindBuffer(R.UNIFORM_BUFFER,ke);for(let Rt=0,Et=Ge.length;Rt<Et;Rt++){const xt=Ge[Rt];if(Q(xt,Rt,Je)===!0){const Zt=xt.__offset,g=Array.isArray(xt.value)?xt.value:[xt.value];let b=0;for(let D=0;D<g.length;D++){const L=g[D],Y=G(L);typeof L=="number"?(xt.__data[0]=L,R.bufferSubData(R.UNIFORM_BUFFER,Zt+b,xt.__data)):L.isMatrix3?(xt.__data[0]=L.elements[0],xt.__data[1]=L.elements[1],xt.__data[2]=L.elements[2],xt.__data[3]=L.elements[0],xt.__data[4]=L.elements[3],xt.__data[5]=L.elements[4],xt.__data[6]=L.elements[5],xt.__data[7]=L.elements[0],xt.__data[8]=L.elements[6],xt.__data[9]=L.elements[7],xt.__data[10]=L.elements[8],xt.__data[11]=L.elements[0]):(L.toArray(xt.__data,b),b+=Y.storage/Float32Array.BYTES_PER_ELEMENT)}R.bufferSubData(R.UNIFORM_BUFFER,Zt,xt.__data)}}R.bindBuffer(R.UNIFORM_BUFFER,null)}(xe),E[xe.id]=Ue)},dispose:function(){for(const xe in A)R.deleteBuffer(A[xe]);P=[],A={},E={}}}}function uA(){const R=hc("canvas");return R.style.display="block",R}class Tv{constructor(r={}){const{canvas:d=uA(),context:_=null,depth:A=!0,stencil:E=!0,alpha:P=!1,antialias:k=!1,premultipliedAlpha:Q=!0,preserveDrawingBuffer:G=!1,powerPreference:re="default",failIfMajorPerformanceCaveat:xe=!1}=r;let ye;this.isWebGLRenderer=!0,ye=_!==null?_.getContextAttributes().alpha:P;let Ee=null,Ie=null;const Ue=[],Oe=[];this.domElement=d,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=xr,this.useLegacyLights=!0,this.toneMapping=dn,this.toneMappingExposure=1,this.userData={};const ke=this;let Ge=!1,Je=0,Rt=0,Et=null,xt=-1,Zt=null;const g=new Vr,b=new Vr;let D=null,L=d.width,Y=d.height,ne=1,be=null,Me=null;const De=new Vr(0,0,L,Y),je=new Vr(0,0,L,Y);let st=!1;const nt=new cv;let ot=!1,Vt=!1,Jt=null;const en=new Gr,Yt=new zt,ln={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function et(){return Et===null?ne:1}let $e,Gt,Ut,yt,wt,qe,Ct,Dt,hn,Kt,yn,ii,Ui,Bi,ci,Ii,$i,sr,xs,yo,Pr,ds,Ss,lu,Jn=_;function xl(Tt,fn){for(let xn=0;xn<Tt.length;xn++){const Dn=Tt[xn],ti=d.getContext(Dn,fn);if(ti!==null)return ti}return null}try{const Tt={alpha:!0,depth:A,stencil:E,antialias:k,premultipliedAlpha:Q,preserveDrawingBuffer:G,powerPreference:re,failIfMajorPerformanceCaveat:xe};if("setAttribute"in d&&d.setAttribute("data-engine",`three.js r${v}`),d.addEventListener("webglcontextlost",Zh,!1),d.addEventListener("webglcontextrestored",zp,!1),d.addEventListener("webglcontextcreationerror",D_,!1),Jn===null){const fn=["webgl2","webgl","experimental-webgl"];if(ke.isWebGL1Renderer===!0&&fn.shift(),Jn=xl(fn,Tt),Jn===null)throw xl(fn)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Jn.getShaderPrecisionFormat===void 0&&(Jn.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Tt){throw console.error("THREE.WebGLRenderer: "+Tt.message),Tt}function Vd(){$e=new im(Jn),Gt=new of(Jn,$e,r),$e.init(Gt),ds=new Mc(Jn,$e,Gt),Ut=new Ev(Jn,$e,Gt),yt=new fp(Jn),wt=new oA,qe=new Tu(Jn,$e,Ut,wt,Gt,ds,yt),Ct=new Kc(ke),Dt=new uv(ke),hn=new wb(Jn,Gt),Ss=new fi(Jn,$e,hn,Gt),Kt=new rm(Jn,hn,yt,Ss),yn=new Ju(Jn,Kt,hn,yt),xs=new eu(Jn,Gt,qe),Ii=new Ed(wt),ii=new Sb(ke,Ct,Dt,$e,Gt,Ss,Ii),Ui=new Mv(ke,wt),Bi=new bv,ci=new Ws($e,Gt),sr=new wd(ke,Ct,Dt,Ut,yn,ye,Q),$i=new fm(ke,yn,Gt),lu=new Wg(Jn,yt,Gt,Ut),yo=new Pg(Jn,$e,yt,Gt),Pr=new Og(Jn,$e,yt,Gt),yt.programs=ii.programs,ke.capabilities=Gt,ke.extensions=$e,ke.properties=wt,ke.renderLists=Bi,ke.shadowMap=$i,ke.state=Ut,ke.info=yt,ke.background=sr,ke.cubeuvmaps=Dt,ke.materials=Ui}Vd();const wl=new F0(ke,Jn);function Zh(Tt){Tt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ge=!0,ke.onContextLost(Tt)}function zp(){console.log("THREE.WebGLRenderer: Context Restored."),Ge=!1;const Tt=yt.autoReset,fn=$i.enabled,xn=$i.autoUpdate,Dn=$i.needsUpdate,ti=$i.type;Vd(),yt.autoReset=Tt,$i.enabled=fn,$i.autoUpdate=xn,$i.needsUpdate=Dn,$i.type=ti,ke.onContextRestore(),console.log("restored")}function D_(Tt){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Tt.statusMessage),ke.onContextCreationError(Tt)}function qt(Tt){const fn=Tt.target;fn.removeEventListener("dispose",qt),function(xn){(function(Dn){const ti=wt.get(Dn).programs;ti!==void 0&&(ti.forEach(function(Oi){ii.releaseProgram(Oi)}),Dn.isShaderMaterial&&ii.releaseShaderCache(Dn))})(xn),wt.remove(xn)}(fn)}this.xr=wl,this.getContext=function(){return Jn},this.getContextAttributes=function(){return Jn.getContextAttributes()},this.forceContextLoss=function(){const Tt=$e.get("WEBGL_lose_context");Tt&&Tt.loseContext()},this.forceContextRestore=function(){const Tt=$e.get("WEBGL_lose_context");Tt&&Tt.restoreContext()},this.getPixelRatio=function(){return ne},this.setPixelRatio=function(Tt){Tt!==void 0&&(ne=Tt,this.setSize(L,Y,!1))},this.getSize=function(Tt){return Tt.set(L,Y)},this.setSize=function(Tt,fn,xn=!0){wl.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=Tt,Y=fn,d.width=Math.floor(Tt*ne),d.height=Math.floor(fn*ne),xn===!0&&(d.style.width=Tt+"px",d.style.height=fn+"px"),this.setViewport(0,0,Tt,fn))},this.getDrawingBufferSize=function(Tt){return Tt.set(L*ne,Y*ne).floor()},this.setDrawingBufferSize=function(Tt,fn,xn){L=Tt,Y=fn,ne=xn,d.width=Math.floor(Tt*xn),d.height=Math.floor(fn*xn),this.setViewport(0,0,Tt,fn)},this.getCurrentViewport=function(Tt){return Tt.copy(g)},this.getViewport=function(Tt){return Tt.copy(De)},this.setViewport=function(Tt,fn,xn,Dn){Tt.isVector4?De.set(Tt.x,Tt.y,Tt.z,Tt.w):De.set(Tt,fn,xn,Dn),Ut.viewport(g.copy(De).multiplyScalar(ne).floor())},this.getScissor=function(Tt){return Tt.copy(je)},this.setScissor=function(Tt,fn,xn,Dn){Tt.isVector4?je.set(Tt.x,Tt.y,Tt.z,Tt.w):je.set(Tt,fn,xn,Dn),Ut.scissor(b.copy(je).multiplyScalar(ne).floor())},this.getScissorTest=function(){return st},this.setScissorTest=function(Tt){Ut.setScissorTest(st=Tt)},this.setOpaqueSort=function(Tt){be=Tt},this.setTransparentSort=function(Tt){Me=Tt},this.getClearColor=function(Tt){return Tt.copy(sr.getClearColor())},this.setClearColor=function(){sr.setClearColor.apply(sr,arguments)},this.getClearAlpha=function(){return sr.getClearAlpha()},this.setClearAlpha=function(){sr.setClearAlpha.apply(sr,arguments)},this.clear=function(Tt=!0,fn=!0,xn=!0){let Dn=0;Tt&&(Dn|=Jn.COLOR_BUFFER_BIT),fn&&(Dn|=Jn.DEPTH_BUFFER_BIT),xn&&(Dn|=Jn.STENCIL_BUFFER_BIT),Jn.clear(Dn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){d.removeEventListener("webglcontextlost",Zh,!1),d.removeEventListener("webglcontextrestored",zp,!1),d.removeEventListener("webglcontextcreationerror",D_,!1),Bi.dispose(),ci.dispose(),wt.dispose(),Ct.dispose(),Dt.dispose(),yn.dispose(),Ss.dispose(),lu.dispose(),ii.dispose(),wl.dispose(),wl.removeEventListener("sessionstart",$n),wl.removeEventListener("sessionend",_i),Jt&&(Jt.dispose(),Jt=null),hi.stop()},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{},this.renderBufferDirect=function(Tt,fn,xn,Dn,ti,Oi){fn===null&&(fn=ln);const hr=ti.isMesh&&ti.matrixWorld.determinant()<0,gr=function(xa,jp,el,Qr,Wo){jp.isScene!==!0&&(jp=ln),qe.resetTextureUnits();const LA=jp.fog,hy=Qr.isMeshStandardMaterial?jp.environment:null,jx=Et===null?ke.outputColorSpace:Et.isXRRenderTarget===!0||Et.texture.colorSpace&&Et.texture.colorSpace!==xr?Et.texture.colorSpace:Is,dy=(Qr.isMeshStandardMaterial?Dt:Ct).get(Qr.envMap||hy),Vx=Qr.vertexColors===!0&&!!el.attributes.color&&el.attributes.color.itemSize===4,Gx=!!Qr.normalMap&&!!el.attributes.tangent,Hx=!!el.morphAttributes.position,Wx=!!el.morphAttributes.normal,JE=!!el.morphAttributes.color,Qx=Qr.toneMapped?ke.toneMapping:dn,qx=el.morphAttributes.position||el.morphAttributes.normal||el.morphAttributes.color,Xx=qx!==void 0?qx.length:0,ro=wt.get(Qr),B_=Ie.state.lights;if(ot===!0&&(Vt===!0||xa!==Zt)){const rc=xa===Zt&&Qr.id===xt;Ii.setState(Qr,xa,rc)}let Vp=!1;Qr.version===ro.__version?ro.needsLights&&ro.lightsStateVersion!==B_.state.version||ro.outputColorSpace!==jx||Wo.isInstancedMesh&&ro.instancing===!1?Vp=!0:Wo.isInstancedMesh||ro.instancing!==!0?Wo.isSkinnedMesh&&ro.skinning===!1?Vp=!0:Wo.isSkinnedMesh||ro.skinning!==!0?ro.envMap!==dy||Qr.fog===!0&&ro.fog!==LA?Vp=!0:ro.numClippingPlanes===void 0||ro.numClippingPlanes===Ii.numPlanes&&ro.numIntersection===Ii.numIntersection?(ro.vertexAlphas!==Vx||ro.vertexTangents!==Gx||ro.morphTargets!==Hx||ro.morphNormals!==Wx||ro.morphColors!==JE||ro.toneMapping!==Qx||Gt.isWebGL2===!0&&ro.morphTargetsCount!==Xx)&&(Vp=!0):Vp=!0:Vp=!0:Vp=!0:(Vp=!0,ro.__version=Qr.version);let Nf=ro.currentProgram;Vp===!0&&(Nf=vi(Qr,jp,Wo));let NA=!1,c0=!1,kA=!1;const wa=Nf.getUniforms(),Km=ro.uniforms;if(Ut.useProgram(Nf.program)&&(NA=!0,c0=!0,kA=!0),Qr.id!==xt&&(xt=Qr.id,c0=!0),NA||Zt!==xa){if(wa.setValue(Jn,"projectionMatrix",xa.projectionMatrix),Gt.logarithmicDepthBuffer&&wa.setValue(Jn,"logDepthBufFC",2/(Math.log(xa.far+1)/Math.LN2)),Zt!==xa&&(Zt=xa,c0=!0,kA=!0),Qr.isShaderMaterial||Qr.isMeshPhongMaterial||Qr.isMeshToonMaterial||Qr.isMeshStandardMaterial||Qr.envMap){const rc=wa.map.cameraPosition;rc!==void 0&&rc.setValue(Jn,Yt.setFromMatrixPosition(xa.matrixWorld))}(Qr.isMeshPhongMaterial||Qr.isMeshToonMaterial||Qr.isMeshLambertMaterial||Qr.isMeshBasicMaterial||Qr.isMeshStandardMaterial||Qr.isShaderMaterial)&&wa.setValue(Jn,"isOrthographic",xa.isOrthographicCamera===!0),(Qr.isMeshPhongMaterial||Qr.isMeshToonMaterial||Qr.isMeshLambertMaterial||Qr.isMeshBasicMaterial||Qr.isMeshStandardMaterial||Qr.isShaderMaterial||Qr.isShadowMaterial||Wo.isSkinnedMesh)&&wa.setValue(Jn,"viewMatrix",xa.matrixWorldInverse)}if(Wo.isSkinnedMesh){wa.setOptional(Jn,Wo,"bindMatrix"),wa.setOptional(Jn,Wo,"bindMatrixInverse");const rc=Wo.skeleton;rc&&(Gt.floatVertexTextures?(rc.boneTexture===null&&rc.computeBoneTexture(),wa.setValue(Jn,"boneTexture",rc.boneTexture,qe),wa.setValue(Jn,"boneTextureSize",rc.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const u0=el.morphAttributes;var Gd,kc;(u0.position!==void 0||u0.normal!==void 0||u0.color!==void 0&&Gt.isWebGL2===!0)&&xs.update(Wo,el,Nf),(c0||ro.receiveShadow!==Wo.receiveShadow)&&(ro.receiveShadow=Wo.receiveShadow,wa.setValue(Jn,"receiveShadow",Wo.receiveShadow)),Qr.isMeshGouraudMaterial&&Qr.envMap!==null&&(Km.envMap.value=dy,Km.flipEnvMap.value=dy.isCubeTexture&&dy.isRenderTargetTexture===!1?-1:1),c0&&(wa.setValue(Jn,"toneMappingExposure",ke.toneMappingExposure),ro.needsLights&&(kc=kA,(Gd=Km).ambientLightColor.needsUpdate=kc,Gd.lightProbe.needsUpdate=kc,Gd.directionalLights.needsUpdate=kc,Gd.directionalLightShadows.needsUpdate=kc,Gd.pointLights.needsUpdate=kc,Gd.pointLightShadows.needsUpdate=kc,Gd.spotLights.needsUpdate=kc,Gd.spotLightShadows.needsUpdate=kc,Gd.rectAreaLights.needsUpdate=kc,Gd.hemisphereLights.needsUpdate=kc),LA&&Qr.fog===!0&&Ui.refreshFogUniforms(Km,LA),Ui.refreshMaterialUniforms(Km,Qr,ne,Y,ke.userData.transmissionRenderTarget||Jt),mv.upload(Jn,ro.uniformsList,Km,qe)),Qr.isShaderMaterial&&Qr.uniformsNeedUpdate===!0&&(mv.upload(Jn,ro.uniformsList,Km,qe),Qr.uniformsNeedUpdate=!1),Qr.isSpriteMaterial&&wa.setValue(Jn,"center",Wo.center),wa.setValue(Jn,"modelViewMatrix",Wo.modelViewMatrix),wa.setValue(Jn,"normalMatrix",Wo.normalMatrix),wa.setValue(Jn,"modelMatrix",Wo.matrixWorld);const py=Qr.extraUniformsToUpload;if(py&&Object.entries(py).forEach(([rc,h0])=>wa.setValue(Jn,rc,h0.value,qe)),Qr.isShaderMaterial||Qr.isRawShaderMaterial){const rc=Qr.uniformsGroups;for(let h0=0,kb=rc.length;h0<kb;h0++)if(Gt.isWebGL2){const Ub=rc[h0];lu.update(Ub,Nf),lu.bind(Ub,Nf)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Nf}(Tt,fn,xn,Dn,ti);Ut.setMaterial(Dn,hr);let es=xn.index,Bs=1;Dn.wireframe===!0&&(es=Kt.getWireframeAttribute(xn),Bs=2);const as=xn.drawRange,vs=xn.attributes.position;let js=as.start*Bs,co=(as.start+as.count)*Bs;Oi!==null&&(js=Math.max(js,Oi.start*Bs),co=Math.min(co,(Oi.start+Oi.count)*Bs)),es!==null?(js=Math.max(js,0),co=Math.min(co,es.count)):vs!=null&&(js=Math.max(js,0),co=Math.min(co,vs.count));const ea=co-js;if(ea<0||ea===1/0)return;let O_;Ss.setup(ti,Dn,gr,xn,es);let ta=yo;if(es!==null&&(O_=hn.get(es),ta=Pr,ta.setIndex(O_)),ti.isMesh)Dn.wireframe===!0?(Ut.setLineWidth(Dn.wireframeLinewidth*et()),ta.setMode(Jn.LINES)):ta.setMode(Jn.TRIANGLES);else if(ti.isLine){let xa=Dn.linewidth;xa===void 0&&(xa=1),Ut.setLineWidth(xa*et()),ti.isLineSegments?ta.setMode(Jn.LINES):ti.isLineLoop?ta.setMode(Jn.LINE_LOOP):ta.setMode(Jn.LINE_STRIP)}else ti.isPoints?ta.setMode(Jn.POINTS):ti.isSprite&&ta.setMode(Jn.TRIANGLES);if(ti.isInstancedMesh)ta.renderInstances(js,ea,ti.count);else if(xn.isInstancedBufferGeometry){const xa=xn._maxInstanceCount!==void 0?xn._maxInstanceCount:1/0,jp=Math.min(xn.instanceCount,xa);ta.renderInstances(js,ea,jp)}else ta.render(js,ea)},this.compile=function(Tt,fn){function xn(Dn,ti,Oi){Dn.transparent===!0&&Dn.side===ce&&Dn.forceSinglePass===!1?(Dn.side=ve,Dn.needsUpdate=!0,vi(Dn,ti,Oi),Dn.side=se,Dn.needsUpdate=!0,vi(Dn,ti,Oi),Dn.side=ce):vi(Dn,ti,Oi)}Ie=ci.get(Tt),Ie.init(),Oe.push(Ie),Tt.traverseVisible(function(Dn){Dn.isLight&&Dn.layers.test(fn.layers)&&(Ie.pushLight(Dn),Dn.castShadow&&Ie.pushShadow(Dn))}),Ie.setupLights(ke.useLegacyLights),Tt.traverse(function(Dn){const ti=Dn.material;if(ti)if(Array.isArray(ti))for(let Oi=0;Oi<ti.length;Oi++)xn(ti[Oi],Tt,Dn);else xn(ti,Tt,Dn)}),Oe.pop(),Ie=null};let cn=null;function $n(){hi.stop()}function _i(){hi.start()}const hi=new R0;function Di(Tt,fn,xn,Dn){if(Tt.visible===!1)return;if(Tt.layers.test(fn.layers)){if(Tt.isGroup)xn=Tt.renderOrder;else if(Tt.isLOD)Tt.autoUpdate===!0&&Tt.update(fn);else if(Tt.isLight)Ie.pushLight(Tt),Tt.castShadow&&Ie.pushShadow(Tt);else if(Tt.isSprite){if(!Tt.frustumCulled||nt.intersectsSprite(Tt)){Dn&&Yt.setFromMatrixPosition(Tt.matrixWorld).applyMatrix4(en);const Oi=yn.update(Tt),hr=Tt.material;hr.visible&&Ee.push(Tt,Oi,hr,xn,Yt.z,null)}}else if((Tt.isMesh||Tt.isLine||Tt.isPoints)&&(!Tt.frustumCulled||nt.intersectsObject(Tt))){Tt.isSkinnedMesh&&Tt.skeleton.frame!==yt.render.frame&&(Tt.skeleton.update(),Tt.skeleton.frame=yt.render.frame);const Oi=yn.update(Tt),hr=Tt.material;if(Dn&&(Oi.boundingSphere===null&&Oi.computeBoundingSphere(),Yt.copy(Oi.boundingSphere.center).applyMatrix4(Tt.matrixWorld).applyMatrix4(en)),Array.isArray(hr)){const gr=Oi.groups;for(let es=0,Bs=gr.length;es<Bs;es++){const as=gr[es],vs=hr[as.materialIndex];vs&&vs.visible&&Ee.push(Tt,Oi,vs,xn,Yt.z,as)}}else hr.visible&&Ee.push(Tt,Oi,hr,xn,Yt.z,null)}}const ti=Tt.children;for(let Oi=0,hr=ti.length;Oi<hr;Oi++)Di(ti[Oi],fn,xn,Dn)}function qi(Tt,fn,xn,Dn){const ti=Tt.opaque,Oi=Tt.transmissive,hr=Tt.transparent;if(Ie.setupLightsView(xn),ot===!0&&Ii.setGlobalState(ke.clippingPlanes,xn),ke.userData.transmissionRender===void 0&&ke.userData.renderTransmissionPass!==!1&&Oi.length>0&&function(gr,es,Bs,as){if(console.warn("three.js internal render transmission pass should not be called"),Jt===null){const ea=Gt.isWebGL2;Jt=new va(1024,1024,{generateMipmaps:!0,type:$e.has("EXT_color_buffer_half_float")?Xr:yi,minFilter:Mr,samples:ea&&k===!0?4:0})}const vs=ke.getRenderTarget();ke.setRenderTarget(Jt),ke.clear();const js=ke.toneMapping;ke.toneMapping=dn,wi(gr,Bs,as),qe.updateMultisampleRenderTarget(Jt),qe.updateRenderTargetMipmap(Jt);let co=!1;for(let ea=0,O_=es.length;ea<O_;ea++){const ta=es[ea],xa=ta.object,jp=ta.geometry,el=ta.material,Qr=ta.group;if(el.side===ce&&xa.layers.test(as.layers)){const Wo=el.side;el.side=ve,el.needsUpdate=!0,Li(xa,Bs,as,jp,el,Qr),el.side=Wo,el.needsUpdate=!0,co=!0}}co===!0&&(qe.updateMultisampleRenderTarget(Jt),qe.updateRenderTargetMipmap(Jt)),ke.setRenderTarget(vs),ke.toneMapping=js}([...ti,...hr],Oi,fn,xn),Dn&&Ut.viewport(g.copy(Dn)),ke.userData.opaqueRender!==!1&&ti.length>0&&wi(ti,fn,xn),ke.userData.transparentRender!==!1&&hr.length>0&&wi(hr,fn,xn),ke.userData.transmissionRender!==!1&&Oi.length>0){Jt||(Jt=new va(1,1));const gr=(ke.userData.transmissionRenderTarget||Jt).texture,es=Gt.isWebGL2,Bs=gr.generateMipmaps,as=gr.minFilter;es&&ke.userData.blurTransmissionTarget&&ke.userData.transmissionRenderTarget&&(gr.generateMipmaps=!0,gr.minFilter=Mr,gr.needsUpdate=!0,qe.updateMultisampleRenderTarget(ke.userData.transmissionRenderTarget),qe.updateRenderTargetMipmap(ke.userData.transmissionRenderTarget)),wi(Oi,fn,xn),es&&ke.userData.blurTransmissionTarget&&ke.userData.transmissionRenderTarget&&(gr.generateMipmaps=Bs,gr.minFilter=as,gr.needsUpdate=!0,qe.updateMultisampleRenderTarget(ke.userData.transmissionRenderTarget),qe.updateRenderTargetMipmap(ke.userData.transmissionRenderTarget))}Ut.buffers.depth.setTest(!0),Ut.buffers.depth.setMask(!0),Ut.buffers.color.setMask(!0),Ut.setPolygonOffset(!1)}function wi(Tt,fn,xn){const Dn={...ke.userData};ke.userData.opaqueRender=void 0,ke.userData.transparentRender=void 0,ke.userData.transmissionRender=void 0,ke.userData.backgroundRender=void 0;const ti=fn.isScene===!0?fn.overrideMaterial:null;for(let Oi=0,hr=Tt.length;Oi<hr;Oi++){const gr=Tt[Oi],es=gr.object,Bs=gr.geometry,as=ti===null?gr.material:ti,vs=gr.group;es.layers.test(xn.layers)&&Li(es,fn,xn,Bs,as,vs)}Object.assign(ke.userData,Dn)}function Li(Tt,fn,xn,Dn,ti,Oi){Tt.onBeforeRender(ke,fn,xn,Dn,ti,Oi),Tt.modelViewMatrix.multiplyMatrices(xn.matrixWorldInverse,Tt.matrixWorld),Tt.normalMatrix.getNormalMatrix(Tt.modelViewMatrix),ti.onBeforeRender(ke,fn,xn,Dn,Tt,Oi),ti.transparent===!0&&ti.side===ce&&ti.forceSinglePass===!1?(ti.side=ve,ti.needsUpdate=!0,ke.renderBufferDirect(xn,fn,Dn,ti,Tt,Oi),ti.side=se,ti.needsUpdate=!0,ke.renderBufferDirect(xn,fn,Dn,ti,Tt,Oi),ti.side=ce):ke.renderBufferDirect(xn,fn,Dn,ti,Tt,Oi),Tt.onAfterRender(ke,fn,xn,Dn,ti,Oi),ti.onAfterRender(ke,fn,xn,Dn,Tt,Oi)}function vi(Tt,fn,xn){fn.isScene!==!0&&(fn=ln);const Dn=wt.get(Tt),ti=Ie.state.lights,Oi=Ie.state.shadowsArray,hr=ti.state.version,gr=ii.getParameters(Tt,ti.state,Oi,fn,xn),es=ii.getProgramCacheKey(gr);let Bs=Dn.programs;Dn.environment=Tt.isMeshStandardMaterial?fn.environment:null,Dn.fog=fn.fog,Dn.envMap=(Tt.isMeshStandardMaterial?Dt:Ct).get(Tt.envMap||Dn.environment),Bs===void 0&&(Tt.addEventListener("dispose",qt),Bs=new Map,Dn.programs=Bs);let as=Bs.get(es);if(as!==void 0){if(Dn.currentProgram===as&&Dn.lightsStateVersion===hr)return mr(Tt,gr),as}else gr.uniforms=ii.getUniforms(Tt),Tt.onBuild(xn,gr,ke),Tt.onBeforeCompile(gr,ke),as=ii.acquireProgram(gr,es),Bs.set(es,as),Dn.uniforms=gr.uniforms;const vs=Dn.uniforms;(Tt.isShaderMaterial||Tt.isRawShaderMaterial)&&Tt.clipping!==!0||(vs.clippingPlanes=Ii.uniform),mr(Tt,gr),Dn.needsLights=function(ea){return ea.isMeshLambertMaterial||ea.isMeshToonMaterial||ea.isMeshPhongMaterial||ea.isMeshStandardMaterial||ea.isShadowMaterial||ea.isShaderMaterial&&ea.lights===!0}(Tt),Dn.lightsStateVersion=hr,Dn.needsLights&&(vs.ambientLightColor.value=ti.state.ambient,vs.lightProbe.value=ti.state.probe,vs.directionalLights.value=ti.state.directional,vs.directionalLightShadows.value=ti.state.directionalShadow,vs.spotLights.value=ti.state.spot,vs.spotLightShadows.value=ti.state.spotShadow,vs.rectAreaLights.value=ti.state.rectArea,vs.ltc_1.value=ti.state.rectAreaLTC1,vs.ltc_2.value=ti.state.rectAreaLTC2,vs.pointLights.value=ti.state.point,vs.pointLightShadows.value=ti.state.pointShadow,vs.hemisphereLights.value=ti.state.hemi,vs.directionalShadowMap.value=ti.state.directionalShadowMap,vs.directionalShadowMatrix.value=ti.state.directionalShadowMatrix,vs.spotShadowMap.value=ti.state.spotShadowMap,vs.spotLightMatrix.value=ti.state.spotLightMatrix,vs.spotLightMap.value=ti.state.spotLightMap,vs.pointShadowMap.value=ti.state.pointShadowMap,vs.pointShadowMatrix.value=ti.state.pointShadowMatrix);const js=as.getUniforms(),co=mv.seqWithValue(js.seq,vs);return Dn.currentProgram=as,Dn.uniformsList=co,as}function mr(Tt,fn){const xn=wt.get(Tt);xn.outputColorSpace=fn.outputColorSpace,xn.instancing=fn.instancing,xn.skinning=fn.skinning,xn.morphTargets=fn.morphTargets,xn.morphNormals=fn.morphNormals,xn.morphColors=fn.morphColors,xn.morphTargetsCount=fn.morphTargetsCount,xn.numClippingPlanes=fn.numClippingPlanes,xn.numIntersection=fn.numClipIntersection,xn.vertexAlphas=fn.vertexAlphas,xn.vertexTangents=fn.vertexTangents,xn.toneMapping=fn.toneMapping}hi.setAnimationLoop(function(Tt){cn&&cn(Tt)}),typeof self<"u"&&hi.setContext(self),this.setAnimationLoop=function(Tt){cn=Tt,wl.setAnimationLoop(Tt),Tt===null?hi.stop():hi.start()},wl.addEventListener("sessionstart",$n),wl.addEventListener("sessionend",_i),this.render=function(Tt,fn){if(fn===void 0||fn.isCamera===!0){if(Ge!==!0){if(Tt.matrixWorldAutoUpdate===!0&&Tt.updateMatrixWorld(),fn.parent===null&&fn.matrixWorldAutoUpdate===!0&&fn.updateMatrixWorld(),wl.enabled===!0&&wl.isPresenting===!0&&(wl.cameraAutoUpdate===!0&&wl.updateCamera(fn),fn=wl.getCamera()),Tt.isScene===!0&&Tt.onBeforeRender(ke,Tt,fn,Et),Ie=ci.get(Tt,Oe.length),Ie.init(),Oe.push(Ie),en.multiplyMatrices(fn.projectionMatrix,fn.matrixWorldInverse),nt.setFromProjectionMatrix(en),Vt=this.localClippingEnabled,ot=Ii.init(this.clippingPlanes,Vt),Ee=Bi.get(Tt,Ue.length),Ee.init(),Ue.push(Ee),Di(Tt,fn,0,ke.sortObjects),Ee.finish(),ke.sortObjects===!0&&Ee.sort(be,Me),ke.userData.shadowMapRender!==!1){ot===!0&&Ii.beginShadows();const xn=Ie.state.shadowsArray;xn.length>0&&$i.render(xn,Tt,fn),ot===!0&&Ii.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),ke.userData.backgroundRender!==!1&&sr.render(Ee,Tt),ke.userData.sceneRender!==!1)if(Ie.setupLights(ke.useLegacyLights),fn.isArrayCamera){const xn=fn.cameras;for(let Dn=0,ti=xn.length;Dn<ti;Dn++){const Oi=xn[Dn];qi(Ee,Tt,Oi,Oi.viewport)}}else qi(Ee,Tt,fn);Et!==null&&(qe.updateMultisampleRenderTarget(Et),qe.updateRenderTargetMipmap(Et)),Tt.isScene===!0&&Tt.onAfterRender(ke,Tt,fn),Ss.resetDefaultState(),xt=-1,Zt=null,Oe.pop(),Ie=Oe.length>0?Oe[Oe.length-1]:null,Ue.pop(),Ee=Ue.length>0?Ue[Ue.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return Je},this.getActiveMipmapLevel=function(){return Rt},this.getRenderTarget=function(){return Et},this.setRenderTargetTextures=function(Tt,fn,xn){wt.get(Tt.texture).__webglTexture=fn,wt.get(Tt.depthTexture).__webglTexture=xn;const Dn=wt.get(Tt);Dn.__hasExternalTextures=!0,Dn.__hasExternalTextures&&(Dn.__autoAllocateDepthBuffer=xn===void 0,Dn.__autoAllocateDepthBuffer||$e.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Dn.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Tt,fn){const xn=wt.get(Tt);xn.__webglFramebuffer=fn,xn.__useDefaultFramebuffer=fn===void 0},this.setRenderTarget=function(Tt,fn=0,xn=0){Et=Tt,Je=fn,Rt=xn;let Dn=!0,ti=null,Oi=!1,hr=!1;if(Tt){const gr=wt.get(Tt);gr.__useDefaultFramebuffer!==void 0?(Ut.bindFramebuffer(Jn.FRAMEBUFFER,null),Dn=!1):gr.__webglFramebuffer===void 0?qe.setupRenderTarget(Tt):gr.__hasExternalTextures&&qe.rebindTextures(Tt,wt.get(Tt.texture).__webglTexture,wt.get(Tt.depthTexture).__webglTexture);const es=Tt.texture;(es.isData3DTexture||es.isDataArrayTexture||es.isCompressedArrayTexture)&&(hr=!0);const Bs=wt.get(Tt).__webglFramebuffer;Tt.isWebGLCubeRenderTarget?(ti=Bs[fn],Oi=!0):ti=Gt.isWebGL2&&Tt.samples>0&&qe.useMultisampledRTT(Tt)===!1?wt.get(Tt).__webglMultisampledFramebuffer:Bs,g.copy(Tt.viewport),b.copy(Tt.scissor),D=Tt.scissorTest}else g.copy(De).multiplyScalar(ne).floor(),b.copy(je).multiplyScalar(ne).floor(),D=st;if(Ut.bindFramebuffer(Jn.FRAMEBUFFER,ti)&&Gt.drawBuffers&&Dn&&Ut.drawBuffers(Tt,ti),Ut.viewport(g),Ut.scissor(b),Ut.setScissorTest(D),Oi){const gr=wt.get(Tt.texture);Jn.framebufferTexture2D(Jn.FRAMEBUFFER,Jn.COLOR_ATTACHMENT0,Jn.TEXTURE_CUBE_MAP_POSITIVE_X+fn,gr.__webglTexture,xn)}else if(hr){const gr=wt.get(Tt.texture),es=fn||0;Jn.framebufferTextureLayer(Jn.FRAMEBUFFER,Jn.COLOR_ATTACHMENT0,gr.__webglTexture,xn||0,es)}xt=-1},this.readRenderTargetPixels=function(Tt,fn,xn,Dn,ti,Oi,hr){if(!Tt||!Tt.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let gr=wt.get(Tt).__webglFramebuffer;if(Tt.isWebGLCubeRenderTarget&&hr!==void 0&&(gr=gr[hr]),gr){Ut.bindFramebuffer(Jn.FRAMEBUFFER,gr);try{const es=Tt.texture,Bs=es.format,as=es.type;if(Bs!==uo&&ds.convert(Bs)!==Jn.getParameter(Jn.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const vs=as===Xr&&($e.has("EXT_color_buffer_half_float")||Gt.isWebGL2&&$e.has("EXT_color_buffer_float"));if(!(as===yi||ds.convert(as)===Jn.getParameter(Jn.IMPLEMENTATION_COLOR_READ_TYPE)||as===jr&&(Gt.isWebGL2||$e.has("OES_texture_float")||$e.has("WEBGL_color_buffer_float"))||vs))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fn>=0&&fn<=Tt.width-Dn&&xn>=0&&xn<=Tt.height-ti&&Jn.readPixels(fn,xn,Dn,ti,ds.convert(Bs),ds.convert(as),Oi)}finally{const es=Et?wt.get(Et).__webglFramebuffer:null;Ut.bindFramebuffer(Jn.FRAMEBUFFER,es)}}},this.copyFramebufferToTexture=function(Tt,fn,xn=0){const Dn=Math.pow(2,-xn),ti=Math.floor(fn.image.width*Dn),Oi=Math.floor(fn.image.height*Dn);qe.setTexture2D(fn,0),Jn.copyTexSubImage2D(Jn.TEXTURE_2D,xn,0,0,Tt.x,Tt.y,ti,Oi),Ut.unbindTexture()},this.copyTextureToTexture=function(Tt,fn,xn,Dn=0){const ti=fn.image.width,Oi=fn.image.height,hr=ds.convert(xn.format),gr=ds.convert(xn.type);qe.setTexture2D(xn,0),Jn.pixelStorei(Jn.UNPACK_FLIP_Y_WEBGL,xn.flipY),Jn.pixelStorei(Jn.UNPACK_PREMULTIPLY_ALPHA_WEBGL,xn.premultiplyAlpha),Jn.pixelStorei(Jn.UNPACK_ALIGNMENT,xn.unpackAlignment),fn.isDataTexture?Jn.texSubImage2D(Jn.TEXTURE_2D,Dn,Tt.x,Tt.y,ti,Oi,hr,gr,fn.image.data):fn.isCompressedTexture?Jn.compressedTexSubImage2D(Jn.TEXTURE_2D,Dn,Tt.x,Tt.y,fn.mipmaps[0].width,fn.mipmaps[0].height,hr,fn.mipmaps[0].data):Jn.texSubImage2D(Jn.TEXTURE_2D,Dn,Tt.x,Tt.y,hr,gr,fn.image),Dn===0&&xn.generateMipmaps&&Jn.generateMipmap(Jn.TEXTURE_2D),Ut.unbindTexture()},this.copyTextureToTexture3D=function(Tt,fn,xn,Dn,ti=0){if(ke.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Oi=Tt.max.x-Tt.min.x+1,hr=Tt.max.y-Tt.min.y+1,gr=Tt.max.z-Tt.min.z+1,es=ds.convert(Dn.format),Bs=ds.convert(Dn.type);let as;if(Dn.isData3DTexture)qe.setTexture3D(Dn,0),as=Jn.TEXTURE_3D;else{if(!Dn.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");qe.setTexture2DArray(Dn,0),as=Jn.TEXTURE_2D_ARRAY}Jn.pixelStorei(Jn.UNPACK_FLIP_Y_WEBGL,Dn.flipY),Jn.pixelStorei(Jn.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Dn.premultiplyAlpha),Jn.pixelStorei(Jn.UNPACK_ALIGNMENT,Dn.unpackAlignment);const vs=Jn.getParameter(Jn.UNPACK_ROW_LENGTH),js=Jn.getParameter(Jn.UNPACK_IMAGE_HEIGHT),co=Jn.getParameter(Jn.UNPACK_SKIP_PIXELS),ea=Jn.getParameter(Jn.UNPACK_SKIP_ROWS),O_=Jn.getParameter(Jn.UNPACK_SKIP_IMAGES),ta=xn.isCompressedTexture?xn.mipmaps[0]:xn.image;Jn.pixelStorei(Jn.UNPACK_ROW_LENGTH,ta.width),Jn.pixelStorei(Jn.UNPACK_IMAGE_HEIGHT,ta.height),Jn.pixelStorei(Jn.UNPACK_SKIP_PIXELS,Tt.min.x),Jn.pixelStorei(Jn.UNPACK_SKIP_ROWS,Tt.min.y),Jn.pixelStorei(Jn.UNPACK_SKIP_IMAGES,Tt.min.z),xn.isDataTexture||xn.isData3DTexture?Jn.texSubImage3D(as,ti,fn.x,fn.y,fn.z,Oi,hr,gr,es,Bs,ta.data):xn.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Jn.compressedTexSubImage3D(as,ti,fn.x,fn.y,fn.z,Oi,hr,gr,es,ta.data)):Jn.texSubImage3D(as,ti,fn.x,fn.y,fn.z,Oi,hr,gr,es,Bs,ta),Jn.pixelStorei(Jn.UNPACK_ROW_LENGTH,vs),Jn.pixelStorei(Jn.UNPACK_IMAGE_HEIGHT,js),Jn.pixelStorei(Jn.UNPACK_SKIP_PIXELS,co),Jn.pixelStorei(Jn.UNPACK_SKIP_ROWS,ea),Jn.pixelStorei(Jn.UNPACK_SKIP_IMAGES,O_),ti===0&&Dn.generateMipmaps&&Jn.generateMipmap(as),Ut.unbindTexture()},this.initTexture=function(Tt){Tt.isCubeTexture?qe.setTextureCube(Tt,0):Tt.isData3DTexture?qe.setTexture3D(Tt,0):Tt.isDataArrayTexture||Tt.isCompressedArrayTexture?qe.setTexture2DArray(Tt,0):qe.setTexture2D(Tt,0),Ut.unbindTexture()},this.resetState=function(){Je=0,Rt=0,Et=null,Ut.reset(),Ss.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(r){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!r}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===xr?br:No}set outputEncoding(r){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=r===br?xr:Is}}class hA extends Tv{}hA.prototype.isWebGL1Renderer=!0;class Qg{constructor(r,d=25e-5){this.isFogExp2=!0,this.name="",this.color=new Fi(r),this.density=d}clone(){return new Qg(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class qg{constructor(r,d=1,_=1e3){this.isFog=!0,this.name="",this.color=new Fi(r),this.near=d,this.far=_}clone(){return new qg(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class gm extends bs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(r,d){return super.copy(r,d),r.background!==null&&(this.background=r.background.clone()),r.environment!==null&&(this.environment=r.environment.clone()),r.fog!==null&&(this.fog=r.fog.clone()),this.backgroundBlurriness=r.backgroundBlurriness,this.backgroundIntensity=r.backgroundIntensity,r.overrideMaterial!==null&&(this.overrideMaterial=r.overrideMaterial.clone()),this.matrixAutoUpdate=r.matrixAutoUpdate,this}toJSON(r){const d=super.toJSON(r);return this.fog!==null&&(d.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(d.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(d.object.backgroundIntensity=this.backgroundIntensity),d}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(r){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=r}}class Ap{constructor(r,d){this.isInterleavedBuffer=!0,this.array=r,this.stride=d,this.count=r!==void 0?r.length/d:0,this.usage=Hu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Cl()}onUploadCallback(){}set needsUpdate(r){r===!0&&this.version++}setUsage(r){return this.usage=r,this}copy(r){return this.array=new r.array.constructor(r.array),this.count=r.count,this.stride=r.stride,this.usage=r.usage,this}copyAt(r,d,_){r*=this.stride,_*=d.stride;for(let A=0,E=this.stride;A<E;A++)this.array[r+A]=d.array[_+A];return this}set(r,d=0){return this.array.set(r,d),this}clone(r){r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cl()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const d=new this.array.constructor(r.arrayBuffers[this.array.buffer._uuid]),_=new this.constructor(d,this.stride);return _.setUsage(this.usage),_}onUpload(r){return this.onUploadCallback=r,this}toJSON(r){return r.arrayBuffers===void 0&&(r.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cl()),r.arrayBuffers[this.array.buffer._uuid]===void 0&&(r.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ya=new zt;class Nl{constructor(r,d,_,A=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=r,this.itemSize=d,this.offset=_,this.normalized=A}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(r){this.data.needsUpdate=r}applyMatrix4(r){for(let d=0,_=this.data.count;d<_;d++)Ya.fromBufferAttribute(this,d),Ya.applyMatrix4(r),this.setXYZ(d,Ya.x,Ya.y,Ya.z);return this}applyNormalMatrix(r){for(let d=0,_=this.count;d<_;d++)Ya.fromBufferAttribute(this,d),Ya.applyNormalMatrix(r),this.setXYZ(d,Ya.x,Ya.y,Ya.z);return this}transformDirection(r){for(let d=0,_=this.count;d<_;d++)Ya.fromBufferAttribute(this,d),Ya.transformDirection(r),this.setXYZ(d,Ya.x,Ya.y,Ya.z);return this}setX(r,d){return this.normalized&&(d=rs(d,this.array)),this.data.array[r*this.data.stride+this.offset]=d,this}setY(r,d){return this.normalized&&(d=rs(d,this.array)),this.data.array[r*this.data.stride+this.offset+1]=d,this}setZ(r,d){return this.normalized&&(d=rs(d,this.array)),this.data.array[r*this.data.stride+this.offset+2]=d,this}setW(r,d){return this.normalized&&(d=rs(d,this.array)),this.data.array[r*this.data.stride+this.offset+3]=d,this}getX(r){let d=this.data.array[r*this.data.stride+this.offset];return this.normalized&&(d=aa(d,this.array)),d}getY(r){let d=this.data.array[r*this.data.stride+this.offset+1];return this.normalized&&(d=aa(d,this.array)),d}getZ(r){let d=this.data.array[r*this.data.stride+this.offset+2];return this.normalized&&(d=aa(d,this.array)),d}getW(r){let d=this.data.array[r*this.data.stride+this.offset+3];return this.normalized&&(d=aa(d,this.array)),d}setXY(r,d,_){return r=r*this.data.stride+this.offset,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array)),this.data.array[r+0]=d,this.data.array[r+1]=_,this}setXYZ(r,d,_,A){return r=r*this.data.stride+this.offset,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array)),this.data.array[r+0]=d,this.data.array[r+1]=_,this.data.array[r+2]=A,this}setXYZW(r,d,_,A,E){return r=r*this.data.stride+this.offset,this.normalized&&(d=rs(d,this.array),_=rs(_,this.array),A=rs(A,this.array),E=rs(E,this.array)),this.data.array[r+0]=d,this.data.array[r+1]=_,this.data.array[r+2]=A,this.data.array[r+3]=E,this}clone(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let _=0;_<this.count;_++){const A=_*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)d.push(this.data.array[A+E])}return new Ns(new this.array.constructor(d),this.itemSize,this.normalized)}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.clone(r)),new Nl(r.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(r){if(r===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const d=[];for(let _=0;_<this.count;_++){const A=_*this.data.stride+this.offset;for(let E=0;E<this.itemSize;E++)d.push(this.data.array[A+E])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:d,normalized:this.normalized}}return r.interleavedBuffers===void 0&&(r.interleavedBuffers={}),r.interleavedBuffers[this.data.uuid]===void 0&&(r.interleavedBuffers[this.data.uuid]=this.data.toJSON(r)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Cv extends da{constructor(r){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Fi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.rotation=r.rotation,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}let kl;const hl=new zt,Ka=new zt,bp=new zt,Na=new li,_m=new li,dA=new Gr,vm=new zt,ym=new zt,dl=new zt,pl=new li,z0=new li,j0=new li;class mf extends bs{constructor(r){if(super(),this.isSprite=!0,this.type="Sprite",kl===void 0){kl=new Fe;const d=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),_=new Ap(d,5);kl.setIndex([0,1,2,0,2,3]),kl.setAttribute("position",new Nl(_,3,0,!1)),kl.setAttribute("uv",new Nl(_,2,3,!1))}this.geometry=kl,this.material=r!==void 0?r:new Cv,this.center=new li(.5,.5)}raycast(r,d){r.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ka.setFromMatrixScale(this.matrixWorld),dA.copy(r.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(r.camera.matrixWorldInverse,this.matrixWorld),bp.setFromMatrixPosition(this.modelViewMatrix),r.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ka.multiplyScalar(-bp.z);const _=this.material.rotation;let A,E;_!==0&&(E=Math.cos(_),A=Math.sin(_));const P=this.center;xp(vm.set(-.5,-.5,0),bp,P,Ka,A,E),xp(ym.set(.5,-.5,0),bp,P,Ka,A,E),xp(dl.set(.5,.5,0),bp,P,Ka,A,E),pl.set(0,0),z0.set(1,0),j0.set(1,1);let k=r.ray.intersectTriangle(vm,ym,dl,!1,hl);if(k===null&&(xp(ym.set(-.5,.5,0),bp,P,Ka,A,E),z0.set(0,1),k=r.ray.intersectTriangle(vm,dl,ym,!1,hl),k===null))return;const Q=r.ray.origin.distanceTo(hl);Q<r.near||Q>r.far||d.push({distance:Q,point:hl.clone(),uv:Cs.getInterpolation(hl,vm,ym,dl,pl,z0,j0,new li),face:null,object:this})}copy(r,d){return super.copy(r,d),r.center!==void 0&&this.center.copy(r.center),this.material=r.material,this}}function xp(R,r,d,_,A,E){Na.subVectors(R,d).addScalar(.5).multiply(_),A!==void 0?(_m.x=E*Na.x-A*Na.y,_m.y=A*Na.x+E*Na.y):_m.copy(Na),R.copy(r),R.x+=_m.x,R.y+=_m.y,R.applyMatrix4(dA)}const fl=new zt,gf=new zt;class wp extends bs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(r){super.copy(r,!1);const d=r.levels;for(let _=0,A=d.length;_<A;_++){const E=d[_];this.addLevel(E.object.clone(),E.distance,E.hysteresis)}return this.autoUpdate=r.autoUpdate,this}addLevel(r,d=0,_=0){d=Math.abs(d);const A=this.levels;let E;for(E=0;E<A.length&&!(d<A[E].distance);E++);return A.splice(E,0,{distance:d,hysteresis:_,object:r}),this.add(r),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(r){const d=this.levels;if(d.length>0){let _,A;for(_=1,A=d.length;_<A;_++){let E=d[_].distance;if(d[_].object.visible&&(E-=E*d[_].hysteresis),r<E)break}return d[_-1].object}return null}raycast(r,d){if(this.levels.length>0){fl.setFromMatrixPosition(this.matrixWorld);const _=r.ray.origin.distanceTo(fl);this.getObjectForDistance(_).raycast(r,d)}}update(r){const d=this.levels;if(d.length>1){fl.setFromMatrixPosition(r.matrixWorld),gf.setFromMatrixPosition(this.matrixWorld);const _=fl.distanceTo(gf)/r.zoom;let A,E;for(d[0].object.visible=!0,A=1,E=d.length;A<E;A++){let P=d[A].distance;if(d[A].object.visible&&(P-=P*d[A].hysteresis),!(_>=P))break;d[A-1].object.visible=!1,d[A].object.visible=!0}for(this._currentLevel=A-1;A<E;A++)d[A].object.visible=!1}}toJSON(r){const d=super.toJSON(r);this.autoUpdate===!1&&(d.object.autoUpdate=!1),d.object.levels=[];const _=this.levels;for(let A=0,E=_.length;A<E;A++){const P=_[A];d.object.levels.push({object:P.object.uuid,distance:P.distance,hysteresis:P.hysteresis})}return d}}const ml=new zt,_f=new Vr,Fh=new Vr,Xg=new zt,Yg=new Gr,vf=new zt;class pA extends Ko{constructor(r,d){super(r,d),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Gr,this.bindMatrixInverse=new Gr,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const r=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ql),this.boundingBox.makeEmpty();const d=r.getAttribute("position");for(let _=0;_<d.count;_++)vf.fromBufferAttribute(d,_),this.applyBoneTransform(_,vf),this.boundingBox.expandByPoint(vf)}computeBoundingSphere(){const r=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new la),this.boundingSphere.makeEmpty();const d=r.getAttribute("position");for(let _=0;_<d.count;_++)vf.fromBufferAttribute(d,_),this.applyBoneTransform(_,vf),this.boundingSphere.expandByPoint(vf)}copy(r,d){return super.copy(r,d),this.bindMode=r.bindMode,this.bindMatrix.copy(r.bindMatrix),this.bindMatrixInverse.copy(r.bindMatrixInverse),this.skeleton=r.skeleton,this}getVertexPosition(r,d){return super.getVertexPosition(r,d),this.applyBoneTransform(r,d),d}bind(r,d){this.skeleton=r,d===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),d=this.matrixWorld),this.bindMatrix.copy(d),this.bindMatrixInverse.copy(d).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const r=new Vr,d=this.geometry.attributes.skinWeight;for(let _=0,A=d.count;_<A;_++){r.fromBufferAttribute(d,_);const E=1/r.manhattanLength();E!==1/0?r.multiplyScalar(E):r.set(1,0,0,0),d.setXYZW(_,r.x,r.y,r.z,r.w)}}updateMatrixWorld(r){super.updateMatrixWorld(r),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(r,d){const _=this.skeleton,A=this.geometry;_f.fromBufferAttribute(A.attributes.skinIndex,r),Fh.fromBufferAttribute(A.attributes.skinWeight,r),ml.copy(d).applyMatrix4(this.bindMatrix),d.set(0,0,0);for(let E=0;E<4;E++){const P=Fh.getComponent(E);if(P!==0){const k=_f.getComponent(E);Yg.multiplyMatrices(_.bones[k].matrixWorld,_.boneInverses[k]),d.addScaledVector(Xg.copy(ml).applyMatrix4(Yg),P)}}return d.applyMatrix4(this.bindMatrixInverse)}boneTransform(r,d){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(r,d)}}class zh extends bs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ep extends Us{constructor(r=null,d=1,_=1,A,E,P,k,Q,G=nn,re=nn,xe,ye){super(null,P,k,Q,G,re,A,E,xe,ye),this.isDataTexture=!0,this.image={data:r,width:d,height:_},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const $a=new Gr,Ds=new Gr;class Cd{constructor(r=[],d=[]){this.uuid=Cl(),this.bones=r.slice(0),this.boneInverses=d,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const r=this.bones,d=this.boneInverses;if(this.boneMatrices=new Float32Array(16*r.length),d.length===0)this.calculateInverses();else if(r.length!==d.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let _=0,A=this.bones.length;_<A;_++)this.boneInverses.push(new Gr)}}calculateInverses(){this.boneInverses.length=0;for(let r=0,d=this.bones.length;r<d;r++){const _=new Gr;this.bones[r]&&_.copy(this.bones[r].matrixWorld).invert(),this.boneInverses.push(_)}}pose(){for(let r=0,d=this.bones.length;r<d;r++){const _=this.bones[r];_&&_.matrixWorld.copy(this.boneInverses[r]).invert()}for(let r=0,d=this.bones.length;r<d;r++){const _=this.bones[r];_&&(_.parent&&_.parent.isBone?(_.matrix.copy(_.parent.matrixWorld).invert(),_.matrix.multiply(_.matrixWorld)):_.matrix.copy(_.matrixWorld),_.matrix.decompose(_.position,_.quaternion,_.scale))}}update(){const r=this.bones,d=this.boneInverses,_=this.boneMatrices,A=this.boneTexture;for(let E=0,P=r.length;E<P;E++){const k=r[E]?r[E].matrixWorld:Ds;$a.multiplyMatrices(k,d[E]),$a.toArray(_,16*E)}A!==null&&(A.needsUpdate=!0)}clone(){return new Cd(this.bones,this.boneInverses)}computeBoneTexture(){let r=Math.sqrt(4*this.bones.length);r=kr(r),r=Math.max(r,4);const d=new Float32Array(r*r*4);d.set(this.boneMatrices);const _=new Ep(d,r,r,uo,jr);return _.needsUpdate=!0,this.boneMatrices=d,this.boneTexture=_,this.boneTextureSize=r,this}getBoneByName(r){for(let d=0,_=this.bones.length;d<_;d++){const A=this.bones[d];if(A.name===r)return A}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(r,d){this.uuid=r.uuid;for(let _=0,A=r.bones.length;_<A;_++){const E=r.bones[_];let P=d[E];P===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",E),P=new zh),this.bones.push(P),this.boneInverses.push(new Gr().fromArray(r.boneInverses[_]))}return this.init(),this}toJSON(){const r={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};r.uuid=this.uuid;const d=this.bones,_=this.boneInverses;for(let A=0,E=d.length;A<E;A++){const P=d[A];r.bones.push(P.uuid);const k=_[A];r.boneInverses.push(k.toArray())}return r}}class Fs extends Ns{constructor(r,d,_,A=1){super(r,d,_),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=A}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}toJSON(){const r=super.toJSON();return r.meshPerAttribute=this.meshPerAttribute,r.isInstancedBufferAttribute=!0,r}}const Cc=new Gr,jh=new Gr,yf=[],Cu=new Ql,Am=new Gr,Rd=new Ko,Af=new la;class Kg extends Ko{constructor(r,d,_){super(r,d),this.isInstancedMesh=!0,this.instanceMatrix=new Fs(new Float32Array(16*_),16),this.instanceColor=null,this.sourceTrs=null,this.count=_,this.boundingBox=null,this.boundingSphere=null;for(let A=0;A<_;A++)this.setMatrixAt(A,Am)}computeBoundingBox(){const r=this.geometry,d=this.count;this.boundingBox===null&&(this.boundingBox=new Ql),r.boundingBox===null&&r.computeBoundingBox(),this.boundingBox.makeEmpty();for(let _=0;_<d;_++)this.getMatrixAt(_,Cc),Cu.copy(r.boundingBox).applyMatrix4(Cc),this.boundingBox.union(Cu)}computeBoundingSphere(){const r=this.geometry,d=this.count;this.boundingSphere===null&&(this.boundingSphere=new la),r.boundingSphere===null&&r.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let _=0;_<d;_++)this.getMatrixAt(_,Cc),Af.copy(r.boundingSphere).applyMatrix4(Cc),this.boundingSphere.union(Af)}copy(r,d){return super.copy(r,d),r.isInstancedMesh?(this.instanceMatrix.copy(r.instanceMatrix),r.instanceColor!==null&&(this.instanceColor=r.instanceColor.clone()),this.count=r.count,this):this}getColorAt(r,d){d.fromArray(this.instanceColor.array,3*r)}getMatrixAt(r,d){d.fromArray(this.instanceMatrix.array,16*r)}raycast(r,d){const _=this.matrixWorld,A=this.count;if(Rd.geometry=this.geometry,Rd.material=this.material,Rd.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Af.copy(this.boundingSphere),Af.applyMatrix4(_),r.ray.intersectsSphere(Af)!==!1))for(let E=0;E<A;E++){this.getMatrixAt(E,Cc),jh.multiplyMatrices(_,Cc),Rd.matrixWorld=jh,Rd.raycast(r,yf);for(let P=0,k=yf.length;P<k;P++){const Q=yf[P];Q.instanceId=E,Q.object=this,d.push(Q)}yf.length=0}}setColorAt(r,d){this.instanceColor===null&&(this.instanceColor=new Fs(new Float32Array(3*this.instanceMatrix.count),3)),d.toArray(this.instanceColor.array,3*r)}setMatrixAt(r,d){d.toArray(this.instanceMatrix.array,16*r)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class gl extends da{constructor(r){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Fi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.linewidth=r.linewidth,this.linecap=r.linecap,this.linejoin=r.linejoin,this.fog=r.fog,this}}const $g=new zt,bm=new zt,fA=new Gr,Jg=new Sh,xm=new la;class Vh extends bs{constructor(r=new Fe,d=new gl){super(),this.isLine=!0,this.type="Line",this.geometry=r,this.material=d,this.updateMorphTargets()}copy(r,d){return super.copy(r,d),this.material=r.material,this.geometry=r.geometry,this}computeLineDistances(){const r=this.geometry;if(r.index===null){const d=r.attributes.position,_=[0];for(let A=1,E=d.count;A<E;A++)$g.fromBufferAttribute(d,A-1),bm.fromBufferAttribute(d,A),_[A]=_[A-1],_[A]+=$g.distanceTo(bm);r.setAttribute("lineDistance",new tr(_,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(r,d){const _=this.geometry,A=this.matrixWorld,E=r.params.Line.threshold,P=_.drawRange;if(_.boundingSphere===null&&_.computeBoundingSphere(),xm.copy(_.boundingSphere),xm.applyMatrix4(A),xm.radius+=E,r.ray.intersectsSphere(xm)===!1)return;fA.copy(A).invert(),Jg.copy(r.ray).applyMatrix4(fA);const k=E/((this.scale.x+this.scale.y+this.scale.z)/3),Q=k*k,G=new zt,re=new zt,xe=new zt,ye=new zt,Ee=this.isLineSegments?2:1,Ie=_.index,Ue=_.attributes.position;if(Ie!==null)for(let Oe=Math.max(0,P.start),ke=Math.min(Ie.count,P.start+P.count)-1;Oe<ke;Oe+=Ee){const Ge=Ie.getX(Oe),Je=Ie.getX(Oe+1);if(G.fromBufferAttribute(Ue,Ge),re.fromBufferAttribute(Ue,Je),Jg.distanceSqToSegment(G,re,ye,xe)>Q)continue;ye.applyMatrix4(this.matrixWorld);const Rt=r.ray.origin.distanceTo(ye);Rt<r.near||Rt>r.far||d.push({distance:Rt,point:xe.clone().applyMatrix4(this.matrixWorld),index:Oe,face:null,faceIndex:null,object:this})}else for(let Oe=Math.max(0,P.start),ke=Math.min(Ue.count,P.start+P.count)-1;Oe<ke;Oe+=Ee){if(G.fromBufferAttribute(Ue,Oe),re.fromBufferAttribute(Ue,Oe+1),Jg.distanceSqToSegment(G,re,ye,xe)>Q)continue;ye.applyMatrix4(this.matrixWorld);const Ge=r.ray.origin.distanceTo(ye);Ge<r.near||Ge>r.far||d.push({distance:Ge,point:xe.clone().applyMatrix4(this.matrixWorld),index:Oe,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const r=this.geometry.morphAttributes,d=Object.keys(r);if(d.length>0){const _=r[d[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,E=_.length;A<E;A++){const P=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=A}}}}}const V0=new zt,Zg=new zt;class Ja extends Vh{constructor(r,d){super(r,d),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const r=this.geometry;if(r.index===null){const d=r.attributes.position,_=[];for(let A=0,E=d.count;A<E;A+=2)V0.fromBufferAttribute(d,A),Zg.fromBufferAttribute(d,A+1),_[A]=A===0?0:_[A-1],_[A+1]=_[A]+V0.distanceTo(Zg);r.setAttribute("lineDistance",new tr(_,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class G0 extends Vh{constructor(r,d){super(r,d),this.isLineLoop=!0,this.type="LineLoop"}}class e_ extends da{constructor(r){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Fi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.alphaMap=r.alphaMap,this.size=r.size,this.sizeAttenuation=r.sizeAttenuation,this.fog=r.fog,this}}const wm=new Gr,Em=new Sh,Sm=new la,lo=new zt;class Rv extends bs{constructor(r=new Fe,d=new e_){super(),this.isPoints=!0,this.type="Points",this.geometry=r,this.material=d,this.updateMorphTargets()}copy(r,d){return super.copy(r,d),this.material=r.material,this.geometry=r.geometry,this}raycast(r,d){const _=this.geometry,A=this.matrixWorld,E=r.params.Points.threshold,P=_.drawRange;if(_.boundingSphere===null&&_.computeBoundingSphere(),Sm.copy(_.boundingSphere),Sm.applyMatrix4(A),Sm.radius+=E,r.ray.intersectsSphere(Sm)===!1)return;wm.copy(A).invert(),Em.copy(r.ray).applyMatrix4(wm);const k=E/((this.scale.x+this.scale.y+this.scale.z)/3),Q=k*k,G=_.index,re=_.attributes.position;if(G!==null)for(let xe=Math.max(0,P.start),ye=Math.min(G.count,P.start+P.count);xe<ye;xe++){const Ee=G.getX(xe);lo.fromBufferAttribute(re,Ee),t_(lo,Ee,Q,A,r,d,this)}else for(let xe=Math.max(0,P.start),ye=Math.min(re.count,P.start+P.count);xe<ye;xe++)lo.fromBufferAttribute(re,xe),t_(lo,xe,Q,A,r,d,this)}updateMorphTargets(){const r=this.geometry.morphAttributes,d=Object.keys(r);if(d.length>0){const _=r[d[0]];if(_!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let A=0,E=_.length;A<E;A++){const P=_[A].name||String(A);this.morphTargetInfluences.push(0),this.morphTargetDictionary[P]=A}}}}}function t_(R,r,d,_,A,E,P){const k=Em.distanceSqToPoint(R);if(k<d){const Q=new zt;Em.closestPointToPoint(R,Q),Q.applyMatrix4(_);const G=A.ray.origin.distanceTo(Q);if(G<A.near||G>A.far)return;E.push({distance:G,distanceToRay:Math.sqrt(k),point:Q,index:r,face:null,object:P})}}class Mm extends Us{constructor(r,d,_,A,E,P,k,Q,G){super(r,d,_,A,E,P,k,Q,G),this.isVideoTexture=!0,this.minFilter=P!==void 0?P:Nn,this.magFilter=E!==void 0?E:Nn,this.generateMipmaps=!1;const re=this;"requestVideoFrameCallback"in r&&r.requestVideoFrameCallback(function xe(){re.needsUpdate=!0,r.requestVideoFrameCallback(xe)})}clone(){return new this.constructor(this.image).copy(this)}update(){const r=this.image;!("requestVideoFrameCallback"in r)&&r.readyState>=r.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Sp extends Us{constructor(r,d,_){super({width:r,height:d}),this.isFramebufferTexture=!0,this.format=_,this.magFilter=nn,this.minFilter=nn,this.generateMipmaps=!1,this.needsUpdate=!0}}class Iv extends Us{constructor(r,d,_,A,E,P,k,Q,G,re,xe,ye){super(null,P,k,Q,G,re,A,E,xe,ye),this.isCompressedTexture=!0,this.image={width:d,height:_},this.mipmaps=r,this.flipY=!1,this.generateMipmaps=!1}}class Tb extends Iv{constructor(r,d,_,A,E,P){super(r,d,_,E,P),this.isCompressedArrayTexture=!0,this.image.depth=A,this.wrapR=It}}class Pv extends Us{constructor(r,d,_,A,E,P,k,Q,G){super(r,d,_,A,E,P,k,Q,G),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ih{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(r,d){const _=this.getUtoTmapping(r);return this.getPoint(_,d)}getPoints(r=5){const d=[];for(let _=0;_<=r;_++)d.push(this.getPoint(_/r));return d}getSpacedPoints(r=5){const d=[];for(let _=0;_<=r;_++)d.push(this.getPointAt(_/r));return d}getLength(){const r=this.getLengths();return r[r.length-1]}getLengths(r=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===r+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const d=[];let _,A=this.getPoint(0),E=0;d.push(0);for(let P=1;P<=r;P++)_=this.getPoint(P/r),E+=_.distanceTo(A),d.push(E),A=_;return this.cacheArcLengths=d,d}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(r,d){const _=this.getLengths();let A=0;const E=_.length;let P;P=d||r*_[E-1];let k,Q=0,G=E-1;for(;Q<=G;)if(A=Math.floor(Q+(G-Q)/2),k=_[A]-P,k<0)Q=A+1;else{if(!(k>0)){G=A;break}G=A-1}if(A=G,_[A]===P)return A/(E-1);const re=_[A];return(A+(P-re)/(_[A+1]-re))/(E-1)}getTangent(r,d){let A=r-1e-4,E=r+1e-4;A<0&&(A=0),E>1&&(E=1);const P=this.getPoint(A),k=this.getPoint(E),Q=d||(P.isVector2?new li:new zt);return Q.copy(k).sub(P).normalize(),Q}getTangentAt(r,d){const _=this.getUtoTmapping(r);return this.getTangent(_,d)}computeFrenetFrames(r,d){const _=new zt,A=[],E=[],P=[],k=new zt,Q=new Gr;for(let Ee=0;Ee<=r;Ee++){const Ie=Ee/r;A[Ee]=this.getTangentAt(Ie,new zt)}E[0]=new zt,P[0]=new zt;let G=Number.MAX_VALUE;const re=Math.abs(A[0].x),xe=Math.abs(A[0].y),ye=Math.abs(A[0].z);re<=G&&(G=re,_.set(1,0,0)),xe<=G&&(G=xe,_.set(0,1,0)),ye<=G&&_.set(0,0,1),k.crossVectors(A[0],_).normalize(),E[0].crossVectors(A[0],k),P[0].crossVectors(A[0],E[0]);for(let Ee=1;Ee<=r;Ee++){if(E[Ee]=E[Ee-1].clone(),P[Ee]=P[Ee-1].clone(),k.crossVectors(A[Ee-1],A[Ee]),k.length()>Number.EPSILON){k.normalize();const Ie=Math.acos(xo(A[Ee-1].dot(A[Ee]),-1,1));E[Ee].applyMatrix4(Q.makeRotationAxis(k,Ie))}P[Ee].crossVectors(A[Ee],E[Ee])}if(d===!0){let Ee=Math.acos(xo(E[0].dot(E[r]),-1,1));Ee/=r,A[0].dot(k.crossVectors(E[0],E[r]))>0&&(Ee=-Ee);for(let Ie=1;Ie<=r;Ie++)E[Ie].applyMatrix4(Q.makeRotationAxis(A[Ie],Ee*Ie)),P[Ie].crossVectors(A[Ie],E[Ie])}return{tangents:A,normals:E,binormals:P}}clone(){return new this.constructor().copy(this)}copy(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}toJSON(){const r={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return r.arcLengthDivisions=this.arcLengthDivisions,r.type=this.type,r}fromJSON(r){return this.arcLengthDivisions=r.arcLengthDivisions,this}}class Dv extends ih{constructor(r=0,d=0,_=1,A=1,E=0,P=2*Math.PI,k=!1,Q=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=r,this.aY=d,this.xRadius=_,this.yRadius=A,this.aStartAngle=E,this.aEndAngle=P,this.aClockwise=k,this.aRotation=Q}getPoint(r,d){const _=d||new li,A=2*Math.PI;let E=this.aEndAngle-this.aStartAngle;const P=Math.abs(E)<Number.EPSILON;for(;E<0;)E+=A;for(;E>A;)E-=A;E<Number.EPSILON&&(E=P?0:A),this.aClockwise!==!0||P||(E===A?E=-A:E-=A);const k=this.aStartAngle+r*E;let Q=this.aX+this.xRadius*Math.cos(k),G=this.aY+this.yRadius*Math.sin(k);if(this.aRotation!==0){const re=Math.cos(this.aRotation),xe=Math.sin(this.aRotation),ye=Q-this.aX,Ee=G-this.aY;Q=ye*re-Ee*xe+this.aX,G=ye*xe+Ee*re+this.aY}return _.set(Q,G)}copy(r){return super.copy(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}toJSON(){const r=super.toJSON();return r.aX=this.aX,r.aY=this.aY,r.xRadius=this.xRadius,r.yRadius=this.yRadius,r.aStartAngle=this.aStartAngle,r.aEndAngle=this.aEndAngle,r.aClockwise=this.aClockwise,r.aRotation=this.aRotation,r}fromJSON(r){return super.fromJSON(r),this.aX=r.aX,this.aY=r.aY,this.xRadius=r.xRadius,this.yRadius=r.yRadius,this.aStartAngle=r.aStartAngle,this.aEndAngle=r.aEndAngle,this.aClockwise=r.aClockwise,this.aRotation=r.aRotation,this}}class Ov extends Dv{constructor(r,d,_,A,E,P){super(r,d,_,_,A,E,P),this.isArcCurve=!0,this.type="ArcCurve"}}function H0(){let R=0,r=0,d=0,_=0;function A(E,P,k,Q){R=E,r=k,d=-3*E+3*P-2*k-Q,_=2*E-2*P+k+Q}return{initCatmullRom:function(E,P,k,Q,G){A(P,k,G*(k-E),G*(Q-P))},initNonuniformCatmullRom:function(E,P,k,Q,G,re,xe){let ye=(P-E)/G-(k-E)/(G+re)+(k-P)/re,Ee=(k-P)/re-(Q-P)/(re+xe)+(Q-k)/xe;ye*=re,Ee*=re,A(P,k,ye,Ee)},calc:function(E){const P=E*E;return R+r*E+d*P+_*(P*E)}}}const Bv=new zt,Lv=new H0,Gh=new H0,n_=new H0;class Mp extends ih{constructor(r=[],d=!1,_="centripetal",A=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=r,this.closed=d,this.curveType=_,this.tension=A}getPoint(r,d=new zt){const _=d,A=this.points,E=A.length,P=(E-(this.closed?0:1))*r;let k,Q,G=Math.floor(P),re=P-G;this.closed?G+=G>0?0:(Math.floor(Math.abs(G)/E)+1)*E:re===0&&G===E-1&&(G=E-2,re=1),this.closed||G>0?k=A[(G-1)%E]:(Bv.subVectors(A[0],A[1]).add(A[0]),k=Bv);const xe=A[G%E],ye=A[(G+1)%E];if(this.closed||G+2<E?Q=A[(G+2)%E]:(Bv.subVectors(A[E-1],A[E-2]).add(A[E-1]),Q=Bv),this.curveType==="centripetal"||this.curveType==="chordal"){const Ee=this.curveType==="chordal"?.5:.25;let Ie=Math.pow(k.distanceToSquared(xe),Ee),Ue=Math.pow(xe.distanceToSquared(ye),Ee),Oe=Math.pow(ye.distanceToSquared(Q),Ee);Ue<1e-4&&(Ue=1),Ie<1e-4&&(Ie=Ue),Oe<1e-4&&(Oe=Ue),Lv.initNonuniformCatmullRom(k.x,xe.x,ye.x,Q.x,Ie,Ue,Oe),Gh.initNonuniformCatmullRom(k.y,xe.y,ye.y,Q.y,Ie,Ue,Oe),n_.initNonuniformCatmullRom(k.z,xe.z,ye.z,Q.z,Ie,Ue,Oe)}else this.curveType==="catmullrom"&&(Lv.initCatmullRom(k.x,xe.x,ye.x,Q.x,this.tension),Gh.initCatmullRom(k.y,xe.y,ye.y,Q.y,this.tension),n_.initCatmullRom(k.z,xe.z,ye.z,Q.z,this.tension));return _.set(Lv.calc(re),Gh.calc(re),n_.calc(re)),_}copy(r){super.copy(r),this.points=[];for(let d=0,_=r.points.length;d<_;d++){const A=r.points[d];this.points.push(A.clone())}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}toJSON(){const r=super.toJSON();r.points=[];for(let d=0,_=this.points.length;d<_;d++){const A=this.points[d];r.points.push(A.toArray())}return r.closed=this.closed,r.curveType=this.curveType,r.tension=this.tension,r}fromJSON(r){super.fromJSON(r),this.points=[];for(let d=0,_=r.points.length;d<_;d++){const A=r.points[d];this.points.push(new zt().fromArray(A))}return this.closed=r.closed,this.curveType=r.curveType,this.tension=r.tension,this}}function bf(R,r,d,_,A){const E=.5*(_-r),P=.5*(A-d),k=R*R;return(2*d-2*_+E+P)*(R*k)+(-3*d+3*_-2*E-P)*k+E*R+d}function xf(R,r,d,_){return function(A,E){const P=1-A;return P*P*E}(R,r)+function(A,E){return 2*(1-A)*A*E}(R,d)+function(A,E){return A*A*E}(R,_)}function Hh(R,r,d,_,A){return function(E,P){const k=1-E;return k*k*k*P}(R,r)+function(E,P){const k=1-E;return 3*k*k*E*P}(R,d)+function(E,P){return 3*(1-E)*E*E*P}(R,_)+function(E,P){return E*E*E*P}(R,A)}class Tp extends ih{constructor(r=new li,d=new li,_=new li,A=new li){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=r,this.v1=d,this.v2=_,this.v3=A}getPoint(r,d=new li){const _=d,A=this.v0,E=this.v1,P=this.v2,k=this.v3;return _.set(Hh(r,A.x,E.x,P.x,k.x),Hh(r,A.y,E.y,P.y,k.y)),_}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class i_ extends ih{constructor(r=new zt,d=new zt,_=new zt,A=new zt){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=r,this.v1=d,this.v2=_,this.v3=A}getPoint(r,d=new zt){const _=d,A=this.v0,E=this.v1,P=this.v2,k=this.v3;return _.set(Hh(r,A.x,E.x,P.x,k.x),Hh(r,A.y,E.y,P.y,k.y),Hh(r,A.z,E.z,P.z,k.z)),_}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this.v3.copy(r.v3),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r.v3=this.v3.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this.v3.fromArray(r.v3),this}}class Nv extends ih{constructor(r=new li,d=new li){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=r,this.v2=d}getPoint(r,d=new li){const _=d;return r===1?_.copy(this.v2):(_.copy(this.v2).sub(this.v1),_.multiplyScalar(r).add(this.v1)),_}getPointAt(r,d){return this.getPoint(r,d)}getTangent(r,d=new li){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,d){return this.getTangent(r,d)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class Tm extends ih{constructor(r=new zt,d=new zt){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=r,this.v2=d}getPoint(r,d=new zt){const _=d;return r===1?_.copy(this.v2):(_.copy(this.v2).sub(this.v1),_.multiplyScalar(r).add(this.v1)),_}getPointAt(r,d){return this.getPoint(r,d)}getTangent(r,d=new zt){return d.subVectors(this.v2,this.v1).normalize()}getTangentAt(r,d){return this.getTangent(r,d)}copy(r){return super.copy(r),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class wf extends ih{constructor(r=new li,d=new li,_=new li){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=r,this.v1=d,this.v2=_}getPoint(r,d=new li){const _=d,A=this.v0,E=this.v1,P=this.v2;return _.set(xf(r,A.x,E.x,P.x),xf(r,A.y,E.y,P.y)),_}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class r_ extends ih{constructor(r=new zt,d=new zt,_=new zt){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=r,this.v1=d,this.v2=_}getPoint(r,d=new zt){const _=d,A=this.v0,E=this.v1,P=this.v2;return _.set(xf(r,A.x,E.x,P.x),xf(r,A.y,E.y,P.y),xf(r,A.z,E.z,P.z)),_}copy(r){return super.copy(r),this.v0.copy(r.v0),this.v1.copy(r.v1),this.v2.copy(r.v2),this}toJSON(){const r=super.toJSON();return r.v0=this.v0.toArray(),r.v1=this.v1.toArray(),r.v2=this.v2.toArray(),r}fromJSON(r){return super.fromJSON(r),this.v0.fromArray(r.v0),this.v1.fromArray(r.v1),this.v2.fromArray(r.v2),this}}class Cm extends ih{constructor(r=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=r}getPoint(r,d=new li){const _=d,A=this.points,E=(A.length-1)*r,P=Math.floor(E),k=E-P,Q=A[P===0?P:P-1],G=A[P],re=A[P>A.length-2?A.length-1:P+1],xe=A[P>A.length-3?A.length-1:P+2];return _.set(bf(k,Q.x,G.x,re.x,xe.x),bf(k,Q.y,G.y,re.y,xe.y)),_}copy(r){super.copy(r),this.points=[];for(let d=0,_=r.points.length;d<_;d++){const A=r.points[d];this.points.push(A.clone())}return this}toJSON(){const r=super.toJSON();r.points=[];for(let d=0,_=this.points.length;d<_;d++){const A=this.points[d];r.points.push(A.toArray())}return r}fromJSON(r){super.fromJSON(r),this.points=[];for(let d=0,_=r.points.length;d<_;d++){const A=r.points[d];this.points.push(new li().fromArray(A))}return this}}var kv=Object.freeze({__proto__:null,ArcCurve:Ov,CatmullRomCurve3:Mp,CubicBezierCurve:Tp,CubicBezierCurve3:i_,EllipseCurve:Dv,LineCurve:Nv,LineCurve3:Tm,QuadraticBezierCurve:wf,QuadraticBezierCurve3:r_,SplineCurve:Cm});class mA extends ih{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(r){this.curves.push(r)}closePath(){const r=this.curves[0].getPoint(0),d=this.curves[this.curves.length-1].getPoint(1);r.equals(d)||this.curves.push(new Nv(d,r))}getPoint(r,d){const _=r*this.getLength(),A=this.getCurveLengths();let E=0;for(;E<A.length;){if(A[E]>=_){const P=A[E]-_,k=this.curves[E],Q=k.getLength(),G=Q===0?0:1-P/Q;return k.getPointAt(G,d)}E++}return null}getLength(){const r=this.getCurveLengths();return r[r.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const r=[];let d=0;for(let _=0,A=this.curves.length;_<A;_++)d+=this.curves[_].getLength(),r.push(d);return this.cacheLengths=r,r}getSpacedPoints(r=40){const d=[];for(let _=0;_<=r;_++)d.push(this.getPoint(_/r));return this.autoClose&&d.push(d[0]),d}getPoints(r=12){const d=[];let _;for(let A=0,E=this.curves;A<E.length;A++){const P=E[A],k=P.isEllipseCurve?2*r:P.isLineCurve||P.isLineCurve3?1:P.isSplineCurve?r*P.points.length:r,Q=P.getPoints(k);for(let G=0;G<Q.length;G++){const re=Q[G];_&&_.equals(re)||(d.push(re),_=re)}}return this.autoClose&&d.length>1&&!d[d.length-1].equals(d[0])&&d.push(d[0]),d}copy(r){super.copy(r),this.curves=[];for(let d=0,_=r.curves.length;d<_;d++){const A=r.curves[d];this.curves.push(A.clone())}return this.autoClose=r.autoClose,this}toJSON(){const r=super.toJSON();r.autoClose=this.autoClose,r.curves=[];for(let d=0,_=this.curves.length;d<_;d++){const A=this.curves[d];r.curves.push(A.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.autoClose=r.autoClose,this.curves=[];for(let d=0,_=r.curves.length;d<_;d++){const A=r.curves[d];this.curves.push(new kv[A.type]().fromJSON(A))}return this}}class Id extends mA{constructor(r){super(),this.type="Path",this.currentPoint=new li,r&&this.setFromPoints(r)}setFromPoints(r){this.moveTo(r[0].x,r[0].y);for(let d=1,_=r.length;d<_;d++)this.lineTo(r[d].x,r[d].y);return this}moveTo(r,d){return this.currentPoint.set(r,d),this}lineTo(r,d){const _=new Nv(this.currentPoint.clone(),new li(r,d));return this.curves.push(_),this.currentPoint.set(r,d),this}quadraticCurveTo(r,d,_,A){const E=new wf(this.currentPoint.clone(),new li(r,d),new li(_,A));return this.curves.push(E),this.currentPoint.set(_,A),this}bezierCurveTo(r,d,_,A,E,P){const k=new Tp(this.currentPoint.clone(),new li(r,d),new li(_,A),new li(E,P));return this.curves.push(k),this.currentPoint.set(E,P),this}splineThru(r){const d=[this.currentPoint.clone()].concat(r),_=new Cm(d);return this.curves.push(_),this.currentPoint.copy(r[r.length-1]),this}arc(r,d,_,A,E,P){const k=this.currentPoint.x,Q=this.currentPoint.y;return this.absarc(r+k,d+Q,_,A,E,P),this}absarc(r,d,_,A,E,P){return this.absellipse(r,d,_,_,A,E,P),this}ellipse(r,d,_,A,E,P,k,Q){const G=this.currentPoint.x,re=this.currentPoint.y;return this.absellipse(r+G,d+re,_,A,E,P,k,Q),this}absellipse(r,d,_,A,E,P,k,Q){const G=new Dv(r,d,_,A,E,P,k,Q);if(this.curves.length>0){const xe=G.getPoint(0);xe.equals(this.currentPoint)||this.lineTo(xe.x,xe.y)}this.curves.push(G);const re=G.getPoint(1);return this.currentPoint.copy(re),this}copy(r){return super.copy(r),this.currentPoint.copy(r.currentPoint),this}toJSON(){const r=super.toJSON();return r.currentPoint=this.currentPoint.toArray(),r}fromJSON(r){return super.fromJSON(r),this.currentPoint.fromArray(r.currentPoint),this}}class Ru extends Fe{constructor(r=[new li(0,-.5),new li(.5,0),new li(0,.5)],d=12,_=0,A=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:r,segments:d,phiStart:_,phiLength:A},d=Math.floor(d),A=xo(A,0,2*Math.PI);const E=[],P=[],k=[],Q=[],G=[],re=1/d,xe=new zt,ye=new li,Ee=new zt,Ie=new zt,Ue=new zt;let Oe=0,ke=0;for(let Ge=0;Ge<=r.length-1;Ge++)switch(Ge){case 0:Oe=r[Ge+1].x-r[Ge].x,ke=r[Ge+1].y-r[Ge].y,Ee.x=1*ke,Ee.y=-Oe,Ee.z=0*ke,Ue.copy(Ee),Ee.normalize(),Q.push(Ee.x,Ee.y,Ee.z);break;case r.length-1:Q.push(Ue.x,Ue.y,Ue.z);break;default:Oe=r[Ge+1].x-r[Ge].x,ke=r[Ge+1].y-r[Ge].y,Ee.x=1*ke,Ee.y=-Oe,Ee.z=0*ke,Ie.copy(Ee),Ee.x+=Ue.x,Ee.y+=Ue.y,Ee.z+=Ue.z,Ee.normalize(),Q.push(Ee.x,Ee.y,Ee.z),Ue.copy(Ie)}for(let Ge=0;Ge<=d;Ge++){const Je=_+Ge*re*A,Rt=Math.sin(Je),Et=Math.cos(Je);for(let xt=0;xt<=r.length-1;xt++){xe.x=r[xt].x*Rt,xe.y=r[xt].y,xe.z=r[xt].x*Et,P.push(xe.x,xe.y,xe.z),ye.x=Ge/d,ye.y=xt/(r.length-1),k.push(ye.x,ye.y);const Zt=Q[3*xt+0]*Rt,g=Q[3*xt+1],b=Q[3*xt+0]*Et;G.push(Zt,g,b)}}for(let Ge=0;Ge<d;Ge++)for(let Je=0;Je<r.length-1;Je++){const Rt=Je+Ge*r.length,Et=Rt,xt=Rt+r.length,Zt=Rt+r.length+1,g=Rt+1;E.push(Et,xt,g),E.push(Zt,g,xt)}this.setIndex(E),this.setAttribute("position",new tr(P,3)),this.setAttribute("uv",new tr(k,2)),this.setAttribute("normal",new tr(G,3))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Ru(r.points,r.segments,r.phiStart,r.phiLength)}}class Os extends Ru{constructor(r=1,d=1,_=4,A=8){const E=new Id;E.absarc(0,-d/2,r,1.5*Math.PI,0),E.absarc(0,d/2,r,0,.5*Math.PI),super(E.getPoints(_),A),this.type="CapsuleGeometry",this.parameters={radius:r,height:d,capSegments:_,radialSegments:A}}static fromJSON(r){return new Os(r.radius,r.length,r.capSegments,r.radialSegments)}}class s_ extends Fe{constructor(r=1,d=32,_=0,A=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:r,segments:d,thetaStart:_,thetaLength:A},d=Math.max(3,d);const E=[],P=[],k=[],Q=[],G=new zt,re=new li;P.push(0,0,0),k.push(0,0,1),Q.push(.5,.5);for(let xe=0,ye=3;xe<=d;xe++,ye+=3){const Ee=_+xe/d*A;G.x=r*Math.cos(Ee),G.y=r*Math.sin(Ee),P.push(G.x,G.y,G.z),k.push(0,0,1),re.x=(P[ye]/r+1)/2,re.y=(P[ye+1]/r+1)/2,Q.push(re.x,re.y)}for(let xe=1;xe<=d;xe++)E.push(xe,xe+1,0);this.setIndex(E),this.setAttribute("position",new tr(P,3)),this.setAttribute("normal",new tr(k,3)),this.setAttribute("uv",new tr(Q,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new s_(r.radius,r.segments,r.thetaStart,r.thetaLength)}}class $l extends Fe{constructor(r=1,d=1,_=1,A=32,E=1,P=!1,k=0,Q=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:r,radiusBottom:d,height:_,radialSegments:A,heightSegments:E,openEnded:P,thetaStart:k,thetaLength:Q};const G=this;A=Math.floor(A),E=Math.floor(E);const re=[],xe=[],ye=[],Ee=[];let Ie=0;const Ue=[],Oe=_/2;let ke=0;function Ge(Je){const Rt=Ie,Et=new li,xt=new zt;let Zt=0;const g=Je===!0?r:d,b=Je===!0?1:-1;for(let L=1;L<=A;L++)xe.push(0,Oe*b,0),ye.push(0,b,0),Ee.push(.5,.5),Ie++;const D=Ie;for(let L=0;L<=A;L++){const Y=L/A*Q+k,ne=Math.cos(Y),be=Math.sin(Y);xt.x=g*be,xt.y=Oe*b,xt.z=g*ne,xe.push(xt.x,xt.y,xt.z),ye.push(0,b,0),Et.x=.5*ne+.5,Et.y=.5*be*b+.5,Ee.push(Et.x,Et.y),Ie++}for(let L=0;L<A;L++){const Y=Rt+L,ne=D+L;Je===!0?re.push(ne,ne+1,Y):re.push(ne+1,ne,Y),Zt+=3}G.addGroup(ke,Zt,Je===!0?1:2),ke+=Zt}(function(){const Je=new zt,Rt=new zt;let Et=0;const xt=(d-r)/_;for(let Zt=0;Zt<=E;Zt++){const g=[],b=Zt/E,D=b*(d-r)+r;for(let L=0;L<=A;L++){const Y=L/A,ne=Y*Q+k,be=Math.sin(ne),Me=Math.cos(ne);Rt.x=D*be,Rt.y=-b*_+Oe,Rt.z=D*Me,xe.push(Rt.x,Rt.y,Rt.z),Je.set(be,xt,Me).normalize(),ye.push(Je.x,Je.y,Je.z),Ee.push(Y,1-b),g.push(Ie++)}Ue.push(g)}for(let Zt=0;Zt<A;Zt++)for(let g=0;g<E;g++){const b=Ue[g][Zt],D=Ue[g+1][Zt],L=Ue[g+1][Zt+1],Y=Ue[g][Zt+1];re.push(b,D,Y),re.push(D,L,Y),Et+=6}G.addGroup(ke,Et,0),ke+=Et})(),P===!1&&(r>0&&Ge(!0),d>0&&Ge(!1)),this.setIndex(re),this.setAttribute("position",new tr(xe,3)),this.setAttribute("normal",new tr(ye,3)),this.setAttribute("uv",new tr(Ee,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new $l(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class Rc extends $l{constructor(r=1,d=1,_=32,A=1,E=!1,P=0,k=2*Math.PI){super(0,r,d,_,A,E,P,k),this.type="ConeGeometry",this.parameters={radius:r,height:d,radialSegments:_,heightSegments:A,openEnded:E,thetaStart:P,thetaLength:k}}static fromJSON(r){return new Rc(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength)}}class rh extends Fe{constructor(r=[],d=[],_=1,A=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:r,indices:d,radius:_,detail:A};const E=[],P=[];function k(ye,Ee,Ie,Ue){const Oe=Ue+1,ke=[];for(let Ge=0;Ge<=Oe;Ge++){ke[Ge]=[];const Je=ye.clone().lerp(Ie,Ge/Oe),Rt=Ee.clone().lerp(Ie,Ge/Oe),Et=Oe-Ge;for(let xt=0;xt<=Et;xt++)ke[Ge][xt]=xt===0&&Ge===Oe?Je:Je.clone().lerp(Rt,xt/Et)}for(let Ge=0;Ge<Oe;Ge++)for(let Je=0;Je<2*(Oe-Ge)-1;Je++){const Rt=Math.floor(Je/2);Je%2==0?(Q(ke[Ge][Rt+1]),Q(ke[Ge+1][Rt]),Q(ke[Ge][Rt])):(Q(ke[Ge][Rt+1]),Q(ke[Ge+1][Rt+1]),Q(ke[Ge+1][Rt]))}}function Q(ye){E.push(ye.x,ye.y,ye.z)}function G(ye,Ee){const Ie=3*ye;Ee.x=r[Ie+0],Ee.y=r[Ie+1],Ee.z=r[Ie+2]}function re(ye,Ee,Ie,Ue){Ue<0&&ye.x===1&&(P[Ee]=ye.x-1),Ie.x===0&&Ie.z===0&&(P[Ee]=Ue/2/Math.PI+.5)}function xe(ye){return Math.atan2(ye.z,-ye.x)}(function(ye){const Ee=new zt,Ie=new zt,Ue=new zt;for(let Oe=0;Oe<d.length;Oe+=3)G(d[Oe+0],Ee),G(d[Oe+1],Ie),G(d[Oe+2],Ue),k(Ee,Ie,Ue,ye)})(A),function(ye){const Ee=new zt;for(let Ie=0;Ie<E.length;Ie+=3)Ee.x=E[Ie+0],Ee.y=E[Ie+1],Ee.z=E[Ie+2],Ee.normalize().multiplyScalar(ye),E[Ie+0]=Ee.x,E[Ie+1]=Ee.y,E[Ie+2]=Ee.z}(_),function(){const ye=new zt;for(let Ie=0;Ie<E.length;Ie+=3){ye.x=E[Ie+0],ye.y=E[Ie+1],ye.z=E[Ie+2];const Ue=xe(ye)/2/Math.PI+.5,Oe=(Ee=ye,Math.atan2(-Ee.y,Math.sqrt(Ee.x*Ee.x+Ee.z*Ee.z))/Math.PI+.5);P.push(Ue,1-Oe)}var Ee;(function(){const Ie=new zt,Ue=new zt,Oe=new zt,ke=new zt,Ge=new li,Je=new li,Rt=new li;for(let Et=0,xt=0;Et<E.length;Et+=9,xt+=6){Ie.set(E[Et+0],E[Et+1],E[Et+2]),Ue.set(E[Et+3],E[Et+4],E[Et+5]),Oe.set(E[Et+6],E[Et+7],E[Et+8]),Ge.set(P[xt+0],P[xt+1]),Je.set(P[xt+2],P[xt+3]),Rt.set(P[xt+4],P[xt+5]),ke.copy(Ie).add(Ue).add(Oe).divideScalar(3);const Zt=xe(ke);re(Ge,xt+0,Ie,Zt),re(Je,xt+2,Ue,Zt),re(Rt,xt+4,Oe,Zt)}})(),function(){for(let Ie=0;Ie<P.length;Ie+=6){const Ue=P[Ie+0],Oe=P[Ie+2],ke=P[Ie+4],Ge=Math.max(Ue,Oe,ke),Je=Math.min(Ue,Oe,ke);Ge>.9&&Je<.1&&(Ue<.2&&(P[Ie+0]+=1),Oe<.2&&(P[Ie+2]+=1),ke<.2&&(P[Ie+4]+=1))}}()}(),this.setAttribute("position",new tr(E,3)),this.setAttribute("normal",new tr(E.slice(),3)),this.setAttribute("uv",new tr(P,2)),A===0?this.computeVertexNormals():this.normalizeNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new rh(r.vertices,r.indices,r.radius,r.details)}}class Cp extends rh{constructor(r=1,d=0){const _=(1+Math.sqrt(5))/2,A=1/_;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-A,-_,0,-A,_,0,A,-_,0,A,_,-A,-_,0,-A,_,0,A,-_,0,A,_,0,-_,0,-A,_,0,-A,-_,0,A,_,0,A],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],r,d),this.type="DodecahedronGeometry",this.parameters={radius:r,detail:d}}static fromJSON(r){return new Cp(r.radius,r.detail)}}const Rm=new zt,Iu=new zt,Ef=new zt,Im=new Cs;class o_ extends Fe{constructor(r=null,d=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:r,thresholdAngle:d},r!==null){const A=Math.pow(10,4),E=Math.cos(ei*d),P=r.getIndex(),k=r.getAttribute("position"),Q=P?P.count:k.count,G=[0,0,0],re=["a","b","c"],xe=new Array(3),ye={},Ee=[];for(let Ie=0;Ie<Q;Ie+=3){P?(G[0]=P.getX(Ie),G[1]=P.getX(Ie+1),G[2]=P.getX(Ie+2)):(G[0]=Ie,G[1]=Ie+1,G[2]=Ie+2);const{a:Ue,b:Oe,c:ke}=Im;if(Ue.fromBufferAttribute(k,G[0]),Oe.fromBufferAttribute(k,G[1]),ke.fromBufferAttribute(k,G[2]),Im.getNormal(Ef),xe[0]=`${Math.round(Ue.x*A)},${Math.round(Ue.y*A)},${Math.round(Ue.z*A)}`,xe[1]=`${Math.round(Oe.x*A)},${Math.round(Oe.y*A)},${Math.round(Oe.z*A)}`,xe[2]=`${Math.round(ke.x*A)},${Math.round(ke.y*A)},${Math.round(ke.z*A)}`,xe[0]!==xe[1]&&xe[1]!==xe[2]&&xe[2]!==xe[0])for(let Ge=0;Ge<3;Ge++){const Je=(Ge+1)%3,Rt=xe[Ge],Et=xe[Je],xt=Im[re[Ge]],Zt=Im[re[Je]],g=`${Rt}_${Et}`,b=`${Et}_${Rt}`;b in ye&&ye[b]?(Ef.dot(ye[b].normal)<=E&&(Ee.push(xt.x,xt.y,xt.z),Ee.push(Zt.x,Zt.y,Zt.z)),ye[b]=null):g in ye||(ye[g]={index0:G[Ge],index1:G[Je],normal:Ef.clone()})}}for(const Ie in ye)if(ye[Ie]){const{index0:Ue,index1:Oe}=ye[Ie];Rm.fromBufferAttribute(k,Ue),Iu.fromBufferAttribute(k,Oe),Ee.push(Rm.x,Rm.y,Rm.z),Ee.push(Iu.x,Iu.y,Iu.z)}this.setAttribute("position",new tr(Ee,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}class Wh extends Id{constructor(r){super(r),this.uuid=Cl(),this.type="Shape",this.holes=[]}getPointsHoles(r){const d=[];for(let _=0,A=this.holes.length;_<A;_++)d[_]=this.holes[_].getPoints(r);return d}extractPoints(r){return{shape:this.getPoints(r),holes:this.getPointsHoles(r)}}copy(r){super.copy(r),this.holes=[];for(let d=0,_=r.holes.length;d<_;d++){const A=r.holes[d];this.holes.push(A.clone())}return this}toJSON(){const r=super.toJSON();r.uuid=this.uuid,r.holes=[];for(let d=0,_=this.holes.length;d<_;d++){const A=this.holes[d];r.holes.push(A.toJSON())}return r}fromJSON(r){super.fromJSON(r),this.uuid=r.uuid,this.holes=[];for(let d=0,_=r.holes.length;d<_;d++){const A=r.holes[d];this.holes.push(new Id().fromJSON(A))}return this}}function Sf(R,r,d,_,A){let E,P;if(A===function(k,Q,G,re){let xe=0;for(let ye=Q,Ee=G-re;ye<G;ye+=re)xe+=(k[Ee]-k[ye])*(k[ye+1]+k[Ee+1]),Ee=ye;return xe}(R,r,d,_)>0)for(E=r;E<d;E+=_)P=Om(E,R[E],R[E+1],P);else for(E=d-_;E>=r;E-=_)P=Om(E,R[E],R[E+1],P);return P&&Rp(P,P.next)&&(Cf(P),P=P.next),P}function Qh(R,r){if(!R)return R;r||(r=R);let d,_=R;do if(d=!1,_.steiner||!Rp(_,_.next)&&no(_.prev,_,_.next)!==0)_=_.next;else{if(Cf(_),_=r=_.prev,_===_.next)break;d=!0}while(d||_!==r);return r}function Pm(R,r,d,_,A,E,P){if(!R)return;!P&&E&&function(re,xe,ye,Ee){let Ie=re;do Ie.z===0&&(Ie.z=jv(Ie.x,Ie.y,xe,ye,Ee)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==re);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(Ue){let Oe,ke,Ge,Je,Rt,Et,xt,Zt,g=1;do{for(ke=Ue,Ue=null,Rt=null,Et=0;ke;){for(Et++,Ge=ke,xt=0,Oe=0;Oe<g&&(xt++,Ge=Ge.nextZ,Ge);Oe++);for(Zt=g;xt>0||Zt>0&&Ge;)xt!==0&&(Zt===0||!Ge||ke.z<=Ge.z)?(Je=ke,ke=ke.nextZ,xt--):(Je=Ge,Ge=Ge.nextZ,Zt--),Rt?Rt.nextZ=Je:Ue=Je,Je.prevZ=Rt,Rt=Je;ke=Ge}Rt.nextZ=null,g*=2}while(Et>1)}(Ie)}(R,_,A,E);let k,Q,G=R;for(;R.prev!==R.next;)if(k=R.prev,Q=R.next,E?Fv(R,_,A,E):Uv(R))r.push(k.i/d|0),r.push(R.i/d|0),r.push(Q.i/d|0),Cf(R),R=Q.next,G=Q.next;else if((R=Q)===G){P?P===1?Pm(R=a_(Qh(R),r,d),r,d,_,A,E,2):P===2&&Cb(R,r,d,_,A,E):Pm(Qh(R),r,d,_,A,E,1);break}}function Uv(R){const r=R.prev,d=R,_=R.next;if(no(r,d,_)>=0)return!1;const A=r.x,E=d.x,P=_.x,k=r.y,Q=d.y,G=_.y,re=A<E?A<P?A:P:E<P?E:P,xe=k<Q?k<G?k:G:Q<G?Q:G,ye=A>E?A>P?A:P:E>P?E:P,Ee=k>Q?k>G?k:G:Q>G?Q:G;let Ie=_.next;for(;Ie!==r;){if(Ie.x>=re&&Ie.x<=ye&&Ie.y>=xe&&Ie.y<=Ee&&sh(A,k,E,Q,P,G,Ie.x,Ie.y)&&no(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.next}return!0}function Fv(R,r,d,_){const A=R.prev,E=R,P=R.next;if(no(A,E,P)>=0)return!1;const k=A.x,Q=E.x,G=P.x,re=A.y,xe=E.y,ye=P.y,Ee=k<Q?k<G?k:G:Q<G?Q:G,Ie=re<xe?re<ye?re:ye:xe<ye?xe:ye,Ue=k>Q?k>G?k:G:Q>G?Q:G,Oe=re>xe?re>ye?re:ye:xe>ye?xe:ye,ke=jv(Ee,Ie,r,d,_),Ge=jv(Ue,Oe,r,d,_);let Je=R.prevZ,Rt=R.nextZ;for(;Je&&Je.z>=ke&&Rt&&Rt.z<=Ge;){if(Je.x>=Ee&&Je.x<=Ue&&Je.y>=Ie&&Je.y<=Oe&&Je!==A&&Je!==P&&sh(k,re,Q,xe,G,ye,Je.x,Je.y)&&no(Je.prev,Je,Je.next)>=0||(Je=Je.prevZ,Rt.x>=Ee&&Rt.x<=Ue&&Rt.y>=Ie&&Rt.y<=Oe&&Rt!==A&&Rt!==P&&sh(k,re,Q,xe,G,ye,Rt.x,Rt.y)&&no(Rt.prev,Rt,Rt.next)>=0))return!1;Rt=Rt.nextZ}for(;Je&&Je.z>=ke;){if(Je.x>=Ee&&Je.x<=Ue&&Je.y>=Ie&&Je.y<=Oe&&Je!==A&&Je!==P&&sh(k,re,Q,xe,G,ye,Je.x,Je.y)&&no(Je.prev,Je,Je.next)>=0)return!1;Je=Je.prevZ}for(;Rt&&Rt.z<=Ge;){if(Rt.x>=Ee&&Rt.x<=Ue&&Rt.y>=Ie&&Rt.y<=Oe&&Rt!==A&&Rt!==P&&sh(k,re,Q,xe,G,ye,Rt.x,Rt.y)&&no(Rt.prev,Rt,Rt.next)>=0)return!1;Rt=Rt.nextZ}return!0}function a_(R,r,d){let _=R;do{const A=_.prev,E=_.next.next;!Rp(A,E)&&qh(A,_,_.next,E)&&Dm(A,E)&&Dm(E,A)&&(r.push(A.i/d|0),r.push(_.i/d|0),r.push(E.i/d|0),Cf(_),Cf(_.next),_=R=E),_=_.next}while(_!==R);return Qh(_)}function Cb(R,r,d,_,A,E){let P=R;do{let k=P.next.next;for(;k!==P.prev;){if(P.i!==k.i&&Q0(P,k)){let Q=Vv(P,k);return P=Qh(P,P.next),Q=Qh(Q,Q.next),Pm(P,r,d,_,A,E,0),void Pm(Q,r,d,_,A,E,0)}k=k.next}P=P.next}while(P!==R)}function l_(R,r){return R.x-r.x}function zv(R,r){const d=function(A,E){let P,k=E,Q=-1/0;const G=A.x,re=A.y;do{if(re<=k.y&&re>=k.next.y&&k.next.y!==k.y){const Oe=k.x+(re-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(Oe<=G&&Oe>Q&&(Q=Oe,P=k.x<k.next.x?k:k.next,Oe===G))return P}k=k.next}while(k!==E);if(!P)return null;const xe=P,ye=P.x,Ee=P.y;let Ie,Ue=1/0;k=P;do G>=k.x&&k.x>=ye&&G!==k.x&&sh(re<Ee?G:Q,re,ye,Ee,re<Ee?Q:G,re,k.x,k.y)&&(Ie=Math.abs(re-k.y)/(G-k.x),Dm(k,A)&&(Ie<Ue||Ie===Ue&&(k.x>P.x||k.x===P.x&&W0(P,k)))&&(P=k,Ue=Ie)),k=k.next;while(k!==xe);return P}(R,r);if(!d)return r;const _=Vv(d,R);return Qh(_,_.next),Qh(d,d.next)}function W0(R,r){return no(R.prev,R,r.prev)<0&&no(r.next,R,R.next)<0}function jv(R,r,d,_,A){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R=(R-d)*A|0)|R<<8))|R<<4))|R<<2))|R<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-_)*A|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function c_(R){let r=R,d=R;do(r.x<d.x||r.x===d.x&&r.y<d.y)&&(d=r),r=r.next;while(r!==R);return d}function sh(R,r,d,_,A,E,P,k){return(A-P)*(r-k)>=(R-P)*(E-k)&&(R-P)*(_-k)>=(d-P)*(r-k)&&(d-P)*(E-k)>=(A-P)*(_-k)}function Q0(R,r){return R.next.i!==r.i&&R.prev.i!==r.i&&!function(d,_){let A=d;do{if(A.i!==d.i&&A.next.i!==d.i&&A.i!==_.i&&A.next.i!==_.i&&qh(A,A.next,d,_))return!0;A=A.next}while(A!==d);return!1}(R,r)&&(Dm(R,r)&&Dm(r,R)&&function(d,_){let A=d,E=!1;const P=(d.x+_.x)/2,k=(d.y+_.y)/2;do A.y>k!=A.next.y>k&&A.next.y!==A.y&&P<(A.next.x-A.x)*(k-A.y)/(A.next.y-A.y)+A.x&&(E=!E),A=A.next;while(A!==d);return E}(R,r)&&(no(R.prev,R,r.prev)||no(R,r.prev,r))||Rp(R,r)&&no(R.prev,R,R.next)>0&&no(r.prev,r,r.next)>0)}function no(R,r,d){return(r.y-R.y)*(d.x-r.x)-(r.x-R.x)*(d.y-r.y)}function Rp(R,r){return R.x===r.x&&R.y===r.y}function qh(R,r,d,_){const A=Tf(no(R,r,d)),E=Tf(no(R,r,_)),P=Tf(no(d,_,R)),k=Tf(no(d,_,r));return A!==E&&P!==k||!(A!==0||!Mf(R,d,r))||!(E!==0||!Mf(R,_,r))||!(P!==0||!Mf(d,R,_))||!(k!==0||!Mf(d,r,_))}function Mf(R,r,d){return r.x<=Math.max(R.x,d.x)&&r.x>=Math.min(R.x,d.x)&&r.y<=Math.max(R.y,d.y)&&r.y>=Math.min(R.y,d.y)}function Tf(R){return R>0?1:R<0?-1:0}function Dm(R,r){return no(R.prev,R,R.next)<0?no(R,r,R.next)>=0&&no(R,R.prev,r)>=0:no(R,r,R.prev)<0||no(R,R.next,r)<0}function Vv(R,r){const d=new Rf(R.i,R.x,R.y),_=new Rf(r.i,r.x,r.y),A=R.next,E=r.prev;return R.next=r,r.prev=R,d.next=A,A.prev=d,_.next=d,d.prev=_,E.next=_,_.prev=E,_}function Om(R,r,d,_){const A=new Rf(R,r,d);return _?(A.next=_.next,A.prev=_,_.next.prev=A,_.next=A):(A.prev=A,A.next=A),A}function Cf(R){R.next.prev=R.prev,R.prev.next=R.next,R.prevZ&&(R.prevZ.nextZ=R.nextZ),R.nextZ&&(R.nextZ.prevZ=R.prevZ)}function Rf(R,r,d){this.i=R,this.x=r,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ic{static area(r){const d=r.length;let _=0;for(let A=d-1,E=0;E<d;A=E++)_+=r[A].x*r[E].y-r[E].x*r[A].y;return .5*_}static isClockWise(r){return Ic.area(r)<0}static triangulateShape(r,d){const _=[],A=[],E=[];Bm(r),u_(_,r);let P=r.length;d.forEach(Bm);for(let Q=0;Q<d.length;Q++)A.push(P),P+=d[Q].length,u_(_,d[Q]);const k=function(Q,G,re=2){const xe=G&&G.length,ye=xe?G[0]*re:Q.length;let Ee=Sf(Q,0,ye,re,!0);const Ie=[];if(!Ee||Ee.next===Ee.prev)return Ie;let Ue,Oe,ke,Ge,Je,Rt,Et;if(xe&&(Ee=function(xt,Zt,g,b){const D=[];let L,Y,ne,be,Me;for(L=0,Y=Zt.length;L<Y;L++)ne=Zt[L]*b,be=L<Y-1?Zt[L+1]*b:xt.length,Me=Sf(xt,ne,be,b,!1),Me===Me.next&&(Me.steiner=!0),D.push(c_(Me));for(D.sort(l_),L=0;L<D.length;L++)g=zv(D[L],g);return g}(Q,G,Ee,re)),Q.length>80*re){Ue=ke=Q[0],Oe=Ge=Q[1];for(let xt=re;xt<ye;xt+=re)Je=Q[xt],Rt=Q[xt+1],Je<Ue&&(Ue=Je),Rt<Oe&&(Oe=Rt),Je>ke&&(ke=Je),Rt>Ge&&(Ge=Rt);Et=Math.max(ke-Ue,Ge-Oe),Et=Et!==0?32767/Et:0}return Pm(Ee,Ie,re,Ue,Oe,Et,0),Ie}(_,A);for(let Q=0;Q<k.length;Q+=3)E.push(k.slice(Q,Q+3));return E}}function Bm(R){const r=R.length;r>2&&R[r-1].equals(R[0])&&R.pop()}function u_(R,r){for(let d=0;d<r.length;d++)R.push(r[d].x),R.push(r[d].y)}class Pd extends Fe{constructor(r=new Wh([new li(.5,.5),new li(-.5,.5),new li(-.5,-.5),new li(.5,-.5)]),d={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:r,options:d},r=Array.isArray(r)?r:[r];const _=this,A=[],E=[];for(let k=0,Q=r.length;k<Q;k++)P(r[k]);function P(k){const Q=[],G=d.curveSegments!==void 0?d.curveSegments:12,re=d.steps!==void 0?d.steps:1,xe=d.depth!==void 0?d.depth:1;let ye=d.bevelEnabled===void 0||d.bevelEnabled,Ee=d.bevelThickness!==void 0?d.bevelThickness:.2,Ie=d.bevelSize!==void 0?d.bevelSize:Ee-.1,Ue=d.bevelOffset!==void 0?d.bevelOffset:0,Oe=d.bevelSegments!==void 0?d.bevelSegments:3;const ke=d.extrudePath,Ge=d.UVGenerator!==void 0?d.UVGenerator:gA;let Je,Rt,Et,xt,Zt,g=!1;ke&&(Je=ke.getSpacedPoints(re),g=!0,ye=!1,Rt=ke.computeFrenetFrames(re,!1),Et=new zt,xt=new zt,Zt=new zt),ye||(Oe=0,Ee=0,Ie=0,Ue=0);const b=k.extractPoints(G);let D=b.shape;const L=b.holes;if(!Ic.isClockWise(D)){D=D.reverse();for(let Ut=0,yt=L.length;Ut<yt;Ut++){const wt=L[Ut];Ic.isClockWise(wt)&&(L[Ut]=wt.reverse())}}const Y=Ic.triangulateShape(D,L),ne=D;for(let Ut=0,yt=L.length;Ut<yt;Ut++){const wt=L[Ut];D=D.concat(wt)}function be(Ut,yt,wt){return yt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ut.clone().addScaledVector(yt,wt)}const Me=D.length,De=Y.length;function je(Ut,yt,wt){let qe,Ct,Dt;const hn=Ut.x-yt.x,Kt=Ut.y-yt.y,yn=wt.x-Ut.x,ii=wt.y-Ut.y,Ui=hn*hn+Kt*Kt,Bi=hn*ii-Kt*yn;if(Math.abs(Bi)>Number.EPSILON){const ci=Math.sqrt(Ui),Ii=Math.sqrt(yn*yn+ii*ii),$i=yt.x-Kt/ci,sr=yt.y+hn/ci,xs=((wt.x-ii/Ii-$i)*ii-(wt.y+yn/Ii-sr)*yn)/(hn*ii-Kt*yn);qe=$i+hn*xs-Ut.x,Ct=sr+Kt*xs-Ut.y;const yo=qe*qe+Ct*Ct;if(yo<=2)return new li(qe,Ct);Dt=Math.sqrt(yo/2)}else{let ci=!1;hn>Number.EPSILON?yn>Number.EPSILON&&(ci=!0):hn<-Number.EPSILON?yn<-Number.EPSILON&&(ci=!0):Math.sign(Kt)===Math.sign(ii)&&(ci=!0),ci?(qe=-Kt,Ct=hn,Dt=Math.sqrt(Ui)):(qe=hn,Ct=Kt,Dt=Math.sqrt(Ui/2))}return new li(qe/Dt,Ct/Dt)}const st=[];for(let Ut=0,yt=ne.length,wt=yt-1,qe=Ut+1;Ut<yt;Ut++,wt++,qe++)wt===yt&&(wt=0),qe===yt&&(qe=0),st[Ut]=je(ne[Ut],ne[wt],ne[qe]);const nt=[];let ot,Vt=st.concat();for(let Ut=0,yt=L.length;Ut<yt;Ut++){const wt=L[Ut];ot=[];for(let qe=0,Ct=wt.length,Dt=Ct-1,hn=qe+1;qe<Ct;qe++,Dt++,hn++)Dt===Ct&&(Dt=0),hn===Ct&&(hn=0),ot[qe]=je(wt[qe],wt[Dt],wt[hn]);nt.push(ot),Vt=Vt.concat(ot)}for(let Ut=0;Ut<Oe;Ut++){const yt=Ut/Oe,wt=Ee*Math.cos(yt*Math.PI/2),qe=Ie*Math.sin(yt*Math.PI/2)+Ue;for(let Ct=0,Dt=ne.length;Ct<Dt;Ct++){const hn=be(ne[Ct],st[Ct],qe);Yt(hn.x,hn.y,-wt)}for(let Ct=0,Dt=L.length;Ct<Dt;Ct++){const hn=L[Ct];ot=nt[Ct];for(let Kt=0,yn=hn.length;Kt<yn;Kt++){const ii=be(hn[Kt],ot[Kt],qe);Yt(ii.x,ii.y,-wt)}}}const Jt=Ie+Ue;for(let Ut=0;Ut<Me;Ut++){const yt=ye?be(D[Ut],Vt[Ut],Jt):D[Ut];g?(xt.copy(Rt.normals[0]).multiplyScalar(yt.x),Et.copy(Rt.binormals[0]).multiplyScalar(yt.y),Zt.copy(Je[0]).add(xt).add(Et),Yt(Zt.x,Zt.y,Zt.z)):Yt(yt.x,yt.y,0)}for(let Ut=1;Ut<=re;Ut++)for(let yt=0;yt<Me;yt++){const wt=ye?be(D[yt],Vt[yt],Jt):D[yt];g?(xt.copy(Rt.normals[Ut]).multiplyScalar(wt.x),Et.copy(Rt.binormals[Ut]).multiplyScalar(wt.y),Zt.copy(Je[Ut]).add(xt).add(Et),Yt(Zt.x,Zt.y,Zt.z)):Yt(wt.x,wt.y,xe/re*Ut)}for(let Ut=Oe-1;Ut>=0;Ut--){const yt=Ut/Oe,wt=Ee*Math.cos(yt*Math.PI/2),qe=Ie*Math.sin(yt*Math.PI/2)+Ue;for(let Ct=0,Dt=ne.length;Ct<Dt;Ct++){const hn=be(ne[Ct],st[Ct],qe);Yt(hn.x,hn.y,xe+wt)}for(let Ct=0,Dt=L.length;Ct<Dt;Ct++){const hn=L[Ct];ot=nt[Ct];for(let Kt=0,yn=hn.length;Kt<yn;Kt++){const ii=be(hn[Kt],ot[Kt],qe);g?Yt(ii.x,ii.y+Je[re-1].y,Je[re-1].x+wt):Yt(ii.x,ii.y,xe+wt)}}}function en(Ut,yt){let wt=Ut.length;for(;--wt>=0;){const qe=wt;let Ct=wt-1;Ct<0&&(Ct=Ut.length-1);for(let Dt=0,hn=re+2*Oe;Dt<hn;Dt++){const Kt=Me*Dt,yn=Me*(Dt+1);et(yt+qe+Kt,yt+Ct+Kt,yt+Ct+yn,yt+qe+yn)}}}function Yt(Ut,yt,wt){Q.push(Ut),Q.push(yt),Q.push(wt)}function ln(Ut,yt,wt){$e(Ut),$e(yt),$e(wt);const qe=A.length/3,Ct=Ge.generateTopUV(_,A,qe-3,qe-2,qe-1);Gt(Ct[0]),Gt(Ct[1]),Gt(Ct[2])}function et(Ut,yt,wt,qe){$e(Ut),$e(yt),$e(qe),$e(yt),$e(wt),$e(qe);const Ct=A.length/3,Dt=Ge.generateSideWallUV(_,A,Ct-6,Ct-3,Ct-2,Ct-1);Gt(Dt[0]),Gt(Dt[1]),Gt(Dt[3]),Gt(Dt[1]),Gt(Dt[2]),Gt(Dt[3])}function $e(Ut){A.push(Q[3*Ut+0]),A.push(Q[3*Ut+1]),A.push(Q[3*Ut+2])}function Gt(Ut){E.push(Ut.x),E.push(Ut.y)}(function(){const Ut=A.length/3;if(ye){let yt=0,wt=Me*yt;for(let qe=0;qe<De;qe++){const Ct=Y[qe];ln(Ct[2]+wt,Ct[1]+wt,Ct[0]+wt)}yt=re+2*Oe,wt=Me*yt;for(let qe=0;qe<De;qe++){const Ct=Y[qe];ln(Ct[0]+wt,Ct[1]+wt,Ct[2]+wt)}}else{for(let yt=0;yt<De;yt++){const wt=Y[yt];ln(wt[2],wt[1],wt[0])}for(let yt=0;yt<De;yt++){const wt=Y[yt];ln(wt[0]+Me*re,wt[1]+Me*re,wt[2]+Me*re)}}_.addGroup(Ut,A.length/3-Ut,0)})(),function(){const Ut=A.length/3;let yt=0;en(ne,yt),yt+=ne.length;for(let wt=0,qe=L.length;wt<qe;wt++){const Ct=L[wt];en(Ct,yt),yt+=Ct.length}_.addGroup(Ut,A.length/3-Ut,1)}()}this.setAttribute("position",new tr(A,3)),this.setAttribute("uv",new tr(E,2)),this.computeVertexNormals()}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(d,_,A){if(A.shapes=[],Array.isArray(d))for(let E=0,P=d.length;E<P;E++){const k=d[E];A.shapes.push(k.uuid)}else A.shapes.push(d.uuid);return A.options=Object.assign({},_),_.extrudePath!==void 0&&(A.options.extrudePath=_.extrudePath.toJSON()),A}(this.parameters.shapes,this.parameters.options,r)}static fromJSON(r,d){const _=[];for(let E=0,P=r.shapes.length;E<P;E++){const k=d[r.shapes[E]];_.push(k)}const A=r.options.extrudePath;return A!==void 0&&(r.options.extrudePath=new kv[A.type]().fromJSON(A)),new Pd(_,r.options)}}const gA={generateTopUV:function(R,r,d,_,A){const E=r[3*d],P=r[3*d+1],k=r[3*_],Q=r[3*_+1],G=r[3*A],re=r[3*A+1];return[new li(E,P),new li(k,Q),new li(G,re)]},generateSideWallUV:function(R,r,d,_,A,E){const P=r[3*d],k=r[3*d+1],Q=r[3*d+2],G=r[3*_],re=r[3*_+1],xe=r[3*_+2],ye=r[3*A],Ee=r[3*A+1],Ie=r[3*A+2],Ue=r[3*E],Oe=r[3*E+1],ke=r[3*E+2];return Math.abs(k-re)<Math.abs(P-G)?[new li(P,1-Q),new li(G,1-xe),new li(ye,1-Ie),new li(Ue,1-ke)]:[new li(k,1-Q),new li(re,1-xe),new li(Ee,1-Ie),new li(Oe,1-ke)]}};class Pu extends rh{constructor(r=1,d=0){const _=(1+Math.sqrt(5))/2;super([-1,_,0,1,_,0,-1,-_,0,1,-_,0,0,-1,_,0,1,_,0,-1,-_,0,1,-_,_,0,-1,_,0,1,-_,0,-1,-_,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,d),this.type="IcosahedronGeometry",this.parameters={radius:r,detail:d}}static fromJSON(r){return new Pu(r.radius,r.detail)}}class Lm extends rh{constructor(r=1,d=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],r,d),this.type="OctahedronGeometry",this.parameters={radius:r,detail:d}}static fromJSON(r){return new Lm(r.radius,r.detail)}}class Za extends Fe{constructor(r=.5,d=1,_=32,A=1,E=0,P=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:r,outerRadius:d,thetaSegments:_,phiSegments:A,thetaStart:E,thetaLength:P},_=Math.max(3,_);const k=[],Q=[],G=[],re=[];let xe=r;const ye=(d-r)/(A=Math.max(1,A)),Ee=new zt,Ie=new li;for(let Ue=0;Ue<=A;Ue++){for(let Oe=0;Oe<=_;Oe++){const ke=E+Oe/_*P;Ee.x=xe*Math.cos(ke),Ee.y=xe*Math.sin(ke),Q.push(Ee.x,Ee.y,Ee.z),G.push(0,0,1),Ie.x=(Ee.x/d+1)/2,Ie.y=(Ee.y/d+1)/2,re.push(Ie.x,Ie.y)}xe+=ye}for(let Ue=0;Ue<A;Ue++){const Oe=Ue*(_+1);for(let ke=0;ke<_;ke++){const Ge=ke+Oe,Je=Ge,Rt=Ge+_+1,Et=Ge+_+2,xt=Ge+1;k.push(Je,Rt,xt),k.push(Rt,Et,xt)}}this.setIndex(k),this.setAttribute("position",new tr(Q,3)),this.setAttribute("normal",new tr(G,3)),this.setAttribute("uv",new tr(re,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new Za(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength)}}class h_ extends Fe{constructor(r=new Wh([new li(0,.5),new li(-.5,-.5),new li(.5,-.5)]),d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:r,curveSegments:d};const _=[],A=[],E=[],P=[];let k=0,Q=0;if(Array.isArray(r)===!1)G(r);else for(let re=0;re<r.length;re++)G(r[re]),this.addGroup(k,Q,re),k+=Q,Q=0;function G(re){const xe=A.length/3,ye=re.extractPoints(d);let Ee=ye.shape;const Ie=ye.holes;Ic.isClockWise(Ee)===!1&&(Ee=Ee.reverse());for(let Oe=0,ke=Ie.length;Oe<ke;Oe++){const Ge=Ie[Oe];Ic.isClockWise(Ge)===!0&&(Ie[Oe]=Ge.reverse())}const Ue=Ic.triangulateShape(Ee,Ie);for(let Oe=0,ke=Ie.length;Oe<ke;Oe++){const Ge=Ie[Oe];Ee=Ee.concat(Ge)}for(let Oe=0,ke=Ee.length;Oe<ke;Oe++){const Ge=Ee[Oe];A.push(Ge.x,Ge.y,0),E.push(0,0,1),P.push(Ge.x,Ge.y)}for(let Oe=0,ke=Ue.length;Oe<ke;Oe++){const Ge=Ue[Oe],Je=Ge[0]+xe,Rt=Ge[1]+xe,Et=Ge[2]+xe;_.push(Je,Rt,Et),Q+=3}}this.setIndex(_),this.setAttribute("position",new tr(A,3)),this.setAttribute("normal",new tr(E,3)),this.setAttribute("uv",new tr(P,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return function(d,_){if(_.shapes=[],Array.isArray(d))for(let A=0,E=d.length;A<E;A++){const P=d[A];_.shapes.push(P.uuid)}else _.shapes.push(d.uuid);return _}(this.parameters.shapes,r)}static fromJSON(r,d){const _=[];for(let A=0,E=r.shapes.length;A<E;A++){const P=d[r.shapes[A]];_.push(P)}return new h_(_,r.curveSegments)}}class oh extends Fe{constructor(r=1,d=32,_=16,A=0,E=2*Math.PI,P=0,k=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:r,widthSegments:d,heightSegments:_,phiStart:A,phiLength:E,thetaStart:P,thetaLength:k},d=Math.max(3,Math.floor(d)),_=Math.max(2,Math.floor(_));const Q=Math.min(P+k,Math.PI);let G=0;const re=[],xe=new zt,ye=new zt,Ee=[],Ie=[],Ue=[],Oe=[];for(let ke=0;ke<=_;ke++){const Ge=[],Je=ke/_;let Rt=0;ke===0&&P===0?Rt=.5/d:ke===_&&Q===Math.PI&&(Rt=-.5/d);for(let Et=0;Et<=d;Et++){const xt=Et/d;xe.x=-r*Math.cos(A+xt*E)*Math.sin(P+Je*k),xe.y=r*Math.cos(P+Je*k),xe.z=r*Math.sin(A+xt*E)*Math.sin(P+Je*k),Ie.push(xe.x,xe.y,xe.z),ye.copy(xe).normalize(),Ue.push(ye.x,ye.y,ye.z),Oe.push(xt+Rt,1-Je),Ge.push(G++)}re.push(Ge)}for(let ke=0;ke<_;ke++)for(let Ge=0;Ge<d;Ge++){const Je=re[ke][Ge+1],Rt=re[ke][Ge],Et=re[ke+1][Ge],xt=re[ke+1][Ge+1];(ke!==0||P>0)&&Ee.push(Je,Rt,xt),(ke!==_-1||Q<Math.PI)&&Ee.push(Rt,Et,xt)}this.setIndex(Ee),this.setAttribute("position",new tr(Ie,3)),this.setAttribute("normal",new tr(Ue,3)),this.setAttribute("uv",new tr(Oe,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new oh(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength)}}class Dd extends rh{constructor(r=1,d=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],r,d),this.type="TetrahedronGeometry",this.parameters={radius:r,detail:d}}static fromJSON(r){return new Dd(r.radius,r.detail)}}class _l extends Fe{constructor(r=1,d=.4,_=12,A=48,E=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:r,tube:d,radialSegments:_,tubularSegments:A,arc:E},_=Math.floor(_),A=Math.floor(A);const P=[],k=[],Q=[],G=[],re=new zt,xe=new zt,ye=new zt;for(let Ee=0;Ee<=_;Ee++)for(let Ie=0;Ie<=A;Ie++){const Ue=Ie/A*E,Oe=Ee/_*Math.PI*2;xe.x=(r+d*Math.cos(Oe))*Math.cos(Ue),xe.y=(r+d*Math.cos(Oe))*Math.sin(Ue),xe.z=d*Math.sin(Oe),k.push(xe.x,xe.y,xe.z),re.x=r*Math.cos(Ue),re.y=r*Math.sin(Ue),ye.subVectors(xe,re).normalize(),Q.push(ye.x,ye.y,ye.z),G.push(Ie/A),G.push(Ee/_)}for(let Ee=1;Ee<=_;Ee++)for(let Ie=1;Ie<=A;Ie++){const Ue=(A+1)*Ee+Ie-1,Oe=(A+1)*(Ee-1)+Ie-1,ke=(A+1)*(Ee-1)+Ie,Ge=(A+1)*Ee+Ie;P.push(Ue,Oe,Ge),P.push(Oe,ke,Ge)}this.setIndex(P),this.setAttribute("position",new tr(k,3)),this.setAttribute("normal",new tr(Q,3)),this.setAttribute("uv",new tr(G,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new _l(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc)}}class _o extends Fe{constructor(r=1,d=.4,_=64,A=8,E=2,P=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:r,tube:d,tubularSegments:_,radialSegments:A,p:E,q:P},_=Math.floor(_),A=Math.floor(A);const k=[],Q=[],G=[],re=[],xe=new zt,ye=new zt,Ee=new zt,Ie=new zt,Ue=new zt,Oe=new zt,ke=new zt;for(let Je=0;Je<=_;++Je){const Rt=Je/_*E*Math.PI*2;Ge(Rt,E,P,r,Ee),Ge(Rt+.01,E,P,r,Ie),Oe.subVectors(Ie,Ee),ke.addVectors(Ie,Ee),Ue.crossVectors(Oe,ke),ke.crossVectors(Ue,Oe),Ue.normalize(),ke.normalize();for(let Et=0;Et<=A;++Et){const xt=Et/A*Math.PI*2,Zt=-d*Math.cos(xt),g=d*Math.sin(xt);xe.x=Ee.x+(Zt*ke.x+g*Ue.x),xe.y=Ee.y+(Zt*ke.y+g*Ue.y),xe.z=Ee.z+(Zt*ke.z+g*Ue.z),Q.push(xe.x,xe.y,xe.z),ye.subVectors(xe,Ee).normalize(),G.push(ye.x,ye.y,ye.z),re.push(Je/_),re.push(Et/A)}}for(let Je=1;Je<=_;Je++)for(let Rt=1;Rt<=A;Rt++){const Et=(A+1)*(Je-1)+(Rt-1),xt=(A+1)*Je+(Rt-1),Zt=(A+1)*Je+Rt,g=(A+1)*(Je-1)+Rt;k.push(Et,xt,g),k.push(xt,Zt,g)}function Ge(Je,Rt,Et,xt,Zt){const g=Math.cos(Je),b=Math.sin(Je),D=Et/Rt*Je,L=Math.cos(D);Zt.x=xt*(2+L)*.5*g,Zt.y=xt*(2+L)*b*.5,Zt.z=xt*Math.sin(D)*.5}this.setIndex(k),this.setAttribute("position",new tr(Q,3)),this.setAttribute("normal",new tr(G,3)),this.setAttribute("uv",new tr(re,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}static fromJSON(r){return new _o(r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q)}}class Yr extends Fe{constructor(r=new r_(new zt(-1,-1,0),new zt(-1,1,0),new zt(1,1,0)),d=64,_=1,A=8,E=!1){super(),this.type="TubeGeometry",this.parameters={path:r,tubularSegments:d,radius:_,radialSegments:A,closed:E};const P=r.computeFrenetFrames(d,E);this.tangents=P.tangents,this.normals=P.normals,this.binormals=P.binormals;const k=new zt,Q=new zt,G=new li;let re=new zt;const xe=[],ye=[],Ee=[],Ie=[];function Ue(Oe){re=r.getPointAt(Oe/d,re);const ke=P.normals[Oe],Ge=P.binormals[Oe];for(let Je=0;Je<=A;Je++){const Rt=Je/A*Math.PI*2,Et=Math.sin(Rt),xt=-Math.cos(Rt);Q.x=xt*ke.x+Et*Ge.x,Q.y=xt*ke.y+Et*Ge.y,Q.z=xt*ke.z+Et*Ge.z,Q.normalize(),ye.push(Q.x,Q.y,Q.z),k.x=re.x+_*Q.x,k.y=re.y+_*Q.y,k.z=re.z+_*Q.z,xe.push(k.x,k.y,k.z)}}(function(){for(let Oe=0;Oe<d;Oe++)Ue(Oe);Ue(E===!1?d:0),function(){for(let Oe=0;Oe<=d;Oe++)for(let ke=0;ke<=A;ke++)G.x=Oe/d,G.y=ke/A,Ee.push(G.x,G.y)}(),function(){for(let Oe=1;Oe<=d;Oe++)for(let ke=1;ke<=A;ke++){const Ge=(A+1)*(Oe-1)+(ke-1),Je=(A+1)*Oe+(ke-1),Rt=(A+1)*Oe+ke,Et=(A+1)*(Oe-1)+ke;Ie.push(Ge,Je,Et),Ie.push(Je,Rt,Et)}}()})(),this.setIndex(Ie),this.setAttribute("position",new tr(xe,3)),this.setAttribute("normal",new tr(ye,3)),this.setAttribute("uv",new tr(Ee,2))}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}toJSON(){const r=super.toJSON();return r.path=this.parameters.path.toJSON(),r}static fromJSON(r){return new Yr(new kv[r.path.type]().fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed)}}class Ul extends Fe{constructor(r=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:r},r!==null){const d=[],_=new Set,A=new zt,E=new zt;if(r.index!==null){const P=r.attributes.position,k=r.index;let Q=r.groups;Q.length===0&&(Q=[{start:0,count:k.count,materialIndex:0}]);for(let G=0,re=Q.length;G<re;++G){const xe=Q[G],ye=xe.start;for(let Ee=ye,Ie=ye+xe.count;Ee<Ie;Ee+=3)for(let Ue=0;Ue<3;Ue++){const Oe=k.getX(Ee+Ue),ke=k.getX(Ee+(Ue+1)%3);A.fromBufferAttribute(P,Oe),E.fromBufferAttribute(P,ke),Ho(A,E,_)===!0&&(d.push(A.x,A.y,A.z),d.push(E.x,E.y,E.z))}}}else{const P=r.attributes.position;for(let k=0,Q=P.count/3;k<Q;k++)for(let G=0;G<3;G++){const re=3*k+G,xe=3*k+(G+1)%3;A.fromBufferAttribute(P,re),E.fromBufferAttribute(P,xe),Ho(A,E,_)===!0&&(d.push(A.x,A.y,A.z),d.push(E.x,E.y,E.z))}}this.setAttribute("position",new tr(d,3))}}copy(r){return super.copy(r),this.parameters=Object.assign({},r.parameters),this}}function Ho(R,r,d){const _=`${R.x},${R.y},${R.z}-${r.x},${r.y},${r.z}`,A=`${r.x},${r.y},${r.z}-${R.x},${R.y},${R.z}`;return d.has(_)!==!0&&d.has(A)!==!0&&(d.add(_),d.add(A),!0)}var Ip=Object.freeze({__proto__:null,BoxGeometry:Yu,CapsuleGeometry:Os,CircleGeometry:s_,ConeGeometry:Rc,CylinderGeometry:$l,DodecahedronGeometry:Cp,EdgesGeometry:o_,ExtrudeGeometry:Pd,IcosahedronGeometry:Pu,LatheGeometry:Ru,OctahedronGeometry:Lm,PlaneGeometry:Da,PolyhedronGeometry:rh,RingGeometry:Za,ShapeGeometry:h_,SphereGeometry:oh,TetrahedronGeometry:Dd,TorusGeometry:_l,TorusKnotGeometry:_o,TubeGeometry:Yr,WireframeGeometry:Ul});class Nm extends da{constructor(r){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Fi(0),this.transparent=!0,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.fog=r.fog,this}}class If extends Su{constructor(r){super(r),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class To extends da{constructor(r){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Fi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={STANDARD:""},this.color.copy(r.color),this.roughness=r.roughness,this.metalness=r.metalness,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.roughnessMap=r.roughnessMap,this.metalnessMap=r.metalnessMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.envMapIntensity=r.envMapIntensity,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class Jl extends To{constructor(r){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new li(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return xo(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(d){this.ior=(1+.4*d)/(1-.4*d)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Fi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Fi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Fi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(r)}get sheen(){return this._sheen}set sheen(r){this._sheen>0!=r>0&&this.version++,this._sheen=r}get clearcoat(){return this._clearcoat}set clearcoat(r){this._clearcoat>0!=r>0&&this.version++,this._clearcoat=r}get iridescence(){return this._iridescence}set iridescence(r){this._iridescence>0!=r>0&&this.version++,this._iridescence=r}get transmission(){return this._transmission}set transmission(r){this._transmission>0!=r>0&&this.version++,this._transmission=r}copy(r){return super.copy(r),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=r.clearcoat,this.clearcoatMap=r.clearcoatMap,this.clearcoatRoughness=r.clearcoatRoughness,this.clearcoatRoughnessMap=r.clearcoatRoughnessMap,this.clearcoatNormalMap=r.clearcoatNormalMap,this.clearcoatNormalScale.copy(r.clearcoatNormalScale),this.ior=r.ior,this.iridescence=r.iridescence,this.iridescenceMap=r.iridescenceMap,this.iridescenceIOR=r.iridescenceIOR,this.iridescenceThicknessRange=[...r.iridescenceThicknessRange],this.iridescenceThicknessMap=r.iridescenceThicknessMap,this.sheen=r.sheen,this.sheenColor.copy(r.sheenColor),this.sheenColorMap=r.sheenColorMap,this.sheenRoughness=r.sheenRoughness,this.sheenRoughnessMap=r.sheenRoughnessMap,this.transmission=r.transmission,this.transmissionMap=r.transmissionMap,this.thickness=r.thickness,this.thicknessMap=r.thicknessMap,this.attenuationDistance=r.attenuationDistance,this.attenuationColor.copy(r.attenuationColor),this.specularIntensity=r.specularIntensity,this.specularIntensityMap=r.specularIntensityMap,this.specularColor.copy(r.specularColor),this.specularColorMap=r.specularColorMap,this}}class Jo extends da{constructor(r){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Fi(16777215),this.specular=new Fi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.specular.copy(r.specular),this.shininess=r.shininess,this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class ks extends da{constructor(r){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Fi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.gradientMap=r.gradientMap,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.fog=r.fog,this}}class km extends da{constructor(r){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(r)}copy(r){return super.copy(r),this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.flatShading=r.flatShading,this}}class Pp extends da{constructor(r){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xe,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.color.copy(r.color),this.map=r.map,this.lightMap=r.lightMap,this.lightMapIntensity=r.lightMapIntensity,this.aoMap=r.aoMap,this.aoMapIntensity=r.aoMapIntensity,this.emissive.copy(r.emissive),this.emissiveMap=r.emissiveMap,this.emissiveIntensity=r.emissiveIntensity,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.specularMap=r.specularMap,this.alphaMap=r.alphaMap,this.envMap=r.envMap,this.combine=r.combine,this.reflectivity=r.reflectivity,this.refractionRatio=r.refractionRatio,this.wireframe=r.wireframe,this.wireframeLinewidth=r.wireframeLinewidth,this.wireframeLinecap=r.wireframeLinecap,this.wireframeLinejoin=r.wireframeLinejoin,this.flatShading=r.flatShading,this.fog=r.fog,this}}class _A extends da{constructor(r){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Fi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$s,this.normalScale=new li(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(r)}copy(r){return super.copy(r),this.defines={MATCAP:""},this.color.copy(r.color),this.matcap=r.matcap,this.map=r.map,this.bumpMap=r.bumpMap,this.bumpScale=r.bumpScale,this.normalMap=r.normalMap,this.normalMapType=r.normalMapType,this.normalScale.copy(r.normalScale),this.displacementMap=r.displacementMap,this.displacementScale=r.displacementScale,this.displacementBias=r.displacementBias,this.alphaMap=r.alphaMap,this.flatShading=r.flatShading,this.fog=r.fog,this}}class q0 extends gl{constructor(r){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(r)}copy(r){return super.copy(r),this.scale=r.scale,this.dashSize=r.dashSize,this.gapSize=r.gapSize,this}}function Du(R,r,d){return Pf(R)?new R.constructor(R.subarray(r,d!==void 0?d:R.length)):R.slice(r,d)}function Xh(R,r,d){return!R||!d&&R.constructor===r?R:typeof r.BYTES_PER_ELEMENT=="number"?new r(R):Array.prototype.slice.call(R)}function Pf(R){return ArrayBuffer.isView(R)&&!(R instanceof DataView)}function Od(R){const r=R.length,d=new Array(r);for(let _=0;_!==r;++_)d[_]=_;return d.sort(function(_,A){return R[_]-R[A]}),d}function Yh(R,r,d){const _=R.length,A=new R.constructor(_);for(let E=0,P=0;P!==_;++E){const k=d[E]*r;for(let Q=0;Q!==r;++Q)A[P++]=R[k+Q]}return A}function tu(R,r,d,_){let A=1,E=R[0];for(;E!==void 0&&E[_]===void 0;)E=R[A++];if(E===void 0)return;let P=E[_];if(P!==void 0)if(Array.isArray(P))do P=E[_],P!==void 0&&(r.push(E.time),d.push.apply(d,P)),E=R[A++];while(E!==void 0);else if(P.toArray!==void 0)do P=E[_],P!==void 0&&(r.push(E.time),P.toArray(d,d.length)),E=R[A++];while(E!==void 0);else do P=E[_],P!==void 0&&(r.push(E.time),d.push(P)),E=R[A++];while(E!==void 0)}const Zl={arraySlice:Du,convertArray:Xh,isTypedArray:Pf,getKeyframeOrder:Od,sortedArray:Yh,flattenJSON:tu,subclip:function(R,r,d,_,A=30){const E=R.clone();E.name=r;const P=[];for(let Q=0;Q<E.tracks.length;++Q){const G=E.tracks[Q],re=G.getValueSize(),xe=[],ye=[];for(let Ee=0;Ee<G.times.length;++Ee){const Ie=G.times[Ee]*A;if(!(Ie<d||Ie>=_)){xe.push(G.times[Ee]);for(let Ue=0;Ue<re;++Ue)ye.push(G.values[Ee*re+Ue])}}xe.length!==0&&(G.times=Xh(xe,G.times.constructor),G.values=Xh(ye,G.values.constructor),P.push(G))}E.tracks=P;let k=1/0;for(let Q=0;Q<E.tracks.length;++Q)k>E.tracks[Q].times[0]&&(k=E.tracks[Q].times[0]);for(let Q=0;Q<E.tracks.length;++Q)E.tracks[Q].shift(-1*k);return E.resetDuration(),E},makeClipAdditive:function(R,r=0,d=R,_=30){_<=0&&(_=30);const A=d.tracks.length,E=r/_;for(let P=0;P<A;++P){const k=d.tracks[P],Q=k.ValueTypeName;if(Q==="bool"||Q==="string")continue;const G=R.tracks.find(function(ke){return ke.name===k.name&&ke.ValueTypeName===Q});if(G===void 0)continue;let re=0;const xe=k.getValueSize();k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(re=xe/3);let ye=0;const Ee=G.getValueSize();G.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ye=Ee/3);const Ie=k.times.length-1;let Ue;if(E<=k.times[0]){const ke=re,Ge=xe-re;Ue=Du(k.values,ke,Ge)}else if(E>=k.times[Ie]){const ke=Ie*xe+re,Ge=ke+xe-re;Ue=Du(k.values,ke,Ge)}else{const ke=k.createInterpolant(),Ge=re,Je=xe-re;ke.evaluate(E),Ue=Du(ke.resultBuffer,Ge,Je)}Q==="quaternion"&&new Pl().fromArray(Ue).normalize().conjugate().toArray(Ue);const Oe=G.times.length;for(let ke=0;ke<Oe;++ke){const Ge=ke*Ee+ye;if(Q==="quaternion")Pl.multiplyQuaternionsFlat(G.values,Ge,Ue,0,G.values,Ge);else{const Je=Ee-2*ye;for(let Rt=0;Rt<Je;++Rt)G.values[Ge+Rt]-=Ue[Rt]}}}return R.blendMode=so,R}};class vl{constructor(r,d,_,A){this.parameterPositions=r,this._cachedIndex=0,this.resultBuffer=A!==void 0?A:new d.constructor(_),this.sampleValues=d,this.valueSize=_,this.settings=null,this.DefaultSettings_={}}evaluate(r){const d=this.parameterPositions;let _=this._cachedIndex,A=d[_],E=d[_-1];e:{t:{let P;n:{i:if(!(r<A)){for(let k=_+2;;){if(A===void 0){if(r<E)break i;return _=d.length,this._cachedIndex=_,this.copySampleValue_(_-1)}if(_===k)break;if(E=A,A=d[++_],r<A)break t}P=d.length;break n}if(r>=E)break e;{const k=d[1];r<k&&(_=2,E=k);for(let Q=_-2;;){if(E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_===Q)break;if(A=E,E=d[--_-1],r>=E)break t}P=_,_=0}}for(;_<P;){const k=_+P>>>1;r<d[k]?P=k:_=k+1}if(A=d[_],E=d[_-1],E===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(A===void 0)return _=d.length,this._cachedIndex=_,this.copySampleValue_(_-1)}this._cachedIndex=_,this.intervalChanged_(_,E,A)}return this.interpolate_(_,E,r,A)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(r){const d=this.resultBuffer,_=this.sampleValues,A=this.valueSize,E=r*A;for(let P=0;P!==A;++P)d[P]=_[E+P];return d}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Kh extends vl{constructor(r,d,_,A){super(r,d,_,A),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_s,endingEnd:_s}}intervalChanged_(r,d,_){const A=this.parameterPositions;let E=r-2,P=r+1,k=A[E],Q=A[P];if(k===void 0)switch(this.getSettings_().endingStart){case bo:E=r,k=2*d-_;break;case Ms:E=A.length-2,k=d+A[E]-A[E+1];break;default:E=r,k=_}if(Q===void 0)switch(this.getSettings_().endingEnd){case bo:P=r,Q=2*_-d;break;case Ms:P=1,Q=_+A[1]-A[0];break;default:P=r-1,Q=d}const G=.5*(_-d),re=this.valueSize;this._weightPrev=G/(d-k),this._weightNext=G/(Q-_),this._offsetPrev=E*re,this._offsetNext=P*re}interpolate_(r,d,_,A){const E=this.resultBuffer,P=this.sampleValues,k=this.valueSize,Q=r*k,G=Q-k,re=this._offsetPrev,xe=this._offsetNext,ye=this._weightPrev,Ee=this._weightNext,Ie=(_-d)/(A-d),Ue=Ie*Ie,Oe=Ue*Ie,ke=-ye*Oe+2*ye*Ue-ye*Ie,Ge=(1+ye)*Oe+(-1.5-2*ye)*Ue+(-.5+ye)*Ie+1,Je=(-1-Ee)*Oe+(1.5+Ee)*Ue+.5*Ie,Rt=Ee*Oe-Ee*Ue;for(let Et=0;Et!==k;++Et)E[Et]=ke*P[re+Et]+Ge*P[G+Et]+Je*P[Q+Et]+Rt*P[xe+Et];return E}}class Bd extends vl{constructor(r,d,_,A){super(r,d,_,A)}interpolate_(r,d,_,A){const E=this.resultBuffer,P=this.sampleValues,k=this.valueSize,Q=r*k,G=Q-k,re=(_-d)/(A-d),xe=1-re;for(let ye=0;ye!==k;++ye)E[ye]=P[G+ye]*xe+P[Q+ye]*re;return E}}class Um extends vl{constructor(r,d,_,A){super(r,d,_,A)}interpolate_(r){return this.copySampleValue_(r-1)}}class ba{constructor(r,d,_,A){if(r===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(d===void 0||d.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+r);this.name=r,this.times=Xh(d,this.TimeBufferType),this.values=Xh(_,this.ValueBufferType),this.setInterpolation(A||this.DefaultInterpolation)}static toJSON(r){const d=r.constructor;let _;if(d.toJSON!==this.toJSON)_=d.toJSON(r);else{_={name:r.name,times:Xh(r.times,Array),values:Xh(r.values,Array)};const A=r.getInterpolation();A!==r.DefaultInterpolation&&(_.interpolation=A)}return _.type=r.ValueTypeName,_}InterpolantFactoryMethodDiscrete(r){return new Um(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodLinear(r){return new Bd(this.times,this.values,this.getValueSize(),r)}InterpolantFactoryMethodSmooth(r){return new Kh(this.times,this.values,this.getValueSize(),r)}setInterpolation(r){let d;switch(r){case Wi:d=this.InterpolantFactoryMethodDiscrete;break;case Ir:d=this.InterpolantFactoryMethodLinear;break;case Ar:d=this.InterpolantFactoryMethodSmooth}if(d===void 0){const _="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(r===this.DefaultInterpolation)throw new Error(_);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",_),this}return this.createInterpolant=d,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wi;case this.InterpolantFactoryMethodLinear:return Ir;case this.InterpolantFactoryMethodSmooth:return Ar}}getValueSize(){return this.values.length/this.times.length}shift(r){if(r!==0){const d=this.times;for(let _=0,A=d.length;_!==A;++_)d[_]+=r}return this}scale(r){if(r!==1){const d=this.times;for(let _=0,A=d.length;_!==A;++_)d[_]*=r}return this}trim(r,d){const _=this.times,A=_.length;let E=0,P=A-1;for(;E!==A&&_[E]<r;)++E;for(;P!==-1&&_[P]>d;)--P;if(++P,E!==0||P!==A){E>=P&&(P=Math.max(P,1),E=P-1);const k=this.getValueSize();this.times=Du(_,E,P),this.values=Du(this.values,E*k,P*k)}return this}validate(){let r=!0;const d=this.getValueSize();d-Math.floor(d)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),r=!1);const _=this.times,A=this.values,E=_.length;E===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),r=!1);let P=null;for(let k=0;k!==E;k++){const Q=_[k];if(typeof Q=="number"&&isNaN(Q)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,k,Q),r=!1;break}if(P!==null&&P>Q){console.error("THREE.KeyframeTrack: Out of order keys.",this,k,Q,P),r=!1;break}P=Q}if(A!==void 0&&Pf(A))for(let k=0,Q=A.length;k!==Q;++k){const G=A[k];if(isNaN(G)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,k,G),r=!1;break}}return r}optimize(){const r=Du(this.times),d=Du(this.values),_=this.getValueSize(),A=this.getInterpolation()===Ar,E=r.length-1;let P=1;for(let k=1;k<E;++k){let Q=!1;const G=r[k];if(G!==r[k+1]&&(k!==1||G!==r[0]))if(A)Q=!0;else{const re=k*_,xe=re-_,ye=re+_;for(let Ee=0;Ee!==_;++Ee){const Ie=d[re+Ee];if(Ie!==d[xe+Ee]||Ie!==d[ye+Ee]){Q=!0;break}}}if(Q){if(k!==P){r[P]=r[k];const re=k*_,xe=P*_;for(let ye=0;ye!==_;++ye)d[xe+ye]=d[re+ye]}++P}}if(E>0){r[P]=r[E];for(let k=E*_,Q=P*_,G=0;G!==_;++G)d[Q+G]=d[k+G];++P}return P!==r.length?(this.times=Du(r,0,P),this.values=Du(d,0,P*_)):(this.times=r,this.values=d),this}clone(){const r=Du(this.times,0),d=Du(this.values,0),_=new this.constructor(this.name,r,d);return _.createInterpolant=this.createInterpolant,_}}ba.prototype.TimeBufferType=Float32Array,ba.prototype.ValueBufferType=Float32Array,ba.prototype.DefaultInterpolation=Ir;class nu extends ba{}nu.prototype.ValueTypeName="bool",nu.prototype.ValueBufferType=Array,nu.prototype.DefaultInterpolation=Wi,nu.prototype.InterpolantFactoryMethodLinear=void 0,nu.prototype.InterpolantFactoryMethodSmooth=void 0;class Pc extends ba{}Pc.prototype.ValueTypeName="color";class $h extends ba{}$h.prototype.ValueTypeName="number";class Co extends vl{constructor(r,d,_,A){super(r,d,_,A)}interpolate_(r,d,_,A){const E=this.resultBuffer,P=this.sampleValues,k=this.valueSize,Q=(_-d)/(A-d);let G=r*k;for(let re=G+k;G!==re;G+=4)Pl.slerpFlat(E,0,P,G-k,P,G,Q);return E}}class iu extends ba{InterpolantFactoryMethodLinear(r){return new Co(this.times,this.values,this.getValueSize(),r)}}iu.prototype.ValueTypeName="quaternion",iu.prototype.DefaultInterpolation=Ir,iu.prototype.InterpolantFactoryMethodSmooth=void 0;class Dp extends ba{}Dp.prototype.ValueTypeName="string",Dp.prototype.ValueBufferType=Array,Dp.prototype.DefaultInterpolation=Wi,Dp.prototype.InterpolantFactoryMethodLinear=void 0,Dp.prototype.InterpolantFactoryMethodSmooth=void 0;class Ld extends ba{}Ld.prototype.ValueTypeName="vector";class ec{constructor(r,d=-1,_,A=Ks){this.name=r,this.tracks=_,this.duration=d,this.blendMode=A,this.uuid=Cl(),this.duration<0&&this.resetDuration()}static parse(r){const d=[],_=r.tracks,A=1/(r.fps||1);for(let P=0,k=_.length;P!==k;++P)d.push(Fl(_[P]).scale(A));const E=new this(r.name,r.duration,d,r.blendMode);return E.uuid=r.uuid,E}static toJSON(r){const d=[],_=r.tracks,A={name:r.name,duration:r.duration,tracks:d,uuid:r.uuid,blendMode:r.blendMode};for(let E=0,P=_.length;E!==P;++E)d.push(ba.toJSON(_[E]));return A}static CreateFromMorphTargetSequence(r,d,_,A){const E=d.length,P=[];for(let k=0;k<E;k++){let Q=[],G=[];Q.push((k+E-1)%E,k,(k+1)%E),G.push(0,1,0);const re=Od(Q);Q=Yh(Q,1,re),G=Yh(G,1,re),A||Q[0]!==0||(Q.push(E),G.push(G[0])),P.push(new $h(".morphTargetInfluences["+d[k].name+"]",Q,G).scale(1/_))}return new this(r,-1,P)}static findByName(r,d){let _=r;if(!Array.isArray(r)){const A=r;_=A.geometry&&A.geometry.animations||A.animations}for(let A=0;A<_.length;A++)if(_[A].name===d)return _[A];return null}static CreateClipsFromMorphTargetSequences(r,d,_){const A={},E=/^([\w-]*?)([\d]+)$/;for(let k=0,Q=r.length;k<Q;k++){const G=r[k],re=G.name.match(E);if(re&&re.length>1){const xe=re[1];let ye=A[xe];ye||(A[xe]=ye=[]),ye.push(G)}}const P=[];for(const k in A)P.push(this.CreateFromMorphTargetSequence(k,A[k],d,_));return P}static parseAnimation(r,d){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const _=function(re,xe,ye,Ee,Ie){if(ye.length!==0){const Ue=[],Oe=[];tu(ye,Ue,Oe,Ee),Ue.length!==0&&Ie.push(new re(xe,Ue,Oe))}},A=[],E=r.name||"default",P=r.fps||30,k=r.blendMode;let Q=r.length||-1;const G=r.hierarchy||[];for(let re=0;re<G.length;re++){const xe=G[re].keys;if(xe&&xe.length!==0)if(xe[0].morphTargets){const ye={};let Ee;for(Ee=0;Ee<xe.length;Ee++)if(xe[Ee].morphTargets)for(let Ie=0;Ie<xe[Ee].morphTargets.length;Ie++)ye[xe[Ee].morphTargets[Ie]]=-1;for(const Ie in ye){const Ue=[],Oe=[];for(let ke=0;ke!==xe[Ee].morphTargets.length;++ke){const Ge=xe[Ee];Ue.push(Ge.time),Oe.push(Ge.morphTarget===Ie?1:0)}A.push(new $h(".morphTargetInfluence["+Ie+"]",Ue,Oe))}Q=ye.length*P}else{const ye=".bones["+d[re].name+"]";_(Ld,ye+".position",xe,"pos",A),_(iu,ye+".quaternion",xe,"rot",A),_(Ld,ye+".scale",xe,"scl",A)}}return A.length===0?null:new this(E,Q,A,k)}resetDuration(){let r=0;for(let d=0,_=this.tracks.length;d!==_;++d){const A=this.tracks[d];r=Math.max(r,A.times[A.times.length-1])}return this.duration=r,this}trim(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this}validate(){let r=!0;for(let d=0;d<this.tracks.length;d++)r=r&&this.tracks[d].validate();return r}optimize(){for(let r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this}clone(){const r=[];for(let d=0;d<this.tracks.length;d++)r.push(this.tracks[d].clone());return new this.constructor(this.name,this.duration,r,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Fl(R){if(R.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const r=function(d){switch(d.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $h;case"vector":case"vector2":case"vector3":case"vector4":return Ld;case"color":return Pc;case"quaternion":return iu;case"bool":case"boolean":return nu;case"string":return Dp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+d)}(R.type);if(R.times===void 0){const d=[],_=[];tu(R.keys,d,_,"value"),R.times=d,R.values=_}return r.parse!==void 0?r.parse(R):new r(R.name,R.times,R.values,R.interpolation)}const Jh={enabled:!1,files:{},add:function(R,r){this.enabled!==!1&&(this.files[R]=r)},get:function(R,r){return this.enabled===!1?r?Promise.resolve():void 0:r?Promise.resolve(this.files[R]):this.files[R]},remove:function(R){delete this.files[R]},clear:function(){this.files={}}};class yl{constructor(r,d,_){const A=this;let E,P=!1,k=0,Q=0;const G=[];this.onStart=void 0,this.onLoad=r,this.onProgress=d,this.onError=_,this.itemStart=function(re){Q++,P===!1&&A.onStart!==void 0&&A.onStart(re,k,Q),P=!0},this.itemEnd=function(re){k++,A.onProgress!==void 0&&A.onProgress(re,k,Q),k===Q&&(P=!1,A.onLoad!==void 0&&A.onLoad())},this.itemError=function(re){A.onError!==void 0&&A.onError(re)},this.resolveURL=function(re){return E?E(re):re},this.setURLModifier=function(re){return E=re,this},this.addHandler=function(re,xe){return G.push(re,xe),this},this.removeHandler=function(re){const xe=G.indexOf(re);return xe!==-1&&G.splice(xe,2),this},this.getHandler=function(re){for(let xe=0,ye=G.length;xe<ye;xe+=2){const Ee=G[xe],Ie=G[xe+1];if(Ee.global&&(Ee.lastIndex=0),Ee.test(re))return Ie}return null}}}const Gv=new yl;class tc{constructor(r){this.manager=r!==void 0?r:Gv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(r,d){const _=this;return new Promise(function(A,E){_.load(r,A,d,E)})}parse(){}setCrossOrigin(r){return this.crossOrigin=r,this}setWithCredentials(r){return this.withCredentials=r,this}setPath(r){return this.path=r,this}setResourcePath(r){return this.resourcePath=r,this}setRequestHeader(r){return this.requestHeader=r,this}}const Nd={};class Rb extends Error{constructor(r,d){super(r),this.response=d}}class Dc extends tc{constructor(r){super(r),this.responseType="text",this.useCache=!0}load(r,d,_,A){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r),(this.useCache?Jh.get(r,this.responseType,this.mimeType):Promise.resolve(void 0)).then(E=>{if(E!==void 0)return this.manager.itemStart(r),setTimeout(()=>{d&&d(E),this.manager.itemEnd(r)},0),E;if(Nd[r]!==void 0)return void Nd[r].push({onLoad:d,onProgress:_,onError:A});Nd[r]=[],Nd[r].push({onLoad:d,onProgress:_,onError:A});const P=new Request(r,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),k=this.mimeType,Q=this.responseType;fetch(P).then(G=>{if(G.status===200||G.status===0){if(G.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||G.body===void 0||G.body.getReader===void 0)return G;const re=Nd[r],xe=G.body.getReader(),ye=G.headers.get("Content-Length")||G.headers.get("X-File-Size"),Ee=ye?parseInt(ye):0,Ie=Ee!==0;let Ue=0;const Oe=new ReadableStream({start(ke){(function Ge(){xe.read().then(({done:Je,value:Rt})=>{if(Je)ke.close();else{Ue+=Rt.byteLength;const Et=new ProgressEvent("progress",{lengthComputable:Ie,loaded:Ue,total:Ee});for(let xt=0,Zt=re.length;xt<Zt;xt++){const g=re[xt];g.onProgress&&g.onProgress(Et)}ke.enqueue(Rt),Ge()}})})()}});return new Response(Oe)}throw new Rb(`fetch for "${G.url}" responded with ${G.status}: ${G.statusText}`,G)}).then(G=>{switch(Q){case"arraybuffer":return G.arrayBuffer();case"blob":return G.blob();case"document":return G.text().then(re=>new DOMParser().parseFromString(re,k));case"json":return G.json();default:if(k===void 0)return G.text();{const re=/charset="?([^;"\s]*)"?/i.exec(k),xe=re&&re[1]?re[1].toLowerCase():void 0,ye=new TextDecoder(xe);return G.arrayBuffer().then(Ee=>ye.decode(Ee))}}}).then(G=>{this.useCache&&Jh.add(r,G,this.responseType);const re=Nd[r];delete Nd[r];for(let xe=0,ye=re.length;xe<ye;xe++){const Ee=re[xe];Ee.onLoad&&Ee.onLoad(G)}}).catch(G=>{const re=Nd[r];if(re===void 0)throw this.manager.itemError(r),G;delete Nd[r];for(let xe=0,ye=re.length;xe<ye;xe++){const Ee=re[xe];Ee.onError&&Ee.onError(G)}this.manager.itemError(r)}).finally(()=>{this.useCache&&this.manager.itemEnd(r)}),this.useCache&&this.manager.itemStart(r)})}setResponseType(r){return this.responseType=r,this}setMimeType(r){return this.mimeType=r,this}}class Hv extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=new Dc(this.manager);P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(r,function(k){try{d(E.parse(JSON.parse(k)))}catch(Q){A?A(Q):console.error(Q),E.manager.itemError(r)}},_,A)}parse(r){const d=[];for(let _=0;_<r.length;_++){const A=ec.parse(r[_]);d.push(A)}return d}}class ru extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=[],k=new Iv,Q=new Dc(this.manager);Q.setPath(this.path),Q.setResponseType("arraybuffer"),Q.setRequestHeader(this.requestHeader),Q.setWithCredentials(E.withCredentials);let G=0;function re(xe){Q.load(r[xe],function(ye){const Ee=E.parse(ye,!0);P[xe]={width:Ee.width,height:Ee.height,format:Ee.format,mipmaps:Ee.mipmaps},G+=1,G===6&&(Ee.mipmapCount===1&&(k.minFilter=Nn),k.image=P,k.format=Ee.format,k.needsUpdate=!0,d&&d(k))},_,A)}if(Array.isArray(r))for(let xe=0,ye=r.length;xe<ye;++xe)re(xe);else Q.load(r,function(xe){const ye=E.parse(xe,!0);if(ye.isCubemap){const Ee=ye.mipmaps.length/ye.mipmapCount;for(let Ie=0;Ie<Ee;Ie++){P[Ie]={mipmaps:[]};for(let Ue=0;Ue<ye.mipmapCount;Ue++)P[Ie].mipmaps.push(ye.mipmaps[Ie*ye.mipmapCount+Ue]),P[Ie].format=ye.format,P[Ie].width=ye.width,P[Ie].height=ye.height}k.image=P}else k.image.width=ye.width,k.image.height=ye.height,k.mipmaps=ye.mipmaps;ye.mipmapCount===1&&(k.minFilter=Nn),k.format=ye.format,k.needsUpdate=!0,d&&d(k)},_,A);return k}}class Fm extends tc{constructor(r){super(r)}load(r,d,_,A){const E=r;this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const P=this,k=Jh.get(r);if(k!==void 0)return P.manager.itemStart(r),setTimeout(function(){d&&d(k),P.manager.itemEnd(r)},0),k;const Q=hc("img");function G(){xe(),Jh.add(r,this),d&&d(this),P.manager.itemEnd(r)}function re(ye){xe(),A&&A(ye),P.manager.itemError(r),P.manager.itemEnd(r)}function xe(){Q.removeEventListener("load",G,!1),Q.removeEventListener("error",re,!1)}return Q.addEventListener("load",G,!1),Q.addEventListener("error",re,!1),r.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(Q.crossOrigin=this.crossOrigin),P.manager.itemStart(r),Jh.get(r,"blob").then(ye=>{if(ye!==void 0&&!ye.type.startsWith("text/plain"))return ye.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(ye=new Blob([ye],{type:"image/svg+xml"})),void(Q.src=URL.createObjectURL(ye));const Ee=new Dc(this.manager);Ee.useCache=!1,Ee.setPath(this.path),Ee.setCrossOrigin(this.crossOrigin),Ee.setResponseType("blob"),Ee.load(E,function(Ie){Ie.type||(r.endsWith(".svg")||r.startsWith("data:image/svg"))&&(Ie=new Blob([Ie],{type:"image/svg+xml"})),Jh.add(r,Ie,"blob"),Q.src=URL.createObjectURL(Ie)},_,Ie=>{xe(),A&&A(Ie)})}),Q}}class zm extends tc{constructor(r){super(r)}load(r,d,_,A){const E=new xd,P=new Fm(this.manager);P.setCrossOrigin(this.crossOrigin),P.setPath(this.path);let k=0;function Q(G){P.load(r[G],function(re){E.images[G]=re,k++,k===6&&(E.needsUpdate=!0,d&&d(E))},void 0,A)}for(let G=0;G<r.length;++G)Q(G);return E}}class vA extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=new Ep,k=new Dc(this.manager);return k.setResponseType("arraybuffer"),k.setRequestHeader(this.requestHeader),k.setPath(this.path),k.setWithCredentials(E.withCredentials),k.load(r,function(Q){const G=E.parse(Q);G&&(G.image!==void 0?P.image=G.image:G.data!==void 0&&(P.image.width=G.width,P.image.height=G.height,P.image.data=G.data,P.image.complete=!0),P.wrapS=G.wrapS!==void 0?G.wrapS:It,P.wrapT=G.wrapT!==void 0?G.wrapT:It,P.magFilter=G.magFilter!==void 0?G.magFilter:Nn,P.minFilter=G.minFilter!==void 0?G.minFilter:Nn,P.anisotropy=G.anisotropy!==void 0?G.anisotropy:1,G.colorSpace!==void 0?P.colorSpace=G.colorSpace:G.encoding!==void 0&&(P.encoding=G.encoding),G.flipY!==void 0&&(P.flipY=G.flipY),G.format!==void 0&&(P.format=G.format),G.type!==void 0&&(P.type=G.type),G.mipmaps!==void 0&&(P.mipmaps=G.mipmaps,P.minFilter=Mr),G.mipmapCount===1&&(P.minFilter=Nn),G.generateMipmaps!==void 0&&(P.generateMipmaps=G.generateMipmaps),P.needsUpdate=!0,d&&d(P,G))},_,A),P}}class Wv extends tc{constructor(r){super(r)}load(r,d,_,A){const E=new Us,P=new Fm(this.manager);return P.setCrossOrigin(this.crossOrigin),P.setPath(this.path),P.load(r,function(k){E.image=k,E.needsUpdate=!0,d!==void 0&&d(E)},_,A),E}}class Ou extends bs{constructor(r,d=1){super(),this.isLight=!0,this.type="Light",this.color=new Fi(r),this.intensity=d}dispose(){}copy(r,d){return super.copy(r,d),this.color.copy(r.color),this.intensity=r.intensity,this}toJSON(r){const d=super.toJSON(r);return d.object.color=this.color.getHex(),d.object.intensity=this.intensity,this.groundColor!==void 0&&(d.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(d.object.distance=this.distance),this.angle!==void 0&&(d.object.angle=this.angle),this.decay!==void 0&&(d.object.decay=this.decay),this.penumbra!==void 0&&(d.object.penumbra=this.penumbra),this.shadow!==void 0&&(d.object.shadow=this.shadow.toJSON()),d}}class X0 extends Ou{constructor(r,d,_){super(r,_),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(bs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Fi(d)}copy(r,d){return super.copy(r,d),this.groundColor.copy(r.groundColor),this}}const d_=new Gr,Bu=new zt,Qv=new zt;class jm{constructor(r){this.camera=r,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new li(512,512),this.map=null,this.mapPass=null,this.matrix=new Gr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cv,this._frameExtents=new li(1,1),this._viewportCount=1,this._viewports=[new Vr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(r){const d=this.camera,_=this.matrix;Bu.setFromMatrixPosition(r.matrixWorld),d.position.copy(Bu),Qv.setFromMatrixPosition(r.target.matrixWorld),d.lookAt(Qv),d.updateMatrixWorld(),d_.multiplyMatrices(d.projectionMatrix,d.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d_),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(d_)}getViewport(r){return this._viewports[r]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(r){return this.camera=r.camera.clone(),this.bias=r.bias,this.normalBias=r.normalBias,this.radius=r.radius,this.mapSize.copy(r.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const r={};return this.bias!==0&&(r.bias=this.bias),this.normalBias!==0&&(r.normalBias=this.normalBias),this.radius!==1&&(r.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(r.mapSize=this.mapSize.toArray()),r.camera=this.camera.toJSON(!1).object,delete r.camera.matrix,r}}class Lu extends jm{constructor(){super(new Eo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(r){const d=this.camera,_=2*uc*r.angle*this.focus,A=this.mapSize.width/this.mapSize.height,E=r.distance||d.far;_===d.fov&&A===d.aspect&&E===d.far||(d.fov=_,d.aspect=A,d.far=E,d.updateProjectionMatrix()),super.updateMatrices(r)}copy(r){return super.copy(r),this.focus=r.focus,this}}class yA extends Ou{constructor(r,d,_=0,A=Math.PI/3,E=0,P=2){super(r,d),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(bs.DEFAULT_UP),this.updateMatrix(),this.target=new bs,this.distance=_,this.angle=A,this.penumbra=E,this.decay=P,this.map=null,this.shadow=new Lu}get power(){return this.intensity*Math.PI}set power(r){this.intensity=r/Math.PI}dispose(){this.shadow.dispose()}copy(r,d){return super.copy(r,d),this.distance=r.distance,this.angle=r.angle,this.penumbra=r.penumbra,this.decay=r.decay,this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}const Y0=new Gr,Vm=new zt,p_=new zt;class AA extends jm{constructor(){super(new Eo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new li(4,2),this._viewportCount=6,this._viewports=[new Vr(2,1,1,1),new Vr(0,1,1,1),new Vr(3,1,1,1),new Vr(1,1,1,1),new Vr(3,0,1,1),new Vr(1,0,1,1)],this._cubeDirections=[new zt(1,0,0),new zt(-1,0,0),new zt(0,0,1),new zt(0,0,-1),new zt(0,1,0),new zt(0,-1,0)],this._cubeUps=[new zt(0,1,0),new zt(0,1,0),new zt(0,1,0),new zt(0,1,0),new zt(0,0,1),new zt(0,0,-1)]}updateMatrices(r,d=0){const _=this.camera,A=this.matrix,E=r.distance||_.far;E!==_.far&&(_.far=E,_.updateProjectionMatrix()),Vm.setFromMatrixPosition(r.matrixWorld),_.position.copy(Vm),p_.copy(_.position),p_.add(this._cubeDirections[d]),_.up.copy(this._cubeUps[d]),_.lookAt(p_),_.updateMatrixWorld(),A.makeTranslation(-Vm.x,-Vm.y,-Vm.z),Y0.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Y0)}}class Nu extends Ou{constructor(r,d,_=0,A=2){super(r,d),this.isPointLight=!0,this.type="PointLight",this.distance=_,this.decay=A,this.shadow=new AA}get power(){return 4*this.intensity*Math.PI}set power(r){this.intensity=r/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(r,d){return super.copy(r,d),this.distance=r.distance,this.decay=r.decay,this.shadow=r.shadow.clone(),this}}class f_ extends jm{constructor(){super(new So(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Oc extends Ou{constructor(r,d){super(r,d),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(bs.DEFAULT_UP),this.updateMatrix(),this.target=new bs,this.shadow=new f_}dispose(){this.shadow.dispose()}copy(r){return super.copy(r),this.target=r.target.clone(),this.shadow=r.shadow.clone(),this}}class su extends Ou{constructor(r,d){super(r,d),this.isAmbientLight=!0,this.type="AmbientLight"}}class zl extends Ou{constructor(r,d,_=10,A=10){super(r,d),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=_,this.height=A}get power(){return this.intensity*this.width*this.height*Math.PI}set power(r){this.intensity=r/(this.width*this.height*Math.PI)}copy(r){return super.copy(r),this.width=r.width,this.height=r.height,this}toJSON(r){const d=super.toJSON(r);return d.object.width=this.width,d.object.height=this.height,d}}class ka{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let r=0;r<9;r++)this.coefficients.push(new zt)}set(r){for(let d=0;d<9;d++)this.coefficients[d].copy(r[d]);return this}zero(){for(let r=0;r<9;r++)this.coefficients[r].set(0,0,0);return this}getAt(r,d){const _=r.x,A=r.y,E=r.z,P=this.coefficients;return d.copy(P[0]).multiplyScalar(.282095),d.addScaledVector(P[1],.488603*A),d.addScaledVector(P[2],.488603*E),d.addScaledVector(P[3],.488603*_),d.addScaledVector(P[4],_*A*1.092548),d.addScaledVector(P[5],A*E*1.092548),d.addScaledVector(P[6],.315392*(3*E*E-1)),d.addScaledVector(P[7],_*E*1.092548),d.addScaledVector(P[8],.546274*(_*_-A*A)),d}getIrradianceAt(r,d){const _=r.x,A=r.y,E=r.z,P=this.coefficients;return d.copy(P[0]).multiplyScalar(.886227),d.addScaledVector(P[1],1.023328*A),d.addScaledVector(P[2],1.023328*E),d.addScaledVector(P[3],1.023328*_),d.addScaledVector(P[4],.858086*_*A),d.addScaledVector(P[5],.858086*A*E),d.addScaledVector(P[6],.743125*E*E-.247708),d.addScaledVector(P[7],.858086*_*E),d.addScaledVector(P[8],.429043*(_*_-A*A)),d}add(r){for(let d=0;d<9;d++)this.coefficients[d].add(r.coefficients[d]);return this}addScaledSH(r,d){for(let _=0;_<9;_++)this.coefficients[_].addScaledVector(r.coefficients[_],d);return this}scale(r){for(let d=0;d<9;d++)this.coefficients[d].multiplyScalar(r);return this}lerp(r,d){for(let _=0;_<9;_++)this.coefficients[_].lerp(r.coefficients[_],d);return this}equals(r){for(let d=0;d<9;d++)if(!this.coefficients[d].equals(r.coefficients[d]))return!1;return!0}copy(r){return this.set(r.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(r,d=0){const _=this.coefficients;for(let A=0;A<9;A++)_[A].fromArray(r,d+3*A);return this}toArray(r=[],d=0){const _=this.coefficients;for(let A=0;A<9;A++)_[A].toArray(r,d+3*A);return r}static getBasisAt(r,d){const _=r.x,A=r.y,E=r.z;d[0]=.282095,d[1]=.488603*A,d[2]=.488603*E,d[3]=.488603*_,d[4]=1.092548*_*A,d[5]=1.092548*A*E,d[6]=.315392*(3*E*E-1),d[7]=1.092548*_*E,d[8]=.546274*(_*_-A*A)}}class Zo extends Ou{constructor(r=new ka,d=1){super(void 0,d),this.isLightProbe=!0,this.sh=r}copy(r){return super.copy(r),this.sh.copy(r.sh),this}fromJSON(r){return this.intensity=r.intensity,this.sh.fromArray(r.sh),this}toJSON(r){const d=super.toJSON(r);return d.object.sh=this.sh.toArray(),d}}class Op extends tc{constructor(r){super(r),this.textures={}}load(r,d,_,A){const E=this,P=new Dc(E.manager);P.setPath(E.path),P.setRequestHeader(E.requestHeader),P.setWithCredentials(E.withCredentials),P.load(r,function(k){try{d(E.parse(JSON.parse(k)))}catch(Q){A?A(Q):console.error(Q),E.manager.itemError(r)}},_,A)}parse(r){const d=this.textures;function _(P){return d[P]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",P),d[P]}const A=r.metadata&&r.metadata.version<=4.5?Is:void 0,E=Op.createMaterialFromType(r.type);if(r.uuid!==void 0&&(E.uuid=r.uuid),r.name!==void 0&&(E.name=r.name),r.color!==void 0&&E.color!==void 0&&E.color.setHex(r.color,A),r.roughness!==void 0&&(E.roughness=r.roughness),r.metalness!==void 0&&(E.metalness=r.metalness),r.sheen!==void 0&&(E.sheen=r.sheen),r.sheenColor!==void 0&&(E.sheenColor=new Fi().setHex(r.sheenColor,A)),r.sheenRoughness!==void 0&&(E.sheenRoughness=r.sheenRoughness),r.emissive!==void 0&&E.emissive!==void 0&&E.emissive.setHex(r.emissive,A),r.specular!==void 0&&E.specular!==void 0&&E.specular.setHex(r.specular,A),r.specularIntensity!==void 0&&(E.specularIntensity=r.specularIntensity),r.specularColor!==void 0&&E.specularColor!==void 0&&E.specularColor.setHex(r.specularColor,A),r.shininess!==void 0&&(E.shininess=r.shininess),r.clearcoat!==void 0&&(E.clearcoat=r.clearcoat),r.clearcoatRoughness!==void 0&&(E.clearcoatRoughness=r.clearcoatRoughness),r.iridescence!==void 0&&(E.iridescence=r.iridescence),r.iridescenceIOR!==void 0&&(E.iridescenceIOR=r.iridescenceIOR),r.iridescenceThicknessRange!==void 0&&(E.iridescenceThicknessRange=r.iridescenceThicknessRange),r.transmission!==void 0&&(E.transmission=r.transmission),r.thickness!==void 0&&(E.thickness=r.thickness),r.attenuationDistance!==void 0&&(E.attenuationDistance=r.attenuationDistance),r.attenuationColor!==void 0&&E.attenuationColor!==void 0&&E.attenuationColor.setHex(r.attenuationColor,A),r.fog!==void 0&&(E.fog=r.fog),r.flatShading!==void 0&&(E.flatShading=r.flatShading),r.blending!==void 0&&(E.blending=r.blending),r.combine!==void 0&&(E.combine=r.combine),r.side!==void 0&&(E.side=r.side),r.shadowSide!==void 0&&(E.shadowSide=r.shadowSide),r.opacity!==void 0&&(E.opacity=r.opacity),r.transparent!==void 0&&(E.transparent=r.transparent),r.alphaTest!==void 0&&(E.alphaTest=r.alphaTest),r.depthTest!==void 0&&(E.depthTest=r.depthTest),r.depthWrite!==void 0&&(E.depthWrite=r.depthWrite),r.colorWrite!==void 0&&(E.colorWrite=r.colorWrite),r.stencilWrite!==void 0&&(E.stencilWrite=r.stencilWrite),r.stencilWriteMask!==void 0&&(E.stencilWriteMask=r.stencilWriteMask),r.stencilFunc!==void 0&&(E.stencilFunc=r.stencilFunc),r.stencilRef!==void 0&&(E.stencilRef=r.stencilRef),r.stencilFuncMask!==void 0&&(E.stencilFuncMask=r.stencilFuncMask),r.stencilFail!==void 0&&(E.stencilFail=r.stencilFail),r.stencilZFail!==void 0&&(E.stencilZFail=r.stencilZFail),r.stencilZPass!==void 0&&(E.stencilZPass=r.stencilZPass),r.wireframe!==void 0&&(E.wireframe=r.wireframe),r.wireframeLinewidth!==void 0&&(E.wireframeLinewidth=r.wireframeLinewidth),r.wireframeLinecap!==void 0&&(E.wireframeLinecap=r.wireframeLinecap),r.wireframeLinejoin!==void 0&&(E.wireframeLinejoin=r.wireframeLinejoin),r.rotation!==void 0&&(E.rotation=r.rotation),r.linewidth!==1&&(E.linewidth=r.linewidth),r.dashSize!==void 0&&(E.dashSize=r.dashSize),r.gapSize!==void 0&&(E.gapSize=r.gapSize),r.scale!==void 0&&(E.scale=r.scale),r.polygonOffset!==void 0&&(E.polygonOffset=r.polygonOffset),r.polygonOffsetFactor!==void 0&&(E.polygonOffsetFactor=r.polygonOffsetFactor),r.polygonOffsetUnits!==void 0&&(E.polygonOffsetUnits=r.polygonOffsetUnits),r.dithering!==void 0&&(E.dithering=r.dithering),r.alphaToCoverage!==void 0&&(E.alphaToCoverage=r.alphaToCoverage),r.premultipliedAlpha!==void 0&&(E.premultipliedAlpha=r.premultipliedAlpha),r.forceSinglePass!==void 0&&(E.forceSinglePass=r.forceSinglePass),r.visible!==void 0&&(E.visible=r.visible),r.toneMapped!==void 0&&(E.toneMapped=r.toneMapped),r.userData!==void 0&&(E.userData=r.userData),r.vertexColors!==void 0&&(typeof r.vertexColors=="number"?E.vertexColors=r.vertexColors>0:E.vertexColors=r.vertexColors),r.uniforms!==void 0)for(const P in r.uniforms){const k=r.uniforms[P];switch(E.uniforms[P]={},k.type){case"t":E.uniforms[P].value=_(k.value);break;case"c":E.uniforms[P].value=new Fi().setHex(k.value,A);break;case"v2":E.uniforms[P].value=new li().fromArray(k.value);break;case"v3":E.uniforms[P].value=new zt().fromArray(k.value);break;case"v4":E.uniforms[P].value=new Vr().fromArray(k.value);break;case"m3":E.uniforms[P].value=new Ji().fromArray(k.value);break;case"m4":E.uniforms[P].value=new Gr().fromArray(k.value);break;default:E.uniforms[P].value=k.value}}if(r.defines!==void 0&&(E.defines=r.defines),r.vertexShader!==void 0&&(E.vertexShader=r.vertexShader),r.fragmentShader!==void 0&&(E.fragmentShader=r.fragmentShader),r.glslVersion!==void 0&&(E.glslVersion=r.glslVersion),r.extensions!==void 0)for(const P in r.extensions)E.extensions[P]=r.extensions[P];if(r.lights!==void 0&&(E.lights=r.lights),r.clipping!==void 0&&(E.clipping=r.clipping),r.size!==void 0&&(E.size=r.size),r.sizeAttenuation!==void 0&&(E.sizeAttenuation=r.sizeAttenuation),r.map!==void 0&&(E.map=_(r.map)),r.matcap!==void 0&&(E.matcap=_(r.matcap)),r.alphaMap!==void 0&&(E.alphaMap=_(r.alphaMap)),r.bumpMap!==void 0&&(E.bumpMap=_(r.bumpMap)),r.bumpScale!==void 0&&(E.bumpScale=r.bumpScale),r.normalMap!==void 0&&(E.normalMap=_(r.normalMap)),r.normalMapType!==void 0&&(E.normalMapType=r.normalMapType),r.normalScale!==void 0){let P=r.normalScale;Array.isArray(P)===!1&&(P=[P,P]),E.normalScale=new li().fromArray(P)}return r.displacementMap!==void 0&&(E.displacementMap=_(r.displacementMap)),r.displacementScale!==void 0&&(E.displacementScale=r.displacementScale),r.displacementBias!==void 0&&(E.displacementBias=r.displacementBias),r.roughnessMap!==void 0&&(E.roughnessMap=_(r.roughnessMap)),r.metalnessMap!==void 0&&(E.metalnessMap=_(r.metalnessMap)),r.emissiveMap!==void 0&&(E.emissiveMap=_(r.emissiveMap)),r.emissiveIntensity!==void 0&&(E.emissiveIntensity=r.emissiveIntensity),r.specularMap!==void 0&&(E.specularMap=_(r.specularMap)),r.specularIntensityMap!==void 0&&(E.specularIntensityMap=_(r.specularIntensityMap)),r.specularColorMap!==void 0&&(E.specularColorMap=_(r.specularColorMap)),r.envMap!==void 0&&(E.envMap=_(r.envMap)),r.envMapIntensity!==void 0&&(E.envMapIntensity=r.envMapIntensity),r.reflectivity!==void 0&&(E.reflectivity=r.reflectivity),r.refractionRatio!==void 0&&(E.refractionRatio=r.refractionRatio),r.lightMap!==void 0&&(E.lightMap=_(r.lightMap)),r.lightMapIntensity!==void 0&&(E.lightMapIntensity=r.lightMapIntensity),r.aoMap!==void 0&&(E.aoMap=_(r.aoMap)),r.aoMapIntensity!==void 0&&(E.aoMapIntensity=r.aoMapIntensity),r.gradientMap!==void 0&&(E.gradientMap=_(r.gradientMap)),r.clearcoatMap!==void 0&&(E.clearcoatMap=_(r.clearcoatMap)),r.clearcoatRoughnessMap!==void 0&&(E.clearcoatRoughnessMap=_(r.clearcoatRoughnessMap)),r.clearcoatNormalMap!==void 0&&(E.clearcoatNormalMap=_(r.clearcoatNormalMap)),r.clearcoatNormalScale!==void 0&&(E.clearcoatNormalScale=new li().fromArray(r.clearcoatNormalScale)),r.iridescenceMap!==void 0&&(E.iridescenceMap=_(r.iridescenceMap)),r.iridescenceThicknessMap!==void 0&&(E.iridescenceThicknessMap=_(r.iridescenceThicknessMap)),r.transmissionMap!==void 0&&(E.transmissionMap=_(r.transmissionMap)),r.thicknessMap!==void 0&&(E.thicknessMap=_(r.thicknessMap)),r.sheenColorMap!==void 0&&(E.sheenColorMap=_(r.sheenColorMap)),r.sheenRoughnessMap!==void 0&&(E.sheenRoughnessMap=_(r.sheenRoughnessMap)),E}setTextures(r){return this.textures=r,this}static createMaterialFromType(r){return new{ShadowMaterial:Nm,SpriteMaterial:Cv,RawShaderMaterial:If,ShaderMaterial:Su,PointsMaterial:e_,MeshPhysicalMaterial:Jl,MeshStandardMaterial:To,MeshPhongMaterial:Jo,MeshToonMaterial:ks,MeshNormalMaterial:km,MeshLambertMaterial:Pp,MeshDepthMaterial:U0,MeshDistanceMaterial:xv,MeshBasicMaterial:Ia,MeshMatcapMaterial:_A,LineDashedMaterial:q0,LineBasicMaterial:gl,Material:da}[r]}}class qv{static decodeText(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let d="";for(let _=0,A=r.length;_<A;_++)d+=String.fromCharCode(r[_]);try{return decodeURIComponent(escape(d))}catch{return d}}static extractUrlBase(r){const d=r.lastIndexOf("/");return d===-1?"./":r.slice(0,d+1)}static resolveURL(r,d){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(d)&&/^\//.test(r)&&(d=d.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:d+r)}}class zs extends Fe{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(r){return super.copy(r),this.instanceCount=r.instanceCount,this}toJSON(){const r=super.toJSON();return r.instanceCount=this.instanceCount,r.isInstancedBufferGeometry=!0,r}}class Gm extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=new Dc(E.manager);P.setPath(E.path),P.setRequestHeader(E.requestHeader),P.setWithCredentials(E.withCredentials),P.load(r,function(k){try{d(E.parse(JSON.parse(k)))}catch(Q){A?A(Q):console.error(Q),E.manager.itemError(r)}},_,A)}parse(r){const d={},_={};function A(xe,ye){if(d[ye]!==void 0)return d[ye];const Ee=xe.interleavedBuffers[ye],Ie=function(ke,Ge){if(_[Ge]!==void 0)return _[Ge];const Je=ke.arrayBuffers[Ge],Rt=new Uint32Array(Je).buffer;return _[Ge]=Rt,Rt}(xe,Ee.buffer),Ue=ol(Ee.type,Ie),Oe=new Ap(Ue,Ee.stride);return Oe.uuid=Ee.uuid,d[ye]=Oe,Oe}const E=r.isInstancedBufferGeometry?new zs:new Fe,P=r.data.index;if(P!==void 0){const xe=ol(P.type,P.array);E.setIndex(new Ns(xe,1))}const k=r.data.attributes;for(const xe in k){const ye=k[xe];let Ee;if(ye.isInterleavedBufferAttribute){const Ie=A(r.data,ye.data);Ee=new Nl(Ie,ye.itemSize,ye.offset,ye.normalized)}else{const Ie=ol(ye.type,ye.array);Ee=new(ye.isInstancedBufferAttribute?Fs:Ns)(Ie,ye.itemSize,ye.normalized)}ye.name!==void 0&&(Ee.name=ye.name),ye.usage!==void 0&&Ee.setUsage(ye.usage),ye.updateRange!==void 0&&(Ee.updateRange.offset=ye.updateRange.offset,Ee.updateRange.count=ye.updateRange.count),E.setAttribute(xe,Ee)}const Q=r.data.morphAttributes;if(Q)for(const xe in Q){const ye=Q[xe],Ee=[];for(let Ie=0,Ue=ye.length;Ie<Ue;Ie++){const Oe=ye[Ie];let ke;if(Oe.isInterleavedBufferAttribute){const Ge=A(r.data,Oe.data);ke=new Nl(Ge,Oe.itemSize,Oe.offset,Oe.normalized)}else{const Ge=ol(Oe.type,Oe.array);ke=new Ns(Ge,Oe.itemSize,Oe.normalized)}Oe.name!==void 0&&(ke.name=Oe.name),Ee.push(ke)}E.morphAttributes[xe]=Ee}r.data.morphTargetsRelative&&(E.morphTargetsRelative=!0);const G=r.data.groups||r.data.drawcalls||r.data.offsets;if(G!==void 0)for(let xe=0,ye=G.length;xe!==ye;++xe){const Ee=G[xe];E.addGroup(Ee.start,Ee.count,Ee.materialIndex)}const re=r.data.boundingSphere;if(re!==void 0){const xe=new zt;re.center!==void 0&&xe.fromArray(re.center),E.boundingSphere=new la(xe,re.radius)}return r.name&&(E.name=r.name),r.userData&&(E.userData=r.userData),E}}class Al extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=this.path===""?qv.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||P;const k=new Dc(this.manager);k.setPath(this.path),k.setRequestHeader(this.requestHeader),k.setWithCredentials(this.withCredentials),k.load(r,function(Q){let G=null;try{G=JSON.parse(Q)}catch(xe){return A!==void 0&&A(xe),void console.error("THREE:ObjectLoader: Can't parse "+r+".",xe.message)}const re=G.metadata;if(re===void 0||re.type===void 0||re.type.toLowerCase()==="geometry")return A!==void 0&&A(new Error("THREE.ObjectLoader: Can't load "+r)),void console.error("THREE.ObjectLoader: Can't load "+r);E.parse(G,d)},_,A)}async loadAsync(r,d){const _=this.path===""?qv.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||_;const A=new Dc(this.manager);A.setPath(this.path),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials);const E=await A.loadAsync(r,d),P=JSON.parse(E),k=P.metadata;if(k===void 0||k.type===void 0||k.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+r);return await this.parseAsync(P)}parse(r,d){const _=this.parseAnimations(r.animations),A=this.parseShapes(r.shapes),E=this.parseGeometries(r.geometries,A),P=this.parseImages(r.images,function(){d!==void 0&&d(G)}),k=this.parseTextures(r.textures,P),Q=this.parseMaterials(r.materials,k),G=this.parseObject(r.object,E,Q,k,_),re=this.parseSkeletons(r.skeletons,G);if(this.bindSkeletons(G,re),d!==void 0){let xe=!1;for(const ye in P)if(P[ye].data instanceof HTMLImageElement){xe=!0;break}xe===!1&&d(G)}return G}async parseAsync(r){const d=this.parseAnimations(r.animations),_=this.parseShapes(r.shapes),A=this.parseGeometries(r.geometries,_),E=await this.parseImagesAsync(r.images),P=this.parseTextures(r.textures,E),k=this.parseMaterials(r.materials,P),Q=this.parseObject(r.object,A,k,P,d),G=this.parseSkeletons(r.skeletons,Q);return this.bindSkeletons(Q,G),Q}parseShapes(r){const d={};if(r!==void 0)for(let _=0,A=r.length;_<A;_++){const E=new Wh().fromJSON(r[_]);d[E.uuid]=E}return d}parseSkeletons(r,d){const _={},A={};if(d.traverse(function(E){E.isBone&&(A[E.uuid]=E)}),r!==void 0)for(let E=0,P=r.length;E<P;E++){const k=new Cd().fromJSON(r[E],A);_[k.uuid]=k}return _}parseGeometries(r,d){const _={};if(r!==void 0){const A=new Gm;for(let E=0,P=r.length;E<P;E++){let k;const Q=r[E];switch(Q.type){case"BufferGeometry":case"InstancedBufferGeometry":k=A.parse(Q);break;default:Q.type in Ip?k=Ip[Q.type].fromJSON(Q,d):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${Q.type}"`)}k.uuid=Q.uuid,Q.name!==void 0&&(k.name=Q.name),Q.userData!==void 0&&(k.userData=Q.userData),_[Q.uuid]=k}}return _}parseMaterials(r,d){const _={},A={};if(r!==void 0){const E=new Op;E.setTextures(d);for(let P=0,k=r.length;P<k;P++){const Q=r[P];_[Q.uuid]===void 0&&(_[Q.uuid]=E.parse(Q)),A[Q.uuid]=_[Q.uuid]}}return A}parseAnimations(r){const d={};if(r!==void 0)for(let _=0;_<r.length;_++){const A=r[_],E=ec.parse(A);d[E.uuid]=E}return d}parseImages(r,d){const _=this,A={};let E;function P(k){if(typeof k=="string"){const Q=k;return function(G){return _.manager.itemStart(G),E.load(G,function(){_.manager.itemEnd(G)},void 0,function(){_.manager.itemError(G),_.manager.itemEnd(G)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Q)?Q:_.resourcePath+Q)}return k.data?{data:ol(k.type,k.data),width:k.width,height:k.height,complete:!0}:null}if(r!==void 0&&r.length>0){const k=new yl(d);E=new Fm(k),E.setCrossOrigin(this.crossOrigin);for(let Q=0,G=r.length;Q<G;Q++){const re=r[Q],xe=re.url;if(Array.isArray(xe)){const ye=[];for(let Ee=0,Ie=xe.length;Ee<Ie;Ee++){const Ue=P(xe[Ee]);Ue!==null&&(Ue instanceof HTMLImageElement?ye.push(Ue):ye.push(new Ep(Ue.data,Ue.width,Ue.height)))}A[re.uuid]=new mu(ye)}else{const ye=P(re.url);A[re.uuid]=new mu(ye)}}}return A}async parseImagesAsync(r){const d=this,_={};let A;async function E(P){if(typeof P=="string"){const k=P,Q=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k)?k:d.resourcePath+k;return await A.loadAsync(Q)}return P.data?{data:ol(P.type,P.data),width:P.width,height:P.height,complete:!0}:null}if(r!==void 0&&r.length>0){A=new Fm(this.manager),A.setCrossOrigin(this.crossOrigin);for(let P=0,k=r.length;P<k;P++){const Q=r[P],G=Q.url;if(Array.isArray(G)){const re=[];for(let xe=0,ye=G.length;xe<ye;xe++){const Ee=G[xe],Ie=await E(Ee);Ie!==null&&(Ie instanceof HTMLImageElement?re.push(Ie):re.push(new Ep(Ie.data,Ie.width,Ie.height)))}_[Q.uuid]=new mu(re)}else{const re=await E(Q.url);_[Q.uuid]=new mu(re)}}}return _}parseTextures(r,d){function _(E,P){return typeof E=="number"?E:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",E),P[E])}const A={};if(r!==void 0)for(let E=0,P=r.length;E<P;E++){const k=r[E];k.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',k.uuid),d[k.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",k.image);const Q=d[k.image],G=Q?Q.data:void 0;let re;Array.isArray(G)?(re=new xd,G.length===6&&(re.needsUpdate=!0)):(re=G&&G.data?new Ep:new Us,G&&G.complete&&(re.needsUpdate=!0)),re.source=Q,re.uuid=k.uuid,k.name!==void 0&&(re.name=k.name),k.mapping!==void 0&&(re.mapping=_(k.mapping,bA)),k.channel!==void 0&&(re.channel=k.channel),k.offset!==void 0&&re.offset.fromArray(k.offset),k.repeat!==void 0&&re.repeat.fromArray(k.repeat),k.center!==void 0&&re.center.fromArray(k.center),k.rotation!==void 0&&(re.rotation=k.rotation),k.wrap!==void 0&&(re.wrapS=_(k.wrap[0],m_),re.wrapT=_(k.wrap[1],m_)),k.format!==void 0&&(re.format=k.format),k.internalFormat!==void 0&&(re.internalFormat=k.internalFormat),k.type!==void 0&&(re.type=k.type),k.colorSpace!==void 0?re.colorSpace=k.colorSpace:k.encoding!==void 0&&(re.encoding=k.encoding),k.minFilter!==void 0&&(re.minFilter=_(k.minFilter,ou)),k.magFilter!==void 0&&(re.magFilter=_(k.magFilter,ou)),k.anisotropy!==void 0&&(re.anisotropy=k.anisotropy),k.flipY!==void 0&&(re.flipY=k.flipY),k.generateMipmaps!==void 0&&(re.generateMipmaps=k.generateMipmaps),k.premultiplyAlpha!==void 0&&(re.premultiplyAlpha=k.premultiplyAlpha),k.unpackAlignment!==void 0&&(re.unpackAlignment=k.unpackAlignment),k.userData!==void 0&&(re.userData=k.userData),A[k.uuid]=re}return A}parseObject(r,d,_,A,E){let P;const k=r.metadata&&r.metadata.version<=4.5?Is:void 0;function Q(Ee){return d[Ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Ee),d[Ee]}function G(Ee){if(Ee!==void 0){if(Array.isArray(Ee)){const Ie=[];for(let Ue=0,Oe=Ee.length;Ue<Oe;Ue++){const ke=Ee[Ue];_[ke]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ke),Ie.push(_[ke])}return Ie}return _[Ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ee),_[Ee]}}function re(Ee){return A[Ee]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Ee),A[Ee]}let xe,ye;switch(r.type){case"Scene":P=new gm,r.background!==void 0&&(Number.isInteger(r.background)?P.background=new Fi().setHex(r.background,k):P.background=re(r.background)),r.environment!==void 0&&(P.environment=re(r.environment)),r.fog!==void 0&&(r.fog.type==="Fog"?P.fog=new qg(r.fog.color,r.fog.near,r.fog.far):r.fog.type==="FogExp2"&&(P.fog=new Qg(r.fog.color,r.fog.density))),r.backgroundBlurriness!==void 0&&(P.backgroundBlurriness=r.backgroundBlurriness),r.backgroundIntensity!==void 0&&(P.backgroundIntensity=r.backgroundIntensity);break;case"PerspectiveCamera":P=new Eo(r.fov,r.aspect,r.near,r.far),r.focus!==void 0&&(P.focus=r.focus),r.zoom!==void 0&&(P.zoom=r.zoom),r.filmGauge!==void 0&&(P.filmGauge=r.filmGauge),r.filmOffset!==void 0&&(P.filmOffset=r.filmOffset),r.view!==void 0&&(P.view=Object.assign({},r.view));break;case"OrthographicCamera":P=new So(r.left,r.right,r.top,r.bottom,r.near,r.far),r.zoom!==void 0&&(P.zoom=r.zoom),r.view!==void 0&&(P.view=Object.assign({},r.view));break;case"AmbientLight":P=new su(r.color,r.intensity);break;case"DirectionalLight":P=new Oc(r.color,r.intensity);break;case"PointLight":P=new Nu(r.color,r.intensity,r.distance,r.decay);break;case"RectAreaLight":P=new zl(r.color,r.intensity,r.width,r.height);break;case"SpotLight":P=new yA(r.color,r.intensity,r.distance,r.angle,r.penumbra,r.decay);break;case"HemisphereLight":P=new X0(r.color,r.groundColor,r.intensity);break;case"LightProbe":P=new Zo().fromJSON(r);break;case"SkinnedMesh":xe=Q(r.geometry),ye=G(r.material),P=new pA(xe,ye),r.bindMode!==void 0&&(P.bindMode=r.bindMode),r.bindMatrix!==void 0&&P.bindMatrix.fromArray(r.bindMatrix),r.skeleton!==void 0&&(P.skeleton=r.skeleton);break;case"Mesh":xe=Q(r.geometry),ye=G(r.material),P=new Ko(xe,ye);break;case"InstancedMesh":xe=Q(r.geometry),ye=G(r.material);const Ee=r.count,Ie=r.instanceMatrix,Ue=r.instanceColor;P=new Kg(xe,ye,Ee),P.instanceMatrix=new Fs(new Float32Array(Ie.array),16),Ue!==void 0&&(P.instanceColor=new Fs(new Float32Array(Ue.array),Ue.itemSize));break;case"LOD":P=new wp;break;case"Line":P=new Vh(Q(r.geometry),G(r.material));break;case"LineLoop":P=new G0(Q(r.geometry),G(r.material));break;case"LineSegments":P=new Ja(Q(r.geometry),G(r.material));break;case"PointCloud":case"Points":P=new Rv(Q(r.geometry),G(r.material));break;case"Sprite":P=new mf(G(r.material));break;case"Group":P=new Tc;break;case"Bone":P=new zh;break;default:P=new bs}if(P.uuid=r.uuid,r.name!==void 0&&(P.name=r.name),r.matrix!==void 0?(P.matrix.fromArray(r.matrix),r.matrixAutoUpdate!==void 0&&(P.matrixAutoUpdate=r.matrixAutoUpdate),P.matrixAutoUpdate&&P.matrix.decompose(P.position,P.quaternion,P.scale)):(r.position!==void 0&&P.position.fromArray(r.position),r.rotation!==void 0&&P.rotation.fromArray(r.rotation),r.quaternion!==void 0&&P.quaternion.fromArray(r.quaternion),r.scale!==void 0&&P.scale.fromArray(r.scale)),r.up!==void 0&&P.up.fromArray(r.up),r.castShadow!==void 0&&(P.castShadow=r.castShadow),r.receiveShadow!==void 0&&(P.receiveShadow=r.receiveShadow),r.shadow&&(r.shadow.bias!==void 0&&(P.shadow.bias=r.shadow.bias),r.shadow.normalBias!==void 0&&(P.shadow.normalBias=r.shadow.normalBias),r.shadow.radius!==void 0&&(P.shadow.radius=r.shadow.radius),r.shadow.mapSize!==void 0&&P.shadow.mapSize.fromArray(r.shadow.mapSize),r.shadow.camera!==void 0&&(P.shadow.camera=this.parseObject(r.shadow.camera))),r.visible!==void 0&&(P.visible=r.visible),r.frustumCulled!==void 0&&(P.frustumCulled=r.frustumCulled),r.renderOrder!==void 0&&(P.renderOrder=r.renderOrder),r.userData!==void 0&&(P.userData=r.userData),r.layers!==void 0&&(P.layers.mask=r.layers),r.children!==void 0){const Ee=r.children;for(let Ie=0;Ie<Ee.length;Ie++)P.add(this.parseObject(Ee[Ie],d,_,A,E))}if(r.animations!==void 0){const Ee=r.animations;for(let Ie=0;Ie<Ee.length;Ie++){const Ue=Ee[Ie];P.animations.push(E[Ue])}}if(r.type==="LOD"){r.autoUpdate!==void 0&&(P.autoUpdate=r.autoUpdate);const Ee=r.levels;for(let Ie=0;Ie<Ee.length;Ie++){const Ue=Ee[Ie],Oe=P.getObjectByProperty("uuid",Ue.object);Oe!==void 0&&P.addLevel(Oe,Ue.distance,Ue.hysteresis)}}return P}bindSkeletons(r,d){Object.keys(d).length!==0&&r.traverse(function(_){if(_.isSkinnedMesh===!0&&_.skeleton!==void 0){const A=d[_.skeleton];A===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",_.skeleton):_.bind(A,_.bindMatrix)}})}}const bA={UVMapping:Fn,CubeReflectionMapping:Hn,CubeRefractionMapping:fe,EquirectangularReflectionMapping:Se,EquirectangularRefractionMapping:Ve,CubeUVReflectionMapping:We},m_={RepeatWrapping:pt,ClampToEdgeWrapping:It,MirroredRepeatWrapping:$t},ou={NearestFilter:nn,NearestMipmapNearestFilter:Ht,NearestMipmapLinearFilter:Ln,LinearFilter:Nn,LinearMipmapNearestFilter:Zn,LinearMipmapLinearFilter:Mr};class Bc extends tc{constructor(r){super(r),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(r){return this.options=r,this}load(r,d,_,A){r===void 0&&(r=""),this.path!==void 0&&(r=this.path+r),r=this.manager.resolveURL(r);const E=this;Jh.get(r,"blob").then(P=>{if(P!==void 0)return E.manager.itemStart(r),void createImageBitmap(P,Object.assign(E.options,{colorSpaceConversion:"none"})).then(function(Q){d&&d(Q),E.manager.itemEnd(r)}).catch(function(Q){A&&A(Q),E.manager.itemError(r),E.manager.itemEnd(r)});const k={};k.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",k.headers=this.requestHeader,fetch(r,k).then(function(Q){return Q.blob()}).then(function(Q){return Jh.add(r,Q,"blob"),createImageBitmap(Q,Object.assign(E.options,{colorSpaceConversion:"none"}))}).then(function(Q){d&&d(Q),E.manager.itemEnd(r)}).catch(function(Q){A&&A(Q),E.manager.itemError(r),E.manager.itemEnd(r)}),E.manager.itemStart(r)})}}let Hm;class Xv{static getContext(){return Hm===void 0&&(Hm=new(window.AudioContext||window.webkitAudioContext)),Hm}static setContext(r){Hm=r}}class K0 extends tc{constructor(r){super(r)}load(r,d,_,A){const E=this,P=new Dc(this.manager);function k(Q){A?A(Q):console.error(Q),E.manager.itemError(r)}P.setResponseType("arraybuffer"),P.setPath(this.path),P.setRequestHeader(this.requestHeader),P.setWithCredentials(this.withCredentials),P.load(r,function(Q){try{const G=Q.slice(0);Xv.getContext().decodeAudioData(G,function(re){d(re)},k)}catch(G){k(G)}},_,A)}}class Yv extends Zo{constructor(r,d,_=1){super(void 0,_),this.isHemisphereLightProbe=!0;const A=new Fi().set(r),E=new Fi().set(d),P=new zt(A.r,A.g,A.b),k=new zt(E.r,E.g,E.b),Q=Math.sqrt(Math.PI),G=Q*Math.sqrt(.75);this.sh.coefficients[0].copy(P).add(k).multiplyScalar(Q),this.sh.coefficients[1].copy(P).sub(k).multiplyScalar(G)}}class Kv extends Zo{constructor(r,d=1){super(void 0,d),this.isAmbientLightProbe=!0;const _=new Fi().set(r);this.sh.coefficients[0].set(_.r,_.g,_.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const $v=new Gr,ah=new Gr,Bp=new Gr;class $0{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Eo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Eo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(r){const d=this._cache;if(d.focus!==r.focus||d.fov!==r.fov||d.aspect!==r.aspect*this.aspect||d.near!==r.near||d.far!==r.far||d.zoom!==r.zoom||d.eyeSep!==this.eyeSep){d.focus=r.focus,d.fov=r.fov,d.aspect=r.aspect*this.aspect,d.near=r.near,d.far=r.far,d.zoom=r.zoom,d.eyeSep=this.eyeSep,Bp.copy(r.projectionMatrix);const _=d.eyeSep/2,A=_*d.near/d.focus,E=d.near*Math.tan(ei*d.fov*.5)/d.zoom;let P,k;ah.elements[12]=-_,$v.elements[12]=_,P=-E*d.aspect+A,k=E*d.aspect+A,Bp.elements[0]=2*d.near/(k-P),Bp.elements[8]=(k+P)/(k-P),this.cameraL.projectionMatrix.copy(Bp),P=-E*d.aspect-A,k=E*d.aspect-A,Bp.elements[0]=2*d.near/(k-P),Bp.elements[8]=(k+P)/(k-P),this.cameraR.projectionMatrix.copy(Bp)}this.cameraL.matrixWorld.copy(r.matrixWorld).multiply(ah),this.cameraR.matrixWorld.copy(r.matrixWorld).multiply($v)}}class g_{constructor(r=!0){this.autoStart=r,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=__(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const d=__();r=(d-this.oldTime)/1e3,this.oldTime=d,this.elapsedTime+=r}return r}}function __(){return(typeof performance>"u"?Date:performance).now()}const nc=new zt,xA=new Pl,Ib=new zt,ku=new zt;class wA extends bs{constructor(){super(),this.type="AudioListener",this.context=Xv.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new g_}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(r){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=r,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}updateMatrixWorld(r){super.updateMatrixWorld(r);const d=this.context.listener,_=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(nc,xA,Ib),ku.set(0,0,-1).applyQuaternion(xA),d.positionX){const A=this.context.currentTime+this.timeDelta;d.positionX.linearRampToValueAtTime(nc.x,A),d.positionY.linearRampToValueAtTime(nc.y,A),d.positionZ.linearRampToValueAtTime(nc.z,A),d.forwardX.linearRampToValueAtTime(ku.x,A),d.forwardY.linearRampToValueAtTime(ku.y,A),d.forwardZ.linearRampToValueAtTime(ku.z,A),d.upX.linearRampToValueAtTime(_.x,A),d.upY.linearRampToValueAtTime(_.y,A),d.upZ.linearRampToValueAtTime(_.z,A)}else d.setPosition(nc.x,nc.y,nc.z),d.setOrientation(ku.x,ku.y,ku.z,_.x,_.y,_.z)}}class Df extends bs{constructor(r){super(),this.type="Audio",this.listener=r,this.context=r.context,this.gain=this.context.createGain(),this.gain.connect(r.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(r){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=r,this.connect(),this}setMediaElementSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(r),this.connect(),this}setMediaStreamSource(r){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(r),this.connect(),this}setBuffer(r){return this.buffer=r,this.sourceType="buffer",this.autoplay&&this.play(),this}play(r=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+r;const d=this.context.createBufferSource();return d.buffer=this.buffer,d.loop=this.loop,d.loopStart=this.loopStart,d.loopEnd=this.loopEnd,d.onended=this.onEnded.bind(this),d.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=d,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let r=1,d=this.filters.length;r<d;r++)this.filters[r-1].connect(this.filters[r]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let r=1,d=this.filters.length;r<d;r++)this.filters[r-1].disconnect(this.filters[r]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(r){return r||(r=[]),this._connected===!0?(this.disconnect(),this.filters=r.slice(),this.connect()):this.filters=r.slice(),this}setDetune(r){if(this.detune=r,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(r){return this.setFilters(r?[r]:[])}setPlaybackRate(r){if(this.hasPlaybackControl!==!1)return this.playbackRate=r,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(r){if(this.hasPlaybackControl!==!1)return this.loop=r,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(r){return this.loopStart=r,this}setLoopEnd(r){return this.loopEnd=r,this}getVolume(){return this.gain.gain.value}setVolume(r){return this.gain.gain.setTargetAtTime(r,this.context.currentTime,.01),this}}const Of=new zt,kd=new Pl,v_=new zt,io=new zt;class Pb extends Df{constructor(r){super(r),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(r){return this.panner.refDistance=r,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(r){return this.panner.rolloffFactor=r,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(r){return this.panner.distanceModel=r,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(r){return this.panner.maxDistance=r,this}setDirectionalCone(r,d,_){return this.panner.coneInnerAngle=r,this.panner.coneOuterAngle=d,this.panner.coneOuterGain=_,this}updateMatrixWorld(r){if(super.updateMatrixWorld(r),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Of,kd,v_),io.set(0,0,1).applyQuaternion(kd);const d=this.panner;if(d.positionX){const _=this.context.currentTime+this.listener.timeDelta;d.positionX.linearRampToValueAtTime(Of.x,_),d.positionY.linearRampToValueAtTime(Of.y,_),d.positionZ.linearRampToValueAtTime(Of.z,_),d.orientationX.linearRampToValueAtTime(io.x,_),d.orientationY.linearRampToValueAtTime(io.y,_),d.orientationZ.linearRampToValueAtTime(io.z,_)}else d.setPosition(Of.x,Of.y,Of.z),d.setOrientation(io.x,io.y,io.z)}}class Bf{constructor(r,d=2048){this.analyser=r.context.createAnalyser(),this.analyser.fftSize=d,this.data=new Uint8Array(this.analyser.frequencyBinCount),r.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let r=0;const d=this.getFrequencyData();for(let _=0;_<d.length;_++)r+=d[_];return r/d.length}}class y_{constructor(r,d,_){let A,E,P;switch(this.binding=r,this.valueSize=_,d){case"quaternion":A=this._slerp,E=this._slerpAdditive,P=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*_),this._workIndex=5;break;case"string":case"bool":A=this._select,E=this._select,P=this._setAdditiveIdentityOther,this.buffer=new Array(5*_);break;default:A=this._lerp,E=this._lerpAdditive,P=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*_)}this._mixBufferRegion=A,this._mixBufferRegionAdditive=E,this._setIdentity=P,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(r,d){const _=this.buffer,A=this.valueSize,E=r*A+A;let P=this.cumulativeWeight;if(P===0){for(let k=0;k!==A;++k)_[E+k]=_[k];P=d}else{P+=d;const k=d/P;this._mixBufferRegion(_,E,0,k,A)}this.cumulativeWeight=P}accumulateAdditive(r){const d=this.buffer,_=this.valueSize,A=_*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(d,A,0,r,_),this.cumulativeWeightAdditive+=r}apply(r){const d=this.valueSize,_=this.buffer,A=r*d+d,E=this.cumulativeWeight,P=this.cumulativeWeightAdditive,k=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,E<1){const Q=d*this._origIndex;this._mixBufferRegion(_,A,Q,1-E,d)}P>0&&this._mixBufferRegionAdditive(_,A,this._addIndex*d,1,d);for(let Q=d,G=d+d;Q!==G;++Q)if(_[Q]!==_[Q+d]){k.setValue(_,A);break}}saveOriginalState(){const r=this.binding,d=this.buffer,_=this.valueSize,A=_*this._origIndex;r.getValue(d,A);for(let E=_,P=A;E!==P;++E)d[E]=d[A+E%_];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const r=3*this.valueSize;this.binding.setValue(this.buffer,r)}_setAdditiveIdentityNumeric(){const r=this._addIndex*this.valueSize,d=r+this.valueSize;for(let _=r;_<d;_++)this.buffer[_]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const r=this._origIndex*this.valueSize,d=this._addIndex*this.valueSize;for(let _=0;_<this.valueSize;_++)this.buffer[d+_]=this.buffer[r+_]}_select(r,d,_,A,E){if(A>=.5)for(let P=0;P!==E;++P)r[d+P]=r[_+P]}_slerp(r,d,_,A){Pl.slerpFlat(r,d,r,d,r,_,A)}_slerpAdditive(r,d,_,A,E){const P=this._workIndex*E;Pl.multiplyQuaternionsFlat(r,P,r,d,r,_),Pl.slerpFlat(r,d,r,d,r,P,A)}_lerp(r,d,_,A,E){const P=1-A;for(let k=0;k!==E;++k){const Q=d+k;r[Q]=r[Q]*P+r[_+k]*A}}_lerpAdditive(r,d,_,A,E){for(let P=0;P!==E;++P){const k=d+P;r[k]=r[k]+r[_+P]*A}}}const Lp="\\[\\]\\.:\\/",J0=new RegExp("["+Lp+"]","g"),A_="[^"+Lp+"]",Lf="[^"+Lp.replace("\\.","")+"]",Db=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",A_)+/(WCOD+)?/.source.replace("WCOD",Lf)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",A_)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",A_)+"$"),b_=["material","materials","bones","map"];class ms{constructor(r,d,_){this.path=d,this.parsedPath=_||ms.parseTrackName(d),this.node=ms.findNode(r,this.parsedPath.nodeName),this.rootNode=r,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(r,d,_){return r&&r.isAnimationObjectGroup?new ms.Composite(r,d,_):new ms(r,d,_)}static sanitizeNodeName(r){return r.replace(/\s/g,"_").replace(J0,"")}static parseTrackName(r){const d=Db.exec(r);if(d===null)throw new Error("PropertyBinding: Cannot parse trackName: "+r);const _={nodeName:d[2],objectName:d[3],objectIndex:d[4],propertyName:d[5],propertyIndex:d[6]},A=_.nodeName&&_.nodeName.lastIndexOf(".");if(A!==void 0&&A!==-1){const E=_.nodeName.substring(A+1);b_.indexOf(E)!==-1&&(_.nodeName=_.nodeName.substring(0,A),_.objectName=E)}if(_.propertyName===null||_.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+r);return _}static findNode(r,d){if(d===void 0||d===""||d==="."||d===-1||d===r.name||d===r.uuid)return r;if(r.skeleton){const _=r.skeleton.getBoneByName(d);if(_!==void 0)return _}if(r.children){const _=function(E){for(let P=0;P<E.length;P++){const k=E[P];if(k.name===d||k.uuid===d)return k;const Q=_(k.children);if(Q)return Q}return null},A=_(r.children);if(A)return A}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(r,d){r[d]=this.targetObject[this.propertyName]}_getValue_array(r,d){const _=this.resolvedProperty;for(let A=0,E=_.length;A!==E;++A)r[d++]=_[A]}_getValue_arrayElement(r,d){r[d]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(r,d){this.resolvedProperty.toArray(r,d)}_setValue_direct(r,d){this.targetObject[this.propertyName]=r[d]}_setValue_direct_setNeedsUpdate(r,d){this.targetObject[this.propertyName]=r[d],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(r,d){this.targetObject[this.propertyName]=r[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(r,d){const _=this.resolvedProperty;for(let A=0,E=_.length;A!==E;++A)_[A]=r[d++]}_setValue_array_setNeedsUpdate(r,d){const _=this.resolvedProperty;for(let A=0,E=_.length;A!==E;++A)_[A]=r[d++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(r,d){const _=this.resolvedProperty;for(let A=0,E=_.length;A!==E;++A)_[A]=r[d++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(r,d){this.resolvedProperty[this.propertyIndex]=r[d]}_setValue_arrayElement_setNeedsUpdate(r,d){this.resolvedProperty[this.propertyIndex]=r[d],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(r,d){this.resolvedProperty[this.propertyIndex]=r[d],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(r,d){this.resolvedProperty.fromArray(r,d)}_setValue_fromArray_setNeedsUpdate(r,d){this.resolvedProperty.fromArray(r,d),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(r,d){this.resolvedProperty.fromArray(r,d),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(r,d){this.bind(),this.getValue(r,d)}_setValue_unbound(r,d){this.bind(),this.setValue(r,d)}bind(){let r=this.node;const d=this.parsedPath,_=d.objectName,A=d.propertyName;let E=d.propertyIndex;if(r||(r=ms.findNode(this.rootNode,d.nodeName),this.node=r),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!r)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(_){let G=d.objectIndex;switch(_){case"materials":if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);r=r.material.materials;break;case"bones":if(!r.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);r=r.skeleton.bones;for(let re=0;re<r.length;re++)if(r[re].name===G){G=re;break}break;case"map":if("map"in r){r=r.map;break}if(!r.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!r.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);r=r.material.map;break;default:if(r[_]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);r=r[_]}if(G!==void 0){if(r[G]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,r);r=r[G]}}const P=r[A];if(P===void 0){const G=d.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+G+"."+A+" but it wasn't found.",r)}let k=this.Versioning.None;this.targetObject=r,r.needsUpdate!==void 0?k=this.Versioning.NeedsUpdate:r.matrixWorldNeedsUpdate!==void 0&&(k=this.Versioning.MatrixWorldNeedsUpdate);let Q=this.BindingType.Direct;if(E!==void 0){if(A==="morphTargetInfluences"){if(!r.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!r.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);r.morphTargetDictionary[E]!==void 0&&(E=r.morphTargetDictionary[E])}Q=this.BindingType.ArrayElement,this.resolvedProperty=P,this.propertyIndex=E}else P.fromArray!==void 0&&P.toArray!==void 0?(Q=this.BindingType.HasFromToArray,this.resolvedProperty=P):Array.isArray(P)?(Q=this.BindingType.EntireArray,this.resolvedProperty=P):this.propertyName=A;this.getValue=this.GetterByBindingType[Q],this.setValue=this.SetterByBindingTypeAndVersioning[Q][k]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ms.Composite=class{constructor(R,r,d){const _=d||ms.parseTrackName(r);this._targetGroup=R,this._bindings=R.subscribe_(r,_)}getValue(R,r){this.bind();const d=this._targetGroup.nCachedObjects_,_=this._bindings[d];_!==void 0&&_.getValue(R,r)}setValue(R,r){const d=this._bindings;for(let _=this._targetGroup.nCachedObjects_,A=d.length;_!==A;++_)d[_].setValue(R,r)}bind(){const R=this._bindings;for(let r=this._targetGroup.nCachedObjects_,d=R.length;r!==d;++r)R[r].bind()}unbind(){const R=this._bindings;for(let r=this._targetGroup.nCachedObjects_,d=R.length;r!==d;++r)R[r].unbind()}},ms.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ms.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ms.prototype.GetterByBindingType=[ms.prototype._getValue_direct,ms.prototype._getValue_array,ms.prototype._getValue_arrayElement,ms.prototype._getValue_toArray],ms.prototype.SetterByBindingTypeAndVersioning=[[ms.prototype._setValue_direct,ms.prototype._setValue_direct_setNeedsUpdate,ms.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_array,ms.prototype._setValue_array_setNeedsUpdate,ms.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_arrayElement,ms.prototype._setValue_arrayElement_setNeedsUpdate,ms.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_fromArray,ms.prototype._setValue_fromArray_setNeedsUpdate,ms.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Jv{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Cl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const r={};this._indicesByUUID=r;for(let _=0,A=arguments.length;_!==A;++_)r[arguments[_].uuid]=_;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}add(){const r=this._objects,d=this._indicesByUUID,_=this._paths,A=this._parsedPaths,E=this._bindings,P=E.length;let k,Q=r.length,G=this.nCachedObjects_;for(let re=0,xe=arguments.length;re!==xe;++re){const ye=arguments[re],Ee=ye.uuid;let Ie=d[Ee];if(Ie===void 0){Ie=Q++,d[Ee]=Ie,r.push(ye);for(let Ue=0,Oe=P;Ue!==Oe;++Ue)E[Ue].push(new ms(ye,_[Ue],A[Ue]))}else if(Ie<G){k=r[Ie];const Ue=--G,Oe=r[Ue];d[Oe.uuid]=Ie,r[Ie]=Oe,d[Ee]=Ue,r[Ue]=ye;for(let ke=0,Ge=P;ke!==Ge;++ke){const Je=E[ke],Rt=Je[Ue];let Et=Je[Ie];Je[Ie]=Rt,Et===void 0&&(Et=new ms(ye,_[ke],A[ke])),Je[Ue]=Et}}else r[Ie]!==k&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=G}remove(){const r=this._objects,d=this._indicesByUUID,_=this._bindings,A=_.length;let E=this.nCachedObjects_;for(let P=0,k=arguments.length;P!==k;++P){const Q=arguments[P],G=Q.uuid,re=d[G];if(re!==void 0&&re>=E){const xe=E++,ye=r[xe];d[ye.uuid]=re,r[re]=ye,d[G]=xe,r[xe]=Q;for(let Ee=0,Ie=A;Ee!==Ie;++Ee){const Ue=_[Ee],Oe=Ue[xe],ke=Ue[re];Ue[re]=Oe,Ue[xe]=ke}}}this.nCachedObjects_=E}uncache(){const r=this._objects,d=this._indicesByUUID,_=this._bindings,A=_.length;let E=this.nCachedObjects_,P=r.length;for(let k=0,Q=arguments.length;k!==Q;++k){const G=arguments[k].uuid,re=d[G];if(re!==void 0)if(delete d[G],re<E){const xe=--E,ye=r[xe],Ee=--P,Ie=r[Ee];d[ye.uuid]=re,r[re]=ye,d[Ie.uuid]=xe,r[xe]=Ie,r.pop();for(let Ue=0,Oe=A;Ue!==Oe;++Ue){const ke=_[Ue],Ge=ke[xe],Je=ke[Ee];ke[re]=Ge,ke[xe]=Je,ke.pop()}}else{const xe=--P,ye=r[xe];xe>0&&(d[ye.uuid]=re),r[re]=ye,r.pop();for(let Ee=0,Ie=A;Ee!==Ie;++Ee){const Ue=_[Ee];Ue[re]=Ue[xe],Ue.pop()}}}this.nCachedObjects_=E}subscribe_(r,d){const _=this._bindingsIndicesByPath;let A=_[r];const E=this._bindings;if(A!==void 0)return E[A];const P=this._paths,k=this._parsedPaths,Q=this._objects,G=Q.length,re=this.nCachedObjects_,xe=new Array(G);A=E.length,_[r]=A,P.push(r),k.push(d),E.push(xe);for(let ye=re,Ee=Q.length;ye!==Ee;++ye){const Ie=Q[ye];xe[ye]=new ms(Ie,r,d)}return xe}unsubscribe_(r){const d=this._bindingsIndicesByPath,_=d[r];if(_!==void 0){const A=this._paths,E=this._parsedPaths,P=this._bindings,k=P.length-1,Q=P[k];d[r[k]]=_,P[_]=Q,P.pop(),E[_]=E[k],E.pop(),A[_]=A[k],A.pop()}}}class Wm{constructor(r,d,_=null,A=d.blendMode){this._mixer=r,this._clip=d,this._localRoot=_,this.blendMode=A;const E=d.tracks,P=E.length,k=new Array(P),Q={endingStart:_s,endingEnd:_s};for(let G=0;G!==P;++G){const re=E[G].createInterpolant(null);k[G]=re,re.settings=Q}this._interpolantSettings=Q,this._interpolants=k,this._propertyBindings=new Array(P),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ki,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(r){return this._startTime=r,this}setLoop(r,d){return this.loop=r,this.repetitions=d,this}setEffectiveWeight(r){return this.weight=r,this._effectiveWeight=this.enabled?r:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(r){return this._scheduleFading(r,0,1)}fadeOut(r){return this._scheduleFading(r,1,0)}crossFadeFrom(r,d,_){if(r.fadeOut(d),this.fadeIn(d),_){const A=this._clip.duration,E=r._clip.duration,P=E/A,k=A/E;r.warp(1,P,d),this.warp(k,1,d)}return this}crossFadeTo(r,d,_){return r.crossFadeFrom(this,d,_)}stopFading(){const r=this._weightInterpolant;return r!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}setEffectiveTimeScale(r){return this.timeScale=r,this._effectiveTimeScale=this.paused?0:r,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(r){return this.timeScale=this._clip.duration/r,this.stopWarping()}syncWith(r){return this.time=r.time,this.timeScale=r.timeScale,this.stopWarping()}halt(r){return this.warp(this._effectiveTimeScale,0,r)}warp(r,d,_){const A=this._mixer,E=A.time,P=this.timeScale;let k=this._timeScaleInterpolant;k===null&&(k=A._lendControlInterpolant(),this._timeScaleInterpolant=k);const Q=k.parameterPositions,G=k.sampleValues;return Q[0]=E,Q[1]=E+_,G[0]=r/P,G[1]=d/P,this}stopWarping(){const r=this._timeScaleInterpolant;return r!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(r)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(r,d,_,A){if(!this.enabled)return void this._updateWeight(r);const E=this._startTime;if(E!==null){const Q=(r-E)*_;Q<0||_===0?d=0:(this._startTime=null,d=_*Q)}d*=this._updateTimeScale(r);const P=this._updateTime(d),k=this._updateWeight(r);if(k>0){const Q=this._interpolants,G=this._propertyBindings;if(this.blendMode===so)for(let re=0,xe=Q.length;re!==xe;++re)Q[re].evaluate(P),G[re].accumulateAdditive(k);else for(let re=0,xe=Q.length;re!==xe;++re)Q[re].evaluate(P),G[re].accumulate(A,k)}}_updateWeight(r){let d=0;if(this.enabled){d=this.weight;const _=this._weightInterpolant;if(_!==null){const A=_.evaluate(r)[0];d*=A,r>_.parameterPositions[1]&&(this.stopFading(),A===0&&(this.enabled=!1))}}return this._effectiveWeight=d,d}_updateTimeScale(r){let d=0;if(!this.paused){d=this.timeScale;const _=this._timeScaleInterpolant;_!==null&&(d*=_.evaluate(r)[0],r>_.parameterPositions[1]&&(this.stopWarping(),d===0?this.paused=!0:this.timeScale=d))}return this._effectiveTimeScale=d,d}_updateTime(r){const d=this._clip.duration,_=this.loop;let A=this.time+r,E=this._loopCount;const P=_===ni;if(r===0)return E===-1?A:P&&(1&E)==1?d-A:A;if(_===cr){E===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(A>=d)A=d;else{if(!(A<0)){this.time=A;break e}A=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=A,this._mixer.dispatchEvent({type:"finished",action:this,direction:r<0?-1:1})}}else{if(E===-1&&(r>=0?(E=0,this._setEndings(!0,this.repetitions===0,P)):this._setEndings(this.repetitions===0,!0,P)),A>=d||A<0){const k=Math.floor(A/d);A-=d*k,E+=Math.abs(k);const Q=this.repetitions-E;if(Q<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,A=r>0?d:0,this.time=A,this._mixer.dispatchEvent({type:"finished",action:this,direction:r>0?1:-1});else{if(Q===1){const G=r<0;this._setEndings(G,!G,P)}else this._setEndings(!1,!1,P);this._loopCount=E,this.time=A,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:k})}}else this.time=A;if(P&&(1&E)==1)return d-A}return A}_setEndings(r,d,_){const A=this._interpolantSettings;_?(A.endingStart=bo,A.endingEnd=bo):(A.endingStart=r?this.zeroSlopeAtStart?bo:_s:Ms,A.endingEnd=d?this.zeroSlopeAtEnd?bo:_s:Ms)}_scheduleFading(r,d,_){const A=this._mixer,E=A.time;let P=this._weightInterpolant;P===null&&(P=A._lendControlInterpolant(),this._weightInterpolant=P);const k=P.parameterPositions,Q=P.sampleValues;return k[0]=E,Q[0]=d,k[1]=E+r,Q[1]=_,this}}const Z0=new Float32Array(1);class ey extends sl{constructor(r){super(),this._root=r,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(r,d){const _=r._localRoot||this._root,A=r._clip.tracks,E=A.length,P=r._propertyBindings,k=r._interpolants,Q=_.uuid,G=this._bindingsByRootAndName;let re=G[Q];re===void 0&&(re={},G[Q]=re);for(let xe=0;xe!==E;++xe){const ye=A[xe],Ee=ye.name;let Ie=re[Ee];if(Ie!==void 0)++Ie.referenceCount,P[xe]=Ie;else{if(Ie=P[xe],Ie!==void 0){Ie._cacheIndex===null&&(++Ie.referenceCount,this._addInactiveBinding(Ie,Q,Ee));continue}const Ue=d&&d._propertyBindings[xe].binding.parsedPath;Ie=new y_(ms.create(_,Ee,Ue),ye.ValueTypeName,ye.getValueSize()),++Ie.referenceCount,this._addInactiveBinding(Ie,Q,Ee),P[xe]=Ie}k[xe].resultBuffer=Ie.buffer}}_activateAction(r){if(!this._isActiveAction(r)){if(r._cacheIndex===null){const _=(r._localRoot||this._root).uuid,A=r._clip.uuid,E=this._actionsByClip[A];this._bindAction(r,E&&E.knownActions[0]),this._addInactiveAction(r,A,_)}const d=r._propertyBindings;for(let _=0,A=d.length;_!==A;++_){const E=d[_];E.useCount++==0&&(this._lendBinding(E),E.saveOriginalState())}this._lendAction(r)}}_deactivateAction(r){if(this._isActiveAction(r)){const d=r._propertyBindings;for(let _=0,A=d.length;_!==A;++_){const E=d[_];--E.useCount==0&&(E.restoreOriginalState(),this._takeBackBinding(E))}this._takeBackAction(r)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const r=this;this.stats={actions:{get total(){return r._actions.length},get inUse(){return r._nActiveActions}},bindings:{get total(){return r._bindings.length},get inUse(){return r._nActiveBindings}},controlInterpolants:{get total(){return r._controlInterpolants.length},get inUse(){return r._nActiveControlInterpolants}}}}_isActiveAction(r){const d=r._cacheIndex;return d!==null&&d<this._nActiveActions}_addInactiveAction(r,d,_){const A=this._actions,E=this._actionsByClip;let P=E[d];if(P===void 0)P={knownActions:[r],actionByRoot:{}},r._byClipCacheIndex=0,E[d]=P;else{const k=P.knownActions;r._byClipCacheIndex=k.length,k.push(r)}r._cacheIndex=A.length,A.push(r),P.actionByRoot[_]=r}_removeInactiveAction(r){const d=this._actions,_=d[d.length-1],A=r._cacheIndex;_._cacheIndex=A,d[A]=_,d.pop(),r._cacheIndex=null;const E=r._clip.uuid,P=this._actionsByClip,k=P[E],Q=k.knownActions,G=Q[Q.length-1],re=r._byClipCacheIndex;G._byClipCacheIndex=re,Q[re]=G,Q.pop(),r._byClipCacheIndex=null,delete k.actionByRoot[(r._localRoot||this._root).uuid],Q.length===0&&delete P[E],this._removeInactiveBindingsForAction(r)}_removeInactiveBindingsForAction(r){const d=r._propertyBindings;for(let _=0,A=d.length;_!==A;++_){const E=d[_];--E.referenceCount==0&&this._removeInactiveBinding(E)}}_lendAction(r){const d=this._actions,_=r._cacheIndex,A=this._nActiveActions++,E=d[A];r._cacheIndex=A,d[A]=r,E._cacheIndex=_,d[_]=E}_takeBackAction(r){const d=this._actions,_=r._cacheIndex,A=--this._nActiveActions,E=d[A];r._cacheIndex=A,d[A]=r,E._cacheIndex=_,d[_]=E}_addInactiveBinding(r,d,_){const A=this._bindingsByRootAndName,E=this._bindings;let P=A[d];P===void 0&&(P={},A[d]=P),P[_]=r,r._cacheIndex=E.length,E.push(r)}_removeInactiveBinding(r){const d=this._bindings,_=r.binding,A=_.rootNode.uuid,E=_.path,P=this._bindingsByRootAndName,k=P[A],Q=d[d.length-1],G=r._cacheIndex;Q._cacheIndex=G,d[G]=Q,d.pop(),delete k[E],Object.keys(k).length===0&&delete P[A]}_lendBinding(r){const d=this._bindings,_=r._cacheIndex,A=this._nActiveBindings++,E=d[A];r._cacheIndex=A,d[A]=r,E._cacheIndex=_,d[_]=E}_takeBackBinding(r){const d=this._bindings,_=r._cacheIndex,A=--this._nActiveBindings,E=d[A];r._cacheIndex=A,d[A]=r,E._cacheIndex=_,d[_]=E}_lendControlInterpolant(){const r=this._controlInterpolants,d=this._nActiveControlInterpolants++;let _=r[d];return _===void 0&&(_=new Bd(new Float32Array(2),new Float32Array(2),1,Z0),_.__cacheIndex=d,r[d]=_),_}_takeBackControlInterpolant(r){const d=this._controlInterpolants,_=r.__cacheIndex,A=--this._nActiveControlInterpolants,E=d[A];r.__cacheIndex=A,d[A]=r,E.__cacheIndex=_,d[_]=E}clipAction(r,d,_){const A=d||this._root,E=A.uuid;let P=typeof r=="string"?ec.findByName(A,r):r;const k=P!==null?P.uuid:r,Q=this._actionsByClip[k];let G=null;if(_===void 0&&(_=P!==null?P.blendMode:Ks),Q!==void 0){const xe=Q.actionByRoot[E];if(xe!==void 0&&xe.blendMode===_)return xe;G=Q.knownActions[0],P===null&&(P=G._clip)}if(P===null)return null;const re=new Wm(this,P,d,_);return this._bindAction(re,G),this._addInactiveAction(re,k,E),re}existingAction(r,d){const _=d||this._root,A=_.uuid,E=typeof r=="string"?ec.findByName(_,r):r,P=E?E.uuid:r,k=this._actionsByClip[P];return k!==void 0&&k.actionByRoot[A]||null}stopAllAction(){const r=this._actions;for(let d=this._nActiveActions-1;d>=0;--d)r[d].stop();return this}update(r){r*=this.timeScale;const d=this._actions,_=this._nActiveActions,A=this.time+=r,E=Math.sign(r),P=this._accuIndex^=1;for(let G=0;G!==_;++G)d[G]._update(A,r,E,P);const k=this._bindings,Q=this._nActiveBindings;for(let G=0;G!==Q;++G)k[G].apply(P);return this}setTime(r){this.time=0;for(let d=0;d<this._actions.length;d++)this._actions[d].time=0;return this.update(r)}getRoot(){return this._root}uncacheClip(r){const d=this._actions,_=r.uuid,A=this._actionsByClip,E=A[_];if(E!==void 0){const P=E.knownActions;for(let k=0,Q=P.length;k!==Q;++k){const G=P[k];this._deactivateAction(G);const re=G._cacheIndex,xe=d[d.length-1];G._cacheIndex=null,G._byClipCacheIndex=null,xe._cacheIndex=re,d[re]=xe,d.pop(),this._removeInactiveBindingsForAction(G)}delete A[_]}}uncacheRoot(r){const d=r.uuid,_=this._actionsByClip;for(const E in _){const P=_[E].actionByRoot[d];P!==void 0&&(this._deactivateAction(P),this._removeInactiveAction(P))}const A=this._bindingsByRootAndName[d];if(A!==void 0)for(const E in A){const P=A[E];P.restoreOriginalState(),this._removeInactiveBinding(P)}}uncacheAction(r,d){const _=this.existingAction(r,d);_!==null&&(this._deactivateAction(_),this._removeInactiveAction(_))}}class Ud{constructor(r){this.value=r}clone(){return new Ud(this.value.clone===void 0?this.value:this.value.clone())}}let Ob=0;class Lc extends sl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ob++}),this.name="",this.usage=Hu,this.uniforms=[]}add(r){return this.uniforms.push(r),this}remove(r){const d=this.uniforms.indexOf(r);return d!==-1&&this.uniforms.splice(d,1),this}setName(r){return this.name=r,this}setUsage(r){return this.usage=r,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(r){this.name=r.name,this.usage=r.usage;const d=r.uniforms;this.uniforms.length=0;for(let _=0,A=d.length;_<A;_++)this.uniforms.push(d[_].clone());return this}clone(){return new this.constructor().copy(this)}}class Fd extends Ap{constructor(r,d,_=1){super(r,d),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=_}copy(r){return super.copy(r),this.meshPerAttribute=r.meshPerAttribute,this}clone(r){const d=super.clone(r);return d.meshPerAttribute=this.meshPerAttribute,d}toJSON(r){const d=super.toJSON(r);return d.isInstancedInterleavedBuffer=!0,d.meshPerAttribute=this.meshPerAttribute,d}}class Zv{constructor(r,d,_,A,E){this.isGLBufferAttribute=!0,this.name="",this.buffer=r,this.type=d,this.itemSize=_,this.elementSize=A,this.count=E,this.version=0}set needsUpdate(r){r===!0&&this.version++}setBuffer(r){return this.buffer=r,this}setType(r,d){return this.type=r,this.elementSize=d,this}setItemSize(r){return this.itemSize=r,this}setCount(r){return this.count=r,this}}class Bb{constructor(r,d,_=0,A=1/0){this.ray=new Sh(r,d),this.near=_,this.far=A,this.camera=null,this.layers=new Th,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(r,d){this.ray.set(r,d)}setFromCamera(r,d){d.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(d.matrixWorld),this.ray.direction.set(r.x,r.y,.5).unproject(d).sub(this.ray.origin).normalize(),this.camera=d):d.isOrthographicCamera?(this.ray.origin.set(r.x,r.y,(d.near+d.far)/(d.near-d.far)).unproject(d),this.ray.direction.set(0,0,-1).transformDirection(d.matrixWorld),this.camera=d):console.error("THREE.Raycaster: Unsupported camera type: "+d.type)}intersectObject(r,d=!0,_=[]){return e0(r,this,_,d),_.sort(EA),_}intersectObjects(r,d=!0,_=[]){for(let A=0,E=r.length;A<E;A++)e0(r[A],this,_,d);return _.sort(EA),_}}function EA(R,r){return R.distance-r.distance}function e0(R,r,d,_){if(R.layers.test(r.layers)&&R.raycast(r,d),_===!0){const A=R.children;for(let E=0,P=A.length;E<P;E++)e0(A[E],r,d,!0)}}class SA{constructor(r=1,d=0,_=0){return this.radius=r,this.phi=d,this.theta=_,this}set(r,d,_){return this.radius=r,this.phi=d,this.theta=_,this}copy(r){return this.radius=r.radius,this.phi=r.phi,this.theta=r.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,d,_){return this.radius=Math.sqrt(r*r+d*d+_*_),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(r,_),this.phi=Math.acos(xo(d/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class MA{constructor(r=1,d=0,_=0){return this.radius=r,this.theta=d,this.y=_,this}set(r,d,_){return this.radius=r,this.theta=d,this.y=_,this}copy(r){return this.radius=r.radius,this.theta=r.theta,this.y=r.y,this}setFromVector3(r){return this.setFromCartesianCoords(r.x,r.y,r.z)}setFromCartesianCoords(r,d,_){return this.radius=Math.sqrt(r*r+_*_),this.theta=Math.atan2(r,_),this.y=d,this}clone(){return new this.constructor().copy(this)}}const ty=new li;class TA{constructor(r=new li(1/0,1/0),d=new li(-1/0,-1/0)){this.isBox2=!0,this.min=r,this.max=d}set(r,d){return this.min.copy(r),this.max.copy(d),this}setFromPoints(r){this.makeEmpty();for(let d=0,_=r.length;d<_;d++)this.expandByPoint(r[d]);return this}setFromCenterAndSize(r,d){const _=ty.copy(d).multiplyScalar(.5);return this.min.copy(r).sub(_),this.max.copy(r).add(_),this}clone(){return new this.constructor().copy(this)}copy(r){return this.min.copy(r.min),this.max.copy(r.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(r){return this.isEmpty()?r.set(0,0):r.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(r){return this.isEmpty()?r.set(0,0):r.subVectors(this.max,this.min)}expandByPoint(r){return this.min.min(r),this.max.max(r),this}expandByVector(r){return this.min.sub(r),this.max.add(r),this}expandByScalar(r){return this.min.addScalar(-r),this.max.addScalar(r),this}containsPoint(r){return!(r.x<this.min.x||r.x>this.max.x||r.y<this.min.y||r.y>this.max.y)}containsBox(r){return this.min.x<=r.min.x&&r.max.x<=this.max.x&&this.min.y<=r.min.y&&r.max.y<=this.max.y}getParameter(r,d){return d.set((r.x-this.min.x)/(this.max.x-this.min.x),(r.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(r){return!(r.max.x<this.min.x||r.min.x>this.max.x||r.max.y<this.min.y||r.min.y>this.max.y)}clampPoint(r,d){return d.copy(r).clamp(this.min,this.max)}distanceToPoint(r){return this.clampPoint(r,ty).distanceTo(r)}intersect(r){return this.min.max(r.min),this.max.min(r.max),this.isEmpty()&&this.makeEmpty(),this}union(r){return this.min.min(r.min),this.max.max(r.max),this}translate(r){return this.min.add(r),this.max.add(r),this}equals(r){return r.min.equals(this.min)&&r.max.equals(this.max)}}const t0=new zt,x_=new zt;class CA{constructor(r=new zt,d=new zt){this.start=r,this.end=d}set(r,d){return this.start.copy(r),this.end.copy(d),this}copy(r){return this.start.copy(r.start),this.end.copy(r.end),this}getCenter(r){return r.addVectors(this.start,this.end).multiplyScalar(.5)}delta(r){return r.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(r,d){return this.delta(d).multiplyScalar(r).add(this.start)}closestPointToPointParameter(r,d){t0.subVectors(r,this.start),x_.subVectors(this.end,this.start);const _=x_.dot(x_);let A=x_.dot(t0)/_;return d&&(A=xo(A,0,1)),A}closestPointToPoint(r,d,_){const A=this.closestPointToPointParameter(r,d);return this.delta(_).multiplyScalar(A).add(this.start)}applyMatrix4(r){return this.start.applyMatrix4(r),this.end.applyMatrix4(r),this}equals(r){return r.start.equals(this.start)&&r.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Nc=new zt;class n0 extends bs{constructor(r,d){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=d,this.type="SpotLightHelper";const _=new Fe,A=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let P=0,k=1,Q=32;P<Q;P++,k++){const G=P/Q*Math.PI*2,re=k/Q*Math.PI*2;A.push(Math.cos(G),Math.sin(G),1,Math.cos(re),Math.sin(re),1)}_.setAttribute("position",new tr(A,3));const E=new gl({fog:!1,toneMapped:!1});this.cone=new Ja(_,E),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const r=this.light.distance?this.light.distance:1e3,d=r*Math.tan(this.light.angle);this.cone.scale.set(d,d,r),Nc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Nc),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const zd=new zt,Np=new Gr,kp=new Gr;class RA extends Ja{constructor(r){const d=bl(r),_=new Fe,A=[],E=[],P=new Fi(0,0,1),k=new Fi(0,1,0);for(let Q=0;Q<d.length;Q++){const G=d[Q];G.parent&&G.parent.isBone&&(A.push(0,0,0),A.push(0,0,0),E.push(P.r,P.g,P.b),E.push(k.r,k.g,k.b))}_.setAttribute("position",new tr(A,3)),_.setAttribute("color",new tr(E,3)),super(_,new gl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=r,this.bones=d,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(r){const d=this.bones,_=this.geometry,A=_.getAttribute("position");kp.copy(this.root.matrixWorld).invert();for(let E=0,P=0;E<d.length;E++){const k=d[E];k.parent&&k.parent.isBone&&(Np.multiplyMatrices(kp,k.matrixWorld),zd.setFromMatrixPosition(Np),A.setXYZ(P,zd.x,zd.y,zd.z),Np.multiplyMatrices(kp,k.parent.matrixWorld),zd.setFromMatrixPosition(Np),A.setXYZ(P+1,zd.x,zd.y,zd.z),P+=2)}_.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose()}}function bl(R){const r=[];R.isBone===!0&&r.push(R);for(let d=0;d<R.children.length;d++)r.push.apply(r,bl(R.children[d]));return r}class ic extends Ko{constructor(r,d,_){super(new oh(d,4,2),new Ia({wireframe:!0,fog:!1,toneMapped:!1})),this.light=r,this.color=_,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const w_=new zt,E_=new Fi,Up=new Fi;class Qm extends bs{constructor(r,d,_){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=_,this.type="HemisphereLightHelper";const A=new Lm(d);A.rotateY(.5*Math.PI),this.material=new Ia({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const E=A.getAttribute("position"),P=new Float32Array(3*E.count);A.setAttribute("color",new Ns(P,3)),this.add(new Ko(A,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const d=r.geometry.getAttribute("color");E_.copy(this.light.color),Up.copy(this.light.groundColor);for(let _=0,A=d.count;_<A;_++){const E=_<A/2?E_:Up;d.setXYZ(_,E.r,E.g,E.b)}d.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),r.lookAt(w_.setFromMatrixPosition(this.light.matrixWorld).negate())}}class ny extends Ja{constructor(r=10,d=10,_=4473924,A=8947848){_=new Fi(_),A=new Fi(A);const E=d/2,P=r/d,k=r/2,Q=[],G=[];for(let xe=0,ye=0,Ee=-k;xe<=d;xe++,Ee+=P){Q.push(-k,0,Ee,k,0,Ee),Q.push(Ee,0,-k,Ee,0,k);const Ie=xe===E?_:A;Ie.toArray(G,ye),ye+=3,Ie.toArray(G,ye),ye+=3,Ie.toArray(G,ye),ye+=3,Ie.toArray(G,ye),ye+=3}const re=new Fe;re.setAttribute("position",new tr(Q,3)),re.setAttribute("color",new tr(G,3)),super(re,new gl({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class iy extends Ja{constructor(r=10,d=16,_=8,A=64,E=4473924,P=8947848){E=new Fi(E),P=new Fi(P);const k=[],Q=[];if(d>1)for(let re=0;re<d;re++){const xe=re/d*(2*Math.PI),ye=Math.sin(xe)*r,Ee=Math.cos(xe)*r;k.push(0,0,0),k.push(ye,0,Ee);const Ie=1&re?E:P;Q.push(Ie.r,Ie.g,Ie.b),Q.push(Ie.r,Ie.g,Ie.b)}for(let re=0;re<_;re++){const xe=1&re?E:P,ye=r-r/_*re;for(let Ee=0;Ee<A;Ee++){let Ie=Ee/A*(2*Math.PI),Ue=Math.sin(Ie)*ye,Oe=Math.cos(Ie)*ye;k.push(Ue,0,Oe),Q.push(xe.r,xe.g,xe.b),Ie=(Ee+1)/A*(2*Math.PI),Ue=Math.sin(Ie)*ye,Oe=Math.cos(Ie)*ye,k.push(Ue,0,Oe),Q.push(xe.r,xe.g,xe.b)}}const G=new Fe;G.setAttribute("position",new tr(k,3)),G.setAttribute("color",new tr(Q,3)),super(G,new gl({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const ry=new zt,qm=new zt,i0=new zt;class sy extends bs{constructor(r,d,_){super(),this.light=r,this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.color=_,this.type="DirectionalLightHelper",d===void 0&&(d=1);let A=new Fe;A.setAttribute("position",new tr([-d,d,0,d,d,0,d,-d,0,-d,-d,0,-d,d,0],3));const E=new gl({fog:!1,toneMapped:!1});this.lightPlane=new Vh(A,E),this.add(this.lightPlane),A=new Fe,A.setAttribute("position",new tr([0,0,0,0,0,1],3)),this.targetLine=new Vh(A,E),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),ry.setFromMatrixPosition(this.light.matrixWorld),qm.setFromMatrixPosition(this.light.target.matrixWorld),i0.subVectors(qm,ry),this.lightPlane.lookAt(qm),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qm),this.targetLine.scale.z=i0.length()}}const S_=new zt,Ro=new Cg;class vo extends Ja{constructor(r){const d=new Fe,_=new gl({color:16777215,vertexColors:!0,toneMapped:!1}),A=[],E=[],P={};function k(Ie,Ue){Q(Ie),Q(Ue)}function Q(Ie){A.push(0,0,0),E.push(0,0,0),P[Ie]===void 0&&(P[Ie]=[]),P[Ie].push(A.length/3-1)}k("n1","n2"),k("n2","n4"),k("n4","n3"),k("n3","n1"),k("f1","f2"),k("f2","f4"),k("f4","f3"),k("f3","f1"),k("n1","f1"),k("n2","f2"),k("n3","f3"),k("n4","f4"),k("p","n1"),k("p","n2"),k("p","n3"),k("p","n4"),k("u1","u2"),k("u2","u3"),k("u3","u1"),k("c","t"),k("p","c"),k("cn1","cn2"),k("cn3","cn4"),k("cf1","cf2"),k("cf3","cf4"),d.setAttribute("position",new tr(A,3)),d.setAttribute("color",new tr(E,3)),super(d,_),this.type="CameraHelper",this.camera=r,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=r.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=P,this.update();const G=new Fi(16755200),re=new Fi(16711680),xe=new Fi(43775),ye=new Fi(16777215),Ee=new Fi(3355443);this.setColors(G,re,xe,ye,Ee)}setColors(r,d,_,A,E){const P=this.geometry.getAttribute("color");P.setXYZ(0,r.r,r.g,r.b),P.setXYZ(1,r.r,r.g,r.b),P.setXYZ(2,r.r,r.g,r.b),P.setXYZ(3,r.r,r.g,r.b),P.setXYZ(4,r.r,r.g,r.b),P.setXYZ(5,r.r,r.g,r.b),P.setXYZ(6,r.r,r.g,r.b),P.setXYZ(7,r.r,r.g,r.b),P.setXYZ(8,r.r,r.g,r.b),P.setXYZ(9,r.r,r.g,r.b),P.setXYZ(10,r.r,r.g,r.b),P.setXYZ(11,r.r,r.g,r.b),P.setXYZ(12,r.r,r.g,r.b),P.setXYZ(13,r.r,r.g,r.b),P.setXYZ(14,r.r,r.g,r.b),P.setXYZ(15,r.r,r.g,r.b),P.setXYZ(16,r.r,r.g,r.b),P.setXYZ(17,r.r,r.g,r.b),P.setXYZ(18,r.r,r.g,r.b),P.setXYZ(19,r.r,r.g,r.b),P.setXYZ(20,r.r,r.g,r.b),P.setXYZ(21,r.r,r.g,r.b),P.setXYZ(22,r.r,r.g,r.b),P.setXYZ(23,r.r,r.g,r.b),P.setXYZ(24,d.r,d.g,d.b),P.setXYZ(25,d.r,d.g,d.b),P.setXYZ(26,d.r,d.g,d.b),P.setXYZ(27,d.r,d.g,d.b),P.setXYZ(28,d.r,d.g,d.b),P.setXYZ(29,d.r,d.g,d.b),P.setXYZ(30,d.r,d.g,d.b),P.setXYZ(31,d.r,d.g,d.b),P.setXYZ(32,_.r,_.g,_.b),P.setXYZ(33,_.r,_.g,_.b),P.setXYZ(34,_.r,_.g,_.b),P.setXYZ(35,_.r,_.g,_.b),P.setXYZ(36,_.r,_.g,_.b),P.setXYZ(37,_.r,_.g,_.b),P.setXYZ(38,A.r,A.g,A.b),P.setXYZ(39,A.r,A.g,A.b),P.setXYZ(40,E.r,E.g,E.b),P.setXYZ(41,E.r,E.g,E.b),P.setXYZ(42,E.r,E.g,E.b),P.setXYZ(43,E.r,E.g,E.b),P.setXYZ(44,E.r,E.g,E.b),P.setXYZ(45,E.r,E.g,E.b),P.setXYZ(46,E.r,E.g,E.b),P.setXYZ(47,E.r,E.g,E.b),P.setXYZ(48,E.r,E.g,E.b),P.setXYZ(49,E.r,E.g,E.b),P.needsUpdate=!0}update(){const r=this.geometry,d=this.pointMap;Ro.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qs("c",d,r,Ro,0,0,-1),Qs("t",d,r,Ro,0,0,1),Qs("n1",d,r,Ro,-1,-1,-1),Qs("n2",d,r,Ro,1,-1,-1),Qs("n3",d,r,Ro,-1,1,-1),Qs("n4",d,r,Ro,1,1,-1),Qs("f1",d,r,Ro,-1,-1,1),Qs("f2",d,r,Ro,1,-1,1),Qs("f3",d,r,Ro,-1,1,1),Qs("f4",d,r,Ro,1,1,1),Qs("u1",d,r,Ro,.7,1.1,-1),Qs("u2",d,r,Ro,-.7,1.1,-1),Qs("u3",d,r,Ro,0,2,-1),Qs("cf1",d,r,Ro,-1,0,1),Qs("cf2",d,r,Ro,1,0,1),Qs("cf3",d,r,Ro,0,-1,1),Qs("cf4",d,r,Ro,0,1,1),Qs("cn1",d,r,Ro,-1,0,-1),Qs("cn2",d,r,Ro,1,0,-1),Qs("cn3",d,r,Ro,0,-1,-1),Qs("cn4",d,r,Ro,0,1,-1),r.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Qs(R,r,d,_,A,E,P){S_.set(A,E,P).unproject(_);const k=r[R];if(k!==void 0){const Q=d.getAttribute("position");for(let G=0,re=k.length;G<re;G++)Q.setXYZ(k[G],S_.x,S_.y,S_.z)}}const au=new Ql;class Fp extends Ja{constructor(r,d=16776960){const _=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),A=new Float32Array(24),E=new Fe;E.setIndex(new Ns(_,1)),E.setAttribute("position",new Ns(A,3)),super(E,new gl({color:d,toneMapped:!1})),this.object=r,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(r){if(r!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&au.setFromObject(this.object),au.isEmpty())return;const d=au.min,_=au.max,A=this.geometry.attributes.position,E=A.array;E[0]=_.x,E[1]=_.y,E[2]=_.z,E[3]=d.x,E[4]=_.y,E[5]=_.z,E[6]=d.x,E[7]=d.y,E[8]=_.z,E[9]=_.x,E[10]=d.y,E[11]=_.z,E[12]=_.x,E[13]=_.y,E[14]=d.z,E[15]=d.x,E[16]=_.y,E[17]=d.z,E[18]=d.x,E[19]=d.y,E[20]=d.z,E[21]=_.x,E[22]=d.y,E[23]=d.z,A.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(r){return this.object=r,this.update(),this}copy(r,d){return super.copy(r,d),this.object=r.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class M_ extends Ja{constructor(r,d=16776960){const _=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),A=new Fe;A.setIndex(new Ns(_,1)),A.setAttribute("position",new tr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(A,new gl({color:d,toneMapped:!1})),this.box=r,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(r){const d=this.box;d.isEmpty()||(d.getCenter(this.position),d.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(r))}dispose(){this.geometry.dispose(),this.material.dispose()}}class IA extends Vh{constructor(r,d=1,_=16776960){const A=_,E=new Fe;E.setAttribute("position",new tr([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),E.computeBoundingSphere(),super(E,new gl({color:A,toneMapped:!1})),this.type="PlaneHelper",this.plane=r,this.size=d;const P=new Fe;P.setAttribute("position",new tr([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),P.computeBoundingSphere(),this.add(new Ko(P,new Ia({color:A,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(r){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(r)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const PA=new zt;let T_,oy;class r0 extends bs{constructor(r=new zt(0,0,1),d=new zt(0,0,0),_=1,A=16776960,E=.2*_,P=.2*E){super(),this.type="ArrowHelper",T_===void 0&&(T_=new Fe,T_.setAttribute("position",new tr([0,0,0,0,1,0],3)),oy=new $l(0,.5,1,5,1),oy.translate(0,-.5,0)),this.position.copy(d),this.line=new Vh(T_,new gl({color:A,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ko(oy,new Ia({color:A,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(_,E,P)}setDirection(r){if(r.y>.99999)this.quaternion.set(0,0,0,1);else if(r.y<-.99999)this.quaternion.set(1,0,0,0);else{PA.set(r.z,0,-r.x).normalize();const d=Math.acos(r.y);this.quaternion.setFromAxisAngle(PA,d)}}setLength(r,d=.2*r,_=.2*d){this.line.scale.set(1,Math.max(1e-4,r-d),1),this.line.updateMatrix(),this.cone.scale.set(_,d,_),this.cone.position.y=r,this.cone.updateMatrix()}setColor(r){this.line.material.color.set(r),this.cone.material.color.set(r)}copy(r){return super.copy(r,!1),this.line.copy(r.line),this.cone.copy(r.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class lh extends Ja{constructor(r=1){const d=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],_=new Fe;_.setAttribute("position",new tr(d,3)),_.setAttribute("color",new tr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(_,new gl({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(r,d,_){const A=new Fi,E=this.geometry.attributes.color.array;return A.set(r),A.toArray(E,0),A.toArray(E,3),A.set(d),A.toArray(E,6),A.toArray(E,9),A.set(_),A.toArray(E,12),A.toArray(E,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class s0{constructor(){this.type="ShapePath",this.color=new Fi,this.subPaths=[],this.currentPath=null}moveTo(r,d){return this.currentPath=new Id,this.subPaths.push(this.currentPath),this.currentPath.moveTo(r,d),this}lineTo(r,d){return this.currentPath.lineTo(r,d),this}quadraticCurveTo(r,d,_,A){return this.currentPath.quadraticCurveTo(r,d,_,A),this}bezierCurveTo(r,d,_,A,E,P){return this.currentPath.bezierCurveTo(r,d,_,A,E,P),this}splineThru(r){return this.currentPath.splineThru(r),this}toShapes(r){function d(Oe,ke){const Ge=ke.length;let Je=!1;for(let Rt=Ge-1,Et=0;Et<Ge;Rt=Et++){let xt=ke[Rt],Zt=ke[Et],g=Zt.x-xt.x,b=Zt.y-xt.y;if(Math.abs(b)>Number.EPSILON){if(b<0&&(xt=ke[Et],g=-g,Zt=ke[Rt],b=-b),Oe.y<xt.y||Oe.y>Zt.y)continue;if(Oe.y===xt.y){if(Oe.x===xt.x)return!0}else{const D=b*(Oe.x-xt.x)-g*(Oe.y-xt.y);if(D===0)return!0;if(D<0)continue;Je=!Je}}else{if(Oe.y!==xt.y)continue;if(Zt.x<=Oe.x&&Oe.x<=xt.x||xt.x<=Oe.x&&Oe.x<=Zt.x)return!0}}return Je}const _=Ic.isClockWise,A=this.subPaths;if(A.length===0)return[];let E,P,k;const Q=[];if(A.length===1)return P=A[0],k=new Wh,k.curves=P.curves,Q.push(k),Q;let G=!_(A[0].getPoints());G=r?!G:G;const re=[],xe=[];let ye,Ee,Ie=[],Ue=0;xe[Ue]=void 0,Ie[Ue]=[];for(let Oe=0,ke=A.length;Oe<ke;Oe++)P=A[Oe],ye=P.getPoints(),E=_(ye),E=r?!E:E,E?(!G&&xe[Ue]&&Ue++,xe[Ue]={s:new Wh,p:ye},xe[Ue].s.curves=P.curves,G&&Ue++,Ie[Ue]=[]):Ie[Ue].push({h:P,p:ye[0]});if(!xe[0])return function(Oe){const ke=[];for(let Ge=0,Je=Oe.length;Ge<Je;Ge++){const Rt=Oe[Ge],Et=new Wh;Et.curves=Rt.curves,ke.push(Et)}return ke}(A);if(xe.length>1){let Oe=!1,ke=0;for(let Ge=0,Je=xe.length;Ge<Je;Ge++)re[Ge]=[];for(let Ge=0,Je=xe.length;Ge<Je;Ge++){const Rt=Ie[Ge];for(let Et=0;Et<Rt.length;Et++){const xt=Rt[Et];let Zt=!0;for(let g=0;g<xe.length;g++)d(xt.p,xe[g].p)&&(Ge!==g&&ke++,Zt?(Zt=!1,re[g].push(xt)):Oe=!0);Zt&&re[Ge].push(xt)}}ke>0&&Oe===!1&&(Ie=re)}for(let Oe=0,ke=xe.length;Oe<ke;Oe++){k=xe[Oe].s,Q.push(k),Ee=Ie[Oe];for(let Ge=0,Je=Ee.length;Ge<Je;Ge++)k.holes.push(Ee[Ge].h)}return Q}}class C_ extends Yu{constructor(r,d,_,A,E,P){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(r,d,_,A,E,P)}}class ay extends Os{constructor(r,d,_,A){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(r,d,_,A)}}class Lb extends s_{constructor(r,d,_,A){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(r,d,_,A)}}class jd extends Rc{constructor(r,d,_,A,E,P,k){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(r,d,_,A,E,P,k)}}class R_ extends $l{constructor(r,d,_,A,E,P,k,Q){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(r,d,_,A,E,P,k,Q)}}class ly extends Cp{constructor(r,d){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(r,d)}}class o0 extends Pd{constructor(r,d){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(r,d)}}class cy extends Pu{constructor(r,d){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(r,d)}}class Xm extends Ru{constructor(r,d,_,A){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(r,d,_,A)}}class I_ extends Lm{constructor(r,d){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(r,d)}}class a0 extends Da{constructor(r,d,_,A){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(r,d,_,A)}}class DA extends rh{constructor(r,d,_,A){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(r,d,_,A)}}class l0 extends Za{constructor(r,d,_,A,E,P){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(r,d,_,A,E,P)}}class OA extends h_{constructor(r,d){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(r,d)}}class uy extends oh{constructor(r,d,_,A,E,P,k){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(r,d,_,A,E,P,k)}}class BA extends Dd{constructor(r,d){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(r,d)}}class Ym extends _l{constructor(r,d,_,A,E){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(r,d,_,A,E)}}class Nb extends _o{constructor(r,d,_,A,E,P){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(r,d,_,A,E,P)}}class P_ extends Yr{constructor(r,d,_,A,E){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(r,d,_,A,E)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:v}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=v)},553:function(u,a,s){s.d(a,{_:function(){return M}});var v=s(988);const x=new WeakMap;class M extends v.aNw{constructor(U){super(U),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(U){return this.decoderPath=U,this}setDecoderConfig(U){return this.decoderConfig=U,this}setWorkerLimit(U){return this.workerLimit=U,this}load(U,j,te,Z){const oe=new v.hH6(this.manager);oe.setPath(this.path),oe.setResponseType("arraybuffer"),oe.setRequestHeader(this.requestHeader),oe.setWithCredentials(this.withCredentials),oe.load(U,le=>{this.parse(le,j,Z)},te,Z)}parse(U,j,te){this.decodeDracoFile(U,j,null,null,v.KI_).catch(te)}decodeDracoFile(U,j,te,Z,oe=v.GUF){const le={attributeIDs:te||this.defaultAttributeIDs,attributeTypes:Z||this.defaultAttributeTypes,useUniqueIDs:!!te,vertexColorSpace:oe};return this.decodeGeometry(U,le).then(j)}decodeGeometry(U,j){const te=JSON.stringify(j);if(x.has(U)){const ve=x.get(U);if(ve.key===te)return ve.promise;if(U.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let Z;const oe=this.workerNextTaskID++,le=U.byteLength,se=this._getWorker(oe,le).then(ve=>(Z=ve,new Promise((ce,K)=>{Z._callbacks[oe]={resolve:ce,reject:K},Z.postMessage({type:"decode",id:oe,taskConfig:j,buffer:U},[U])}))).then(ve=>this._createGeometry(ve.geometry));return se.catch(()=>!0).then(()=>{Z&&oe&&this._releaseTask(Z,oe)}),x.set(U,{key:te,promise:se}),se}_createGeometry(U){const j=new v.u9r;U.index&&j.setIndex(new v.TlE(U.index.array,1));for(let te=0;te<U.attributes.length;te++){const Z=U.attributes[te],oe=Z.name,le=Z.array,se=Z.itemSize,ve=new v.TlE(le,se);oe==="color"&&this._assignVertexColorSpace(ve,Z.vertexColorSpace),j.setAttribute(oe,ve)}return j}_assignVertexColorSpace(U,j){if(j!==v.KI_)return;const te=new v.Ilk;for(let Z=0,oe=U.count;Z<oe;Z++)te.fromBufferAttribute(U,Z).convertSRGBToLinear(),U.setXYZ(Z,te.r,te.g,te.b)}_loadLibrary(U,j){const te=new v.hH6(this.manager);return te.setPath(this.decoderPath),te.setResponseType(j),te.setWithCredentials(this.withCredentials),new Promise((Z,oe)=>{te.load(U,Z,void 0,oe)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const U=typeof WebAssembly!="object"||this.decoderConfig.type==="js",j=[];return U?j.push(this._loadLibrary("draco_decoder.js","text")):(j.push(this._loadLibrary("draco_wasm_wrapper.js","text")),j.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(j).then(te=>{const Z=te[0];U||(this.decoderConfig.wasmBinary=te[1]);const oe=I,le=["/* draco decoder */",Z,"","/* worker */",oe.substring(oe.indexOf("{")+1,oe.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([le]))}),this.decoderPending}_getWorker(U,j){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const Z=new Worker(this.workerSourceURL);Z._callbacks={},Z._taskCosts={},Z._taskLoad=0,Z.postMessage({type:"init",decoderConfig:this.decoderConfig}),Z.onmessage=function(oe){const le=oe.data;switch(le.type){case"decode":Z._callbacks[le.id].resolve(le);break;case"error":Z._callbacks[le.id].reject(le);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+le.type+'"')}},this.workerPool.push(Z)}else this.workerPool.sort(function(Z,oe){return Z._taskLoad>oe._taskLoad?-1:1});const te=this.workerPool[this.workerPool.length-1];return te._taskCosts[U]=j,te._taskLoad+=j,te})}_releaseTask(U,j){U._taskLoad-=U._taskCosts[j],delete U._callbacks[j],delete U._taskCosts[j]}debug(){console.log("Task load: ",this.workerPool.map(U=>U._taskLoad))}dispose(){for(let U=0;U<this.workerPool.length;++U)this.workerPool[U].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const I=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(u){var a=__webpackgi_module_cache__[u];if(a!==void 0)return a.exports;var s=__webpackgi_module_cache__[u]={id:u,exports:{}};return __webpackgi_modules__[u].call(s.exports,s,s.exports,__webpackgi_require__),s.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(u){var a=u&&u.__esModule?function(){return u.default}:function(){return u};return __webpackgi_require__.d(a,{a}),a},getProto=Object.getPrototypeOf?function(u){return Object.getPrototypeOf(u)}:function(u){return u.__proto__},__webpackgi_require__.t=function(u,a){if(1&a&&(u=this(u)),8&a||typeof u=="object"&&u&&(4&a&&u.__esModule||16&a&&typeof u.then=="function"))return u;var s=Object.create(null);__webpackgi_require__.r(s);var v={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var x=2&a&&u;typeof x=="object"&&!~leafPrototypes.indexOf(x);x=getProto(x))Object.getOwnPropertyNames(x).forEach(function(M){v[M]=function(){return u[M]}});return v.default=function(){return u},__webpackgi_require__.d(s,v),s},__webpackgi_require__.d=function(u,a){for(var s in a)__webpackgi_require__.o(a,s)&&!__webpackgi_require__.o(u,s)&&Object.defineProperty(u,s,{enumerable:!0,get:a[s]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(u){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(a,s){return __webpackgi_require__.f[s](u,a),a},[]))},__webpackgi_require__.u=function(u){return u+".mjs"},__webpackgi_require__.o=function(u,a){return Object.prototype.hasOwnProperty.call(u,a)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(u,a,s,v){if(inProgress[u])inProgress[u].push(a);else{var x,M;if(s!==void 0)for(var I=document.getElementsByTagName("script"),B=0;B<I.length;B++){var U=I[B];if(U.getAttribute("src")==u||U.getAttribute("data-webpack")==dataWebpackPrefix+s){x=U;break}}x||(M=!0,(x=document.createElement("script")).type="module",x.charset="utf-8",x.timeout=120,__webpackgi_require__.nc&&x.setAttribute("nonce",__webpackgi_require__.nc),x.setAttribute("data-webpack",dataWebpackPrefix+s),x.src=u),inProgress[u]=[a];var j=function(Z,oe){x.onerror=x.onload=null,clearTimeout(te);var le=inProgress[u];if(delete inProgress[u],x.parentNode&&x.parentNode.removeChild(x),le&&le.forEach(function(se){return se(oe)}),Z)return Z(oe)},te=setTimeout(j.bind(null,void 0,{type:"timeout",target:x}),12e4);x.onerror=j.bind(null,x.onerror),x.onload=j.bind(null,x.onload),M&&document.head.appendChild(x)}},__webpackgi_require__.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},function(){var u;if(typeof import.meta.url=="string"&&(u=import.meta.url),!u)throw new Error("Automatic publicPath is not supported in this browser");u=u.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=u+"../../"}(),function(){var u={698:0};__webpackgi_require__.f.j=function(v,x){var M=__webpackgi_require__.o(u,v)?u[v]:void 0;if(M!==0)if(M)x.push(M[2]);else{var I=new Promise(function(j,te){M=u[v]=[j,te]});x.push(M[2]=I);var B=__webpackgi_require__.p+__webpackgi_require__.u(v),U=new Error;__webpackgi_require__.l(B,function(j){if(__webpackgi_require__.o(u,v)&&((M=u[v])!==0&&(u[v]=void 0),M)){var te=j&&(j.type==="load"?"missing":j.type),Z=j&&j.target&&j.target.src;U.message="Loading chunk "+v+` failed.
(`+te+": "+Z+")",U.name="ChunkLoadError",U.type=te,U.request=Z,M[1](U)}},"chunk-"+v,v)}};var a=function(v,x){var M,I,B=x[0],U=x[1],j=x[2],te=0;if(B.some(function(Z){return u[Z]!==0})){for(M in U)__webpackgi_require__.o(U,M)&&(__webpackgi_require__.m[M]=U[M]);j&&j(__webpackgi_require__)}for(v&&v(x);te<B.length;te++)I=B[te],__webpackgi_require__.o(u,I)&&u[I]&&u[I][0](),u[I]=0},s=self.webpackChunkwebgi=self.webpackChunkwebgi||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){var u;__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return b_},LY2:function(){return s.LY2},GYo:function(){return hE},GPz:function(){return Fw},HRj:function(){return gh},li4:function(){return eC},FO5:function(){return z_},Nlh:function(){return tC},Mp4:function(){return Ir},QvI:function(){return Ri},PrA:function(){return Kd},JHp:function(){return I0},bGH:function(){return s.bGH},NDo:function(){return s.NDo},gSk:function(){return s.gSk},WMw:function(){return s.WMw},OTo:function(){return s.OTo},Se2:function(){return s.Se2},cum:function(){return s.cum},Mig:function(){return s.Mig},B$7:function(){return Eh},i_9:function(){return s.i_9},bBp:function(){return s.bBp},m7l:function(){return s.m7l},sYA:function(){return s.sYA},Xcj:function(){return s.Xcj},mzJ:function(){return s.mzJ},ZZA:function(){return s.ZZA},$Ph:function(){return Na},T__:function(){return s.T__},HkE:function(){return s.HkE},tGC:function(){return s.tGC},g1S:function(){return CM},I$C:function(){return f0},QIH:function(){return Vi},_JE:function(){return Lc},SwW:function(){return ms},ksm:function(){return fi},jl_:function(){return sf},b7R:function(){return jo},BDV:function(){return Ih},Ea_:function(){return de},qff:function(){return sf},tmC:function(){return tr},BON:function(){return cv},P40:function(){return eo},wLL:function(){return Ig},iHO:function(){return Tn},BbS:function(){return s.BbS},kqm:function(){return s.kqm},Hmr:function(){return s.Hmr},SJI:function(){return s.SJI},mTL:function(){return s.mTL},y8_:function(){return s.y8_},_Li:function(){return s._Li},w7U:function(){return O0},g56:function(){return Uu},bj3:function(){return ys},z81:function(){return s.z81},_MY:function(){return s._MY},yEv:function(){return II},dFZ:function(){return Go},N$j:function(){return s.N$j},_YM:function(){return s._YM},TUj:function(){return s.TUj},ZzF:function(){return s.ZzF},qzb:function(){return X},GQ:function(){return s.GQ},nvb:function(){return s.nvb},DvJ:function(){return s.DvJ},fQA:function(){return s.fQA},cPz:function(){return k0},TlE:function(){return s.TlE},u9r:function(){return s.u9r},s4_:function(){return s.s4_},T95:function(){return s.T95},F5w:function(){return rx},NlP:function(){return mx},$8Z:function(){return j_},YYN:function(){return lg},CtF:function(){return s.CtF},V1s:function(){return s.V1s},jOv:function(){return Hi},Rki:function(){return s.Rki},pzV:function(){return Ox},itZ:function(){return Jo},MMq:function(){return mg},qKx:function(){return ks},Hmi:function(){return Ag},X4S:function(){return tx},vlJ:function(){return GE},nPO:function(){return Ff},zcQ:function(){return jh},GH1:function(){return Cu},ROQ:function(){return s.ROQ},YN5:function(){return s.YN5},BVQ:function(){return s.BVQ},YT8:function(){return s.YT8},_DE:function(){return Og},YGz:function(){return s.YGz},trn:function(){return s.trn},zf8:function(){return s.zf8},uWy:function(){return s.uWy},wYQ:function(){return zl},SUY:function(){return s.SUY},Ilk:function(){return s.Ilk},R2R:function(){return s.R2R},epp:function(){return s.epp},xmJ:function(){return Jc},GD$:function(){return pa},Z_g:function(){return s.Z_g},EB7:function(){return s.EB7},DqL:function(){return s.DqL},_3:function(){return s._3},b_z:function(){return s.b_z},OCn:function(){return Hp},N_j:function(){return oN},hNv:function(){return lM},_am:function(){return s._am},kB7:function(){return _f},fY$:function(){return s.fY$},vxC:function(){return s.vxC},BtG:function(){return s.BtG},cBK:function(){return s.cBK},g8_:function(){return s.g8_},AXT:function(){return s.AXT},yj7:function(){return s.yj7},dYG:function(){return s.dYG},tm_:function(){return s.tm_},S2y:function(){return s.S2y},B02:function(){return s.B02},PeU:function(){return s.PeU},Hyl:function(){return s.Hyl},Wqd:function(){return s.Wqd},c0Q:function(){return qC},re0:function(){return XC},Xaj:function(){return s.Xaj},DUb:function(){return Ll},dZ3:function(){return s.dZ3},m_w:function(){return s.m_w},fHI:function(){return s.fHI},LBq:function(){return s.LBq},Qww:function(){return Qa.Q},CGV:function(){return a.Damper},JUT:function(){return s.JUT},p3g:function(){return s.p3g},IEO:function(){return s.IEO},yxD:function(){return s.yxD},CUS:function(){return gM},A5E:function(){return s.A5E},zqG:function(){return Fd},PfX:function(){return Tg},Q1o:function(){return Dl},jfJ:function(){return s.jfJ},T_J:function(){return s.T_J},tEQ:function(){return s.tEQ},gb4:function(){return Xl},qkB:function(){return s.qkB},cvk:function(){return Md},HWo:function(){return mp},brP:function(){return s.brP},$YQ:function(){return s.$YQ},X8d:function(){return gx},Zdt:function(){return dS},yNB:function(){return Ds},h7x:function(){return Fs},Ox3:function(){return s.Ox3},qtn:function(){return Gc},cBI:function(){return s.cBI},cU9:function(){return s.cU9},ntt:function(){return s.ntt},DT1:function(){return s.DT1},Kgo:function(){return s.Kgo},ehD:function(){return s.ehD},fhJ:function(){return Pg},y1s:function(){return of},fSK:function(){return s.fSK},Vdb:function(){return s.Vdb},l8J:function(){return s.l8J},dj0:function(){return s.dj0},QM0:function(){return s.QM0},n94:function(){return iw},OIS:function(){return o1},q8b:function(){return Ul},TOt:function(){return s.TOt},xaN:function(){return oe},Ny0:function(){return s.Ny0},NeD:function(){return V1},Zof:function(){return Yu},N1Y:function(){return jb},itK:function(){return eh},eD:function(){return s.eD},jwo:function(){return s.jwo},dSO:function(){return s.dSO},Bf4:function(){return s.Bf4},USm:function(){return s.USm},pBf:function(){return s.pBf},eBg:function(){return zS},$Vf:function(){return s.$Vf},O7d:function(){return s.O7d},ksq:function(){return D},hFL:function(){return YA},gXf:function(){return i1},hH6:function(){return s.hH6},izP:function(){return vx},kpi:function(){return lm},DwZ:function(){return oc},kN3:function(){return mS},e62:function(){return s.e62},a$l:function(){return s.a$l},OM3:function(){return s.OM3},VzW:function(){return s.VzW},ybr:function(){return s.ybr},yo9:function(){return s.yo9},Dzq:function(){return dl},zCA:function(){return pl},$Bt:function(){return Zu},Wzm:function(){return s.Wzm},Wl3:function(){return s.Wl3},iWj:function(){return s.iWj},DNz:function(){return ru},m1M:function(){return vr},ylh:function(){return s.ylh},v9Y:function(){return s.v9Y},LSk:function(){return s.LSk},LHE:function(){return Ws},KE0:function(){return B1},KCF:function(){return qT},a4n:function(){return _1},NKC:function(){return X0},jrv:function(){return Bu},zIH:function(){return mu},Hfk:function(){return Ql},png:function(){return pd},tAj:function(){return _u},Eb_:function(){return fc},SJj:function(){return vA},cF0:function(){return uo},BT2:function(){return c1},_8p:function(){return SM},V5Z:function(){return Vm},s5b:function(){return p_},BHZ:function(){return B0},hkn:function(){return so},GFY:function(){return br},w$m:function(){return s.w$m},ksN:function(){return s.ksN},j4z:function(){return s.j4z},OAl:function(){return s.OAl},VLJ:function(){return s.VLJ},C73:function(){return Hd},ZAu:function(){return s.ZAu},ibP:function(){return F},lth:function(){return iu},_fI:function(){return pa},hUN:function(){return fl},cLu:function(){return s.cLu},vmT:function(){return s.vmT},Qpg:function(){return s.Qpg},So8:function(){return s.So8},eOv:function(){return Ix},Wjw:function(){return s.Wjw},cJO:function(){return s.cJO},QRU:function(){return s.QRU},S3k:function(){return s.S3k},OPJ:function(){return nC},PpQ:function(){return s.PpQ},q_9:function(){return Js},ZRs:function(){return s.ZRs},oqc:function(){return s.oqc},T_x:function(){return Aa},lb7:function(){return s.lb7},L5s:function(){return s.L5s},$TI:function(){return s.$TI},SPe:function(){return s.SPe},aVm:function(){return s.aVm},j87:function(){return s.j87},RNb:function(){return s.RNb},Kz5:function(){return s.Kz5},vpT:function(){return s.vpT},kB5:function(){return s.kB5},_C8:function(){return s._C8},Syv:function(){return s.Syv},NMF:function(){return s.NMF},pIN:function(){return s.pIN},eMJ:function(){return s.eMJ},rN7:function(){return __},iUp:function(){return nc},GFd:function(){return h1},x5V:function(){return s.x5V},tUh:function(){return s.tUh},z8B:function(){return s.z8B},vcl:function(){return Co},GZb:function(){return s.GZb},p7y:function(){return s.p7y},S9g:function(){return s.S9g},Zr5:function(){return s.Zr5},vCF:function(){return s.vCF},yt0:function(){return s.yt0},uXU:function(){return s.uXU},_kC:function(){return s._kC},lk7:function(){return s.lk7},USc:function(){return Px},x12:function(){return s.x12},w_R:function(){return wI},Zzh:function(){return s.Zzh},nls:function(){return s.nls},g_z:function(){return s.g_z},U7:function(){return s.U7},FT0:function(){return s.FT0},L1_:function(){return mM},blk:function(){return s.blk},YRm:function(){return Fg},ejS:function(){return s.ejS},wUb:function(){return fM},zOz:function(){return Ug},rnI:function(){return s.rnI},wem:function(){return s.wem},lfu:function(){return s.lfu},FDw:function(){return s.FDw},lRj:function(){return s.lRj},D1R:function(){return s.D1R},qyh:function(){return s.qyh},GUF:function(){return s.GUF},EoG:function(){return s.EoG},aNw:function(){return s.aNw},Zp0:function(){return s.Zp0},lLk:function(){return s.lLk},jAl:function(){return s.jAl},uEv:function(){return s.uEv},YKA:function(){return s.YKA},cRx:function(){return s.cRx},Y8D:function(){return s.Y8D},RsA:function(){return s.RsA},Y0m:function(){return Zv},F5T:function(){return s.F5T},EDU:function(){return be},z$Q:function(){return L_},KA8:function(){return Wi},ZqF:function(){return tA},XUj:function(){return Kx},Me$:function(){return Jm},u7G:function(){return s.u7G},PEk:function(){return Jd},BG4:function(){return ne},M8C:function(){return s.M8C},Vkp:function(){return s.Vkp},yGw:function(){return s.yGw},Sm8:function(){return s.Sm8},Kj0:function(){return s.Kj0},vBJ:function(){return s.vBJ},QfV:function(){return Ts},lRF:function(){return s.lRF},Lun:function(){return s.Lun},YBo:function(){return s.YBo},kaV:function(){return s.kaV},RSm:function(){return s.RSm},xoR:function(){return s.xoR},EJi:function(){return s.EJi},Wid:function(){return s.Wid},iuj:function(){return Wr},IKL:function(){return s.IKL},r_:function(){return s.r_},OoA:function(){return s.OoA},qhX:function(){return s.qhX},CRe:function(){return Dp},qPT:function(){return fp},M5h:function(){return s.M5h},Ns1:function(){return s.Ns1},TyD:function(){return s.TyD},vZf:function(){return s.vZf},HTd:function(){return s.HTd},aH4:function(){return s.aH4},YLQ:function(){return s.YLQ},BVF:function(){return s.BVF},MyG:function(){return s.MyG},jFi:function(){return s.jFi},aCh:function(){return s.aCh},uL9:function(){return s.uL9},TNj:function(){return yl},IFH:function(){return s.IFH},bdR:function(){return s.bdR},RPs:function(){return Uh},kM_:function(){return Fh},M6v:function(){return s.M6v},RvT:function(){return s.RvT},dUE:function(){return s.dUE},oe_:function(){return Np},BuN:function(){return kp},Tme:function(){return s.Tme},N9P:function(){return ao},Gql:function(){return s.Gql},$XY:function(){return Us},O9d:function(){return Kl},zEO:function(){return xg},qfx:function(){return zf},PA7:function(){return s.PA7},REq:function(){return s.REq},pQR:function(){return s.pQR},ghN:function(){return s.ghN},Hy8:function(){return s.Hy8},Wpd:function(){return s.Wpd},LgZ:function(){return s.LgZ},iWC:function(){return s.iWC},mqn:function(){return FL},SKe:function(){return Mn},iKG:function(){return s.iKG},rCq:function(){return ex},_iA:function(){return s._iA},ntZ:function(){return s.ntZ},anP:function(){return s.anP},X2e:function(){return YT},oxT:function(){return Fl},FCo:function(){return Wp},y$t:function(){return s.y$t},cPb:function(){return s.cPb},lmx:function(){return us},JOQ:function(){return s.JOQ},BKK:function(){return s.BKK},_12:function(){return s._12},tJx:function(){return s.tJx},mjX:function(){return cf},cek:function(){return s.cek},qD0:function(){return wh},xG9:function(){return s.xG9},eqi:function(){return a.PointerDragHelper},wI8:function(){return q_},Sgv:function(){return gS},woe:function(){return s.woe},UY4:function(){return s.UY4},aq0:function(){return s.aq0},ujx:function(){return s.ujx},Uol:function(){return s.Uol},JiH:function(){return JA},VYz:function(){return s.VYz},B2H:function(){return kg},_Pm:function(){return uf},EsW:function(){return to},iUV:function(){return s.iUV},tf:function(){return s.tf},ZQ6:function(){return s.ZQ6},mXe:function(){return s.mXe},_fP:function(){return s._fP},iLg:function(){return s.iLg},zbs:function(){return s.zbs},ZTh:function(){return s.ZTh},HdW:function(){return s.HdW},UZH:function(){return s.UZH},mSO:function(){return s.mSO},wk1:function(){return s.wk1},E2K:function(){return s.E2K},FUD:function(){return s.FUD},pKu:function(){return s.pKu},GG6:function(){return s.GG6},Gih:function(){return s.Gih},iiP:function(){return s.iiP},SvJ:function(){return s.SvJ},ptH:function(){return s.ptH},jZA:function(){return s.jZA},y2t:function(){return s.y2t},gi4:function(){return s.gi4},Djp:function(){return s.Djp},BG$:function(){return s.BG$},NYV:function(){return s.NYV},xJs:function(){return s.xJs},bsb:function(){return s.bsb},ekQ:function(){return s.ekQ},CaW:function(){return s.CaW},eaV:function(){return s.eaV},BFQ:function(){return s.BFQ},v3W:function(){return s.v3W},ILR:function(){return s.ILR},G_r:function(){return s.G_r},N3F:function(){return ee},fto:function(){return s.fto},l0P:function(){return s.l0P},vCx:function(){return s.vCx},_AM:function(){return s._AM},wuA:function(){return s.wuA},av9:function(){return s.av9},CtA:function(){return s.CtA},BvQ:function(){return gm},FZJ:function(){return Nl},FIo:function(){return s.FIo},zHn:function(){return s.zHn},iMs:function(){return s.iMs},T_f:function(){return s.T_f},hEm:function(){return s.hEm},D9w:function(){return s.D9w},sHH:function(){return my},CdI:function(){return s.CdI},rkc:function(){return Yd},rpg:function(){return s.rpg},ce8:function(){return s.ce8},rOj:function(){return s.rOj},P6m:function(){return l1},JA6:function(){return ng},V4E:function(){return s.V4E},o8S:function(){return s.o8S},flB:function(){return Ki},lGU:function(){return s.lGU},vuL:function(){return s.vuL},KI_:function(){return s.KI_},iLN:function(){return Vo},X6w:function(){return jm},rz_:function(){return Lu},jsw:function(){return ml},srG:function(){return mm},i6Z:function(){return Ka},vfv:function(){return u1},xsS:function(){return s.xsS},or:function(){return Dx},EQj:function(){return Zl},Rnn:function(){return _S},TyN:function(){return E0},ov0:function(){return N0},WdD:function(){return s.WdD},Vj0:function(){return s.Vj0},jyz:function(){return s.jyz},mTM:function(){return Ar},Mn1:function(){return _s},Hlq:function(){return Ms},Fi7:function(){return ed},Tn7:function(){return s.Tn7},bnF:function(){return s.bnF},HW6:function(){return s.HW6},oa8:function(){return s.oa8},T_1:function(){return s.T_1},zHJ:function(){return rd},iDF:function(){return s.iDF},iAb:function(){return s.iAb},d4E:function(){return p0},lBg:function(){return Cx},JeJ:function(){return xI},FKY:function(){return a.SimpleEventDispatcher},zlZ:function(){return _M},vkg:function(){return _h},brh:function(){return vM},kZK:function(){return sd},puG:function(){return Rx},OdW:function(){return s.OdW},_YX:function(){return s._YX},TUv:function(){return s.TUv},Hw6:function(){return s.Hw6},aLr:function(){return s.aLr},Aip:function(){return s.Aip},xo$:function(){return s.xo$},bIn:function(){return zL},$V:function(){return s.$V},lDi:function(){return s.lDi},gti:function(){return s.gti},PMe:function(){return s.PMe},iwP:function(){return yu},FvO:function(){return s.FvO},jyi:function(){return s.jyi},xeV:function(){return s.xeV},k74:function(){return s.k74},RlZ:function(){return s.RlZ},KhW:function(){return s.KhW},HgB:function(){return s.HgB},W2J:function(){return s.W2J},JWc:function(){return s.JWc},u37:function(){return s.u37},Z6B:function(){return s.Z6B},QZ1:function(){return s.QZ1},Ir4:function(){return s.Ir4},NwF:function(){return s.NwF},Wbm:function(){return s.Wbm},N4l:function(){return s.N4l},Jxm:function(){return n1},ej9:function(){return N_},QmN:function(){return s.QmN},Y4W:function(){return a.TYPED_ARRAYS},IOt:function(){return s.IOt},NOD:function(){return Dc},L5g:function(){return s.L5g},H$k:function(){return s.H$k},cuP:function(){return Vl},xEZ:function(){return s.xEZ},dpR:function(){return s.dpR},wOD:function(){return Ec},KNb:function(){return wd},IiN:function(){return pp},Cne:function(){return s.Cne},XvJ:function(){return s.XvJ},XZw:function(){return s.XZw},FE5:function(){return s.FE5},lVp:function(){return oA},CJI:function(){return s.CJI},z$h:function(){return s.z$h},UlW:function(){return s.UlW},WwZ:function(){return s.WwZ},zG7:function(){return Nu},Lcc:function(){return s.Lcc},WXh:function(){return s.WXh},Vjr:function(){return z1},LuM:function(){return NE},LP5:function(){return HR},ub3:function(){return s.ub3},OV:function(){return ph},G_n:function(){return ad},xfE:function(){return s.xfE},qlB:function(){return s.qlB},lCJ:function(){return s.lCJ},WTc:function(){return s.WTc},rAo:function(){return s.rAo},LZj:function(){return Dh},xWb:function(){return s.xWb},gH0:function(){return s.gH0},rBU:function(){return s.rBU},rDY:function(){return s.rDY},ywz:function(){return s.ywz},wJv:function(){return s.wJv},JQ4:function(){return s.JQ4},k0A:function(){return s.k0A},irR:function(){return s.irR},LsT:function(){return s.LsT},q5h:function(){return R0},TKh:function(){return lv},tyg:function(){return hp},Ro5:function(){return Tr},dwk:function(){return s.dwk},t0w:function(){return bx},M7$:function(){return fb},ML4:function(){return Ax},FM8:function(){return s.FM8},Pa4:function(){return s.Pa4},Ltg:function(){return s.Ltg},yC1:function(){return s.yC1},lHq:function(){return Um},fO1:function(){return s.fO1},oMA:function(){return So},JzW:function(){return u},QEt:function(){return Yh},b5g:function(){return s.b5g},Ywn:function(){return s.Ywn},GVz:function(){return s.GVz},oAp:function(){return s.oAp},kFz:function(){return s.kFz},dd2:function(){return s.dd2},CP7:function(){return s.CP7},fQK:function(){return s.fQK},Wd$:function(){return cM},t1_:function(){return FS},v27:function(){return cm},Uk6:function(){return s.Uk6},H7Z:function(){return L0},_sL:function(){return s._sL},czO:function(){return Qp},Pnf:function(){return s.Pnf},c8b:function(){return s.c8b},_lf:function(){return s._lf},ad5:function(){return s.ad5},sZV:function(){return xb},TfA:function(){return C0},sKX:function(){return os},UdM:function(){return xd},P0y:function(){return kt},L_r:function(){return s.L_r},zC5:function(){return a.absMax},Bve:function(){return Jx},b5G:function(){return lf},UeO:function(){return Vc},qCx:function(){return cI},$nx:function(){return v1},Bk6:function(){return va},EER:function(){return $h},y4l:function(){return Xp},P39:function(){return Qv},HI1:function(){return a.aesGcmDecrypt},ZYi:function(){return a.aesGcmEncrypt},wXW:function(){return cn},r5x:function(){return zp},MSI:function(){return hi},EUu:function(){return GL},jtH:function(){return Yr},T0T:function(){return If},gAb:function(){return HE},je_:function(){return JR},wBP:function(){return Nm},LU2:function(){return e_},wQL:function(){return HL},Zs7:function(){return as},sMc:function(){return a.arrayBufferToBase64},x7s:function(){return dy},Mnd:function(){return QL},A0_:function(){return qL},d73:function(){return sr},HCD:function(){return At},YQ8:function(){return za},RG9:function(){return vt},G2P:function(){return Zg},XLf:function(){return G0},CGN:function(){return Ja},RGi:function(){return a.base64ToArrayBuffer},mvg:function(){return xs},Hiy:function(){return Gu},XMc:function(){return D_},N7M:function(){return wl},iv:function(){return $n},n55:function(){return a.blobToDataURL},IaC:function(){return ci},h9t:function(){return Em},yDW:function(){return Sm},gJv:function(){return wm},l$g:function(){return oC},vQi:function(){return VC},$MY:function(){return Wl},wJl:function(){return Is},Z7Y:function(){return xm},X7D:function(){return V0},BnX:function(){return Vh},uZ5:function(){return Mm},zVI:function(){return ds},Wz1:function(){return a.colorToDataUrl},DpF:function(){return mo},nNb:function(){return ie},cqZ:function(){return T},pKN:function(){return Lw},CN8:function(){return zh},DdI:function(){return L1},rrX:function(){return Nw},KlC:function(){return Yg},KVn:function(){return Ae},oau:function(){return Bs},aw9:function(){return Ht},Aap:function(){return Ma},Dxg:function(){return a.copyProps},MjT:function(){return Ln},F7Q:function(){return gl},IFq:function(){return $S},IJl:function(){return Kg},O5A:function(){return a.createCanvasElement},wCn:function(){return a.createDiv},gGT:function(){return Af},pEc:function(){return JT},Bi6:function(){return a.createImage},fi_:function(){return Wx},TT:function(){return mr},q2Z:function(){return BL},NyK:function(){return Zr},bgu:function(){return a.createScriptFromURL},kcS:function(){return a.createStyles},rRN:function(){return W1},ivY:function(){return a.css},_s1:function(){return rN},_HO:function(){return Ye},tpL:function(){return it},DMK:function(){return Mf},LjN:function(){return xc},iFs:function(){return tm},qTg:function(){return a.deepAccessObject},Zj8:function(){return jL},Wtl:function(){return Yc},DmK:function(){return Ph},Htt:function(){return nI},Hx7:function(){return Mi},imt:function(){return si},US6:function(){return Wo},vZs:function(){return Ep},TE$:function(){return XL},lmu:function(){return a.downloadBlob},SvO:function(){return a.downloadFile},YQY:function(){return bm},mZN:function(){return Jg},VvG:function(){return fA},omp:function(){return a.embedUrlRefs},utz:function(){return Pr},TFV:function(){return $c},hrz:function(){return a.escapeRegExp},JKM:function(){return fn},jZf:function(){return YS},RjL:function(){return BE},RRI:function(){return LA},RUq:function(){return sC},_t4:function(){return Wt},YHh:function(){return rn},R8g:function(){return $},f1L:function(){return a.getFileHandle},Bbl:function(){return a.getFilenameFromPath},V9r:function(){return a.getKeyByValue},a95:function(){return a.getNewFileHandle},PZ2:function(){return a.getOrCall},w7A:function(){return a.getPropertyDescriptor},N6S:function(){return pe},Uxp:function(){return he},tAz:function(){return Re},R$F:function(){return Ce},N33:function(){return we},JFD:function(){return ae},gw2:function(){return Ol},rfc:function(){return a.getTypedArray},wo6:function(){return a.getUrlQueryParam},V4T:function(){return $f},H4P:function(){return a.glsl},NLp:function(){return d_},swA:function(){return Fe},_Z3:function(){return Mt},ivc:function(){return ie},rZ1:function(){return T},CpZ:function(){return Hx},dyc:function(){return a.html},MxZ:function(){return a.htmlToCanvas},btp:function(){return a.htmlToPng},mXy:function(){return a.htmlToSvg},Ej0:function(){return Hl},ep4:function(){return nn},DQP:function(){return ja},VNr:function(){return Wn},V7q:function(){return a.imageBitmapToBase64},hiB:function(){return a.imageDataToCanvas},zEk:function(){return a.imageToCanvas},qfq:function(){return a.imageUrlToImageData},piB:function(){return a.includesAll},IIc:function(){return VL},rrF:function(){return cp},naq:function(){return Xu},sXR:function(){return no},p5I:function(){return Ip},wps:function(){return WE},wuo:function(){return JS},GpE:function(){return a.isPropertyWritable},F4b:function(){return qh},NN$:function(){return zm},t$v:function(){return $i},tdn:function(){return Pp},Y9t:function(){return _A},GEo:function(){return $g},GGm:function(){return a.longestCommonPrefix},DH3:function(){return qt},uxM:function(){return a.makeColorSvg},zH3:function(){return a.makeColorSvgCircle},MLs:function(){return No},xXG:function(){return $t},YM4:function(){return Ho},B3r:function(){return KS},iAx:function(){return a.makeTextSvg},lDn:function(){return Ze},oaQ:function(){return Rd},CD7:function(){return bf},Rc0:function(){return Iu},iPG:function(){return sh},TIc:function(){return a.mobileAndTabletCheck},xsC:function(){return Di},zOc:function(){return a.now},i8W:function(){return a.objectHasOwn},r46:function(){return vs},z2C:function(){return a.onChange},N4A:function(){return a.onChange2},hjq:function(){return a.onChange3},_X$:function(){return a.parseFileExtension},_yn:function(){return bo},Dyg:function(){return a.pathJoin},cUc:function(){return Va},zGw:function(){return l_},Ctq:function(){return Vd},$ch:function(){return YL},k5b:function(){return lu},kZl:function(){return vi},OCg:function(){return hr},Kd3:function(){return a.prettyScrollbar},YjH:function(){return jx},Ui8:function(){return TM},YD2:function(){return Mp},vi9:function(){return tI},ij3:function(){return Zh},pJq:function(){return a.readFile},YPW:function(){return Jn},_tY:function(){return a.remoteWorkerURL},Bg1:function(){return kL},kon:function(){return a.replaceAll},M3g:function(){return Am},F2z:function(){return Ii},pJF:function(){return rC},knz:function(){return s.knz},Ejo:function(){return a.safeSetProperty},BgY:function(){return jr},qCG:function(){return ze},HD9:function(){return di},Rgz:function(){return Xr},fEB:function(){return yi},Udc:function(){return Bo},ZQg:function(){return Oo},ofC:function(){return _t},yRy:function(){return a.setUrlQueryParam},_NL:function(){return lN},LCA:function(){return oa},Sy1:function(){return KR},Vs_:function(){return $R},j1w:function(){return ud},i8J:function(){return aN},p7C:function(){return ni},ZAS:function(){return Du},ipH:function(){return KL},$TF:function(){return rI},uZI:function(){return $L},VWG:function(){return Y},pQ7:function(){return km},STw:function(){return Gh},jc8:function(){return zc},BL_:function(){return yo},S6:function(){return sN},T8U:function(){return Pa},TD6:function(){return cl},akS:function(){return a.svgToCanvas},QKE:function(){return a.svgToPng},dKx:function(){return a.svgUrl},OvX:function(){return ZR},doP:function(){return Zn},$jA:function(){return Qn},T99:function(){return Nn},LJS:function(){return Qi},VsW:function(){return a.timeout},YMc:function(){return iI},aPg:function(){return ut},LFn:function(){return a.toTitleCase},wey:function(){return Bi},MaE:function(){return ht},s4x:function(){return Lt},FJA:function(){return ir},vIA:function(){return ct},Spv:function(){return on},w8l:function(){return dt},riG:function(){return Ke},Kbh:function(){return er},BFq:function(){return gn},t8K:function(){return Pe},Q7n:function(){return Yn},KGF:function(){return Le},e5:function(){return Ne},Rik:function(){return wb},GZo:function(){return Da},Bds:function(){return Xa},HTu:function(){return Yo},cTq:function(){return a.uploadFile},X_Y:function(){return Vu},dA8:function(){return xr},NSm:function(){return Xn},bwS:function(){return xl},Lks:function(){return JL},Rvq:function(){return eI},P4F:function(){return a.verifyPermission},Pd0:function(){return Vr},Pjo:function(){return Ss},Tum:function(){return pc},dRH:function(){return ko},RX0:function(){return jc},reQ:function(){return ZL},cWm:function(){return _i},NC9:function(){return a.writeFile},$Re:function(){return Zy},Xo9:function(){return Ku},LNO:function(){return gi},iZP:function(){return zi}}),function(l){l[l.Error=-2]="Error",l[l.Destroyed=-1]="Destroyed",l[l.None=0]="None",l[l.Running=1]="Running",l[l.Paused=2]="Paused"}(u||(u={}));var a=__webpackgi_require__(346),s=__webpackgi_require__(988);const v={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class x{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const M=new s.iKG(-1,1,1,-1,0,1),I=new s.u9r;I.setAttribute("position",new s.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),I.setAttribute("uv",new s.a$l([0,2,0,0,2,0],2));class B{constructor(e){this._mesh=new s.Kj0(I,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,M)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class U extends x{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof s.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=s.rDY.clone(e.uniforms),this.material=new s.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new B(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&n&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t||null),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class j extends x{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),o=e.state;let c,f;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(c=0,f=1):(c=1,f=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,c,4294967295),o.buffers.stencil.setClear(f),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}class te extends x{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Z{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new s.FM8);this._width=n.width,this._height=n.height,(t=new s.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new U(v),this.clock=new s.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,o=this.passes.length;i<o;i++){const c=this.passes[i];if(c.enabled!==!1){if(c.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),c.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),c.needsSwap){if(n){const f=this.renderer.getContext(),m=this.renderer.state.buffers.stencil;m.setFunc(f.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),m.setFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}j!==void 0&&(c instanceof j?n=!0:c instanceof te&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new s.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class oe extends Z{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}const le=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function se(){const l=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(le[255&l]+le[l>>8&255]+le[l>>16&255]+le[l>>24&255]+"-"+le[255&e]+le[e>>8&255]+"-"+le[e>>16&15|64]+le[e>>24&255]+"-"+le[63&t|128]+le[t>>8&255]+"-"+le[t>>16&255]+le[t>>24&255]+le[255&n]+le[n>>8&255]+le[n>>16&255]+le[n>>24&255]).toLowerCase()}function ve(l,e,t){return Math.max(e,Math.min(t,l))}function ce(l,e,t){return(1-t)*l+t*e}class K{constructor(e=0,t=0){K.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ve(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,c=this.y-e.y;return this.x=o*n-c*i+e.x,this.y=o*i+c*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class X extends s.ZzF{expandByObject(e,t=!1,n=!1){var o;if(((o=e.userData)==null?void 0:o.bboxVisible)===!1)return this;if(!e.visible&&n)return this;if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),W.copy(e.boundingBox),W.applyMatrix4(e.matrixWorld),this.union(W);else{const c=e.geometry;if(c!==void 0)if(t&&c.attributes!=null&&c.attributes.position!==void 0){const f=c.attributes.position;for(let m=0,y=f.count;m<y;m++)_e.fromBufferAttribute(f,m).applyMatrix4(e.matrixWorld),this.expandByPoint(_e)}else c.boundingBox===null&&c.computeBoundingBox(),W.copy(c.boundingBox),W.applyMatrix4(e.matrixWorld),this.union(W)}const i=e.children;for(let c=0,f=i.length;c<f;c++)this.expandByObject(i[c],t,n);return this}expandByObjects(e,t=!1,n=!1){for(let i=0,o=e.length;i<o;i++)this.expandByObject(e[i],t,n);return this}getPoints(){return[new s.Pa4(this.min.x,this.min.y,this.min.z),new s.Pa4(this.min.x,this.min.y,this.max.z),new s.Pa4(this.min.x,this.max.y,this.min.z),new s.Pa4(this.min.x,this.max.y,this.max.z),new s.Pa4(this.max.x,this.min.y,this.min.z),new s.Pa4(this.max.x,this.min.y,this.max.z),new s.Pa4(this.max.x,this.max.y,this.min.z),new s.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new s.TUj;for(const i of t){const o=i.project(e);n.min.min(o),n.max.max(o)}return n}}const W=new X,_e=new s.Pa4;function ge(l,e){if(e===s.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===s.z$h||e===s.UlW){let t=l.getIndex();if(t===null){const c=[],f=l.getAttribute("position");if(f===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l;for(let m=0;m<f.count;m++)c.push(m);l.setIndex(c),t=l.getIndex()}const n=t.count-2,i=[];if(e===s.z$h)for(let c=1;c<=n;c++)i.push(t.getX(0)),i.push(t.getX(c)),i.push(t.getX(c+1));else for(let c=0;c<n;c++)c%2==0?(i.push(t.getX(c)),i.push(t.getX(c+1)),i.push(t.getX(c+2))):(i.push(t.getX(c+2)),i.push(t.getX(c+1)),i.push(t.getX(c)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=l.clone();return o.setIndex(i),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}function Ae(l,e){let t,n;if(Array.isArray(l))for(const o of l){const c=Ae(o,e);t===void 0||n===void 0?(t=c.min.clone(),n=c.max.clone()):(t.min(c.min),n.max(c.max))}const i=l;if(i.geometry!==void 0){const o=i.geometry.vertices;if(o===void 0&&i.geometry.attributes!==void 0&&"position"in i.geometry.attributes){const c=new s.Pa4,f=i.geometry.attributes.position;for(let m=0;m<f.count*f.itemSize;m+=f.itemSize){c.set(f.array[m],f.array[m+1],f.array[3]);const y=c.applyMatrix4(l.matrixWorld).project(e),w=new K(y.x,y.y);t===void 0||n===void 0?(t=w.clone(),n=w.clone()):(t.min(w),n.max(w))}}else for(const c of o){const f=c.clone().applyMatrix4(l.matrixWorld).project(e),m=new K(f.x,f.y);t===void 0||n===void 0?(t=m.clone(),n=m.clone()):(t.min(m),n.max(m))}}if(l.children!==void 0)for(const o of l.children){const c=Ae(o,e);t===void 0||n===void 0?(t=c.min.clone(),n=c.max.clone()):(t.min(c.min),n.max(c.max))}return new s.TUj(t,n)}const ee="rgbm-16";function $(l){switch(l){case s.aCh:case s.GUF:return["Linear","( value )"];case s.KI_:return["sRGB","( value )"];case ee:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported colorSpace:",l),["Linear","( value )"]}}function ae(l,e){let t;return l&&l.isTexture?t=l.colorSpace:l&&l.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=l.texture.colorSpace):t=s.GUF,e&&l&&l.isTexture&&l.format===s.wk1&&l.type===s.ywz&&l.colorSpace===s.KI_&&(t=s.GUF),t}function Re(l,e){const t=$(e);return"vec4 "+l+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function pe(l,e,t){return Re(l+"TexelToLinear",ae(e,t))+`
`}function he(l,e){return Re(l+"TexelToLinear",e)+`
`}function we(l,e){const t=$(e);return"vec4 "+l+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Ce(l,e,t){return we(l,ae(e,t))}function Ne({uniforms:l,propKey:e,thisTarget:t=!1}={}){const n=!!l,i=!!e,o=t;return(c,f)=>{const m=y=>{const w=o?y:n?l:y.uniforms||y._uniforms;let S=i?e:f;o&&(S="_"+S);let C=w[S];return C||(C={value:null},w[S]=C),C};Object.defineProperty(c,f,{get(){return m(this).value},set(y){m(this).value=y,(0,a.safeSetProperty)(this,"uniformsNeedUpdate",!0,!0)}})}}function Ze(l,e,t=!1,n){const i=!!e,o=!!l;return(c,f)=>{const m=y=>({t:i?e:y.defines||y._defines,p:o?l:f});Object.defineProperty(c,f,{get(){const{t:y,p:w}=m(t?this:this.material);return y[w]},set(y){const{t:w,p:S}=m(t?this:this.material);if((0,a.safeSetProperty)(w,S,y,!0),typeof n=="function"){const C=[S,y];if(n.name){const O=this[n.name];O===n?n.call(this,...C):O.name===`bound ${n.name}`?O(...C):n(...C)}else n(...C)}else(0,a.safeSetProperty)(t?this:this.material,"needsUpdate",!0,!0)}})}}function Ye(l){const e=new s.IEO(new Uint8Array([Math.floor(255*l.r),Math.floor(255*l.g),Math.floor(255*l.b),255]),1,1,s.wk1,s.ywz);return e.needsUpdate=!0,e.colorSpace=s.aCh,e}function it(l){const e=new s.IEO(new Uint8Array([Math.floor(255*l.x),Math.floor(255*l.y),Math.floor(255*l.z),Math.floor(255*l.w)]),1,1,s.wk1,s.ywz);return e.needsUpdate=!0,e}function _t(l,e,t){const n=l.userData,{backgroundRender:i,transparentRender:o,shadowMapRender:c,mainRenderPass:f,opaqueRender:m,transmissionRender:y,sceneRender:w,screenSpaceRendering:S}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=i,n.transparentRender=o,n.shadowMapRender=c,n.mainRenderPass=f,n.opaqueRender=m,n.sceneRender=w,n.transmissionRender=y,n.screenSpaceRendering=S}function At(l){const e=new X().expandByObject(l,!0,!0).getCenter(new s.Pa4);l.position.sub(e),l.updateMatrix(),l.userData.autoCentered=!0,l.userData.isCentered=!0}function vt(l,e,t){const n=.5*new X().expandByObject(l,!0,!0).getSize(new s.Pa4).length();e===void 0&&(e=l.userData.autoScaleRadius||1);const i=e/n;return isFinite(i)&&(l.userData.pseudoCentered?l.children.forEach(o=>{o.scale.multiplyScalar(i)}):l.scale.multiplyScalar(i),(t||l.userData.isCentered)&&l.position.multiplyScalar(i),l.traverse(o=>{var c,f;o.isLight&&((f=(c=o.shadow)==null?void 0:c.camera)!=null&&f.right)&&(o.shadow.camera.right*=i,o.shadow.camera.left*=i,o.shadow.camera.top*=i,o.shadow.camera.bottom*=i),o.isCamera&&o.right&&(o.right*=i,o.left*=i,o.top*=i,o.bottom*=i)}),l.userData.autoScaled=!0,l.userData.autoScaleRadius=e,l.dispatchEvent({type:"objectUpdate"})),l}function ut(l,e=-1){return function(t,n=1e-4){const i=n>0;n=Math.max(n,Number.EPSILON);const o={},c=t.getIndex(),f=t.getAttribute("position"),m=c?c.count:f.count;let y=0;const w=Object.keys(t.attributes),S={},C={},O=[],N=["getX","getY","getZ","getW"],H=["setX","setY","setZ","setW"];for(let z=0,ue=w.length;z<ue;z++){const me=w[z],Te=t.attributes[me];S[me]=new s.TlE(new Te.array.constructor(Te.count*Te.itemSize),Te.itemSize,Te.normalized);const Be=t.morphAttributes[me];Be&&(C[me]=new s.TlE(new Be.array.constructor(Be.count*Be.itemSize),Be.itemSize,Be.normalized))}const q=Math.log10(1/n),J=Math.pow(10,q);for(let z=0;z<m;z++){const ue=c?c.getX(z):z;let me="";for(let Te=0,Be=w.length;Te<Be&&i;Te++){const He=w[Te],tt=t.getAttribute(He),lt=tt.itemSize;for(let at=0;at<lt;at++)me+=~~(tt[N[at]](ue)*J)+","}if(i&&me in o)O.push(o[me]);else{for(let Te=0,Be=w.length;Te<Be;Te++){const He=w[Te],tt=t.getAttribute(He),lt=t.morphAttributes[He],at=tt.itemSize,St=S[He],mt=C[He];for(let gt=0;gt<at;gt++){const Ot=N[gt],Bt=H[gt];if(St[Bt](y,tt[Ot](ue)),lt)for(let Ft=0,_n=lt.length;Ft<_n;Ft++)mt[Ft][Bt](y,lt[Ft][Ot](ue))}}i&&(o[me]=y),O.push(y),y++}}const V=t.clone();for(const z in t.attributes){const ue=S[z];if(V.setAttribute(z,new s.TlE(ue.array.slice(0,y*ue.itemSize),ue.itemSize,ue.normalized)),z in C)for(let me=0;me<C[z].length;me++){const Te=C[z][me];V.morphAttributes[z][me]=new s.TlE(Te.array.slice(0,y*Te.itemSize),Te.itemSize,Te.normalized)}}return V.setIndex(O),V}(l,e)}const Nt=2,Qt=3,Qe=0,ft=1,bt=3,sn=4,bn=1006,Un=3001,pi="srgb",Xe="srgb-linear",Xt="display-p3";class tn{constructor(){tn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,o,c,f,m,y){const w=this.elements;return w[0]=e,w[1]=i,w[2]=f,w[3]=t,w[4]=o,w[5]=m,w[6]=n,w[7]=c,w[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,c=n[0],f=n[3],m=n[6],y=n[1],w=n[4],S=n[7],C=n[2],O=n[5],N=n[8],H=i[0],q=i[3],J=i[6],V=i[1],z=i[4],ue=i[7],me=i[2],Te=i[5],Be=i[8];return o[0]=c*H+f*V+m*me,o[3]=c*q+f*z+m*Te,o[6]=c*J+f*ue+m*Be,o[1]=y*H+w*V+S*me,o[4]=y*q+w*z+S*Te,o[7]=y*J+w*ue+S*Be,o[2]=C*H+O*V+N*me,o[5]=C*q+O*z+N*Te,o[8]=C*J+O*ue+N*Be,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],c=e[4],f=e[5],m=e[6],y=e[7],w=e[8];return t*c*w-t*f*y-n*o*w+n*f*m+i*o*y-i*c*m}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],c=e[4],f=e[5],m=e[6],y=e[7],w=e[8],S=w*c-f*y,C=f*m-w*o,O=y*o-c*m,N=t*S+n*C+i*O;if(N===0)return this.set(0,0,0,0,0,0,0,0,0);const H=1/N;return e[0]=S*H,e[1]=(i*y-w*n)*H,e[2]=(f*n-i*c)*H,e[3]=C*H,e[4]=(w*t-i*m)*H,e[5]=(i*o-f*t)*H,e[6]=O*H,e[7]=(n*m-y*t)*H,e[8]=(c*t-n*o)*H,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,c,f){const m=Math.cos(o),y=Math.sin(o);return this.set(n*m,n*y,-n*(m*c+y*f)+c+e,-i*y,i*m,-i*(-y*c+m*f)+f+t,0,0,1),this}scale(e,t){return this.premultiply(dn.makeScale(e,t)),this}rotate(e){return this.premultiply(dn.makeRotation(-e)),this}translate(e,t){return this.premultiply(dn.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const dn=new tn;function pn(l){return l<.04045?.0773993808*l:Math.pow(.9478672986*l+.0521327014,2.4)}function Pn(l){return l<.0031308?12.92*l:1.055*Math.pow(l,.41666)-.055}const Cn=new tn().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),vn=new tn().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),In={[Xe]:l=>l,[pi]:l=>l.convertSRGBToLinear(),[Xt]:function(l){return l.convertSRGBToLinear().applyMatrix3(vn)}},Fn={[Xe]:l=>l,[pi]:l=>l.convertLinearToSRGB(),[Xt]:function(l){return l.applyMatrix3(Cn).convertLinearToSRGB()}},Hn={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(l){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!l},get workingColorSpace(){return Xe},set workingColorSpace(l){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(l,e,t){if(this.enabled===!1||e===t||!e||!t)return l;const n=In[e],i=Fn[t];if(n===void 0||i===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return i(n(l))},fromWorkingColorSpace:function(l,e){return this.convert(l,this.workingColorSpace,e)},toWorkingColorSpace:function(l,e){return this.convert(l,e,this.workingColorSpace)}},fe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Se={h:0,s:0,l:0},Ve={h:0,s:0,l:0};function We(l,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?l+6*(e-l)*t:t<.5?e:t<2/3?l+6*(e-l)*(2/3-t):l}class pt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=pi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Hn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Hn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Hn.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Hn.workingColorSpace){if(e=function(o,c){return(o%c+c)%c}(e,1),t=ve(t,0,1),n=ve(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,c=2*n-o;this.r=We(c,o,e+1/3),this.g=We(c,o,e),this.b=We(c,o,e-1/3)}return Hn.toWorkingColorSpace(this,i),this}setStyle(e,t=pi){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const c=i[1],f=i[2];switch(c){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],c=o.length;if(c===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(c===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=pi){const n=fe[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=pn(e.r),this.g=pn(e.g),this.b=pn(e.b),this}copyLinearToSRGB(e){return this.r=Pn(e.r),this.g=Pn(e.g),this.b=Pn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=pi){return Hn.fromWorkingColorSpace(It.copy(this),e),65536*Math.round(ve(255*It.r,0,255))+256*Math.round(ve(255*It.g,0,255))+Math.round(ve(255*It.b,0,255))}getHexString(e=pi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Hn.workingColorSpace){Hn.fromWorkingColorSpace(It.copy(this),t);const n=It.r,i=It.g,o=It.b,c=Math.max(n,i,o),f=Math.min(n,i,o);let m,y;const w=(f+c)/2;if(f===c)m=0,y=0;else{const S=c-f;switch(y=w<=.5?S/(c+f):S/(2-c-f),c){case n:m=(i-o)/S+(i<o?6:0);break;case i:m=(o-n)/S+2;break;case o:m=(n-i)/S+4}m/=6}return e.h=m,e.s=y,e.l=w,e}getRGB(e,t=Hn.workingColorSpace){return Hn.fromWorkingColorSpace(It.copy(this),t),e.r=It.r,e.g=It.g,e.b=It.b,e}getStyle(e=pi){Hn.fromWorkingColorSpace(It.copy(this),e);const t=It.r,n=It.g,i=It.b;return e!==pi?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Se),Se.h+=e,Se.s+=t,Se.l+=n,this.setHSL(Se.h,Se.s,Se.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Se),e.getHSL(Ve);const n=ce(Se.h,Ve.h,t),i=ce(Se.s,Ve.s,t),o=ce(Se.l,Ve.l,t);return this.setHSL(n,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*n+o[6]*i,this.g=o[1]*t+o[4]*n+o[7]*i,this.b=o[2]*t+o[5]*n+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const It=new pt;function $t(l,e){return{type:"folder",label:e+" Sampler",hidden:()=>!l[e],children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[l[e],"repeat"],onChange:l==null?void 0:l.setDirty}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[l[e],"offset"],onChange:l==null?void 0:l.setDirty}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[l[e],"center"],onChange:l==null?void 0:l.setDirty}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[l[e],"rotation"],onChange:l==null?void 0:l.setDirty}),()=>({type:"dropdown",label:"Color Space",property:[l[e],"colorSpace"],children:[["Linear",s.GUF],["sRGB",s.KI_]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{const t=l[e];t&&(t.needsUpdate=!0)},l==null?void 0:l.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var t;return((t=l[e])==null?void 0:t.flipY)??!1},setValue:t=>{var i;const n=l[e];if(n&&n.flipY!==t)if(n.image&&ImageBitmap&&n.image instanceof ImageBitmap){const o=n,c=n.source.data;createImageBitmap(c,{imageOrientation:"flipY"}).then(f=>{var m;c.close&&c.close(),o.flipY=t,o.source.data=f,o.source.needsUpdate=!0,o.needsUpdate=!0,(m=l==null?void 0:l.setDirty)==null||m.call(l)})}else n.flipY=t,n.needsUpdate=!0,(i=l==null?void 0:l.setDirty)==null||i.call(l)}}),()=>({type:"dropdown",label:"Wrap S",property:[l[e],"wrapS"],children:[["ClampToEdge",s.uWy],["MirroredRepeat",s.OoA],["Repeat",s.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{l[e]&&(l[e].needsUpdate=!0)},l==null?void 0:l.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[l[e],"wrapT"],children:[["ClampToEdge",s.uWy],["MirroredRepeat",s.OoA],["Repeat",s.rpg]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{l[e]&&(l[e].needsUpdate=!0)},l==null?void 0:l.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[l[e],"anisotropy"],onChange:[()=>{l[e]&&(l[e].needsUpdate=!0),l.needsUpdate=!0},l==null?void 0:l.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[l[e],"minFilter"],children:[["Linear",bn],["Nearest",s.TyD],["NearestMipmapNearest",s.YLQ],["NearestMipmapLinear",s.vZf],["LinearMipmapNearest",s.qyh],["LinearMipmapLinear",s.D1R]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{l[e]&&(l[e].needsUpdate=!0)},l==null?void 0:l.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[l[e],"magFilter"],children:[["Linear",bn],["Nearest",s.TyD]].map(t=>({label:t[0],value:t[1]})),onChange:[()=>{l[e]&&(l[e].needsUpdate=!0)},l==null?void 0:l.setDirty]})]}}pt.NAMES=fe;const nn=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Ht(l,e,t=!0){if(!e)return l;for(const n of Object.keys(e)){if(t&&nn.includes(n)||n.startsWith("__"))continue;const i=e[n];if(typeof l[n]=="function"||typeof i=="function")continue;const o=!i||i.isTexture||i.isObject3D||i.isMaterial;o||typeof i.clone!="function"?o||typeof i!="object"&&!Array.isArray(i)?l[n]=i:l[n]=Ht(Array.isArray(i)?[]:{},i,!1):l[n]=i.clone()}return l}const Wn=["appliedMaterials","uuid"];function Ln(l,e){if(e)for(const t of Object.keys(e))Wn.includes(t)||t.startsWith("__")||typeof l[t]!="function"&&typeof e[t]!="function"&&(l[t]=e[t]);return l}function Qn(l,e,t){const n=(t==null?void 0:t.data)??new Uint8ClampedArray(l.height*l.width*4),i=l.data instanceof Float32Array,o=l.data instanceof Uint16Array;for(let c=0;c<n.length;c++)n[c]=i?255*l.data[c]:o?255*s.A5E.fromHalfFloat(l.data[c]):l.data[c],e===s.GUF&&(n[c]=255*(0,a.LinearToSRGB)(n[c]/255));return t??new ImageData(n,l.width,l.height)}function Nn(l,e,t=!1){let n;return n=l.isDataTexture?Qn(l.image,l.colorSpace):l.image,Zn(n,e,t)}function Zn(l,e,t=!1){const n=document.createElement("canvas");n.width=Math.min(e,l.width),n.height=Math.floor(1+n.width*l.height/l.width);const i=n.getContext("2d");if(!i)return console.error("textureToDataUrl: could not get canvas context"),n;t===!0&&(i.translate(0,n.height),i.scale(1,-1));let o=!1;if(l.data!==void 0){const c=l;if(l.width!==n.width||l.height!==n.height){const f=document.createElement("canvas");f.width=l.width,f.height=l.height;const m=f.getContext("2d");m?(m.putImageData(c,0,0),i.drawImage(f,0,0,n.width,n.height)):(console.error("textureToDataUrl: could not get temp canvas context"),i.putImageData(c,0,0))}else i.putImageData(c,0,0),t&&(o=!0)}else i.drawImage(l,0,0,n.width,n.height);return o?(0,a.canvasFlipY)(n):n}function Qi(l,e,t,n,i){return Nn(l,e,t).toDataURL(n,i)}String.prototype.replaceAll||(String.prototype.replaceAll=function(l,e){return Object.prototype.toString.call(l).toLowerCase()==="[object regexp]"?this.replace(l,e):this.replace(new RegExp(l,"g"),e)});const Mr=new Map;function ze(l){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");Mr.has(n)||Mr.set(n,[]),Mr.get(n).push([l||t,t])}}const yi={obj:(l,e)=>Object.fromEntries(Object.entries(l).map(([t,n])=>[t,di(n,!1,e)])),vec4:l=>({x:l.x,y:l.y,z:l.z,w:l.w,isVector4:!0}),vec3:l=>({x:l.x,y:l.y,z:l.z,isVector3:!0}),vec2:l=>({x:l.x,y:l.y,isVector2:!0}),color:l=>({r:l.r,g:l.g,b:l.b,isColor:!0}),quat:l=>({x:l.x,y:l.y,z:l.z,w:l.w,isQuaternion:!0}),texture:(l,e)=>{var f;if(!(l!=null&&l.isTexture))throw new Error("Expected a texture");if(e!=null&&e.textures[l.uuid])return{uuid:l.uuid,resource:"textures"};if(l.isRenderTargetTexture&&!((f=l.userData)!=null&&f.serializableRenderTarget))return;const t=l.source.data,n=!l.isRenderTargetTexture&&l.userData.rootPath;n&&l.source.data&&(l.userData.__embedUrlImagePreviews?l.source.data=Nn(l,16,l.flipY):l.source.data=null);const i=l.userData;l.userData={};const o={images:{}};let c=l.toJSON(e||o);return!e&&c.image&&(c.image=n&&!l.userData.__embedUrlImagePreviews?void 0:o.images[c.image]),l.userData=i,c.userData=di(Ln({},i),!1,e),n&&(e&&!l.userData.__embedUrlImagePreviews&&delete e.images[l.source.uuid],l.source.data=t),e!=null&&e.textures&&!c.resource&&(e.textures[c.uuid]||(e.textures[c.uuid]=c),c={uuid:c.uuid,resource:"textures"}),c},material:(l,e)=>{if(!(l!=null&&l.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[l.uuid])return{uuid:l.uuid,resource:"materials"};l.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const t=e??{textures:{},images:{}},n={},i={};for(const[c,f]of Object.entries(l))if(f!=null&&f.isTexture&&!c.startsWith("__")){const m=yi.texture(f,t);n[c]=m,i[c]=f,l[c]=m?{isTexture:!0,toJSON:()=>m}:null}let o=l.toJSON(e);for(const[c,f]of Object.entries(i))l[c]=f,delete i[c];if(e){for(const[c,f]of Object.entries(n))f&&(o[c]=f);e!=null&&e.materials&&(e.materials[o.uuid]||(e.materials[o.uuid]=o),o={uuid:o.uuid,resource:"materials"})}else{for(const[c,f]of Object.entries(n))f&&(o[c]=f.uuid);o.textures=Object.values(t.textures),o.images=Object.values(t.images)}return o}},On=l=>(e,t)=>{var n;return((n=t==null?void 0:t.copy)==null?void 0:n.call(t,e))??new l().copy(e)},si={obj:(l,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(l).map(([n,i])=>[n,Mi(i,e==null?void 0:e[n],!1,t)]))),vec4:On(s.Ltg),vec3:On(s.Pa4),vec2:On(K),color:On(pt),quat:On(s._fP)};function di(l,e,t){var o;if(typeof l=="function")return;if(Array.isArray(l))return l.map(c=>di(c,!1,t));if(typeof l!="object"){if(typeof l=="number"){if(l===1/0)return"Infinity";if(l===-1/0)return"-Infinity";if(isNaN(l))return"NaN"}return l}if(!l)return l;let n=l.constructor??Object;if(n===Object)return yi.obj(l,t);if(l.isVector2)return yi.vec2(l);if(l.isVector3)return yi.vec3(l);if(l.isVector4)return yi.vec4(l);if(l.isColor)return yi.color(l);if(l.isQuaternion)return yi.quat(l);if(l.isTexture)return yi.texture(l,t);if(l.isMaterial)return yi.material(l,t);if(!e&&typeof l.toJSON=="function"){const c=l.toJSON(t);return l.serializableClassId&&c&&(c.serializableClassId=l.serializableClassId),c}const i={};for(;n&&n!==Object;)(o=Mr.get(n))==null||o.forEach(([c,f])=>{const m=l[f];i[c]=di(m,!1,t)}),n=Object.getPrototypeOf(n);return l.serializableClassId&&(i.serializableClassId=l.serializableClassId),i}function Mi(l,e,t,n){var f,m;let i=e;if(l===void 0)return i;if(typeof e=="number"){if(l==="Infinity")return 1/0;if(l==="-Infinity")return-1/0;if(l==="NaN")return NaN;if(typeof l=="number"||!l)return l}if(Array.isArray(l)){const y=l.length;Array.isArray(i)||(i=[]);for(let w=0;w<y;w++){const S=l[w],C=i.length>w?Mi(S,i[w],!1,n):Mi(S,void 0,!1,n);i.length<=w?i.push(C):i[w]=C}return i}let o=!1;if(l&&l.resource&&typeof l.resource=="string"&&(l=(f=n[l.resource])==null?void 0:f[l.uuid],o=!0),!i&&l&&!o)if(l.serializableClassId){const y=is.get(l.serializableClassId);y&&(i=y.DataInConstructor?new y(l):new y)}else typeof l!="object"||l.constructor&&l.constructor!==Object||(i={});if(typeof i=="function")return console.error("cannot deserialize over function",i,l),i;if(l&&typeof l=="object"&&!o){if(l.isVector2)return si.vec2(l,i);if(l.isVector3)return si.vec3(l,i);if(l.isVector4)return si.vec4(l,i);if(l.isColor)return si.color(l,i);if(l.isQuaternion)return si.quat(l,i)}if(l==null||i==null||typeof i!="object"||i.isTexture)return o&&(l?l.__useCount=l.__useCount?l.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),l;let c=i.constructor??Object;if(c===Object)return si.obj(l,i,n);if(!t&&typeof i.fromJSON=="function")return i.isMaterial&&(Object.entries(l).forEach(([y,w])=>{var C;if(!w||!w.resource||typeof w.resource!="string")return;const S=(C=n[w.resource])==null?void 0:C[w.uuid];l[y]=S||null}),l.userData&&(l.userData=Mi(l.userData,void 0,!1,n))),i.fromJSON(l,n),i;for(;c&&c!==Object;)(m=Mr.get(c))==null||m.forEach(([y,w])=>{const S=i[w],C=Mi(l[y],S,!1,n);C!==S&&(0,a.safeSetProperty)(i,w,C,!0)}),c=Object.getPrototypeOf(c);return i}const is=new Map;function jr(l){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=l}},is.set(l,e),e)}function Xr(l,e,t,n){var c,f,m;if(e!=null&&e.extras[l.uuid])return{uuid:l.uuid,resource:"extras"};let i="";if((c=l.source)!=null&&c._sourceImgBuffer||l.userData.__sourceBuffer){const y=new Uint8Array(((f=l.source)==null?void 0:f._sourceImgBuffer)||l.userData.__sourceBuffer),w=n||l.userData.mimeType||"";i={data:Array.from(y),type:y.constructor.name,path:((m=l.userData.__sourceBlob)==null?void 0:m.name)||l.userData.rootPath||"file."+w.split("/")[1]},w&&(i.mimeType=w)}else l.userData.rootPath?i=l.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const o={uuid:l.uuid,url:i,userData:Ln({},l.userData),type:l.type,name:t||l.name};return e!=null&&e.extras?(e.extras[l.uuid]=o,{uuid:l.uuid,resource:"extras"}):o}var cs=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let ys=class extends a.SimpleEventDispatcher{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(l){l!==this._displayCanvasScaling&&(this._displayCanvasScaling=l,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(l){this._pipeline=l,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){const l=this._passes,e=[],t={};for(const n of l){if(n.enabled===!1)continue;const i={after:n.after??[],before:n.before??[],dependencies:new Set(n.required??[])};t[n.passId]=i}for(const[n,i]of Object.entries(t)){const o=new Set([...i.after,...i.before]);i.dependencies.forEach(c=>o.has(c)&&o.delete(c)),o.forEach(c=>{const f=t[c];if(f){if(f.dependencies.has(n))throw console.error("cyclic",n,c),"Cyclic dependency";i.dependencies.add(c)}})}for(;;){let n=!1;const i=[...Object.entries(t)];for(const[o,c]of i)if(!e.includes(o)&&(0,a.includesAll)(e,c.dependencies.values())){const f=Math.max(-1,...c.after.map(y=>e.indexOf(y))),m=Math.min(e.length,...c.before.map(y=>{const w=e.indexOf(y);return w<0?e.length:w}));if(f>=m)throw console.error(c,l,e,f,m),"Not possible";e.splice(c.after.length>0?f+1:m,0,o),n=!0,delete t[o]}if(Object.keys(t).length<1)break;if(!n)throw console.error(i,t,e),"Not possible 2"}return this.pipeline=e,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(l,e){const t=l-this._lastTime;this._lastTime=l,this.frameWaitTime-=t,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:t,time:l,renderer:this,xrFrame:e}))}get clock(){return this._composer.clock}registerPass(l,e=!0){var t;if(e)for(const n of[...this._passes])l.passId===n.passId&&this.unregisterPass(n);this._passes.push(l),(t=l.onRegister)==null||t.call(l,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(l){var t;const e=this._passes.indexOf(l);e>=0&&((t=l.onUnregister)==null||t.call(l,this),this._passes.splice(e,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:l,canvas:e,alpha:t=!0,targetOptions:n}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new s.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new s.CP7({canvas:e,antialias:!1,alpha:t,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.useLegacyLights=!1,this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderer.onContextLost=i=>{this.dispatchEvent({type:"contextLost",event:i})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new s.FM8(e.clientWidth,e.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=s.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputColorSpace=s.aCh,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=s._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(n,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new oe(this._renderer,this._composerTarget),l&&this.addEventListener("animationLoop",l)}setSize(l,e,t=!1){!t&&(l?Math.abs(l-this._renderSize.width):0)+(e?Math.abs(e-this._renderSize.height):0)<.1||(l&&(this._renderSize.width=l),e&&(this._renderSize.height=e),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(n=>{const i=n,o=i.sizeMultiplier;if(o){const c=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*o);i.setSize(Math.floor(c.width),Math.floor(c.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(l,e,{viewport:t,material:n,shader:i,pass:o,clear:c=!0}={}){const f=this._composer.copyPass,{renderToScreen:m,material:y,uniforms:w,clear:S}=f;n&&(f.material=n);const C=this._renderer.getViewport(new s.Ltg),O=this._renderer.autoClear,N=this._renderer.getRenderTarget();t&&this._renderer.setViewport(new s.Ltg().fromArray(t)),this._renderer.autoClear=!1,f.uniforms=f.material.uniforms,f.renderToScreen=!1,f.clear=c,_t(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{f.render(this._renderer,e??null,{texture:l},0,!1)}),f.renderToScreen=m,f.clear=S,f.material=y,f.uniforms=w,this._renderer.autoClear=O,t&&this._renderer.setViewport(C),this._renderer.setRenderTarget(N)}clearColor({r:l,g:e,b:t,a:n,target:i,depth:o=!0,stencil:c=!0}){const f=this._renderer.getClearColor(new s.Ilk),m=this._renderer.getClearAlpha();this._renderer.setClearAlpha(n??m),this._renderer.setClearColor(new s.Ilk(l??f.r,e??f.g,t??f.b));const y=this._renderer.getRenderTarget(),w=this._renderer.getActiveCubeFace(),S=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget(i??null),this._renderer.clear(!0,o,c),this._renderer.setRenderTarget(y,w,S),this._renderer.setClearColor(f),this._renderer.setClearAlpha(m)}renderModel(l,e){this._renderer.render(l.modelObject,e.cameraObject)}renderScene(l){const e=l.activeCamera;e&&this.renderModel(l,e)}_updated(){this.dispatchEvent({type:"update"})}render(){var l;this._passesNeedsUpdate&&this.refreshPasses();for(const e of this._passes)e.passObject.enabled&&((l=e.update)==null||l.call(e));this._composer.render(),this._frameCount+=1,this._totalFrameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(l=>l.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const l=[];for(const e of this._pipeline){const t=this._passes.find(n=>n.passId===e);t?l.push(t.passObject):console.warn("Unable to find pass: ",e)}[...this._composer.passes].forEach(e=>this._composer.removePass(e)),l.forEach(e=>this._composer.addPass(e)),this._updated()}dispose(){this._trackedTargets.forEach(l=>l.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(l){this._trackedTargets.push(l)}removeTrackedTarget(l){const e=this._trackedTargets.indexOf(l);e>=0&&this._trackedTargets.splice(e,1)}createTarget({sizeMultiplier:l,samples:e=0,colorSpace:t=s.aCh,type:n=s.ywz,format:i=s.wk1,depthBuffer:o=!0,depthTexture:c=!1,size:f,textureCount:m=1,...y}={},w=!0){this.isWebGL2||(e=0),l!==void 0&&f!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(f=f||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(l=l||1))).width=Math.floor(f.width),f.height=Math.floor(f.height);const S=c?new s.$YQ(f.width,f.height,s.ywz):void 0,C=this.createTargetCustom(m>1?{width:f.width,height:f.height,count:m}:f,{samples:e,colorSpace:t,type:n,format:i,depthBuffer:o,depthTexture:S},m>1?s.kFz:s.dd2);return this._processNewTarget(C,l,w),this._setTargetOptions(C,y),C}_processNewTarget(l,e,t){return e!==void 0&&(l.sizeMultiplier=e),t&&this.trackTarget(l),l}disposeTarget(l){if(l){if(l.isTemporary)return this.releaseTempTarget(l);this.removeTrackedTarget(l),l.dispose()}}createTargetCustom({width:l,height:e,count:t},n={},i){const o=this._processNewTarget,c=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let f=[l,e];if(t&&t>1&&f.push(t),(i==null?void 0:i.prototype)===s.oAp.prototype){if(l!==e)throw"Width and height of cube render target must be equal";f=[l]}n={format:s.wk1,minFilter:s.wem,magFilter:s.wem,generateMipmaps:!1,type:s.ywz,colorSpace:s.aCh,...n};const m=[this,...f,n];return new class extends(i??s.dd2){constructor(y,...w){super(...w),this.renderer=y,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(S=>{S.colorSpace=n.colorSpace,S.toJSON=()=>(console.warn("Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(S){console.warn("Render target texture.toJSON might be buggy."),this.source.data.url=c(this.__target,"image/png",90);const C=this.__toJSON.call(this,S);return delete this.source.data.url,C.isRenderTargetTexture=!0,C})}setSize(y,w,S){super.setSize(Math.floor(y),Math.floor(w),S)}clone(y=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const w=super.clone();return w.texture.isRenderTargetTexture=!0,o(w,this.sizeMultiplier||1,y)}}(...m)}getTempTarget(l={}){var n;const e=Zr(l);let t;return(n=this._tempTargets[e])!=null&&n.length&&(t=this._tempTargets[e].pop()),t?this._setTargetOptions(t,l):(t=this.createTarget(l),this._processNewTempTarget(t,e)),t}_processNewTempTarget(l,e){return l.isTemporary=!0,l.targetKey=e,this._tempTargets[e]===void 0&&(this._tempTargets[e]=[]),l}releaseTempTarget(l){const e=l.targetKey;if(!e||!l.isTemporary)throw"Not a temp target";this._tempTargets[e].length>this.maxTempPerKey?l.dispose():this._tempTargets[e].push(l)}updateShaderProperties(l){return this.stableNoise?l.uniforms.frameCount?l.uniforms.frameCount.value=this._totalFrameCount:console.warn("BaseRenderer: no uniform: frameCount"):l.uniforms.frameCount?l.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),l.uniforms.frameCount2&&(l.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(l,e){l.texture.minFilter=e.minFilter??s.wem,l.texture.magFilter=e.magFilter??s.wem,l.texture.generateMipmaps=e.generateMipmaps??!1,l.texture.generateMipmaps&&l.texture.minFilter===s.wem&&(l.texture.minFilter=s.FDw),l.texture.generateMipmaps||l.texture.minFilter!==s.FDw||(l.texture.minFilter=s.wem)}renderTargetToDataUrl(l,e="image/png",t=90){const n=document.createElement("canvas");n.width=l.width,n.height=l.height;const i=n.getContext("2d");if(!i)throw new Error("Unable to get 2d context");const o=i.createImageData(l.width,l.height,{colorSpace:["display-p3","srgb"].includes(l.texture.colorSpace)?l.texture.colorSpace:void 0});if(l.texture.type===s.cLu){const f=new Uint16Array(l.width*l.height*4);this._renderer.readRenderTargetPixels(l,0,0,l.width,l.height,f),Qn({data:f,width:l.width,height:l.height},l.texture.colorSpace,o)}else if(l.texture.type===s.VzW){const f=new Float32Array(l.width*l.height*4);this._renderer.readRenderTargetPixels(l,0,0,l.width,l.height,f),Qn({data:f,width:l.width,height:l.height},l.texture.colorSpace,o)}else this._renderer.readRenderTargetPixels(l,0,0,l.width,l.height,o.data);i.putImageData(o,0,0);const c=n.toDataURL(e,t);return n.remove(),c}renderTargetToBuffer(l){const e=l.texture.type===s.cLu?new Uint16Array(l.width*l.height*4):new Uint8Array(l.width*l.height*4);return this._renderer.readRenderTargetPixels(l,0,0,l.width,l.height,e),e}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(l){this.rendererObject.useLegacyLights=l,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(l){console.warn("useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=l}get renderScale(){return this.displayCanvasScaling}set renderScale(l){this.displayCanvasScaling=l}};function Zr(l={}){var e,t;return[l.sizeMultiplier,l.samples,l.colorSpace,l.type,l.format,l.depthBuffer,l.depthTexture,(e=l.size)==null?void 0:e.width,(t=l.size)==null?void 0:t.height].join(";")}function za(l){var o,c,f,m,y,w,S,C,O;if(!l.isMaterial&&!l.isBufferGeometry)return;const e=Array.from(l.userData.__appliedMeshes).filter(N=>!N.isInstancedMesh&&!!N.parent&&N.children.length===0&&!Array.isArray(N.material));if(e.length<2)return;const t=new Map;for(const N of e){const H=(n=N).parent.uuid+"_"+n.geometry.uuid+"_"+((o=n.material)==null?void 0:o.uuid);t.has(H)||t.set(H,[]),t.get(H).push(N),N.updateMatrix()}var n;const i=t.keys();for(const N of i){const H=t.get(N),q=H[0];if(!q||H.length<2)continue;const J=new s.SPe(q.geometry,q.material,H.length),V=q.userData;q.userData={},J.copy(q),Ma(J.userData,V);const z=q.parent;J.position.set(0,0,0),J.rotation.set(0,0,0),J.scale.set(1,1,1),J.updateMatrix();const ue=new Float32Array(3*J.count),me=new Float32Array(4*J.count),Te=new Float32Array(3*J.count);for(let Be=0;Be<H.length;Be++){const He=H[Be],tt=He.matrix;tt.determinant()<0&&(tt.elements[0]*=-1,tt.elements[1]*=-1,tt.elements[2]*=-1),J.setMatrixAt(Be,tt),He.position.toArray(ue,3*Be),He.quaternion.toArray(me,4*Be),He.scale.toArray(Te,3*Be),He.removeFromParent(),(m=(f=(c=He.material)==null?void 0:c.userData)==null?void 0:f.__appliedMeshes)==null||m.delete(He),(S=(w=(y=He.geometry)==null?void 0:y.userData)==null?void 0:w.__appliedMeshes)==null||S.delete(He)}(O=(C=J.material.userData)==null?void 0:C.__appliedMeshes)==null||O.add(J),J.geometry.userData.__appliedMeshes.add(J),J.sourceTrs={TRANSLATION:new s.TlE(ue,3),ROTATION:new s.TlE(me,4),SCALE:new s.TlE(Te,3)},J.instanceMatrix.needsUpdate=!0,z.add(J),z.setDirty()}}cs([ze()],ys.prototype,"stableNoise",void 0),cs([ze()],ys.prototype,"useLegacyLights",null),ys=cs([jr("RenderManager")],ys);class uo{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const n=this.writer,i=e;let o=i.sourceTrs;if(!o){const c=new Float32Array(3*i.count),f=new Float32Array(4*i.count),m=new Float32Array(3*i.count),y=new s.yGw,w=new s.Pa4,S=new s._fP,C=new s.Pa4;for(let O=0;O<i.count;O++)i.getMatrixAt(O,y),y.decompose(w,S,C),w.toArray(c,3*O),S.toArray(f,4*O),C.toArray(m,3*O);o={TRANSLATION:new s.TlE(c,3),ROTATION:new s.TlE(f,4),SCALE:new s.TlE(m,3)}}o={TRANSLATION:n.processAccessor(o.TRANSLATION),ROTATION:n.processAccessor(o.ROTATION),SCALE:n.processAccessor(o.SCALE)},i.instanceColor&&(o.COLOR=n.processAccessor(new s.TlE(i.instanceColor.array,3))),n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0,t.extensions=t.extensions||{},t.extensions[this.name]={attributes:o}}}function sa(l,e){if(l.uiConfig)return l.uiConfig;const t={type:"folder",label:()=>l.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[l,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{l.dispatchEvent({type:"select",ui:!0,value:l,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!l.parent,value:()=>{const o=l.parent;o&&o.dispatchEvent({type:"select",ui:!0,value:o})}},{type:"input",label:"Name",property:[l,"name"],onChange:o=>{var c;o.last&&((c=l.setDirty)==null||c.call(l,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!l.isMesh,property:[l,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!l.isMesh,property:[l,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[l,"frustumCulled"]},{type:"vec3",label:"Position",property:[l,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[l,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[l,"scale"]},{type:"input",label:"Render Order",property:[l,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",l.userData.autoScaleRadius||"2",!0],value:o=>{if(!o)return;const c=parseFloat(o);Math.abs(c)>0&&vt(l,c)}},{type:"button",label:"Auto Center",value:()=>{confirm("Auto Center: Object will be centered, are you sure you want to proceed?")&&At(l)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(o=>({type:"button",label:"Rotate "+o+"90",value:()=>{var c;l.rotateOnAxis(new s.Pa4(o.includes("X")?1:0,o.includes("Y")?1:0,o.includes("Z")?1:0),Math.PI/2*(o.includes("-")?-1:1)),(c=l.setDirty)==null||c.call(l,{sceneUpdate:!0,refreshUi:!1})}}))},l.userData.license!==void 0?{type:"input",label:"License/Credits",property:[l.userData,"license"],limitedUi:!0}:{}]},n=l;if(n!=null&&n.isMesh&&e!==!1){const o=[()=>{const c=Object.entries(n.morphTargetDictionary||{});return c.length?{label:"Morph Targets",type:"folder",children:c.map(([f,m])=>({type:"slider",label:f,bounds:[0,1],stepSize:1e-4,property:[n.morphTargetInfluences,m],onChange:y=>{var w;(w=l.setDirty)==null||w.call(l,{sceneUpdate:y.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var c;return(c=n.geometry)==null?void 0:c.uiConfig},()=>{var c;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(f=>f==null?void 0:f.uiConfig).filter(f=>f)}:(c=n.material)==null?void 0:c.uiConfig}];t.children.push(...o)}const i=l;if(i!=null&&i.isCamera){const o=[{type:"button",label:"Set View",value:()=>{var c;l.dispatchEvent({type:"setView",ui:!0,camera:l}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var c;return(c=l.userData.iCamera)==null?void 0:c.isActiveCamera},value:()=>{var c;l.dispatchEvent({type:"activateMain",ui:!0,camera:l}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var c;return!((c=l.userData.iCamera)!=null&&c.isActiveCamera)},value:()=>{var c;l.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>l.userData.autoLookAtTarget??!1,setValue:c=>{var f;l.userData.autoLookAtTarget=c,(f=t.uiRefresh)==null||f.call(t,"postFrame",!0)}}];t.children.push(...o)}return l.uiConfig=t,t}function oa(l,e,t){if(!l)return void console.warn("setupIModel: object is undefined");if(l.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",l),delete l.__disposed),l.userData||(l.userData={}),l.userData.__iModelSetup&&l.modelObject)return l;l.userData.__iModelSetup=!0;let n=[];n.push(()=>{[...l.children].forEach(w=>{var S;(S=w==null?void 0:w.dispose)==null||S.call(w),l.add(w)}),l.parent&&l.removeFromParent()}),l.isLight&&!l.assetType?(l.assetType="light",l.lightObject=l):l.isCamera?(l.assetType="camera",l.cameraObject=l):l.assetType||(l.assetType="model"),l.modelObject||(l.modelObject=l),l.setDirty||(l.setDirty=(w={})=>{l.dispatchEvent({...w,type:"objectUpdate",object:l})},l.userData.setDirty&&console.warn("userData.setDirty already defined",l.userData.setDirty,l),l.userData.setDirty=w=>{var S;console.warn("userData.setDirty is deprecated, use setDirty directly"),(S=l.setDirty)==null||S.call(l,w)}),l.addEventListener("added",w=>{var C,O;const S=((C=l.parent)==null?void 0:C.userData.parentRoot)??l.parent;S!==l.userData.parentRoot&&l.traverse(N=>{N.userData.parentRoot=S}),(O=l.setDirty)==null||O.call(l,{change:"addedToParent"})}),l.addEventListener("removed",()=>{var w;(w=l.setDirty)==null||w.call(l,{change:"removedFromParent"}),l.userData.parentRoot!==void 0&&l.traverse(S=>{S.userData.parentRoot=void 0})}),n.push(()=>{});const i=l.dispose;l.dispose=()=>{l.dispatchEvent({type:"dispose"}),i==null||i.call(l)},l.userData.dispose&&console.warn("userData.dispose already defined"),l.userData.dispose=()=>{var w;console.warn("userData.dispose is deprecated, use dispose directly"),(w=l.dispose)==null||w.call(l)};const o=l;!o.isMesh&&!o.isLine||o.userData.__meshSetup||(o.userData.__meshSetup=!0,o.setMaterial||(o.setMaterial=w=>Oo(o,w)),o.setGeometry||(o.setGeometry=(w,S=!1)=>Bo(o,w,S),o.setGeometry(o.geometry,!0)),l.userData.setMaterial&&console.warn("userData.setMaterial already defined"),l.userData.setMaterial=w=>{var S;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(S=l.setMaterial)==null||S.call(l,w)},l.userData.setGeometry&&console.warn("userData.setGeometry already defined"),l.userData.setGeometry=(w,...S)=>{var C;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(C=l.setGeometry)==null||C.call(l,w,...S)},l.userData.__keepShadowDef||(l.castShadow=!0,l.receiveShadow=!0,l.userData.__keepShadowDef=!0),n.push(()=>{var C,O,N,H,q,J;const w=((C=o.setMaterial)==null?void 0:C.call(o,void 0))||[],S=(O=o.setGeometry)==null?void 0:O.call(o,void 0);for(const V of w)V&&V.userData&&((N=V.userData.__appliedMeshes)==null?void 0:N.size)===0&&V.userData.disposeOnIdle!==!1&&V.dispose();S&&S.userData&&((H=S.userData.__appliedMeshes)==null?void 0:H.size)===0&&S.userData.disposeOnIdle!==!1&&S.dispose(),(q=o.setMaterial)==null||q.call(o,w),(J=o.setGeometry)==null||J.call(o,S)})),l.uiConfig||l.assetType!=="model"&&l.assetType!=="camera"||(sa(l),n.push(()=>{})),l.addEventListener("objectUpdate",({refreshUi:w})=>{var S,C;return w!==!1&&((C=(S=l.uiConfig)==null?void 0:S.uiRefresh)==null?void 0:C.call(S,"postFrame",!0,1))}),l.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(l.userData.__autoParentDispatchEvents=l.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],l.isCamera&&l.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(l.userData.parentRoot=e);const c=l.dispatchEvent;l.dispatchEvent=w=>{var S;(S=l.userData.__autoParentDispatchEvents)!=null&&S.includes(w.type)&&(w.parentDispatch=!0),w.parentDispatch&&(C=>{const O=l.userData.parentRoot??l.parent;O!=null&&O.modelObject&&O.dispatchEvent(C)})(w),c.call(l,w)};const f=l.clone;l.clone=(...w)=>{const S=l.userData;l.userData={};let C=f.call(l,...w);l.userData=S,Ma(C.userData,S);const O=l.userData.parentRoot;return O&&O.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),C=oa(C,O,t),C.userData.cloneParent=l.uuid,C};const m=l.copy;l.copy=(w,...S)=>{const C=w.userData;w.userData={};const O=m.call(l,w,...S);return w.userData=C,Ma(l.userData,w),O};const y=l.add;return l.add=(...w)=>(w.forEach(S=>oa(S,l.userData.parentRoot||l,t)),y.call(l,...w)),(l=(t==null?void 0:t(l))??l).addEventListener("dispose",()=>{n.forEach(w=>w()),n=[]}),[...l.children].forEach(w=>oa(w,l,t)),l}function Oo(l,e){var o,c,f,m;const t=(Array.isArray(e)?e:[e]).map(y=>y==null?void 0:y.materialObject).filter(y=>y);if(l.material==t||t.length===1&&l.material===t[0])return[];l.userData.__materialUpdater||(l.userData.__materialUpdater=()=>{l.dispatchEvent({type:"materialUpdate"})}),l.userData.__textureUpdater||(l.userData.__textureUpdater=()=>{l.dispatchEvent({type:"textureUpdate"})});const n=Array.isArray(l.material)?[...l.material]:[l.material];for(const y of n)y&&(y.removeEventListener("materialUpdate",l.userData.__materialUpdater),y.removeEventListener("textureUpdate",l.userData.__textureUpdater),(c=(o=y.userData)==null?void 0:o.__appliedMeshes)==null||c.delete(l));const i=[];for(const y of t)y.userData.__appliedMeshes||(y.userData.__appliedMeshes=new Set),i.push(y),y&&(y.addEventListener("materialUpdate",l.userData.__materialUpdater),y.addEventListener("textureUpdate",l.userData.__textureUpdater),y.userData.__appliedMeshes.add(l));return l.material=i.length!==1?i:i[0]??void 0,l.dispatchEvent({type:"materialChanged",material:e,mesh:l}),(m=(f=l.uiConfig)==null?void 0:f.uiRefresh)==null||m.call(f,"postFrame",!0),n}function Bo(l,e,t=!1){var o,c,f,m,y,w;l.userData.__objectUpdater||(l.userData.__objectUpdater=S=>{l.dispatchEvent({...S,type:"objectUpdate"})});let n=l.geometry;const i=n;return(n!==e||t)&&(n&&(n.removeEventListener("geometryUpdate",l.userData.__objectUpdater),(c=(o=n.userData)==null?void 0:o.__appliedMeshes)==null||c.delete(l)),n=e,n&&!n.userData.__appliedMeshes&&(n.userData.__appliedMeshes=new Set),l.geometry=n??void 0,n&&(l.updateMorphTargets(),n.addEventListener("geometryUpdate",l.userData.__objectUpdater),(m=(f=n.userData)==null?void 0:f.__appliedMeshes)==null||m.add(l))),e&&!e.uiConfig&&(e.uiConfig=function(S){return{label:"Geometry",type:"folder",children:[{type:"input",property:[S,"uuid"],disabled:!0},{type:"input",property:[S,"name"]},{type:"button",label:"Center Geometry",value:()=>{S.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const C=new s.Pa4;S.center(C),S.userData.__appliedMeshes.forEach(O=>{O.position.sub(C),O.setDirty&&O.setDirty()})}},{type:"button",label:"Compute vertex normals",value:()=>{S.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{S.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{S.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!S.index,value:()=>{if(S.attributes.index)return;const C=parseFloat(prompt("Tolerance","-1")??"-1");ut(S,C)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!S.index,value:()=>{S.attributes.index&&S.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{S.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||S.setAttribute("uv1",S.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!S.hasAttribute("color"),value:()=>{S.hasAttribute("color")?confirm("Remove color attribute?")&&S.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!S.userData.__appliedMeshes||S.userData.__appliedMeshes.size<2,value:()=>{za(S)}},{type:"input",label:"Mesh count",get value(){var C,O;return((O=(C=S.userData)==null?void 0:C.__appliedMeshes)==null?void 0:O.size)??0},set value(C){},disabled:!0}]}}(l.geometry)),l.dispatchEvent({type:"geometryChanged",geometry:e}),(w=(y=l.uiConfig)==null?void 0:y.uiRefresh)==null||w.call(y,"postFrame",!0),i===n?void 0:i||void 0}const Hl=["appliedMeshes"],ja=["parentRoot","iCamera","iModel"];function Ma(l,e){if(e)for(const t of Object.keys(e))ja.includes(t)||t.startsWith("__")||typeof l[t]!="function"&&typeof e[t]!="function"&&(l[t]=e[t]);return l}var Lo,Pt=new Uint8Array(16);function wn(){if(!Lo&&!(Lo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Lo(Pt)}for(var Vn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,un=[],Gn=0;Gn<256;++Gn)un.push((Gn+256).toString(16).substr(1));var Yi=function(l){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(un[l[e+0]]+un[l[e+1]]+un[l[e+2]]+un[l[e+3]]+"-"+un[l[e+4]]+un[l[e+5]]+"-"+un[l[e+6]]+un[l[e+7]]+"-"+un[l[e+8]]+un[l[e+9]]+"-"+un[l[e+10]]+un[l[e+11]]+un[l[e+12]]+un[l[e+13]]+un[l[e+14]]+un[l[e+15]]).toLowerCase();if(!function(n){return typeof n=="string"&&Vn.test(n)}(t))throw TypeError("Stringified UUID is invalid");return t},ji=function(l,e,t){var n=(l=l||{}).random||(l.rng||wn)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return Yi(n)};const Er=new Map;function ir(l,e){return(t,n)=>{const i=t.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");Er.has(i)||Er.set(i,[]);const o=Er.get(i);if(!(o.findIndex(c=>c.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);o.push({params:e||{},propKey:n,uiType:l})}}function Yn(l,e){return ir("checkbox",{label:l,params:e})}function er(l,e){return ir("monitor",{label:l,params:e})}function Pe(l,e,t,n){return ir("slider",{label:l,bounds:e,stepSize:t,params:n})}function Le(l,e,t,n){return ir("vec",{label:l,bounds:e,stepSize:t,params:n})}function ct(l,e,t){return ir("dropdown",{label:l,children:e,params:t})}function ht(l,e){return ir("button",{label:l,params:e})}function Ke(l,e){return ir("input",{label:l,params:e})}function Lt(l,e){return ir("color",{label:l,params:e})}function dt(l,e){return ir("image",{label:l,params:e})}function Wt(l){let e=l==null?void 0:l.constructor;if(!l||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);if(!n.length){const i=typeof l=="object"?Object.keys(l):Array.isArray(l)?l.map((o,c)=>c):[];for(const o of i){const c=l[o];if(c==null)continue;const f=c==null?void 0:c.uiConfig;if(f)t.push(f);else{const m=Xn(c);m==="folder"?t.push(rn(o+"",c)):m&&t.push({type:m,label:o+"",property:[l,o]})}}}return n.reverse().forEach(i=>{var o;(o=Er.get(i))==null||o.forEach(({params:c,propKey:f,uiType:m})=>{let y;if(!m){const w=l[f];y=w==null?void 0:w.uiConfig,y?t.push(y):w!=null&&((m=Xn(w))==="folder"?y=rn(f+"",w):m&&(y={type:m,label:f+"",property:[l,f]}))}if(y||(y={property:[l,f],type:m||"input"}),c){const w=typeof c.params=="function"?c.params(l):c.params||{};delete c.params,Object.assign(y,{...c,...w})}t.push(y)})}),t}function rn(l,e,t={},n="folder"){return{type:n,label:l,children:Wt(e),uuid:ji(),...t}}function on(l,e,t="folder"){return n=>class extends n{constructor(){super(...arguments),this.uiConfig=rn(l,this,e||{},t)}}}function gn(l,e){return on(l,e,"panel")}function Xn(l){return l==null?null:Array.isArray(l)?"folder":typeof l=="boolean"?"checkbox":typeof l=="number"?"number":typeof l=="string"?"input":typeof l=="function"?"button":typeof l.x=="number"?"vec":typeof l.r=="number"?"color":l.isTexture?"image":typeof l=="object"?"folder":null}const an={type:"change"},ui={type:"start"},Ai={type:"end"};class Bn extends s.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new s.Pa4,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new s.Pa4(1/0,1/0,1/0),this.clampMin=new s.Pa4(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:s.RsA.ROTATE,MIDDLE:s.RsA.DOLLY,RIGHT:s.RsA.PAN},this.touches={ONE:s.QmN.ROTATE,TWO:s.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(zn){zn.addEventListener("keydown",Xi),this._domElementKeyEvents=zn},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Xi),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(an),n.update(),o=i.NONE},this.update=function(){const zn=new s.Pa4,oi=new s._fP().setFromUnitVectors(e.up,new s.Pa4(0,1,0)),Ti=oi.clone().invert(),Hr=new s.Pa4,ps=new s._fP,$r=2*Math.PI;return function(){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const Fr=n.object.position;zn.copy(Fr).sub(n.target),zn.applyQuaternion(oi),f.setFromVector3(zn),n.autoRotate&&o===i.NONE&&He(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(f.theta+=m.theta*n.dampingFactor,f.phi+=m.phi*n.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi);let zr=n.minAzimuthAngle,lr=n.maxAzimuthAngle;isFinite(zr)&&isFinite(lr)&&(zr<-Math.PI?zr+=$r:zr>Math.PI&&(zr-=$r),lr<-Math.PI?lr+=$r:lr>Math.PI&&(lr-=$r),f.theta=zr<=lr?Math.max(zr,Math.min(lr,f.theta)):f.theta>(zr+lr)/2?Math.max(zr,f.theta):Math.min(lr,f.theta)),f.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,f.phi)),f.makeSafe(),Math.abs(m.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+m.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(m.radius=0)),f.radius*=1+m.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(y-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*y)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(y=1)),f.radius*=y);let Sn=0;n.autoPushTarget&&f.radius<n.minDistance&&(Sn=n.minDistance-f.radius),n.autoPullTarget&&f.radius>n.maxDistance&&(Sn=n.maxDistance-f.radius),f.radius=Math.max(n.minDistance,Math.min(n.maxDistance,f.radius)),n.enableDamping===!0?n.target.addScaledVector(w,n.dampingFactor):n.target.add(w),zn.setFromSpherical(f),zn.applyQuaternion(Ti),Fr.copy(n.target).add(zn),n.target.add(zn.normalize().multiplyScalar(-Sn)),Fr.clamp(n.clampMin,n.clampMax),n.target.clamp(n.clampMin,n.clampMax),n.object.lookAt(n.target);let Si=!1;return n.enableDamping===!0&&Math.abs(m.theta)+Math.abs(m.phi)+Math.abs(m.radius)+w.length()>.001?(m.theta*=1-n.dampingFactor,m.phi*=1-n.dampingFactor,m.radius*=1-n.dampingFactor,w.multiplyScalar(1-n.dampingFactor),Si=!0):(m.set(0,0,0),w.set(0,0,0)),y=1,!!(S||Si||Hr.distanceToSquared(n.object.position)>c||8*(1-ps.dot(n.object.quaternion))>c)&&(n.dispatchEvent(an),Hr.copy(n.object.position),ps.copy(n.object.quaternion),S=!1,!0)}}(),this.stopDamping=function(){m.set(0,0,0),w.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",ts),n.domElement.removeEventListener("pointerdown",ai),n.domElement.removeEventListener("pointercancel",Ei),n.domElement.removeEventListener("wheel",ki),n.domElement.removeEventListener("pointermove",ri),n.domElement.removeEventListener("pointerup",Ei),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",Xi),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const c=1e-6,f=new s.$V,m=new s.$V(0,0,0);let y=1;const w=new s.Pa4;let S=!1;const C=new s.FM8,O=new s.FM8,N=new s.FM8,H=new s.FM8,q=new s.FM8,J=new s.FM8,V=new s.FM8,z=new s.FM8,ue=new s.FM8,me=[],Te={};function Be(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function He(zn){m.theta-=zn}function tt(zn){m.phi-=zn}this.rotateUp=tt,this.rotateLeft=He;const lt=function(){const zn=new s.Pa4;return function(oi,Ti){zn.setFromMatrixColumn(Ti,0),zn.multiplyScalar(-oi),w.add(zn)}}(),at=function(){const zn=new s.Pa4;return function(oi,Ti){n.screenSpacePanning===!0?zn.setFromMatrixColumn(Ti,1):(zn.setFromMatrixColumn(Ti,0),zn.crossVectors(n.object.up,zn)),zn.multiplyScalar(oi),w.add(zn)}}(),St=function(){const zn=new s.Pa4;return function(oi,Ti){const Hr=n.domElement;if(n.object.isPerspectiveCamera){const ps=n.object.position;zn.copy(ps).sub(n.target);let $r=zn.length();$r*=Math.tan(n.object.fov/2*Math.PI/180),lt(2*oi*$r/Hr.clientHeight,n.object.matrix),at(2*Ti*$r/Hr.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(lt(oi*(n.object.right-n.object.left)/n.object.zoom/Hr.clientWidth,n.object.matrix),at(Ti*(n.object.top-n.object.bottom)/n.object.zoom/Hr.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function mt(zn,oi=0){n.object.isPerspectiveCamera?(y/=zn,m.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,m.radius-oi))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*zn)),n.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function gt(zn,oi=0){n.object.isPerspectiveCamera?(y*=zn,m.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,m.radius+oi))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/zn)),n.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Ot(zn){C.set(zn.clientX,zn.clientY)}function Bt(zn){H.set(zn.clientX,zn.clientY)}function Ft(){if(me.length===1)C.set(me[0].pageX,me[0].pageY);else{const zn=.5*(me[0].pageX+me[1].pageX),oi=.5*(me[0].pageY+me[1].pageY);C.set(zn,oi)}}function _n(){if(me.length===1)H.set(me[0].pageX,me[0].pageY);else{const zn=.5*(me[0].pageX+me[1].pageX),oi=.5*(me[0].pageY+me[1].pageY);H.set(zn,oi)}}function mn(){const zn=me[0].pageX-me[1].pageX,oi=me[0].pageY-me[1].pageY,Ti=Math.sqrt(zn*zn+oi*oi);V.set(0,Ti)}function qn(zn){if(me.length==1)O.set(zn.pageX,zn.pageY);else{const Ti=wr(zn),Hr=.5*(zn.pageX+Ti.x),ps=.5*(zn.pageY+Ti.y);O.set(Hr,ps)}N.subVectors(O,C).multiplyScalar(n.rotateSpeed);const oi=n.domElement;He(2*Math.PI*N.x/oi.clientHeight),tt(2*Math.PI*N.y/oi.clientHeight),C.copy(O)}function Rn(zn){if(me.length===1)q.set(zn.pageX,zn.pageY);else{const oi=wr(zn),Ti=.5*(zn.pageX+oi.x),Hr=.5*(zn.pageY+oi.y);q.set(Ti,Hr)}J.subVectors(q,H).multiplyScalar(n.panSpeed),St(J.x,J.y),H.copy(q)}function En(zn){const oi=wr(zn),Ti=zn.pageX-oi.x,Hr=zn.pageY-oi.y,ps=Math.sqrt(Ti*Ti+Hr*Hr);z.set(0,ps),ue.set(0,Math.pow(z.y/V.y,6*n.zoomSpeed)),mt(ue.y),V.copy(z)}function ai(zn){n.enabled!==!1&&(me.length===0&&(n.domElement.setPointerCapture(zn.pointerId),n.domElement.addEventListener("pointermove",ri),n.domElement.addEventListener("pointerup",Ei)),function(oi){me.push(oi)}(zn),zn.pointerType==="touch"?function(oi){switch(Cr(oi),me.length){case 1:switch(n.touches.ONE){case s.QmN.ROTATE:if(n.enableRotate===!1)return;Ft(),o=i.TOUCH_ROTATE;break;case s.QmN.PAN:if(n.enablePan===!1)return;_n(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(n.touches.TWO){case s.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&mn(),n.enablePan&&_n(),o=i.TOUCH_DOLLY_PAN;break;case s.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&mn(),n.enableRotate&&Ft(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(ui)}(zn):function(oi){let Ti;switch(oi.button){case 0:Ti=n.mouseButtons.LEFT;break;case 1:Ti=n.mouseButtons.MIDDLE;break;case 2:Ti=n.mouseButtons.RIGHT;break;default:Ti=-1}switch(Ti){case s.RsA.DOLLY:if(n.enableZoom===!1)return;(function(Hr){V.set(Hr.clientX,Hr.clientY)})(oi),o=i.DOLLY;break;case s.RsA.ROTATE:if(oi.ctrlKey||oi.metaKey||oi.shiftKey){if(n.enablePan===!1)return;Bt(oi),o=i.PAN}else{if(n.enableRotate===!1)return;Ot(oi),o=i.ROTATE}break;case s.RsA.PAN:if(oi.ctrlKey||oi.metaKey||oi.shiftKey){if(n.enableRotate===!1)return;Ot(oi),o=i.ROTATE}else{if(n.enablePan===!1)return;Bt(oi),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&n.dispatchEvent(ui)}(zn))}function ri(zn){n.enabled!==!1&&(zn.pointerType==="touch"?function(oi){switch(Cr(oi),o){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;qn(oi),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;Rn(oi),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(Ti){n.enableZoom&&En(Ti),n.enablePan&&Rn(Ti)})(oi),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(Ti){n.enableZoom&&En(Ti),n.enableRotate&&qn(Ti)})(oi),n.update();break;default:o=i.NONE}}(zn):function(oi){switch(o){case i.ROTATE:if(n.enableRotate===!1)return;(function(Ti){O.set(Ti.clientX,Ti.clientY),N.subVectors(O,C).multiplyScalar(n.rotateSpeed);const Hr=n.domElement;He(2*Math.PI*N.x/Hr.clientHeight),tt(2*Math.PI*N.y/Hr.clientHeight),C.copy(O),n.update()})(oi);break;case i.DOLLY:if(n.enableZoom===!1)return;(function(Ti){z.set(Ti.clientX,Ti.clientY),ue.subVectors(z,V),ue.y>0?mt(Be()):ue.y<0&&gt(Be()),V.copy(z),n.update()})(oi);break;case i.PAN:if(n.enablePan===!1)return;(function(Ti){q.set(Ti.clientX,Ti.clientY),J.subVectors(q,H).multiplyScalar(n.panSpeed),St(J.x,J.y),H.copy(q),n.update()})(oi)}}(zn))}function Ei(zn){(function(oi){delete Te[oi.pointerId];for(let Ti=0;Ti<me.length;Ti++)if(me[Ti].pointerId==oi.pointerId)return void me.splice(Ti,1)})(zn),me.length===0&&(n.domElement.releasePointerCapture(zn.pointerId),n.domElement.removeEventListener("pointermove",ri),n.domElement.removeEventListener("pointerup",Ei)),n.dispatchEvent(Ai),o=i.NONE}function ki(zn){n.enabled!==!1&&n.enableZoom!==!1&&o===i.NONE&&(zn.preventDefault(),n.dispatchEvent(ui),function(oi){let Ti=0;switch(oi.deltaMode){case 2:Ti+=1*oi.deltaY;break;case 1:Ti+=.4*oi.deltaY;break;default:Ti+=.01*oi.deltaY}oi.deltaY<0?gt(1,Ti*n.zoomSpeed):oi.deltaY>0&&mt(1,-Ti*n.zoomSpeed),n.update()}(zn),n.dispatchEvent(Ai))}function Xi(zn){n.enabled!==!1&&n.enablePan!==!1&&function(oi){let Ti=!1;switch(oi.code){case n.keys.UP:oi.ctrlKey||oi.metaKey||oi.shiftKey?tt(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):St(0,n.keyPanSpeed),Ti=!0;break;case n.keys.BOTTOM:oi.ctrlKey||oi.metaKey||oi.shiftKey?tt(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):St(0,-n.keyPanSpeed),Ti=!0;break;case n.keys.LEFT:oi.ctrlKey||oi.metaKey||oi.shiftKey?He(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):St(n.keyPanSpeed,0),Ti=!0;break;case n.keys.RIGHT:oi.ctrlKey||oi.metaKey||oi.shiftKey?He(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):St(-n.keyPanSpeed,0),Ti=!0}Ti&&(oi.preventDefault(),n.update())}(zn)}function ts(zn){n.enabled!==!1&&zn.preventDefault()}function Cr(zn){let oi=Te[zn.pointerId];oi===void 0&&(oi=new s.FM8,Te[zn.pointerId]=oi),oi.set(zn.pageX,zn.pageY)}function wr(zn){const oi=zn.pointerId===me[0].pointerId?me[1]:me[0];return Te[oi.pointerId]}this.zoomIn=function(zn){mt(1,zn*n.zoomSpeed)},this.zoomOut=function(zn){gt(1,zn*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",ts),n.domElement.addEventListener("pointerdown",ai),n.domElement.addEventListener("pointercancel",Ei),n.domElement.addEventListener("wheel",ki,{passive:!1}),this.update()}}var Kn=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Mn=class extends Bn{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.clampMin=new s.Pa4(-1e4,-1e4,-1e4),this.clampMax=new s.Pa4(1e4,1e4,1e4),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}zoomIn(l){super.zoomIn(l)}zoomOut(l){super.zoomOut(l)}dispatchEvent(l){super.dispatchEvent(l)}};Kn([ze()],Mn.prototype,"type",void 0),Kn([Yn()],Mn.prototype,"enabled",void 0),Kn([Yn(),ze()],Mn.prototype,"dollyZoom",void 0),Kn([Yn(),ze()],Mn.prototype,"enableDamping",void 0),Kn([Ke(),ze()],Mn.prototype,"dampingFactor",void 0),Kn([Yn(),ze()],Mn.prototype,"autoRotate",void 0),Kn([Ke(),ze()],Mn.prototype,"autoRotateSpeed",void 0),Kn([Yn(),ze()],Mn.prototype,"enableZoom",void 0),Kn([Ke(),ze()],Mn.prototype,"zoomSpeed",void 0),Kn([Ke(),ze()],Mn.prototype,"maxZoomSpeed",void 0),Kn([Yn(),ze()],Mn.prototype,"enableRotate",void 0),Kn([Ke(),ze()],Mn.prototype,"rotateSpeed",void 0),Kn([Yn(),ze()],Mn.prototype,"enablePan",void 0),Kn([Ke(),ze()],Mn.prototype,"panSpeed",void 0),Kn([Ke(),ze()],Mn.prototype,"autoPushTarget",void 0),Kn([Ke(),ze()],Mn.prototype,"autoPullTarget",void 0),Kn([Ke(),ze()],Mn.prototype,"minDistance",void 0),Kn([Ke(),ze()],Mn.prototype,"maxDistance",void 0),Kn([Ke(),ze()],Mn.prototype,"minZoom",void 0),Kn([Ke(),ze()],Mn.prototype,"maxZoom",void 0),Kn([Ke(),ze()],Mn.prototype,"minPolarAngle",void 0),Kn([Ke(),ze()],Mn.prototype,"maxPolarAngle",void 0),Kn([Ke(),ze()],Mn.prototype,"minAzimuthAngle",void 0),Kn([Ke(),ze()],Mn.prototype,"maxAzimuthAngle",void 0),Kn([Le(),ze()],Mn.prototype,"clampMin",void 0),Kn([Le(),ze()],Mn.prototype,"clampMax",void 0),Kn([ze()],Mn.prototype,"screenSpacePanning",void 0),Kn([ze()],Mn.prototype,"keyPanSpeed",void 0),Mn=Kn([gn("Orbit Controls")],Mn);var Ci=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Hi extends a.SimpleEventDispatcher{get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>0;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>0;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var i,o;const n={...e};(i=n.position)!=null&&i.isVector3&&(n.position=[n.position.x,n.position.y,n.position.z]),(o=n.target)!=null&&o.isVector3&&(n.target=[n.target.x,n.target.y,n.target.z]),Object.keys(n).forEach(c=>c!=="frustumSize"&&n[c]===void 0&&delete n[c]),Object.assign(this._options,n),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const i=this._options.type==="PerspectiveCamera"?new s.cPb:new s.iKG;i.name=this._camera.name,i.near=this._camera.modelObject.near,i.far=this._camera.modelObject.far,i.zoom=this._camera.modelObject.zoom,i.scale.copy(this._camera.modelObject.scale);const o=this._isActiveCamera;o&&this.deactivateMain(),this._camera=this._setCameraObject(i),t=this._camera.modelObject,o&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const i=this._options.frustumSize;i!==void 0?(t.top=i/2,t.bottom=-i/2,t.left=n*i/2,t.right=-n*i/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=oa(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=c=>{this.setDirty(c)},this._interactionsEnabled=!0,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new s.Pa4(0,0,10),this._target=new s.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(c,f)=>{const m=new Mn(c,f.ownerDocument?f:f.documentElement);return m.screenSpacePanning=!0,m}]]),this._positionWorld=new s.Pa4,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>this._camera.userData.autoNearFar??!0,setValue:c=>this._camera.userData.autoNearFar=c,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Min Near":"Near",getValue:()=>this._camera.userData.minNearPlane??.2,setValue:c=>this._camera.userData.minNearPlane=c,onChange:()=>this.setDirty()},{type:"input",label:()=>this._camera.userData.autoNearFar??1?"Max Far":"Far",getValue:()=>this._camera.userData.maxFarPlane??1e3,setValue:c=>this._camera.userData.maxFarPlane=c,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(c=>({label:c===""?"none":c,value:c})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var c;return(c=this._controls)!=null&&c.zoomIn?{type:"button",label:"Zoom in",value:()=>{var f;(f=this._controls)==null||f.zoomIn(1)}}:{}},()=>{var c;return(c=this._controls)!=null&&c.zoomOut?{type:"button",label:"Zoom out",value:()=>{var f;(f=this._controls)==null||f.zoomOut(1)}}:{}},()=>{var c;return(c=this._controls)==null?void 0:c.uiConfig}]},this.assetType="model",this.uuid=se(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const i={...t};this._camera=this._setCameraObject(e??(i.type==="OrthographicCamera"?new s.iKG(-1,1,1,-1):new s.cPb)),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(i.fov=o.fov,i.focus=o.focus,i.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,i.zoom=o.zoom):o.isOrthographicCamera&&(i.left=o.left,i.right=o.right,i.top=o.top,i.bottom=o.bottom,i.zoom=o.zoom),i.near=o.near,i.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(i)}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(e=4){var t;(t=this._controls)!=null&&t.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(e).add(this.cameraObject.getWorldPosition(new s.Pa4))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var t,n;const e=this._options.controlsMode;this._controls=((t=this._controlsCtors.get(e))==null?void 0:t(this._camera.modelObject,this._container))??void 0,this._controls||e===""||console.error("Unable to create controls with mode "+e+". Are you missing a plugin?"),(n=this._controls)==null||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?e:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)==null||e.removeEventListener("change",this.setDirty),(t=this._controls)==null||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const i=this._options.controlsMode;this._controls?this._controlsMode===i&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=i}if(this._controls){const i=this.interactionsEnabled;this._controls.enabled=i,i&&this._camera.modelObject.up.copy(s.Tme.DEFAULT_UP)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new s.Pa4)),e&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(n=(t=this._camera).setDirty)==null||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var n,i;const t=this.target;(i=(n=this._controls)==null?void 0:n.target)==null||i.set(t.x,t.y,t.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(t),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),this.targetUpdated(e)}positionTargetUpdated(e=!0){this.positionUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t,n,i,o;return(n=(t=e.uniforms.cameraPositionWorld)==null?void 0:t.value)==null||n.copy(this._positionWorld),(o=(i=e.uniforms.cameraNearFar)==null?void 0:i.value)==null||o.set(this._camera.modelObject.near,this._camera.modelObject.far),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},di(this,!0,e))}fromJSON(e,t){return Mi(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Ci([ze("camControls")],Hi.prototype,"_controls",void 0),Ci([ze()],Hi.prototype,"userData",void 0),Ci([(0,a.onChange)(Hi.prototype._nearFarChanged)],Hi.prototype,"near",void 0),Ci([(0,a.onChange)(Hi.prototype._nearFarChanged)],Hi.prototype,"far",void 0),Ci([ze("camOptions")],Hi.prototype,"_options",void 0),Ci([ze("position")],Hi.prototype,"_position",void 0),Ci([ze("target")],Hi.prototype,"_target",void 0);var cr=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Ki extends s.xsS{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new X,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new Hi(new s.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=oa(new s.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new s.GQ(this.getBounds())}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let i=!1;switch(n){case"model":i=e.modelObject.isCamera,i&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:i=!1}={}){const o=e;o?(t&&!o.userData.autoScaled&&vt(o,o.userData.autoScaleRadius||n),o.traverse(c=>{c.isMesh&&!c.userData.__keepShadowDef&&(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0)}),i?this.modelObject.add(o):this.modelRoot.add(o),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(e=>{var t;(e.dispose??((t=e.modelObject)==null?void 0:t.removeFromParent))()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var e;((e=this.environment)==null?void 0:e.mapping)===s.xfE&&(this.environment.mapping=s.dSO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...e){return super.add(...e.map(t=>oa(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return void(this.environment=null);if(!e.isTexture)return void console.error("Unknown Environment type",e);e.assetType!=="texture"&&console.warn("Environment asset not processed",e);const t=e.textureObject||e;this.environment=t}getEnvironment(){return this.environment}setBackground(e){let t;if(!e||e.assetType==="texture"||e.isTexture||e.isColor||e==="environment")t=((e==null?void 0:e.assetType)==="texture"||e.isTexture)&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);t=new s.Ilk(e)}this.background=t}setBackgroundColor(e){this.backgroundColor=e?new s.Ilk(e):null}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,i;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(i=(n=(t=this.boxHelper)==null?void 0:t.box)==null?void 0:n.copy)==null||i.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new s.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){var e;this.disposeSceneModels(),this.clear(),(e=this.environment)==null||e.dispose()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(i=>{i.name===e&&n.push(i)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var i;const n=e.lightObject;n&&((i=n.children)==null||i.length,t?this.add(n):this.modelRoot.add(n))}getBounds(e=!1,t=!0){return new X().expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;if(e.cameraObject.userData.autoNearFar===!1)return e.near=e.cameraObject.userData.minNearPlane??.01,void(e.far=e.cameraObject.userData.maxFarPlane??1e3);const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new s.Pa4).sub(t.getCenter(new s.Pa4)),i=1.5*t.getSize(new s.Pa4).length()/2,o=Math.max(.1,-n.clone().normalize().dot(e.cameraObject.getWorldDirection(new s.Pa4))),c=n.length(),f=Math.max(e.cameraObject.userData.minNearPlane??.2,o*(c-i)),m=Math.min(Math.max(f+i,o*(c+i)),e.cameraObject.userData.maxFarPlane??1e3);e.near=f,e.far=m}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return di(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(Mi(n,this.getEnvironment(),!1,t)),delete e.environment),Mi(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get minNearDistance(){return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera.userData.minNearPlane??.02}set minNearDistance(e){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=e)}}cr([ze()],Ki.prototype,"defaultCamera",void 0),cr([(0,a.onChange2)(Ki.prototype.setDirty),ze()],Ki.prototype,"envMapIntensity",void 0),cr([(0,a.onChange2)(Ki.prototype.setDirty),ze()],Ki.prototype,"fixedEnvMapDirection",void 0),cr([(0,a.onChange2)(Ki.prototype.setDirty),ze()],Ki.prototype,"backgroundIntensity",void 0),cr([ze(),(0,a.onChange)(Ki.prototype._onEnvironmentChange.name)],Ki.prototype,"environment",void 0),cr([ze(),(0,a.onChange)(Ki.prototype._onBackgroundChange)],Ki.prototype,"background",void 0),cr([ze(),(0,a.onChange)(Ki.prototype._onBackgroundChange)],Ki.prototype,"backgroundColor",void 0);function ni(l,e,t,{replaceAll:n=!1,prepend:i=!1,append:o=!1}={}){if(!l.includes(e))return console.error(`${e} not found in shader`),l;let c=t;return i?c=t+e:o&&(c=e+t),n?l.replaceAll(e,c):l.replace(e,c)}class Wi{static ApplyMaterialExtensions(e,t,n,i){for(const o of n)this.ApplyMaterialExtension(e,t,o,i)}static ApplyMaterialExtension(e,t,n,i){let o=(0,a.getOrCall)(n.parsFragmentSnippet,i,e)??"";o.length&&(t.fragmentShader=ni(t.fragmentShader,this.VoidMain,`
`+o+`
`,{prepend:!0})),o=(0,a.getOrCall)(n.parsVertexSnippet,i,e)??"",o.length&&(t.vertexShader=ni(t.vertexShader,this.VoidMain,`
`+o+`
`,{prepend:!0})),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.extraDefines&&function(c,f){let m=!1;const y=Object.entries(c);for(const[w,S]of y)S===void 0?f.materialObject.defines[w]!==void 0&&(delete f.materialObject.defines[w],m=!0):f.materialObject.defines[w]!==S&&(f.materialObject.defines[w]=S,m=!0);m&&(f.materialObject.needsUpdate=!0)}(n.extraDefines,e),n.shaderExtender&&n.shaderExtender(t,e,i),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const i of t)n+=this.CacheKeyForExtension(e,i);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),t.extraDefines&&Object.values(t.extraDefines).forEach(i=>n+=i),n}static RegisterExtensions(e,t){const n=[];if(t)for(const i of t)i.isCompatible&&i.isCompatible(e)&&(n.push(i),i.uuid||(i.uuid=ji()),i.__setDirty||(i.__setDirty=()=>{i.updateVersion||(i.updateVersion=0),i.updateVersion++}),i.setDirty||(i.setDirty=i.__setDirty));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",i=>function(o,{object:c,renderer:f}){var m;if(o.materialExtensions)for(const y of o.materialExtensions){if((m=y.onObjectRender)==null||m.call(y,c,o,f),o.lastShader){const w=(0,a.getOrCall)(y.updaters)||[];for(const S of w)S&&S.updateShaderProperties(o.lastShader)}y.updateVersion!==o.materialObject.userData["_"+y.uuid+"_version"]&&(o.materialObject.userData["_"+y.uuid+"_version"]=y.updateVersion,o.materialObject.needsUpdate=!0)}}(e,i))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",i=>function(o,{object:c,renderer:f}){var m;if(o.materialExtensions)for(const y of o.materialExtensions)(m=y.onAfterRender)==null||m.call(y,c,o,f)}(e,i))),n}}Wi.VoidMain="void main()";class Ir extends s.jyz{constructor(e,t=!1){super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},t&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=Wi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Wi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Wi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Wi.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}class Ar extends Ir{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}}class _s extends Ar{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,colorSpace:s.aCh})),this.setDirty())}_setUniformTexSize(e,t){var c,f;if(!t||!e)return;const n=((c=t.image)==null?void 0:c.width)??512,i=((f=t.image)==null?void 0:f.height)??512,o=e.value;o.isVector2||console.warn("uniform is not a Vector2"),o&&Math.abs(o.x-n)+Math.abs(o.y-i)>.1&&(o.x=n,o.y=i,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,i,o){var c,f;this._setUniformTexSize(this.uniforms.screenSize,(c=e.getRenderTarget())==null?void 0:c.texture);for(const m of this.textures){const y=m.id,w=(f=this.uniforms[y])==null?void 0:f.value;w&&(this._setUniformTexSize(this.uniforms[y+"Size"],w),w.colorSpace!==m.colorSpace&&(m.colorSpace=w.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,i,o)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>`uniform sampler2D ${n.id}; 
`+he(n.id??"input",n.colorSpace??s.aCh)).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.colorSpace).join(";")}}function bo(l,...e){const t=l.fragmentShader;return new _s({defines:Object.assign({},l.defines),uniforms:l.uniforms,vertexShader:l.vertexShader,fragmentShader:t},e)}class Ms extends U{constructor(e,...t){super(e.isMaterial?e:bo(e,...t),t.length<1?Ms.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,i;(t=(e=this.material)==null?void 0:e.dispose)==null||t.call(e),(i=(n=this.fsQuad)==null?void 0:n.dispose)==null||i.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,i,o){this.enabled&&super.render(e,t||null,n,i,o)}}Ms.DEFAULT_TEX_ID="tDiffuse",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([Yn("Enabled"),ze()],Ms.prototype,"enabled",void 0);class Ks extends x{constructor(e,t,n,i,o){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new s.Ilk}render(e,t,n,i,o,c){if(!this.scene||!this.camera)return;const f=e.autoClear;let m,y;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(y=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),m=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),c){const w=e.getContext();w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,c)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),c){const w=e.getContext();w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,m),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=y),e.autoClear=f}}class so extends Ms{constructor(e,t="c = a + b;",n="",i){super({vertexShader:v.vertexShader,fragmentShader:a.glsl`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:i},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class Zi extends Ar{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#glMarker mainStart
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv))<alphaTest)
#else
if(texture2D(alphaMap,vAlphaMapUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new s.FM8(.1,1e3)},alphaMap:{value:null},displacementMap:{value:null},displacementScale:{value:null},displacementBias:{value:null},displacementMapTransform:{value:new s.Vkp},alphaTest:{value:0},alphaMapTransform:{value:new s.Vkp},flags:{value:new s.Ltg(255,255,255,255)}},defines:{IS_GLSL3:e?"1":"0"},glslVersion:e?s.LSk:s.v9Y}),this._updaters=[]}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o);let c=o.material;Array.isArray(c)&&(c=c[0]),this.uniforms.alphaMap.value=(c==null?void 0:c.alphaMap)??null,this.uniforms.alphaMap.value&&e.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.uniforms.alphaTest.value=!c||!c.alphaTest||c.alphaTest<1e-7?.001:c.alphaTest,this.uniforms.displacementMap.value=(c==null?void 0:c.displacementMap)??null,this.uniforms.displacementMap.value&&e.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(c==null?void 0:c.displacementScale)??1,this.uniforms.displacementBias.value=(c==null?void 0:c.displacementBias)??0,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(c!=null&&c.userData.matId?c==null?void 0:c.userData.matId:0)/255,this._updaters.forEach(m=>{m(o,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let f=this.uniforms.alphaMap.value?1:void 0;f!==this.defines.USE_ALPHAMAP&&(f===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=f,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),f=this.uniforms.displacementMap.value?1:void 0,f!==this.defines.USE_DISPLACEMENTMAP&&(f===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=f,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),f=c.userData.ALPHA_I_RGBA_PACKING?1:void 0,f!==this.defines.ALPHA_I_RGBA_PACKING&&(f===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=f,this.needsUpdate=!0),f=c.userData.forcedLinearDepth??void 0,f!==this.defines.FORCED_LINEAR_DEPTH&&(f===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=f,this.needsUpdate=!0),this.side=c.side??s.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){const t=this._updaters.indexOf(e);t!==-1&&this._updaters.splice(t,1)}}var As=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class Ri extends a.SimpleEventDispatcher{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=di(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(Mi(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e,meta:t}),this)}_storeKey(e){return(e??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var e,t,n;return((t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetManager"))==null?void 0:t.exportPluginPreset(this))??((n=this.toJSON)==null?void 0:n.call(this))}async importState(e){var n,i;const t=(n=this._viewer)==null?void 0:n.getPluginByType("AssetManager");t?await t.importPluginPreset(e,this):(i=this.fromJSON)==null||i.call(this,e)}storeState(e,t,n){(t=t||(window?window.localStorage:void 0))?(n===void 0&&(n=this.exportState()),n&&t.setItem(this._storeKey(e),JSON.stringify(n))):console.warn("Unable to store state")}async loadState(e,t){if(!(t=t||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const n=t.getItem(this._storeKey(e));n&&await this.importState(JSON.parse(n))}}function No(l,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){(0,a.safeSetProperty)(e,"dirty",n,!0)},update(){var n,i,o;this.passObject.enabled&&((i=(n=this.passObject).updateShaderProperties)==null||i.call(n,(0,a.getOrCall)(t)),(o=e.update)==null||o.call(this))},onRegister(n){var i,o,c;this.passObject.materialExtension&&((o=(i=l.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||o.registerMaterialExtension(this.passObject.materialExtension)),(c=e.onRegister)==null||c.call(this,n)},onUnregister(n){var i,o,c;this.passObject.materialExtension&&((o=(i=l.getPluginByType("AssetManager"))==null?void 0:i.materials)==null||o.unregisterMaterialExtension(this.passObject.materialExtension)),(c=e.onUnregister)==null||c.call(this,n)},dispose(){var n,i,o;(i=(n=this.passObject).dispose)==null||i.call(n),(o=e.dispose)==null||o.call(this)}}}class br extends Ri{_update(e){var t;return((t=this._pass)==null?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)==null?void 0:e.passObject)==null?void 0:t.enabled)||this._enabledTemp}set enabled(e){var t;(t=this._pass)!=null&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}constructor(){super(),this._enabledTemp=!0}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=No(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)==null?void 0:t.dispose)==null||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=this.pass;return n&&(t.pass=di((n==null?void 0:n.passObject)??n,!1,e)),t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.pass){const n=this.pass;n&&Mi(e.pass,(n==null?void 0:n.passObject)??n,!1,t)}return this}}(function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)})([ze()],br.prototype,"enabled",null);const rr=new Set,oo=new Set;class $s extends Ks{constructor(e,t,n=new pt(1,1,1),i=1){super(void 0,void 0,t,n,i),this.target=e}render(e,t,n,i,o){var y;const c=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel();(y=this.scene)==null||y.traverse(({material:w})=>{w&&((w.transparent&&w.userData.renderToDepth||!w.transparent&&w.transmission===0&&w.userData.renderToDepth===!1)&&(rr.add(w),w.transparent=!w.transparent),Math.abs(w.transmission||0)>0&&w.userData.renderToDepth&&(oo.add([w,w.transmission]),w.transmission=0))}),_t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,i,o)),rr.forEach(w=>w.transparent=!w.transparent),rr.clear(),oo.forEach(([w,S])=>w.transmission=S),oo.clear(),e.setRenderTarget(c,f,m)}}class vr extends br{get material(){return this._material}passCtor(e){var o,c,f;const t=((o=this._viewer)==null?void 0:o.renderer.isWebGL2)&&this.renderFlagsBuffer,n=e.renderer.createTarget({depthBuffer:!0,samples:((c=this._viewer)==null?void 0:c.renderer.composerTarget.samples)||0,type:s.ywz,textureCount:t?2:1});Array.isArray(n.texture)?(n.texture[0].name="gbufferDepthNormal",n.texture[1].name="gbufferFlags",this._gbufferTextures=n.texture):(n.texture.name="gbufferDepthNormal",this._gbufferTextures.push(n.texture)),this._gbufferTarget=n;const i=(f=this._viewer)==null?void 0:f.getPluginByType("debug");return i&&(i.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&i.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),this._material=new Zi(t),this._material.userData.isGBufferMaterial=!0,new $s(n,this._material)}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return As}updateShaderProperties(e){var t;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=this.getDepthNormal()??void 0:(t=this._viewer)==null||t.console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=this.getFlagsTexture()??void 0;const n=e.uniforms.tGBufferFlags.value?1:0;n!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=n,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}vr.PluginType="GBuffer";class Ta extends Ks{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:s.aCh,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?s.cLu:s.ywz,format:s.wk1,minFilter:s.wem,magFilter:s.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(e,t=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new pt(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new so({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}render(e,t,n,i,o){var S;let c=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,i,o),this.needsSwap=c,void(e.userData.mainRenderPass=void 0);const f=e.userData;f||console.error("threejs is not patched?");const m=this._viewer.useGBufferDepth;let y;if(m){const C=(S=this._viewer.getPlugin(vr))==null?void 0:S.getTarget();if(C){const O=e.properties.get(C);y=O.__webglDepthRenderbuffer||O.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let w=()=>{super.render(e,void 0,n,i,o,y)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(c=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const C=e.autoClearDepth;e.autoClearDepth=!m,_t(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},w),e.autoClearDepth=C}if(!m){const C=e.properties.get(n);y=C.__webglDepthRenderbuffer||C.__webglDepthbuffer}w=()=>{super.render(e,void 0,this.transparentTarget,i,o,y)};{const C=this.clear,O=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,_t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},w),this.clear=C,e.autoClearDepth=O}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,o),c=!0);{const C=this.clear;this.clear=!1,f.transmissionRenderTarget=c?t:n,f.blurTransmissionTarget=this.blurTransmissionTarget,_t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},w),f.blurTransmissionTarget=void 0,f.transmissionRenderTarget=void 0,this.clear=C}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,i,o),c=!0)}}else{{const C=this.clear,O=e.autoClearDepth;e.autoClearDepth=!m,this.clear=!0,_t(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},w),this.clear=C,e.autoClearDepth=O}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const C=this.clear;this.clear=!1,f.transmissionRenderTarget=t,f.blurTransmissionTarget=this.blurTransmissionTarget,_t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},w),f.blurTransmissionTarget=void 0,f.transmissionRenderTarget=void 0,this.clear=C}c=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=c,e.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function xr(l,e){return l.multiplyScalar(l.w*e),l.w=1,l}function Is(l,e){return xr(l,e),new pt(l.x,l.y,l.z)}function Vu(l,e){const t=Math.max(l.x,Math.max(l.y,l.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,l.divideScalar(n*e),l.w=n,l}function Wl(l,e){return Vu(new s.Ltg(l.r,l.g,l.b,1),e)}const fu={name:"",blending:s.bdR,side:s.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:s.k74,blendDst:s.LgZ,blendEquation:s.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:s.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:s.cum,stencilRef:0,stencilFuncMask:255,stencilFail:s.x5V,stencilZFail:s.x5V,stencilZPass:s.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0},zc={...fu,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:s.IOt,normalScale:new s.FM8(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},Va={...zc,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new s.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new pt(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new pt(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new pt(1,1,1),specularColorMap:null};class Wr extends s.EJi{constructor(e){super(e),this.typeSlug=Wr.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=Wi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Wi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},$t(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},$t(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},$t(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},$t(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",s.IOt],["ObjectSpace",s.PA7]].map(e=>({label:e[0],value:e[1]}))},$t(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},$t(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},$t(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},$t(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},$t(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},$t(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},$t(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},$t(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},$t(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},$t(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",s.BVF],["Always",s.Se2],["Less",s.Zr5],["LessEqual",s.vCF],["Equal",s.eD],["GreaterEqual",s.ksN],["Greater",s.w$m],["NotEqual",s.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Qe],["Normal",ft],["Additive",s.WMw],["Subtractive",bt],["Multiply",sn]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},$t(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},$t(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},$t(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},$t(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},$t(this,"iridescenceThicknessMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",s.Wl3],["Back",s._Li],["Double",s.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(di(this,!1),null,2)],{type:"application/json"});(0,a.downloadBlob)(e,`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const o of i)e.vertexShader=ni(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=ni(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);Wi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Wi.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o});const c=this.userData.inverseAlphaMap?1:0;c!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=c,this.needsUpdate=!0)}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}copyProps(e,t=!1,n=!0){if(!t&&!["MeshStandardMaterial",Wr.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const i={},o=Array.from(Object.keys(Va));(0,a.copyProps)(e,i,o);const c=i.userData;delete i.userData;for(const f of Object.keys(i))i[f]===void 0&&delete i[f];if(this.setValues(i),n)for(const f of nn)this.userData[f]!==void 0&&this.userData[f];return c&&Ht(this.userData,c),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(e){var o,c;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},Ht(n.userData,t),n.userData.uuid=this.userData.uuid;const i=e||{textures:Object.fromEntries(((o=n.textures)==null?void 0:o.map(f=>[f.uuid,f]))||[]),images:Object.fromEntries(((c=n.images)==null?void 0:c.map(f=>[f.uuid,f]))||[])};n.userData=di(n.userData,!1,i),e||(Object.keys(i.textures).length>0&&(n.textures=Object.values(i.textures)),Object.keys(i.images).length>0&&(n.images=Object.values(i.images))),n.type=Wr.TYPE;for(const f of Object.keys(n))n[f]===void 0&&delete n[f];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Wr.TypeSlug="pmat",Wr.TYPE="MeshStandardMaterial2";const Gu={...fu,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:s.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class Ts extends s.vBJ{constructor(e){super(e),this.typeSlug=Ts.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.materialExtensions=Wi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Wi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},$t(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Qe],["Normal",ft],["Additive",s.WMw],["Subtractive",bt],["Multiply",sn]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},$t(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},$t(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},$t(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",s.Wl3],["Back",s._Li],["Double",s.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t;return((t=(e=this.userData)==null?void 0:e.__appliedMeshes)==null?void 0:t.size)??0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{const e=new Blob([JSON.stringify(di(this,!1),null,2)],{type:"application/json"});(0,a.downloadBlob)(e,`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)==null?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],i=[["#include <uv_vertex>","mainStart"]];for(const o of i)e.vertexShader=ni(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=ni(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);Wi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Wi.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,i,o){super.onBeforeRender(e,t,n,i,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",Ts.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={},i=Array.from(Object.keys(Gu));(0,a.copyProps)(e,n,i);const o=n.userData;delete n.userData;for(const c of Object.keys(n))n[c]===void 0&&delete n[c];return this.setValues(n),o&&Ht(this.userData,o),this.setDirty(),this}toJSON(e){var o,c;const t=this.userData;this.userData={};const n=super.toJSON(e);this.userData=t,n.userData={},Ht(n.userData,t),n.userData.uuid=this.userData.uuid;const i=e||{textures:Object.fromEntries(((o=n.textures)==null?void 0:o.map(f=>[f.uuid,f]))||[]),images:Object.fromEntries(((c=n.images)==null?void 0:c.map(f=>[f.uuid,f]))||[])};n.userData=di(n.userData,!1,i),e||(Object.keys(i.textures).length>0&&(n.textures=Object.values(i.textures)),Object.keys(i.images).length>0&&(n.images=Object.values(i.images))),n.type=Ts.TYPE;for(const f of Object.keys(n))n[f]===void 0&&delete n[f];return n}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Ts.TypeSlug="bmat",Ts.TYPE="MeshBasicMaterial2";const Nr={materialType:Wr.TYPE,name:"standard",color:"#ffffff"},Ga={materialType:Ts.TYPE,name:"basic",color:"#ffffff"},qp={[Wr.TYPE]:Nr.name,MeshStandardMaterial:Nr.name,MeshPhysicalMaterial:Nr.name,[Ts.TYPE]:Ga.name,MeshBasicMaterial:Ga.name};class gh extends a.SimpleEventDispatcher{constructor(){super(),this._templates=[Nr,Ga],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),i=[];n.forEach(o=>{const c=o.userData.__appliedMaterials;c==null||c.delete(t),c&&o.userData.disposeOnIdle!==!1&&c.size===0&&i.push(o)}),i.forEach(o=>{o.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(i=>i.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(e){(e||this.getAllMaterials()).forEach(t=>{this._getMapsForMaterial(t).forEach(n=>{let i=n.userData.__appliedMaterials;i||(n.userData.__appliedMaterials=i=new Set),n.addEventListener("update",()=>t.dispatchEvent({type:"textureUpdate",texture:n})),i.add(t)})})}_getMapsForMaterial(e){const t=new Set;for(const n of Object.values(e))n&&n.isTexture&&t.add(n);for(const n of Object.values(e.userData??{}))n&&n.isTexture&&t.add(n);return t}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e),this._refreshTextureRefs([e]))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=ji());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(e=!0){const t=this._materials;this._materials=[];for(const n of t)e||!n.userData.runtimeMaterial?n.dispose():this._materials.push(n)}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e,t=!1){return this._materials.filter(n=>typeof e!="string"||t?n.name.match(typeof e=="string"?"^"+e+"$":e)!==null:n.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){const n=this._processModel(e,t);return(0,a.safeSetProperty)(e,"modelObject",n),e}_processMaterial(e,t){var i,o;if(!e)return;if((i=e.materialObject)!=null&&i.isMaterial)return e;let n=e.mmMaterial;if(!n){const c=((o=e.userData)==null?void 0:o.uuid)||e.uuid;if(n=this.findMaterial(c),n)n.copyProps(e);else{const f=t.useSourceMaterial===!1||!e.isMaterial,m=t.materialTemplate||(f?"standard":qp[e.type]||"standard");n=this.generateFromTemplate(m,f?{}:e)}e.mmMaterial=n}return n}processMaterial(e,t){return e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),t.register!==!1&&this.registerMaterial(e),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,i=!1){const o=di(e,!1),c=JSON.stringify(o,null,n?0:2),f=(t||e.name||"physical_material")+"."+e.typeSlug,m=new File([c],f,{type:"application/json"});return i&&(0,a.downloadFile)(m),m}applyMaterial(e,t){var c;const n=Object.getPrototypeOf(e).constructor.TYPE;let i=this.findMaterialsByName(t,!0);(!i||i.length<1)&&(i=[this.findMaterial(t)]);let o=!1;for(const f of i)if(f&&!f.userData.__isVariation&&f!==e)if(Object.getPrototypeOf(f).constructor.TYPE===n){const m=f.name;f.copyProps(e),f.name=m,o=!0}else{const m=f["__"+n]||this.generateFromTemplateType(n);if(!m)continue;const y=f.name;m.copyProps(e),m.name=y;const w=f.userData.__appliedMeshes;for(const S of[...w??[]])(c=S==null?void 0:S.setMaterial)==null||c.call(S,m),S&&(o=!0);f["__"+n]=m}return o}}class Jd extends gh{_generateFromTemplate(e,t){var f,m,y,w,S;let n;const i={...e};i.customMaterialExtensions=[...i.customMaterialExtensions??[],...this._materialExtensions];const o=(t==null?void 0:t.metadata)&&(t==null?void 0:t.metadata.version)<=4.5;o&&(s.epp.enabled=!1);let c={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&(0,a.copyProps)(t,i,Array.from(Object.keys(Va))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(i.roughness=.9,i.metalness=0,(f=i.userData)!=null&&f.uuid&&delete i.userData.uuid),c=(m=i.userData)==null?void 0:m.uuid,c&&delete i.userData.uuid,n=new Wr({customMaterialExtensions:i.customMaterialExtensions}).fromJSON(i,void 0,!0),c&&(n.uuid=c),n.userData.uuid=n.uuid,n.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=n);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&(0,a.copyProps)(t,i,Array.from(Object.keys(Gu))),c=(y=i.userData)==null?void 0:y.uuid,c&&delete i.userData.uuid,n=new Ts({customMaterialExtensions:i.customMaterialExtensions}).fromJSON(i,void 0,!0),c&&(n.uuid=c,i.userData.uuid=c),n.userData.uuid=n.uuid,n.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:c=null,t&&t.userData&&(c=t.userData,delete t.userData),n=((w=e.generator)==null?void 0:w.call(e,i,t))||void 0,t&&c&&(t.userData=c),c&&n&&(Ht(n.userData,c),c!=null&&c.uuid&&(n.uuid=c.uuid),c=null),n&&(n.userData.uuid=n.uuid)}if(n){t.runtimeMaterial&&(n.userData.__runtimeMaterial=!0);const C=n;if(n.clone=()=>{C.userData.cloneId||(C.userData.cloneId="0"),C.userData.cloneCount||(C.userData.cloneCount=0),C.userData.cloneCount+=1;const O=this.generateFromTemplate(e.name);return O&&(O.copyProps(C),O.userData.cloneId=O.userData.cloneId+"_"+C.userData.cloneCount,O.userData.cloneCount=0,O.name=O.name+"_"+O.userData.cloneId,O.userData.uuid=O.uuid),O==null?void 0:O.materialObject},t){let O=this.findMaterial(t==null?void 0:t.uuid);O&&this.unregisterMaterial(O),O=this.findMaterial((S=t==null?void 0:t.materialObject)==null?void 0:S.uuid),O&&this.unregisterMaterial(O)}}return o&&(s.epp.enabled=!0),n?this.registerMaterialObject(n):void 0}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let i=!0;Array.isArray(n)||(n=[n],i=!1);const o=[];for(const c of n){const f=this._processMaterial(c,t);o.push(f==null?void 0:f.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(i?o:o[0]))}if(t.recursive!==!1)for(let i=0;i<e.modelObject.children.length;i++)e.modelObject.children[i]=this._processModel(e.modelObject.children[i],t);return e}}class Js{ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}constructor(e,t,n,i){this.cls=e,this.ext=t,this.root=n,this.onCtor=i}}class ao{get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:i=!1,autoScaleRadius:o=2,license:c=""}={}){if(this.assetType="model",this._modelObject=oa(new s.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):At(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const f=new X().expandByObject(e,!0,!0).getCenter(new s.Pa4);this._modelObject.position.copy(f).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}i&&!this._modelObject.userData.autoScaled?vt(this._modelObject,e.userData.autoScaleRadius||o):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=c}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,i,o;(n=(t=this._modelObject)==null?void 0:t.setDirty)==null||n.call(t,e),(o=(i=this._uiConfig)==null?void 0:i.uiRefresh)==null||o.call(i,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)==null?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,i;if(this._modelObject.isMesh)return(i=(n=this._modelObject).setGeometry)==null?void 0:i.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=sa(this._modelObject,!1)),this._uiConfig}clone(){return new ao(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function ud(l,e){return[l.modelObject,...l.modelObject.children].forEach(t=>{oa(t,t!==l.modelObject?l:void 0,e)}),l}class xg{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))==null||n.push(t)}remove(e,t){const n=this._processors.get(e),i=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(o=>o.process&&o.process===t.process||o.processAsync&&o.processAsync===t.processAsync));!n||!i||i<0||n.splice(i,1)}get(e){return this._processors.get(e)??[]}async process(e,t,n){var c,f;const i=this.get(e),o=t.assetType;for(const m of i)m.forAssetType===o&&(t=((c=m.process)==null?void 0:c.call(m,t,n))??t,t=await((f=m.processAsync)==null?void 0:f.call(m,t,n))??t);return t}dispose(){this._processors.clear()}}class _h extends s.hH6{load(e,t,n,i){return super.load(e,o=>{try{if(typeof o!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(o))}catch(c){i==null||i(c)}},n,i)}}class Hu extends s.yxD{constructor(e){super(e),this.type=s.cLu}parse(e){const t=function(m,y){switch(m){case 1:console.error("THREE.RGBELoader Read Error: "+(y||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(y||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(y||""));break;default:console.error("THREE.RGBELoader: Error: "+(y||""))}return-1},n=function(m,y,w){y=y||1024;let S=m.pos,C=-1,O=0,N="",H=String.fromCharCode.apply(null,new Uint16Array(m.subarray(S,S+128)));for(;0>(C=H.indexOf(`
`))&&O<y&&S<m.byteLength;)N+=H,O+=H.length,S+=128,H+=String.fromCharCode.apply(null,new Uint16Array(m.subarray(S,S+128)));return-1<C&&(w!==!1&&(m.pos+=O+C+1),N+H.slice(0,C))},i=function(m,y,w,S){const C=m[y+3],O=Math.pow(2,C-128)/255;w[S+0]=m[y+0]*O,w[S+1]=m[y+1]*O,w[S+2]=m[y+2]*O,w[S+3]=1},o=function(m,y,w,S){const C=m[y+3],O=Math.pow(2,C-128)/255;w[S+0]=s.A5E.toHalfFloat(Math.min(m[y+0]*O,65504)),w[S+1]=s.A5E.toHalfFloat(Math.min(m[y+1]*O,65504)),w[S+2]=s.A5E.toHalfFloat(Math.min(m[y+2]*O,65504)),w[S+3]=s.A5E.toHalfFloat(1)},c=new Uint8Array(e);c.pos=0;const f=function(m){const y=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,C=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,O={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let N,H;if(m.pos>=m.byteLength||!(N=n(m)))return t(1,"no header found");if(!(H=N.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(O.valid|=1,O.programtype=H[1],O.string+=N+`
`;N=n(m),N!==!1;)if(O.string+=N+`
`,N.charAt(0)!=="#"){if((H=N.match(y))&&(O.gamma=parseFloat(H[1])),(H=N.match(w))&&(O.exposure=parseFloat(H[1])),(H=N.match(S))&&(O.valid|=2,O.format=H[1]),(H=N.match(C))&&(O.valid|=4,O.height=parseInt(H[1],10),O.width=parseInt(H[2],10)),2&O.valid&&4&O.valid)break}else O.comments+=N+`
`;return 2&O.valid?4&O.valid?O:t(3,"missing image size specifier"):t(3,"missing format specifier")}(c);if(f!==-1){const m=f.width,y=f.height,w=function(S,C,O){const N=C;if(N<8||N>32767||S[0]!==2||S[1]!==2||128&S[2])return new Uint8Array(S);if(N!==(S[2]<<8|S[3]))return t(3,"wrong scanline width");const H=new Uint8Array(4*C*O);if(!H.length)return t(4,"unable to allocate buffer space");let q=0,J=0;const V=4*N,z=new Uint8Array(4),ue=new Uint8Array(V);let me=O;for(;me>0&&J<S.byteLength;){if(J+4>S.byteLength)return t(1);if(z[0]=S[J++],z[1]=S[J++],z[2]=S[J++],z[3]=S[J++],z[0]!=2||z[1]!=2||(z[2]<<8|z[3])!=N)return t(3,"bad rgbe scanline format");let Te,Be=0;for(;Be<V&&J<S.byteLength;){Te=S[J++];const tt=Te>128;if(tt&&(Te-=128),Te===0||Be+Te>V)return t(3,"bad scanline data");if(tt){const lt=S[J++];for(let at=0;at<Te;at++)ue[Be++]=lt}else ue.set(S.subarray(J,J+Te),Be),Be+=Te,J+=Te}const He=N;for(let tt=0;tt<He;tt++){let lt=0;H[q]=ue[tt+lt],lt+=N,H[q+1]=ue[tt+lt],lt+=N,H[q+2]=ue[tt+lt],lt+=N,H[q+3]=ue[tt+lt],q+=4}me--}return H}(c.subarray(c.pos),m,y);if(w!==-1){let S,C,O;switch(this.type){case s.VzW:O=w.length/4;const N=new Float32Array(4*O);for(let q=0;q<O;q++)i(w,4*q,N,4*q);S=N,C=s.VzW;break;case s.cLu:O=w.length/4;const H=new Uint16Array(4*O);for(let q=0;q<O;q++)o(w,4*q,H,4*q);S=H,C=s.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:m,height:y,data:S,header:f.string,gamma:f.gamma,exposure:f.exposure,type:C}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(o,c){switch(o.type){case s.VzW:case s.cLu:o.colorSpace=s.GUF,o.minFilter=s.wem,o.magFilter=s.wem,o.generateMipmaps=!1,o.flipY=!0}t&&t(o,c)},n,i)}}function Xp(l){return new Js(class extends Hu{constructor(e){super(e),this.setDataType(Ol(l.renderer.rendererObject))}},["hdr"],!1)}class wg extends s.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ep(t)}),this.register(function(t){return new ei(t)}),this.register(function(t){return new uc(t)}),this.register(function(t){return new Cl(t)}),this.register(function(t){return new Sg(t)}),this.register(function(t){return new Xf(t)}),this.register(function(t){return new sl(t)}),this.register(function(t){return new qs(t)}),this.register(function(t){return new Zd(t)}),this.register(function(t){return new tp(t)}),this.register(function(t){return new Yp(t)}),this.register(function(t){return new Eg(t)}),this.register(function(t){return new xo(t)}),this.register(function(t){return new np(t)})}load(e,t,n,i){const o=this;let c;c=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:s.Zp0.extractUrlBase(e),this.manager.itemStart(e);const f=function(y){i?i(y):console.error(y),o.manager.itemError(e),o.manager.itemEnd(e)},m=new s.hH6(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(e,function(y){try{o.parse(y,c,function(w){t(w),o.manager.itemEnd(e)},f,e)}catch(w){f(w)}},n,f)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,o){let c;const f={},m={},y=new TextDecoder;if(typeof e=="string")c=JSON.parse(e);else if(e instanceof ArrayBuffer)if(y.decode(new Uint8Array(e,0,4))===yh){try{f[fs.KHR_BINARY_GLTF]=new Wu(e)}catch(S){return void(i&&i(S))}c=JSON.parse(f[fs.KHR_BINARY_GLTF].content)}else c=JSON.parse(y.decode(e));else c=e;if(c.asset===void 0||c.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const w=new bh(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});w.fileLoader.setRequestHeader(this.requestHeader);for(let S=0;S<this.pluginCallbacks.length;S++){const C=this.pluginCallbacks[S](w);m[C.name]=C,f[C.name]=!0}if(c.extensionsUsed)for(let S=0;S<c.extensionsUsed.length;++S){const C=c.extensionsUsed[S],O=c.extensionsRequired||[];switch(C){case fs.KHR_MATERIALS_UNLIT:f[C]=new qf;break;case fs.KHR_DRACO_MESH_COMPRESSION:f[C]=new kr(c,this.dracoLoader);break;case fs.KHR_TEXTURE_TRANSFORM:f[C]=new qo;break;case fs.KHR_MESH_QUANTIZATION:f[C]=new aa;break;default:O.indexOf(C)>=0&&m[C]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}w.setExtensions(f),w.setPlugins(m),w.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,t,i,o)})}}function vh(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const fs={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Eg{constructor(e){this.parser=e,this.name=fs.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let f;const m=new s.Ilk(16777215);c.color!==void 0&&m.fromArray(c.color);const y=c.range!==void 0?c.range:0;switch(c.type){case"directional":f=new s.Ox3(m),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new s.cek(m),f.distance=y;break;case"spot":f=new s.PMe(m),f.distance=y,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,f.angle=c.spot.outerConeAngle,f.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return f.position.set(0,0,0),f.decay=2,Il(f,c),c.intensity!==void 0&&(f.intensity=c.intensity),f.name=t.createUniqueName(c.name||"light_"+e),i=Promise.resolve(f),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(c){return n._getNodeRef(t.cache,o,c)})}}class qf{constructor(){this.name=fs.KHR_MATERIALS_UNLIT}getMaterialType(){return s.vBJ}extendParams(e,t,n){const i=[];e.color=new s.Ilk(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const c=o.baseColorFactor;e.color.fromArray(c),e.opacity=c[3]}o.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",o.baseColorTexture,s.KI_))}return Promise.all(i)}}class Zd{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class ep{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];if(c.clearcoatFactor!==void 0&&(t.clearcoat=c.clearcoatFactor),c.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",c.clearcoatTexture)),c.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=c.clearcoatRoughnessFactor),c.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",c.clearcoatRoughnessTexture)),c.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",c.clearcoatNormalTexture)),c.clearcoatNormalTexture.scale!==void 0)){const f=c.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new s.FM8(f,f)}return Promise.all(o)}}class Yp{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.iridescenceFactor!==void 0&&(t.iridescence=c.iridescenceFactor),c.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",c.iridescenceTexture)),c.iridescenceIor!==void 0&&(t.iridescenceIOR=c.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),c.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=c.iridescenceThicknessMaximum),c.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",c.iridescenceThicknessTexture)),Promise.all(o)}}class Sg{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new s.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const c=i.extensions[this.name];return c.sheenColorFactor!==void 0&&t.sheenColor.fromArray(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=c.sheenRoughnessFactor),c.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",c.sheenColorTexture,s.KI_)),c.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",c.sheenRoughnessTexture)),i.extras&&i.extras.sheenFactor!==void 0&&(t.sheen=i.extras.sheenFactor,delete i.extras.sheenFactor),Promise.all(o)}}class Xf{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.transmissionFactor!==void 0&&(t.transmission=c.transmissionFactor),c.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",c.transmissionTexture)),Promise.all(o)}}class sl{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];t.thickness=c.thicknessFactor!==void 0?c.thicknessFactor:0,c.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",c.thicknessTexture)),t.attenuationDistance=c.attenuationDistance||1/0;const f=c.attenuationColor||[1,1,1];return t.attenuationColor=new s.Ilk(f[0],f[1],f[2]),Promise.all(o)}}class qs{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class tp{constructor(e){this.parser=e,this.name=fs.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.EJi:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];t.specularIntensity=c.specularFactor!==void 0?c.specularFactor:1,c.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",c.specularTexture));const f=c.specularColorFactor||[1,1,1];return t.specularColor=new s.Ilk(f[0],f[1],f[2]),c.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",c.specularColorTexture,s.KI_)),Promise.all(o)}}class ei{constructor(e){this.parser=e,this.name=fs.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const o=i.extensions[this.name],c=t.options.ktx2Loader;if(!c){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,c)}}class uc{constructor(e){this.parser=e,this.name=fs.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const c=o.extensions[t],f=i.images[c.source];let m=n.textureLoader;if(f.uri){const y=n.options.manager.getHandler(f.uri);y!==null&&(m=y)}return this.detectSupport().then(function(y){if(y)return n.loadTextureImage(e,c.source,m);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Cl{constructor(e){this.parser=e,this.name=fs.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;const c=o.extensions[t],f=i.images[c.source];let m=n.textureLoader;if(f.uri){const y=n.options.manager.getHandler(f.uri);y!==null&&(m=y)}return this.detectSupport().then(function(y){if(y)return n.loadTextureImage(e,c.source,m);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class xo{constructor(e){this.name=fs.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),c=this.parser.options.meshoptDecoder;if(!c||!c.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(f){const m=i.byteOffset||0,y=i.byteLength||0,w=i.count,S=i.byteStride,C=new Uint8Array(f,m,y);return c.decodeGltfBufferAsync?c.decodeGltfBufferAsync(w,S,C,i.mode,i.filter).then(function(O){return O.buffer}):c.ready.then(function(){const O=new ArrayBuffer(w*S);return c.decodeGltfBuffer(new Uint8Array(O),w,S,C,i.mode,i.filter),O})})}return null}}class np{constructor(e){this.name=fs.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const m of i.primitives)if(m.mode!==Ji.TRIANGLES&&m.mode!==Ji.TRIANGLE_STRIP&&m.mode!==Ji.TRIANGLE_FAN&&m.mode!==void 0)return null;const o=n.extensions[this.name].attributes,c=[],f={};for(const m in o)c.push(this.parser.getDependency("accessor",o[m]).then(y=>(f[m]=y,f[m])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(m=>{const y=m.pop(),w=y.isGroup?y.children:[y],S=m[0].count,C=[];for(const O of w){const N=new s.yGw,H=new s.Pa4,q=new s._fP,J=new s.Pa4(1,1,1),V=new s.SPe(O.geometry,O.material,S);for(let z=0;z<S;z++)f.TRANSLATION&&H.fromBufferAttribute(f.TRANSLATION,z),f.ROTATION&&q.fromBufferAttribute(f.ROTATION,z),f.SCALE&&J.fromBufferAttribute(f.SCALE,z),V.setMatrixAt(z,N.compose(H,q,J));V.sourceTrs=f;for(const z in f)z!=="TRANSLATION"&&z!=="ROTATION"&&z!=="SCALE"&&O.geometry.setAttribute(z,f[z]);s.Tme.prototype.copy.call(V,O),this.parser.assignFinalMaterial(V),C.push(V)}return y.isGroup?(y.clear(),y.add(...C),y):C[0]}))}}const yh="glTF";class Wu{constructor(e){this.name=fs.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==yh)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,o=new DataView(e,12);let c=0;for(;c<i;){const f=o.getUint32(c,!0);c+=4;const m=o.getUint32(c,!0);if(c+=4,m===1313821514){const y=new Uint8Array(e,12+c,f);this.content=n.decode(y)}else if(m===5130562){const y=12+c;this.body=e.slice(y,y+f)}c+=f}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class kr{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=fs.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,c=e.extensions[this.name].attributes,f={},m={},y={};for(const w in c){const S=hc[w]||w.toLowerCase();f[S]=c[w]}for(const w in e.attributes){const S=hc[w]||w.toLowerCase();if(c[w]!==void 0){const C=n.accessors[e.attributes[w]],O=Gs[C.componentType];y[S]=O.name,m[S]=C.normalized===!0}}return t.getDependency("bufferView",o).then(function(w){return new Promise(function(S){i.decodeDracoFile(w,function(C){for(const O in C.attributes){const N=C.attributes[O],H=m[O];H!==void 0&&(N.normalized=H)}S(C)},f,y)})})}}class qo{constructor(){this.name=fs.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class aa{constructor(){this.name=fs.KHR_MESH_QUANTIZATION}}class rs extends s._C8{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i;for(let c=0;c!==i;c++)t[c]=n[o+c];return t}interpolate_(e,t,n,i){const o=this.resultBuffer,c=this.sampleValues,f=this.valueSize,m=2*f,y=3*f,w=i-t,S=(n-t)/w,C=S*S,O=C*S,N=e*y,H=N-y,q=-2*O+3*C,J=O-C,V=1-q,z=J-C+S;for(let ue=0;ue!==f;ue++){const me=c[H+ue+f],Te=c[H+ue+m]*w,Be=c[N+ue+f],He=c[N+ue]*w;o[ue]=V*me+z*Te+q*Be+J*He}return o}}const ip=new s._fP;class li extends rs{interpolate_(e,t,n,i){const o=super.interpolate_(e,t,n,i);return ip.fromArray(o).normalize().toArray(o),o}}const Ji={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Gs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},hd={9728:s.TyD,9729:s.wem,9984:s.YLQ,9985:s.qyh,9986:s.aH4,9987:s.D1R},Ah={33071:s.uWy,33648:s.OoA,10497:s.rpg},ol={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ha={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},dc={CUBICSPLINE:void 0,LINEAR:s.NMF,STEP:s.Syv};function Rl(l,e,t){for(const n in t.extensions)l[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Il(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Yf(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)l.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rv(l){const e=l.extensions&&l.extensions[fs.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+Kp(e.attributes):l.indices+":"+Kp(l.attributes)+":"+l.mode,t}function Kp(l){let e="";const t=Object.keys(l).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+l[t[n]]+";";return e}function Kf(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Wa=new s.yGw;class bh{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new vh,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,o=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&o<98?this.textureLoader=new s.dpR(this.options.manager):this.textureLoader=new s.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new s.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(c){return c._markDefs&&c._markDefs()}),Promise.all(this._invokeAll(function(c){return c.beforeRoot&&c.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(c){const f={scene:c[0][i.scene||0],scenes:c[0],animations:c[1],cameras:c[2],asset:i.asset,parser:n,userData:{}};Rl(o,f,i),Il(f,i),Promise.all(n._invokeAll(function(m){return m.afterRoot&&m.afterRoot(f)})).then(function(){e(f)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,o=t.length;i<o;i++){const c=t[i].joints;for(let f=0,m=c.length;f<m;f++)e[c[f]].isBone=!0}for(let i=0,o=e.length;i<o;i++){const c=e[i];c.mesh!==void 0&&(this._addNodeRef(this.meshCache,c.mesh),c.skin!==void 0&&(n[c.mesh].isSkinnedMesh=!0)),c.camera!==void 0&&this._addNodeRef(this.cameraCache,c.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),o=(c,f)=>{const m=this.associations.get(c);m!=null&&this.associations.set(f,m);for(const[y,w]of c.children.entries())o(w,f.children[y])};return o(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const o=e(t[i]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":i=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(o,c){return n.getDependency(e,c)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[fs.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(o,c){n.load(s.Zp0.resolveURL(t.uri,i.path),o,void 0,function(){c(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const c=ol[i.type],f=Gs[i.componentType],m=i.normalized===!0,y=new f(i.count*c);return Promise.resolve(new s.TlE(y,c,m))}const o=[];return i.bufferView!==void 0?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),i.sparse!==void 0&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(c){const f=c[0],m=ol[i.type],y=Gs[i.componentType],w=y.BYTES_PER_ELEMENT,S=w*m,C=i.byteOffset||0,O=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,N=i.normalized===!0;let H,q;if(O&&O!==S){const J=Math.floor(C/O),V="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+J+":"+i.count;let z=t.cache.get(V);z||(H=new y(f,J*O,i.count*O/w),z=new s.vpT(H,O/w),t.cache.add(V,z)),q=new s.kB5(z,m,C%O/w,N)}else H=f===null?new y(i.count*m):new y(f,C,i.count*m),q=new s.TlE(H,m,N);if(i.sparse!==void 0){const J=ol.SCALAR,V=Gs[i.sparse.indices.componentType],z=i.sparse.indices.byteOffset||0,ue=i.sparse.values.byteOffset||0,me=new V(c[1],z,i.sparse.count*J),Te=new y(c[2],ue,i.sparse.count*m);f!==null&&(q=new s.TlE(q.array.slice(),q.itemSize,q.normalized));for(let Be=0,He=me.length;Be<He;Be++){const tt=me[Be];if(q.setX(tt,Te[Be*m]),m>=2&&q.setY(tt,Te[Be*m+1]),m>=3&&q.setZ(tt,Te[Be*m+2]),m>=4&&q.setW(tt,Te[Be*m+3]),m>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return q})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,o=t.images[i];let c=this.textureLoader;if(o.uri){const f=n.manager.getHandler(o.uri);f!==null&&(c=f)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,t,n){const i=this,o=this.json,c=o.textures[e],f=o.images[t],m=(f.uri||f.bufferView)+":"+c.sampler;if(this.textureCache[m])return this.textureCache[m];const y=this.loadImageSource(t,n).then(function(w){w.name=c.name||f.name||"",w.name===""&&typeof f.uri=="string"&&f.uri.startsWith("data:image/")===!1&&(w.name=f.uri);const S=(o.samplers||{})[c.sampler]||{};return w.magFilter=hd[S.magFilter]||s.wem,w.minFilter=hd[S.minFilter]||s.D1R,w.wrapS=Ah[S.wrapS]||s.rpg,w.wrapT=Ah[S.wrapT]||s.rpg,S.extras&&S.extras.uuid!==void 0&&(w.uuid=S.extras.uuid),i.associations.set(w,{textures:e}),w}).catch(function(){return null});return this.textureCache[m]=y,y}loadImageSource(e,t,n=!1,i=!1){const o=this,c=this.json,f=this.options;if(!i&&this.sourceCache[e]!==void 0)return this.sourceCache[e].then(N=>N.clone());const m=c.images[e],y=self.URL||self.webkitURL;m.uri===void 0&&m.extras&&m.extras.uri&&(m.uri=m.extras.uri);let w=m.uri||"",S=!1,C=null;if(m.bufferView===void 0||n&&w){if(m.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView")}else w=o.getDependency("bufferView",m.bufferView).then(function(N){S=!0;const H=new Blob([N],{type:m.mimeType});return w=y.createObjectURL(H),C=H,w});const O=Promise.resolve(w).then(function(N){return new Promise(function(H,q){let J=H;t.isImageBitmapLoader===!0&&(J=function(V){const z=new s.xEZ(V);z.needsUpdate=!0,H(z)}),t.load(s.Zp0.resolveURL(N,f.path),J,void 0,function(V){t.isImageBitmapLoader===!0?(t=new s.dpR(o.options.manager),J=H,t.setCrossOrigin(o.options.crossOrigin),t.setRequestHeader(o.options.requestHeader),t.load(s.Zp0.resolveURL(N,f.path),J,void 0,q)):q(V)})})}).then(function(N){var H;if(S===!0&&y.revokeObjectURL(w),N.userData.mimeType=m.mimeType||((H=m.uri).search(/\.jpe?g($|\?)/i)>0||H.search(/^data\:image\/jpeg/)===0?"image/jpeg":H.search(/\.webp($|\?)/i)>0||H.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),N.flipY=!1,m.extras){if(m.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let q=N;const J=m.extras.flipY&&!q.flipY;createImageBitmap(q.source.data,{imageOrientation:J?"flipY":"none"}).then(function(V){q._newTex&&(q=q._newTex),q.source.data.close&&q.source.data.close(),q.source.data=V,q.source.needsUpdate=!0,q.needsUpdate=!0})}N.flipY=m.extras.flipY,N.needsUpdate=!0,delete m.extras.flipY}m.extras.uuid!==void 0&&(N.source.uuid=m.extras.uuid),m.extras.t_uuid!==void 0&&(N.uuid=m.extras.t_uuid)}return m.uri&&typeof m.uri=="string"&&S===!1&&!m.uri.startsWith("/")&&(N.userData.rootPath=s.Zp0.resolveURL(m.uri,f.path)),C&&(N.userData.__sourceBlob=C),!n&&m.uri&&m.uri!==w&&o.loadImageSource(e,t,!0,!0).then(function(q){N.source.data&&N.source.data.close&&N.source.data.close(),N.dispose(),N.source=q.source,N.source.needsUpdate=!0,N.needsUpdate=!0,N.uuid=q.uuid,N.flipY=q.flipY,N.userData=q.userData,N.setDirty&&N.setDirty(),q._newTex=N}),N}).catch(function(N){throw console.error("THREE.GLTFLoader: Couldn't load texture",w),N});return this.sourceCache[e]=O,O}assignTexture(e,t,n,i){const o=this;return this.getDependency("texture",n.index).then(function(c){if(!c)return null;if(n.texCoord!==void 0&&n.texCoord>0&&((c=c.clone()).channel=n.texCoord),o.extensions[fs.KHR_TEXTURE_TRANSFORM]){const f=n.extensions!==void 0?n.extensions[fs.KHR_TEXTURE_TRANSFORM]:void 0;if(f){const m=o.associations.get(c);c=o.extensions[fs.KHR_TEXTURE_TRANSFORM].extendTexture(c,f),o.associations.set(c,m)}}return i!==void 0&&(c.colorSpace=i),e[t]=c,c})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,c=t.attributes.normal===void 0;if(e.isPoints){const f="PointsMaterial:"+n.uuid;let m=this.cache.get(f);m||(m=new s.UY4,s.F5T.prototype.copy.call(m,n),m.color.copy(n.color),m.map=n.map,m.sizeAttenuation=!1,this.cache.add(f,m)),n=m}else if(e.isLine){const f="LineBasicMaterial:"+n.uuid;let m=this.cache.get(f);m||(m=new s.nls,s.F5T.prototype.copy.call(m,n),m.color.copy(n.color),m.map=n.map,this.cache.add(f,m)),n=m}if(i||o||c){let f="ClonedMaterial:"+n.uuid+":";i&&(f+="derivative-tangents:"),o&&(f+="vertex-colors:"),c&&(f+="flat-shading:");let m=this.cache.get(f);m||(m=n.clone(),o&&(m.vertexColors=!0),c&&(m.flatShading=!0),i&&(m.normalScale&&(m.normalScale.y*=-1),m.clearcoatNormalScale&&(m.clearcoatNormalScale.y*=-1)),this.cache.add(f,m),this.associations.set(m,this.associations.get(n))),n=m}e.material=n}getMaterialType(){return s.Wid}loadMaterial(e){const t=this,n=this.json,i=this.extensions,o=n.materials[e];let c;const f={},m=[];if((o.extensions||{})[fs.KHR_MATERIALS_UNLIT]){const w=i[fs.KHR_MATERIALS_UNLIT];c=w.getMaterialType(),m.push(w.extendParams(f,o,t))}else{const w=o.pbrMetallicRoughness||{};if(f.color=new s.Ilk(1,1,1),f.opacity=1,Array.isArray(w.baseColorFactor)){const S=w.baseColorFactor;f.color.fromArray(S),f.opacity=S[3]}w.baseColorTexture!==void 0&&m.push(t.assignTexture(f,"map",w.baseColorTexture,s.KI_)),f.metalness=w.metallicFactor!==void 0?w.metallicFactor:1,f.roughness=w.roughnessFactor!==void 0?w.roughnessFactor:1,w.metallicRoughnessTexture!==void 0&&(m.push(t.assignTexture(f,"metalnessMap",w.metallicRoughnessTexture)),m.push(t.assignTexture(f,"roughnessMap",w.metallicRoughnessTexture))),c=this._invokeOne(function(S){return S.getMaterialType&&S.getMaterialType(e)}),m.push(Promise.all(this._invokeAll(function(S){return S.extendMaterialParams&&S.extendMaterialParams(e,f)})))}o.doubleSided===!0&&(f.side=s.ehD);const y=o.alphaMode||"OPAQUE";if(y==="BLEND"?(f.transparent=!0,f.depthWrite=!1):(f.transparent=!1,y==="MASK"&&(f.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&c!==s.vBJ&&(m.push(t.assignTexture(f,"normalMap",o.normalTexture)),f.normalScale=new s.FM8(1,1),o.normalTexture.scale!==void 0)){const w=o.normalTexture.scale;f.normalScale.set(w,w)}return o.occlusionTexture!==void 0&&c!==s.vBJ&&(m.push(t.assignTexture(f,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(f.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&c!==s.vBJ&&(f.emissive=new s.Ilk().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&c!==s.vBJ&&m.push(t.assignTexture(f,"emissiveMap",o.emissiveTexture,s.KI_)),Promise.all(m).then(function(){const w=new c(f);return o.name&&(w.name=o.name),Il(w,o),t.associations.set(w,{materials:e}),o.extensions&&Rl(i,w,o),w})}createUniqueName(e){const t=s.iUV.sanitizeNodeName(e||"");let n=t;for(let i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function o(f){return n[fs.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(f,t).then(function(m){return $p(m,f,t)})}const c=[];for(let f=0,m=e.length;f<m;f++){const y=e[f],w=rv(y),S=i[w];if(S)c.push(S.promise);else{let C;C=y.extensions&&y.extensions[fs.KHR_DRACO_MESH_COMPRESSION]?o(y):$p(new s.u9r,y,t),i[w]={primitive:y,promise:C},c.push(C)}}return Promise.all(c)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],c=o.primitives,f=[];for(let y=0,w=c.length;y<w;y++){const S=c[y].material===void 0?((m=this.cache).DefaultMaterial===void 0&&(m.DefaultMaterial=new s.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:s.Wl3})),m.DefaultMaterial):this.getDependency("material",c[y].material);f.push(S)}var m;return f.push(t.loadGeometries(c)),Promise.all(f).then(function(y){const w=y.slice(0,y.length-1),S=y[y.length-1],C=[];for(let N=0,H=S.length;N<H;N++){const q=S[N],J=c[N];let V;const z=w[N];if(J.mode===Ji.TRIANGLES||J.mode===Ji.TRIANGLE_STRIP||J.mode===Ji.TRIANGLE_FAN||J.mode===void 0)V=o.isSkinnedMesh===!0?new s.TUv(q,z):new s.Kj0(q,z),V.isSkinnedMesh===!0&&V.normalizeSkinWeights(),J.mode===Ji.TRIANGLE_STRIP?V.geometry=ge(V.geometry,s.UlW):J.mode===Ji.TRIANGLE_FAN&&(V.geometry=ge(V.geometry,s.z$h));else if(J.mode===Ji.LINES)V=new s.ejS(q,z);else if(J.mode===Ji.LINE_STRIP)V=new s.x12(q,z);else if(J.mode===Ji.LINE_LOOP)V=new s.blk(q,z);else{if(J.mode!==Ji.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+J.mode);V=new s.woe(q,z)}Object.keys(V.geometry.morphAttributes).length>0&&Yf(V,o),V.name=t.createUniqueName(o.name||"mesh_"+e),V.geometry&&o.extras&&o.extras.isGeometryUserData?(Il(V.geometry,o),J.extensions&&Rl(i,V.geometry,J)):(Il(V,o),J.extensions&&Rl(i,V,J)),t.assignFinalMaterial(V),C.push(V)}o.extensions&&C.forEach(N=>Rl(i,N,o));for(let N=0,H=C.length;N<H;N++)t.associations.set(C[N],{meshes:e,primitives:N});if(C.length===1)return C[0];const O=new s.ZAu;t.associations.set(O,{meshes:e});for(let N=0,H=C.length;N<H;N++)O.add(C[N]);return O})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return n.type==="perspective"?t=new s.cPb(s.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new s.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Il(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,o=t.joints.length;i<o;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const o=i.pop(),c=i,f=[],m=[];for(let y=0,w=c.length;y<w;y++){const S=c[y];if(S){f.push(S);const C=new s.yGw;o!==null&&C.fromArray(o.array,16*y),m.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[y])}return new s.OdW(f,m)})}loadAnimation(e){const t=this.json.animations[e],n=t.name?t.name:"animation_"+e,i=[],o=[],c=[],f=[],m=[];for(let y=0,w=t.channels.length;y<w;y++){const S=t.channels[y],C=t.samplers[S.sampler],O=S.target,N=O.node,H=t.parameters!==void 0?t.parameters[C.input]:C.input,q=t.parameters!==void 0?t.parameters[C.output]:C.output;O.node!==void 0&&(i.push(this.getDependency("node",N)),o.push(this.getDependency("accessor",H)),c.push(this.getDependency("accessor",q)),f.push(C),m.push(O))}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(c),Promise.all(f),Promise.all(m)]).then(function(y){const w=y[0],S=y[1],C=y[2],O=y[3],N=y[4],H=[];for(let q=0,J=w.length;q<J;q++){const V=w[q],z=S[q],ue=C[q],me=O[q],Te=N[q];if(V===void 0)continue;let Be;switch(V.updateMatrix(),Ha[Te.path]){case Ha.weights:Be=s.dUE;break;case Ha.rotation:Be=s.iLg;break;default:Be=s.yC1}const He=V.name?V.name:V.uuid,tt=me.interpolation!==void 0?dc[me.interpolation]:s.NMF,lt=[];Ha[Te.path]===Ha.weights?V.traverse(function(St){St.morphTargetInfluences&&lt.push(St.name?St.name:St.uuid)}):lt.push(He);let at=ue.array;if(ue.normalized){const St=Kf(at.constructor),mt=new Float32Array(at.length);for(let gt=0,Ot=at.length;gt<Ot;gt++)mt[gt]=at[gt]*St;at=mt}for(let St=0,mt=lt.length;St<mt;St++){const gt=new Be(lt[St]+"."+Ha[Te.path],z.array,at,tt);me.interpolation==="CUBICSPLINE"&&(gt.createInterpolant=function(Ot){return new(this instanceof s.iLg?li:rs)(this.times,this.values,this.getValueSize()/3,Ot)},gt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),H.push(gt)}}return new s.m7l(n,void 0,H)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(o){const c=n._getNodeRef(n.meshCache,i.mesh,o);return i.weights!==void 0&&c.traverse(function(f){if(f.isMesh)for(let m=0,y=i.weights.length;m<y;m++)f.morphTargetInfluences[m]=i.weights[m]}),c})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),o=[],c=n.children||[];for(let m=0,y=c.length;m<y;m++)o.push(t.getDependency("node",c[m]));const f=n.skin===void 0?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(o),f]).then(function(m){const y=m[0],w=m[1],S=m[2];S!==null&&y.traverse(function(C){C.isSkinnedMesh&&C.bind(S,Wa)});for(let C=0,O=w.length;C<O;C++)y.add(w[C]);return y})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],c=o.name?i.createUniqueName(o.name):"",f=[],m=i._invokeOne(function(y){return y.createNodeMesh&&y.createNodeMesh(e)});return m&&f.push(m),o.camera!==void 0&&f.push(i.getDependency("camera",o.camera).then(function(y){return i._getNodeRef(i.cameraCache,o.camera,y)})),i._invokeAll(function(y){return y.createNodeAttachment&&y.createNodeAttachment(e)}).forEach(function(y){f.push(y)}),this.nodeCache[e]=Promise.all(f).then(function(y){let w;if(w=o.isBone===!0?new s.N$j:y.length>1?new s.ZAu:y.length===1?y[0]:new s.Tme,w!==y[0])for(let S=0,C=y.length;S<C;S++)w.add(y[S]);if(o.name&&(w.userData.name=o.name,w.name=c),Il(w,o),o.extensions&&Rl(n,w,o),o.matrix!==void 0){const S=new s.yGw;S.fromArray(o.matrix),w.applyMatrix4(S)}else o.translation!==void 0&&w.position.fromArray(o.translation),o.rotation!==void 0&&w.quaternion.fromArray(o.rotation),o.scale!==void 0&&w.scale.fromArray(o.scale);return i.associations.has(w)||i.associations.set(w,{}),i.associations.get(w).nodes=e,w}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,o=new s.ZAu;n.name&&(o.name=i.createUniqueName(n.name)),Il(o,n),n.extensions&&Rl(t,o,n);const c=n.nodes||[],f=[];for(let m=0,y=c.length;m<y;m++)f.push(i.getDependency("node",c[m]));return Promise.all(f).then(function(m){for(let y=0,w=m.length;y<w;y++)o.add(m[y]);return i.associations=(y=>{const w=new Map;for(const[S,C]of i.associations)(S instanceof s.F5T||S instanceof s.xEZ)&&w.set(S,C);return y.traverse(S=>{const C=i.associations.get(S);C!=null&&w.set(S,C)}),w})(o),o})}}function $p(l,e,t){const n=e.attributes,i=[];function o(c,f){return t.getDependency("accessor",c).then(function(m){l.setAttribute(f,m)})}for(const c in n){const f=hc[c]||c.toLowerCase();f in l.attributes||i.push(o(n[c],f))}if(e.indices!==void 0&&!l.index){const c=t.getDependency("accessor",e.indices).then(function(f){l.setIndex(f)});i.push(c)}return Il(l,e),function(c,f,m){const y=f.attributes,w=new s.ZzF;if(y.POSITION===void 0)return;{const O=m.json.accessors[y.POSITION],N=O.min,H=O.max;if(N===void 0||H===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(w.set(new s.Pa4(N[0],N[1],N[2]),new s.Pa4(H[0],H[1],H[2])),O.normalized){const q=Kf(Gs[O.componentType]);w.min.multiplyScalar(q),w.max.multiplyScalar(q)}}const S=f.targets;if(S!==void 0){const O=new s.Pa4,N=new s.Pa4;for(let H=0,q=S.length;H<q;H++){const J=S[H];if(J.POSITION!==void 0){const V=m.json.accessors[J.POSITION],z=V.min,ue=V.max;if(z!==void 0&&ue!==void 0){if(N.setX(Math.max(Math.abs(z[0]),Math.abs(ue[0]))),N.setY(Math.max(Math.abs(z[1]),Math.abs(ue[1]))),N.setZ(Math.max(Math.abs(z[2]),Math.abs(ue[2]))),V.normalized){const me=Kf(Gs[V.componentType]);N.multiplyScalar(me)}O.max(N)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}w.expandByVector(O)}c.boundingBox=w;const C=new s.aLr;w.getCenter(C.center),C.radius=w.min.distanceTo(w.max)/2,c.boundingSphere=C}(l,e,t),Promise.all(i).then(function(){return e.targets!==void 0?function(c,f,m){let y=!1,w=!1,S=!1;for(let H=0,q=f.length;H<q;H++){const J=f[H];if(J.POSITION!==void 0&&(y=!0),J.NORMAL!==void 0&&(w=!0),J.COLOR_0!==void 0&&(S=!0),y&&w&&S)break}if(!y&&!w&&!S)return Promise.resolve(c);const C=[],O=[],N=[];for(let H=0,q=f.length;H<q;H++){const J=f[H];if(y){const V=J.POSITION!==void 0?m.getDependency("accessor",J.POSITION):c.attributes.position;C.push(V)}if(w){const V=J.NORMAL!==void 0?m.getDependency("accessor",J.NORMAL):c.attributes.normal;O.push(V)}if(S){const V=J.COLOR_0!==void 0?m.getDependency("accessor",J.COLOR_0):c.attributes.color;N.push(V)}}return Promise.all([Promise.all(C),Promise.all(O),Promise.all(N)]).then(function(H){const q=H[0],J=H[1],V=H[2];return y&&(c.morphAttributes.position=q),w&&(c.morphAttributes.normal=J),S&&(c.morphAttributes.color=V),c.morphTargetsRelative=!0,c})}(l,e.targets,t):l})}class mu extends wg{constructor(e){super(e),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push($f)}async preparse(e,t){for(const n of this.preparsers)e=await n.process(e,t);return e}parse(e,t,n,i,o){this.preparse.call(this,e,o||t).then(c=>c?super.parse(c,t,n,i):i&&i(new ErrorEvent("no data"))).catch(c=>{console.error(c),i&&i(c??new ErrorEvent("unknown error"))})}transform(e,t){const n=e?e.scene||(e.scenes&&e.scenes.length>0?e.scenes[0]:void 0):void 0;return n&&e.animations.length>0&&(n.animations=e.animations),n==null||n.traverse(i=>{i.userData.gltfUUID&&(i.uuid=i.userData.gltfUUID,delete i.userData.gltfUUID)}),n}register(e){return super.register(e)}}const $f={key:(l,e,t)=>l.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+t)||"",async process(l,e){var m;if(typeof l=="string"||!new TextDecoder().decode(new Uint8Array(l,0,100)).includes("WebGiGLBWrapper"))return l;const t=new Wu(l),n=JSON.parse(t.content||"{}");let i=t.body||l;const o=(m=n.asset)==null?void 0:m.encryption;if(!o)return i;const c=o.type,f=o.version;if(c==="aesgcm"&&f===1){const y=await(0,a.getOrCall)(this.key,o,n,e)||"";try{i=(await(0,a.aesGcmDecrypt)(new Uint8Array(i),y)).buffer}catch{throw new ErrorEvent("decryption error")}}return i}};class dd extends s.hH6{constructor(e){super(e),this.type=s.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),i=new s.IEO(n.data,n.width,n.height,s.wk1,this.type);return i.needsUpdate=!0,i.flipY=!0,i.colorSpace=s.KI_,i.minFilter=s.wem,i.magFilter=s.wem,i.source.data.complete=!0,i}async parseAsync(e,t,n=!1){let i=!1;if(!e.startsWith("data:")&&!e.startsWith("blob:")){this.responseType="blob";const m=await super.loadAsync(e,t);e=URL.createObjectURL(m),i=!0}const o=await(0,a.imageUrlToImageData)(e);i&&URL.revokeObjectURL(e);let c=Uint8Array;return this.type===s.cLu?c=Uint16Array:this.type===s.VzW&&(c=Uint32Array),{data:function(m,y=3,w=Uint16Array,S=!1){let C;const O=m.byteLength>>2,N=new w(O*y);for(let H=0;H<O;H++)C=Math.pow(2,m[4*H+3]-136),S?(N[H*y]=Math.min(m[4*H]*C,65504),N[H*y+1]=Math.min(m[4*H+1]*C,65504),N[H*y+2]=Math.min(m[4*H+2]*C,65504)):(N[H*y]=s.A5E.toHalfFloat(Math.min(m[4*H]*C,65504)),N[H*y+1]=s.A5E.toHalfFloat(Math.min(m[4*H+1]*C,65504)),N[H*y+2]=s.A5E.toHalfFloat(Math.min(m[4*H+2]*C,65504))),y===4&&(N[H*y+3]=s.A5E.toHalfFloat(1));return N}(o.data,4,c,n),width:o.width,height:o.height}}setDataType(e){return this.type=e,this}}class Us extends s.Gql{constructor(e){super(e),this._imageLoader=new s.S3k(e)}static async LoadRootPathTextures(e,t,n,i=!0){var c;const o=[];for(const f of Array.isArray(e)?e:Object.values(e??{})){const m=(c=f==null?void 0:f.userData)==null?void 0:c.rootPath,y=i&&f.image&&t[f.image];if(!m)continue;const w=n.importPath(m,{processImported:!1}).then(S=>{const C=S==null?void 0:S[0],O=C==null?void 0:C.source;if(!C||!O)return null;const N=new s.Hw6(O.data);return f.image&&(N.uuid=f.image),f.image=N.uuid,y||(t[N.uuid]=N),C.dispose(),N}).catch(S=>(console.error(S),delete f.userData.rootPath,null));y?f.rootPathPromise=w:o.push(w)}await Promise.allSettled(o)}parseTextures2(e,t,n){var c,f;for(const m of e){const y=(c=m==null?void 0:m.userData)==null?void 0:c.rootPath;if(y&&(!m.image||!t[m.image])){const w=new s.Hw6(this._imageLoader.load(y,n));if(!w)continue;m.image&&(w.uuid=m.image),t[w.uuid]=w,m.image=w.uuid}m.userData=Mi(m.userData,void 0,!1,{images:t})}const i=super.parseTextures(e,t),o={...i};for(const m of e)(f=m.rootPathPromise)==null||f.then(y=>{if(!y)return;const w=o[m.uuid];w.dispose(),w.source=y,w.source.needsUpdate=!0,w.needsUpdate=!0});return i}parseMaterials2(e,t,n){const i={};return e.forEach(o=>{if(!o)return;const c={...o},f=Object.keys(c);for(const y of f)if(y==="map"||y.endsWith("Map")){const w=c[y];typeof w=="string"&&(t[w]?c[y]=t[w]:(console.warn(`Texture ${w} not found`),delete c[y]))}c.userData&&(c.userData=Mi(c.userData,void 0,!1,{textures:t}),c.userData.cloneId&&c.userData.uuid!==o.uuid&&(c.userData.uuid=o.uuid));const m=n.generateFromTemplateType(c.type,c);m&&(i[o.uuid]=m)}),i}}const Vr="WEBGI_viewer";function va(l){return new Js(mu,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,i=new Us(t.loadingManager);return n.register(gu(i,l)),n.register(rp()),n.register(Pl(i)),n.register(o=>new mc(o)),n.register(o=>new gc(o)),n.register(o=>new vu(o)),n.register(o=>new xh(o)),n.register(o=>{var S,C,O,N,H,q,J,V,z;const c=ji()+".drc",f=ji()+".ktx2",m=(O=(C=(S=o.json)==null?void 0:S.extensionsRequired)==null?void 0:C.includes)==null?void 0:O.call(C,"KHR_draco_mesh_compression");if(m){const ue=t.registerFile(c);ue&&n.setDRACOLoader(ue)}((q=(H=(N=o.json)==null?void 0:N.extensionsUsed)==null?void 0:H.includes)==null?void 0:q.call(H,"EXT_meshopt_compression"))&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),o.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const w=(z=(V=(J=o.json)==null?void 0:J.extensionsUsed)==null?void 0:V.includes)==null?void 0:z.call(V,"KHR_texture_basisu");if(w){const ue=t.registerFile(f);ue&&(n.setKTX2Loader(ue),o.options.ktx2Loader=ue)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async ue=>{m&&t.unregisterFile(c),w&&t.unregisterFile(f);const me=await zt(o,l,i);ue.scene&&(ue.scene.__importedViewerConfig=me)}}}),n})}const pc="WEBGI_light_extras",jc="WEBGI_object3d_extras",ko="WEBGI_material_extras",rp=l=>e=>({name:"__"+jc,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var f,m;if(!i.isObject3D)return;const o=(m=(f=i.userData)==null?void 0:f.gltfExtensions)==null?void 0:m[jc];if(!o)return void(i.isLight&&!i.isAmbientLight&&(i.castShadow=!0));const c=o.castShadow!==void 0||o.receiveShadow!==void 0;o.castShadow!==void 0&&(i.castShadow=o.castShadow),o.receiveShadow!==void 0&&(i.receiveShadow=o.receiveShadow),o.visible!==void 0&&(i.visible=o.visible),o.frustumCulled!==void 0&&(i.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(i.renderOrder=o.renderOrder),o.layers!==void 0&&(i.layers.mask=o.layers),c&&(i.userData.__keepShadowDef=!0),delete i.userData.gltfExtensions[jc]})})}}),gu=(l,e)=>t=>({name:"__"+ko,afterRoot:async n=>{var o,c,f;const i=n.scenes||(n.scene?[n.scene]:[]);for(const m of i){const y=(c=(o=m.userData)==null?void 0:o.gltfExtensions)==null?void 0:c[ko],w=y&&await((f=e.getPlugin(fi))==null?void 0:f.importConfigResources(y.resources||{}))||{};m.traverse(S=>{var N,H;const C=S==null?void 0:S.material;if(!(C!=null&&C.isMaterial))return;const O=(H=(N=C.userData)==null?void 0:N.gltfExtensions)==null?void 0:H[ko];O&&(O.emissiveIntensity!==void 0&&(C.emissiveIntensity=O.emissiveIntensity),O.fog!==void 0&&(C.fog=O.fog),O.flatShading!==void 0&&(C.flatShading=O.flatShading),O.blending!==void 0&&(C.blending=O.blending),O.side!==void 0&&(C.side=O.side),O.shadowSide!==void 0&&(C.shadowSide=O.shadowSide),O.depthFunc!==void 0&&(C.depthFunc=O.depthFunc),O.depthTest!==void 0&&(C.depthTest=O.depthTest),O.depthWrite!==void 0&&(C.depthWrite=O.depthWrite),O.colorWrite!==void 0&&(C.colorWrite=O.colorWrite),O.vertexColors!==void 0&&(C.vertexColors=O.vertexColors),O.alphaTest!==void 0&&(C.alphaTest=O.alphaTest),O.wireframe!==void 0&&(C.wireframe=O.wireframe),O.wireframeLinewidth!==void 0&&(C.wireframeLinewidth=O.wireframeLinewidth),O.wireframeLinecap!==void 0&&(C.wireframeLinecap=O.wireframeLinecap),O.wireframeLinejoin!==void 0&&(C.wireframeLinejoin=O.wireframeLinejoin),O.rotation!==void 0&&(C.rotation=O.rotation),O.polygonOffset!==void 0&&(C.polygonOffset=O.polygonOffset),O.polygonOffsetFactor!==void 0&&(C.polygonOffsetFactor=O.polygonOffsetFactor),O.polygonOffsetUnits!==void 0&&(C.polygonOffsetUnits=O.polygonOffsetUnits),O.dithering!==void 0&&(C.dithering=O.dithering),O.alphaToCoverage!==void 0&&(C.alphaToCoverage=O.alphaToCoverage),O.premultipliedAlpha!==void 0&&(C.premultipliedAlpha=O.premultipliedAlpha),O.toneMapped!==void 0&&(C.toneMapped=O.toneMapped),O.normalScale!==void 0&&C.normalScale!==void 0&&(Array.isArray(O.normalScale)?C.normalScale.fromArray(O.normalScale):typeof O.normalScale=="number"?C.normalScale.set(O.normalScale,O.normalScale):e.console.warn("normalScale is not an array or number",O.normalScale)),O.reflectivity!==void 0&&(C.reflectivity=O.reflectivity),Object.entries(O).forEach(([q,J])=>{q.startsWith("_")||J&&J.resource&&typeof J.resource=="string"&&(C[q]=Mi(J,C[q],!1,w))}),delete C.userData.gltfExtensions[ko])}),y&&delete m.userData.gltfExtensions[ko]}}}),Pl=l=>e=>({name:"__"+pc,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(i=>{var c,f;if(!i.isLight)return;const o=(f=(c=i.userData)==null?void 0:c.gltfExtensions)==null?void 0:f[pc];o&&(!i.shadow&&o.shadow&&console.error("Light has no shadow, cannot import",i,o),o.shadow&&i.shadow&&(o.shadow.bias!==void 0&&(i.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(i.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(i.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(i.shadow.camera=l.parseObject(o.shadow.camera))),delete i.userData.gltfExtensions[pc])})})}});async function zt(l,e,t,n){var m,y,w;if(!n){const S=l.json.scenes||[];if(S.length!==1){for(const C of S)await zt(l,e,t,C);return}n=S[0]}const i=(m=n.extensions)==null?void 0:m[Vr];if(!i)return;const o=[];Object.values(i.resources).forEach(S=>{Object.values(S).forEach(C=>{C.url&&(C.url.type==="Uint16Array"&&C.url.data&&o.push(C.url),C.url.type==="Uint8Array"&&C.url.data&&o.push(C.url))})});for(const S of o){const C=S.data.image,O=l.json.images[C],N=await l.getDependency("bufferView",O.bufferView);if(O.mimeType.startsWith("image/")&&S.type==="Uint16Array"&&S.encoding==="rgbe"){const H=new Blob([N]);let q=URL.createObjectURL(H);(S.encodingVersion||1)<2&&(q="data:image/png;base64,"+btoa(await H.text())),S.data=(await new dd().parseAsync(q,void 0,!0)).data,URL.revokeObjectURL(q),delete S.encoding,delete S.encodingVersion}else S.data=N}const c={textures:{},materials:{}},f=i.resources;if(f.textures&&l.json.textures)for(const[S,C]of[...Object.entries(f.textures)]){if(C.uuid||!S)continue;delete f.textures[S];const O=l.json.textures.findIndex(N=>{var H,q,J,V,z,ue,me;return((H=N.extras)==null?void 0:H.uuid)===S||((V=(J=(q=l.json.samplers)==null?void 0:q[N.sampler])==null?void 0:J.extras)==null?void 0:V.uuid)===S||((me=(ue=(z=l.json.images)==null?void 0:z[N.source])==null?void 0:ue.extras)==null?void 0:me.t_uuid)===S});O>=0&&(c.textures[S]=await l.getDependency("texture",O))}if(f.materials&&l.json.materials)for(const[S,C]of[...Object.entries(f.materials)]){if(C.uuid||!S)continue;delete f.materials[S];const O=l.json.materials.findIndex(N=>{var H;return((H=N.extras)==null?void 0:H.uuid)===S});O>=0&&(c.materials[S]=await l.getDependency("material",O),c.materials[S]=(w=(y=e.getPlugin(fi))==null?void 0:y.materials)==null?void 0:w.processMaterial(c.materials[S],{}))}return i.resources=await e.getPlugin(fi).importConfigResources(f||{},t,c),i}const pd="WEBGI_materials_bumpmap",_u="WEBGI_materials_displacementmap",Ql="WEBGI_materials_alphamap",fc="WEBGI_materials_lightmap";class mc{constructor(e){this.parser=e,this.name=pd}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.bumpScale!==void 0&&(t.bumpScale=c.bumpScale),c.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",c.bumpTexture)),Promise.all(o)}}class gc{constructor(e){this.parser=e,this.name=_u}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.displacementScale!==void 0&&(t.displacementScale=c.displacementScale),c.displacementBias!==void 0&&(t.displacementBias=c.displacementBias),c.displacementTexture!==void 0&&o.push(n.assignTexture(t,"displacementMap",c.displacementTexture)),Promise.all(o)}}class vu{constructor(e){this.parser=e,this.name=fc}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.lightMapIntensity!==void 0&&(t.lightMapIntensity=c.lightMapIntensity),c.lightMapTexture!==void 0&&o.push(n.assignTexture(t,"lightMap",c.lightMapTexture)),Promise.all(o)}}class xh{constructor(e){this.parser=e,this.name=Ql}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];return c.alphaTexture!==void 0&&o.push(n.assignTexture(t,"alphaMap",c.alphaTexture)),Promise.all(o)}}var Qa=__webpackgi_require__(23);function Vc(){return new Js(Qa.Q,["drc"],!0)}class Gc extends s.Ox3{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new s.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Ma(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=di(Ma({},t),!1),this.userData={},this.children=n,i.type="DirectionalLight2",i.target=this.target.position.toArray(),Object.assign(i,di(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,i=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,Mi(e,this,!0,t),n&&(e.target=n),i&&(i.color!==void 0&&this.color.set(i.color),i.intensity!==void 0&&(this.intensity=i.intensity),e.object=i),this}}class yu extends s.PMe{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i,o,c){super(e,t,n,i,o,c),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(e,t){const n=this.target,i=e.userData;return e.userData={},super.copy(e,t),Ma(this.userData,i),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const i=super.toJSON(e);return i.userData=di(Ma({},t),!1),this.userData={},this.children=n,i.type="SpotLight2",i.target=this.target.position.toArray(),Object.assign(i,di(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),Mi(e,this,!0,t),this):this)}}class wh extends s.cek{get lightObject(){return this}get modelObject(){return this}constructor(e,t,n,i){super(e,t,n,i),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Ma(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)==null||e.dispose(),(t=this.shadow.mapPass)==null||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=di(Ma({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,di(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),Mi(e,this,!0,t),this):this}}class Eh extends s.Mig{get lightObject(){return this}get modelObject(){return this}constructor(e,t){super(e,t),this.assetType="light"}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),Ma(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=di(Ma({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,di(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),Mi(e,this,!0,t),this):this}}class Jf extends s.aNw{load(e,t,n,i){const o=new s.hH6(this.manager);o.setPath(this.path),o.setResponseType("text"),o.load(e,c=>{try{t(this.parse(c))}catch(f){i?i(f):console.error(f),this.manager.itemError(e)}},n,i)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const i=new s.Pa4(0,0,0),o=new s.Pa4(1,1,1),c=e.split(/[\n\r]+/g);let f=null,m=0;for(let S=0,C=c.length;S<C;S++){const O=c[S].trim(),N=O.split(/\s/g);switch(N[0]){case"TITLE":t=O.substring(7,O.length-1);break;case"LUT_3D_SIZE":const H=N[1];n=parseFloat(H),f=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":i.x=parseFloat(N[1]),i.y=parseFloat(N[2]),i.z=parseFloat(N[3]);break;case"DOMAIN_MAX":o.x=parseFloat(N[1]),o.y=parseFloat(N[2]),o.z=parseFloat(N[3]);break;default:const q=parseFloat(N[0]),J=parseFloat(N[1]),V=parseFloat(N[2]);if(q>1||q<0||J>1||J<0||V>1||V<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");f[m+0]=255*q,f[m+1]=255*J,f[m+2]=255*V,f[m+3]=255,m+=4}}const y=new s.IEO;y.image.data=f,y.image.width=n,y.image.height=n*n,y.type=s.ywz,y.magFilter=s.wem,y.minFilter=s.wem,y.wrapS=s.uWy,y.wrapT=s.uWy,y.generateMipmaps=!1,y.needsUpdate=!0;const w=new s.JUT;return w.image.data=f,w.image.width=n,w.image.height=n,w.image.depth=n,w.type=s.ywz,w.magFilter=s.wem,w.minFilter=s.wem,w.wrapS=s.uWy,w.wrapT=s.uWy,w.wrapR=s.uWy,w.generateMipmaps=!1,w.needsUpdate=!0,{title:t,size:n,domainMin:i,domainMax:o,texture:y,texture3D:w}}}let Hc=class{constructor({domainMax:l,domainMin:e,size:t,texture:n,texture3D:i,title:o}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=l,this.domainMin=e,this.size=t,this.texture=n,this.texture3D=i,this.title=o,this.uuid=se(),this.userData.__needsSourceBuffer=!0}fromJSON(l,e){return l.type!==this.type&&console.warn("type mismatch while import",l,this),console.error("not supported"),this}toJSON(l){return Xr(this,l,this.texture.name)}};Hc=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([jr("LUTCubeTextureWrapper")],Hc);class Jp extends Jf{parse(e){const t=super.parse(e);return new Hc(t)}}var sv={},ss=Uint8Array,Xo=Uint16Array,la=Uint32Array,al=new ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Au=new ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Zs=new ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_c=function(l,e){for(var t=new Xo(31),n=0;n<31;++n)t[n]=e+=1<<l[n-1];var i=new la(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return[t,i]},fd=_c(al,2),sp=fd[0],op=fd[1];sp[28]=258,op[258]=28;for(var Sh=_c(Au,0),Gr=Sh[0],bu=Sh[1],ya=new Xo(32768),Hs=0;Hs<32768;++Hs){var md=(43690&Hs)>>>1|(21845&Hs)<<1;md=(61680&(md=(52428&md)>>>2|(13107&md)<<2))>>>4|(3855&md)<<4,ya[Hs]=((65280&md)>>>8|(255&md)<<8)>>>1}var Uo=function(l,e,t){for(var n=l.length,i=0,o=new Xo(e);i<n;++i)++o[l[i]-1];var c,f=new Xo(e);for(i=0;i<e;++i)f[i]=f[i-1]+o[i-1]<<1;if(t){c=new Xo(1<<e);var m=15-e;for(i=0;i<n;++i)if(l[i])for(var y=i<<4|l[i],w=e-l[i],S=f[l[i]-1]++<<w,C=S|(1<<w)-1;S<=C;++S)c[ya[S]>>>m]=y}else for(c=new Xo(n),i=0;i<n;++i)l[i]&&(c[i]=ya[f[l[i]-1]++]>>>15-l[i]);return c},ca=new ss(288);for(Hs=0;Hs<144;++Hs)ca[Hs]=8;for(Hs=144;Hs<256;++Hs)ca[Hs]=9;for(Hs=256;Hs<280;++Hs)ca[Hs]=7;for(Hs=280;Hs<288;++Hs)ca[Hs]=8;var ua=new ss(32);for(Hs=0;Hs<32;++Hs)ua[Hs]=5;var Zf=Uo(ca,9,0),Zp=Uo(ca,9,1),Mh=Uo(ua,5,0),Th=Uo(ua,5,1),em=function(l){for(var e=l[0],t=1;t<l.length;++t)l[t]>e&&(e=l[t]);return e},ha=function(l,e,t){var n=e/8|0;return(l[n]|l[n+1]<<8)>>(7&e)&t},xu=function(l,e){var t=e/8|0;return(l[t]|l[t+1]<<8|l[t+2]<<16)>>(7&e)},wo=function(l){return(l/8|0)+(7&l&&1)},ll=function(l,e,t){(e==null||e<0)&&(e=0),(t==null||t>l.length)&&(t=l.length);var n=new(l instanceof Xo?Xo:l instanceof la?la:ss)(t-e);return n.set(l.subarray(e,t)),n},qa=function(l,e,t){var n=l.length;if(!n||t&&!t.l&&n<5)return e||new ss(0);var i=!e||t,o=!t||t.i;t||(t={}),e||(e=new ss(3*n));var c=function(ki){var Xi=e.length;if(ki>Xi){var ts=new ss(Math.max(2*Xi,ki));ts.set(e),e=ts}},f=t.f||0,m=t.p||0,y=t.b||0,w=t.l,S=t.d,C=t.m,O=t.n,N=8*n;do{if(!w){t.f=f=ha(l,m,1);var H=ha(l,m+1,3);if(m+=3,!H){var q=l[(at=wo(m)+4)-4]|l[at-3]<<8,J=at+q;if(J>n){if(o)throw"unexpected EOF";break}i&&c(y+q),e.set(l.subarray(at,J),y),t.b=y+=q,t.p=m=8*J;continue}if(H==1)w=Zp,S=Th,C=9,O=5;else{if(H!=2)throw"invalid block type";var V=ha(l,m,31)+257,z=ha(l,m+10,15)+4,ue=V+ha(l,m+5,31)+1;m+=14;for(var me=new ss(ue),Te=new ss(19),Be=0;Be<z;++Be)Te[Zs[Be]]=ha(l,m+3*Be,7);m+=3*z;var He=em(Te),tt=(1<<He)-1,lt=Uo(Te,He,1);for(Be=0;Be<ue;){var at,St=lt[ha(l,m,tt)];if(m+=15&St,(at=St>>>4)<16)me[Be++]=at;else{var mt=0,gt=0;for(at==16?(gt=3+ha(l,m,3),m+=2,mt=me[Be-1]):at==17?(gt=3+ha(l,m,7),m+=3):at==18&&(gt=11+ha(l,m,127),m+=7);gt--;)me[Be++]=mt}}var Ot=me.subarray(0,V),Bt=me.subarray(V);C=em(Ot),O=em(Bt),w=Uo(Ot,C,1),S=Uo(Bt,O,1)}if(m>N){if(o)throw"unexpected EOF";break}}i&&c(y+131072);for(var Ft=(1<<C)-1,_n=(1<<O)-1,mn=m;;mn=m){var qn=(mt=w[xu(l,m)&Ft])>>>4;if((m+=15&mt)>N){if(o)throw"unexpected EOF";break}if(!mt)throw"invalid length/literal";if(qn<256)e[y++]=qn;else{if(qn==256){mn=m,w=null;break}var Rn=qn-254;if(qn>264){var En=al[Be=qn-257];Rn=ha(l,m,(1<<En)-1)+sp[Be],m+=En}var ai=S[xu(l,m)&_n],ri=ai>>>4;if(!ai)throw"invalid distance";if(m+=15&ai,Bt=Gr[ri],ri>3&&(En=Au[ri],Bt+=xu(l,m)&(1<<En)-1,m+=En),m>N){if(o)throw"unexpected EOF";break}i&&c(y+131072);for(var Ei=y+Rn;y<Ei;y+=4)e[y]=e[y-Bt],e[y+1]=e[y+1-Bt],e[y+2]=e[y+2-Bt],e[y+3]=e[y+3-Bt];y=Ei}}t.l=w,t.p=mn,t.b=y,w&&(f=1,t.m=C,t.d=S,t.n=O)}while(!f);return y==e.length?e:ll(e,0,y)},Wc=function(l,e,t){t<<=7&e;var n=e/8|0;l[n]|=t,l[n+1]|=t>>>8},Qu=function(l,e,t){t<<=7&e;var n=e/8|0;l[n]|=t,l[n+1]|=t>>>8,l[n+2]|=t>>>16},ef=function(l,e){for(var t=[],n=0;n<l.length;++n)l[n]&&t.push({s:n,f:l[n]});var i=t.length,o=t.slice();if(!i)return[Ra,0];if(i==1){var c=new ss(t[0].s+1);return c[t[0].s]=1,[c,1]}t.sort(function(me,Te){return me.f-Te.f}),t.push({s:-1,f:25001});var f=t[0],m=t[1],y=0,w=1,S=2;for(t[0]={s:-1,f:f.f+m.f,l:f,r:m};w!=i-1;)f=t[t[y].f<t[S].f?y++:S++],m=t[y!=w&&t[y].f<t[S].f?y++:S++],t[w++]={s:-1,f:f.f+m.f,l:f,r:m};var C=o[0].s;for(n=1;n<i;++n)o[n].s>C&&(C=o[n].s);var O=new Xo(C+1),N=tf(t[w-1],O,0);if(N>e){n=0;var H=0,q=N-e,J=1<<q;for(o.sort(function(me,Te){return O[Te.s]-O[me.s]||me.f-Te.f});n<i;++n){var V=o[n].s;if(!(O[V]>e))break;H+=J-(1<<N-O[V]),O[V]=e}for(H>>>=q;H>0;){var z=o[n].s;O[z]<e?H-=1<<e-O[z]++-1:++n}for(;n>=0&&H;--n){var ue=o[n].s;O[ue]==e&&(--O[ue],++H)}N=e}return[new ss(O),N]},tf=function(l,e,t){return l.s==-1?Math.max(tf(l.l,e,t+1),tf(l.r,e,t+1)):e[l.s]=t},wu=function(l){for(var e=l.length;e&&!l[--e];);for(var t=new Xo(++e),n=0,i=l[0],o=1,c=function(m){t[n++]=m},f=1;f<=e;++f)if(l[f]==i&&f!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)c(32754);o>2&&(c(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(c(i),--o;o>6;o-=6)c(8304);o>2&&(c(o-3<<5|8208),o=0)}for(;o--;)c(i);o=1,i=l[f]}return[t.subarray(0,n),e]},Ch=function(l,e){for(var t=0,n=0;n<e.length;++n)t+=l[n]*e[n];return t},Qc=function(l,e,t){var n=t.length,i=wo(e+2);l[i]=255&n,l[i+1]=n>>>8,l[i+2]=255^l[i],l[i+3]=255^l[i+1];for(var o=0;o<n;++o)l[i+o+4]=t[o];return 8*(i+4+n)},bs=function(l,e,t,n,i,o,c,f,m,y,w){Wc(e,w++,t),++i[256];for(var S=ef(i,15),C=S[0],O=S[1],N=ef(o,15),H=N[0],q=N[1],J=wu(C),V=J[0],z=J[1],ue=wu(H),me=ue[0],Te=ue[1],Be=new Xo(19),He=0;He<V.length;++He)Be[31&V[He]]++;for(He=0;He<me.length;++He)Be[31&me[He]]++;for(var tt=ef(Be,7),lt=tt[0],at=tt[1],St=19;St>4&&!lt[Zs[St-1]];--St);var mt,gt,Ot,Bt,Ft=y+5<<3,_n=Ch(i,ca)+Ch(o,ua)+c,mn=Ch(i,C)+Ch(o,H)+c+14+3*St+Ch(Be,lt)+(2*Be[16]+3*Be[17]+7*Be[18]);if(Ft<=_n&&Ft<=mn)return Qc(e,w,l.subarray(m,m+y));if(Wc(e,w,1+(mn<_n)),w+=2,mn<_n){mt=Uo(C,O,0),gt=C,Ot=Uo(H,q,0),Bt=H;var qn=Uo(lt,at,0);for(Wc(e,w,z-257),Wc(e,w+5,Te-1),Wc(e,w+10,St-4),w+=14,He=0;He<St;++He)Wc(e,w+3*He,lt[Zs[He]]);w+=3*St;for(var Rn=[V,me],En=0;En<2;++En){var ai=Rn[En];for(He=0;He<ai.length;++He){var ri=31&ai[He];Wc(e,w,qn[ri]),w+=lt[ri],ri>15&&(Wc(e,w,ai[He]>>>5&127),w+=ai[He]>>>12)}}}else mt=Zf,gt=ca,Ot=Mh,Bt=ua;for(He=0;He<f;++He)if(n[He]>255){ri=n[He]>>>18&31,Qu(e,w,mt[ri+257]),w+=gt[ri+257],ri>7&&(Wc(e,w,n[He]>>>23&31),w+=al[ri]);var Ei=31&n[He];Qu(e,w,Ot[Ei]),w+=Bt[Ei],Ei>3&&(Qu(e,w,n[He]>>>5&8191),w+=Au[Ei])}else Qu(e,w,mt[n[He]]),w+=gt[n[He]];return Qu(e,w,mt[256]),w+gt[256]},Ca=new la([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ra=new ss(0),Eu=function(l,e,t,n,i,o){var c=l.length,f=new ss(n+c+5*(1+Math.ceil(c/7e3))+i),m=f.subarray(n,f.length-i),y=0;if(!e||c<8)for(var w=0;w<=c;w+=65535){var S=w+65535;S<c?y=Qc(m,y,l.subarray(w,S)):(m[w]=o,y=Qc(m,y,l.subarray(w,c)))}else{for(var C=Ca[e-1],O=C>>>13,N=8191&C,H=(1<<t)-1,q=new Xo(32768),J=new Xo(H+1),V=Math.ceil(t/3),z=2*V,ue=function(oi){return(l[oi]^l[oi+1]<<V^l[oi+2]<<z)&H},me=new la(25e3),Te=new Xo(288),Be=new Xo(32),He=0,tt=0,lt=(w=0,0),at=0,St=0;w<c;++w){var mt=ue(w),gt=32767&w,Ot=J[mt];if(q[gt]=Ot,J[mt]=gt,at<=w){var Bt=c-w;if((He>7e3||lt>24576)&&Bt>423){y=bs(l,m,0,me,Te,Be,tt,lt,St,w-St,y),lt=He=tt=0,St=w;for(var Ft=0;Ft<286;++Ft)Te[Ft]=0;for(Ft=0;Ft<30;++Ft)Be[Ft]=0}var _n=2,mn=0,qn=N,Rn=gt-Ot&32767;if(Bt>2&&mt==ue(w-Rn))for(var En=Math.min(O,Bt)-1,ai=Math.min(32767,w),ri=Math.min(258,Bt);Rn<=ai&&--qn&&gt!=Ot;){if(l[w+_n]==l[w+_n-Rn]){for(var Ei=0;Ei<ri&&l[w+Ei]==l[w+Ei-Rn];++Ei);if(Ei>_n){if(_n=Ei,mn=Rn,Ei>En)break;var ki=Math.min(Rn,Ei-2),Xi=0;for(Ft=0;Ft<ki;++Ft){var ts=w-Rn+Ft+32768&32767,Cr=ts-q[ts]+32768&32767;Cr>Xi&&(Xi=Cr,Ot=ts)}}}Rn+=(gt=Ot)-(Ot=q[gt])+32768&32767}if(mn){me[lt++]=268435456|op[_n]<<18|bu[mn];var wr=31&op[_n],zn=31&bu[mn];tt+=al[wr]+Au[zn],++Te[257+wr],++Be[zn],at=w+_n,++He}else me[lt++]=l[w],++Te[l[w]]}}y=bs(l,m,o,me,Te,Be,tt,lt,St,w-St,y),!o&&7&y&&(y=Qc(m,y+1,Ra))}return ll(f,0,n+wo(y)+i)},qc=function(){for(var l=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;l[e]=t}return l}(),vc=function(){var l=-1;return{p:function(e){for(var t=l,n=0;n<e.length;++n)t=qc[255&t^e[n]]^t>>>8;l=t},d:function(){return~l}}},yc=function(){var l=1,e=0;return{p:function(t){for(var n=l,i=e,o=t.length,c=0;c!=o;){for(var f=Math.min(c+2655,o);c<f;++c)i+=n+=t[c];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}l=n,e=i},d:function(){return(255&(l%=65521))<<24|l>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Ac=function(l,e,t,n,i){return Eu(l,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(l.length)))):12+e.mem,t,n,!i)},gd=function(l,e){var t={};for(var n in l)t[n]=l[n];for(var n in e)t[n]=e[n];return t},qu=function(l,e,t){for(var n=l(),i=l.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),c=0;c<n.length;++c){var f=n[c],m=o[c];if(typeof f=="function"){e+=";"+m+"=";var y=f.toString();if(f.prototype)if(y.indexOf("[native code]")!=-1){var w=y.indexOf(" ",8)+1;e+=y.slice(w,y.indexOf("(",w))}else for(var S in e+=y,f.prototype)e+=";"+m+".prototype."+S+"="+f.prototype[S].toString();else e+=y}else t[m]=f}return[e,t]},ql=[],_d=function(l,e,t,n){var i;if(!ql[t]){for(var o="",c={},f=l.length-1,m=0;m<f;++m)o=(i=qu(l[m],o,c))[0],c=i[1];ql[t]=qu(l[f],o,c)}var y=gd({},ql[t][1]);return function(w,S,C,O,N){var H=new Worker(sv[S]||(sv[S]=URL.createObjectURL(new Blob([w],{type:"text/javascript"}))));return H.onerror=function(q){return N(q.error,null)},H.onmessage=function(q){return N(null,q.data)},H.postMessage(C,O),H}(ql[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,y,function(w){var S=[];for(var C in w)(w[C]instanceof ss||w[C]instanceof Xo||w[C]instanceof la)&&S.push((w[C]=new w[C].constructor(w[C])).buffer);return S}(y),n)},Cs=function(){return[ss,Xo,la,al,Au,Zs,sp,Gr,Zp,Th,ya,Uo,em,ha,xu,wo,ll,qa,Xu,bc,Xc]},ap=function(){return[ss,Xo,la,al,Au,Zs,op,bu,Zf,ca,Mh,ua,ya,Ca,Ra,Uo,Wc,Qu,ef,tf,wu,Ch,Qc,bs,wo,ll,Eu,Ac,Ph,bc]},da=function(){return[Mg,Ns,Es,vc,qc]},lp=function(){return[ws,vd]},Rh=function(){return[nf,Es,yc]},Fo=function(){return[ov]},bc=function(l){return postMessage(l,[l.buffer])},Xc=function(l){return l&&l.size&&new ss(l.size)},Fi=function(l,e,t,n,i,o){var c=_d(t,n,i,function(f,m){c.terminate(),o(f,m)});return c.postMessage([l,e],e.consume?[l.buffer]:[]),function(){c.terminate()}},Ls=function(l){return l.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return l.push(e.data[0],e.data[1])}},Ia=function(l,e,t,n,i){var o,c=_d(l,n,i,function(f,m){f?(c.terminate(),e.ondata.call(e,f)):(m[1]&&c.terminate(),e.ondata.call(e,f,m[0],m[1]))});c.postMessage(t),e.push=function(f,m){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";c.postMessage([f,o=m],[f.buffer])},e.terminate=function(){c.terminate()}},ho=function(l,e){return l[e]|l[e+1]<<8},po=function(l,e){return(l[e]|l[e+1]<<8|l[e+2]<<16|l[e+3]<<24)>>>0},zo=function(l,e){return po(l,e)+4294967296*po(l,e+4)},Es=function(l,e,t){for(;t;++e)l[e]=t,t>>>=8},Mg=function(l,e){var t=e.filename;if(l[0]=31,l[1]=139,l[2]=8,l[8]=e.level<2?4:e.level==9?2:0,l[9]=3,e.mtime!=0&&Es(l,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){l[3]=8;for(var n=0;n<=t.length;++n)l[n+10]=t.charCodeAt(n)}},ws=function(l){if(l[0]!=31||l[1]!=139||l[2]!=8)throw"invalid gzip data";var e=l[3],t=10;4&e&&(t+=l[10]|2+(l[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!l[t++]);return t+(2&e)},vd=function(l){var e=l.length;return(l[e-4]|l[e-3]<<8|l[e-2]<<16|l[e-1]<<24)>>>0},Ns=function(l){return 10+(l.filename&&l.filename.length+1||0)},nf=function(l,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;l[0]=120,l[1]=n<<6|(n?32-2*n:1)},ov=function(l){if((15&l[0])!=8||l[0]>>>4>7||(l[0]<<8|l[1])%31)throw"invalid zlib data";if(32&l[1])throw"invalid zlib data: preset dictionaries not supported"};function rf(l,e){return e||typeof l!="function"||(e=l,l={}),this.ondata=e,l}var Xl=function(){function l(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return l.prototype.p=function(e,t){this.ondata(Ac(e,this.o,0,0,!t),t)},l.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},l}(),Ih=function(){return function(l,e){Ia([ap,function(){return[Ls,Xl]}],this,rf.call(this,l,e),function(t){var n=new Xl(t.data);onmessage=Ls(n)},6)}}();function Yc(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[ap],function(n){return bc(Ph(n.data[0],n.data[1]))},0,t)}function Ph(l,e){return Ac(l,e||{},0,0)}var Aa=function(){function l(e){this.s={},this.p=new ss(0),this.ondata=e}return l.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new ss(t+e.length);n.set(this.p),n.set(e,t),this.p=n},l.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=qa(this.p,this.o,this.s);this.ondata(ll(n,t,this.s.b),this.d),this.o=ll(n,this.s.b-32768),this.s.b=this.o.length,this.p=ll(this.p,this.s.p/8|0),this.s.p&=7},l.prototype.push=function(e,t){this.e(e),this.c(t)},l}(),tr=function(){return function(l){this.ondata=l,Ia([Cs,function(){return[Ls,Aa]}],this,0,function(){var e=new Aa;onmessage=Ls(e)},7)}}();function cp(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[Cs],function(n){return bc(Xu(n.data[0],Xc(n.data[1])))},1,t)}function Xu(l,e){return qa(l,e)}var pa=function(){function l(e,t){this.c=vc(),this.l=0,this.v=1,Xl.call(this,e,t)}return l.prototype.push=function(e,t){Xl.prototype.push.call(this,e,t)},l.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Ac(e,this.o,this.v&&Ns(this.o),t&&8,!t);this.v&&(Mg(n,this.o),this.v=0),t&&(Es(n,n.length-8,this.c.d()),Es(n,n.length-4,this.l)),this.ondata(n,t)},l}(),sf=function(){return function(l,e){Ia([ap,da,function(){return[Ls,Xl,pa]}],this,rf.call(this,l,e),function(t){var n=new pa(t.data);onmessage=Ls(n)},8)}}();function ie(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[ap,da,function(){return[T]}],function(n){return bc(T(n.data[0],n.data[1]))},2,t)}function T(l,e){e||(e={});var t=vc(),n=l.length;t.p(l);var i=Ac(l,e,Ns(e),8),o=i.length;return Mg(i,e),Es(i,o-8,t.d()),Es(i,o-4,n),i}var F=function(){function l(e){this.v=1,Aa.call(this,e)}return l.prototype.push=function(e,t){if(Aa.prototype.e.call(this,e),this.v){var n=this.p.length>3?ws(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Aa.prototype.c.call(this,t)},l}(),de=function(){return function(l){this.ondata=l,Ia([Cs,lp,function(){return[Ls,Aa,F]}],this,0,function(){var e=new F;onmessage=Ls(e)},9)}}();function Fe(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[Cs,lp,function(){return[Mt]}],function(n){return bc(Mt(n.data[0]))},3,t)}function Mt(l,e){return qa(l.subarray(ws(l),-8),e||new ss(vd(l)))}var kt=function(){function l(e,t){this.c=yc(),this.v=1,Xl.call(this,e,t)}return l.prototype.push=function(e,t){Xl.prototype.push.call(this,e,t)},l.prototype.p=function(e,t){this.c.p(e);var n=Ac(e,this.o,this.v&&2,t&&4,!t);this.v&&(nf(n,this.o),this.v=0),t&&Es(n,n.length-4,this.c.d()),this.ondata(n,t)},l}(),Tn=function(){return function(l,e){Ia([ap,Rh,function(){return[Ls,Xl,kt]}],this,rf.call(this,l,e),function(t){var n=new kt(t.data);onmessage=Ls(n)},10)}}();function gi(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[ap,Rh,function(){return[zi]}],function(n){return bc(zi(n.data[0],n.data[1]))},4,t)}function zi(l,e){e||(e={});var t=yc();t.p(l);var n=Ac(l,e,2,4);return nf(n,e),Es(n,n.length-4,t.d()),n}var Tr=function(){function l(e){this.v=1,Aa.call(this,e)}return l.prototype.push=function(e,t){if(Aa.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Aa.prototype.c.call(this,t)},l}(),eo=function(){return function(l){this.ondata=l,Ia([Cs,Fo,function(){return[Ls,Aa,Tr]}],this,0,function(){var e=new Tr;onmessage=Ls(e)},11)}}();function Xa(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fi(l,e,[Cs,Fo,function(){return[Yo]}],function(n){return bc(Yo(n.data[0],Xc(n.data[1])))},5,t)}function Yo(l,e){return qa((ov(l),l.subarray(2,-4)),e)}var Dl=function(){function l(e){this.G=F,this.I=Aa,this.Z=Tr,this.ondata=e}return l.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new ss(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,o=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},l}(),jo=function(){function l(e){this.G=de,this.I=tr,this.Z=eo,this.ondata=e}return l.prototype.push=function(e,t){Dl.prototype.push.call(this,e,t)},l}();function xc(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return l[0]==31&&l[1]==139&&l[2]==8?Fe(l,e,t):(15&l[0])!=8||l[0]>>4>7||(l[0]<<8|l[1])%31?cp(l,e,t):Xa(l,e,t)}function tm(l,e){return l[0]==31&&l[1]==139&&l[2]==8?Mt(l,e):(15&l[0])!=8||l[0]>>4>7||(l[0]<<8|l[1])%31?Xu(l,e):Yo(l,e)}var yd=function(l,e,t,n){for(var i in l){var o=l[i],c=e+i;o instanceof ss?t[c]=[o,n]:Array.isArray(o)?t[c]=[o[0],gd(n,o[1])]:yd(o,c+"/",t,n)}},up=typeof TextEncoder<"u"&&new TextEncoder,Ad=typeof TextDecoder<"u"&&new TextDecoder,bd=0;try{Ad.decode(Ra,{stream:!0}),bd=1}catch{}var Ko=function(l){for(var e="",t=0;;){var n=l[t++],i=(n>127)+(n>223)+(n>239);if(t+i>l.length)return[e,ll(l,t-1)];i?i==3?(n=((15&n)<<18|(63&l[t++])<<12|(63&l[t++])<<6|63&l[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&i?String.fromCharCode((31&n)<<6|63&l[t++]):String.fromCharCode((15&n)<<12|(63&l[t++])<<6|63&l[t++]):e+=String.fromCharCode(n)}},Tg=function(){function l(e){this.ondata=e,bd?this.t=new TextDecoder:this.p=Ra}return l.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new ss(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=Ko(n),o=i[0],c=i[1];if(t){if(c.length)throw"invalid utf-8 data";this.p=null}else this.p=c;this.ondata(o,t)}},l}(),Yu=function(){function l(e){this.ondata=e}return l.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(cl(e),this.d=t||!1)},l}();function cl(l,e){if(e){for(var t=new ss(l.length),n=0;n<l.length;++n)t[n]=l.charCodeAt(n);return t}if(up)return up.encode(l);var i=l.length,o=new ss(l.length+(l.length>>1)),c=0,f=function(w){o[c++]=w};for(n=0;n<i;++n){if(c+5>o.length){var m=new ss(c+8+(i-n<<1));m.set(o),o=m}var y=l.charCodeAt(n);y<128||e?f(y):y<2048?(f(192|y>>6),f(128|63&y)):y>55295&&y<57344?(f(240|(y=65536+(1047552&y)|1023&l.charCodeAt(++n))>>18),f(128|y>>12&63),f(128|y>>6&63),f(128|63&y)):(f(224|y>>12),f(128|y>>6&63),f(128|63&y))}return ll(o,0,c)}function Pa(l,e){if(e){for(var t="",n=0;n<l.length;n+=16384)t+=String.fromCharCode.apply(null,l.subarray(n,n+16384));return t}if(Ad)return Ad.decode(l);var i=Ko(l),o=i[0];if(i[1].length)throw"invalid utf-8 data";return o}var av=function(l){return l==1?3:l<6?2:l==9?1:0},T0=function(l,e){return e+30+ho(l,e+26)+ho(l,e+28)},Su=function(l,e,t){var n=ho(l,e+28),i=Pa(l.subarray(e+46,e+46+n),!(2048&ho(l,e+8))),o=e+46+n,c=po(l,e+20),f=t&&c==4294967295?Cg(l,o):[c,po(l,e+24),po(l,e+42)],m=f[0],y=f[1],w=f[2];return[ho(l,e+10),m,y,i,o+ho(l,e+30)+ho(l,e+32),w]},Cg=function(l,e){for(;ho(l,e)!=1;e+=4+ho(l,e+2));return[zo(l,e+12),zo(l,e+4),zo(l,e+20)]},Eo=function(l){var e=0;if(l)for(var t in l){var n=l[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Mu=function(l,e,t,n,i,o,c,f){var m=n.length,y=t.extra,w=f&&f.length,S=Eo(y);Es(l,e,c!=null?33639248:67324752),e+=4,c!=null&&(l[e++]=20,l[e++]=t.os),l[e]=20,e+=2,l[e++]=t.flag<<1|(o==null&&8),l[e++]=i&&8,l[e++]=255&t.compression,l[e++]=t.compression>>8;var C=new Date(t.mtime==null?Date.now():t.mtime),O=C.getFullYear()-1980;if(O<0||O>119)throw"date not in range 1980-2099";if(Es(l,e,O<<25|C.getMonth()+1<<21|C.getDate()<<16|C.getHours()<<11|C.getMinutes()<<5|C.getSeconds()>>>1),e+=4,o!=null&&(Es(l,e,t.crc),Es(l,e+4,o),Es(l,e+8,t.size)),Es(l,e+12,m),Es(l,e+14,S),e+=16,c!=null&&(Es(l,e,w),Es(l,e+6,t.attrs),Es(l,e+10,c),e+=14),l.set(n,e),e+=m,S)for(var N in y){var H=y[N],q=H.length;Es(l,e,+N),Es(l,e+2,q),l.set(H,e+4),e+=4+q}return w&&(l.set(f,e),e+=w),e},Rg=function(l,e,t,n,i){Es(l,e,101010256),Es(l,e+8,t),Es(l,e+10,t),Es(l,e+12,n),Es(l,e+16,i)},xd=function(){function l(e){this.filename=e,this.c=vc(),this.size=0,this.compression=0}return l.prototype.process=function(e,t){this.ondata(null,e,t)},l.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},l}(),C0=function(){function l(e,t){var n=this;t||(t={}),xd.call(this,e),this.d=new Xl(t,function(i,o){n.ondata(null,i,o)}),this.compression=8,this.flag=av(t.level)}return l.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},l.prototype.push=function(e,t){xd.prototype.push.call(this,e,t)},l}(),Ig=function(){function l(e,t){var n=this;t||(t={}),xd.call(this,e),this.d=new Ih(t,function(i,o,c){n.ondata(i,o,c)}),this.compression=8,this.flag=av(t.level),this.terminate=this.d.terminate}return l.prototype.process=function(e,t){this.d.push(e,t)},l.prototype.push=function(e,t){xd.prototype.push.call(this,e,t)},l}(),xb=function(){function l(e){this.ondata=e,this.u=[],this.d=1}return l.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=cl(e.filename),i=n.length,o=e.comment,c=o&&cl(o),f=i!=e.filename.length||c&&o.length!=c.length,m=i+Eo(e.extra)+30;if(i>65535)throw"filename too long";var y=new ss(m);Mu(y,0,e,n,f);var w=[y],S=function(){for(var q=0,J=w;q<J.length;q++){var V=J[q];t.ondata(null,V,!1)}w=[]},C=this.d;this.d=0;var O=this.u.length,N=gd(e,{f:n,u:f,o:c,t:function(){e.terminate&&e.terminate()},r:function(){if(S(),C){var q=t.u[O+1];q?q.r():t.d=1}C=1}}),H=0;e.ondata=function(q,J,V){if(q)t.ondata(q,J,V),t.terminate();else if(H+=J.length,w.push(J),V){var z=new ss(16);Es(z,0,134695760),Es(z,4,e.crc),Es(z,8,H),Es(z,12,e.size),w.push(z),N.c=H,N.b=m+H+16,N.crc=e.crc,N.size=e.size,C&&N.r(),C=1}else C&&S()},this.u.push(N)},l.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},l.prototype.e=function(){for(var e=0,t=0,n=0,i=0,o=this.u;i<o.length;i++)n+=46+(y=o[i]).f.length+Eo(y.extra)+(y.o?y.o.length:0);for(var c=new ss(n+22),f=0,m=this.u;f<m.length;f++){var y=m[f];Mu(c,e,y,y.f,y.u,y.c,t,y.o),e+=46+y.f.length+Eo(y.extra)+(y.o?y.o.length:0),t+=y.b}Rg(c,e,this.u.length,n,t),this.ondata(null,c,!0),this.d=2},l.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},l}();function Zy(l,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};yd(l,"",n,e);var i=Object.keys(n),o=i.length,c=0,f=0,m=o,y=new Array(o),w=[],S=function(){for(var H=0;H<w.length;++H)w[H]()},C=function(){var H=new ss(f+22),q=c,J=f-c;f=0;for(var V=0;V<m;++V){var z=y[V];try{var ue=z.c.length;Mu(H,f,z,z.f,z.u,ue);var me=30+z.f.length+Eo(z.extra),Te=f+me;H.set(z.c,Te),Mu(H,c,z,z.f,z.u,ue,f,z.m),c+=16+me+(z.m?z.m.length:0),f=Te+ue}catch(Be){return t(Be,null)}}Rg(H,c,y.length,J,q),t(null,H)};o||C();for(var O=function(H){var q=i[H],J=n[q],V=J[0],z=J[1],ue=vc(),me=V.length;ue.p(V);var Te=cl(q),Be=Te.length,He=z.comment,tt=He&&cl(He),lt=tt&&tt.length,at=Eo(z.extra),St=z.level==0?0:8,mt=function(gt,Ot){if(gt)S(),t(gt,null);else{var Bt=Ot.length;y[H]=gd(z,{size:me,crc:ue.d(),c:Ot,f:Te,m:tt,u:Be!=q.length||tt&&He.length!=lt,compression:St}),c+=30+Be+at+Bt,f+=76+2*(Be+at)+(lt||0)+Bt,--o||C()}};if(Be>65535&&mt("filename too long",null),St)if(me<16e4)try{mt(null,Ph(V,z))}catch(gt){mt(gt,null)}else w.push(Yc(V,z,mt));else mt(null,V)},N=0;N<m;++N)O(N);return S}function Ku(l,e){e||(e={});var t={},n=[];yd(l,"",t,e);var i=0,o=0;for(var c in t){var f=t[c],m=f[0],y=f[1],w=y.level==0?0:8,S=(Be=cl(c)).length,C=y.comment,O=C&&cl(C),N=O&&O.length,H=Eo(y.extra);if(S>65535)throw"filename too long";var q=w?Ph(m,y):m,J=q.length,V=vc();V.p(m),n.push(gd(y,{size:m.length,crc:V.d(),c:q,f:Be,m:O,u:S!=c.length||O&&C.length!=N,o:i,compression:w})),i+=30+S+H+J,o+=76+2*(S+H)+(N||0)+J}for(var z=new ss(o+22),ue=i,me=o-i,Te=0;Te<n.length;++Te){var Be=n[Te];Mu(z,Be.o,Be,Be.f,Be.u,Be.c.length);var He=30+Be.f.length+Eo(Be.extra);z.set(Be.c,Be.o+He),Mu(z,i,Be,Be.f,Be.u,Be.c.length,Be.o,Be.m),i+=16+He+(Be.m?Be.m.length:0)}return Rg(z,i,n.length,me,ue),z}var hp=function(){function l(){}return l.prototype.push=function(e,t){this.ondata(null,e,t)},l.compression=0,l}(),lv=function(){function l(){var e=this;this.i=new Aa(function(t,n){e.ondata(null,t,n)})}return l.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},l.compression=8,l}(),cv=function(){function l(e,t){var n=this;t<32e4?this.i=new Aa(function(i,o){n.ondata(null,i,o)}):(this.i=new tr(function(i,o,c){n.ondata(i,o,c)}),this.terminate=this.i.terminate)}return l.prototype.push=function(e,t){this.i.terminate&&(e=ll(e,0)),this.i.push(e,t)},l.compression=8,l}(),R0=function(){function l(e){this.onfile=e,this.k=[],this.o={0:hp},this.p=Ra}return l.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),o=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(i)).length)return this.push(e,t)}else{var c=0,f=0,m=void 0,y=void 0;this.p.length?e.length?((y=new ss(this.p.length+e.length)).set(this.p),y.set(e,this.p.length)):y=this.p:y=e;for(var w=y.length,S=this.c,C=S&&this.d,O=function(){var q,J=po(y,f);if(J==67324752){c=1,m=f,N.d=null,N.c=0;var V=ho(y,f+6),z=ho(y,f+8),ue=2048&V,me=8&V,Te=ho(y,f+26),Be=ho(y,f+28);if(w>f+30+Te+Be){var He=[];N.k.unshift(He),c=2;var tt,lt=po(y,f+18),at=po(y,f+22),St=Pa(y.subarray(f+30,f+=30+Te),!ue);lt==4294967295?(q=me?[-2]:Cg(y,f),lt=q[0],at=q[1]):me&&(lt=-1),f+=Be,N.c=lt;var mt={name:St,compression:z,start:function(){if(!mt.ondata)throw"no callback";if(lt){var gt=n.o[z];if(!gt)throw"unknown compression type "+z;(tt=lt<0?new gt(St):new gt(St,lt,at)).ondata=function(_n,mn,qn){mt.ondata(_n,mn,qn)};for(var Ot=0,Bt=He;Ot<Bt.length;Ot++){var Ft=Bt[Ot];tt.push(Ft,!1)}n.k[0]==He&&n.c?n.d=tt:tt.push(Ra,!0)}else mt.ondata(null,Ra,!0)},terminate:function(){tt&&tt.terminate&&tt.terminate()}};lt>=0&&(mt.size=lt,mt.originalSize=at),N.onfile(mt)}return"break"}if(S){if(J==134695760)return m=f+=12+(S==-2&&8),c=3,N.c=0,"break";if(J==33639248)return m=f-=4,c=3,N.c=0,"break"}},N=this;f<w-4&&O()!=="break";++f);if(this.p=Ra,S<0){var H=c?y.subarray(0,m-12-(S==-2&&8)-(po(y,m-16)==134695760&&4)):y.subarray(0,f);C?C.push(H,!!c):this.k[+(c==2)].push(H)}if(2&c)return this.push(y.subarray(f),t);this.p=y.subarray(f)}if(t){if(this.c)throw"invalid zip file";this.p=null}},l.prototype.register=function(e){this.o[e.compression]=e},l}();function wb(l,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var C=0;C<t.length;++C)t[C]()},i={},o=l.length-22;po(l,o)!=101010256;--o)if(!o||l.length-o>65558)return void e("invalid zip file",null);var c=ho(l,o+8);c||e(null,{});var f=c,m=po(l,o+16),y=m==4294967295;if(y){if(o=po(l,o-12),po(l,o)!=101075792)return void e("invalid zip file",null);f=c=po(l,o+32),m=po(l,o+48)}for(var w=function(C){var O=Su(l,m,y),N=O[0],H=O[1],q=O[2],J=O[3],V=O[4],z=O[5],ue=T0(l,z);m=V;var me=function(Be,He){Be?(n(),e(Be,null)):(i[J]=He,--c||e(null,i))};if(N)if(N==8){var Te=l.subarray(ue,ue+H);if(H<32e4)try{me(null,Xu(Te,new ss(q)))}catch(Be){me(Be,null)}else t.push(cp(Te,{size:q},me))}else me("unknown compression type "+N,null);else me(null,ll(l,ue,ue+H))},S=0;S<f;++S)w();return n}function Da(l){for(var e={},t=l.length-22;po(l,t)!=101010256;--t)if(!t||l.length-t>65558)throw"invalid zip file";var n=ho(l,t+8);if(!n)return{};var i=po(l,t+16),o=i==4294967295;if(o){if(t=po(l,t-12),po(l,t)!=101075792)throw"invalid zip file";n=po(l,t+32),i=po(l,t+48)}for(var c=0;c<n;++c){var f=Su(l,i,o),m=f[0],y=f[1],w=f[2],S=f[3],C=f[4],O=f[5],N=T0(l,O);if(i=C,m){if(m!=8)throw"unknown compression type "+m;e[S]=Xu(l.subarray(N,N+y),new ss(w))}else e[S]=ll(l,N,N+y)}return e}class os extends s.hH6{load(e,t,n,i){return this.setResponseType("arraybuffer"),super.load(e,o=>{const c=Da(new Uint8Array(o)),f=new Map(Object.entries(c).map(([m,y])=>[m,new File([y],m)]));t==null||t(f)},n,i)}}class Vi extends a.SimpleEventDispatcher{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(e,t=!1){super(),this._processors=new xg,this._logger=console.log,this.Importers=[new Js(_h,["json"],!1),new Js(s.hH6,["txt"],!1),new Js(dd,["rgbe.png","hdr.png","hdrpng"],!1),new Js(s.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Js(Jp,["cube"],!1),new Js(os,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new s.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(Xp(e)),this.Importers.push(va(e)),this.Importers.push(Vc())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var o;let t=decodeURI(e);const n=(o=this._rootContext)==null?void 0:o.rootUrl;t.includes("://")||!n||t.startsWith(n)||(t=n+t),t=t.replace("./",""),t=t.replace(/^(\/\/)/,"/"),t=t.replace(/\?.*$/,"");const i=this._fileDatabase.get(t);return i?i.ext?(i.objectUrl||(i.objectUrl=URL.createObjectURL(i)+"#"+t),i.objectUrl):(console.error("Unable to determine file extension",i),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(i=>{const o=new RegExp(i.startsWith("data:")?"^"+i+"\\/":"\\."+i+"$","i");this._loadingManager.addHandler(o,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}addEventListener(e,t){if(super.addEventListener(e,t),e==="loaderCreate")for(const n of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:n.loader})}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:i}=t;if(i&&i.length<1&&(i=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const o=[],c=[];if(e.forEach((f,m)=>{this.registerFile(m,f);const y=f.ext;y&&((i==null?void 0:i.includes(y.toLowerCase()))??1)&&(this._isRootFileExtension(y)?o.push(m):c.push(m))}),o.length>0)for(const f of o){let m=await this._importFile(f,void 0,t);m&&(m=await this.processImported(m,t)),n.set(f,m)}else for(const f of c){let m=await this._importFile(f,void 0,t);m&&(m=await this.processImported(m,t)),n.set(f,m)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((f,m)=>{this.unregisterFile(m)}),n}registerFile(e,t){var o;e=e.replace(/\?.*$/,"");const n=(t==null?void 0:t.ext)??((o=(0,a.parseFileExtension)((t==null?void 0:t.name)??e))==null?void 0:o.toLowerCase());t&&(t.ext||(t.ext=n),this._fileDatabase.set(e,t));let i=this._getLoader(e);if(i||(i=this._createLoader(t??{name:e,ext:n})),i){for(const c of this._loaderCache)if(c.loader===i){c.files.push(e);break}}return i}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return this.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},i){var c;if(t!=null&&t.__imported)return t.__imported;let o;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t);const f=this.resolveURL(e),m=e.replace(/\?.*$/,""),y=n.fileHandler??(await this._loadingManager.getHandler(m)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0));if(!y)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:f,rootUrl:s.Zp0.extractUrlBase(e),baseUrl:s.Zp0.extractUrlBase(f)},o=await y.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),w=>{i&&i(w),this.dispatchEvent({type:"importFile",path:e,state:"downloading",loadedBytes:w.loaded||void 0,totalBytes:w.total||void 0,progress:w.total>0?w.loaded/w.total:1})}),y.transform&&(o=await y.transform(o,n)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(f){return console.error("AssetImporter: Unable to import file",e,t),console.error(f),console.error(f==null?void 0:f.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:f}),t&&this.unregisterFile(e),[]}if(this.dispatchEvent({type:"importFile",path:e,state:"done"}),t){t.__imported=o;let f=[];Array.isArray(o)?f=o:(c=o.userData)!=null&&c.rootSceneModelRoot?f.push(...o.children):f.push(o),f.forEach(m=>{var y;(y=m.addEventListener)==null||y.call(m,"dispose",()=>{t.__imported=void 0})})}if(o&&typeof o=="object"){o.__rootPath=e;const f=t||this._fileDatabase.get(e);f&&(o.__rootBlob=f)}return o}_getImporter(e,t=!1){return this.Importers.find(n=>{if(t&&!n.root)return!1;const i=n.ext.find(o=>{var c,f,m;return e.ext&&o===e.ext.toLowerCase()||((f=(c=e.name)==null?void 0:c.toLowerCase())==null?void 0:f.endsWith("."+o.toLowerCase()))||(o==null?void 0:o.startsWith("data:"))&&((m=e.name)==null?void 0:m.startsWith(o))});return!!i&&(e.ext=i,!0)})}_getLoader(e){return this._loadingManager.getHandler(e)??void 0}async importAsset(e,t={},n){var o,c,f;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const y=this._cachedAssets.find(w=>w.path===e.path);y&&Object.assign(e,y)}const m=this._cachedAssets.findIndex(y=>y.path===e.path);m>=0&&this._cachedAssets.splice(m,1),this._cachedAssets.push(e)}let i;if(e!=null&&e.preImported&&(i=await e.preImported),!t.forceImport&&i){const m=await this.processImported(i,t);let y=!1;for(const w of m){if((o=w.userData)!=null&&o.rootSceneModelRoot&&[...w.children,...w.__processedChildren||[]].find(S=>S.__disposed)){y=!0;break}if(w.__disposed){y=!0;break}}if(!y||t.reimportDisposed===!1)return m}if(e.preImported=this._importFile(t.pathOverride||e.path,typeof((c=e.file)==null?void 0:c.arrayBuffer)=="function"?e.file:void 0,t,n),i=await e.preImported,i&&(i=await this.processImported(i,t)),i){const m=[];Array.isArray(i)?m.push(...i):(f=i.userData)!=null&&f.rootSceneModelRoot?m.push(...i.children):m.push(i),m.forEach(y=>{var w;return(w=y.addEventListener)==null?void 0:w.call(y,"dispose",()=>{e!=null&&e.preImported&&(e.preImported=void 0)})})}return i}async importSingle(e,t={}){var n;return typeof e=="string"?await this.importSinglePath(e,t):(n=await this.importAsset(e,t))==null?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))==null?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed,delete n.fileHandler,delete n.importedFile;const i=JSON.stringify(n);let o;return o=this._cachedAssets.find(c=>c.path===e&&c._options===i)||{path:e},o._options=i,t.importedFile&&(o.file=t.importedFile),await this.importAsset(o,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var c,f,m,y,w,S,C,O;let n=e;if(!n)return[];if(t.processImported===!1)return[n];if(Array.isArray(n)){const N=[];for(const H of n)N.push(...await this.processImported(H,t));return N}if((c=n.userData)!=null&&c.rootSceneModelRoot){if(t._rootSceneImported=!0,n.__processedChildren&&!t.forceImporterReprocess)return n.__processedChildren;if(!(n.children.length<1))return n.animations&&(n.children[0].animations||(n.children[0].animations=[]),n.children[0].animations.push(...n.animations)),n.__importedViewerConfig&&(n.children[0].__importedViewerConfig=n.__importedViewerConfig),n.userData.__importData&&(n.children[0].userData.__importData=n.userData.__importData),n.__processedChildren=await this.processImported([...n.children],t),n.__processedChildren;if(((f=n.animations)==null?void 0:f.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",n.animations),!n.__importedViewerConfig)return[];n=n.__importedViewerConfig}if((m=n.userData)!=null&&m.iModel&&(n=n.userData.iModel),(y=n.userData)!=null&&y.iMaterial&&(n=n.userData.iMaterial),n.assetImporterProcessed&&!t.forceImporterReprocess)return[n];const i=n.__rootPath,o=n.__rootBlob;if(!n.assetType){if(n.isBufferGeometry&&(n=new s.Kj0(n,new s.Wid)),n.isObject3D)if(n.isLight)n=dp(n);else{const N=[];n.traverse(H=>{H!==n&&H.isLight&&N.push(H)});for(const H of N)dp(H);n=new ao(n,t)}n.isTexture&&(n.assetType="texture",t._testDataTextureComplete&&(n.isDataTexture&&((w=n.image)!=null&&w.data)&&(n.image.complete=!0),(S=n.image)!=null&&S.complete&&(n.needsUpdate=!0)),t.generateMipmaps!==void 0&&(n.generateMipmaps=t.generateMipmaps),n.generateMipmaps||n.isRenderTargetTexture||(n.minFilter=n.minFilter===s.D1R?s.wem:n.minFilter,n.magFilter=n.magFilter===s.D1R?s.wem:n.magFilter)),n.isMaterial&&(n.assetType="material")}if(n.assetType!=null)return n.userData&&(n.userData.rootPath||!i||i.startsWith("blob:")||i.startsWith("/")||(n.userData.rootPath=i),o&&(n.userData.__sourceBlob=o,n.userData.__needsSourceBuffer&&(n.userData.__sourceBuffer=await o.arrayBuffer(),delete n.userData.__needsSourceBuffer))),n=await this._processors.process(n.assetType,n,{}),n.assetImporterProcessed=!0,[n];if(n instanceof Map)return[...(await this.importFiles(n,t)).values()].flat();if(n.type&&n.type!=="ViewerApp"&&n.type!=="ThreeViewer"){const N=this._viewer.getPluginByType(n.type);if(N){let H=n._importedResources||{};return n.resources&&(H=await((C=this._viewer.getManager())==null?void 0:C.importConfigResources(n.resources)),delete n.resources,n._importedResources=H),typeof N.fromJSON=="function"&&(await Promise.resolve(N.fromJSON(n,H)),n.assetImporterProcessed=!1),[]}}return n.plugins||n.type==="ViewerApp"||n.type==="ThreeViewer"?(n.resources=await((O=this._viewer.getManager())==null?void 0:O.importConfigResources(n.resources)),await this._viewer.getManager().importViewerConfig(n),n.assetImporterProcessed=!1,[]):(console.warn("unknown/null asset type: ",n,n.plugins),[n])}dispose(){var e;this.clearCache(),(e=this._processors)==null||e.dispose()}clearLoaderCache(){this._loaderCache.forEach(e=>{e.loader.dispose&&e.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function Ol(l){if(!l)return s.ywz;const e=l.extensions.has("EXT_color_buffer_half_float")||l.capabilities.isWebGL2&&l.extensions.has("EXT_color_buffer_float"),t=l.capabilities.isWebGL2||l.extensions.has("OES_texture_float")||l.extensions.has("WEBGL_color_buffer_float");return e?s.cLu:t?s.VzW:s.ywz}function dp(l){var t,n;if(!l.isLight||l.assetType==="light")return l;if(l.uiConfig)return console.warn("ui config already exists, not supported",l),l;let e;if(l.children.length,l.isDirectionalLight&&(e=new Gc),l.isAmbientLight&&(e=new Eh),l.isSpotLight&&(e=new yu),l.isPointLight&&(e=new wh),e){(n=(t=e.lightObject).copy)==null||n.call(t,l);const i=l.parent;i!=null&&i.isObject3D&&(i.remove(l),l.dispose(),l.userData.iModel=e,i.add(e.lightObject),e.uuid=l.uuid),oa(e.lightObject,i)}else console.warn("unknown light type: ",l);return e}class wd extends s.u7G{constructor(e){super(e)}async loadAsync(e,t){var o;const n=new s.hH6(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const i=await n.loadAsync(e,t);try{const c=JSON.parse(i);if(c.images&&this.importer){const f={};let m=c.images;Array.isArray(m)||(m=Object.values(m));for(const y of c.images){if(!y.url||!y.uuid)continue;const w=(o=await this.importer.importPath(y.url,{processImported:!1}))==null?void 0:o[0],S=w==null?void 0:w.source;if(!w||!S)continue;const C=new s.Hw6(S.data);C.uuid=y.uuid,f[C.uuid]=C,w.dispose()}return await Us.LoadRootPathTextures(c.textures,f||c.images,this.importer),this.parse(c,f)}return this.parse(c)}catch(c){throw console.error(c),this.manager.itemError(e),c}}parse(e,t){var m;let n;const i={p:new Promise(y=>{n=y})};if(e.images||e.textures){const y=new Us(this.manager);let w={};const S=H=>{n(),i.p=void 0,Object.values(w).forEach(q=>{var J;q.isTexture&&((J=q.image)!=null&&J.complete)&&(q.needsUpdate=!0)})};let C=e.images||[];Array.isArray(C)||(C=Object.values(C));const O=t||y.parseImages(C,S);let N=e.textures;Array.isArray(N)||(N=Object.values(N)),w=y.parseTextures2(N,O,S),this.setTextures(w)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const o={...e};if(Object.entries(o).forEach(([y,w])=>{w&&typeof w=="string"&&this.textures[w]&&(o[y]=this.textures[w])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?o.vertexColors=e.vertexColors>0:o.vertexColors=e.vertexColors),e.normalScale!==void 0){const y=e.normalScale;Array.isArray(y)===!1&&(o.normalScale=[y,y])}let c=e.type;c!=="MeshPhysicalMaterial"&&c!=="MeshStandardMaterial"&&c!=="PhysicalMaterial"||(c=Wr.TYPE),o.userData=Mi(o.userData,void 0,!1,this);const f=((m=this.materials)==null?void 0:m.generateFromTemplateType(c,o))??super.parse(e);return this.setTextures({}),f.userData.imageLoadAwaiter=i,f}}class fi extends a.SimpleEventDispatcher{constructor(e,t,{simpleCache:n=!1,storage:i}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||i)&&(n&&(s.CtF.enabled=!0),i&&window.Cache&&typeof window.Cache=="function"&&i instanceof window.Cache)){const o={...s.CtF};s.CtF.get=(c,f,m)=>f?c.startsWith("data:")||c.startsWith("blob")||c.startsWith("chrome-extension")?Promise.resolve(void 0):i.match(c).then(y=>{if(y)switch(f){case"arraybuffer":return y.arrayBuffer();case"blob":return y.blob();case"document":return y.text().then(w=>new DOMParser().parseFromString(w,m??"text/html"));case"json":return y.json();default:if(m===void 0)return y.text();{const w=/charset="?([^;"\s]*)"?/i.exec(m),S=w&&w[1]?w[1].toLowerCase():void 0,C=new TextDecoder(S);return y.arrayBuffer().then(O=>C.decode(O))}}}):o.get(c),s.CtF.add=async(c,f,m)=>{if(!m)return o.add(c,f);c.startsWith("data:")||c.startsWith("blob")||c.startsWith("chrome-extension")||(await i.match(c)&&await i.delete(c),await i.put(c,new Response(f,{status:200})))},s.CtF.remove=(c,f)=>{if(!f)return o.remove(c);i.delete(c)}}this.storage=i,this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var i;return(i=this._viewer)==null?void 0:i.scene.addSceneObject(n,t)})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset).call(this,e,t))==null?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)==null?void 0:n.processImported(e,t).then(i=>(this.addProcessedAssets(i,t),i))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)==null||t.processMaterial(n,{}))}else console.error("Unexpected")}onAdded(e){this._viewer=e,this._materials||(this._materials=new Jd,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new Vi(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,i)=>(ud(n,o=>{var c;return(c=this._materials)==null?void 0:c.processModel(o,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,i)=>{var o;return(o=this.materials)!=null&&o.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=se(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,i)}})),this._importer.Importers.push(new Js(wd,[Wr.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);this._importer.Importers.push(new Js(class extends _h{async loadAsync(n,i){return t(await super.loadAsync(n,i))}},[fi.ViewerTypeSlug],!0))}onRemove(e){var t,n;e===this._viewer&&((t=this._importer)==null||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)==null||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)==null?void 0:e.getPluginByType("AssetExporterPlugin"))==null?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,t){if(!this._viewer)return{};const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...t},i=this._viewer.toJSON(n);return e||Object.values(n).forEach(o=>{o&&Object.values(o).forEach(c=>{c.url&&(c.url.data instanceof ArrayBuffer||Array.isArray(c.url.data))&&(c.url.type==="Uint16Array"?(c.url.data instanceof Uint16Array||(c.url.data=new Uint16Array(c.url.data)),c.url.data="data:application/octet-stream;base64,"+(0,a.arrayBufferToBase64)(c.url.data.buffer)):c.url.type==="Uint8Array"?(c.url.data instanceof Uint8Array||(c.url.data=new Uint8Array(c.url.data)),c.url.data="data:application/octet-stream;base64,"+(0,a.arrayBufferToBase64)(c.url.data.buffer)):c.url.data instanceof ArrayBuffer?c.url.data="data:application/octet-stream;base64,"+(0,a.arrayBufferToBase64)(c.url.data.buffer):console.warn("Unsupported buffer type",c.url.type))})}),i.resources=n,i}exportPluginPresets(e){var n;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(n=this._viewer)==null?void 0:n.serializePlugins(t,e),resources:t}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var c;const n=e.type;if(!(t=t||((c=this._viewer)==null?void 0:c.getPluginByType(n))))return void console.warn(`No plugin found for type ${n} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${n} does not support importing presets`);const i=e.resources||{};e.resources&&delete e.resources;const o=await this.importConfigResources(i);return await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const i of Object.values(t.materials))i.__useCount?delete i.__useCount:(n=this._materials)==null||n.unregisterMaterial(i);for(const i of Object.values(t.textures))i.__useCount&&delete i.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var c,f,m;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const i={};Object.values(e).forEach(y=>{y&&Object.values(y).forEach(w=>{if(!w||!w.url||typeof w.url.data!="string")return;const S=w.url.data.match(/^data:.*;base64,(.*)$/);S!=null&&S[1]?w.url.data=(0,a.base64ToArrayBuffer)(S==null?void 0:S[1]):(w.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",w.url.type,"use base64"),w.url.data=new TextEncoder().encode(w.url.data).buffer)})}),t=t??new Us(this._importer.loadingManager),i.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(i.animations={...i.animations,...n.animations}),i.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(i.shapes={...i.shapes,...n.shapes}),i.geometries=e.geometries?t.parseGeometries(e.geometries,i.shapes):{},n&&n.geometries&&(i.geometries={...i.geometries,...n.geometries}),i.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(i.images={...i.images,...n.images}),await Us.LoadRootPathTextures(e.textures,i.images,this._importer),i.textures=e.textures?t.parseTextures2(Object.values(e.textures),i.images,()=>{Object.values(i.textures).forEach(y=>{var w;y.isTexture&&((w=y.image)!=null&&w.complete)&&(y.needsUpdate=!0)})}):{};for(const y of Object.entries(i.textures))y[1]=(c=await this._importer.processImported(y[1],{}))==null?void 0:c[0],y[1]?i.textures[y[0]]=y[1]:delete i.textures[y[0]];n&&n.textures&&(i.textures={...i.textures,...n.textures});const o=e.materials?Object.values(e.materials):[];for(const y of o)Object.entries(y).forEach(([w,S])=>{S&&S.resource&&S.uuid&&S.resource==="textures"&&(y[w]=S.uuid)});if(i.materials=t.parseMaterials2(o,i.textures,this._materials),n&&n.materials&&(i.materials={...i.materials,...n.materials}),e.object&&(i.object=t.parseObject(e.object,i.geometries,i.materials,i.textures,i.animations),e.skeletons&&(i.skeletons=t.parseSkeletons(e.skeletons,i.object),t.bindSkeletons(i.object,i.skeletons))),e.extras){i.extras=e.extras;for(const y of Object.values(e.extras))if(y.uuid&&y.url)if(typeof y.url=="string"){const w=await((f=this._importer)==null?void 0:f.importPath(y.url));(w==null?void 0:w.length)>0&&(i.extras[y.uuid]=w[0])}else if(y.url.data){const w=new File([(0,a.getTypedArray)(y.url.type,y.url.data)],y.url.path),S=await((m=this._importer)==null?void 0:m.importAsset({path:w.name,file:w}));(S==null?void 0:S.length)>0&&(i.extras[y.uuid]=S[0])}else console.warn("invalid URL type while loading extra resource")}return n&&n.extras&&(i.extras={...i.extras,...n.extras}),i.__isLoadedResources=!0,i}}fi.PluginType="AssetManager",fi.ViewerTypeSlug="vjson";class Pg{get inputEl(){return this._inputEl}get el(){return this._el}constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([i,o])=>o&&this.on(i,o))}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var i,o;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const t=Array.from(((i=e.dataTransfer)==null?void 0:i.files)||[]),n=Array.from(((o=e.dataTransfer)==null?void 0:o.items)||[]);if(t.length!==0||n.length!==0)if(n.length>0){const c=n.map(f=>f.webkitGetAsEntry());this._loadNextEntry(new Map,c)}else this._emit("drop",{files:new Map(t.map(c=>(c.filePath=c.name,[c.filePath,c])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const t=[].slice.call(this._inputEl.files??new FileList),n=new Map;t.forEach(i=>{i.filePath=i.webkitRelativePath||i.name,n.set(i.filePath,i)}),this._emit("drop",{files:n})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(i=>{i.filePath=n.fullPath,e.set(n.fullPath,i),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const i=n.createReader(),o=c=>{c.length?(t=t.concat(c),i.readEntries(o)):this._loadNextEntry(e,t)};i.readEntries(o)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class of extends a.SimpleEventDispatcher{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new s.Pa4(.5,.5,3)},this.dependencies=[fi],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new Pg(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var o,c,f;if(!e)return;const t=this._viewer;if(!t)return;if(this._allowedExtensions!==void 0)for(const m of e.keys())this._allowedExtensions.includes(((o=m.split(".").pop())==null?void 0:o.toLowerCase())??"")||e.delete(m);if(e.size<1)return;const n=t.getPlugin(fi),i={type:"drop",files:e};if(this.importerParams.autoImport){const m={allowedExtensions:this.allowedExtensions,...this.importerParams};if(i.imported=await((c=n.importer)==null?void 0:c.importFiles(e,m)),this.importerParams.autoAdd){const y=[...((f=i.imported)==null?void 0:f.values())??[]].flat(2).filter(w=>!!w)??[];if(i.assets=n.addProcessedAssets(y,{...this.importerParams}),!m._rootSceneImported)for(const w of i.assets)w.modelObject&&w.modelObject.dispatchEvent({type:"select",value:w.modelObject})}}this.dispatchEvent(i)}promptForFile(){var e;(e=this._inputEl)==null||e.click()}onRemove(e){var t;(t=this._dropzone)==null||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}of.PluginType="Dropzone";var Ed=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};function Kc(l){return Object.getPrototypeOf(l).constructor.PluginType}class So extends a.SimpleEventDispatcher{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!0,screenShader:i="",...o}){super(),this.console=console,this._state=u.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(S=>this.resize()):void 0,this._lastSize=new s.FM8,this._onContextRestore=S=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=S=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===$c&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=S=>{var N;if(!S||!S.object)return;const C=S.object.__importedViewerConfig||((N=S.object.modelObject)==null?void 0:N.__importedViewerConfig);if(!C)return;const O=this.getManager();O?O.applyViewerConfig(C,C.resources):this.fromJSON(C,C.resources)},this.alert=async S=>alert(S),this.confirm=async S=>confirm(S),this.prompt=async(S,C,O=!0)=>prompt(S,C),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=i,this._canvas=o.canvas||(0,a.createCanvasElement)();let c=o.container;if(c&&!o.canvas&&c.appendChild(this._canvas),c||(c=this._canvas.parentElement??void 0),!c)throw new Error("No container.");this._container=c,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var H;const S=window.location.href,C="https://dev-sandbox.pixotronics.com/webgi/";if(!S.startsWith(C)||(0,a.getUrlQueryParam)("noUpdate")!==null)return!0;const O=(H=S.match(/\/webgi\/([0-9.a-zA-Z-]+)/))==null?void 0:H[1],N=(await(await fetch(C+"version.txt")).text()).split(`
`)[0];if(O&&O!==N){if(confirm(`New version ${N} is available, do you want to open?`)){const q=window.location.href.replace(O,N);return window.location.href=q,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const f=new Hi(void 0,void 0,this._canvas);f.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var C,O;const S=y.scene.activeCamera;if(S&&S.interactionsEnabled){const N=(C=this.getPluginByType("Progressive"))==null?void 0:C.postFrameConvergedRecordingDelta();if(N!==void 0&&N===0)return;(O=S.controls)==null||O.update()}}),this.scene=new Ki(f),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new ys({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,colorSpace:t?ee:s.aCh,type:t?s.ywz:s.cLu,depthBuffer:!n}}),this._isAntialiased=e&&this._renderer.isWebGL2;let m=!0;this._renderer.rendererObject.userData||(m=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!m;const y=this;this.renderFilter={passId:"render",passObject:new Ta(this,m),update(){const S=this.passObject;S.scene=y.scene.modelObject,S.camera=y.scene.activeCamera.cameraObject}};const w={passId:"screen",after:["render"],required:["render"],passObject:nm(i)};[this.renderFilter,w].forEach(S=>this._renderer.registerPass(S)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",S=>this.setDirty(this.scene,S)),this.scene.addEventListener("sceneMaterialUpdate",S=>this.setDirty(this.scene,S)),this.scene.addEventListener("sceneUpdate",S=>{this.setDirty(this.scene,S),S.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",S=>this.setDirty(this.scene,S)),this._renderer.addEventListener("update",S=>this.setDirty(this._renderer,S)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#ffffff"),o.assetManager&&this.addPluginSync(new fi(void 0,void 0,typeof o.assetManager=="boolean"?{}:o.assetManager)),o.dropzone&&this.addPluginSync(new of),this.console.log("WebGi Viewer instance initialized, version: ",So.VERSION)}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;for(const t of[...Object.values(this.plugins)])this.removePlugin(t,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)==null||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var i,o;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let c=0;c<this.maxFramePerLoop;c++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const y=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const w=(o=(i=this._renderer.rendererObject.xr.getCamera())==null?void 0:i.cameras[0])==null?void 0:o.viewport;w?(w.x===0&&w.y===0||this.console.warn("x and y must be 0?"),y[0]=w.width,y[1]=w.height,this.console.log("resize for xr",y)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...y),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const f=Object.values(this.plugins).filter(y=>y.dirty);f.length>0&&this.setDirty(f),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const m=this._renderer.dirty;if(m){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(y){this.console.error(y),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!m)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return typeof e=="string"?this.getPluginByType(e):this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async getOrAddPlugin(e,...t){return this.getPlugin(e)||this.addPlugin(e,...t)}getOrAddPluginSync(e,...t){return this.getPlugin(e)||this.addPluginSync(e,...t)}async addPlugin(e,...t){let n;if(e.prototype){const o=this.getPlugin(e);if(o)return console.error(`Plugin of type ${Kc(o)} already exists, no new plugin created`,o),o;n=new e(...t)}else n=e;const i=Kc(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const o of n.dependencies||[])await this.getOrAddPlugin(o);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),await this.removePlugin(this.plugins[i],!0)),this.plugins[i]=n,await n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}addPluginSync(e,...t){let n;if(e.prototype){const o=this.getPlugin(e);if(o)return console.error(`Plugin of type ${Kc(o)} already exists, no new plugin created`,o),o;n=new e(...t)}else n=e;const i=Kc(n);if(!i)return this.console.error("PluginType is not defined for",n),n;for(const o of n.dependencies||[])this.getOrAddPluginSync(o);return this.plugins[i]&&(this.console.error(`Plugin of type ${i} already exists, old plugin will be removed and disposed`,this.plugins[i],n),this.removePluginSync(this.plugins[i],!0)),this.plugins[i]=n,n.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:n}),this.setDirty(n),n}async addPlugins(e){for(const t of e)await this.addPlugin(t)}async addPluginsSync(e){for(const t of e)this.addPluginSync(t)}async removePlugin(e,t=!0){const n=Kc(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&await e.onDispose(this),this.setDirty(e))}removePluginSync(e,t=!0){const n=Kc(e);this.plugins[n]&&(e.onRemove(this),delete this.plugins[n],t&&e.onDispose&&e.onDispose(this),this.setDirty(e))}createCamera(e){const t=e.userData.iCamera??new Hi(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return e.userData.autoLookAtTarget===void 0?(t.autoLookAtTarget=!1,e.userData.autoLookAtTarget=!1):t.autoLookAtTarget=e.userData.autoLookAtTarget,t}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}async doOnce(e,t){return new Promise(n=>{const i=async(...o)=>{this.removeEventListener(e,i),n(await t(...o))};this.addEventListener(e,i)})}setBackgroundColor(e){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(e)}setBackground(e){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=e,e==null||typeof e!="string"&&typeof e!="number"&&!e.isColor)!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(e===$c)return this.scene.setBackground("environment");!e||e!=null&&e.isTexture?(this.scene.setBackground(e),e||this.scene.setBackgroundColor(e)):this.scene.setBackgroundColor(e)}getBackground(e=!1){if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),e)return this._rawBackground;let t=this._rawBackground??this.scene.getBackground();return t?(t!=null&&t.isVector4&&(t=Is(t,7).getHexString()),t!=null&&t.isColor?t.getHexString():this._rawBackground===$c?this.scene.getEnvironment():t):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(fi)}resetCamera({rootObject:e,centerOffset:t=new s.Pa4(1,1,1),targetOffset:n=new s.Pa4(0,0,0),...i}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const o=e?new X().expandByObject(e,!0,!0):this.scene.getBounds(!0),c=o.getCenter(new s.Pa4),f=.5*o.getSize(new s.Pa4).length();c.add(n.clone().multiplyScalar(f)),this.scene.activeCamera.position=new s.Pa4(c.x+t.x*f,c.y+t.y*f,c.z+t.z*f),this.scene.activeCamera.target=c,this.setDirty()}}async fitToView(e,t=1.5,n,i){var c;const o=this.getPluginByType("CameraViews");o?await(o==null?void 0:o.animateToFitObject(e,t,n,i,{min:(((c=this.scene.activeCamera.getControls())==null?void 0:c.minDistance)??.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(e){var t;return(t=this.getManager())==null?void 0:t.addImportedSingle(e||new s.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,i,o,c;if(t!=null&&t.isMaterial){const f=(i=(n=this.getManager())==null?void 0:n.materials)==null?void 0:i.findMaterial(t.uuid);if(f)return f}return(c=(o=this.getManager())==null?void 0:o.materials)==null?void 0:c.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var i,o;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(o=(i=n[1]).toJSON)==null?void 0:o.call(i,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var o;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const i=this.getPluginByType(n.type);i&&((o=i.fromJSON)==null||o.call(i,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){const n=Object.assign({version:So.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(e,t)},di(this,!0,e));return n.backgroundIntensity=this.scene.backgroundIntensity,n.useLegacyLights=this.renderer.useLegacyLights,n.background=n.scene.background||n.scene.backgroundColor,n.background==="environment"&&(n.background="envMapBackground"),n}fromJSON(e,t){var i,o,c,f,m;const n={...e};return n.backgroundIntensity!==void 0&&((i=n.scene)==null?void 0:i.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=n.backgroundIntensity,delete n.backgroundIntensity),n.useLegacyLights!==void 0&&((o=n.renderManager)==null?void 0:o.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=n.useLegacyLights,delete n.useLegacyLights),n.background!==void 0&&((c=n.scene)==null?void 0:c.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),n.background==="envMapBackground"?n.background="environment":typeof n.background=="number"?n.background=new pt().setHex(n.background,s.GUF):typeof n.background=="string"?n.background=new pt().setStyle(n.background,s.GUF):(f=n.background)!=null&&f.isColor&&(n.background=new pt(n.background)),(m=n.background)!=null&&m.isColor?(this.scene.backgroundColor=n.background,this.scene.background=null):n.background?(this.scene.backgroundColor=new pt("#ffffff"),n.scene.background=n.background):(this.scene.backgroundColor=null,this.scene.background=null),delete n.background),Mi(n,this,!0,t),Array.isArray(n.plugins)&&this.deserializePlugins(n.plugins,t),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(e,t){if(e)return await this.assetManager.addAssetSingle(e,t)}async setEnvironmentMap(e,{setBackground:t=!1,...n}={}){return this.scene.environment=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(e,{setEnvironment:t=!1,...n}={}){return this.scene.background=e&&!e.isTexture?await this.assetManager.importer.importSingle(e,n)||null:e||null,t?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void this.console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}So.VERSION="0.8.5",Ed([ze("renderManager")],So.prototype,"_renderer",void 0),Ed([ze()],So.prototype,"scene",void 0),Ed([(0,a.onChange)(So.prototype._renderEnabledChanged)],So.prototype,"renderEnabled",void 0);const $c="envMapBackground";function nm(l){return l!=null&&l.isShaderPass2?l:new Ms({...v,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(l)?l[0]:(l==null?void 0:l.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(l)?l[1]:typeof l=="string"?l:(l==null?void 0:l.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}class Oa extends Ms{constructor(e){super({vertexShader:v.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=s.Wl3}render(e,t,n,i,o){super.render(e,t,n,i,o),this._lastReadBuffer=n,this.needsSwap=!0}reRender(e,t,n,i){this._lastReadBuffer&&this.render(e,t,this._lastReadBuffer,n,i)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class Jc extends br{get renderToScreen(){return this._renderToScreen}constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[vr],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var n,i;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(i=(n=this.pass).update)==null||i.call(n),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}async onAdded(e){var t,n;return(n=(t=this._viewer)==null?void 0:t.screenShader)!=null&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&(0,a.safeSetProperty)(e.renderer.passes.find(i=>i.passId==="screen"),"enabled",!1,!0,!0),e.addEventListener("postFrame",this._postFrame),super.onAdded(e)}async onRemove(e){return this._renderToScreen&&(0,a.safeSetProperty)(e.renderer.passes.find(t=>t.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(e)}passCtor(e){var o,c;const t=e.screenShader,n=["",""];this._renderToScreen&&!t.isShaderPass2&&(n[0]=Array.isArray(t)?t[0]:(t==null?void 0:t.pars)||"",n[1]=Array.isArray(t)?t[1]:typeof t=="string"?t:(t==null?void 0:t.main)||"");const i=new Oa(n);return(0,a.safeSetProperty)((c=(o=i.uiConfig)==null?void 0:o.children)==null?void 0:c.find(f=>(f==null?void 0:f.label)==="Enabled"),"hidden",!0,!0),i}_update(e){var t,n,i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)==null?void 0:t.getPlugin(vr)),this._pass.passObject.material.uniforms.tTransparent.value=((i=(n=this._viewer)==null?void 0:n.renderFilter.passObject.transparentTarget)==null?void 0:i.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t;return((t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig)??{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}Jc.PluginType="CombinedPostPlugin";var Dg=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Bl extends Ri{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Jc]}get uiConfig(){var e;return(e=this._extension)==null?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(Jc))==null||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}function Yl(l,e,t){return l&~(1<<e)|(t?1:0)<<e}function af(l,e){return l&~(1<<e)}Dg([ze("extension")],Bl.prototype,"_extension",void 0),Dg([ze()],Bl.prototype,"enabled",void 0);var $u,Sd=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const Dh=s.dZ3;let Zc=$u=class{constructor(l,e=!0){this.depthTonemap=e,this.toneMapping=s.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(t,n)=>this.enabled?a.glsl`
            ${this.depthTonemap?As:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${`int getToneMapBit(in int number){return(number/2)%2;}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=l.getPlugin(Jc),this._setDirty=this._setDirty.bind(this),this.depthTonemap=e}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(l,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:i,outputColorSpace:o}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=i,this._rendererState.outputColorSpace=o;let c=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==c&&(e.materialObject.defines.TONEMAP_BACKGROUND=c,e.materialObject.needsUpdate=!0),c=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==c&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=c,e.materialObject.needsUpdate=!0),c=this.renderDepth?"1":"0",e.materialObject.defines.DEBUG_DEPTH!==c&&(e.materialObject.defines.DEBUG_DEPTH=c,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputColorSpace=s.KI_,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(l,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._setDirty()}};Zc.PluginType="Tonemap",Sd([ct("Mode",[["Linear",s.EoG],["Reinhard",s.CdI],["Cineon",s.YGz],["ACESFilmic",s.LY2],["Uncharted2",Dh]].map(l=>({label:l[0],value:l[1]})),{limitedUi:!0}),(0,a.onChange)($u.prototype._setDirty),ze()],Zc.prototype,"toneMapping",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Yn("Tonemap Background",{limitedUi:!0}),ze()],Zc.prototype,"tonemapBackground",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Yn("Clip Background"),ze()],Zc.prototype,"clipBackground",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Pe("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),ze()],Zc.prototype,"exposure",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Pe("Saturation",[0,2],.01,{limitedUi:!0}),ze()],Zc.prototype,"saturation",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Pe("Contrast",[0,2],.01,{limitedUi:!0}),ze()],Zc.prototype,"contrast",void 0),Sd([(0,a.onChange)($u.prototype._setDirty),Yn("Render Depth")],Zc.prototype,"renderDepth",void 0),Zc=$u=Sd([on("Tonemapping")],Zc);class pp extends Bl{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}async onAdded(e){var t;await super.onAdded(e),(t=e.getPlugin(vr))==null||t.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Zc(e,this.depthTonemap)}get exposure(){var e;return((e=this._extension)==null?void 0:e.exposure)??1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get saturation(){var e;return((e=this._extension)==null?void 0:e.saturation)??1}set saturation(e){this._extension&&(this._extension.saturation=e,this._extension.setDirty())}get contrast(){var e;return((e=this._extension)==null?void 0:e.contrast)??1}set contrast(e){this._extension&&(this._extension.contrast=e,this._extension.setDirty())}get toneMapping(){var e;return((e=this._extension)==null?void 0:e.toneMapping)??s.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,t){var n,i;if(e instanceof s.Kj0&&((n=e.material)!=null&&n.userData)){const o=((i=e.material)==null?void 0:i.userData.postTonemap)===!1?0:1;t.w=Yl(t.w,1,o)}}}pp.PluginType="Tonemap",s.WdD.tonemapping_pars_fragment=s.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var uv,im=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let rm=uv=class{constructor(l){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?a.glsl`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=l.getPlugin(Jc),this._setDirty=this._setDirty.bind(this)}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(l,e,t){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._setDirty()}};rm.PluginType="ChromaticAberration",im([(0,a.onChange)(uv.prototype._setDirty),Yn("Enable"),ze()],rm.prototype,"enabled",void 0),im([(0,a.onChange)(uv.prototype._setDirty),Pe("Intensity",[0,.1],.001,{limitedUi:!0}),ze()],rm.prototype,"aberrationIntensity",void 0),rm=uv=im([on("ChromaticAberration")],rm);class Og extends Bl{constructor(){super()}generateExtension(e){return new rm(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.aberrationIntensity)??1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Og.PluginType="ChromaticAberration";class fp extends Ri{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}constructor(){super(),this._pipeline=[]}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=ji()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const i=n;e.renderer.unregisterPass(i),(t=i==null?void 0:i.dispose)==null||t.call(i)}this._passes=void 0}await super.onRemove(e)}toJSON(e){const t=super.toJSON(e);if(!t.type)return t;const n=Object.entries(this.passes);t.passes={};for(const[i,o]of n)t.passes[i]=di((o==null?void 0:o.passObject)??o,!1,e);return t}fromJSON(e,t){if(!super.fromJSON(e,t))return null;if(e.passes){const n=Object.entries(this.passes);for(const[i,o]of n)Mi(e.passes[i],(o==null?void 0:o.passObject)??o,!1,t)}return this}}var eA=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class hv extends Ms{constructor(e,t,n="rgba"){super({vertexShader:v.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new s.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new s.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,i,o){var c,f,m,y;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((c=this.uniforms.tDiffuse.value)==null?void 0:c.image.width)||0,((f=this.uniforms.tDiffuse.value)==null?void 0:f.image.height)||0),super.render(e,t,this._target,i,o),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((m=this.uniforms.tDiffuse.value)==null?void 0:m.image.width)||0,((y=this.uniforms.tDiffuse.value)==null?void 0:y.image.height)||0),super.render(e,this._target,t,i,o))}}eA([ze(),Ne()],hv.prototype,"smoothEnabled",void 0),eA([ze(),Ne()],hv.prototype,"edgeSharpness",void 0);var eu="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Ju=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,sm=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Bg=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Lg extends Ms{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new s.FM8(512,512)},saoData:{value:new s.Ltg},frameCount:{value:0},cameraNearFar:{value:new s.FM8(.1,1e3)},projection:{value:new s.yGw},saoBiasEpsilon:{value:new s.Pa4(1,1,1)}},vertexShader:eu,fragmentShader:`

${Ju}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){return(number/4)%2;}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;bool disableAO=getSelectionBit(getGBufferFlags(vUv).a)>0?true:false;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(i,o,c)=>{i.defines.SSAO_ENABLED&&(i.fragmentShader=i.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`))},onObjectRender:(i,o,c)=>{var w,S;this.materialExtension.extraUniforms.tSSAOMap.value=(w=this._target)==null?void 0:w.texture;const f=o.materialObject,m=!f.transparent&&f.transmission<.001;let y=this.enabled&&m&&c.userData.screenSpaceRendering!==!1&&!((S=o.userData)!=null&&S.ssaoDisabled)?1:0;f.defines.SSAO_ENABLED!==y&&(f.defines.SSAO_ENABLED=y,f.needsUpdate=!0),y=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==y&&(this.materialExtension.extraUniforms.tSSAOMap.value=y,f.needsUpdate=!0)},parsFragmentSnippet:i=>{var o;return a.glsl`
             uniform sampler2D tSSAOMap;
             ${pe("tSSAOMap",(o=this._target)==null?void 0:o.texture,i.capabilities.isWebGL2)}
            ${sm}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:i=>{var o,c;return this.enabled?"1":"0"+((c=(o=this._target)==null?void 0:o.texture)==null?void 0:c.colorSpace)},isCompatible:i=>{var o;return!((o=i.materialObject.userData)!=null&&o.ssaoDisabled)&&i.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new hv(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,i,o){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,o),this._smoothEnabled&&this.bilateralPass.render(e,t,n,i,o))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Bg([ze()],Lg.prototype,"bilateralPass",void 0),Bg([ze()],Lg.prototype,"parameters",void 0);class Vo extends fp{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[fi,vr],this.setDirty=this.setDirty.bind(this)}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[No(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new Lg(e.renderer,this._aoTarget,((t=e.getPlugin(vr))==null?void 0:t.getUnpackSnippet())??""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(vr)])}},()=>[e.getPlugin(vr),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssao)!=null&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var n;if(this._uiConfig)return this._uiConfig;const e=this,t=e.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[t,"enabled"],onChange:e.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[t.parameters,"intensity"],onChange:e.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[t.parameters,"occlusionWorldRadius"],onChange:e.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[t.parameters,"bias"],onChange:e.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[t.parameters,"falloff"],onChange:e.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(n=t.material)==null?void 0:n.defines,"NUM_SAMPLES"],onChange:[()=>t.material.needsUpdate=!0,e.setDirty]},{type:"checkbox",property:[t.bilateralPass,"smoothEnabled"],onChange:e.setDirty},{type:"vec4",property:[t.bilateralPass,"edgeSharpness"],onChange:e.setDirty}]}}}Vo.PluginType="SSAO";var wc,Xs=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Ba=wc=class extends Ms{constructor(){super({vertexShader:v.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new s.FM8},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:As+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){return(number/4)%2;}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new s.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(l,e,t,n,i){const o=l.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const c=t;let f=.5,m=c.width*f,y=c.height*f;const w=[];let S=o.getTempTarget({sizeMultiplier:1,type:s.cLu});w.push(S);let C=c;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(l,S,C,n,i),C=S;let O=1;for(;O<this.bloomIterations&&(m/=2,y/=2,f/=2,!(y<2||m<2));O++){S=o.getTempTarget({sizeMultiplier:f,type:s.cLu}),w.push(S),this.material.defines.PASS_STEP=1;let H=this._weights[O];H=this._weights[O-1]!==0?this._weights[O]/this._weights[O-1]:this._weights[O],this.material.uniforms.weight.value=H,this.material.needsUpdate=!0,super.render(l,S,C,n,i),C=S}this.clear=!1;const N=l.autoClear;for(l.autoClear=!1,O-=2;O>=0;O--)S=w[O],w[O]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=s.WMw,this.material.needsUpdate=!0,l.autoClear=!1,super.render(l,S,C,n,i),this.material.blending=s.jFi,o.releaseTempTarget(C),C=S;this.clear=!0,l.autoClear=N,l.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(l,e,C,n,i)):(this.uniforms.tSource.value=c.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(l,e,C,n,i),this.uniforms.tSource.value=null),o.releaseTempTarget(C)}_updateWeights(){if(!this._weights)return;const l=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,i=1.2-n;n=Math.pow(n,this.power),i=Math.pow(i,this.power),this._weights[t]=i*(1-l)+n*l}this.setDirty()}};function lf(l){const e=l==null?void 0:l.userData;return!!e&&(e[Go.PluginType]||(e[Go.PluginType]={}),e[Go.PluginType].enable=!0,l.isMaterial&&(l.needsUpdate=!0),!0)}Xs([Ne()],Ba.prototype,"prefilter",void 0),Xs([Pe("Threshold",[0,2]),(0,a.onChange)(wc.prototype._thresholdsUpdated),ze()],Ba.prototype,"threshold",void 0),Xs([Pe("Soft Threshold",[0,1]),(0,a.onChange)(wc.prototype._thresholdsUpdated),ze()],Ba.prototype,"softThreshold",void 0),Xs([Pe("Intensity",[0,3]),ze(),Ne()],Ba.prototype,"intensity",void 0),Xs([Pe("Iterations",[0,7],1),(0,a.onChange)(wc.prototype._updateWeights),ze()],Ba.prototype,"bloomIterations",void 0),Xs([Pe("Radius",[0,1],.01),(0,a.onChange)(wc.prototype._updateWeights),ze()],Ba.prototype,"radius",void 0),Xs([Pe("Power",[.2,10],.01),(0,a.onChange)(wc.prototype._updateWeights),ze()],Ba.prototype,"power",void 0),Xs([Yn("Debug")],Ba.prototype,"bloomDebug",void 0),Ba=wc=Xs([on("Bloom")],Ba);class Go extends br{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:ji(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},isCompatible:e=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(e){const t={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=e.materialObject.userData[Go.PluginType])==null?void 0:n.enable)??!0},set value(n){var o;const i=e.materialObject.userData[Go.PluginType];n!==(i==null?void 0:i.enable)&&(i||lf(e.materialObject),e.materialObject.userData[Go.PluginType].enable=n,(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty}]};return t}passCtor(e){const t=new Ba;return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),t}async onAdded(e){var n,i;await super.onAdded(e),(n=e.getPlugin(vr))==null||n.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(fi);(i=t==null?void 0:t.materials)==null||i.registerMaterialExtension(this.materialExtension)}updateGBuffer(e,t){var n,i;if(e instanceof s.Kj0&&((n=e.material)!=null&&n.userData)){const o=(i=e.material)==null?void 0:i.userData[Go.PluginType],c=(o==null?void 0:o.enable)===!1?0:1;t.w=Yl(t.w,2,c)}}_update(e){var t,n;return(n=e.getPlugin(vr))==null||n.updateShaderProperties((t=this.pass)==null?void 0:t.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Go.PluginType="Bloom";var Oh="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",fo=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const mo={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new s.FM8},cameraNearFar:{value:new s.FM8}},vertexShader:eu,fragmentShader:As+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},om=(bo({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new s.FM8},direction:{value:new s.FM8}},vertexShader:eu,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),bo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new s.FM8},direction:{value:new s.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:eu,fragmentShader:Ju+`
`+Oh+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class Md extends Ms{constructor(){super(mo,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=om,this.nearFarBlurScale=new s.FM8(.25,.25),this.focalDepthRange=new s.FM8(.5,1.5),this.crossCenter=new s.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new pt(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=bo({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:eu,fragmentShader:As+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=bo({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new s.FM8},direction:{value:new s.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:eu,fragmentShader:As+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,i,o){if(!this.enabled)return;const c=e.baseRenderer,f={minFilter:s.TyD,magFilter:s.TyD,type:s.cLu,encoding:s.rnI,sizeMultiplier:.5,isAntialiased:!1,format:s.wk1,depthBuffer:!1,generateMipmaps:!1},m=c.getTempTarget(f),y=c.getTempTarget(f);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,c.blit(void 0,m,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=m.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),c.blit(void 0,y,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=y.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),c.blit(void 0,m,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=m.texture,c.blit(void 0,y,{material:this.dofBlurMaterial});else{const w=c.getTempTarget(f);this.dofBlurMaterial.uniforms.cocTexture.value=m.texture,this.dofBlurMaterial.uniforms.colorTexture.value=m.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),c.blit(void 0,w,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=w.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),c.blit(void 0,y,{material:this.dofBlurMaterial}),c.releaseTempTarget(w)}this.material.uniforms.blurTexture.value=y.texture,this.material.uniforms.cocTexture.value=m.texture,super.render(e,t,n,i,o),c.releaseTempTarget(m),c.releaseTempTarget(y)}}fo([ze(),Ne()],Md.prototype,"nearFarBlurScale",void 0),fo([ze(),Ne()],Md.prototype,"focalDepthRange",void 0),fo([Ne()],Md.prototype,"crossCenter",void 0),fo([Ne()],Md.prototype,"crossRadius",void 0),fo([Ne()],Md.prototype,"crossAlpha",void 0),fo([Ne()],Md.prototype,"crossColor",void 0);class I0 extends Ms{constructor(e){super({vertexShader:v.vertexShader,fragmentShader:a.glsl`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new s.Ltg(1,1,1,1)},weight2:{value:new s.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}var dv=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const Bh=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class to extends fp{constructor(e=2*Bh.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(i=>{var o;(o=i==null?void 0:i.shadow)!=null&&o.camera&&i.shadow.mapSize&&this.trackedJitterCameras.add([i.shadow.camera,i.shadow.mapSize])})},this._jitterCamera=t=>{var i;const n=t.target;if(this.jitter&&n.renderer.frameCount>1){const o=(f,m)=>{const y={...Bh[n.renderer.frameCount%Bh.length]};f.setViewOffset(m.width,m.height,y.x,y.y,m.width,m.height)},c=n.scene.activeCamera.cameraObject;o(c,{width:n.canvas.clientWidth*n.renderer.displayCanvasScaling,height:n.canvas.clientHeight*n.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(f=>o(...f)),this._hasSetOffset=!0,(i=this._viewer)==null||i.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=rn("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[No(e,{passId:"progressive",get dirty(){var n;return t.jitter&&(((n=t._viewer)==null?void 0:n.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends I0{render(n,i,o,c,f){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((o==null?void 0:o.texture)&&e.renderer.blit(o.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(n,i,o,c,f),e.renderer.blit(i.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let n=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(n,n,n,n),n=1-n,this.passObject.weights2.set(n,n,n,n),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)==null?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=((t=this.lastFrame)==null?void 0:t.texture)??void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}to.PluginType="Progressive",dv([ze(),Ke("Frame count")],to.prototype,"maxFrameCount",void 0),dv([ze(),Yn("Jitter")],to.prototype,"jitter",void 0);class Zu extends br{async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:s.wem,magFilter:s.wem,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await(0,a.timeout)(e))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[to],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(e.fadeDuration||1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(e.fadeDuration||200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(e.fadeDuration||500)},this._onPointerMove=e=>{var c;const t=(c=this._viewer)==null?void 0:c.canvas;if(!t)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==t)return void(this.pointerEnabled=!0);const n=t.getBoundingClientRect(),i=(e.clientX-n.left)/n.width,o=(e.clientY-n.top)/n.height;this.pointerEnabled=i<0||i>1||o<0||o>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(to),i=new class extends I0{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=rn("Frame Fade",this)}render(o,c,f,m,y){this.needsSwap=!1;const w=t._target;if(!w||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001)return;t._toSaveFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,w),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=w==null?void 0:w.texture;const S=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(S),this.weights2.w=1,this.weights1.setScalar(1-S),this.weights1.w=1,super.render(o,c,f,m,y),this.needsSwap=!0;const C=(0,a.now)();this._lastTime<10&&(this._lastTime=C-10);const O=C-this._lastTime;this._lastTime=C,t._fadeTimeState-=O}};return i.enabled=!0,i}setDirty(){var e;this.enabled&&((e=this._viewer)==null||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)==null?void 0:e.passObject)==null?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Zu.PluginType="FrameFade";var P0=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class mp extends br{passCtor(e){return new Md}constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[vr],this.enableEdit=!1,this._focalPointHit=new s.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new s.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(e,t=!0,n=!1){var i,o;this._focalPointHit.copy(e),t&&((o=(i=this._viewer)==null?void 0:i.getPlugin(Zu))==null||o.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=(0,a.now)()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e;return((e=this.pass)==null?void 0:e.passObject.focalDepthRange.y)??0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.x)??0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e;return((e=this.pass)==null?void 0:e.passObject.nearFarBlurScale.y)??0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)==null?void 0:t.getPlugin(Zu))==null||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))==null||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))==null||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_update(e){var c,f;if(!super._update(e))return!1;const t=(c=this.pass)==null?void 0:c.passObject;if(!t)return!1;const n=e.getPlugin(vr);n==null||n.updateShaderProperties(t.material),t.dofBlurMaterial.uniforms.frameCount&&((f=e.renderer)==null||f.updateShaderProperties(t.dofBlurMaterial));const i=e.scene.activeCamera;if(!i)return!1;i.cameraObject.updateMatrixWorld(!0),i.updateShaderProperties(t.material),i.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),t.focalDepthRange.x=this._tempVec.length(),t.focalDepthRange.x*=i.cameraObject.getWorldDirection(new s.Pa4).dot(this._tempVec.normalize());let o=((0,a.now)()-this._focalPointHitTime)/this.crossFadeTime;if(o=1-Math.min(1,Math.max(0,o)),Math.abs(o-t.crossAlpha)>.01&&(t.crossAlpha=o,this.setDirty()),o>0){const m=this._tempVec.copy(this._focalPointHit).project(i.cameraObject).addScalar(1).divideScalar(2);t.crossCenter.set(m.x,m.y),t.computeCocMaterial.uniformsNeedUpdate=!0,t.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var t,n,i,o,c;if(this._uiConfig)return this._uiConfig;const e=(n=(t=this._pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig;return e?((o=(i=e.children)==null?void 0:i.map(f=>(0,a.getOrCall)(f)))==null||o.flat(2).forEach(f=>f&&(f.onChange=this.setDirty)),(c=e.children)==null||c.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=e,e):{}}}mp.PluginType="DepthOfField",P0([ze()],mp.prototype,"enableEdit",void 0),P0([ze("focalPoint")],mp.prototype,"_focalPointHit",void 0),P0([ze()],mp.prototype,"crossFadeTime",void 0);var Ng=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Ec=class extends Ri{addThinFilmLayer(l){return am(l.materialObject)}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new D0(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new s.Ltg},thinNoiseLayerFactors:{value:new s.Ltg},thinColorNoiseParams:{value:new s.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(l,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)!=null&&t.hasThinFilm)?Ju+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(l,e,t)=>{var i;if(!this.enabled||!((i=e.materialObject.userData._thinFilmLayer)!=null&&i.hasThinFilm))return;const n="#glMarker beforeAccumulation";l.fragmentShader=l.fragmentShader.replace(n,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+n),l.defines.USE_UV=""},onObjectRender:(l,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._thinFilmLayer;if(!(t!=null&&t.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(t.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(t.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(t.colorNoiseParams),this._uniforms.thinFilmFactor.value=t.filmFactor;const n=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==n&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t;return(this.enabled?"1":"0")+((t=(e=l.materialObject.userData)==null?void 0:e._thinFilmLayer)!=null&&t.hasThinFilm?"1":"0")},isCompatible:l=>l.isMeshStandardMaterial2||l.isDiamondMaterial,updaters:()=>[],getUiConfig:l=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=l.materialObject.userData._thinFilmLayer)==null?void 0:n.hasThinFilm)||!1},set value(n){var i,o;n!==((i=l.materialObject.userData._thinFilmLayer)==null?void 0:i.hasThinFilm)&&(n?am(l.materialObject)||e.alert("Cannot add thin film."):l.materialObject.userData._thinFilmLayer&&(l.materialObject.userData._thinFilmLayer.hasThinFilm=!1,l.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!((n=l.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[l.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!((n=l.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[l.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!((n=l.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[l.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=l.materialObject.userData._thinFilmLayer)!=null&&n.hasThinFilm)},property:[l.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var l;(l=this._viewer)==null||l.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(go)}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};function am(l){const e=l==null?void 0:l.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),l.isMaterial&&(l.needsUpdate=!0),!0}Ec.PluginType="ThinFilmLayerPlugin",Ec.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Ng([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],Ec.prototype,"enabled",void 0),Ec=Ng([on("ThinFilmLayer Materials")],Ec);class D0{constructor(e){this.parser=e,this.name=Ec.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),am(t),t.userData._thinFilmLayer=Mi(i,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const go=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=di(e.userData._thinFilmLayer,!1);t.extensions[Ec.THIN_FILM_LAYER_GLTF_EXTENSION]=n,l.extensionsUsed[Ec.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});class kg{async apply(e,t,n){var o,c;if(!t)return void(this.selected=void 0);let i=this.presets.find(f=>f.path===t.path);return i||(this.presets.push(t),i=t),this.selected=i,(c=(o=e.getManager())==null?void 0:o.importer)==null?void 0:c.importAsset(i,n)}constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}}class O0 extends kg{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(i.colorSpace=s.KI_,e.scene.background=i),i}}class eh extends kg{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return i&&(e.scene.environment=i),i}}class B0 extends kg{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const n=await super.apply(e,t),i=n==null?void 0:n[0];return(0,a.safeSetProperty)(e.getPluginByType("Diamond"),"envMap",i),i}}class cf extends kg{async apply(e,t){var i,o;const n=await super.apply(e,t,{processImported:!1});return n?(o=(i=e.getManager())==null?void 0:i.importer)==null?void 0:o.processImported(n):void 0}}class tA extends cf{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class uf extends Ri{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>({label:t.path.split("/").pop(),value:t.path}))],getValue:()=>{var t;return((t=e.selected)==null?void 0:t.path)||""},setValue:t=>{e.apply(this._viewer,e.presets.find(n=>n.path===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();(0,a.downloadFile)(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();(0,a.downloadFile)(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new O0),this.presetGroups.push(new eh),this.presetGroups.push(new B0),this.presetGroups.push(new cf("Ground")),this.presetGroups.push(new cf("CameraViews")),this.presetGroups.push(new cf("MaterialConfiguration")),this.presetGroups.push(new tA),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>{var n;return[t.name,((n=t.selected)==null?void 0:n.path)||void 0]}).filter(([,t])=>t));return e.type=uf.PluginType,e}async fromJSON(e,t){var o,c;if(!super.fromJSON(e,t))return null;const n={...e};delete n.type;const i=[];for(const[f,m]of Object.entries(n)){const y=this.presetGroups.find(C=>C.name===f),w=y==null?void 0:y.presets;if(!y||!w)continue;const S=typeof m=="string"?{path:m}:m;i.push(y.apply(this._viewer,S))}return await Promise.all(i),(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0),this}loadPresetGroups(e){var t;for(const[n,i]of Object.entries(e)){const o=(t=this.presetGroups.find(c=>c.name===n))==null?void 0:t.presets;o==null||o.push(...i)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(t=>t.path)]).filter(([,e])=>e.length>0))}}uf.PluginType="PresetLibraryPlugin";var ul,th=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let gp=ul=class{constructor(l){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?a.glsl`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=l.getPlugin(Jc),this._setDirty=this._setDirty.bind(this)}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(l,e,t){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._setDirty()}};th([(0,a.onChange)(ul.prototype._setDirty),Yn("Enable"),ze()],gp.prototype,"enabled",void 0),th([(0,a.onChange)(ul.prototype._setDirty),Yn("Multiply"),ze()],gp.prototype,"grainMultiply",void 0),th([(0,a.onChange)(ul.prototype._setDirty),Pe("Intensity",[0,20],.01,{limitedUi:!0}),ze()],gp.prototype,"grainIntensity",void 0),gp=ul=th([on("FilmicGrain")],gp);class lm extends Bl{constructor(){super()}generateExtension(e){return new gp(e)}get intensity(){var e;return((e=this._extension)==null?void 0:e.grainIntensity)??1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e;return((e=this._extension)==null?void 0:e.grainMultiply)??!1}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}lm.PluginType="FilmicGrain";class Kl extends a.SimpleEventDispatcher{get scene(){return this._scene}set scene(e){var t;(t=this._scene)==null||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(e,t,n,i){super(),this.hoverEnabled=!1,this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=i??(o=>o.userData.userSelectable!==!1&&o.userData.bboxVisible!==!1&&o.material!=null&&o.material.type!=="ShadowMaterial"),this.raycaster=new s.iMs,this.mouse=new s.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",o=>this.onPointerMove(o)),this.domElement.addEventListener("pointerleave",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointerout",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointercancel",o=>this.onPointerCancel(o)),this.domElement.addEventListener("pointerenter",o=>this.onPointerEnter(o)),this.domElement.addEventListener("pointerdown",o=>this.onPointerDown(o)),this.domElement.addEventListener("pointerup",o=>this.onPointerUp(o))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=(0,a.now)(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){var t;e.isPrimary!==!1&&(this.updateMouseFromEvent(e),this.hoverEnabled&&(this.hoverObject=((t=this.checkIntersection())==null?void 0:t.intersects[0].object)??null))}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var m;const e=(m=this._camera)==null?void 0:m.cameraObject;if(!e)return null;this.raycaster.setFromCamera(this.mouse,e);let t=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const n=[];t=t.filter(y=>!n.includes(y.object.id)&&(n.push(y.object.id),!0));let o,c=null;const f=[];for(const y of t){for(c=y.object,o=y;!(c==null||c.visible&&this.selectionCondition(c));)c=c.parent;c!=null&&f.push(y)}if(t=f,t.length>0){if(c=t[0].object,o=t[0],this._firstHit&&c.id!==this._firstHit.id)c=o.object;else for(let y=0;y<t.length;y++)if(this.selectedObject&&this.selectedObject.id===t[y].object.id){const w=y+1;if(!(w<t.length))return null;o=t[w],c=o.object}this._firstHit=t[0].object}return c&&o&&c?{selectedObject:c,intersect:o,intersects:t,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const nA=new s.ZzF,pv=new s.Pa4;class Ug extends s.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new s.$TI(t,6,1);return this.setAttribute("instanceStart",new s.kB5(n,3,0)),this.setAttribute("instanceEnd",new s.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new s.$TI(t,6,1);return this.setAttribute("instanceColorStart",new s.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new s.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new s.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new s.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),nA.setFromBufferAttribute(t),this.boundingBox.union(nA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new s.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let o=0,c=e.count;o<c;o++)pv.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(pv)),pv.fromBufferAttribute(t,o),i=Math.max(i,n.distanceToSquared(pv));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class L0 extends Ug{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new s.Uk6(e))}}s.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new s.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},s.Vj0.line={uniforms:s.rDY.merge([s.rBU.common,s.rBU.fog,s.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Fg extends s.jyz{constructor(e){super({type:"LineMaterial",uniforms:s.rDY.clone(s.Vj0.line.uniforms),vertexShader:s.Vj0.line.vertexShader,fragmentShader:s.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const fv=new s.Pa4,hf=new s.Pa4;class cm extends s.Kj0{constructor(e=new Ug,t=new Fg({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let c=0,f=0,m=t.count;c<m;c++,f+=2)fv.fromBufferAttribute(t,c),hf.fromBufferAttribute(n,c),i[f]=f===0?0:i[f-1],i[f+1]=i[f]+fv.distanceTo(hf);const o=new s.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new s.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new s.kB5(o,1,1)),this}}class N0 extends s.ZAu{_updater(){const e=this._object;if(e){const t=new X().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new s.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(e){if(this._geometry)return;const t=new L0(e);this._geometry=t;const n=new Fg({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new s.FM8(1024,1024),dashed:!1,toneMapped:!1}),i=new cm(t,n);i.computeLineDistances(),i.scale.set(1,1,1),i.visible=!0,this.add(i)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)==null||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)==null||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class k0 extends N0{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new s.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new X().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}const df=new s.iMs,Sc=new s.Pa4,_p=new s.Pa4,Mo=new s._fP,iA={X:new s.Pa4(1,0,0),Y:new s.Pa4(0,1,0),Z:new s.Pa4(0,0,1)},$o={type:"change"},Lh={type:"mouseDown"},Nh={type:"mouseUp",mode:null},Td={type:"objectChange"};class mv extends s.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new yv;this._gizmo=n,this.add(n);const i=new Sb;this._plane=i,this.add(i);const o=this;function c(J,V){let z=V;Object.defineProperty(o,J,{get:function(){return z!==void 0?z:V},set:function(ue){z!==ue&&(z=ue,i[J]=ue,n[J]=ue,o.dispatchEvent({type:J+"-changed",value:ue}),o.dispatchEvent($o))}}),o[J]=V,i[J]=V,n[J]=V}c("camera",e),c("object",void 0),c("enabled",!0),c("axis",null),c("mode","translate"),c("translationSnap",null),c("rotationSnap",null),c("scaleSnap",null),c("space","world"),c("size",1),c("dragging",!1),c("showX",!0),c("showY",!0),c("showZ",!0);const f=new s.Pa4,m=new s.Pa4,y=new s._fP,w=new s._fP,S=new s.Pa4,C=new s._fP,O=new s.Pa4,N=new s.Pa4,H=new s.Pa4,q=new s.Pa4;c("worldPosition",f),c("worldPositionStart",m),c("worldQuaternion",y),c("worldQuaternionStart",w),c("cameraPosition",S),c("cameraQuaternion",C),c("pointStart",O),c("pointEnd",N),c("rotationAxis",H),c("rotationAngle",0),c("eye",q),this._offset=new s.Pa4,this._startNorm=new s.Pa4,this._endNorm=new s.Pa4,this._cameraScale=new s.Pa4,this._parentPosition=new s.Pa4,this._parentQuaternion=new s._fP,this._parentQuaternionInv=new s._fP,this._parentScale=new s.Pa4,this._worldScaleStart=new s.Pa4,this._worldQuaternionInv=new s._fP,this._worldScale=new s.Pa4,this._positionStart=new s.Pa4,this._quaternionStart=new s._fP,this._scaleStart=new s.Pa4,this._getPointer=gv.bind(this),this._onPointerDown=zg.bind(this),this._onPointerHover=rA.bind(this),this._onPointerMove=sA.bind(this),this._onPointerUp=Eb.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;df.setFromCamera(e,this.camera);const t=jg(this._gizmo.picker[this.mode],df);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){df.setFromCamera(e,this.camera);const t=jg(this._plane,df,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Lh.mode=this.mode,this.dispatchEvent(Lh)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let o=this.space;if(n==="scale"?o="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(o="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;df.setFromCamera(e,this.camera);const c=jg(this._plane,df,!0);if(c){if(this.pointEnd.copy(c.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(i.position.applyQuaternion(Mo.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),o==="world"&&(i.parent&&i.position.add(Sc.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Sc.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let f=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(f*=-1),_p.set(f,f,f)}else Sc.copy(this.pointStart),_p.copy(this.pointEnd),Sc.applyQuaternion(this._worldQuaternionInv),_p.applyQuaternion(this._worldQuaternionInv),_p.divide(Sc),t.search("X")===-1&&(_p.x=1),t.search("Y")===-1&&(_p.y=1),t.search("Z")===-1&&(_p.z=1);i.scale.copy(this._scaleStart).multiply(_p),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const f=20/this.worldPosition.distanceTo(Sc.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Sc.copy(this.rotationAxis).cross(this.eye))*f):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(iA[t]),Sc.copy(iA[t]),o==="local"&&Sc.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Sc.cross(this.eye).normalize())*f),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Mo.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Mo.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($o),this.dispatchEvent(Td)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Nh.mode=this.mode,this.dispatchEvent(Nh)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($o),this.dispatchEvent(Td),this.pointStart.copy(this.pointEnd))}getRaycaster(){return df}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function gv(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function rA(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l))}}function zg(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function sA(l){this.enabled&&this.pointerMove(this._getPointer(l))}function Eb(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function jg(l,e,t){const n=e.intersectObject(l,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const vp=new s.USm,Ps=new s.Pa4(0,1,0),_v=new s.Pa4(0,0,0),Vg=new s.yGw,Gg=new s._fP,um=new s._fP,nh=new s.Pa4,vv=new s.yGw,hm=new s.Pa4(1,0,0),pf=new s.Pa4(0,1,0),kh=new s.Pa4(0,0,1),ff=new s.Pa4,dm=new s.Pa4,pm=new s.Pa4;class yv extends s.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new s.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new s.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const o=e.clone();o.color.setHex(16711680);const c=e.clone();c.color.setHex(65280);const f=e.clone();f.color.setHex(255);const m=e.clone();m.color.setHex(16711680),m.opacity=.5;const y=e.clone();y.color.setHex(65280),y.opacity=.5;const w=e.clone();w.color.setHex(255),w.opacity=.5;const S=e.clone();S.opacity=.25;const C=e.clone();C.color.setHex(16776960),C.opacity=.25,e.clone().color.setHex(16776960);const O=e.clone();O.color.setHex(7895160);const N=new s.fHI(0,.04,.1,12);N.translate(0,.05,0);const H=new s.DvJ(.08,.08,.08);H.translate(0,.04,0);const q=new s.u9r;q.setAttribute("position",new s.a$l([0,0,0,1,0,0],3));const J=new s.fHI(.0075,.0075,.5,3);function V(mt,gt){const Ot=new s.XvJ(mt,.0075,3,64,gt*Math.PI*2);return Ot.rotateY(Math.PI/2),Ot.rotateX(Math.PI/2),Ot}J.translate(0,.25,0);const z={X:[[new s.Kj0(N,o),[.5,0,0],[0,0,-Math.PI/2]],[new s.Kj0(N,o),[-.5,0,0],[0,0,Math.PI/2]],[new s.Kj0(J,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new s.Kj0(N,c),[0,.5,0]],[new s.Kj0(N,c),[0,-.5,0],[Math.PI,0,0]],[new s.Kj0(J,c)]],Z:[[new s.Kj0(N,f),[0,0,.5],[Math.PI/2,0,0]],[new s.Kj0(N,f),[0,0,-.5],[-Math.PI/2,0,0]],[new s.Kj0(J,f),null,[Math.PI/2,0,0]]],XYZ:[[new s.Kj0(new s.pQR(.1,0),S.clone()),[0,0,0]]],XY:[[new s.Kj0(new s.DvJ(.15,.15,.01),w.clone()),[.15,.15,0]]],YZ:[[new s.Kj0(new s.DvJ(.15,.15,.01),m.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s.Kj0(new s.DvJ(.15,.15,.01),y.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},ue={X:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,.3,0]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new s.Kj0(new s.pQR(.2,0),n)]],XY:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},me={START:[[new s.Kj0(new s.pQR(.01,2),i),null,null,null,"helper"]],END:[[new s.Kj0(new s.pQR(.01,2),i),null,null,null,"helper"]],DELTA:[[new s.x12(function(){const mt=new s.u9r;return mt.setAttribute("position",new s.a$l([0,0,0,1,1,1],3)),mt}(),i),null,null,null,"helper"]],X:[[new s.x12(q,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.x12(q,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.x12(q,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Te={XYZE:[[new s.Kj0(V(.5,1),O),null,[0,Math.PI/2,0]]],X:[[new s.Kj0(V(.5,.5),o)]],Y:[[new s.Kj0(V(.5,.5),c),null,[0,0,-Math.PI/2]]],Z:[[new s.Kj0(V(.5,.5),f),null,[0,Math.PI/2,0]]],E:[[new s.Kj0(V(.75,1),C),null,[0,Math.PI/2,0]]]},Be={AXIS:[[new s.x12(q,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},He={XYZE:[[new s.Kj0(new s.xo$(.25,10,8),n)]],X:[[new s.Kj0(new s.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s.Kj0(new s.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s.Kj0(new s.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s.Kj0(new s.XvJ(.75,.1,2,24),n)]]},tt={X:[[new s.Kj0(H,o),[.5,0,0],[0,0,-Math.PI/2]],[new s.Kj0(J,o),[0,0,0],[0,0,-Math.PI/2]],[new s.Kj0(H,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new s.Kj0(H,c),[0,.5,0]],[new s.Kj0(J,c)],[new s.Kj0(H,c),[0,-.5,0],[0,0,Math.PI]]],Z:[[new s.Kj0(H,f),[0,0,.5],[Math.PI/2,0,0]],[new s.Kj0(J,f),[0,0,0],[Math.PI/2,0,0]],[new s.Kj0(H,f),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new s.Kj0(new s.DvJ(.15,.15,.01),w),[.15,.15,0]]],YZ:[[new s.Kj0(new s.DvJ(.15,.15,.01),m),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s.Kj0(new s.DvJ(.15,.15,.01),y),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s.Kj0(new s.DvJ(.1,.1,.1),S.clone())]]},lt={X:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,.3,0]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new s.Kj0(new s.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s.Kj0(new s.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s.Kj0(new s.DvJ(.2,.2,.2),n),[0,0,0]]]},at={X:[[new s.x12(q,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.x12(q,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.x12(q,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function St(mt){const gt=new s.Tme;for(const Ot in mt)for(let Bt=mt[Ot].length;Bt--;){const Ft=mt[Ot][Bt][0].clone(),_n=mt[Ot][Bt][1],mn=mt[Ot][Bt][2],qn=mt[Ot][Bt][3],Rn=mt[Ot][Bt][4];Ft.name=Ot,Ft.tag=Rn,_n&&Ft.position.set(_n[0],_n[1],_n[2]),mn&&Ft.rotation.set(mn[0],mn[1],mn[2]),qn&&Ft.scale.set(qn[0],qn[1],qn[2]),Ft.updateMatrix();const En=Ft.geometry.clone();En.applyMatrix4(Ft.matrix),Ft.geometry=En,Ft.renderOrder=1/0,Ft.position.set(0,0,0),Ft.rotation.set(0,0,0),Ft.scale.set(1,1,1),gt.add(Ft)}return gt}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=St(z)),this.add(this.gizmo.rotate=St(Te)),this.add(this.gizmo.scale=St(tt)),this.add(this.picker.translate=St(ue)),this.add(this.picker.rotate=St(He)),this.add(this.picker.scale=St(lt)),this.add(this.helper.translate=St(me)),this.add(this.helper.rotate=St(Be)),this.add(this.helper.scale=St(at)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:um;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const o=n[i];let c;o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),c=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(c*this.size/4),o.tag!=="helper"?(o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ps.copy(hm).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ps.copy(pf).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ps.copy(kh).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ps.copy(kh).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ps.copy(hm).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ps.copy(pf).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Gg.copy(t),Ps.copy(this.eye).applyQuaternion(Mo.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Vg.lookAt(this.eye,_v,pf)),o.name==="X"&&(Mo.setFromAxisAngle(hm,Math.atan2(-Ps.y,Ps.z)),Mo.multiplyQuaternions(Gg,Mo),o.quaternion.copy(Mo)),o.name==="Y"&&(Mo.setFromAxisAngle(pf,Math.atan2(Ps.x,Ps.z)),Mo.multiplyQuaternions(Gg,Mo),o.quaternion.copy(Mo)),o.name==="Z"&&(Mo.setFromAxisAngle(kh,Math.atan2(Ps.y,Ps.x)),Mo.multiplyQuaternions(Gg,Mo),o.quaternion.copy(Mo))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(f){return o.name===f}))&&(o.material.color.setHex(16776960),o.material.opacity=1)):(o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Mo.setFromEuler(vp.set(0,0,0)),o.quaternion.copy(t).multiply(Mo),Math.abs(Ps.copy(hm).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Mo.setFromEuler(vp.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(Mo),Math.abs(Ps.copy(pf).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Mo.setFromEuler(vp.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(Mo),Math.abs(Ps.copy(kh).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Mo.setFromEuler(vp.set(0,Math.PI/2,0)),Ps.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Vg.lookAt(_v,Ps,pf)),o.quaternion.multiply(Mo),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Sc.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Sc.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Sc),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1)))}super.updateMatrixWorld(e)}}class Sb extends s.Kj0{constructor(){super(new s._12(1e5,1e5,2,2),new s.vBJ({visible:!1,wireframe:!0,side:s.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),ff.copy(hm).applyQuaternion(t==="local"?this.worldQuaternion:um),dm.copy(pf).applyQuaternion(t==="local"?this.worldQuaternion:um),pm.copy(kh).applyQuaternion(t==="local"?this.worldQuaternion:um),Ps.copy(dm),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ps.copy(this.eye).cross(ff),nh.copy(ff).cross(Ps);break;case"Y":Ps.copy(this.eye).cross(dm),nh.copy(dm).cross(Ps);break;case"Z":Ps.copy(this.eye).cross(pm),nh.copy(pm).cross(Ps);break;case"XY":nh.copy(pm);break;case"YZ":nh.copy(ff);break;case"XZ":Ps.copy(pm),nh.copy(dm);break;case"XYZ":case"E":nh.set(0,0,0)}break;default:nh.set(0,0,0)}nh.length()===0?this.quaternion.copy(this.cameraQuaternion):(vv.lookAt(Sc.set(0,0,0),nh,Ps),this.quaternion.setFromRotationMatrix(vv)),super.updateMatrixWorld(e)}}class oA extends mv{_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(s.M8C.degToRad(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)==null||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(Zu);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var aA=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class us extends Ri{get picker(){return this._picker}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}constructor(e=k0,t=!1,n=!0,i=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=o=>{this._viewer&&(this.enabled?this.dispatchEvent(o):o.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const o=this.getSelectedObject();this.autoFocus&&o&&this.setSelectedObject(o,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=i}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)==null?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new Kl(e.scene,e.canvas,void 0,t=>{if(!t.material)return!1;let n=t,i=!1;for(;n;){if(!n.visible||((n.userData.iModel??n).assetType==="model"&&(i=!0),(n.userData.iModel??n).assetType==="widget")||n.userData.userSelectable===!1||n.userData.bboxVisible===!1)return!1;n=n.parent}return i}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new oA(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var c,f,m;this.dispatchEvent(t);const n=((c=this._picker)==null?void 0:c.selectedObject)||void 0;if(this._pickUi){const y=n==null?void 0:n.uiConfig,w=this.uiConfig;w.children=[...this._uiConfigChildren],y&&w.children.push(y),(f=w.uiRefresh)==null||f.call(w)}const i=this._widget;i&&this._enableWidget&&(n?i.attach(n):i.detach());const o=this._transformControls;o&&((m=this._viewer)!=null&&m.scene.activeCamera.controls)&&(n&&o.enabled?o.attach(n):o.detach()),e.setDirty(),this.autoFocus&&this.focusObject(n)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(t.value,this.autoFocus||t.focusCamera)}),e.scene.addEventListener("addSceneObject",async t=>{var o,c;const n=t.object,i=this.getSelectedObject();if(i&&(n==null?void 0:n.assetType)==="material"&&typeof(i==null?void 0:i.setMaterial)=="function"&&((o=i==null?void 0:i.modelObject)!=null&&o.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const f=i.material;if(Array.isArray(f))console.warn("Dropping on material array not yet fully supported."),i.setMaterial(n);else{let m=Array.from((f==null?void 0:f.userData.__appliedMeshes)??[]);(m.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):m.length<1)&&(m=[i]);for(const y of m)y&&((c=y.setMaterial)==null||c.call(y,n))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let i=!1;n==null||n.traverseAncestors(o=>{o===e.scene.modelObject&&(i=!0)}),i||this.setSelectedObject(void 0)})}async focusObject(e){var n,i,o;const t=(n=this._viewer)==null?void 0:n.getPluginByType("CameraViews");await(t==null?void 0:t.animateToFitObject(e,1.25,1e3,"easeOut",{min:(((o=(i=this._viewer)==null?void 0:i.scene.activeCamera.getControls())==null?void 0:o.minDistance)??.5)+.5,max:50}))}enableWidget(e){var t,n,i;if(this._enableWidget=e,e){const o=((t=this._picker)==null?void 0:t.selectedObject)||void 0;o&&((n=this._widget)==null||n.attach(o))}else(i=this._widget)==null||i.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}us.PluginType="Picking",aA([ze()],us.prototype,"enabled",void 0),aA([ze()],us.prototype,"autoFocus",void 0);var Av,bv=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Ll=Av=class extends Ri{enableCustomBump(l,e,t){var i;const n=(i=l.materialObject)==null?void 0:i.userData;if(!n)return!1;if(n._hasCustomBump===void 0){const o=n.__appliedMeshes;let c=!0;if(o)for(const{geometry:f}of o)!f||f.attributes.position&&f.attributes.normal&&f.attributes.uv||(c=!1);if(!c)return!1}return n._hasCustomBump=!0,n._customBumpScale=t??n._customBumpScale??.001,n._customBumpMap=e??n._customBumpMap,l.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new Mb(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new s.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(l,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(l,e,t)=>{var i;if(!this.enabled||!e.materialObject.userData._hasCustomBump)return;((i=e.materialObject.userData)==null?void 0:i._customBumpMap)&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),l.vertexShader=ni(l.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),l.vertexShader=ni(l.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),l.defines.USE_UV="")},onObjectRender:(l,e)=>{var c;const t=e.materialObject.userData;if(!(t!=null&&t._hasCustomBump))return;const n=l;if(!n.isMesh||!n.geometry)return;const i=(c=t._customBumpMap)!=null&&c.isTexture?t._customBumpMap:null;this._uniforms.customBumpMap.value=i,this._uniforms.customBumpScale.value=i?t._customBumpScale:0,i&&(i.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(i.matrix));let o=this.enabled&&i?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=o,e.materialObject.needsUpdate=!0),o=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==o&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t,n;return(this.enabled?"1":"0")+((e=l.materialObject.userData)!=null&&e._hasCustomBump?"1":"0")+((n=(t=l.materialObject.userData)==null?void 0:t._customBumpMap)==null?void 0:n.uuid)},isCompatible:l=>l.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:l=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return l.materialObject.userData._hasCustomBump||!1},set value(i){var o;i!==l.materialObject.userData._hasCustomBump&&(i?t(l)||e.alert("One or more geometries cannot be made anisotropic."):(l.materialObject.userData._hasCustomBump=!1,l.materialObject.needsUpdate=!0),(o=n.uiRefresh)==null||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!l.materialObject.userData._hasCustomBump,property:[l.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!l.materialObject.userData._hasCustomBump,property:[l.materialObject.userData,"_customBumpMap"],onChange:()=>{l.materialObject.needsUpdate=!0,this.setDirty()}},$t(l.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this.enableCustomBumpSelected=()=>{var e,t,n;const l=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(us))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(l==null?void 0:l.assetType)==="material"&&this.enableCustomBump(l)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(lA)}async onRemove(l){var t,n,i,o,c,f,m,y,w,S,C,O;(n=(t=l.getPlugin(fi))==null?void 0:t.materials)==null||n.unregisterMaterialExtension(this.materialExtension),(o=(i=l.getPlugin(fi))==null?void 0:i.importer)==null||o.removeEventListener("loaderCreate",this._loaderCreate);const e=(y=(m=(f=(c=l.getPlugin(fi))==null?void 0:c.exporter)==null?void 0:f.getExporter("gltf","glb"))==null?void 0:m.extensions)==null?void 0:y.indexOf(lA);return e!==void 0&&e!==-1&&((O=(C=(S=(w=l.getPlugin(fi))==null?void 0:w.exporter)==null?void 0:S.getExporter("gltf","glb"))==null?void 0:C.extensions)==null||O.splice(e,1)),super.onRemove(l)}};Ll.PluginType="CustomBumpMapPlugin",Ll.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",bv([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],Ll.prototype,"enabled",void 0),bv([Yn("Bicubic",l=>({onChange:l.setDirty})),Ze("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,Av.prototype.setDirty),ze()],Ll.prototype,"bicubicFiltering",void 0),bv([ht("Enable CustomBumpMap",l=>({hidden:()=>{var e;return!((e=l._viewer)!=null&&e.getPlugin(us))}}))],Ll.prototype,"enableCustomBumpSelected",void 0),Ll=Av=bv([on("CustomBumpMap Materials")],Ll);class Mb{constructor(e){this.parser=e,this.name=Ll.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=c.customBumpScale??0;const f=c.customBumpMap;return f&&o.push(n.assignTexture(t.userData,"_customBumpMap",f).then(m=>{m.encoding=s.knz})),Promise.all(o)}}const lA=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const i={index:l.processTexture(e.userData._customBumpMap)};l.applyTextureTransform(i,e.userData._customBumpMap),n.customBumpMap=i}t.extensions[Ll.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,l.extensionsUsed[Ll.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var yp,La=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Ws=yp=class extends Ri{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(l){this._animationTime=Math.max(0,Math.min(l,this._animationDuration))}_wheel({deltaY:l}){this.enabled&&Math.abs(l)>.001&&(this._scrollAnimationState=-1*Math.sign(l))}_drag(l){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=l.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=l.delta.y*this._viewer.canvas.height/4)}_postFrame(){var o,c;if(!this._viewer)return;const l=this._viewer,e=this.animateOnScroll,t=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!e&&!t)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(yp.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const f=(0,a.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=f-1/30);let m=f-this._lastFrameTime;if(m*=this.animationSpeed,this._lastFrameTime=f,e&&t?m*=(0,a.absMax)(this._scrollAnimationState,this._dragAnimationState):e?m*=this._scrollAnimationState:t&&(m*=this._dragAnimationState),Math.abs(m)<1e-4)return;const y=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(y&&y>0&&(m=y),y===0)return;const w=Math.abs(this.timeScale);this._animationTime+=m*(w>0?w:1)}const n=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const i=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(f=>{f.mixer.setTime(i)}),!(Math.abs(n)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:n,time:i}),l.scene.activeCamera.cameraObject.userData.__animatingCamera&&l.scene.activeCamera.setDirty(),l.scene.refreshActiveCameraNearFar(),l.renderer.resetShadows(),l.setDirty(),!this._fadeDisabled){const f=this._viewer.getPluginByType("FrameFade");f&&(f.disable(yp.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[fi],this._pointerDragHelper=new a.PointerDragHelper,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=l=>{const e=l.object;if(e.assetType!=="model"||!e.modelObject||!this._viewer)return;let t=!1;e.modelObject.traverse(n=>{const i=n.animations;if(i.length<1)return;const o=Math.max(...i.map(m=>m.duration)),c=new s.Xcj(this._viewer.scene.modelRoot.modelObject),f=i.map(m=>c.clipAction(m).setLoop(this.loopAnimations?s.YKA:s.jAl,this.loopRepetitions));f.forEach(m=>m.clampWhenFinished=!0),this.animations.push({mixer:c,clips:i,actions:f,duration:o}),t=!0}),t&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new U0(e,this))}async onAdded(l){var t,n,i,o,c,f;(n=(t=l.getPlugin(fi))==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),l.scene.addEventListener("addSceneObject",this._objectAdded),(f=(c=(o=(i=l.getPlugin(fi))==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||f.push(xv),l.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=l.canvas;let e=-1;return Object.defineProperty(l.scene.modelRoot,"currentTimelineMarker",{get:()=>e,set:m=>l.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[e=m]})}),l.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:m})=>{var w;if(!this._viewer)return;if(!m)return this._viewer.scene.activeCamera=(w=this._viewer)==null?void 0:w.scene.defaultCamera,void this._viewer.setDirty();const y=m.camera;y&&(y.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(y))}),super.onAdded(l)}async onRemove(l){var e,t;for(;this.animations.length;)this.animations.pop();return l.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=l.getPlugin(fi))==null?void 0:e.importer)==null||t.addEventListener("loaderCreate",this._loaderCreate),l.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(l)}_onPropertyChange(l=!0){this._animationDuration=Math.max(...this.animations.map(({duration:e})=>e))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&l&&this.playAnimation()}onStateChange(){var l,e;(e=(l=this.uiConfig)==null?void 0:l.children)==null||e.map(t=>t&&(0,a.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(l,e=!1){return this.playClips([l],e)}async playClips(l,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(i=>{l.includes(i.getClip().name)&&t.push(i)})}),this.playAnimation(e,t)}async playAnimation(l=!1,e){var c;if(!this.enabled)return;let t=!1;this._animationState==="playing"&&(this.stopAnimation(!1),t=!0);let n=0;const i=!e;e||(e=[],this.animations.forEach(({mixer:f,actions:m,clips:y})=>{e.push(...m)})),t?this.resetAnimation():this.animationState!=="paused"&&(e.forEach(f=>{f.reset()}),this._animationTime=0);const o=ji();this._lastAnimId=o;for(const f of e)f.setLoop(this.loopAnimations?s.YKA:s.jAl,this.loopRepetitions),f.play(),n=Math.max(n,f.getClip().duration/Math.abs(f.timeScale));if(this._animationState="playing",(c=this._viewer)==null||c.setDirty(),i){if(!isFinite(this._animationDuration))return;await new Promise((f,m)=>{const y=()=>{this.removeEventListener("checkpointEnd",y),f()};this.addEventListener("checkpointEnd",y)})}else{const f=this.loopAnimations?this.loopRepetitions:1;if(n*=f,!isFinite(n))return;await new Promise((m,y)=>{const w=S=>{S.time>=n&&(this.removeEventListener("animationStep",w),m())};this.addEventListener("animationStep",w)})}o===this._lastAnimId&&this.stopAnimation(l)}pauseAnimation(){var l;this._animationState==="playing"?(this._animationState="paused",(l=this._viewer)==null||l.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var l;this._animationState==="paused"?(this._animationState="playing",(l=this._viewer)==null||l.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(l=!1){var e,t;this._animationState="stopped",l?this.resetAnimation():(e=this._viewer)==null||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))==null||t.enable(yp.PluginType),this._fadeDisabled=!1)}resetAnimation(){var l;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(l=this._viewer)==null||l.setDirty()):this.stopAnimation(!0)}};Ws.PluginType="GLTFAnimation",Ws.AnimationMarkersExtension="WEBGI_animation_markers",La([ze()],Ws.prototype,"autoIncrementTime",void 0),La([er()],Ws.prototype,"animationState",null),La([er()],Ws.prototype,"animationTime",null),La([er()],Ws.prototype,"animationDuration",null),La([(0,a.onChange2)(yp.prototype._onPropertyChange),Yn("Loop",{limitedUi:!0}),ze()],Ws.prototype,"loopAnimations",void 0),La([(0,a.onChange2)(yp.prototype._onPropertyChange),ze()],Ws.prototype,"loopRepetitions",void 0),La([Pe("Timescale",[-2,2],.01),ze()],Ws.prototype,"timeScale",void 0),La([Pe("Speed",[.1,4],.1,{limitedUi:!0}),ze()],Ws.prototype,"animationSpeed",void 0),La([Yn(),ze()],Ws.prototype,"animateOnScroll",void 0),La([Yn(),ze()],Ws.prototype,"animateOnDrag",void 0),La([ct("Drag Axis",[{label:"x"},{label:"y"}]),ze()],Ws.prototype,"dragAxis",void 0),La([Yn(),ze()],Ws.prototype,"autoplayOnLoad",void 0),La([(0,a.onChange)(yp.prototype.onStateChange)],Ws.prototype,"_animationState",void 0),La([ht("Play/Pause",l=>({label:()=>l.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Ws.prototype,"playPauseAnimation",null),La([ht("Stop",{limitedUi:!0})],Ws.prototype,"stopAnimation",null),La([ht("Reset",{limitedUi:!0})],Ws.prototype,"resetAnimation",null),Ws=yp=La([on("GLTF Animations")],Ws);class U0{constructor(e,t){this.parser=e,this.name=Ws.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){let t=[];for(const S of this.parser.json.scenes||[]){if(!S.extensions)continue;const C=S.extensions[this.name];for(const O of(C==null?void 0:C.markers)||[]){const N=O.camera!==void 0?await this.parser.getDependency("camera",O.camera):void 0;O.time===void 0&&(O.time=O.frame/30,console.error("Update timeline markers plugin for correct times.")),t.push({name:O.name,frame:O.frame,time:O.time,camera:N})}}if(t.length<1)return;t=t.sort((S,C)=>S.frame-C.frame);const n=e.scene??e.scenes[0];if(!n)return;n.userData.__markers=t;const i=this.plugin.timelineMarkers,o=t.map(S=>S.time);let c=i.length;const f=t.map(S=>c++),m=Math.max(...o)+.01;i.push(...t);const y=new s.dUE(".currentTimelineMarker",o,f,2300),w=new s.m7l("animationTimelineMarker",m,[y]);w.__gltfExport=!1,e.animations.push(w)}}const xv=l=>({afterParse(e){const t=l.json.scenes[l.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},i=[];if((Array.isArray(e)?e:[e]).forEach(o=>o.traverse(c=>{c.userData.__markers&&i.push(...c.userData.__markers)})),i.sort((o,c)=>o.frame-c.frame),!(i.length<1)){for(const o of i){const c=o.camera;if(c){const f=l.nodeMap.get(c);if(f===void 0){console.warn("Camera not found in gltf export",c,l.nodeMap);continue}const m=l.json.nodes[f].camera;o.camera=m,n.markers.push(o)}}t.extensions[Ws.AnimationMarkersExtension]=n,l.extensionsUsed[Ws.AnimationMarkersExtension]=!0}}});var Hg=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,wv=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,fm=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,Ev=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Tu=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Mc extends Ms{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}constructor(e,t,n,i=!1){super({vertexShader:eu,fragmentShader:`

${Ev}
${Hg}
${Ju}
${wv}
${n}

${fm}

varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!i},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new s.yGw},screenSize:{value:new s.FM8},cameraPositionWorld:{value:new s.Pa4},cameraNearFar:{value:new s.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:i?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(o,c,f)=>{var S;if(!o.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(S=this._target)==null?void 0:S.texture;const m=c.materialObject;let y=this.material.defines.SSGI_ENABLED;m.defines.SSGI_ENABLED!==y&&(m.defines.SSGI_ENABLED=y,m.needsUpdate=!0),y=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==y&&(this.materialExtension.extraUniforms.tSSGIMap.value=y,m.needsUpdate=!0);const w="vec3 totalDiffuse =";o.fragmentShader=o.fragmentShader.replace(w,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${w}`),o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",""),o.defines.USE_UV=""},onObjectRender:(o,c,f)=>{var S,C;const m=c.materialObject,y=!m.transparent&&m.transmission<.001,w=this.enabled&&y&&(this.renderWithCamera||this._renderer.frameCount>1)&&f.userData.screenSpaceRendering!==!1&&!((S=m.userData)!=null&&S.ssrtaoDisabled)&&!((C=m.userData)!=null&&C.ssaoDisabled)?1:0;m.defines.SSRTAO_ENABLED!==w&&(m.defines.SSRTAO_ENABLED=w,m.needsUpdate=!0)},parsFragmentSnippet:o=>{var c;return a.glsl`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${pe("tSSGIMap",(c=this._target)==null?void 0:c.texture,o.capabilities.isWebGL2)}

            ${sm}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:o=>{var c,f,m,y;return this.enabled?"1":"0"+((f=(c=this._target)==null?void 0:c.texture)==null?void 0:f.colorSpace)+((y=(m=this._target)==null?void 0:m.texture)==null?void 0:y.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:o=>{var c;return!((c=o.materialObject.userData)!=null&&c.ssaoDisabled)&&o.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Wt(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=i,this.ssgiEnabled=i,this.bilateralPass=new hv(this._target,n,"rgba")}render(e,t,n,i,o){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,i,o),this.smoothEnabled&&this.bilateralPass.render(e,t,n,i,o))}}Tu([ze()],Mc.prototype,"bilateralPass",void 0),Tu([Pe("Intensity",[0,4]),ze(),Ne()],Mc.prototype,"intensity",void 0),Tu([Pe("Power",[0,3]),ze(),Ne()],Mc.prototype,"power",void 0),Tu([Yn("Auto radius"),ze(),Ne()],Mc.prototype,"autoRadius",void 0),Tu([Pe("Object Radius",[.01,10]),ze(),Ne()],Mc.prototype,"objectRadius",void 0),Tu([Pe("Tolerance",[.1,5]),ze(),Ne()],Mc.prototype,"tolerance",void 0),Tu([Pe("Bias",[-.3,.3]),ze(),Ne()],Mc.prototype,"bias",void 0),Tu([Pe("Falloff",[1e-4,4]),ze(),Ne()],Mc.prototype,"falloff",void 0),Tu([Pe("Ray Count",[1,5],1),ze(),Ne()],Mc.prototype,"rayCount",void 0),Tu([Pe("Step count",[1,16],1),ze(),Ze("RTAO_STEP_COUNT")],Mc.prototype,"stepCount",void 0),Tu([Yn("Smooth Enabled"),ze()],Mc.prototype,"smoothEnabled",void 0),Tu([Yn("Render with Camera")],Mc.prototype,"renderWithCamera",void 0);class mm extends fp{get rtgiTarget(){return this._rtgiTarget}constructor(e=!0){super(),this.dependencies=[fi,vr,to],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssrtgi)!=null&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n;return this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1}),(t=this._viewer)==null||t.getPluginByType("debug"),[No(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Mc(e.renderer,this._rtgiTarget,((n=e.getPlugin(vr))==null?void 0:n.getUnpackSnippet())??"",!0),update:()=>{var o;const i=this.enabled;if(i){const c=(o=this._viewer)==null?void 0:o.getPluginByType("SSAO");c!=null&&c.enabled&&(c.enabled=!1)}i&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(vr)])}},()=>[e.getPlugin(vr),e.getPlugin(to),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,i,o;const e=((n=(t=this.passes.ssrtgi)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(c=>(0,a.getOrCall)(c)))==null||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}}mm.PluginType="SSGI";let Tc=class extends Ks{constructor(l,e,t){super(l,e,t??new cA,new pt(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(l,e,t,n,i){this.enabled&&super.render(l,e,t,n,i)}};Tc=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("High precision Normal Buffer")],Tc);class cA extends s.RSm{constructor(){super()}onBeforeRender(e,t,n,i,o){let c=o.material;Array.isArray(c)&&(c=c[0]),this.normalMap=(c==null?void 0:c.normalMap)??null,this.bumpMap=(c==null?void 0:c.bumpMap)??null,this.bumpScale=c==null?void 0:c.bumpScale,c!=null&&c.normalScale&&this.normalScale.copy(c==null?void 0:c.normalScale),this.needsUpdate=!0,this.side=c.side??s.ehD}}class Uh extends br{passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:s.cLu,minFilter:s.TyD,magFilter:s.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,i=new Set;return new class extends Tc{render(o,c,f,m,y){const w=o.getRenderTarget(),S=o.getActiveCubeFace(),C=o.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:O})=>{O&&((O.transparent&&O.userData.renderToDepth||!O.transparent&&O.transmission===0&&O.userData.renderToDepth===!1)&&(n.add(O),O.transparent=!O.transparent),Math.abs(O.transmission||0)>0&&O.userData.renderToDepth&&(i.add([O,O.transmission]),O.transmission=0))}),_t(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,c,t,m,y)),n.forEach(O=>O.transparent=!O.transparent),n.clear(),i.forEach(([O,N])=>O.transmission=N),i.clear(),o.setRenderTarget(w,S,C))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)==null?void 0:t.dispose)==null?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled?((t=this.getNormalBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Uh.PluginType="NormalBufferPlugin";var Sv=function(l,e){return Sv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},Sv(l,e)};function F0(l,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=l}Sv(l,e),l.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Mv,Wg=function(){function l(){}return l._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},l}(),uA=function(l){function e(t){var n=l.call(this)||this;return n.a=e._xfnv1a(t)(),n}return F0(e,l),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(Wg),Tv=function(l){function e(t){var n=l.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return F0(e,l),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(Wg),hA=function(l){function e(t){var n=l.call(this)||this,i=e._xfnv1a(t);return n.a=i(),n.b=i(),n.c=i(),n.d=i(),n}return F0(e,l),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(Wg);(function(l){l.sfc32="sfc32",l.mulberry32="mulberry32",l.xoshiro128ss="xoshiro128ss"})(Mv||(Mv={}));var Qg=function(){function l(e,t){t===void 0&&(t=Mv.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return l.prototype.next=function(){return this.generator.next()},l.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new Tv(this.str);case"mulberry32":return new uA(this.str);case"xoshiro128ss":return new hA(this.str);default:return this.wrap()}},l.prototype.wrap=function(){return{next:function(){return Math.random()}}},l}(),qg=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class gm extends Gc{constructor(e,t,n,i){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new s.Pa4(10,10,10),normalDirection:new s.Pa4(.01,.98,.01).normalize(),direction:new s.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=i??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const i=new Qg(e.toString()),o=new s.FM8(i.next()*Math.PI*2,Math.asin(2*i.next()-1));let c=new s.Pa4(Math.cos(o.x)*Math.cos(o.y),Math.sin(o.y),Math.sin(o.x)*Math.cos(o.y));const f=new s.FM8;for(let m=0;m<5;m++){f.set(i.next(),i.next()),c=Ap(f,this._randomParams.normalDirection,.4),i.next()<Math.sqrt(t??this._randomParams.focus)&&(f.set(i.next(),i.next()),c=Ap(f,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const y=c.dot(this._randomParams.normalDirection);if(y>0&&y<.4)break}c.normalize(),c.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(c.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new s.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function Ap(l,e,t){e=e.clone().normalize();const n=new s.Pa4(0,-e.z,e.y).normalize(),i=new s.Pa4().crossVectors(e,n).normalize(),o=l;o.x=2*o.x*Math.PI,o.y=1-o.y*t;const c=Math.sqrt(1-o.y*o.y);return n.multiplyScalar(Math.cos(o.x)*c).add(i.multiplyScalar(Math.sin(o.x)*c)).add(e.multiplyScalar(o.y))}qg([ze("shadowParams")],gm.prototype,"_shadowParams",void 0),qg([ze("randomParams")],gm.prototype,"_randomParams",void 0);var Ya=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Nl extends Ri{get cameraHelper(){return this._cameraHelper}constructor(e=!0){super(),this.enabled=!0,this.light=new gm("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var n,i;if(!this.enabled)return void(this.light.layers.mask=0);const t=((n=this._viewer)==null?void 0:n.renderer.frameCount)??0;this.light.randomizePosition(t<5?0:t),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(i=this._cameraHelper)==null||i.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}async onAdded(e){await super.onAdded(e),this._cameraHelper=new s.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)==null||t.scene.setDirty():(n=this._viewer)==null||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}Nl.PluginType="RandomizedDirectionalLight",Ya([ze()],Nl.prototype,"enabled",void 0),Ya([ze("rdLight")],Nl.prototype,"light",void 0),Ya([ze()],Nl.prototype,"lightLayers",void 0);var Cv=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,kl=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let hl=class extends Ms{constructor(l,e,t,n=!0){super({vertexShader:eu,fragmentShader:`

varying vec2 vUv;

${Ev}
${Hg}
${Ju}
${wv}
${t}

${fm}

${Cv}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new s.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new s.yGw},cameraPositionWorld:{value:new s.Pa4},cameraNearFar:{value:new s.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,o,c)=>{var y,w,S;let f=this.enabled&&c.userData.screenSpaceRendering!==!1&&!((y=o.materialObject.userData)!=null&&y.ssreflDisabled)?1:0;if(o.materialObject.defines.SSR_ENABLED!==f&&(o.materialObject.defines.SSR_ENABLED=f,o.materialObject.needsUpdate=!0),!i.defines.SSR_ENABLED)return;f=this.material.defines.SSR_STEP_COUNT,o.materialObject.defines.SSR_STEP_COUNT!==f&&(o.materialObject.defines.SSR_STEP_COUNT=f,o.materialObject.needsUpdate=!0),f=this.material.defines.SSR_LOW_QUALITY_FRAMES,o.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==f&&(o.materialObject.defines.SSR_LOW_QUALITY_FRAMES=f,o.materialObject.needsUpdate=!0),f=this.material.defines.PERSPECTIVE_CAMERA,o.materialObject.defines.PERSPECTIVE_CAMERA!==f&&(o.materialObject.defines.PERSPECTIVE_CAMERA=f,o.materialObject.needsUpdate=!0),f=this.material.defines.SSR_INLINE,o.materialObject.defines.SSR_INLINE!==f&&(o.materialObject.defines.SSR_INLINE=f,o.materialObject.needsUpdate=!0),f=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,o.materialObject.defines.SSR_MASK_FRONT_RAYS!==f&&(o.materialObject.defines.SSR_MASK_FRONT_RAYS=f,o.materialObject.needsUpdate=!0),f=(w=o.materialObject.userData)!=null&&w.ssreflNonPhysical?"1":"0",o.materialObject.defines.SSR_NON_PHYSICAL!==f&&(o.materialObject.defines.SSR_NON_PHYSICAL=f,o.materialObject.needsUpdate=!0),f=((S=this._target)==null?void 0:S.texture)??null,this.materialExtension.extraUniforms.tSSRMap.value!==f&&(this.materialExtension.extraUniforms.tSSRMap.value=f,o.materialObject.needsUpdate=!0);const m="#glMarker beforeModulation";i.fragmentShader=i.fragmentShader.replace(m,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${m}`)},onObjectRender:(i,o,c)=>{var m;const f=this.enabled&&c.userData.screenSpaceRendering!==!1&&!((m=o.materialObject.userData)!=null&&m.ssreflDisabled)?1:0;o.materialObject.defines.SSR_ENABLED!==f&&(o.materialObject.defines.SSR_ENABLED=f,o.materialObject.needsUpdate=!0)},parsFragmentSnippet:(i,o)=>{var c,f;return!this.enabled||i.userData.screenSpaceRendering===!1||(c=o==null?void 0:o.materialObject.userData)!=null&&c.ssreflDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+pe("tSSRMap",(f=this._target)==null?void 0:f.texture,i.capabilities.isWebGL2)+pe("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,i.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Ev}
    
    #define THREE_PACKING_INCLUDED
    ${Hg}
    
    ${Ju}
    ${wv}
    ${As}
    
    ${fm}
    
    ${Cv}
// #endif // SSR_INLINE
#endif
`:"")+`
${sm}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:i=>{var o,c,f;return this.enabled?"1":"0"+((c=(o=this._target)==null?void 0:o.texture)==null?void 0:c.colorSpace)+(this.enabled&&!((f=i.materialObject.userData)!=null&&f.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(m=>m+"").join(",")},isCompatible:i=>{var o;return!((o=i.materialObject.userData)!=null&&o.ssreflDisabled)&&i.isMeshStandardMaterial2}},this.intensity=1,this.boost=new s.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=l,this._target=e,this.needsSwap=!1,this._inline=n}render(l,e,t,n,i){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(l,this._target,t,n,i),this.needsSwap=!1}}};kl([Pe("Intensity",[0,4]),ze(),Ne()],hl.prototype,"intensity",void 0),kl([Le("Boost"),ze(),Ne()],hl.prototype,"boost",void 0),kl([Pe("Object Radius",[.01,2]),ze(),Ne()],hl.prototype,"objectRadius",void 0),kl([Yn("Auto radius"),ze(),Ne()],hl.prototype,"autoRadius",void 0),kl([Pe("Power",[0,3]),ze(),Ne()],hl.prototype,"power",void 0),kl([Pe("Tolerance",[.1,5]),ze(),Ne()],hl.prototype,"tolerance",void 0),kl([Pe("Step count",[1,32],1),ze(),Ze("SSR_STEP_COUNT")],hl.prototype,"stepCount",void 0),kl([Pe("Low Quality Frames",[0,4],1),ze(),Ze("SSR_LOW_QUALITY_FRAMES")],hl.prototype,"lowQualityFrames",void 0),kl([Yn("Ignore front rays"),ze(),Ze("SSR_MASK_FRONT_RAYS")],hl.prototype,"maskFrontRays",void 0),kl([Pe("Mask front rays factor",[-1,1],.01,l=>({hidden:()=>!l.maskFrontRays})),ze(),Ne()],hl.prototype,"maskFrontFactor",void 0),hl=kl([on("Screen Space Reflections")],hl);class Ka extends fp{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[fi,vr,to],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var e,t;return((t=(e=this.passes.ssr)==null?void 0:e.passObject)==null?void 0:t.enabled)||!1}set enabled(e){var t;(t=this.passes.ssr)!=null&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}createPasses(e){var t;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[No(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new hl(e.renderer,this._ssrTarget,((t=e.getPlugin(vr))==null?void 0:t.getUnpackSnippet())??"",this.inlineSSR)},()=>[e.getPlugin(vr),e.getPlugin(to),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var t,n,i,o;const e=((n=(t=this.passes.ssr)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(c=>(0,a.getOrCall)(c)))==null||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}}Ka.PluginType="SSReflection";var bp=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Na=class extends Ri{makeAnisotropic(l){var t;const e=(t=l.materialObject)==null?void 0:t.userData;if(!e)return!1;if(e._isAnisotropic===void 0){const n=e.__appliedMeshes;let i=!0;if(n)for(const{geometry:o}of n)!o||o.index&&o.attributes.position&&o.attributes.normal&&o.attributes.uv||(i=!1),i&&!o.attributes.tangent&&o.computeTangents();if(!i)return!1}return e._isAnisotropic=!0,e._anisotropyFactor===void 0&&(e._anisotropyFactor=1),e._anisotropyNoise===void 0&&(e._anisotropyNoise=0),e._anisotropyDirectionMode===void 0&&(e._anisotropyDirectionMode="DIRECTION"),l.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new _m(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(l,e,t)=>{var f;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const n=(f=e.materialObject.userData)==null?void 0:f._anisotropyDirectionMap,i=a.glsl`
                //#if ANISOTROPY_ENABLED
                ${Ju}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(n?pe("anisotropyDirectionMap",n,t.capabilities.isWebGL2):"")+`
`;l.fragmentShader=ni(l.fragmentShader,"#include <common>",i,{append:!0}),l.fragmentShader=l.fragmentShader.replace("#include <lights_fragment_begin>",s.WdD.lights_fragment_begin),l.fragmentShader=ni(ni(l.fragmentShader,"IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,{prepend:!0}),"RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let o=ni(s.WdD.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");o=ni(o,"BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),l.fragmentShader=ni(l.fragmentShader,"#include <lights_physical_pars_fragment>",o),l.fragmentShader=ni(l.fragmentShader,"#include <normal_fragment_begin>",s.WdD.normal_fragment_begin),l.fragmentShader=ni(l.fragmentShader,"#ifdef USE_NORMALMAP_TANGENTSPACE","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_TANGENT )");let c=a.glsl`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+s.WdD.lights_fragment_maps;c=ni(c,"getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )"),c=ni(c,"getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )"),l.fragmentShader=ni(l.fragmentShader,"#include <lights_fragment_maps>",c),l.defines.USE_UV="",l.vertexTangents=!0},onObjectRender:(l,e)=>{var o;const t=e.materialObject.userData;if(!(t!=null&&t._isAnisotropic))return;const n=l;if(!n.isMesh||!n.geometry)return;if(!n.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=t._anisotropyFactor,this._uniforms.anisotropyNoise.value=t._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=(o=t._anisotropyDirectionMap)!=null&&o.isTexture?t._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=t._anisotropyDirection;let i=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==i&&(e.materialObject.defines.ANISOTROPY_ENABLED=i,e.materialObject.needsUpdate=!0),i=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==i&&(e.materialObject.defines.ANISOTROPY_DEBUG=i,e.materialObject.needsUpdate=!0),i=t._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(i="CONSTANT"),i=i==="DIRECTION"?2:i==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==i&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=i,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t,n;return(this.enabled?"1":"0")+((e=l.materialObject.userData)!=null&&e._isAnisotropic?"1":"0")+((n=(t=l.materialObject.userData)==null?void 0:t._anisotropyDirectionMap)==null?void 0:n.uuid)},isCompatible:l=>l.isMeshStandardMaterial2,updaters:()=>{var l;return[(l=this._viewer)==null?void 0:l.renderer]},getUiConfig:l=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return l.materialObject.userData._isAnisotropic||!1},set value(i){var o;i!==l.materialObject.userData._isAnisotropic&&(i?t(l)||e.alert("One or more geometries cannot be made anisotropic."):(l.materialObject.userData._isAnisotropic=!1,l.materialObject.needsUpdate=!0),(o=n.uiRefresh)==null||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!l.materialObject.userData._isAnisotropic,property:[l.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!l.materialObject.userData._isAnisotropic,property:[l.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!l.materialObject.userData._isAnisotropic,property:[l.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{l.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!l.materialObject.userData._isAnisotropic,property:[l.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(i=>({label:i})),onChange:()=>{l.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this.makeSelectedAnisotropic=()=>{var e,t,n;const l=(n=(t=(e=this._viewer)==null?void 0:e.getPlugin(us))==null?void 0:t.getSelectedObject())==null?void 0:n.material;return(l==null?void 0:l.assetType)==="material"&&this.makeAnisotropic(l)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(dA)}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};Na.PluginType="AnisotropyPlugin",Na.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",bp([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],Na.prototype,"enabled",void 0),bp([ht("Make Anisotropy",l=>({hidden:()=>{var e;return!((e=l._viewer)!=null&&e.getPlugin(us))}}))],Na.prototype,"makeSelectedAnisotropic",void 0),Na=bp([on("Anisotropy Materials")],Na);class _m{constructor(e){this.parser=e,this.name=Na.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],c=i.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=c.anisotropyFactor??0,t.userData._anisotropyNoise=c.anisotropyNoiseFactor??c.anisotropyNoise??0;let{anisotropyDirectionMode:f,anisotropyDirection:m}=c;return f||(f=c.anisotropyTextureMode),m||(m=c.anisotropyRotation),t.userData._anisotropyDirectionMode=f&&typeof(m==null?void 0:m.index)=="number"?f:"CONSTANT",f==="ROTATION"||f==="DIRECTION"?o.push(n.assignTexture(t.userData,"_anisotropyDirectionMap",m).then(y=>{y.colorSpace=s.KI_})):t.userData._anisotropyDirection=m??0,Promise.all(o)}afterRoot(e){var t;return(t=e.scene)==null||t.traverse(n=>{var c,f;if(!((f=(c=n.material)==null?void 0:c.userData)==null?void 0:f._isAnisotropic))return;const o=n.geometry;o.attributes.tangent||(o.computeTangents(),o.attributes.tangent.needsUpdate=!0)}),null}}const dA=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const i={index:l.processTexture(e.userData._anisotropyDirectionMap)};l.applyTextureTransform(i,e.userData._anisotropyDirectionMap),n.anisotropyDirection=i}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[Na.ANISOTROPY_GLTF_EXTENSION]=n,l.extensionsUsed[Na.ANISOTROPY_GLTF_EXTENSION]=!0}});var vm,ym=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let dl=vm=class extends Ri{static AddFragmentClipping(l,e,t,n,i){var f;const o=(f=l.materialObject)==null?void 0:f.userData;if(!o)return!1;o._fragmentClippingExt||(o._fragmentClippingExt={});const c=o._fragmentClippingExt;return c.clipEnabled=!0,c.clipPosition===void 0&&(c.clipPosition=(e==null?void 0:e.toArray())??[0,0,0,0]),c.clipParams===void 0&&(c.clipParams=(t==null?void 0:t.toArray())??[1,0,0,0]),c.clipMode===void 0&&(c.clipMode=n??pl.Circle),c.clipInvert===void 0&&(c.clipInvert=i??!1),l.materialObject.isMaterial&&(l.needsUpdate=!0),!0}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new z0(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi,vr],this._plane=new s.JOQ,this._viewNormalMatrix=new s.Vkp,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new s.Ltg},fragClippingParams:{value:new s.Ltg},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(l,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._fragmentClippingExt)!=null&&t.clipEnabled)?sm+a.glsl`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${pl.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${pl.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${pl.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${pl.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${pl.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(l,e,t)=>{var n;this.enabled&&((n=e.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker mainStart",a.glsl`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${pl.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${pl.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${pl.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${pl.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${pl.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <encodings_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(l,e)=>{var i,o,c,f,m,y;let t=(i=e.materialObject.userData)==null?void 0:i._fragmentClippingExt;if(e.materialObject.userData.isGBufferMaterial&&l&&(t=(c=(o=l.material)==null?void 0:o.userData)==null?void 0:c._fragmentClippingExt),!(t!=null&&t.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(t.clipPosition),t.clipMode===pl.Plane){const w=(f=this._viewer)==null?void 0:f.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(t.clipParams[0],t.clipParams[1],t.clipParams[2]),this._plane.constant=t.clipParams[3],this._viewNormalMatrix.getNormalMatrix(w),this._plane.applyMatrix4(w,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(t.clipParams);((m=this._viewer)==null?void 0:m.scene.activeCamera.cameraObject)instanceof s.cPb?this._uniforms.fragClippingCamAspect.value=(y=this._viewer)==null?void 0:y.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let n=this.enabled?1:0;n=+this._defines.FRAG_CLIPPING_DEBUG,e.materialObject.defines.FRAG_CLIPPING_DEBUG!==n&&(e.materialObject.defines.FRAG_CLIPPING_DEBUG=n,e.materialObject.needsUpdate=!0),n=+t.clipMode,e.materialObject.defines.FRAG_CLIPPING_MODE!==n&&(e.materialObject.defines.FRAG_CLIPPING_MODE=n,e.materialObject.needsUpdate=!0),n=+t.clipInvert,e.materialObject.defines.FRAG_CLIPPING_INVERSE!==n&&(e.materialObject.defines.FRAG_CLIPPING_INVERSE=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t;return(this.enabled?"1":"0")+((t=(e=l.materialObject.userData)==null?void 0:e._fragmentClippingExt)!=null&&t.clipEnabled?"1":"0")},isCompatible:l=>l.isMeshStandardMaterial2||l.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:l=>{const e=this._viewer,t={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var n;return((n=l.materialObject.userData._fragmentClippingExt)==null?void 0:n.clipEnabled)||!1},setValue:n=>{var i,o;n!==((i=l.materialObject.userData._fragmentClippingExt)==null?void 0:i.clipEnabled)&&(n?vm.AddFragmentClipping(l.materialObject)||e.alert("Cannot add fragment clipping extension."):l.materialObject.userData._fragmentClippingExt&&(l.materialObject.userData._fragmentClippingExt.clipEnabled=!1,l.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(pl).map(n=>({label:n[0],value:n[1]})),hidden:()=>{var n;return!((n=l.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[l.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",bounds:[-1,1],hidden:()=>{var n;return!((n=l.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[l.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",bounds:[0,1],hidden:()=>{var n;return!((n=l.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[l.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var n;return!((n=l.materialObject.userData._fragmentClippingExt)!=null&&n.clipEnabled)},property:[l.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c,f,m;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(j0),(m=(f=l.getPlugin(vr))==null?void 0:f.material)==null||m.registerMaterialExtensions([this.materialExtension])}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};var pl;dl.PluginType="FragmentClippingExtensionPlugin1",dl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",ym([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],dl.prototype,"enabled",void 0),dl=vm=ym([on("FragmentClipping Materials")],dl),function(l){l[l.Circle=0]="Circle",l[l.Ellipse=1]="Ellipse",l[l.Rectangle=2]="Rectangle",l[l.Plane=3]="Plane",l[l.Sphere=4]="Sphere"}(pl||(pl={}));class z0{constructor(e){this.parser=e,this.name=dl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),dl.AddFragmentClipping(t),t.userData._fragmentClippingExt=Mi(i,t.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const j0=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._fragmentClippingExt||!e.userData._fragmentClippingExt.clipEnabled)return;t.extensions=t.extensions||{};const n=di(e.userData._fragmentClippingExt,!1);t.extensions[dl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=n,l.extensionsUsed[dl.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var mf,xp=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let fl=mf=class extends Ri{constructor(l=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new s.Pa4(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=l,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var n,i,o;if(!this._viewer)return;const l=this._viewer.scene.background;if(this.enabled&&l!==this._viewer.scene.environment&&l!=="environment")if(l&&l.isDataTexture)l.mapping=s.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const c=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");c?(c.envmapBg=!0,(i=(n=c.uiConfig).uiRefresh)==null||i.call(n,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const e=(o=this._viewer.renderer.rendererObject.background.getBoxMesh2())==null?void 0:o.material,t=(e==null?void 0:e.uniforms)??s.Vj0.backgroundCube.uniforms;t.tripodHeight||(t.tripodHeight={value:1}),t.worldRadius||(t.worldRadius={value:1}),t.originPosition||(t.originPosition={value:new s.Pa4}),t.tripodHeight.value=this.tripodHeight,t.worldRadius.value=this.worldRadius,t.originPosition.value.copy(this.originPosition),e&&(!this.enabled&&e.defines.HDRi_GROUND_PROJ?delete e.defines.HDRi_GROUND_PROJ:this.enabled&&(e.defines.HDRi_GROUND_PROJ="1"),e.needsUpdate=!0),this._viewer.setDirty()}async onAdded(l){var e,t,n;await super.onAdded(l),(n=(t=(e=this._viewer)==null?void 0:e.renderer)==null?void 0:t.rendererObject)!=null&&n.background.getBoxMesh()&&l.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),s.Vj0.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(s.Vj0.backgroundCube.fragmentShader=ni(s.Vj0.backgroundCube.fragmentShader,"void main() {",`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,{prepend:!0}),s.Vj0.backgroundCube.fragmentShader=ni(s.Vj0.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),l.scene.addEventListener("environmentChanged",this._paramsChanged)}};fl.PluginType="HDRiGroundPlugin",xp([ze(),(0,a.onChange)(mf.prototype._paramsChanged),Yn("Enabled")],fl.prototype,"enabled",void 0),xp([ze(),(0,a.onChange)(mf.prototype._paramsChanged),Pe("World Radius",[1,1e3],.01)],fl.prototype,"worldRadius",void 0),xp([ze(),(0,a.onChange)(mf.prototype._paramsChanged),Pe("Tripod height",[0,50],.01)],fl.prototype,"tripodHeight",void 0),xp([ze(),(0,a.onChange)(mf.prototype._paramsChanged),Le("Origin Position",void 0,.001,l=>({onChange:l._paramsChanged}))],fl.prototype,"originPosition",void 0),fl=mf=xp([on("HDRi Ground")],fl);var gf,wp=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let ml=gf=class extends Ri{constructor(l=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[vr,fi],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const i=a.glsl`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Ev}
    
    #define THREE_PACKING_INCLUDED
    ${Hg}
    
    ${As}
    ${Ju}
    
    ${fm}

#endif
            
            `+s.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${i}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",s.WdD.lights_fragment_begin),e.fragmentShader=ni(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),e.fragmentShader=ni(e.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var c;const i=t.materialObject;let o=this.enabled&&n.userData.screenSpaceRendering!==!1&&!((c=i.userData)!=null&&c.sscsDisabled)?1:0;i.defines.SSCS_ENABLED!==o&&(i.defines.SSCS_ENABLED=o,i.needsUpdate=!0),o=this._defines.SSCS_STEP_COUNT,i.defines.SSCS_STEP_COUNT!==o&&(i.defines.SSCS_STEP_COUNT=o,i.needsUpdate=!0),o=+this._defines.SSCS_DEBUG,i.defines.SSCS_DEBUG!==o&&(i.defines.SSCS_DEBUG=o,i.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...gf._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,i,o;return[(e=this._viewer)==null?void 0:e.getPlugin(vr),(t=this._viewer)==null?void 0:t.getPlugin(to),(n=this._viewer)==null?void 0:n.scene.activeCamera,(i=this._viewer)==null?void 0:i.renderer,(o=this._viewer)==null?void 0:o.scene]}},this.enabled=l,this.userData={setDirty:()=>{var e;(e=this._viewer)==null||e.setDirty()}}}async onAdded(l){var e,t;await super.onAdded(l),(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension)}async onRemove(l){var e,t;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(l)}};ml.PluginType="SSContactShadows",ml._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new s.yGw},cameraPositionWorld:{value:new s.Pa4},cameraNearFar:{value:new s.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},wp([Yn("Enabled"),ze()],ml.prototype,"enabled",void 0),wp([Ne({uniforms:gf._uniforms,propKey:"sscsRadius"}),Pe("Radius",[1e-4,.1],1e-4),ze()],ml.prototype,"radius",void 0),wp([Ne({uniforms:gf._uniforms,propKey:"sscsIntensity"}),Pe("Intensity",[1e-4,1],1e-4),ze()],ml.prototype,"intensity",void 0),wp([Ne({uniforms:gf._uniforms,propKey:"sscsTolerance"}),Pe("Tolerance",[.1,5]),ze()],ml.prototype,"tolerance",void 0),wp([Ze("SSCS_DEBUG",void 0,!0),Yn("Debug only SSCS"),ze()],ml.prototype,"onlySSCSDebug",void 0),wp([Ze("SSCS_STEP_COUNT",void 0,!0),Pe("Step count",[1,8],1),ze()],ml.prototype,"stepCount",void 0),ml=gf=wp([on("Screen Space Contact Shadows")],ml);class _f{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new s.xsS,this._mesh=new s.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new Fh}dispose(){var e;(e=this._mesh.geometry)==null||e.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(e){e.split(";").forEach(t=>{var n;return(n=this._normalsCache[t])==null?void 0:n.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(e=>e.dispose())}hasCapturedNormalMap(e){return!!e.userData._normalsCaptureMap}captureNormalMap(e,t,n=512){if(!e)throw"No geometry";if(this.hasCapturedNormalMap(e))return!1;const i=t==null?void 0:t.split(";").find(f=>this._normalsCache[f]);if(i){const f=this._normalsCache[i];return t==null||t.split(";").forEach(m=>m!==i&&(this._normalsCache[m]=f)),f.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=f,!1}const o=this._renderer.createTargetCustom({width:n,height:n},{minFilter:s.TyD,magFilter:s.TyD,generateMipmaps:!1,type:s.cLu},s.oAp);if(o.attachedGeometries=[],o.autoDispose=_f.AutoDisposeTargets,!o)throw"Unable to create render target";const c=()=>{const f=new s._am(1e-4,100,o);this._scene.add(f);const m=e.userData.normalsCaptureOffsets;m.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(m.center),m.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(m.offsetMatrixInv),m.radius!==void 0&&(this._mesh.material.uniforms.radius.value=m.radius),this._mesh.geometry=e,f.update(this._renderer.rendererObject,this._scene),this._scene.remove(f),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=o};return c(),this._renderer.addEventListener("contextRestored",c),o.attachedGeometries.push(e),e.addEventListener("dispose",()=>{var f;o.attachedGeometries=((f=o.attachedGeometries)==null?void 0:f.filter(m=>m!==e))??[],delete e.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",c),o.autoDispose&&!o.attachedGeometries.length&&o.dispose()}),t==null||t.split(";").forEach(f=>this._normalsCache[f]=o),o.addEventListener("dispose",()=>{t==null||t.split(";").forEach(f=>delete this._normalsCache[f]),this._renderer.removeEventListener("contextRestored",c),delete e.userData._normalsCaptureMap}),!0}}_f.AutoDisposeTargets=!0;class Fh extends s.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:s.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new s.yGw().identity()},offsetCenter:{value:new s.Pa4}}})}}var Xg=__webpackgi_require__(654);function Yg(l){const e=new s.Pa4(0,0,0),t=new s.Pa4(0,0,0),n=new s.Pa4(0,0,0),i=new s.Pa4(0,0,0),o=l.getAttribute("position"),c=l.index;if(c)for(let C=Math.max(0,l.drawRange.start),O=Math.min(c.count,l.drawRange.start+l.drawRange.count)-1;C<O/3;C+=3){const N=c.getX(C),H=c.getX(C+1),q=c.getX(C+2);t.set(o.getX(N),o.getY(N),o.getZ(N)),n.set(o.getX(H),o.getY(H),o.getZ(H)),i.set(o.getX(q),o.getY(q),o.getZ(q)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i)}else for(let C=0;C<o.count;C+=3)t.set(o.getX(C),o.getY(C),o.getZ(C)),n.set(o.getX(C+1),o.getY(C+1),o.getZ(C+1)),i.set(o.getX(C+2),o.getY(C+2),o.getZ(C+2)),n.sub(t),i.sub(t),i.cross(n),i.normalize(),e.add(i);e.normalize();let f=!1,m=0;for(;!f;){const C=m/3,O=c?c.getX(C):C,N=c?c.getX(C+1):C+1;t.set(o.getX(O),o.getY(O),o.getZ(O)),n.set(o.getX(N),o.getY(N),o.getZ(N)),t.sub(n),t.normalize();const H=e.dot(t);Math.abs(H-1)>.001&&t.length()>.5&&(f=!0),m+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const y=new s.yGw;y.elements[0]=t.x,y.elements[1]=t.y,y.elements[2]=t.z,y.elements[3]=0,y.elements[4]=e.x,y.elements[5]=e.y,y.elements[6]=e.z,y.elements[7]=0,y.elements[8]=n.x,y.elements[9]=n.y,y.elements[10]=n.z,y.elements[11]=0,y.elements[12]=0,y.elements[13]=0,y.elements[14]=0,y.elements[15]=1,l.computeBoundingSphere();const w=l.boundingSphere.radius,S=new s.yGw().makeScale(w,w,w);return y.multiply(S),y}function vf(l,e,t){const n=new s.Pa4().copy(l),i=new s.Pa4().copy(e),o=new s.Pa4().copy(t);return n.dot(i.cross(o))/6}function pA(l,e,t){const n=new s.Pa4().copy(l),i=new s.Pa4().copy(e),o=new s.Pa4().copy(t);return i.sub(n),o.sub(n),o.cross(i),.5*o.length()}function zh(l){const e=l.getAttribute("position"),t=l.getAttribute("normal");if(e.count/3>500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",e.count/3),Yg(l);const n=new s.Pa4(0,0,0),i=new s.Pa4(0,0,0),o=new s.Pa4(0,0,0),c=l.index,f=[];if(c)for(let J=Math.max(0,l.drawRange.start),V=Math.min(c.count,l.drawRange.start+l.drawRange.count)-1;J<V;J+=3){const z=c.getX(J),ue=c.getX(J+1),me=c.getX(J+2);n.set(e.getX(z),e.getY(z),e.getZ(z)),i.set(e.getX(ue),e.getY(ue),e.getZ(ue)),o.set(e.getX(me),e.getY(me),e.getZ(me)),f.push(n.toArray(),i.toArray(),o.toArray())}else for(let J=0;J<e.count;J++)n.set(e.getX(J),e.getY(J),e.getZ(J)),f.push(n.toArray());const m=function(J,V){const z=new s.Pa4;for(let at=0;at<J.length;at+=3)z.x+=J[at],z.y+=J[at+1],z.z+=J[at+2];z.multiplyScalar(1/(J.length/3));const ue=new s.Pa4,me=new s.Pa4,Te=new s.Pa4,Be=new s.Pa4,He=new s.Pa4;let tt=0,lt=0;for(let at=0;at<V.length;at+=3){ue.set(V[at][0],V[at][1],V[at][2]),me.set(V[at+1][0],V[at+1][1],V[at+1][2]),Te.set(V[at+2][0],V[at+2][1],V[at+2][2]),He.copy(ue).add(me).add(Te);const St=pA(ue,me,Te);He.multiplyScalar(St/3),Be.add(He),tt+=St,lt+=vf(ue,me,Te)}return Be.multiplyScalar(1/tt),{centre:z,com:Be,volume:lt,area:tt}}(e.array,f);if(m.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let J=0;J<t.count;J++)t.setX(J,-t.getX(J)),t.setY(J,-t.getY(J)),t.setZ(J,-t.getZ(J));t.needsUpdate=!0}const y=[];for(let J=0;J<e.array.length;J+=3)y.push([e.array[J],e.array[J+1],e.array[J+2]]);const w=console.log;console.log=()=>{};const S=(0,Xg.getEigenVectors)(y);console.log=w;const C=new s.yGw;C.elements[0]=S[0].vector[0],C.elements[1]=S[0].vector[1],C.elements[2]=S[0].vector[2],C.elements[3]=0,C.elements[4]=S[1].vector[0],C.elements[5]=S[1].vector[1],C.elements[6]=S[1].vector[2],C.elements[7]=0,C.elements[8]=S[2].vector[0],C.elements[9]=S[2].vector[1],C.elements[10]=S[2].vector[2],C.elements[11]=0,C.elements[12]=0,C.elements[13]=0,C.elements[14]=0,C.elements[15]=1;const O=new s.Pa4;O.copy(m.com).sub(m.centre),O.normalize();const N=new s.Pa4(S[2].vector[0],S[2].vector[1],S[2].vector[2]);O.dot(N)<0&&(C.elements[4]=-S[1].vector[0],C.elements[5]=-S[1].vector[1],C.elements[6]=-S[1].vector[2],C.elements[8]=-S[2].vector[0],C.elements[9]=-S[2].vector[1],C.elements[10]=-S[2].vector[2]),l.computeBoundingSphere();const H=l.boundingSphere.radius,q=new s.yGw().makeScale(H,H,H);return C.multiply(q),C}const Ep={...fu,color:new pt(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new s.Pa4(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var $a=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Ds extends s.jyz{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,i,o){var m,y;super.onBeforeRender(e,t,n,i,o),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||t.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=t.envMapIntensity),this.envMap!==void 0&&t.fixedEnvMapDirection!==void 0&&(t.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((m=this.envMap)==null?void 0:m.rotation)||0)+this.envMapRotationOffset,this.extraUniformsToUpload.inverseModelMatrix.value.copy(o.matrixWorld).invert();const c=i.userData.normalsCaptureOffsets;c&&(this.extraUniformsToUpload.centerOffset.value.fromArray(c.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(c.offsetMatrix).premultiply(o.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=c.radius);const f=(y=i.userData._normalsCaptureMap)==null?void 0:y.texture;this.normalsCaptureMap!==f&&(this.normalsCaptureMap=f),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}onAfterRender(e,t,n,i,o){super.onAfterRender(e,t,n,i,o),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:i,object:o})}constructor(e){super({side:s.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#endif
}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#define CENTER_OFFSET  (centerOffset) 
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new s.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new s.Pa4(1,1,1)}}}),this.typeSlug=Ds.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new pt(1,1,1),this.envMapIntensity=1,this.envMapRotationOffset=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new s.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new s.yGw().identity()},radius:{value:1},centerOffset:{value:new s.Pa4(0,0,0)},modelOffsetMatrix:{value:new s.yGw().identity()},modelOffsetMatrixInv:{value:new s.yGw().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.setValues(e),this.materialExtensions=Wi.RegisterExtensions(this,(e==null?void 0:e.customMaterialExtensions)??[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Wi.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Wi.ApplyMaterialExtensions(this,e,this.materialExtensions,t),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Wi.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0,1)}set envMaps(e){this.__envMap=e,this.refreshEnvUniform()}refreshEnvUniform(){var e;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=(e=this.uniforms.envMap.value)!=null&&e.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){return this.__envMap[this.envMapIndex]??this.__envMap[0]??null}set envMap(e){console.error("Setting separate envmap for indivisual diamond material not supported yet.")}clone(){return super.clone()}toJSON(e){const t={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.envMapIndex=this.envMapIndex,t.envMapRotationOffset=this.envMapRotationOffset,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=Ds.TYPE,t.userData={},Ht(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(t=>({label:"env"+(t+1),value:t}))},...Wt(this),{type:"input",label:"Mesh count",get value(){var t,n;return((n=(t=e.userData)==null?void 0:t.__appliedMeshes)==null?void 0:n.size)??0},set value(t){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{const t=new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"});(0,a.downloadBlob)(t,"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(t=>{var n;return(n=t.getUiConfig)==null?void 0:n.call(t,this)})].filter(t=>t),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Ds.TYPE)return console.warn("Material type is not supported",e),this;const t={},n=Array.from(Object.keys(Ep));(0,a.copyProps)(e,t,n);const i=t.userData;return delete t.userData,this.setValues(t),Ht(this.userData,i),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}Ds.TypeSlug="dmat",Ds.TYPE="DiamondMaterial",$a([Lt("Color",{limitedUi:!0}),Ne()],Ds.prototype,"color",void 0),$a([Pe("Env Intensity",[0,5],.01,{limitedUi:!0}),Ne()],Ds.prototype,"envMapIntensity",void 0),$a([Pe("Env Rotation Offset",[-Math.PI,Math.PI],.01),(0,a.onChange2)(Ds.prototype.setDirty)],Ds.prototype,"envMapRotationOffset",void 0),$a([Pe("Dispersion",[0,.1],1e-4,{limitedUi:!0}),Ne({propKey:"rIndexDelta"})],Ds.prototype,"dispersion",void 0),$a([Pe("Absorption",[0,15],.01,{limitedUi:!0}),Ne()],Ds.prototype,"absorptionFactor",void 0),$a([Pe("Refractive Index",[0,4],.01,{limitedUi:!0}),Ne()],Ds.prototype,"refractiveIndex",void 0),$a([Ne()],Ds.prototype,"squashFactor",void 0),$a([Ne()],Ds.prototype,"geometryFactor",void 0),$a([Pe("Gamma",[.1,4],.01,{limitedUi:!0}),Ne()],Ds.prototype,"gammaFactor",void 0),$a([Le("RGB Boost",void 0,void 0,{limitedUi:!0}),Ne()],Ds.prototype,"boostFactors",void 0),$a([Pe("Transmission",[0,1],.01,{limitedUi:!0}),Ne()],Ds.prototype,"transmission",void 0),$a([Pe("Reflectivity",[0,2],.01,{limitedUi:!0}),Ne()],Ds.prototype,"reflectivity",void 0),$a([Ze("RAY_BOUNCES",void 0,!0),Pe("Ray Bounces",[1,16],1)],Ds.prototype,"rayBounces",void 0),$a([Ze("DIA_ORIENT_ENVMAP",void 0,!0),Pe("Diamond Oriented Lighting",[0,1],1)],Ds.prototype,"diamondOrientedEnvMap",void 0),$a([Ne({propKey:"tCubeMapNormals"})],Ds.prototype,"normalsCaptureMap",void 0),$a([(0,a.onChange)(Ds.prototype.refreshEnvUniform)],Ds.prototype,"envMapIndex",void 0);var Cd=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Fs extends Ri{get envMapRotation(){var e;return((e=this.envMap)==null?void 0:e.rotation)??0}set envMapRotation(e){var n;const t=[this.envMap,this.envMap2,this.envMap3];for(const i of t)i&&(i.rotation=e,(n=this._viewer)==null||n.scene.setDirty())}refreshEnvMaps(){var n,i,o;if(!this._viewer)return;const e=this.getEnvMaps(),t=((i=(n=this._viewer.getPlugin(fi))==null?void 0:n.materials)==null?void 0:i.getMaterialsOfType(Ds.TypeSlug))||[];for(const c of t)c&&(c.envMaps=e);(o=this._viewer)==null||o.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var t;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const e=((t=this._viewer)==null?void 0:t.scene.getEnvironment())||null;return[e,e,e]},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(i=>{var c,f,m,y;const o=(f=(c=i.userData)==null?void 0:c.gltfExtensions)==null?void 0:f[Fs.DIAMOND_GLTF_EXTENSION];o&&i.geometry&&(this.prepareDiamondMesh(i,o),delete i.userData.gltfExtensions[Fs.DIAMOND_GLTF_EXTENSION]),i.material&&!n.includes(i.material)&&((y=(m=i.material.userData)==null?void 0:m.gltfExtensions)!=null&&y[Fs.DIAMOND_GLTF_EXTENSION])&&(i.material.materialObject||console.warn("material not processed",i.material),n.push(i.material))}),n.forEach(i=>{const o=i.userData.gltfExtensions[Fs.DIAMOND_GLTF_EXTENSION];o&&this._convertToDiamondMaterial(i,o)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var t,n,i;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Wr.TypeSlug},value:async()=>{var i,o,c,f,m,y;const e=(o=(i=this._viewer)==null?void 0:i.getPlugin(us))==null?void 0:o.getSelectedObject();if(!(e!=null&&e.material))return;const t=await((c=this._viewer)==null?void 0:c.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let n=parseInt(await((f=this._viewer)==null?void 0:f.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(n)||(n=512),n<64&&(n=64),((m=e.material.userData)==null?void 0:m.__appliedMeshes.size)>1&&await((y=this._viewer)==null?void 0:y.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(e.material,{cacheKey:t||void 0,normalMapRes:n},{}):this.makeDiamondMesh(e,{cacheKey:t||void 0,normalMapRes:n},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var t,n,i;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Ds.TypeSlug},value:async()=>{var o,c,f,m,y,w,S,C;const e=(c=(o=this._viewer)==null?void 0:o.getPlugin(us))==null?void 0:c.getSelectedObject(),t=e==null?void 0:e.material;if(!t)return;const n=t.userData._baseMaterial;let i=(y=(m=(f=this._viewer)==null?void 0:f.getManager())==null?void 0:m.materials)==null?void 0:y.findMaterial(n);if(i&&!i.isDiamondMaterial||(i=(w=this._viewer)==null?void 0:w.createPhysicalMaterial({color:t.color})),i){const O=t.userData.__appliedMeshes.size>1&&await((S=this._viewer)==null?void 0:S.confirm("Convert all with this material?"))?Array.from(t.userData.__appliedMeshes):[e];for(const N of O)(C=N==null?void 0:N.setMaterial)==null||C.call(N,i)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var t,n,i,o;const e=(i=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject())==null?void 0:i.material;return!!Array.isArray(e)||(e==null?void 0:e.typeSlug)!==Ds.TypeSlug||((o=e.userData.__appliedMeshes)==null?void 0:o.size)<2},value:async()=>{var n,i;const e=(i=(n=this._viewer)==null?void 0:n.getPlugin(us))==null?void 0:i.getSelectedObject();if(!e)return;const t=e.material;t&&!Array.isArray(t)&&za(t)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var e,t,n;(e=this._viewer)==null||e.setDirty(),(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t,"postFrame",!0)}async onAdded(e){var o,c,f,m,y,w,S;this._normalCapture=new _f(e.renderer),this.offsetCache={},e.scene.addEventListener("materialChanged",C=>{var O,N,H,q;if((O=C.material)!=null&&O.isDiamondMaterial){const J=C.material,V=C.mesh||C.object;if(V.geometry&&!((N=this._normalCapture)!=null&&N.hasCapturedNormalMap(V))){const ue=((q=(H=J==null?void 0:J.userData)==null?void 0:H.gltfExtensions)==null?void 0:q[Fs.DIAMOND_GLTF_EXTENSION])??{};ue.cacheKey===void 0&&!V.userData._diamondCacheKey&&(J!=null&&J.name)&&(ue.cacheKey=J.name),this.prepareDiamondMesh(V,ue)}const z=this.getEnvMaps();J.envMaps=z}}),e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const t=e.getPlugin(fi);(o=t==null?void 0:t.importer)==null||o.processors.add("model",this._modelProcessor),(c=e.getPlugin(us))==null||c.addEventListener("selectedObjectChanged",this.refreshUi);const n=this.getEnvMaps,i=new Js(class extends _h{async loadAsync(C,O){var H;const N=await super.loadAsync(C,O);return N.type===Ds.TYPE||N.isDiamondMaterialParameters?(N.envMap=n(),(H=t==null?void 0:t.materials)==null?void 0:H.generateFromTemplate("diamond",N)):(console.error("Invalid material type for Diamond Material.",N),null)}},[Ds.TypeSlug],!1);return(f=t==null?void 0:t.importer)==null||f.Importers.push(i),(w=(y=(m=t==null?void 0:t.exporter)==null?void 0:m.getExporter("gltf","glb"))==null?void 0:y.extensions)==null||w.push(Cc),(S=t==null?void 0:t.materials)==null||S.registerMaterialTemplate({name:"diamond",materialType:Ds.TYPE,isDiamondMaterialParameters:!0,generator:(C,O)=>{const N=!(O!=null&&O.metadata||!O.isDiamondMaterialParameters)||(O==null?void 0:O.metadata)&&(O==null?void 0:O.metadata.version)<=4.5,H=O==null?void 0:O.color;N&&typeof O.color=="number"&&(O.color=new pt().setHex(O.color,s.GUF).getHex());const q=new Ds(C);return q.envMaps=this.getEnvMaps(),O&&q.copyProps(O),O.color=H,q}}),super.onAdded(e)}async onRemove(e){var t,n,i,o;return(t=this._normalCapture)==null||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(i=(n=e.getPlugin(fi))==null?void 0:n.importer)==null||i.processors.remove("model",this._modelProcessor),(o=e.getPlugin(us))==null||o.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){var c,f;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const i=((c=this._normalCapture)==null?void 0:c.captureNormalMap(e.geometry,t,n))??[void 0,!1],o=(f=this._viewer)==null?void 0:f.getPluginByType("debug");o&&i&&(o.counters.normalsCapture||(o.counters.normalsCapture=0),o.counters.normalsCapture++,console.log("DEBUG: new normal map captured",o.counters.normalsCapture,t),o.addTexture("normal"+o.counters.normalsCapture,()=>{var m,y;return(y=(m=e.geometry)==null?void 0:m.userData._normalsCaptureMap)==null?void 0:y.texture},[40,110*o.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var i;Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(o=>{o!=null&&o.isMesh&&o.geometry&&this.prepareDiamondMesh(o,t)}),this._convertToDiamondMaterial(e,n),(i=this._viewer)==null||i.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const i=Array.isArray(e.material)?e.material[0]:e.material,o=this._convertToDiamondMaterial(i,n,!1);e.setMaterial(o)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var c,f,m;let i={...t??{}};i.isDiamond||i.isDiamondMaterialParameters?Array.isArray(i.boostFactors)&&(i.boostFactors=new s.Pa4().fromArray(i.boostFactors)):i={isDiamondMaterialParameters:!0},i.color=i.color??(e==null?void 0:e.color)??new pt(1,1,1),i.name=i.name??(e==null?void 0:e.name)??"diamond";const o=(m=(f=(c=this._viewer)==null?void 0:c.getManager())==null?void 0:f.materials)==null?void 0:m.generateFromTemplate("diamond",i);if(o&&e&&!e.isDiamondMaterial&&(o.userData._baseMaterial=e.uuid),n){const y=w=>w.setMaterial??(S=>{w.material=S.materialObject});Array.from((e==null?void 0:e.userData.__appliedMeshes)??[]).forEach(w=>{y(w)(o),this.prepareDiamondMesh(w,t)})}return o}_computeOffsets(e,t,n=!1){if(e.userData.normalsCaptureOffsets){if((0,a.getUrlQueryParam)("recomputeOffsets")===null)return e.userData.normalsCaptureOffsets;console.warn("recomputeOffsets",e.userData.normalsCaptureOffsets)}e.computeBoundingBox();const i=e.boundingBox.getCenter(new s.Pa4).toArray(),o=zh(e).toArray(),c=new s.yGw().fromArray(o).invert(),f=new s.Pa4().fromArray(i).applyMatrix4(c).toArray(),m={center:i,offsetMatrix:o,offsetMatrixInv:c.toArray(),radius:1,centerOffset:f};return e.userData.normalsCaptureOffsets=m,(0,a.getUrlQueryParam)("recomputeOffsets")!==null&&console.warn("recomputeOffsets",m),m}disposeCacheMap(e){var t;(t=this._normalCapture)==null||t.disposeTarget(e)}disposeAllCacheMaps(){var e;(e=this._normalCapture)==null||e.disposeAllTargets()}}Fs.PluginType="Diamond",Fs.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Cd([(0,a.onChange)(Fs.prototype.refreshEnvMaps),ze()],Fs.prototype,"envMap",void 0),Cd([(0,a.onChange)(Fs.prototype.refreshEnvMaps),ze()],Fs.prototype,"envMap2",void 0),Cd([(0,a.onChange)(Fs.prototype.refreshEnvMaps),ze()],Fs.prototype,"envMap3",void 0),Cd([(0,a.onChange)(Fs.prototype.refreshEnvMaps),ze()],Fs.prototype,"forceSceneEnvMap",void 0);const Cc=l=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[Fs.DIAMOND_GLTF_EXTENSION]=e.toJSON(),l.extensionsUsed[Fs.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var i,o;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const n={};(o=(i=e.userData)==null?void 0:i.gltfExtensions)==null||delete o[Fs.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(n.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(n.cacheKey=e.userData._diamondCacheKey),t.extensions[Fs.DIAMOND_GLTF_EXTENSION]=n,l.extensionsUsed[Fs.DIAMOND_GLTF_EXTENSION]=!0}});class jh{static async GetClonedCanvas(e,{rect:t={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:n=1,scale:i=1}){var m,y,w;const o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");o.width=t.width*i*n,o.height=t.height*i*n,t.assumeClientRect&&(t.x*=e.width/(n*e.clientWidth),t.y*=e.height/(n*e.clientHeight),t.width*=e.width/(n*e.clientWidth),t.height*=e.height/(n*e.clientHeight));const c=o.getContext("2d");if(!c)return console.error("snapshot: cannot create context"),o;const f=e.style.background||((m=e.parentElement)==null?void 0:m.style.background)||"";if(f.includes("url")){const S=(y=/url\("(.*)"\)/gi.exec(f))==null?void 0:y[1];if(S){const C=new Image;C.src=S,await new Promise((O,N)=>{C.onload=()=>O(),C.onerror=()=>N(),C.complete&&O()}),c.drawImage(C,C.width*t.x*n/e.width,C.height*t.y*n/e.height,C.width*t.width*n/e.width,C.height*t.height*n/e.height,0,0,o.width,o.height)}}else c.fillStyle=e.style.background||((w=e.parentElement)==null?void 0:w.style.backgroundColor)||"#00000000",c.fillRect(0,0,o.width,o.height);return c==null||c.drawImage(e,t.x*n,t.y*n,t.width*n,t.height*n,0,0,o.width,o.height),this.Debug&&(document.body.appendChild(o),o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.borderWidth="2px",o.style.borderColor="#ff00ff",setTimeout(()=>o.remove(),5e3)),o}static async GetDataUrl(e,{mimeType:t="image/png",...n}){const i=await this.GetClonedCanvas(e,n),o=i.toDataURL(t);return this.Debug||i.remove(),o}static async GetImage(e,{mimeType:t="image/png",...n}={}){const i=await this.GetDataUrl(e,n);return new Promise((o,c)=>{const f=new Image;f.onload=()=>{o(f)},f.src=i})}static async GetBlob(e,t={}){const n=await this.GetClonedCanvas(e,t),i=await new Promise((o,c)=>{n.toBlob(f=>{f?o(f):c()},t.mimeType??"image/png")});return this.Debug||n.remove(),i}static async GetFile(e,t="image.png",n={}){return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:n.mimeType??"image/png",lastModified:(0,a.now)()})}}jh.Debug=!1;var yf=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Cu=class extends Ri{constructor(){super(),this.enabled=!0,this.filename="snapshot.png",this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(l,e={waitForProgressive:!0}){return e.getDataUrl=!1,await this._getFile(l||this.filename,e)}async getDataUrl(l={}){return l.getDataUrl=!0,await this._getFile("",l)??""}async _getFile(l,e={}){var n,i;const t=(n=this._viewer)==null?void 0:n.canvas;if(t){const o=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==o&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const c=(i=this._viewer)==null?void 0:i.getPlugin(to);if(e.waitForProgressive&&c&&e.timeout===void 0)for(;!c.isConverged(!0);)await(0,a.timeout)(64);else await(0,a.timeout)(e.timeout??200);e.displayPixelRatio=1;const f=await jh.GetFile(t,l,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=o,f}}async downloadSnapshot(l,e={waitForProgressive:!0}){const t=await this.getFile(l,e);t&&await this._downloadBlob(t,t.name)}async _downloadBlob(l,e){var n,i;const t=(n=this._viewer)==null?void 0:n.getPluginByType("FileTransferPlugin");t?await t.exportFile(l,e):(i=this._viewer)==null||i.console.error("FileTransferPlugin required to export/download file")}};Cu.PluginType="CanvasSnipper",yf([Ke("Filename"),ze()],Cu.prototype,"filename",void 0),yf([ht("Download .png",{limitedUi:!0})],Cu.prototype,"downloadSnapshot",null),Cu=yf([on("Image Export")],Cu);var Am=function(l){return function(e){return 1-l(1-e)}},Rd=function(l){return function(e){return e<=.5?l(2*e)/2:(2-l(2*(1-e)))/2}},Af=function(l){return function(e){return Math.pow(e,l)}},Kg=function(l){return function(e){return e*e*((l+1)*e-l)}},gl=function(l){var e=Kg(l);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},$g=function(l){return l},bm=Af(2),fA=Am(bm),Jg=Rd(bm),xm=function(l){return 1-Math.sin(Math.acos(l))},Vh=Am(xm),V0=Rd(Vh),Zg=Kg(1.525),Ja=Am(Zg),G0=Rd(Zg),e_=gl(1.525),wm=function(l){if(l===1||l===0)return l;var e=l*l;return l<.36363636363636365?7.5625*e:l<.7272727272727273?9.075*e-9.9*l+3.4:l<.9?12.066481994459833*e-19.63545706371191*l+8.898060941828255:10.8*l*l-20.52*l+10.72},Em=Am(wm),Sm=function(l){return l<.5?.5*(1-wm(1-2*l)):.5*wm(2*l-1)+.5},lo=function(){return lo=Object.assign||function(l){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(l[i]=e[i]);return l},lo.apply(this,arguments)};function Rv(l,e){var t={};for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&e.indexOf(n)<0&&(t[n]=l[n]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(n=Object.getOwnPropertySymbols(l);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(l,n[i])&&(t[n[i]]=l[n[i]])}return t}var t_=function(){},Mm=function(l,e,t){return Math.min(Math.max(t,l),e)},Sp=.001,Iv=.01,Tb=10,Pv=.05,ih=1,Dv=12;function Ov(l,e){return l*Math.sqrt(1-e*e)}var H0=["duration","bounce"],Bv=["stiffness","damping","mass"];function Lv(l,e){return e.some(function(t){return l[t]!==void 0})}function Gh(l){var e=l.from,t=e===void 0?0:e,n=l.to,i=n===void 0?1:n,o=l.restSpeed,c=o===void 0?2:o,f=l.restDelta,m=Rv(l,["from","to","restSpeed","restDelta"]),y={done:!1,value:t},w=function(ue){var me=lo({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},ue);if(!Lv(ue,Bv)&&Lv(ue,H0)){var Te=function(Be){var He,tt,lt=Be.duration,at=lt===void 0?800:lt,St=Be.bounce,mt=St===void 0?.25:St,gt=Be.velocity,Ot=gt===void 0?0:gt,Bt=Be.mass,Ft=Bt===void 0?1:Bt,_n=1-mt;_n=Mm(Pv,ih,_n),at=Mm(Iv,Tb,at/1e3),_n<1?(He=function(Rn){var En=Rn*_n,ai=En*at,ri=En-Ot,Ei=Ov(Rn,_n),ki=Math.exp(-ai);return Sp-ri/Ei*ki},tt=function(Rn){var En=Rn*_n*at,ai=En*Ot+Ot,ri=Math.pow(_n,2)*Math.pow(Rn,2)*at,Ei=Math.exp(-En),ki=Ov(Math.pow(Rn,2),_n);return(-He(Rn)+Sp>0?-1:1)*((ai-ri)*Ei)/ki}):(He=function(Rn){return Math.exp(-Rn*at)*((Rn-Ot)*at+1)-Sp},tt=function(Rn){return Math.exp(-Rn*at)*(at*at*(Ot-Rn))});var mn=function(Rn,En,ai){for(var ri=ai,Ei=1;Ei<Dv;Ei++)ri-=Rn(ri)/En(ri);return ri}(He,tt,5/at);if(at*=1e3,isNaN(mn))return{stiffness:100,damping:10,duration:at};var qn=Math.pow(mn,2)*Ft;return{stiffness:qn,damping:2*_n*Math.sqrt(Ft*qn),duration:at}}(ue);(me=lo(lo(lo({},me),Te),{velocity:0,mass:1})).isResolvedFromDuration=!0}return me}(m),S=w.stiffness,C=w.damping,O=w.mass,N=w.velocity,H=w.duration,q=w.isResolvedFromDuration,J=n_,V=n_;function z(){var ue=N?-N/1e3:0,me=i-t,Te=C/(2*Math.sqrt(S*O)),Be=Math.sqrt(S/O)/1e3;if(f!=null||(f=Math.abs(i-t)<=1?.01:.4),Te<1){var He=Ov(Be,Te);J=function(lt){var at=Math.exp(-Te*Be*lt);return i-at*((ue+Te*Be*me)/He*Math.sin(He*lt)+me*Math.cos(He*lt))},V=function(lt){var at=Math.exp(-Te*Be*lt);return Te*Be*at*(Math.sin(He*lt)*(ue+Te*Be*me)/He+me*Math.cos(He*lt))-at*(Math.cos(He*lt)*(ue+Te*Be*me)-He*me*Math.sin(He*lt))}}else if(Te===1)J=function(lt){return i-Math.exp(-Be*lt)*(me+(ue+Be*me)*lt)};else{var tt=Be*Math.sqrt(Te*Te-1);J=function(lt){var at=Math.exp(-Te*Be*lt),St=Math.min(tt*lt,300);return i-at*((ue+Te*Be*me)*Math.sinh(St)+tt*me*Math.cosh(St))/tt}}}return z(),{next:function(ue){var me=J(ue);if(q)y.done=ue>=H;else{var Te=1e3*V(ue),Be=Math.abs(Te)<=c,He=Math.abs(i-me)<=f;y.done=Be&&He}return y.value=y.done?i:me,y},flipTarget:function(){var ue;N=-N,t=(ue=[i,t])[0],i=ue[1],z()}}}Gh.needsInterpolation=function(l,e){return typeof l=="string"||typeof e=="string"};var n_=function(l){return 0},Mp=function(l,e,t){var n=e-l;return n===0?1:(t-l)/n},bf=function(l,e,t){return-t*l+t*e+l},xf=function(l,e){return function(t){return Math.max(Math.min(t,e),l)}},Hh=function(l){return l%1?Number(l.toFixed(5)):l},Tp=/(-)?([\d]*\.?[\d])+/g,i_=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,Nv=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Tm(l){return typeof l=="string"}var wf={test:function(l){return typeof l=="number"},parse:parseFloat,transform:function(l){return l}},r_=lo(lo({},wf),{transform:xf(0,1)}),Cm=(lo(lo({},wf),{default:1}),function(l,e){return function(t){return!!(Tm(t)&&Nv.test(t)&&t.startsWith(l)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),kv=function(l,e,t){return function(n){var i;if(!Tm(n))return n;var o=n.match(Tp),c=o[0],f=o[1],m=o[2],y=o[3];return(i={})[l]=parseFloat(c),i[e]=parseFloat(f),i[t]=parseFloat(m),i.alpha=y!==void 0?parseFloat(y):1,i}},mA=xf(0,255),Id=lo(lo({},wf),{transform:function(l){return Math.round(mA(l))}}),Ru={test:Cm("rgb","red"),parse:kv("red","green","blue"),transform:function(l){var e=l.red,t=l.green,n=l.blue,i=l.alpha,o=i===void 0?1:i;return"rgba("+Id.transform(e)+", "+Id.transform(t)+", "+Id.transform(n)+", "+Hh(r_.transform(o))+")"}},Os={test:Cm("#"),parse:function(l){var e="",t="",n="",i="";return l.length>5?(e=l.substr(1,2),t=l.substr(3,2),n=l.substr(5,2),i=l.substr(7,2)):(e=l.substr(1,1),t=l.substr(2,1),n=l.substr(3,1),i=l.substr(4,1),e+=e,t+=t,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}},transform:Ru.transform},s_=function(l){return{test:function(e){return Tm(e)&&e.endsWith(l)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+l}}},$l=s_("%"),Rc=(lo(lo({},$l),{parse:function(l){return $l.parse(l)/100},transform:function(l){return $l.transform(100*l)}}),{test:Cm("hsl","hue"),parse:kv("hue","saturation","lightness"),transform:function(l){var e=l.hue,t=l.saturation,n=l.lightness,i=l.alpha,o=i===void 0?1:i;return"hsla("+Math.round(e)+", "+$l.transform(Hh(t))+", "+$l.transform(Hh(n))+", "+Hh(r_.transform(o))+")"}}),rh=function(l,e,t){var n=l*l,i=e*e;return Math.sqrt(Math.max(0,t*(i-n)+n))},Cp=[Os,Ru,Rc],Rm=function(l){return Cp.find(function(e){return e.test(l)})},Iu=function(l,e){var t=Rm(l),n=Rm(e);if(t_(t.transform===n.transform),!t||!n||t.transform!==n.transform)return function(m){return""+(m>0?e:l)};var i=t.parse(l),o=n.parse(e),c=lo({},i),f=t===Rc?bf:rh;return function(m){for(var y in c)y!=="alpha"&&(c[y]=f(i[y],o[y],m));return c.alpha=bf(i.alpha,o.alpha,m),t.transform(c)}},Ef={test:function(l){return Ru.test(l)||Os.test(l)||Rc.test(l)},parse:function(l){return Ru.test(l)?Ru.parse(l):Rc.test(l)?Rc.parse(l):Os.parse(l)},transform:function(l){return Tm(l)?l:l.hasOwnProperty("red")?Ru.transform(l):Rc.transform(l)}},Im="${c}",o_="${n}";function Wh(l){typeof l=="number"&&(l=""+l);var e=[],t=0,n=l.match(i_);n&&(t=n.length,l=l.replace(i_,Im),e.push.apply(e,n.map(Ef.parse)));var i=l.match(Tp);return i&&(l=l.replace(Tp,o_),e.push.apply(e,i.map(wf.parse))),{values:e,numColors:t,tokenised:l}}function Sf(l){return Wh(l).values}function Qh(l){var e=Wh(l),t=e.values,n=e.numColors,i=e.tokenised,o=t.length;return function(c){for(var f=i,m=0;m<o;m++)f=f.replace(m<n?Im:o_,m<n?Ef.transform(c[m]):Hh(c[m]));return f}}var Pm=function(l){return typeof l=="number"?0:l},Uv={test:function(l){var e,t,n,i;return isNaN(l)&&Tm(l)&&((t=(e=l.match(Tp))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((i=(n=l.match(i_))===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0)>0},parse:Sf,createTransformer:Qh,getAnimatableNone:function(l){var e=Sf(l);return Qh(l)(e.map(Pm))}},Fv={x:0,y:0,z:0},a_=function(l){return typeof l=="number"},Cb=function(l,e){return function(t){return e(l(t))}},l_=function(){for(var l=[],e=0;e<arguments.length;e++)l[e]=arguments[e];return l.reduce(Cb)};function zv(l,e){return a_(l)?function(t){return bf(l,e,t)}:Ef.test(l)?Iu(l,e):sh(l,e)}var W0=function(l,e){var t=function(o,c,f){if(f||arguments.length===2)for(var m,y=0,w=c.length;y<w;y++)!m&&y in c||(m||(m=Array.prototype.slice.call(c,0,y)),m[y]=c[y]);return o.concat(m||Array.prototype.slice.call(c))}([],l),n=t.length,i=l.map(function(o,c){return zv(o,e[c])});return function(o){for(var c=0;c<n;c++)t[c]=i[c](o);return t}},jv=function(l,e){var t=lo(lo({},l),e),n={};for(var i in t)l[i]!==void 0&&e[i]!==void 0&&(n[i]=zv(l[i],e[i]));return function(o){for(var c in n)t[c]=n[c](o);return t}};function c_(l){for(var e=Uv.parse(l),t=e.length,n=0,i=0,o=0,c=0;c<t;c++)n||typeof e[c]=="number"?n++:e[c].hue!==void 0?o++:i++;return{parsed:e,numNumbers:n,numRGB:i,numHSL:o}}var sh=function(l,e){var t=Uv.createTransformer(e),n=c_(l),i=c_(e);return n.numHSL===i.numHSL&&n.numRGB===i.numRGB&&n.numNumbers>=i.numNumbers?l_(W0(n.parsed,i.parsed),t):function(o){return""+(o>0?e:l)}},Q0=function(l,e){return function(t){return bf(l,e,t)}};function no(l,e,t){var n=t===void 0?{}:t,i=n.clamp,o=i===void 0||i,c=n.ease,f=n.mixer,m=l.length;t_(m===e.length),t_(!c||!Array.isArray(c)||c.length===m-1),l[0]>l[m-1]&&(l=[].concat(l),e=[].concat(e),l.reverse(),e.reverse());var y=function(S,C,O){for(var N=[],H=O||(typeof(ue=S[0])=="number"?Q0:typeof ue=="string"?Ef.test(ue)?Iu:sh:Array.isArray(ue)?W0:typeof ue=="object"?jv:void 0),q=S.length-1,J=0;J<q;J++){var V=H(S[J],S[J+1]);if(C){var z=Array.isArray(C)?C[J]:C;V=l_(z,V)}N.push(V)}var ue;return N}(e,c,f),w=m===2?function(S,C){var O=S[0],N=S[1],H=C[0];return function(q){return H(Mp(O,N,q))}}(l,y):function(S,C){var O=S.length,N=O-1;return function(H){var q=0,J=!1;if(H<=S[0]?J=!0:H>=S[N]&&(q=N-1,J=!0),!J){for(var V=1;V<O&&!(S[V]>H||V===N);V++);q=V-1}var z=Mp(S[q],S[q+1],H);return C[q](z)}}(l,y);return o?function(S){return w(Mm(l[0],l[m-1],S))}:w}function Rp(l,e){return l.map(function(){return e||Jg}).splice(0,l.length-1)}function qh(l){var e=l.from,t=e===void 0?0:e,n=l.to,i=n===void 0?1:n,o=l.ease,c=l.offset,f=l.duration,m=f===void 0?300:f,y={done:!1,value:t},w=Array.isArray(i)?i:[t,i],S=function(N,H){return N.map(function(q){return q*H})}(c&&c.length===w.length?c:function(N){var H=N.length;return N.map(function(q,J){return J!==0?J/(H-1):0})}(w),m);function C(){return no(S,w,{ease:Array.isArray(o)?o:Rp(w,o)})}var O=C();return{next:function(N){return y.value=O(N),y.done=N>=m,y},flipTarget:function(){w.reverse(),O=C()}}}function Mf(l){var e=l.velocity,t=e===void 0?0:e,n=l.from,i=n===void 0?0:n,o=l.power,c=o===void 0?.8:o,f=l.timeConstant,m=f===void 0?350:f,y=l.restDelta,w=y===void 0?.5:y,S=l.modifyTarget,C={done:!1,value:i},O=c*t,N=i+O,H=S===void 0?N:S(N);return H!==N&&(O=H-i),{next:function(q){var J=-O*Math.exp(-q/m);return C.done=!(J>w||J<-w),C.value=C.done?H:H+J,C},flipTarget:function(){}}}var Tf={keyframes:qh,spring:Gh,decay:Mf},Dm=1/60*1e3,Vv=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},Om=typeof window<"u"?function(l){return window.requestAnimationFrame(l)}:function(l){return setTimeout(function(){return l(Vv())},Dm)},Cf=!0,Rf=!1,Ic=!1,Bm={delta:0,timestamp:0},u_=["read","update","preRender","render","postRender"],Pd=u_.reduce(function(l,e){return l[e]=function(t){var n=[],i=[],o=0,c=!1,f=new WeakSet,m={schedule:function(y,w,S){w===void 0&&(w=!1),S===void 0&&(S=!1);var C=S&&c,O=C?n:i;return w&&f.add(y),O.indexOf(y)===-1&&(O.push(y),C&&c&&(o=n.length)),y},cancel:function(y){var w=i.indexOf(y);w!==-1&&i.splice(w,1),f.delete(y)},process:function(y){var w;if(c=!0,n=(w=[i,n])[0],(i=w[1]).length=0,o=n.length)for(var S=0;S<o;S++){var C=n[S];C(y),f.has(C)&&(m.schedule(C),t())}c=!1}};return m}(function(){return Rf=!0}),l},{}),gA=u_.reduce(function(l,e){var t=Pd[e];return l[e]=function(n,i,o){return i===void 0&&(i=!1),o===void 0&&(o=!1),Rf||h_(),t.schedule(n,i,o)},l},{}),Pu=u_.reduce(function(l,e){return l[e]=Pd[e].cancel,l},{}),Lm=function(l){return Pd[l].process(Bm)},Za=function(l){Rf=!1,Bm.delta=Cf?Dm:Math.max(Math.min(l-Bm.timestamp,40),1),Bm.timestamp=l,Ic=!0,u_.forEach(Lm),Ic=!1,Rf&&(Cf=!1,Om(Za))},h_=function(){Rf=!0,Cf=!0,Ic||Om(Za)},oh=function(){return Bm},Dd=gA;function _l(l,e,t){return t===void 0&&(t=0),l-e-t}var _o=function(l){var e=function(t){var n=t.delta;return l(n)};return{start:function(){return Dd.update(e,!0)},stop:function(){return Pu.update(e)}}};function Yr(l){var e,t,n,i,o,c=l.from,f=l.autoplay,m=f===void 0||f,y=l.driver,w=y===void 0?_o:y,S=l.elapsed,C=S===void 0?0:S,O=l.repeat,N=O===void 0?0:O,H=l.repeatType,q=H===void 0?"loop":H,J=l.repeatDelay,V=J===void 0?0:J,z=l.onPlay,ue=l.onStop,me=l.onComplete,Te=l.onRepeat,Be=l.onUpdate,He=Rv(l,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),tt=He.to,lt=0,at=He.duration,St=!1,mt=!0,gt=function(Bt){if(Array.isArray(Bt.to))return qh;if(Tf[Bt.type])return Tf[Bt.type];var Ft=new Set(Object.keys(Bt));return Ft.has("ease")||Ft.has("duration")&&!Ft.has("dampingRatio")?qh:Ft.has("dampingRatio")||Ft.has("stiffness")||Ft.has("mass")||Ft.has("damping")||Ft.has("restSpeed")||Ft.has("restDelta")?Gh:qh}(He);!((t=(e=gt).needsInterpolation)===null||t===void 0)&&t.call(e,c,tt)&&(o=no([0,100],[c,tt],{clamp:!1}),c=0,tt=100);var Ot=gt(lo(lo({},He),{from:c,to:tt}));return m&&(z==null||z(),(n=w(function(Bt){if(mt||(Bt=-Bt),C+=Bt,!St){var Ft=Ot.next(Math.max(0,C));i=Ft.value,o&&(i=o(i)),St=mt?Ft.done:C<=0}Be==null||Be(i),St&&(lt===0&&(at!=null||(at=C)),lt<N?function(_n,mn,qn,Rn){return Rn?_n>=mn+qn:_n<=-qn}(C,at,V,mt)&&(lt++,q==="reverse"?C=function(_n,mn,qn,Rn){return qn===void 0&&(qn=0),Rn===void 0&&(Rn=!0),Rn?_l(mn+-_n,mn,qn):mn-(_n-mn)+qn}(C,at,V,mt=lt%2==0):(C=_l(C,at,V),q==="mirror"&&Ot.flipTarget()),St=!1,Te&&Te()):(n.stop(),me&&me()))})).start()),{stop:function(){ue==null||ue(),n.stop()}}}const Ul={linear:$g,easeIn:bm,easeOut:fA,easeInOut:Jg,circIn:xm,circOut:Vh,circInOut:V0,backIn:Zg,backOut:Ja,backInOut:G0,anticipate:e_,bounceOut:wm,bounceIn:Em,bounceInOut:Sm,easeInOutSine:function(l){return-(Math.cos(Math.PI*l)-1)/2}};function Ho(l,e,t){const n=l[e],i=()=>{typeof(l==null?void 0:l.setDirty)=="function"&&l.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?o=>{n.copy(o),i()}:o=>{l[e]=o,i()}}function Ip(l){return typeof l!="boolean"}async function Nm(l,e,t,n){e in l||console.error("invalid key",e,l);const i=Ho(l,e),o=l[e],c=f=>{var m;i(f),(m=t.onUpdate)==null||m.call(t,f)};if(Ip(o))return typeof t.to=="function"&&(t={...t,to:t.to(o,l)}),If({...t,from:o,onUpdate:c},n);{const{duration:f}=t;return(0,a.timeout)(f??0).then(()=>c(t.to))}}async function If(l,e){const t=l.onComplete,n=l.onStop;return l={...l},new Promise((i,o)=>{l.onComplete=()=>{try{t==null||t()}catch(f){return void o(f)}i()},l.onStop=()=>{try{n==null||n()}catch(f){return void o(f)}i()};const c=Yr(l);e&&e.push(c)})}var To=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Jl=1,Jo=class{constructor(l,e,t,n,i){this.position=new s.Pa4,this.target=new s.Pa4,this.quaternion=new s._fP,this.up=new s.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=rn(this.name,this),l&&(this.position=l),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),i&&(this.snap=i),this.name="#view"+Jl++}_nameChanged(){var l,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(l=this.uiConfig).uiRefresh)==null||e.call(l))}};To([ze(),Le()],Jo.prototype,"position",void 0),To([ze(),Le()],Jo.prototype,"target",void 0),To([ze(),Le()],Jo.prototype,"quaternion",void 0),To([ze(),Le()],Jo.prototype,"up",void 0),To([ze(),Ke()],Jo.prototype,"name",void 0),To([dt()],Jo.prototype,"snap",void 0),To([ht()],Jo.prototype,"focusView",void 0),To([ht()],Jo.prototype,"deleteView",void 0),Jo=To([jr("CameraView")],Jo);class ks extends Ri{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Wt(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)==null?void 0:t.scene.activeCamera;if(!n)return;const i=new s.$V,o=n.position,c=n.target,f=new s._fP().setFromUnitVectors(n.cameraObject.up,new s.Pa4(0,1,0)),m=f.clone().invert(),y=o.clone().sub(c);y.applyQuaternion(f),i.setFromVector3(y),i.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,i.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,i.makeSafe(),y.setFromSpherical(i),y.applyQuaternion(m),o.copy(c).add(y),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var i,o;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))==null||i.enable(ks.PluginType),this._fadeDisabled=!1));const e=(0,a.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=e-1/60);let t=e-this._lastFrameTime;this._lastFrameTime=e,t*=this.animateOnScroll?this._scrollAnimationState:1;const n=(o=this._viewer.getPluginByType("Progressive"))==null?void 0:o.postFrameConvergedRecordingDelta();if(n&&n>0&&(t=n),n!==0&&(t*=1e3,!(t<=0||(this._updaters.forEach(c=>{let f=t;c.time+f<0&&(f=-c.time),c.time+=f,Math.abs(f)>.001&&c.u(f)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const c=this._viewer.getPluginByType("FrameFade");c&&(c.disable(ks.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await(0,a.timeout)(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await(0,a.timeout)(2))}async recordAllViews(e,t=!0){var i;if(!this.enabled)return;const n=(i=this._viewer)==null?void 0:i.getPluginByType("CanvasRecorder");if(n&&n.enabled&&!(this._cameraViews.length<1)){if(await this.resetToFirstView(),!n.isRecording())return new Promise((o,c)=>{const f=()=>{n.removeEventListener("start",m),n.removeEventListener("stop",f),n.removeEventListener("error",y)},m=async()=>{var S;f(),e==null||e(),await this.animateAllViews();const w=await n.stopRecording();if(t){const C=await((S=this._viewer)==null?void 0:S.prompt("Canvas Recorder: Save file as","recording.mp4"));C!==null&&w&&await this._downloadBlob(w,C||"recording.mp4")}o(w)},y=async()=>{f(),c()};n.addEventListener("start",m),n.addEventListener("stop",f),n.addEventListener("error",y),n.startRecording()||console.error("cannot start recording")});console.error("CanvasRecorderPlugin is already recording")}}async addCurrentView(){var n,i,o;if(!this.enabled)return;const e=(n=this._viewer)==null?void 0:n.scene.activeCamera;if(!e)return;const t=this.getCurrentCameraView(e);t.snap=await((o=(i=this._viewer)==null?void 0:i.getPlugin(Cu))==null?void 0:o.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this.addView(t)}addView(e){var t,n;this._cameraViews.push(e),(n=(t=this.uiConfig).uiRefresh)==null||n.call(t),this.dispatchEvent({type:"viewAdd",view:e})}getCurrentCameraView(e,t=!0){var y;if(e||(e=(y=this._viewer)==null?void 0:y.scene.activeCamera),!e)return new Jo;const n=new s.Pa4;e.cameraObject.updateWorldMatrix(!0,!1);const i=e.cameraObject.matrixWorld;n.x=i.elements[4],n.y=i.elements[5],n.z=i.elements[6],n.normalize();const o=e.target.clone(),c=e.position.clone(),f=e.cameraObject.parent;f&&(t?c.applyMatrix4(f.matrixWorld):n.transformDirection(f.matrixWorld.clone().invert()));const m=new Jo(c,o,n,t?e.cameraObject.getWorldQuaternion(new s._fP):e.cameraObject.quaternion.clone(),"");return m.focusView=async()=>this.focusView(m),m.deleteView=()=>this.deleteView(m),m}setCurrentCameraView(e){var n;const t=(n=this._viewer)==null?void 0:n.scene.activeCamera;t&&(t.position.copy(e.position),t.target.copy(e.target),t.cameraObject.up.copy(e.up),t.cameraObject.quaternion.copy(e.quaternion),t.positionUpdated())}async focusView(e){return this.animateToView(e)}deleteView(e){var n,i;const t=this._cameraViews.indexOf(e);t>=0&&this._cameraViews.splice(t,1),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n),this.dispatchEvent({type:"viewDelete",view:e})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)==null?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await(0,a.timeout)(100)}async animateToView(e,t,n,i=!1){var w;const o=(w=this._viewer)==null?void 0:w.scene.activeCamera;if(!o)return;if(this._animating){this._popAnimations.forEach(C=>(C==null?void 0:C.stop)&&C.stop()),this._popAnimations=[];let S=0;for(;this._animating&&(await(0,a.timeout)(100),!(S++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration);const c=typeof n=="function"?n:Ul[n||this.animEase],f=this._driver,m=[];this._popAnimations=[];const y=this._popAnimations;if(this.interpolateMode==="spherical")m.push(async function(S,C,O,N,H,q){const J=S.target.clone(),V=new s.Pa4,z=new s.Pa4,ue=S.cameraObject.parent,me=S.cameraObject.up.clone(),Te=km({position:S.cameraObject.getWorldPosition(new s.Pa4),up:ue?me.transformDirection(ue.matrixWorld):me},J),Be=km(C,C.target),He=new s.$V;function tt(){S.position.copy(ue?ue.worldToLocal(z):z),S.target.copy(V),S.positionUpdated()}return If({from:0,to:1,duration:O,ease:N,driver:H,onUpdate:lt=>{He.phi=Pp(Te.phi,Be.phi,lt),He.theta=Pp(Te.theta,Be.theta,lt),He.radius=ce(Te.radius,Be.radius,lt),V.copy(J).lerp(C.target,lt),z.setFromSpherical(He),z.add(V),tt()},onComplete:()=>{z.copy(C.position),V.copy(C.target),tt()},onStop:()=>{throw new Error("Animation Stopped")}},q)}(o,e,t,c,f,y));else if(this.interpolateMode==="linear"){m.push(If({from:o.position.clone(),to:e.position.clone(),duration:t,ease:c,driver:f,onUpdate:O=>o.position=O,onComplete:()=>o.position=e.position,onStop:()=>{throw new Error("Animation stopped")}},y)),m.push(If({from:o.target.clone(),to:e.target.clone(),duration:t,ease:c,driver:f,onUpdate:O=>{o.target=O,o.targetUpdated()},onComplete:()=>{o.target=e.target,o.targetUpdated()}},y));const S=o.cameraObject.quaternion.clone(),C=new s._fP;m.push(If({from:0,to:1,duration:t,ease:c,driver:f,onUpdate:O=>{C.copy(S).slerp(e.quaternion,O),o.cameraObject.quaternion.copy(C),o.cameraObject.updateProjectionMatrix()},onComplete:()=>{o.cameraObject.quaternion.copy(e.quaternion),o.cameraObject.updateProjectionMatrix()}},y))}await Promise.allSettled(m).catch(S=>{if(i)throw S}),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await(0,a.timeout)(10)}fromJSON(e,t){var n,i;return this._cameraViews.forEach(o=>this.deleteView(o)),super.fromJSON(e,t)?(this._cameraViews.forEach(o=>o.focusView=async()=>this.focusView(o)),this._cameraViews.forEach(o=>o.deleteView=()=>this.deleteView(o)),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n),this):null}async animateToObject(e,t=4,n,i,o={min:.5,max:5}){if(!this._viewer)return;const c=new X().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),f=c.getCenter(new s.Pa4),m=c.getSize(new s.Pa4).length()/2;await this.animateToTarget(Math.min(o.max,Math.max(o.min,m*t)),f,n,i)}async animateToFitObject(e,t=1.5,n=1e3,i,o={min:.5,max:50}){if(!this._viewer)return;const c=new X().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),f=c.getCenter(new s.Pa4),m=c.getSize(new s.Pa4);let y=this._viewer.scene.activeCamera.cameraObject,w=1;if(y.isPerspectiveCamera){const S=y.fov*(Math.PI/180),C=2*Math.atan(Math.tan(S/2)*y.aspect),O=m.z/2+Math.abs(m.x/2/Math.tan(C/2)),N=m.z/2+Math.abs(m.y/2/Math.tan(S/2));w=Math.max(O,N)}await this.animateToTarget(Math.min(o.max,Math.max(o.min,w*t)),f,n,i)}async animateToTarget(e,t,n,i){const o=this.getCurrentCameraView();o.target.copy(t);const c=new s.Pa4().subVectors(o.target,o.position).normalize();o.position.copy(c.multiplyScalar(-e).add(o.target)),await this.animateToView(o,n,i)}async _downloadBlob(e,t){var i,o;const n=(i=this._viewer)==null?void 0:i.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}}function km(l,e){const t=l.position.clone();t.sub(e);const n=new s.$V().setFromVector3(t);return n.makeSafe(),n}function Pp(l,e,t){const n=e-l;return n>=Math.PI?l+(n-2*Math.PI)*t:n<=-Math.PI?l+(n+2*Math.PI)*t:l+n*t}function _A(l,e,t){const n=(1-t)*Math.cos(l)+t*Math.cos(e),i=(1-t)*Math.sin(l)+t*Math.sin(e);return Math.atan2(i,n)}ks.PluginType="CameraViews",To([ze("cameraViews")],ks.prototype,"_cameraViews",void 0),To([(0,a.onChange)(ks.prototype._animationLoop),ze(),Yn("Loop All Views",{limitedUi:!0})],ks.prototype,"viewLooping",void 0),To([ze(),Ke("View Pause Time")],ks.prototype,"viewPauseTime",void 0),To([ze(),ct("Ease",Object.keys(Ul).map(l=>({label:l})))],ks.prototype,"animEase",void 0),To([ze(),Pe("Duration",[10,1e4],10,{limitedUi:!0})],ks.prototype,"animDuration",void 0),To([ze(),Pe("RotationOffset",[.2,.75],.01)],ks.prototype,"rotationOffset",void 0),To([ze(),ct("Interpolation",["spherical","linear"].map(l=>({label:l})))],ks.prototype,"interpolateMode",void 0),To([Yn(),ze()],ks.prototype,"seekOnScroll",void 0),To([ht("Animate All Views",{limitedUi:!0})],ks.prototype,"animateAllViews",null),To([ht("Record All Views")],ks.prototype,"recordAllViews",null),To([ht("Add Current View")],ks.prototype,"addCurrentView",null),To([ht("Focus Next")],ks.prototype,"focusNext",void 0),To([ht("Focus Previous")],ks.prototype,"focusPrevious",void 0);const q0=new s.Pa4;function Du(l,e,t){let n=l.dot(e);n=Math.min(Math.max(n,-1),1);const i=Math.acos(n)*t;return q0.copy(l).multiplyScalar(n).sub(e).negate().normalize(),l.multiplyScalar(Math.cos(i)).add(q0.multiplyScalar(Math.sin(i)))}var Xh,Pf=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Od=Xh=class{constructor(l){this.enabled=!1,this.power=.5,this.bgcolor=new s.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new s.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?a.glsl`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=l.getPlugin(Jc),this._setDirty=this._setDirty.bind(this)}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(l,e,t){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._setDirty()}};Od.PluginType="Vignette",Pf([(0,a.onChange)(Xh.prototype._setDirty),Yn("Enable"),ze()],Od.prototype,"enabled",void 0),Pf([(0,a.onChange)(Xh.prototype._setDirty),Pe("Power",[.1,4],.01,{limitedUi:!0}),ze()],Od.prototype,"power",void 0),Pf([(0,a.onChange)(Xh.prototype._setDirty),Lt("Color"),ze()],Od.prototype,"bgcolor",void 0),Od=Xh=Pf([on("Vignette")],Od);class Yh extends Bl{constructor(){super()}generateExtension(e){return new Od(e)}get power(){var e;return((e=this._extension)==null?void 0:e.power)??1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e;return((e=this._extension)==null?void 0:e.bgcolor)??new s.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}Yh.PluginType="Vignette";var tu=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Zl=class extends Ri{constructor(){super(),this.enabled=!0,this.dependencies=[fi],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const l=await(0,a.uploadFile)(!0,!1,"model/gltf");await this.loadScenes(l)}async loadScenes(l){var t,n;const e=await Promise.all(l.map(async i=>await i.arrayBuffer()));for(let i=0;i<l.length;i++){const o=l[i];this.scenes.push({[o.name]:new Uint8Array(e[i])}),this.assets[o.name]={path:o.name,file:o}}(n=(t=this.uiConfig)==null?void 0:t.uiRefresh)==null||n.call(t)}async play(){var i;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const l=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");l==null||l.enabled,l&&(l.enabled=!1);const e=this._viewer.getPluginByType("FrameFade"),t=this._viewer.getPluginByType("GLTFAnimation"),n=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const o of this.scenes){if(!this._isPlaying)break;const c=Object.keys(o);t==null||t.stopAnimation(!1),await(n==null?void 0:n.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const m of c){let y=this.assets[m];y||(y={path:m,file:new File([o[m]],m)},this.assets[m]=y),await((i=this._viewer.getManager())==null?void 0:i.addAssetSingle(y,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,l&&(l.enabled=!1),e&&(e.enabled=!0,await e.startTransition(1e3));const f=[(0,a.timeout)(this.minSceneTime)];t&&f.push(t.playAnimation()),n&&f.push(n.animateAllViews()),await Promise.all(f)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const l={};for(const n of this.scenes)for(const i of Object.keys(n)){const o=l[i]?i+"_":i;l[o]=n[o]}const e=Ku(l),t=new Blob([e],{type:"application/zip"});(0,a.downloadBlob)(t,"scenes.glbloop")}async onAdded(l){var t,n;await super.onAdded(l);const e=this;(n=(t=l.getManager())==null?void 0:t.importer)==null||n.Importers.push(new Js(class extends os{load(i,o,c,f){super.load(i,m=>{e.loadScenes([...m.values()]),o==null||o(null),(0,a.timeout)(100).then(e.play)},c,f)}},["glbloop"],!0))}};Zl.PluginType="SceneLoopPlugin",tu([er("Loaded scenes")],Zl.prototype,"loadedScenes",null),tu([ht("Load Scenes")],Zl.prototype,"promptLoadScenes",null),tu([er("Playing")],Zl.prototype,"_isPlaying",void 0),tu([Ke("Min Scene Time")],Zl.prototype,"minSceneTime",void 0),tu([ht("Play")],Zl.prototype,"play",null),tu([ht("Stop")],Zl.prototype,"stop",null),tu([ht("Download Scenes")],Zl.prototype,"downloadScenes",null),Zl=tu([on("Scene Loop")],Zl);var vl=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Kh=class extends Ks{constructor(l,e,t){super(l,e,t??new Bd,new s.Ilk(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(l,e,t,n,i){if(!this.enabled||!this.camera)return;const o=this.overrideMaterial;o.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(l,e,t,n,i),o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value)}};vl([Yn("Enabled")],Kh.prototype,"enabled",void 0),Kh=vl([on("Velocity Buffer (TAA)")],Kh);class Bd extends s.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new s.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new s.Vkp},currentProjectionViewMatrix:{value:new s.yGw},lastProjectionViewMatrix:{value:new s.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new s.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,i,o){const c=this._previousWorldMatrices[o.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(c??o.matrixWorld),c?c.copy(o.matrixWorld):this._previousWorldMatrices[o.uuid]=o.matrixWorld.clone();let f=o.material;Array.isArray(f)&&(f=f[0]),this.uniforms.alphaMap.value=(f==null?void 0:f.alphaMap)??null,this.uniforms.alphaTest.value=!f||!f.alphaTest||f.alphaTest<1e-7?.001:f.alphaTest;let m=this.uniforms.alphaMap.value?1:void 0;m!==this.defines.USE_ALPHAMAP&&(m===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=m,this.needsUpdate=!0),m=f.userData.ALPHA_I_RGBA_PACKING?1:void 0,m!==this.defines.ALPHA_I_RGBA_PACKING&&(m===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=m,this.needsUpdate=!0),this.side=f.side??s.ehD}}class Um extends br{passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:s.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,i=new Set;return new class extends Kh{render(o,c,f,m,y){var O;if(e.renderer.frameCount>0)return;const w=o.getRenderTarget(),S=o.getActiveCubeFace(),C=o.getActiveMipmapLevel();(O=this.scene)==null||O.traverse(({material:N})=>{N&&((N.transparent&&N.userData.renderToDepth||!N.transparent&&N.transmission===0&&N.userData.renderToDepth===!1)&&(n.add(N),N.transparent=!N.transparent),Math.abs(N.transmission||0)>0&&N.userData.renderToDepth&&(i.add([N,N.transmission]),N.transmission=0))}),_t(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,c,t,m,y)),n.forEach(N=>N.transparent=!N.transparent),n.clear(),i.forEach(([N,H])=>N.transmission=H),i.clear(),o.setRenderTarget(w,S,C)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)==null?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled?((t=this.getVelocityBuffer())==null?void 0:t.texture)??null:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)==null?void 0:e.passObject.uiConfig}}Um.PluginType="VelocityBuffer";var ba,nu=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Pc=ba=class{constructor(l){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){return number%2;}int getLUTIndex(in int number){return number%8;}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._viewer=l,this._combinedPostPlugin=l.getPlugin(Jc),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const l=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let e=l?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,e,this.extraUniforms.lutSize,l),this.extraDefines.USE_LUT=this.lutMap?1:0,e=l?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,e,this.extraUniforms.lutSize1,l),this.extraDefines.USE_LUT1=this.lutMap1?1:0,e=l?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,e,this.extraUniforms.lutSize2,l),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=l,this._setDirty()}_updateLUTMap(l,e,t,n){if(l){let i=1;n==1?(e.value=l.texture3D,i=l.texture3D.image.width):l.texture&&(e.value=l.texture,i=l.texture.image.width),e.value.needsUpdate=!0,t.value=i}}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function $h(l){const e=l==null?void 0:l.userData;if(!e)return!1;e[Co.PluginType]||(e[Co.PluginType]={});const t=e[Co.PluginType];return t.enable=!0,t.index===void 0&&(t.index=0),l.isMaterial&&(l.needsUpdate=!0),!0}nu([ze(),(0,a.onChange)(ba.prototype._updateParams),Yn("Enable")],Pc.prototype,"enabled",void 0),nu([ze(),(0,a.onChange)(ba.prototype._updateParams),Yn("LUT Background")],Pc.prototype,"lutBackground",void 0),nu([ze(),(0,a.onChange)(ba.prototype._updateParams),Pe("Intensity")],Pc.prototype,"intensity",void 0),nu([(0,a.onChange)(ba.prototype._updateParams),dt("LUT"),ze()],Pc.prototype,"lutMap",void 0),nu([(0,a.onChange)(ba.prototype._updateParams),dt("LUT1"),ze()],Pc.prototype,"lutMap1",void 0),nu([(0,a.onChange)(ba.prototype._updateParams),dt("LUT2"),ze()],Pc.prototype,"lutMap2",void 0),Pc=ba=nu([on("LUT")],Pc);class Co extends Bl{_getUiConfig(e){var n,i;const t={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var o;return((o=e.materialObject.userData[Co.PluginType])==null?void 0:o.enable)??!0},set value(o){var f;const c=e.materialObject.userData[Co.PluginType];o!==(c==null?void 0:c.enable)&&(c||$h(e.materialObject),e.materialObject.userData[Co.PluginType].enable=o,(f=t.uiRefresh)==null||f.call(t,"postFrame",!0))},onChange:(n=this._extension)==null?void 0:n.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(o=>({label:o[0],value:o[1]})),label:"index",hidden:()=>{const o=e.materialObject.userData[Co.PluginType];return!!o&&!o.enable},get value(){var o;return((o=e.materialObject.userData[Co.PluginType])==null?void 0:o.index)??0},set value(o){var c;e.materialObject.userData[Co.PluginType]||$h(e.materialObject),e.materialObject.userData[Co.PluginType].index=o,(c=t.uiRefresh)==null||c.call(t,"postFrame",!0)},onChange:(i=this._extension)==null?void 0:i.setDirty}]};return t}constructor(){super(),this.materialExtension={uuid:ji(),getUiConfig:e=>{if(e.__uiConfigs||(e.__uiConfigs={}),e.__uiConfigs[this.materialExtension.uuid])return e.__uiConfigs[this.materialExtension.uuid];const t=this._getUiConfig(e);return e.__uiConfigs[this.materialExtension.uuid]=t,t},computeCacheKey:e=>{var t;return(this.enabled?"1":"0")+((t=e.materialObject.userData[Co.PluginType])!=null&&t.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var n,i;await super.onAdded(e),(n=e.getPlugin(vr))==null||n.registerGBufferUpdater(this.updateGBuffer);const t=e.getPlugin(fi);(i=t==null?void 0:t.materials)==null||i.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new Pc(e)}updateGBuffer(e,t){var n,i;if(e instanceof s.Kj0&&((n=e.material)!=null&&n.userData)){const o=(i=e.material)==null?void 0:i.userData[Co.PluginType];if(o){const c=o.enable===!1?0:1;t.w=Yl(t.w,0,c);for(let m=0;m<3;m++)t.y=af(t.y,m);let f=o.enable?o.index:0;f=Math.min(f,7),t.y=t.y|f}else t.w=Yl(t.w,0,1)}}}Co.PluginType="LUTPlugin1";class iu{constructor(e){this._zee=new s.Pa4(0,0,1),this._euler=new s.USm,this._q0=new s._fP,this._q1=new s._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new s._fP,this._initQuaternionDest=new s._fP,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=t=>{this.deviceOrientation=t},this._isConnected=!1,this._viewer=e}getOffsetFromCenter(e=!0){if(!this.deviceOrientation)return new s.FM8;this.getQuaternion(e,this._q2);const t=new s.Pa4(0,0,1);return t.applyQuaternion(this._q2),new s.FM8(t.x,t.y)}getQuaternion(e,t){if(t||(t=new s._fP),!this.deviceOrientation)return t.identity();const n=this.deviceOrientation,i=n.alpha!==null?s.M8C.degToRad(n.alpha):0,o=n.beta!==null?s.M8C.degToRad(n.beta):0,c=n.gamma!==null?s.M8C.degToRad(n.gamma):0,f=this.screenOrientation?s.M8C.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(t,i,o,c,f,e),t}_toQuaternion(e,t,n,i,o,c){this._euler.set(n,t,-i,"YXZ"),e.setFromEuler(this._euler),e.multiply(this._q1);const f=document.getElementById("debug");return f&&(f.textContent=o+""),e.multiply(this._q0.setFromAxisAngle(this._zee,-o)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(e).invert(),this._initQuaternionDest.__init=!0),c&&e.premultiply(this._initQuaternionDest),e}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var e;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(e=this._viewer)==null||e.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(e=>{e=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(e=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",e)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new s._fP)}}class Dp{constructor(){this._mousePos=new s.FM8(0,0),this._isConnected=!1}getOffsetFromCenter(){return new s.FM8(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(e){this._mousePos.set(e.clientX,e.clientY)}}var Ld,ec=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Fl=Ld=class extends Ri{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new s.Pa4(0,0,0),this.damping=.5,this.cameraView="",this._target=new s.Pa4,this._center=new s.Pa4,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var f,m;if(!this.enabled)return void((m=(f=this._object)._updateProjectionMatrixParallax)==null?void 0:m.call(f));const l=this._object,e=l.near;let t=e*Math.tan(.5*s.M8C.DEG2RAD*l.fov)/l.zoom,n=2*t,i=l.aspect*n,o=-.5*i;if(l.view!==null&&l.view.enabled){const y=l.view.fullWidth,w=l.view.fullHeight;o+=l.view.offsetX*i/y,t-=l.view.offsetY*n/w,i*=l.view.width/y,n*=l.view.height/w}o-=this._offX*e/this._focalDistance,t-=this._offY*e/this._focalDistance;const c=l.filmOffset;c!==0&&(o+=e*c/l.getFilmWidth()),l.projectionMatrix.makePerspective(o,o+i,t,t-n,e,l.far),l.projectionMatrixInverse.copy(l.projectionMatrix).invert()},this._preFrame=l=>{this.update(l.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new a.Damper,this._yDamper=new a.Damper,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(l){var e,t,n;await super.onAdded(l),iu.IsCompatible()?this._input=new iu(l):this._input=new Dp,l.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),l.addEventListener("preFrame",this._preFrame),(e=this._viewer)==null||e.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(t=this._viewer)==null||t.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(n=l.getPluginByType("Picking"))==null||n.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var l,e,t,n;this._object&&((l=this._object)!=null&&l._updateProjectionMatrixParallax)&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(e=this._viewer)==null?void 0:e.scene.activeCamera.cameraObject,(t=this._object)!=null&&t.isOrthographicCamera?(n=this._viewer)==null||n.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var l;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(l=this._viewer)==null||l.container.appendChild(this._indicator))}onPointerDown(l){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=l.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=l.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(l){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.interactionsEnabled=!1,this._updateFocalDistance();const e=this._object.matrixWorld.elements,t=new s.Pa4(e[0],e[1],e[2]),n=new s.Pa4(e[4],e[5],e[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let i=this.sensitivity;this.invert&&(i*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*i,l,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*i,l,1);const o=this._object;o.position.add(n.multiplyScalar(this._offY)).add(t.multiplyScalar(this._offX)),o.updateProjectionMatrix(),o.updateMatrixWorld(),this._dirty=!0}_onObjectHit(l){var e,t;l.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(l.intersects.intersect.point),l.intersects.selectedObject=null,(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var n,i;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(i=(n=this.uiConfig)==null?void 0:n.uiRefresh)==null||i.call(n,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const l=this._object,e=new s.Pa4;l.getWorldDirection(e),e.normalize(),this._focalDistance=this.focalPointHit.clone().sub(l.position).dot(e)}_onEnabledChange(){var l,e,t;if(this._viewer){if(this.enabled){if((l=this._input)==null||l.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.interactionsEnabled=!1;const n=this._viewer.getPluginByType("CameraViews"),i=n==null?void 0:n.camViews.find(o=>o.name===this.cameraView);n&&i&&n.setCurrentCameraView(i),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const n=this._object;n.updateProjectionMatrix(),n.updateMatrixWorld()}(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var l;(l=this._input)==null||l.disconnect()}};Fl.PluginType="ParallaxCameraControllerPlugin",ec([(0,a.onChange)(Ld.prototype._onEnabledChange),ze(),Yn("Enabled")],Fl.prototype,"enabled",void 0),ec([ze(),Yn("enableEdit")],Fl.prototype,"enableEdit",void 0),ec([ze(),Yn("Invert")],Fl.prototype,"invert",void 0),ec([ze(),Pe("Sensitivity",[.1,2],.01)],Fl.prototype,"sensitivity",void 0),ec([ze("focalPoint"),Le("Focal Point Hit",void 0,.001)],Fl.prototype,"focalPointHit",void 0),ec([(0,a.onChange)(Ld.prototype._onDampingChange),ze(),Pe("Damping",[0,1],.001)],Fl.prototype,"damping",void 0),ec([ze(),Ke("Camera View")],Fl.prototype,"cameraView",void 0),Fl=Ld=ec([on("Parallax Camera Controller")],Fl);var Jh=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let yl=class extends Ri{addNoiseBumpMaterial(l){return Gv(l.materialObject)}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new tc(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this._uniforms={noiseBumpParams:{value:new s.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new s.Ltg(0,1,3,0)},flakeFallOffParams:{value:new s.Pa4(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(l,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)!=null&&t.hasBump)?Ju+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(l,e,t)=>{var i;if(!this.enabled||!((i=e.materialObject.userData._noiseBumpMat)!=null&&i.hasBump))return;const n="#glMarker beforeAccumulation";l.fragmentShader=l.fragmentShader.replace(n,`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif

`+n),l.defines.USE_UV="",l.extensionDerivatives=!0},onObjectRender:(l,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._noiseBumpMat;if(!(t!=null&&t.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(t.bumpNoiseParams),this._uniforms.noiseBumpScale.value=t.bumpScale,this._uniforms.noiseBumpFlakeScale.value=t.flakeScale,this._uniforms.noiseFlakeClamp.value=t.flakeClamp,this._uniforms.noiseFlakeRadius.value=t.flakeRadius,t.flakeParams&&this._uniforms.flakeParams.value.copy(t.flakeParams),t.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(t.flakeFallOffParams),this._uniforms.useColorFlakes.value=t.useColorFlakes;const n=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==n&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t;return(this.enabled?"1":"0")+((t=(e=l.materialObject.userData)==null?void 0:e._noiseBumpMat)!=null&&t.hasBump?"1":"0")},isCompatible:l=>l.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:l=>{const e=this._viewer,t={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.hasBump)||!1},set value(n){var i,o;n!==((i=l.materialObject.userData._noiseBumpMat)==null?void 0:i.hasBump)&&(n?Gv(l.materialObject)||e.alert("Cannot add noise bump."):l.materialObject.userData._noiseBumpMat&&(l.materialObject.userData._noiseBumpMat.hasBump=!1,l.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var n;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"z"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeParams,"w"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var n;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var i;return!((i=l.materialObject.userData._noiseBumpMat)!=null&&i.hasBump)},property:[(n=l.materialObject.userData._noiseBumpMat)==null?void 0:n.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var n;return!((n=l.materialObject.userData._noiseBumpMat)!=null&&n.hasBump)},property:[l.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(Nd)}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};function Gv(l){const e=l==null?void 0:l.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.useColorFlakes===void 0&&(t.useColorFlakes=!1),t.flakeParams===void 0&&(t.flakeParams=new s.Ltg(0,1,3,0)),t.flakeFallOffParams===void 0&&(t.flakeFallOffParams=new s.Pa4(0,1,0)),l.isMaterial&&(l.needsUpdate=!0),!0}yl.PluginType="NoiseBumpMaterialPlugin",yl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",Jh([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],yl.prototype,"enabled",void 0),yl=Jh([on("NoiseBumpMaterial Materials")],yl);class tc{constructor(e){this.parser=e,this.name=yl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Gv(t),t.userData._noiseBumpMat=Mi(i,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Nd=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=di(e.userData._noiseBumpMat,!1);t.extensions[yl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,l.extensionsUsed[yl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});class Rb extends Ms{constructor(e,t){super({vertexShader:v.vertexShader,fragmentShader:t+`
`+Hg+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new s.FM8},cameraNearFar:{value:new s.FM8},lastProjectionViewMatrix:{value:new s.yGw},currentProjectionViewMatrix:{value:new s.yGw},projection:{value:new s.yGw},inverseViewMatrix:{value:new s.yGw},jitterSample:{value:new s.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new s.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,i,o){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const c=this.uniforms.tVelocity.value?1:0;c!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=c,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,i,o),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)})([ze(),Ne()],Rb.prototype,"feedBack",void 0);class Dc extends br{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[vr],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(e){if(!e.getPlugin(to))throw"Add ProgressivePlugin before TAA";const t=new Rb(e.getPlugin(to).lastFrame,e.getPlugin(vr).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<=1,!n.taaEnabled)return!1;const i=e.scene.activeCamera;return n.updateShaderProperties([e.getPlugin(vr),i,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(to).lastFrame,n.updateCameraProperties(i==null?void 0:i.cameraObject),!0}async onAdded(e){await super.onAdded(e),this.stableNoise=this._stableNoise}get stableNoise(){var e;return((e=this._viewer)==null?void 0:e.renderer.stableNoise)??this._stableNoise}set stableNoise(e){this._viewer&&(this._viewer.renderer.stableNoise=e),this._stableNoise=e}get uiConfig(){var t;const e=(t=this.pass)==null?void 0:t.passObject.uiConfig;if(e&&e.children)return e.children.includes(this._stableNoiseConfig)||e.children.push(this._stableNoiseConfig),e}}Dc.PluginType="TAA";var Hv=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let ru=class extends Ri{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=l=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)==null?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(l){var t;if(this.isFullScreen())return;const e=l||((t=this._viewer)==null?void 0:t.canvas);return e?(this._lastFsElement=e,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[e.style.width,e.style.height],e.style.width="100%",e.style.height="100%",e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(l){return this.isFullScreen()?this.exit():this.enter(l)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};ru.PluginType="FullScreenPlugin",Hv([ht("Enter FullScreen")],ru.prototype,"enter",null),Hv([ht("Exit FullScreen")],ru.prototype,"exit",null),Hv([ht("Toggle FullScreen")],ru.prototype,"toggle",null),ru=Hv([on("Full Screen")],ru);const Fm=(l,e)=>{const t={};for(const n of l.mappings)for(const i of n.variants)t[e[i]]={material:null,gltfMaterialIndex:n.material};return t},zm="KHR_materials_variants";class vA{constructor(e){this.parser=e,this.name=zm}async afterRoot(e){const t=this.parser,n=t.json;if(!n.extensions||!n.extensions[this.name])return;const i=(o=>{const c=[],f=new Set;for(const m of o){let y=m,w=0;for(;f.has(y);)y=m+"."+ ++w;f.add(y),c.push(y)}return c})((n.extensions[this.name].variants||[]).map(o=>o.name));for(const o of e.scenes)o.traverse(c=>{const f=t.associations.get(c);if(!f||f.meshes===void 0||f.primitives===void 0)return;const m=n.meshes[f.meshes].primitives[f.primitives].extensions;m&&m[this.name]&&(c.userData._variantMaterials=Fm(m[this.name],i))});await Promise.all(e.scenes.map(async o=>{const c=[];return o.traverse(f=>{return(m=f).material!==void 0&&m.userData&&m.userData._variantMaterials&&c.push((async y=>{const w=y.material,S=y.userData._variantMaterials,C=[];for(const O in S){const N=S[O];if(N.material)continue;const H=N.gltfMaterialIndex;C.push(t.getDependency("material",H).then(q=>{y.material=q,t.assignFinalMaterial(y),S[O].material=y.material}))}return Promise.all(C).then(()=>{y.material=w})})(f));var m}),o.userData.__importData||(o.userData.__importData={}),o.userData.__importData[zm]={names:i},Promise.all(c)}))}}const Wv=l=>l.material!==void 0&&l.userData&&l.userData._variantMaterials&&!!Object.values(l.userData._variantMaterials).filter(e=>Ou(e==null?void 0:e.material)),Ou=l=>l&&l.isMaterial&&!Array.isArray(l);class X0{constructor(e){this.writer=e,this.name=zm,this.variantNames=[]}beforeParse(e){const t=new Set;for(const n of e)n.traverse(i=>{if(!Wv(i))return;const o=i.userData._variantMaterials;for(const c in o){const f=o[c];Ou(f.material)&&t.add(c)}});t.forEach(n=>this.variantNames.push(n))}writeMesh(e,t){if(!Wv(e))return;const n=e.userData,i=n._variantMaterials,o={};for(const m in i){const y=i[m].material;if(!Ou(y))continue;const w=this.variantNames.indexOf(m),S=this.writer.processMaterial(y);o[S]||(o[S]={material:S,variants:[]}),o[S].variants.push(w)}const c=Object.values(o).map(m=>m.variants.sort((y,w)=>y-w)&&m).sort((m,y)=>m.material-y.material);if(c.length===0)return;const f=Ou(n._originalMaterial)?this.writer.processMaterial(n._originalMaterial)??-1:-1;for(const m of t.primitives)f>=0&&(m.material=f),m.extensions=m.extensions||{},m.extensions[this.name]={mappings:c}}afterParse(e){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const n=this.variantNames.map(i=>({name:i}));t.extensions[this.name]={variants:n},this.writer.extensionsUsed[this.name]=!0}}function d_(l){return new X0(l)}class Bu extends Ri{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[fi],this.variants={},this.selectedVariant="",this._objectAdded=e=>{var n,i;const t=e.object;(t==null?void 0:t.assetType)==="model"&&t.modelObject&&this._viewer&&(t.modelObject.traverse(o=>{var m,y,w,S,C;if(o.userData._variantMaterials)for(const O of Object.values(o.userData._variantMaterials))O!=null&&O.material&&(O.material=((w=(y=(m=this._viewer)==null?void 0:m.getManager())==null?void 0:y.materials)==null?void 0:w.processMaterial(O.material,{}))||O.material);const c=(C=(S=o.userData)==null?void 0:S.__importData)==null?void 0:C[zm];if(!c)return;const f=c.names||[];for(const O of f)this.variants[O]||(this.variants[O]=[]),this.variants[O].push(o);delete o.userData.__importData[zm]}),(i=(n=this.uiConfig).uiRefresh)==null||i.call(n))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(e=>e?{label:e}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(e){var n,i,o,c;await super.onAdded(e),e.scene.addEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(fi);(n=t==null?void 0:t.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=t==null?void 0:t.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(d_)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new vA(t))}async onRemove(e){var i,o,c,f,m,y;e.scene.removeEventListener("addSceneObject",this._objectAdded);const t=e.getPlugin(fi);(i=t.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate);const n=(f=(c=(o=t.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null?void 0:f.indexOf(d_);return n!==void 0&&n!==-1&&((y=(m=t.exporter.getExporter("gltf","glb"))==null?void 0:m.extensions)==null||y.splice(n,1)),this.variants={},super.onRemove(e)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(e,t=!1,n,i=!0){if(!t&&!n&&this.selectedVariant===e||!e)return;n||(this.selectedVariant=e);const o=n?Array.isArray(n)?n:[n]:e?this.variants[e]||[]:Object.values(this.variants).flat();for(const c of o){const f=new Set,m=y=>{var S,C;if(!y.userData._variantMaterials||f.has(y))return;const w=e?(S=y.userData._variantMaterials[e])==null?void 0:S.material:y.userData._originalMaterial;w&&(y.userData._originalMaterial||(y.userData._originalMaterial=y.material),(C=y==null?void 0:y.setMaterial)==null||C.call(y,w)),f.add(y)};i?c.traverse(m):m(c)}}}Bu.PluginType="GLTFKHRMaterialVariantsPlugin",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([(0,a.onChange)(Bu.prototype._variantChanged)],Bu.prototype,"selectedVariant",void 0);function Qv(l){const e=l==null?void 0:l.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),l.isMaterial&&(l.needsUpdate=!0),!0}let jm=class extends Ms{constructor(l,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new s.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new s.Pa4(1,1,1)}},vertexShader:eu,fragmentShader:`

            ${t}

            ${Ju}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(i,o,c)=>{var f,m;this.enabled&&((m=(f=o.materialObject.userData)==null?void 0:f._ssBevel)!=null&&m.hasSSBevel)&&(i.fragmentShader=ni(i.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(i,o,c)=>{var y,w;if(!this.enabled||!((w=(y=o.materialObject.userData)==null?void 0:y._ssBevel)!=null&&w.hasSSBevel))return;const f=o.materialObject,m=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==m&&(this.materialExtension.extraUniforms.tSSBevelMap.value=m,f.needsUpdate=!0)},getUiConfig:i=>{const o={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var c;return((c=i.materialObject.userData._ssBevel)==null?void 0:c.hasSSBevel)||!1},set value(c){var f,m;c!==((f=i.materialObject.userData._ssBevel)==null?void 0:f.hasSSBevel)&&(c?Qv(i.materialObject)||alert("Cannot add screen space bevel."):i.materialObject.userData._ssBevel&&(i.materialObject.userData._ssBevel.hasSSBevel=!1,i.materialObject.needsUpdate=!0),(m=o.uiRefresh)==null||m.call(o,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var c;return!((c=i.materialObject.userData._ssBevel)!=null&&c.hasSSBevel)},property:[i.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return o},parsFragmentSnippet:(i,o)=>{var c,f;return this.enabled&&((f=(c=o==null?void 0:o.materialObject.userData)==null?void 0:c._ssBevel)!=null&&f.hasSSBevel)?a.glsl`
            uniform sampler2D tSSBevelMap;
            ${sm}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:i=>{var o,c;return(this.enabled?"1":"0")+((c=(o=i.materialObject.userData)==null?void 0:o._ssBevel)!=null&&c.hasSSBevel?"1":"0")},isCompatible:i=>i.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new Ar({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new s.FM8(1,1)},cameraPositionWorld:{value:new s.Pa4(1,1,1)}},vertexShader:eu,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new Ar({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new s.FM8(.5,.5)},direction:{value:new s.FM8(.5,.5)}},vertexShader:eu,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(l,e,t,n,i){var m,y;if(!this.enabled)return;const o=l.baseRenderer,c={minFilter:s.wem,magFilter:s.wem,isAntialiased:!1,format:s.wk1,depthBuffer:!1,generateMipmaps:!1},f=o.getTempTarget(c);this._renderEdges(o,f),this._blurEdges(o,f),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(m=this._viewerApp.getPlugin(vr))==null||m.updateShaderProperties(this.material),(y=this._viewerApp.getPlugin(Uh))==null||y.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=f.texture,super.render(l,this._target,f,n,i),o.releaseTempTarget(f)}_initsamples(){const l=[];return l.push(new s.FM8(-8,0).multiplyScalar(.125)),l.push(new s.FM8(-6,-4).multiplyScalar(.125)),l.push(new s.FM8(-3,-2).multiplyScalar(.125)),l.push(new s.FM8(-2,-6).multiplyScalar(.125)),l.push(new s.FM8(1,-1).multiplyScalar(.125)),l.push(new s.FM8(2,-5).multiplyScalar(.125)),l.push(new s.FM8(6,-7).multiplyScalar(.125)),l.push(new s.FM8(5,-3).multiplyScalar(.125)),l.push(new s.FM8(4,1).multiplyScalar(.125)),l.push(new s.FM8(7,4).multiplyScalar(.125)),l.push(new s.FM8(3,5).multiplyScalar(.125)),l.push(new s.FM8(0,7).multiplyScalar(.125)),l.push(new s.FM8(-1,3).multiplyScalar(.125)),l.push(new s.FM8(-4,6).multiplyScalar(.125)),l.push(new s.FM8(-7,8).multiplyScalar(.125)),l.push(new s.FM8(-5,2).multiplyScalar(.125)),l}_blurEdges(l,e){var c,f;const t={minFilter:s.wem,magFilter:s.wem,isAntialiased:!1,format:s.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},n=l.getTempTarget(t),i=((c=e.texture.image)==null?void 0:c.width)||1,o=((f=e.texture.image)==null?void 0:f.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new s.FM8(i,o),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new s.FM8(1,0),l.blit(void 0,n,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new s.FM8(i/2,o/2),this._separableBlurMaterial.uniforms.colorTexture.value=n.texture,this._separableBlurMaterial.uniforms.direction.value=new s.FM8(0,1),l.blit(void 0,e,{material:this._separableBlurMaterial}),l.releaseTempTarget(n)}_renderEdges(l,e){var i,o,c,f;const t=((i=e.texture.image)==null?void 0:i.width)||1,n=((o=e.texture.image)==null?void 0:o.height)||1;this._edgeMaterial.uniforms.screenSize.value=new s.FM8(t,n),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(c=this._viewerApp.getPlugin(vr))==null||c.updateShaderProperties(this._edgeMaterial),(f=this._viewerApp.getPlugin(Uh))==null||f.updateShaderProperties(this._edgeMaterial),l.blit(void 0,e,{material:this._edgeMaterial})}};jm=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("SSBevel")],jm);class Lu extends br{get bevelTarget(){return this._bevelTarget}constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[fi,vr,Uh],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new yA(t))}passCtor(e){var n;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:s.cLu,minFilter:s.TyD,magFilter:s.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const t=e.getPluginByType("debug");return t&&t.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new jm(e.renderer,this._bevelTarget,((n=e.getPlugin(vr))==null?void 0:n.getUnpackSnippet())??"",e)}async onAdded(e){var n,i,o,c,f,m,y,w;await super.onAdded(e);const t=e.getPlugin(fi);return(n=this.pass)!=null&&n.passObject.materialExtension&&((o=t==null?void 0:t.materials)==null||o.registerMaterialExtension((i=this.pass)==null?void 0:i.passObject.materialExtension)),(c=t==null?void 0:t.importer)==null||c.addEventListener("loaderCreate",this._loaderCreate),(y=(m=(f=t==null?void 0:t.exporter)==null?void 0:f.getExporter("gltf","glb"))==null?void 0:m.extensions)==null||y.push(Y0),(w=e.getPlugin(vr))==null||w.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,i;(e=this._viewer)==null||e.setDirty(),(i=(t=this.pass)==null?void 0:(n=t.passObject.materialExtension).setDirty)==null||i.call(n)}_update(e){var n,i;let t=this.enabled;if(t&&!this._lastEnabled){const o=(n=this._viewer)==null?void 0:n.getPluginByType("NormalBufferPlugin");o&&!o.enabled&&(o.enabled=!0),o||((i=this._viewer)==null||i.console.error("SSBevelPlugin needs NormalBufferPlugin"))}return this._lastEnabled=t,t}get uiConfig(){var t,n,i,o;const e=((n=(t=this.pass)==null?void 0:t.passObject)==null?void 0:n.uiConfig)??{};return(o=(i=e.children)==null?void 0:i.map(c=>(0,a.getOrCall)(c)))==null||o.flat(2).forEach(c=>c&&(c.onChange=this.setDirty)),e}updateGBuffer(e,t){var n,i,o;if(e instanceof s.Kj0&&((n=e.material)!=null&&n.userData)){for(let f=3;f<8;f++)t.y=af(t.y,f);let c=(i=e.material)!=null&&i.userData._ssBevel?(o=e.material)==null?void 0:o.userData._ssBevel.radius:0;c=Math.min(c,31),c<<=3,t.y=t.y|c}}}Lu.PluginType="SSBevelPlugin",Lu.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class yA{constructor(e){this.parser=e,this.name=Lu.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),Qv(t),t.userData._ssBevel=Mi(i,t.userData._ssBevel,!1,{}),Promise.resolve()}}const Y0=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=di(e.userData._ssBevel,!1);t.extensions[Lu.SSBEVEL_GLTF_EXTENSION]=n,l.extensionsUsed[Lu.SSBEVEL_GLTF_EXTENSION]=!0}});class Vm{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=ni(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class p_ extends Bl{generateExtension(e){return new Vm}}p_.PluginType="GammaCorrection";var AA=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Nu=class extends Ri{addTriplanarMapping(l){var t;const e=(t=l.materialObject)==null?void 0:t.userData;return!!e&&(e._triplanarMapping||(e._triplanarMapping={}),e._triplanarMapping.enable=!0,e._triplanarMapping.scaleFactor===void 0&&(e._triplanarMapping.scaleFactor=1),e._triplanarMapping.blendFactor===void 0&&(e._triplanarMapping.blendFactor=1),e._triplanarMapping.offsetFactor===void 0&&(e._triplanarMapping.offsetFactor=0),l.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new f_(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(l,e,t)=>{var m,y;if(!this.enabled||!((y=(m=e.materialObject.userData)==null?void 0:m._triplanarMapping)!=null&&y.enable))return;const n=a.glsl`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;l.vertexShader=ni(l.vertexShader,"#include <common>",n,{prepend:!0});const i=a.glsl`
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz;
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;l.vertexShader=ni(l.vertexShader,"#include <worldpos_vertex>",i,{append:!0});const o=a.glsl`
                ${"struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}"}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;l.fragmentShader=ni(l.fragmentShader,"#include <common>",o,{prepend:!0});const c=a.glsl`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;l.fragmentShader=ni(l.fragmentShader,"#include <bumpmap_pars_fragment>",c);let f=ni(s.WdD.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");l.fragmentShader=ni(l.fragmentShader,"#include <map_fragment>",f),f=ni(s.WdD.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),l.fragmentShader=ni(l.fragmentShader,"#include <roughnessmap_fragment>",f),f=ni(s.WdD.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),l.fragmentShader=ni(l.fragmentShader,"#include <metalnessmap_fragment>",f),f=ni(s.WdD.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),l.fragmentShader=ni(l.fragmentShader,"#include <normal_fragment_maps>",f),l.defines.USE_UV=""},onObjectRender:(l,e)=>{var i,o,c,f;const t=e.materialObject.userData;if(!((i=t==null?void 0:t._triplanarMapping)!=null&&i.enable))return;const n=l;n.isMesh&&n.geometry&&(this._uniforms.triplanarScale.value=(o=t._triplanarMapping)==null?void 0:o.scaleFactor,this._uniforms.triplanarBlend.value=(c=t._triplanarMapping)==null?void 0:c.blendFactor,this._uniforms.triplanarOffset.value=(f=t._triplanarMapping)==null?void 0:f.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t;return(this.enabled?"1":"0")+((t=(e=l.materialObject.userData)==null?void 0:e._triplanarMapping)!=null&&t.enable?"1":"0")},isCompatible:l=>l.isMeshStandardMaterial2,updaters:()=>{var l;return[(l=this._viewer)==null?void 0:l.renderer]},getUiConfig:l=>{const e=this._viewer,t=this.addTriplanarMapping,n={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var i;return((i=l.materialObject.userData._triplanarMapping)==null?void 0:i.enable)||!1},set value(i){var o,c;i!==((o=l.materialObject.userData._triplanarMapping)==null?void 0:o.enable)&&(i?t(l)||e.alert("Cannot add Triplanar mapping."):l.materialObject.userData._triplanarMapping&&(l.materialObject.userData._triplanarMapping.enable=!1,l.materialObject.needsUpdate=!0),(c=n.uiRefresh)==null||c.call(n,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var i;return!((i=l.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[l.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var i;return!((i=l.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[l.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var i;return!((i=l.materialObject.userData._triplanarMapping)!=null&&i.enable)},property:[l.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return n}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(Oc)}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};Nu.PluginType="TriplanarUVMappingPlugin",Nu.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",AA([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],Nu.prototype,"enabled",void 0),Nu=AA([on("Triplanar Mapping")],Nu);class f_{constructor(e){this.parser=e,this.name=Nu.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];t.userData||(t.userData={});const o=t.userData;return o._triplanarMapping||(o._triplanarMapping={}),o._triplanarMapping.enable=!0,o._triplanarMapping.scaleFactor===void 0&&(o._triplanarMapping.scaleFactor=1),o._triplanarMapping.blendFactor===void 0&&(o._triplanarMapping.blendFactor=1),o._triplanarMapping.offsetFactor===void 0&&(o._triplanarMapping.offsetFactor=0),t.userData._triplanarMapping=Mi(i,t.userData._triplanarMapping,!1,{}),Promise.resolve()}}const Oc=l=>({writeMaterial:(e,t)=>{var i;if(!e.isMeshStandardMaterial||!((i=e.userData._triplanarMapping)!=null&&i.enable))return;t.extensions=t.extensions||{};const n=di(e.userData._triplanarMapping,!1);t.extensions[Nu.TRIPLANAR_GLTF_EXTENSION]=n,l.extensionsUsed[Nu.TRIPLANAR_GLTF_EXTENSION]=!0}});var su=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let zl=class extends Ri{addClearcoatTint(l){return ka(l.materialObject)}_loaderCreate({loader:l}){l.isGLTFLoader2&&l.register(e=>new Zo(e))}constructor(){super(),this.enabled=!0,this.dependencies=[fi],this._defines={},this._uniforms={ccTintColor:{value:new pt},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(l,e)=>{var t;return this.enabled&&((t=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(l,e,t)=>{var o;if(!(this.enabled&&((o=e==null?void 0:e.materialObject.userData._clearcoatTint)!=null&&o.enableTint)&&e.materialObject.clearcoat>0))return;const n="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",i="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";l.fragmentShader.includes(i)&&l.fragmentShader.includes(n)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),l.fragmentShader=l.fragmentShader.replace(i,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),l.fragmentShader=l.fragmentShader.replace(n,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+n),l.defines.USE_UV=""},onObjectRender:(l,e)=>{var i;const t=(i=e.materialObject.userData)==null?void 0:i._clearcoatTint;if(!(t!=null&&t.enableTint))return;this._uniforms.ccTintColor.value.set(t.tintColor),this._uniforms.ccThickness.value=t.thickness,this._uniforms.ccIor.value=t.ior;const n=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==n&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=n,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:l=>{var e,t;return(this.enabled?"1":"0")+((t=(e=l.materialObject.userData)==null?void 0:e._clearcoatTint)!=null&&t.enableTint?"1":"0")+(l.materialObject.clearcoat>0?"1":"0")},isCompatible:l=>l.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:l=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=l.materialObject.userData._clearcoatTint)==null?void 0:n.enableTint)||!1},set value(n){var i,o;n!==((i=l.materialObject.userData._clearcoatTint)==null?void 0:i.enableTint)&&(n?ka(l.materialObject)||e.alert("Cannot add clearcoat tint."):l.materialObject.userData._clearcoatTint&&(l.materialObject.userData._clearcoatTint.enableTint=!1,l.materialObject.needsUpdate=!0),(o=t.uiRefresh)==null||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!((n=l.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[l.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!((n=l.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[l.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!((n=l.materialObject.userData._clearcoatTint)!=null&&n.enableTint)},property:[l.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var l,e,t;(e=(l=this.materialExtension).setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(l){var t,n,i,o,c;await super.onAdded(l);const e=l.getPlugin(fi);(t=e==null?void 0:e.materials)==null||t.registerMaterialExtension(this.materialExtension),(n=e==null?void 0:e.importer)==null||n.addEventListener("loaderCreate",this._loaderCreate),(c=(o=(i=e==null?void 0:e.exporter)==null?void 0:i.getExporter("gltf","glb"))==null?void 0:o.extensions)==null||c.push(Op)}async onRemove(l){var e,t,n,i;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this.materialExtension),(i=(n=l.getPlugin(fi))==null?void 0:n.importer)==null||i.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(l)}};function ka(l){const e=l==null?void 0:l.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),l.isMaterial&&(l.needsUpdate=!0),!0}zl.PluginType="ClearcoatTintPlugin",zl.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",su([Yn("Enabled",l=>({onChange:l.setDirty})),ze()],zl.prototype,"enabled",void 0),zl=su([on("ClearcoatTint Materials")],zl);class Zo{constructor(e){this.parser=e,this.name=zl.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.userData||(t.userData={}),ka(t),Mi(i,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const Op=l=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=di(e.userData._clearcoatTint,!1);t.extensions[zl.CLEARCOAT_TINT_GLTF_EXTENSION]=n,l.extensionsUsed[zl.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class qv{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:i,msg:o,transfer:c}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(o,c)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class zs{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Gm{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const Al=[171,75,84,88,32,50,48,187,13,10,26,10];function bA(l){return typeof TextDecoder<"u"?new TextDecoder().decode(l):Buffer.from(l).toString("utf8")}let m_,ou,Bc;const Hm={env:{emscripten_notify_memory_growth:function(l){Bc=new Uint8Array(ou.exports.memory.buffer)}}};class Xv{init(){return m_||(m_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+K0).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Hm)).then(this._init):WebAssembly.instantiate(Buffer.from(K0,"base64"),Hm).then(this._init),m_)}_init(e){ou=e.instance,Hm.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!ou)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=ou.exports.malloc(n);Bc.set(e,i),t=t||Number(ou.exports.ZSTD_findDecompressedSize(i,n));const o=ou.exports.malloc(t),c=ou.exports.ZSTD_decompress(o,t,i,n),f=Bc.slice(o,o+c);return ou.exports.free(i),ou.exports.free(o),f}}const K0="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Yv=new WeakMap;let Kv,$v=0;class ah extends s.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new qv,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new s.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new s.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([o,c])=>{const f=ah.BasisWorker,m=["/* constants */","let _EngineFormat = "+JSON.stringify(ah.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ah.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ah.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([m])),this.transcoderBinary=c,this.workerPool.setWorkerCreator(()=>{const y=new Worker(this.workerSourceURL),w=this.transcoderBinary.slice(0);return y.postMessage({type:"init",config:this.workerConfig,transcoderBinary:w},[w]),y})}),$v>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),$v++}return this.transcoderPending}load(e,t,n,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new s.hH6(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,c=>{if(Yv.has(c))return Yv.get(c).promise.then(t).catch(i);this.createTexture(c).then(f=>t?t(f):null).catch(i)},n,i)}_createTextureFrom(e,t){const{mipmaps:n,width:i,height:o,format:c,type:f,error:m,dfdTransferFn:y,dfdFlags:w}=e;if(f==="error")return Promise.reject(m);const S=t.layerCount>1?new s.Z_g(n,i,o,t.layerCount,c,s.ywz):new s.EB7(n,i,o,c,s.ywz);return S.minFilter=n.length===1?s.wem:s.D1R,S.magFilter=s.wem,S.generateMipmaps=!1,S.needsUpdate=!0,S.colorSpace=y===2?s.KI_:s.aCh,S.premultiplyAlpha=!!(1&w),S}async createTexture(e,t={}){const n=function(c){const f=new Uint8Array(c.buffer,c.byteOffset,Al.length);if(f[0]!==Al[0]||f[1]!==Al[1]||f[2]!==Al[2]||f[3]!==Al[3]||f[4]!==Al[4]||f[5]!==Al[5]||f[6]!==Al[6]||f[7]!==Al[7]||f[8]!==Al[8]||f[9]!==Al[9]||f[10]!==Al[10]||f[11]!==Al[11])throw new Error("Missing KTX 2.0 identifier.");const m=new zs,y=17*Uint32Array.BYTES_PER_ELEMENT,w=new Gm(c,Al.length,y,!0);m.vkFormat=w._nextUint32(),m.typeSize=w._nextUint32(),m.pixelWidth=w._nextUint32(),m.pixelHeight=w._nextUint32(),m.pixelDepth=w._nextUint32(),m.layerCount=w._nextUint32(),m.faceCount=w._nextUint32();const S=w._nextUint32();m.supercompressionScheme=w._nextUint32();const C=w._nextUint32(),O=w._nextUint32(),N=w._nextUint32(),H=w._nextUint32(),q=w._nextUint64(),J=w._nextUint64(),V=new Gm(c,Al.length+y,3*S*8,!0);for(let ai=0;ai<S;ai++)m.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+V._nextUint64(),V._nextUint64()),uncompressedByteLength:V._nextUint64()});const z=new Gm(c,C,O,!0),ue={vendorId:z._skip(4)._nextUint16(),descriptorType:z._nextUint16(),versionNumber:z._nextUint16(),descriptorBlockSize:z._nextUint16(),colorModel:z._nextUint8(),colorPrimaries:z._nextUint8(),transferFunction:z._nextUint8(),flags:z._nextUint8(),texelBlockDimension:[z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8()],bytesPlane:[z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8()],samples:[]},me=(ue.descriptorBlockSize/4-6)/4;for(let ai=0;ai<me;ai++){const ri={bitOffset:z._nextUint16(),bitLength:z._nextUint8(),channelType:z._nextUint8(),samplePosition:[z._nextUint8(),z._nextUint8(),z._nextUint8(),z._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&ri.channelType?(ri.sampleLower=z._nextInt32(),ri.sampleUpper=z._nextInt32()):(ri.sampleLower=z._nextUint32(),ri.sampleUpper=z._nextUint32()),ue.samples[ai]=ri}m.dataFormatDescriptor.length=0,m.dataFormatDescriptor.push(ue);const Te=new Gm(c,N,H,!0);for(;Te._offset<H;){const ai=Te._nextUint32(),ri=Te._scan(ai),Ei=bA(ri),ki=Te._scan(ai-ri.byteLength);m.keyValue[Ei]=Ei.match(/^ktx/i)?bA(ki):ki,Te._offset%4&&Te._skip(4-Te._offset%4)}if(J<=0)return m;const Be=new Gm(c,q,J,!0),He=Be._nextUint16(),tt=Be._nextUint16(),lt=Be._nextUint32(),at=Be._nextUint32(),St=Be._nextUint32(),mt=Be._nextUint32(),gt=[];for(let ai=0;ai<S;ai++)gt.push({imageFlags:Be._nextUint32(),rgbSliceByteOffset:Be._nextUint32(),rgbSliceByteLength:Be._nextUint32(),alphaSliceByteOffset:Be._nextUint32(),alphaSliceByteLength:Be._nextUint32()});const Ot=q+Be._offset,Bt=Ot+lt,Ft=Bt+at,_n=Ft+St,mn=new Uint8Array(c.buffer,c.byteOffset+Ot,lt),qn=new Uint8Array(c.buffer,c.byteOffset+Bt,at),Rn=new Uint8Array(c.buffer,c.byteOffset+Ft,St),En=new Uint8Array(c.buffer,c.byteOffset+_n,mt);return m.globalData={endpointCount:He,selectorCount:tt,imageDescs:gt,endpointsData:mn,selectorsData:qn,tablesData:Rn,extendedData:En},m}(new Uint8Array(e));if(n.vkFormat!==0)return async function(c){const{vkFormat:f,pixelWidth:m,pixelHeight:y,pixelDepth:w}=c;if(Bp[f]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const S=c.levels[0];let C,O;if(c.supercompressionScheme===0)C=S.levelData;else{if(c.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Kv||(Kv=new Promise(async H=>{const q=new Xv;await q.init(),H(q)})),C=(await Kv).decode(S.levelData,S.uncompressedByteLength)}O=$0[f]===s.VzW?new Float32Array(C.buffer,C.byteOffset,C.byteLength/Float32Array.BYTES_PER_ELEMENT):$0[f]===s.cLu?new Uint16Array(C.buffer,C.byteOffset,C.byteLength/Uint16Array.BYTES_PER_ELEMENT):C;const N=w===0?new s.IEO(O,m,y):new s.JUT(O,m,y,w);return N.type=$0[f],N.format=Bp[f],N.colorSpace=g_[f]||s.aCh,N.needsUpdate=!0,Promise.resolve(N)}(n);const i=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e])).then(c=>this._createTextureFrom(c.data,n));return Yv.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),$v--,this}}ah.BasisFormat={ETC1S:0,UASTC_4x4:1},ah.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},ah.EngineFormat={RGBAFormat:s.wk1,RGBA_ASTC_4x4_Format:s.ptH,RGBA_BPTC_Format:s.bsb,RGBA_ETC2_EAC_Format:s.ekQ,RGBA_PVRTC_4BPPV1_Format:s.eaV,RGBA_S3TC_DXT5_Format:s.ILR,RGB_ETC1_Format:s.fto,RGB_ETC2_Format:s.l0P,RGB_PVRTC_4BPPV1_Format:s._AM,RGB_S3TC_DXT1_Format:s.wuA},ah.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags } = transcode( message.buffer );

						const buffers = [];

						for ( let i = 0; i < mipmaps.length; ++ i ) {

							buffers.push( mipmaps[ i ].data.buffer );

						}

						self.postMessage( { type: 'transcode', id: message.id, width, height, hasAlpha, mipmaps, format, dfdTransferFn, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layers = ktx2File.getLayers() || 1;
		const levels = ktx2File.getLevels();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdTransferFn = ktx2File.getDFDTransferFunc();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levels ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const mipmaps = [];

		for ( let mip = 0; mip < levels; mip ++ ) {

			const layerMips = [];

			let mipWidth, mipHeight;

			for ( let layer = 0; layer < layers; layer ++ ) {

				const levelInfo = ktx2File.getImageLevelInfo( mip, layer, 0 );
				mipWidth = levelInfo.origWidth < 4 ? levelInfo.origWidth : levelInfo.width;
				mipHeight = levelInfo.origHeight < 4 ? levelInfo.origHeight : levelInfo.height;
				const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
				const status = ktx2File.transcodeImage(
					dst,
					mip,
					layer,
					0,
					transcoderFormat,
					0,
					- 1,
					- 1,
				);

				if ( ! status ) {

					cleanup();
					throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

				}

				layerMips.push( dst );

			}

			mipmaps.push( { data: concat( layerMips ), width: mipWidth, height: mipHeight } );

		}

		cleanup();

		return { width, height, hasAlpha, mipmaps, format: engineFormat, dfdTransferFn, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const Bp={109:s.wk1,97:s.wk1,37:s.wk1,43:s.wk1,103:s.av9,83:s.av9,16:s.av9,22:s.av9,100:s.hEm,76:s.hEm,15:s.hEm,9:s.hEm},$0={109:s.VzW,97:s.cLu,37:s.ywz,43:s.ywz,103:s.VzW,83:s.cLu,16:s.ywz,22:s.ywz,100:s.VzW,76:s.cLu,15:s.ywz,9:s.ywz},g_={43:s.KI_,22:s.KI_,15:s.KI_},__="KHR_texture_basisu";class nc extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi]}async onAdded(e){var t,n,i,o,c,f;this._importer||(this._importer=new Js(class extends ah{constructor(m){super(m),this.setTranscoderPath(nc.TRANSCODER_LIBRARY_PATH).detectSupport(e.renderer.rendererObject)}async createTexture(m,y){const w=new Uint8Array(m.slice(0)),S=await super.createTexture(m,y);return S.source._sourceImgBuffer=w,S.userData.mimeType="image/ktx2",S.toJSON=C=>Xr(S,C,S.name,"image/ktx2"),S.clone=()=>{throw new Error("ktx2 texture cloning not supported")},S}},["ktx2"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer),(f=(c=(o=(i=e.getManager())==null?void 0:i.exporter)==null?void 0:o.getExporter("gltf","glb"))==null?void 0:c.extensions)==null||f.push(xA)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}nc.PluginType="KTX2LoadPlugin",nc.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/";const xA=l=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0&&t.source!==null)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer||e.userData.__sourceBuffer;if(!n)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const i={},o=new Blob([n],{type:"image/ktx2"});i.source=l.processImageBlob(o,e),t.extensions[__]=i,l.extensionsUsed[__]=!0}});var Ib=__webpackgi_require__(701),ku=__webpackgi_require__.n(Ib),wA=__webpackgi_require__(236),Df=__webpackgi_require__.n(wA),Of=__webpackgi_require__(850),kd=__webpackgi_require__.n(Of),v_=__webpackgi_require__(182),io=__webpackgi_require__.n(v_),Pb=__webpackgi_require__(213),Bf=__webpackgi_require__.n(Pb),y_=__webpackgi_require__(44),Lp={};y_.Z&&y_.Z.locals&&(Lp.locals=y_.Z.locals);var J0,A_=0,Lf={};Lf.styleTagTransform=Bf(),Lf.setAttributes=kd(),Lf.insert=function(l,e){(e.target||document.head).appendChild(l)},Lf.domAPI=Df(),Lf.insertStyleElement=io(),Lp.use=function(l){return Lf.options=l||{},A_++||(J0=ku()(y_.Z,Lf)),Lp},Lp.unuse=function(){A_>0&&!--A_&&(J0(),J0=null)};var Db=Lp;class b_ extends Ri{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(e){super(),this.enabled=!0,this.dependencies=[fi],this._mainDiv=(0,a.createDiv)({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=(0,a.createDiv)({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(e){var n,i,o,c,f,m,y,w;await super.onAdded(e),e.container.appendChild(this._mainDiv);const t=new Map;this._updateMainDiv(t),(i=(n=e.getManager())==null?void 0:n.importer)==null||i.addEventListener("importFile",S=>{S.state!=="done"?t.set(S.path,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.path),this._updateMainDiv(t)}),(c=(o=e.getManager())==null?void 0:o.exporter)==null||c.addEventListener("exportFile",S=>{S.state!=="done"?t.set(S.obj.name,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.obj.name),this._updateMainDiv(t)}),(f=e.getPluginByType("FileTransferPlugin"))==null||f.addEventListener("transferFile",S=>{S.state!=="done"?t.set(S.path,{state:S.state,progress:S.progress?100*S.progress:void 0}):t.delete(S.path),this._updateMainDiv(t)}),(m=e.getPluginByType("MaterialConfiguratorPlugin"))==null||m.addEventListener("progress",S=>{S.state!=="done"?t.set("MatpreviewGeneration",{state:S.state,progress:0}):t.delete("MatpreviewGeneration"),this._updateMainDiv(t)}),(y=e.getPluginByType("SwitchNodePlugin"))==null||y.addEventListener("progress",S=>{S.state!=="done"?t.set("SwitchNodeGeneration",{state:S.state,progress:0}):t.delete("SwitchNodeGeneration"),this._updateMainDiv(t)}),(w=e.getPluginByType("ThemePlugin"))==null||w.addEventListener("progress",S=>{S.state!=="done"?t.set("ThemeInit",{state:S.state,progress:0}):t.delete("ThemeInit"),this._updateMainDiv(t)})}}(function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)})([Yn("Enabled"),(0,a.onChange)(b_.prototype._onEnabledChange),ze()],b_.prototype,"enabled",void 0);let ms=class extends b_{constructor(l=!0){super("LoadingBar"),this.showText=l}_updateMainDiv(l){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,t=1;l.forEach((n,i)=>{e+=n.progress??99,t+=100}),this._contentDiv.innerHTML=this.showText?(100*e/t).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/t).toFixed(0)+"%",l.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(l){Db.use({target:l.container}),await super.onAdded(l)}};ms.PluginType="AssetManagerLoadingBarPlugin",ms=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("Asset manager loading bar")],ms);var Jv=__webpackgi_require__(798),Wm={};Jv.Z&&Jv.Z.locals&&(Wm.locals=Jv.Z.locals);var Z0,ey=0,Ud={};Ud.styleTagTransform=Bf(),Ud.setAttributes=kd(),Ud.insert=function(l,e){(e.target||document.head).appendChild(l)},Ud.domAPI=Df(),Ud.insertStyleElement=io(),Wm.use=function(l){return Ud.options=l||{},ey++||(Z0=ku()(Jv.Z,Ud)),Wm},Wm.unuse=function(){ey>0&&!--ey&&(Z0(),Z0=null)};var Ob=Wm;let Lc=class extends b_{constructor(){super("Popup");const l=(0,a.createDiv)({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});l.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(l)}_updateMainDiv(l){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";l.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${(n||"").split("/").pop()} ${t.progress?" - "+t.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,l.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(l){Ob.use({target:l.container}),await super.onAdded(l)}};Lc.PluginType="AssetManagerBasicPopupPlugin",Lc=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("Asset manager popup")],Lc);class Fd extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,n,i,o,c="postRender",f=!1){var m;this._generators.has(c)||this._generators.set(c,[]),(m=this._generators.get(c))==null||m.push({key:e,fn:t,rect:n?[...n]:void 0,frag:o||i||f?new s.jyz({vertexShader:v.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:o??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${f?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${f?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${i??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n;this._generators.set(t,((n=this._generators.get(t))==null?void 0:n.filter(i=>i.key!==e))??[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const t=this._viewer,n=t==null?void 0:t.renderer;n&&t&&((i=this._generators.get(e))==null||i.forEach(({key:o,fn:c,rect:f,frag:m})=>{const y=c(t);if(y){if(y.image&&f){const w=y.image.width/y.image.height;f[2]<1&&f[3]<1&&(f[2]=200),f[2]<1&&(f[2]=f[3]*w),f[3]<1&&(f[3]=f[2]/w)}n.blit(y,void 0,{viewport:f,clear:!1,material:m})}}))}}Fd.PluginType="debug";class Zv extends s.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,c=this.path===""?s.Zp0.extractUrlBase(e):this.path,f=new s.hH6(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(e,function(m){try{t(o.parse(m,c))}catch(y){i?i(y):console.error(y),o.manager.itemError(e)}},n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let i={};const o=/\s+/,c={};for(let m=0;m<n.length;m++){let y=n[m];if(y=y.trim(),y.length===0||y.charAt(0)==="#")continue;const w=y.indexOf(" ");let S=w>=0?y.substring(0,w):y;S=S.toLowerCase();let C=w>=0?y.substring(w+1):"";if(C=C.trim(),S==="newmtl")i={name:C},c[C]=i;else if(S==="ka"||S==="kd"||S==="ks"||S==="ke"){const O=C.split(o,3);i[S]=[parseFloat(O[0]),parseFloat(O[1]),parseFloat(O[2])]}else i[S]=C}const f=new Bb(this.resourcePath||t,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(c),f}}class Bb{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:s.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:s.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],o={};t[n]=o;for(const c in i){let f=!0,m=i[c];const y=c.toLowerCase();switch(y){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(m=[m[0]/255,m[1]/255,m[2]/255]),this.options&&this.options.ignoreZeroRGBs&&m[0]===0&&m[1]===0&&m[2]===0&&(f=!1)}f&&(o[y]=m)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};async function o(m,y){if(i[m])return;const w=t.getTextureParams(y,i);return new Promise((S,C)=>{let O=!1,N=()=>!O&&(O=!0)&&S();const H=t.loadTexture((q=t.baseUrl,typeof(J=w.url)!="string"||J===""?"":/^https?:\/\//i.test(J)?J:q+J),void 0,V=>{i[m]=V,N()},void 0,N);var q,J;setTimeout(N,50),H.repeat.copy(w.scale),H.offset.copy(w.offset),H.wrapS=t.wrap,H.wrapT=t.wrap,m!=="map"&&m!=="emissiveMap"||(H.colorSpace=s.KI_)})}const c=Array.from(Object.keys(n||{}));let f=c.includes("d")||c.includes("D");for(const m of c){const y=n[m];let w;if(y!=="")switch(m.toLowerCase()){case"kd":i.color=new s.Ilk().fromArray(y).convertSRGBToLinear();break;case"ks":i.specular=new s.Ilk().fromArray(y).convertSRGBToLinear();break;case"ke":i.emissive=new s.Ilk().fromArray(y).convertSRGBToLinear();break;case"map_kd":await o("map",y);break;case"map_ks":await o("specularMap",y);break;case"map_ke":await o("emissiveMap",y);break;case"norm":await o("normalMap",y);break;case"map_bump":case"bump":await o("bumpMap",y);break;case"map_d":await o("alphaMap",y),i.transparent=!0;break;case"ns":i.shininess=parseFloat(y);break;case"d":w=parseFloat(y),w<1&&(i.opacity=w,i.transparent=!0);break;case"tr":if(f)break;w=parseFloat(y),this.options&&this.options.invertTrProperty&&(w=1-w),w>0&&(i.opacity=1-w,i.transparent=!0)}}return this.materials[e]=new s.xoR(i),this.materials[e]}getTextureParams(e,t){const n={scale:new s.FM8(1,1),offset:new s.FM8(0,0)},i=e.split(/\s+/);let o;return o=i.indexOf("-bm"),o>=0&&(t.bumpScale=parseFloat(i[o+1]),i.splice(o,2)),o=i.indexOf("-s"),o>=0&&(n.scale.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),o=i.indexOf("-o"),o>=0&&(n.offset.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,o){const c=this.manager!==void 0?this.manager:s.tEQ;let f=c.getHandler(e);f===null&&(f=new s.dpR(c)),f.setCrossOrigin&&f.setCrossOrigin(this.crossOrigin);const m=f.load(e,n,i,o);return t!==void 0&&(m.mapping=t),m}}const EA=/^[og]\s*(.+)?/,e0=/^mtllib /,SA=/^usemtl /,MA=/^usemap /,ty=/\s+/,TA=new s.Pa4,t0=new s.Pa4,x_=new s.Pa4,CA=new s.Pa4,Nc=new s.Pa4,n0=new s.Ilk;function zd(){const l={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,o){const c=this._finalize(!1);c&&(c.inherited||c.groupCount<=0)&&this.materials.splice(c.index,1);const f={index:this.materials.length,name:i||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:c!==void 0?c.smooth:this.smooth,groupStart:c!==void 0?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){const y={index:typeof m=="number"?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return y.clone=this.clone.bind(y),y}};return this.materials.push(f),f},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),i&&this.materials.length>1)for(let c=this.materials.length-1;c>=0;c--)this.materials[c].groupCount<=0&&this.materials.splice(c,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},n&&n.name&&typeof n.clone=="function"){const i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,o=this.object.geometry.vertices;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,o=this.object.geometry.normals;o.push(i[e+0],i[e+1],i[e+2]),o.push(i[t+0],i[t+1],i[t+2]),o.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,o=this.object.geometry.normals;TA.fromArray(i,e),t0.fromArray(i,t),x_.fromArray(i,n),Nc.subVectors(x_,t0),CA.subVectors(TA,t0),Nc.cross(CA),Nc.normalize(),o.push(Nc.x,Nc.y,Nc.z),o.push(Nc.x,Nc.y,Nc.z),o.push(Nc.x,Nc.y,Nc.z)},addColor:function(e,t,n){const i=this.colors,o=this.object.geometry.colors;i[e]!==void 0&&o.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&o.push(i[t+0],i[t+1],i[t+2]),i[n]!==void 0&&o.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,o=this.object.geometry.uvs;o.push(i[e+0],i[e+1]),o.push(i[t+0],i[t+1]),o.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,o,c,f,m,y){const w=this.vertices.length;let S=this.parseVertexIndex(e,w),C=this.parseVertexIndex(t,w),O=this.parseVertexIndex(n,w);if(this.addVertex(S,C,O),this.addColor(S,C,O),f!==void 0&&f!==""){const N=this.normals.length;S=this.parseNormalIndex(f,N),C=this.parseNormalIndex(m,N),O=this.parseNormalIndex(y,N),this.addNormal(S,C,O)}else this.addFaceNormal(S,C,O);if(i!==void 0&&i!==""){const N=this.uvs.length;S=this.parseUVIndex(i,N),C=this.parseUVIndex(o,N),O=this.parseUVIndex(c,N),this.addUV(S,C,O),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const o=this.parseVertexIndex(e[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let o=0,c=e.length;o<c;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));for(let o=0,c=t.length;o<c;o++)this.addUVLine(this.parseUVIndex(t[o],i))}};return l.startObject("",!1),l}class Np extends s.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,i){const o=this,c=new s.hH6(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,async function(f){try{t(await o.parse(f))}catch(m){i?i(m):console.error(m),o.manager.itemError(e)}},n,i)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new zd;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let i=[];for(let c=0,f=n.length;c<f;c++){const m=n[c].trimStart();if(m.length===0)continue;const y=m.charAt(0);if(y!=="#")if(y==="v"){const w=m.split(ty);switch(w[0]){case"v":t.vertices.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3])),w.length>=7?(n0.setRGB(parseFloat(w[4]),parseFloat(w[5]),parseFloat(w[6])).convertSRGBToLinear(),t.colors.push(n0.r,n0.g,n0.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3]));break;case"vt":t.uvs.push(parseFloat(w[1]),parseFloat(w[2]))}}else if(y==="f"){const w=m.slice(1).trim().split(ty),S=[];for(let O=0,N=w.length;O<N;O++){const H=w[O];if(H.length>0){const q=H.split("/");S.push(q)}}const C=S[0];for(let O=1,N=S.length-1;O<N;O++){const H=S[O],q=S[O+1];t.addFace(C[0],H[0],q[0],C[1],H[1],q[1],C[2],H[2],q[2])}}else if(y==="l"){const w=m.substring(1).trim().split(" ");let S=[];const C=[];if(m.indexOf("/")===-1)S=w;else for(let O=0,N=w.length;O<N;O++){const H=w[O].split("/");H[0]!==""&&S.push(H[0]),H[1]!==""&&C.push(H[1])}t.addLineGeometry(S,C)}else if(y==="p"){const w=m.slice(1).trim().split(" ");t.addPointGeometry(w)}else if((i=EA.exec(m))!==null){const w=(" "+i[0].slice(1).trim()).slice(1);t.startObject(w)}else if(SA.test(m))t.object.startMaterial(m.substring(7).trim(),t.materialLibraries);else if(e0.test(m)){t.materialLibraries.push(m.substring(7).trim());const w=m.substring(7).trim(),S=this.manager.getHandler(w);if(S){const C=await S.loadAsync(w).catch(O=>{console.warn(O)});C&&this.setMaterials(C)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(MA.test(m))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(y==="s"){if(i=m.split(" "),i.length>1){const S=i[1].trim().toLowerCase();t.object.smooth=S!=="0"&&S!=="off"}else t.object.smooth=!0;const w=t.object.currentMaterial();w&&(w.smooth=t.object.smooth)}else{if(m==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+m+'"')}}t.finalize();const o=new s.ZAu;if(o.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let c=0,f=t.objects.length;c<f;c++){const m=t.objects[c],y=m.geometry,w=m.materials,S=y.type==="Line",C=y.type==="Points";let O=!1;if(y.vertices.length===0)continue;const N=new s.u9r;N.setAttribute("position",new s.a$l(y.vertices,3)),y.normals.length>0&&N.setAttribute("normal",new s.a$l(y.normals,3)),y.colors.length>0&&(O=!0,N.setAttribute("color",new s.a$l(y.colors,3))),y.hasUVIndices===!0&&N.setAttribute("uv",new s.a$l(y.uvs,2));const H=[];for(let J=0,V=w.length;J<V;J++){const z=w[J],ue=z.name+"_"+z.smooth+"_"+O;let me=t.materials[ue];if(this.materials!==null)if(me=await this.materials.create(z.name),!S||!me||me instanceof s.nls){if(C&&me&&!(me instanceof s.UY4)){const Te=new s.UY4({size:10,sizeAttenuation:!1});s.F5T.prototype.copy.call(Te,me),Te.color.copy(me.color),Te.map=me.map,me=Te}}else{const Te=new s.nls;s.F5T.prototype.copy.call(Te,me),Te.color.copy(me.color),me=Te}me===void 0&&(me=S?new s.nls:C?new s.UY4({size:1,sizeAttenuation:!1}):new s.xoR,me.name=z.name,me.flatShading=!z.smooth,me.vertexColors=O,t.materials[ue]=me),H.push(me)}let q;if(H.length>1){for(let J=0,V=w.length;J<V;J++){const z=w[J];N.addGroup(z.groupStart,z.groupCount,J)}q=S?new s.ejS(N,H):C?new s.woe(N,H):new s.Kj0(N,H)}else q=S?new s.ejS(N,H[0]):C?new s.woe(N,H[0]):new s.Kj0(N,H[0]);q.name=m.name,o.add(q)}else if(t.vertices.length>0){const c=new s.UY4({size:1,sizeAttenuation:!1}),f=new s.u9r;f.setAttribute("position",new s.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(f.setAttribute("color",new s.a$l(t.colors,3)),c.vertexColors=!0);const m=new s.woe(f,c);o.add(m)}return o}}class kp extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi],this._importer1=new Js(Np,["obj"],!0),this._importer2=new Js(Zv,["mtl"],!1)}async onAdded(e){var t,n,i,o;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer1),(o=(i=e.getManager())==null?void 0:i.importer)==null||o.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&(e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer1),1),e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer2),1))}}kp.PluginType="ObjMtlLoadPlugin";var RA=function(l){return URL.createObjectURL(new Blob([l],{type:"text/javascript"}))};try{URL.revokeObjectURL(RA(""))}catch{RA=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var bl=Uint8Array,ic=Uint16Array,w_=Uint32Array,E_=new bl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Up=new bl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qm=new bl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ny=function(l,e){for(var t=new ic(31),n=0;n<31;++n)t[n]=e+=1<<l[n-1];var i=new w_(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return[t,i]},iy=ny(E_,2),ry=iy[0],qm=iy[1];ry[28]=258,qm[258]=28;for(var i0=ny(Up,0),sy=i0[0],S_=i0[1],Ro=new ic(32768),vo=0;vo<32768;++vo){var Qs=(43690&vo)>>>1|(21845&vo)<<1;Qs=(61680&(Qs=(52428&Qs)>>>2|(13107&Qs)<<2))>>>4|(3855&Qs)<<4,Ro[vo]=((65280&Qs)>>>8|(255&Qs)<<8)>>>1}var au=function(l,e,t){for(var n=l.length,i=0,o=new ic(e);i<n;++i)++o[l[i]-1];var c,f=new ic(e);for(i=0;i<e;++i)f[i]=f[i-1]+o[i-1]<<1;if(t){c=new ic(1<<e);var m=15-e;for(i=0;i<n;++i)if(l[i])for(var y=i<<4|l[i],w=e-l[i],S=f[l[i]-1]++<<w,C=S|(1<<w)-1;S<=C;++S)c[Ro[S]>>>m]=y}else for(c=new ic(n),i=0;i<n;++i)l[i]&&(c[i]=Ro[f[l[i]-1]++]>>>15-l[i]);return c},Fp=new bl(288);for(vo=0;vo<144;++vo)Fp[vo]=8;for(vo=144;vo<256;++vo)Fp[vo]=9;for(vo=256;vo<280;++vo)Fp[vo]=7;for(vo=280;vo<288;++vo)Fp[vo]=8;var M_=new bl(32);for(vo=0;vo<32;++vo)M_[vo]=5;var IA=au(Fp,9,0),PA=au(Fp,9,1),T_=au(M_,5,0),oy=au(M_,5,1),r0=function(l){for(var e=l[0],t=1;t<l.length;++t)l[t]>e&&(e=l[t]);return e},lh=function(l,e,t){var n=e/8|0;return(l[n]|l[n+1]<<8)>>(7&e)&t},s0=function(l,e){var t=e/8|0;return(l[t]|l[t+1]<<8|l[t+2]<<16)>>(7&e)},C_=function(l){return(l/8|0)+(7&l&&1)},ay=function(l,e,t){(e==null||e<0)&&(e=0),(t==null||t>l.length)&&(t=l.length);var n=new(l instanceof ic?ic:l instanceof w_?w_:bl)(t-e);return n.set(l.subarray(e,t)),n},Lb=function(l,e,t){var n=l.length;if(!n||t&&!t.l&&n<5)return e||new bl(0);var i=!e||t,o=!t||t.i;t||(t={}),e||(e=new bl(3*n));var c=function(ki){var Xi=e.length;if(ki>Xi){var ts=new bl(Math.max(2*Xi,ki));ts.set(e),e=ts}},f=t.f||0,m=t.p||0,y=t.b||0,w=t.l,S=t.d,C=t.m,O=t.n,N=8*n;do{if(!w){t.f=f=lh(l,m,1);var H=lh(l,m+1,3);if(m+=3,!H){var q=l[(at=C_(m)+4)-4]|l[at-3]<<8,J=at+q;if(J>n){if(o)throw"unexpected EOF";break}i&&c(y+q),e.set(l.subarray(at,J),y),t.b=y+=q,t.p=m=8*J;continue}if(H==1)w=PA,S=oy,C=9,O=5;else{if(H!=2)throw"invalid block type";var V=lh(l,m,31)+257,z=lh(l,m+10,15)+4,ue=V+lh(l,m+5,31)+1;m+=14;for(var me=new bl(ue),Te=new bl(19),Be=0;Be<z;++Be)Te[Qm[Be]]=lh(l,m+3*Be,7);m+=3*z;var He=r0(Te),tt=(1<<He)-1,lt=au(Te,He,1);for(Be=0;Be<ue;){var at,St=lt[lh(l,m,tt)];if(m+=15&St,(at=St>>>4)<16)me[Be++]=at;else{var mt=0,gt=0;for(at==16?(gt=3+lh(l,m,3),m+=2,mt=me[Be-1]):at==17?(gt=3+lh(l,m,7),m+=3):at==18&&(gt=11+lh(l,m,127),m+=7);gt--;)me[Be++]=mt}}var Ot=me.subarray(0,V),Bt=me.subarray(V);C=r0(Ot),O=r0(Bt),w=au(Ot,C,1),S=au(Bt,O,1)}if(m>N){if(o)throw"unexpected EOF";break}}i&&c(y+131072);for(var Ft=(1<<C)-1,_n=(1<<O)-1,mn=m;;mn=m){var qn=(mt=w[s0(l,m)&Ft])>>>4;if((m+=15&mt)>N){if(o)throw"unexpected EOF";break}if(!mt)throw"invalid length/literal";if(qn<256)e[y++]=qn;else{if(qn==256){mn=m,w=null;break}var Rn=qn-254;if(qn>264){var En=E_[Be=qn-257];Rn=lh(l,m,(1<<En)-1)+ry[Be],m+=En}var ai=S[s0(l,m)&_n],ri=ai>>>4;if(!ai)throw"invalid distance";if(m+=15&ai,Bt=sy[ri],ri>3&&(En=Up[ri],Bt+=s0(l,m)&(1<<En)-1,m+=En),m>N){if(o)throw"unexpected EOF";break}i&&c(y+131072);for(var Ei=y+Rn;y<Ei;y+=4)e[y]=e[y-Bt],e[y+1]=e[y+1-Bt],e[y+2]=e[y+2-Bt],e[y+3]=e[y+3-Bt];y=Ei}}t.l=w,t.p=mn,t.b=y,w&&(f=1,t.m=C,t.d=S,t.n=O)}while(!f);return y==e.length?e:ay(e,0,y)},jd=function(l,e,t){t<<=7&e;var n=e/8|0;l[n]|=t,l[n+1]|=t>>>8},R_=function(l,e,t){t<<=7&e;var n=e/8|0;l[n]|=t,l[n+1]|=t>>>8,l[n+2]|=t>>>16},ly=function(l,e){for(var t=[],n=0;n<l.length;++n)l[n]&&t.push({s:n,f:l[n]});var i=t.length,o=t.slice();if(!i)return[l0,0];if(i==1){var c=new bl(t[0].s+1);return c[t[0].s]=1,[c,1]}t.sort(function(me,Te){return me.f-Te.f}),t.push({s:-1,f:25001});var f=t[0],m=t[1],y=0,w=1,S=2;for(t[0]={s:-1,f:f.f+m.f,l:f,r:m};w!=i-1;)f=t[t[y].f<t[S].f?y++:S++],m=t[y!=w&&t[y].f<t[S].f?y++:S++],t[w++]={s:-1,f:f.f+m.f,l:f,r:m};var C=o[0].s;for(n=1;n<i;++n)o[n].s>C&&(C=o[n].s);var O=new ic(C+1),N=o0(t[w-1],O,0);if(N>e){n=0;var H=0,q=N-e,J=1<<q;for(o.sort(function(me,Te){return O[Te.s]-O[me.s]||me.f-Te.f});n<i;++n){var V=o[n].s;if(!(O[V]>e))break;H+=J-(1<<N-O[V]),O[V]=e}for(H>>>=q;H>0;){var z=o[n].s;O[z]<e?H-=1<<e-O[z]++-1:++n}for(;n>=0&&H;--n){var ue=o[n].s;O[ue]==e&&(--O[ue],++H)}N=e}return[new bl(O),N]},o0=function(l,e,t){return l.s==-1?Math.max(o0(l.l,e,t+1),o0(l.r,e,t+1)):e[l.s]=t},cy=function(l){for(var e=l.length;e&&!l[--e];);for(var t=new ic(++e),n=0,i=l[0],o=1,c=function(m){t[n++]=m},f=1;f<=e;++f)if(l[f]==i&&f!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)c(32754);o>2&&(c(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(c(i),--o;o>6;o-=6)c(8304);o>2&&(c(o-3<<5|8208),o=0)}for(;o--;)c(i);o=1,i=l[f]}return[t.subarray(0,n),e]},Xm=function(l,e){for(var t=0,n=0;n<e.length;++n)t+=l[n]*e[n];return t},I_=function(l,e,t){var n=t.length,i=C_(e+2);l[i]=255&n,l[i+1]=n>>>8,l[i+2]=255^l[i],l[i+3]=255^l[i+1];for(var o=0;o<n;++o)l[i+o+4]=t[o];return 8*(i+4+n)},a0=function(l,e,t,n,i,o,c,f,m,y,w){jd(e,w++,t),++i[256];for(var S=ly(i,15),C=S[0],O=S[1],N=ly(o,15),H=N[0],q=N[1],J=cy(C),V=J[0],z=J[1],ue=cy(H),me=ue[0],Te=ue[1],Be=new ic(19),He=0;He<V.length;++He)Be[31&V[He]]++;for(He=0;He<me.length;++He)Be[31&me[He]]++;for(var tt=ly(Be,7),lt=tt[0],at=tt[1],St=19;St>4&&!lt[Qm[St-1]];--St);var mt,gt,Ot,Bt,Ft=y+5<<3,_n=Xm(i,Fp)+Xm(o,M_)+c,mn=Xm(i,C)+Xm(o,H)+c+14+3*St+Xm(Be,lt)+(2*Be[16]+3*Be[17]+7*Be[18]);if(Ft<=_n&&Ft<=mn)return I_(e,w,l.subarray(m,m+y));if(jd(e,w,1+(mn<_n)),w+=2,mn<_n){mt=au(C,O,0),gt=C,Ot=au(H,q,0),Bt=H;var qn=au(lt,at,0);for(jd(e,w,z-257),jd(e,w+5,Te-1),jd(e,w+10,St-4),w+=14,He=0;He<St;++He)jd(e,w+3*He,lt[Qm[He]]);w+=3*St;for(var Rn=[V,me],En=0;En<2;++En){var ai=Rn[En];for(He=0;He<ai.length;++He){var ri=31&ai[He];jd(e,w,qn[ri]),w+=lt[ri],ri>15&&(jd(e,w,ai[He]>>>5&127),w+=ai[He]>>>12)}}}else mt=IA,gt=Fp,Ot=T_,Bt=M_;for(He=0;He<f;++He)if(n[He]>255){ri=n[He]>>>18&31,R_(e,w,mt[ri+257]),w+=gt[ri+257],ri>7&&(jd(e,w,n[He]>>>23&31),w+=E_[ri]);var Ei=31&n[He];R_(e,w,Ot[Ei]),w+=Bt[Ei],Ei>3&&(R_(e,w,n[He]>>>5&8191),w+=Up[Ei])}else R_(e,w,mt[n[He]]),w+=gt[n[He]];return R_(e,w,mt[256]),w+gt[256]},DA=new w_([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),l0=new bl(0),OA=function(){var l=1,e=0;return{p:function(t){for(var n=l,i=e,o=t.length,c=0;c!=o;){for(var f=Math.min(c+2655,o);c<f;++c)i+=n+=t[c];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}l=n,e=i},d:function(){return(255&(l%=65521))<<24|l>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},uy=function(l,e,t,n,i){return function(o,c,f,m,y,w){var S=o.length,C=new bl(m+S+5*(1+Math.ceil(S/7e3))+y),O=C.subarray(m,C.length-y),N=0;if(!c||S<8)for(var H=0;H<=S;H+=65535){var q=H+65535;q<S?N=I_(O,N,o.subarray(H,q)):(O[H]=w,N=I_(O,N,o.subarray(H,S)))}else{for(var J=DA[c-1],V=J>>>13,z=8191&J,ue=(1<<f)-1,me=new ic(32768),Te=new ic(ue+1),Be=Math.ceil(f/3),He=2*Be,tt=function(Fr){return(o[Fr]^o[Fr+1]<<Be^o[Fr+2]<<He)&ue},lt=new w_(25e3),at=new ic(288),St=new ic(32),mt=0,gt=0,Ot=(H=0,0),Bt=0,Ft=0;H<S;++H){var _n=tt(H),mn=32767&H,qn=Te[_n];if(me[mn]=qn,Te[_n]=mn,Bt<=H){var Rn=S-H;if((mt>7e3||Ot>24576)&&Rn>423){N=a0(o,O,0,lt,at,St,gt,Ot,Ft,H-Ft,N),Ot=mt=gt=0,Ft=H;for(var En=0;En<286;++En)at[En]=0;for(En=0;En<30;++En)St[En]=0}var ai=2,ri=0,Ei=z,ki=mn-qn&32767;if(Rn>2&&_n==tt(H-ki))for(var Xi=Math.min(V,Rn)-1,ts=Math.min(32767,H),Cr=Math.min(258,Rn);ki<=ts&&--Ei&&mn!=qn;){if(o[H+ai]==o[H+ai-ki]){for(var wr=0;wr<Cr&&o[H+wr]==o[H+wr-ki];++wr);if(wr>ai){if(ai=wr,ri=ki,wr>Xi)break;var zn=Math.min(ki,wr-2),oi=0;for(En=0;En<zn;++En){var Ti=H-ki+En+32768&32767,Hr=Ti-me[Ti]+32768&32767;Hr>oi&&(oi=Hr,qn=Ti)}}}ki+=(mn=qn)-(qn=me[mn])+32768&32767}if(ri){lt[Ot++]=268435456|qm[ai]<<18|S_[ri];var ps=31&qm[ai],$r=31&S_[ri];gt+=E_[ps]+Up[$r],++at[257+ps],++St[$r],Bt=H+ai,++mt}else lt[Ot++]=o[H],++at[o[H]]}}N=a0(o,O,w,lt,at,St,gt,Ot,Ft,H-Ft,N),!w&&7&N&&(N=I_(O,N+1,l0))}return ay(C,0,m+C_(N)+y)}(l,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(l.length)))):12+e.mem,t,n,!i)},BA=function(l,e,t){for(;t;++e)l[e]=t,t>>>=8},Ym=function(l,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;l[0]=120,l[1]=n<<6|(n?32-2*n:1)},Nb=function(l){if((15&l[0])!=8||l[0]>>>4>7||(l[0]<<8|l[1])%31)throw"invalid zlib data";if(32&l[1])throw"invalid zlib data: preset dictionaries not supported"};function P_(l,e){return Lb((Nb(l),l.subarray(2,-4)),e)}var R=typeof TextDecoder<"u"&&new TextDecoder;try{R.decode(l0,{stream:!0})}catch{}function r(l,e,t){const n=t.length-l-1;if(e>=t[n])return n-1;if(e<=t[l])return l;let i=l,o=n,c=Math.floor((i+o)/2);for(;e<t[c]||e>=t[c+1];)e<t[c]?o=c:i=c,c=Math.floor((i+o)/2);return c}function d(l,e){let t=1;for(let i=2;i<=l;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=l-e;++i)n*=i;return t/n}class _ extends s.Hyl{constructor(e,t,n,i,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=o||this.knots.length-1;for(let c=0;c<n.length;++c){const f=n[c];this.controlPoints[c]=new s.Ltg(f.x,f.y,f.z,f.w)}}getPoint(e,t=new s.Pa4){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=function(c,f,m,y){const w=r(c,y,f),S=function(O,N,H,q){const J=[],V=[],z=[];J[0]=1;for(let ue=1;ue<=H;++ue){V[ue]=N-q[O+1-ue],z[ue]=q[O+ue]-N;let me=0;for(let Te=0;Te<ue;++Te){const Be=z[Te+1],He=V[ue-Te],tt=J[Te]/(Be+He);J[Te]=me+Be*tt,me=He*tt}J[ue]=me}return J}(w,y,c,f),C=new s.Ltg(0,0,0,0);for(let O=0;O<=c;++O){const N=m[w-c+O],H=S[O],q=N.w*H;C.x+=N.x*q,C.y+=N.y*q,C.z+=N.z*q,C.w+=N.w*H}return C}(this.degree,this.knots,this.controlPoints,i);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,t=new s.Pa4){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=function(c,f,m,y,w){const S=function(C,O,N,H,q){const J=q<C?q:C,V=[],z=r(C,H,O),ue=function(Te,Be,He,tt,lt){const at=[];for(let Ft=0;Ft<=He;++Ft)at[Ft]=0;const St=[];for(let Ft=0;Ft<=tt;++Ft)St[Ft]=at.slice(0);const mt=[];for(let Ft=0;Ft<=He;++Ft)mt[Ft]=at.slice(0);mt[0][0]=1;const gt=at.slice(0),Ot=at.slice(0);for(let Ft=1;Ft<=He;++Ft){gt[Ft]=Be-lt[Te+1-Ft],Ot[Ft]=lt[Te+Ft]-Be;let _n=0;for(let mn=0;mn<Ft;++mn){const qn=Ot[mn+1],Rn=gt[Ft-mn];mt[Ft][mn]=qn+Rn;const En=mt[mn][Ft-1]/mt[Ft][mn];mt[mn][Ft]=_n+qn*En,_n=Rn*En}mt[Ft][Ft]=_n}for(let Ft=0;Ft<=He;++Ft)St[0][Ft]=mt[Ft][He];for(let Ft=0;Ft<=He;++Ft){let _n=0,mn=1;const qn=[];for(let Rn=0;Rn<=He;++Rn)qn[Rn]=at.slice(0);qn[0][0]=1;for(let Rn=1;Rn<=tt;++Rn){let En=0;const ai=Ft-Rn,ri=He-Rn;Ft>=Rn&&(qn[mn][0]=qn[_n][0]/mt[ri+1][ai],En=qn[mn][0]*mt[ai][ri]);const Ei=Ft-1<=ri?Rn-1:He-Ft;for(let Xi=ai>=-1?1:-ai;Xi<=Ei;++Xi)qn[mn][Xi]=(qn[_n][Xi]-qn[_n][Xi-1])/mt[ri+1][ai+Xi],En+=qn[mn][Xi]*mt[ai+Xi][ri];Ft<=ri&&(qn[mn][Rn]=-qn[_n][Rn-1]/mt[ri+1][Ft],En+=qn[mn][Rn]*mt[Ft][ri]),St[Rn][Ft]=En;const ki=_n;_n=mn,mn=ki}}let Bt=He;for(let Ft=1;Ft<=tt;++Ft){for(let _n=0;_n<=He;++_n)St[Ft][_n]*=Bt;Bt*=He-Ft}return St}(z,H,C,J,O),me=[];for(let Te=0;Te<N.length;++Te){const Be=N[Te].clone(),He=Be.w;Be.x*=He,Be.y*=He,Be.z*=He,me[Te]=Be}for(let Te=0;Te<=J;++Te){const Be=me[z-C].clone().multiplyScalar(ue[Te][0]);for(let He=1;He<=C;++He)Be.add(me[z-C+He].clone().multiplyScalar(ue[Te][He]));V[Te]=Be}for(let Te=J+1;Te<=q+1;++Te)V[Te]=new s.Ltg(0,0,0);return V}(c,f,m,y,w);return function(C){const O=C.length,N=[],H=[];for(let J=0;J<O;++J){const V=C[J];N[J]=new s.Pa4(V.x,V.y,V.z),H[J]=V.w}const q=[];for(let J=0;J<O;++J){const V=N[J].clone();for(let z=1;z<=J;++z)V.sub(q[J-z].clone().multiplyScalar(d(J,z)*H[z]));q[J]=V.divideScalar(H[0])}return q}(S)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(o[1]).normalize(),n}}let A,E,P;class k extends s.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,c=o.path===""?s.Zp0.extractUrlBase(e):o.path,f=new s.hH6(this.manager);f.setPath(o.path),f.setResponseType("arraybuffer"),f.setRequestHeader(o.requestHeader),f.setWithCredentials(o.withCredentials),f.load(e,function(m){try{t(o.parse(m,c))}catch(y){i?i(y):console.error(y),o.manager.itemError(e)}},n,i)}parse(e,t){if(function(o){const c="Kaydara FBX Binary  \0";return o.byteLength>=c.length&&c===g(o,0,c.length)}(e))A=new ye().parse(e);else{const o=g(e);if(!function(c){const f=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let m=0;function y(w){const S=c[w-1];return c=c.slice(m+w),m++,S}for(let w=0;w<f.length;++w)if(y(1)===f[w])return!1;return!0}(o))throw new Error("THREE.FBXLoader: Unknown format.");if(Ue(o)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ue(o));A=new xe().parse(o)}const n=new s.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),i=new Q(n,this.manager).parse(A);return A=null,E=null,P=null,i}}class Q{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){E=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),o=new G().parse(i);return this.parseScene(i,o,n),P}parseConnections(){const e=new Map;return"Connections"in A&&A.Connections.connections.forEach(function(t){const n=t[0],i=t[1],o=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const c={ID:i,relationship:o};e.get(n).parents.push(c),e.has(i)||e.set(i,{parents:[],children:[]});const f={ID:n,relationship:o};e.get(i).children.push(f)}),e}parseImages(){const e={},t={};if("Video"in A.Objects){const n=A.Objects.Video;for(const i in n){const o=n[i];if(e[parseInt(i)]=o.RelativeFilename||o.Filename,"Content"in o){const c=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,f=typeof o.Content=="string"&&o.Content!=="";if(c||f){const m=this.parseImage(n[i]);t[o.RelativeFilename||o.Filename]=m}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(i){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if(typeof t=="string")return"data:"+o+";base64,"+t;{const c=new Uint8Array(t);return window.URL.createObjectURL(new Blob([c],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in A.Objects){const n=A.Objects.Texture;for(const i in n){const o=this.parseTexture(n[i],e);t.set(parseInt(i),o)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,o=e.WrapModeV,c=i!==void 0?i.value:0,f=o!==void 0?o.value:0;if(n.wrapS=c===0?s.rpg:s.uWy,n.wrapT=f===0?s.rpg:s.uWy,"Scaling"in e){const m=e.Scaling.value;n.repeat.x=m[0],n.repeat.y=m[1]}if("Translation"in e){const m=e.Translation.value;n.offset.x=m[0],n.offset.y=m[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,o=E.get(e.id).children;let c;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const f=e.FileName.slice(-3).toLowerCase();if(f==="tga"){const m=this.manager.getHandler(".tga");m===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),c=new s.xEZ):(m.setPath(this.textureLoader.path),c=m.load(n))}else f==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),c=new s.xEZ):c=this.textureLoader.load(n);return this.textureLoader.setPath(i),c}parseMaterials(e){const t=new Map;if("Material"in A.Objects){const n=A.Objects.Material;for(const i in n){const o=this.parseMaterial(n[i],e);o!==null&&t.set(parseInt(i),o)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!E.has(n))return null;const c=this.parseParameters(e,t,n);let f;switch(o.toLowerCase()){case"phong":f=new s.xoR;break;case"lambert":f=new s.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),f=new s.xoR}return f.setValues(c),f.name=i,f}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new s.Ilk().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(i.color=new s.Ilk().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new s.Ilk().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(i.emissive=new s.Ilk().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new s.Ilk().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new s.Ilk().fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return E.get(n).children.forEach(function(c){const f=c.relationship;switch(f){case"Bump":i.bumpMap=o.getTexture(t,c.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(t,c.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(t,c.ID),i.map!==void 0&&(i.map.colorSpace=s.KI_);break;case"DisplacementColor":i.displacementMap=o.getTexture(t,c.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(t,c.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=s.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(t,c.ID);break;case"ReflectionColor":i.envMap=o.getTexture(t,c.ID),i.envMap!==void 0&&(i.envMap.mapping=s.dSO,i.envMap.colorSpace=s.KI_);break;case"SpecularColor":i.specularMap=o.getTexture(t,c.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=s.KI_);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(t,c.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",f)}}),i}getTexture(e,t){return"LayeredTexture"in A.Objects&&t in A.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=E.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in A.Objects){const n=A.Objects.Deformer;for(const i in n){const o=n[i],c=E.get(parseInt(i));if(o.attrType==="Skin"){const f=this.parseSkeleton(c,n);f.ID=i,c.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),f.geometryID=c.parents[0].ID,e[i]=f}else if(o.attrType==="BlendShape"){const f={id:i};f.rawTargets=this.parseMorphTargets(c,n),f.id=i,c.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=f}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const o=t[i.ID];if(o.attrType!=="Cluster")return;const c={ID:i.ID,indices:[],weights:[],transformLink:new s.yGw().fromArray(o.TransformLink.a)};"Indexes"in o&&(c.indices=o.Indexes.a,c.weights=o.Weights.a),n.push(c)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const o=e.children[i],c=t[o.ID],f={name:c.attrName,initialWeight:c.DeformPercent,id:c.id,fullWeights:c.FullWeights.a};if(c.attrType!=="BlendShapeChannel")return;f.geoID=E.get(parseInt(o.ID)).children.filter(function(m){return m.relationship===void 0})[0].ID,n.push(f)}return n}parseScene(e,t,n){P=new s.ZAu;const i=this.parseModels(e.skeletons,t,n),o=A.Objects.Model,c=this;i.forEach(function(m){const y=o[m.ID];c.setLookAtProperties(m,y),E.get(m.ID).parents.forEach(function(w){const S=i.get(w.ID);S!==void 0&&S.add(m)}),m.parent===null&&P.add(m)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),P.traverse(function(m){if(m.userData.transformData){m.parent&&(m.userData.transformData.parentMatrix=m.parent.matrix,m.userData.transformData.parentMatrixWorld=m.parent.matrixWorld);const y=Et(m.userData.transformData);m.applyMatrix4(y),m.updateWorldMatrix()}});const f=new re().parse();P.children.length===1&&P.children[0].isGroup&&(P.children[0].animations=f,P=P.children[0]),P.animations=f}parseModels(e,t,n){const i=new Map,o=A.Objects.Model;for(const c in o){const f=parseInt(c),m=o[c],y=E.get(f);let w=this.buildSkeleton(y,e,f,m.attrName);if(!w){switch(m.attrType){case"Camera":w=this.createCamera(y);break;case"Light":w=this.createLight(y);break;case"Mesh":w=this.createMesh(y,t,n);break;case"NurbsCurve":w=this.createCurve(y,t);break;case"LimbNode":case"Root":w=new s.N$j;break;default:w=new s.ZAu}w.name=m.attrName?s.iUV.sanitizeNodeName(m.attrName):"",w.ID=f}this.getTransformData(w,m),i.set(f,w)}return i}buildSkeleton(e,t,n,i){let o=null;return e.parents.forEach(function(c){for(const f in t){const m=t[f];m.rawBones.forEach(function(y,w){if(y.ID===c.ID){const S=o;o=new s.N$j,o.matrixWorld.copy(y.transformLink),o.name=i?s.iUV.sanitizeNodeName(i):"",o.ID=n,m.bones[w]=o,S!==null&&o.add(S)}})}}),o}createCamera(e){let t,n;if(e.children.forEach(function(i){const o=A.Objects.NodeAttribute[i.ID];o!==void 0&&(n=o)}),n===void 0)t=new s.Tme;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let c=1e3;n.FarPlane!==void 0&&(c=n.FarPlane.value/1e3);let f=window.innerWidth,m=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(f=n.AspectWidth.value,m=n.AspectHeight.value);const y=f/m;let w=45;n.FieldOfView!==void 0&&(w=n.FieldOfView.value);const S=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new s.cPb(w,y,o,c),S!==null&&t.setFocalLength(S);break;case 1:t=new s.iKG(-f/2,f/2,m/2,-m/2,o,c);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new s.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const o=A.Objects.NodeAttribute[i.ID];o!==void 0&&(n=o)}),n===void 0)t=new s.Tme;else{let i;i=n.LightType===void 0?0:n.LightType.value;let o=16777215;n.Color!==void 0&&(o=new s.Ilk().fromArray(n.Color.value).convertSRGBToLinear());let c=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(c=0);let f=0;n.FarAttenuationEnd!==void 0&&(f=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const m=1;switch(i){case 0:t=new s.cek(o,c,f,m);break;case 1:t=new s.Ox3(o,c);break;case 2:let y=Math.PI/3;n.InnerAngle!==void 0&&(y=s.M8C.degToRad(n.InnerAngle.value));let w=0;n.OuterAngle!==void 0&&(w=s.M8C.degToRad(n.OuterAngle.value),w=Math.max(w,1)),t=new s.PMe(o,c,f,y,w,m);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new s.cek(o,c)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,o=null,c=null;const f=[];return e.children.forEach(function(m){t.has(m.ID)&&(o=t.get(m.ID)),n.has(m.ID)&&f.push(n.get(m.ID))}),f.length>1?c=f:f.length>0?c=f[0]:(c=new s.xoR({color:13421772}),f.push(c)),"color"in o.attributes&&f.forEach(function(m){m.vertexColors=!0}),o.FBX_Deformer?(i=new s.TUv(o,c),i.normalizeSkinWeights()):i=new s.Kj0(o,c),i}createCurve(e,t){const n=e.children.reduce(function(o,c){return t.has(c.ID)&&(o=t.get(c.ID)),o},null),i=new s.nls({color:3342591,linewidth:1});return new s.x12(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?xt(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&E.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const i=A.Objects.Model[n.ID];if("Lcl_Translation"in i){const o=i.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),P.add(e.target)):e.lookAt(new s.Pa4().fromArray(o))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const o in e){const c=e[o];E.get(parseInt(c.ID)).parents.forEach(function(f){if(t.has(f.ID)){const m=f.ID;E.get(m).parents.forEach(function(y){n.has(y.ID)&&n.get(y.ID).bind(new s.OdW(c.bones),i[y.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in A.Objects){const t=A.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(o){e[o.Node]=new s.yGw().fromArray(o.Matrix.a)}):e[i.Node]=new s.yGw().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in A&&"AmbientColor"in A.GlobalSettings){const e=A.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const o=new s.Ilk(t,n,i).convertSRGBToLinear();P.add(new s.Mig(o,1))}}}}class G{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in A.Objects){const n=A.Objects.Geometry;for(const i in n){const o=E.get(parseInt(i)),c=this.parseGeometry(o,n[i],e);t.set(parseInt(i),c)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,o=[],c=e.parents.map(function(S){return A.Objects.Model[S.ID]});if(c.length===0)return;const f=e.children.reduce(function(S,C){return i[C.ID]!==void 0&&(S=i[C.ID]),S},null);e.children.forEach(function(S){n.morphTargets[S.ID]!==void 0&&o.push(n.morphTargets[S.ID])});const m=c[0],y={};"RotationOrder"in m&&(y.eulerOrder=xt(m.RotationOrder.value)),"InheritType"in m&&(y.inheritType=parseInt(m.InheritType.value)),"GeometricTranslation"in m&&(y.translation=m.GeometricTranslation.value),"GeometricRotation"in m&&(y.rotation=m.GeometricRotation.value),"GeometricScaling"in m&&(y.scale=m.GeometricScaling.value);const w=Et(y);return this.genGeometry(t,f,o,w)}genGeometry(e,t,n,i){const o=new s.u9r;e.attrName&&(o.name=e.attrName);const c=this.parseGeoNode(e,t),f=this.genBuffers(c),m=new s.a$l(f.vertex,3);if(m.applyMatrix4(i),o.setAttribute("position",m),f.colors.length>0&&o.setAttribute("color",new s.a$l(f.colors,3)),t&&(o.setAttribute("skinIndex",new s.qlB(f.weightsIndices,4)),o.setAttribute("skinWeight",new s.a$l(f.vertexWeights,4)),o.FBX_Deformer=t),f.normal.length>0){const y=new s.Vkp().getNormalMatrix(i),w=new s.a$l(f.normal,3);w.applyNormalMatrix(y),o.setAttribute("normal",w)}if(f.uvs.forEach(function(y,w){const S=w===0?"uv":`uv${w}`;o.setAttribute(S,new s.a$l(f.uvs[w],2))}),c.material&&c.material.mappingType!=="AllSame"){let y=f.materialIndex[0],w=0;if(f.materialIndex.forEach(function(S,C){S!==y&&(o.addGroup(w,C-w,y),y=S,w=C)}),o.groups.length>0){const S=o.groups[o.groups.length-1],C=S.start+S.count;C!==f.materialIndex.length&&o.addGroup(C,f.materialIndex.length-C,y)}o.groups.length===0&&o.addGroup(0,f.materialIndex.length,f.materialIndex[0])}return this.addMorphTargets(o,e,n,i),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,o){i.indices.forEach(function(c,f){n.weightTable[c]===void 0&&(n.weightTable[c]=[]),n.weightTable[c].push({id:o,weight:i.weights[f]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,o=!1,c=[],f=[],m=[],y=[],w=[],S=[];const C=this;return e.vertexIndices.forEach(function(O,N){let H,q=!1;O<0&&(O^=-1,q=!0);let J=[],V=[];if(c.push(3*O,3*O+1,3*O+2),e.color){const z=Ge(N,n,O,e.color);m.push(z[0],z[1],z[2])}if(e.skeleton){if(e.weightTable[O]!==void 0&&e.weightTable[O].forEach(function(z){V.push(z.weight),J.push(z.id)}),V.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const z=[0,0,0,0],ue=[0,0,0,0];V.forEach(function(me,Te){let Be=me,He=J[Te];ue.forEach(function(tt,lt,at){if(Be>tt){at[lt]=Be,Be=tt;const St=z[lt];z[lt]=He,He=St}})}),J=z,V=ue}for(;V.length<4;)V.push(0),J.push(0);for(let z=0;z<4;++z)w.push(V[z]),S.push(J[z])}if(e.normal){const z=Ge(N,n,O,e.normal);f.push(z[0],z[1],z[2])}e.material&&e.material.mappingType!=="AllSame"&&(H=Ge(N,n,O,e.material)[0],H<0&&(C.negativeMaterialIndices=!0,H=0)),e.uv&&e.uv.forEach(function(z,ue){const me=Ge(N,n,O,z);y[ue]===void 0&&(y[ue]=[]),y[ue].push(me[0]),y[ue].push(me[1])}),i++,q&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),C.genFace(t,e,c,H,f,m,y,w,S,i),n++,i=0,c=[],f=[],m=[],y=[],w=[],S=[])}),t}genFace(e,t,n,i,o,c,f,m,y,w){for(let S=2;S<w;S++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(S-1)]]),e.vertex.push(t.vertexPositions[n[3*(S-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(S-1)+2]]),e.vertex.push(t.vertexPositions[n[3*S]]),e.vertex.push(t.vertexPositions[n[3*S+1]]),e.vertex.push(t.vertexPositions[n[3*S+2]]),t.skeleton&&(e.vertexWeights.push(m[0]),e.vertexWeights.push(m[1]),e.vertexWeights.push(m[2]),e.vertexWeights.push(m[3]),e.vertexWeights.push(m[4*(S-1)]),e.vertexWeights.push(m[4*(S-1)+1]),e.vertexWeights.push(m[4*(S-1)+2]),e.vertexWeights.push(m[4*(S-1)+3]),e.vertexWeights.push(m[4*S]),e.vertexWeights.push(m[4*S+1]),e.vertexWeights.push(m[4*S+2]),e.vertexWeights.push(m[4*S+3]),e.weightsIndices.push(y[0]),e.weightsIndices.push(y[1]),e.weightsIndices.push(y[2]),e.weightsIndices.push(y[3]),e.weightsIndices.push(y[4*(S-1)]),e.weightsIndices.push(y[4*(S-1)+1]),e.weightsIndices.push(y[4*(S-1)+2]),e.weightsIndices.push(y[4*(S-1)+3]),e.weightsIndices.push(y[4*S]),e.weightsIndices.push(y[4*S+1]),e.weightsIndices.push(y[4*S+2]),e.weightsIndices.push(y[4*S+3])),t.color&&(e.colors.push(c[0]),e.colors.push(c[1]),e.colors.push(c[2]),e.colors.push(c[3*(S-1)]),e.colors.push(c[3*(S-1)+1]),e.colors.push(c[3*(S-1)+2]),e.colors.push(c[3*S]),e.colors.push(c[3*S+1]),e.colors.push(c[3*S+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(S-1)]),e.normal.push(o[3*(S-1)+1]),e.normal.push(o[3*(S-1)+2]),e.normal.push(o[3*S]),e.normal.push(o[3*S+1]),e.normal.push(o[3*S+2])),t.uv&&t.uv.forEach(function(C,O){e.uvs[O]===void 0&&(e.uvs[O]=[]),e.uvs[O].push(f[O][0]),e.uvs[O].push(f[O][1]),e.uvs[O].push(f[O][2*(S-1)]),e.uvs[O].push(f[O][2*(S-1)+1]),e.uvs[O].push(f[O][2*S]),e.uvs[O].push(f[O][2*S+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(c){c.rawTargets.forEach(function(f){const m=A.Objects.Geometry[f.geoID];m!==void 0&&o.genMorphGeometry(e,t,m,i,f.name)})})}genMorphGeometry(e,t,n,i,o){const c=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],f=n.Vertices!==void 0?n.Vertices.a:[],m=n.Indexes!==void 0?n.Indexes.a:[],y=3*e.attributes.position.count,w=new Float32Array(y);for(let N=0;N<m.length;N++){const H=3*m[N];w[H]=f[3*N],w[H+1]=f[3*N+1],w[H+2]=f[3*N+2]}const S={vertexIndices:c,vertexPositions:w},C=this.genBuffers(S),O=new s.a$l(C.vertex,3);O.name=o||n.attrName,O.applyMatrix4(i),e.morphAttributes.position.push(O)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:o,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:i,indices:o,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let o=[];n==="IndexToDirect"&&(o=e.ColorIndex.a);for(let c=0,f=new s.Ilk;c<i.length;c+=4)f.fromArray(i,c).convertSRGBToLinear().toArray(i,c);return{dataSize:4,buffer:i,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,o=[];for(let c=0;c<i.length;++c)o.push(c);return{dataSize:1,buffer:i,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new s.u9r;const n=t-1,i=e.KnotVector.a,o=[],c=e.Points.a;for(let w=0,S=c.length;w<S;w+=4)o.push(new s.Ltg().fromArray(c,w));let f,m;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){f=n,m=i.length-1-f;for(let w=0;w<n;++w)o.push(o[w])}const y=new _(n,i,o,f,m).getPoints(12*o.length);return new s.u9r().setFromPoints(y)}}class re{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],o=this.addClip(i);e.push(o)}return e}parseClips(){if(A.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=A.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:i.id,attr:i.attrName,curves:{}};t.set(o.id,o)}}return t}parseAnimationCurves(e){const t=A.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Oe),values:t[n].KeyValueFloat.a},o=E.get(i.id);if(o!==void 0){const c=o.parents[0].ID,f=o.parents[0].relationship;f.match(/X/)?e.get(c).curves.x=i:f.match(/Y/)?e.get(c).curves.y=i:f.match(/Z/)?e.get(c).curves.z=i:f.match(/DeformPercent/)&&e.has(c)&&(e.get(c).curves.morph=i)}}}parseAnimationLayers(e){const t=A.Objects.AnimationLayer,n=new Map;for(const i in t){const o=[],c=E.get(parseInt(i));c!==void 0&&(c.children.forEach(function(f,m){if(e.has(f.ID)){const y=e.get(f.ID);if(y.curves.x!==void 0||y.curves.y!==void 0||y.curves.z!==void 0){if(o[m]===void 0){const w=E.get(f.ID).parents.filter(function(S){return S.relationship!==void 0})[0].ID;if(w!==void 0){const S=A.Objects.Model[w.toString()];if(S===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",f);const C={modelName:S.attrName?s.iUV.sanitizeNodeName(S.attrName):"",ID:S.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};P.traverse(function(O){O.ID===S.id&&(C.transform=O.matrix,O.userData.transformData&&(C.eulerOrder=O.userData.transformData.eulerOrder))}),C.transform||(C.transform=new s.yGw),"PreRotation"in S&&(C.preRotation=S.PreRotation.value),"PostRotation"in S&&(C.postRotation=S.PostRotation.value),o[m]=C}}o[m]&&(o[m][y.attr]=y)}else if(y.curves.morph!==void 0){if(o[m]===void 0){const w=E.get(f.ID).parents.filter(function(q){return q.relationship!==void 0})[0].ID,S=E.get(w).parents[0].ID,C=E.get(S).parents[0].ID,O=E.get(C).parents[0].ID,N=A.Objects.Model[O],H={modelName:N.attrName?s.iUV.sanitizeNodeName(N.attrName):"",morphName:A.Objects.Deformer[w].attrName};o[m]=H}o[m][y.attr]=y}}}),n.set(parseInt(i),o))}return n}parseAnimStacks(e){const t=A.Objects.AnimationStack,n={};for(const i in t){const o=E.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const c=e.get(o[0].ID);n[i]={name:t[i].attrName,layer:c}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new s.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new s.Pa4,i=new s._fP,o=new s.Pa4;if(e.transform&&e.transform.decompose(n,i,o),n=n.toArray(),i=new s.USm().setFromQuaternion(i,e.eulerOrder).toArray(),o=o.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const c=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");c!==void 0&&t.push(c)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const c=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);c!==void 0&&t.push(c)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const c=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");c!==void 0&&t.push(c)}if(e.DeformPercent!==void 0){const c=this.generateMorphTrack(e);c!==void 0&&t.push(c)}return t}generateVectorTrack(e,t,n,i){const o=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(o,t,n);return new s.yC1(e+"."+i,o,c)}generateRotationTrack(e,t,n,i,o,c){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(s.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(s.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(s.M8C.degToRad));const f=this.getTimesForAllAxes(t),m=this.getKeyframeTrackValues(f,t,n);i!==void 0&&((i=i.map(s.M8C.degToRad)).push(c),i=new s.USm().fromArray(i),i=new s._fP().setFromEuler(i)),o!==void 0&&((o=o.map(s.M8C.degToRad)).push(c),o=new s.USm().fromArray(o),o=new s._fP().setFromEuler(o).invert());const y=new s._fP,w=new s.USm,S=[];for(let C=0;C<m.length;C+=3)w.set(m[C],m[C+1],m[C+2],c),y.setFromEuler(w),i!==void 0&&y.premultiply(i),o!==void 0&&y.multiply(o),y.toArray(S,C/3*4);return new s.iLg(e+".quaternion",f,S)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(o){return o/100}),i=P.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new s.dUE(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let o=1;o<t.length;o++){const c=t[o];c!==i&&(t[n]=c,i=c,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,o=[];let c=-1,f=-1,m=-1;return e.forEach(function(y){if(t.x&&(c=t.x.times.indexOf(y)),t.y&&(f=t.y.times.indexOf(y)),t.z&&(m=t.z.times.indexOf(y)),c!==-1){const w=t.x.values[c];o.push(w),i[0]=w}else o.push(i[0]);if(f!==-1){const w=t.y.values[f];o.push(w),i[1]=w}else o.push(i[1]);if(m!==-1){const w=t.z.values[m];o.push(w),i[2]=w}else o.push(i[2])}),o}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,o=Math.abs(i);if(o>=180){const c=o/180,f=i/c;let m=n+f;const y=e.times[t-1],w=(e.times[t]-y)/c;let S=y+w;const C=[],O=[];for(;S<e.times[t];)C.push(S),S+=w,O.push(m),m+=f;e.times=b(e.times,t,C),e.values=b(e.values,t,O)}}}}class xe{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Ie,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,o){const c=i.match(/^[\s\t]*;/),f=i.match(/^[\s\t]*$/);if(c||f)return;const m=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),y=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),w=i.match("^\\t{"+(t.currentIndent-1)+"}}");m?t.parseNodeBegin(i,m):y?t.parseNodeProperty(i,y,n[++o]):w?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(m){return m.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},c=this.parseNodeAttr(i),f=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in f?(n==="PoseNode"?f.PoseNode.push(o):f[n].id!==void 0&&(f[n]={},f[n][f[n].id]=f[n]),c.id!==""&&(f[n][c.id]=o)):typeof c.id=="number"?(f[n]={},f[n][c.id]=o):n!=="Properties70"&&(f[n]=n==="PoseNode"?[o]:o),typeof c.id=="number"&&(o.id=c.id),c.name!==""&&(o.attrName=c.name),c.type!==""&&(o.attrType=c.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const c=this.getCurrentNode();if(c.name!=="Properties70"){if(i==="C"){const f=o.split(",").slice(1),m=parseInt(f[0]),y=parseInt(f[1]);let w=o.split(",").slice(3);w=w.map(function(S){return S.trim().replace(/^"/,"")}),i="connections",o=[m,y],function(S,C){for(let O=0,N=S.length,H=C.length;O<H;O++,N++)S[N]=C[O]}(o,w),c[i]===void 0&&(c[i]=[])}i==="Node"&&(c.id=o),i in c&&Array.isArray(c[i])?c[i].push(o):i!=="a"?c[i]=o:c.a=o,this.setCurrentProp(c,i),i==="a"&&o.slice(-1)!==","&&(c.a=Zt(o))}else this.parseNodeSpecialProperty(e,i,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Zt(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(w){return w.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=i[0],c=i[1],f=i[2],m=i[3];let y=i[4];switch(c){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":y=parseFloat(y);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":y=Zt(y)}this.getPrevNode()[o]={type:c,type2:f,flag:m,value:y},this.setCurrentProp(this.getPrevNode(),o)}}class ye{parse(e){const t=new Ee(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new Ie;for(;!this.endOfContent(t);){const o=this.parseNode(t,n);o!==null&&i.add(o.name,o)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const c=e.getUint8(),f=e.getString(c);if(i===0)return null;const m=[];for(let C=0;C<o;C++)m.push(this.parseProperty(e));const y=m.length>0?m[0]:"",w=m.length>1?m[1]:"",S=m.length>2?m[2]:"";for(n.singleProperty=o===1&&e.getOffset()===i;i>e.getOffset();){const C=this.parseNode(e,t);C!==null&&this.parseSubNode(f,n,C)}return n.propertyList=m,typeof y=="number"&&(n.id=y),w!==""&&(n.attrName=w),S!==""&&(n.attrType=S),f!==""&&(n.name=f),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(o,c){c!==0&&i.push(o)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(i){t[i]=n[i]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],o=n.propertyList[1];const c=n.propertyList[2],f=n.propertyList[3];let m;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),m=o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[i]={type:o,type2:c,flag:f,value:m}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),o=e.getUint32(),c=e.getUint32();if(o===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const f=P_(new Uint8Array(e.getArrayBuffer(c))),m=new Ee(f.buffer);switch(t){case"b":case"c":return m.getBooleanArray(i);case"d":return m.getFloat64Array(i);case"f":return m.getFloat32Array(i);case"i":return m.getInt32Array(i);case"l":return m.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Ee{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class Ie{add(e,t){this[e]=t}}function Ue(l){const e=l.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Oe(l){return l/46186158e3}const ke=[];function Ge(l,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=l;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const o=i*n.dataSize,c=o+n.dataSize;return function(f,m,y,w){for(let S=y,C=0;S<w;S++,C++)f[C]=m[S];return f}(ke,n.buffer,o,c)}const Je=new s.USm,Rt=new s.Pa4;function Et(l){const e=new s.yGw,t=new s.yGw,n=new s.yGw,i=new s.yGw,o=new s.yGw,c=new s.yGw,f=new s.yGw,m=new s.yGw,y=new s.yGw,w=new s.yGw,S=new s.yGw,C=new s.yGw,O=l.inheritType?l.inheritType:0;if(l.translation&&e.setPosition(Rt.fromArray(l.translation)),l.preRotation){const lt=l.preRotation.map(s.M8C.degToRad);lt.push(l.eulerOrder||s.USm.DEFAULT_ORDER),t.makeRotationFromEuler(Je.fromArray(lt))}if(l.rotation){const lt=l.rotation.map(s.M8C.degToRad);lt.push(l.eulerOrder||s.USm.DEFAULT_ORDER),n.makeRotationFromEuler(Je.fromArray(lt))}if(l.postRotation){const lt=l.postRotation.map(s.M8C.degToRad);lt.push(l.eulerOrder||s.USm.DEFAULT_ORDER),i.makeRotationFromEuler(Je.fromArray(lt)),i.invert()}l.scale&&o.scale(Rt.fromArray(l.scale)),l.scalingOffset&&f.setPosition(Rt.fromArray(l.scalingOffset)),l.scalingPivot&&c.setPosition(Rt.fromArray(l.scalingPivot)),l.rotationOffset&&m.setPosition(Rt.fromArray(l.rotationOffset)),l.rotationPivot&&y.setPosition(Rt.fromArray(l.rotationPivot)),l.parentMatrixWorld&&(S.copy(l.parentMatrix),w.copy(l.parentMatrixWorld));const N=t.clone().multiply(n).multiply(i),H=new s.yGw;H.extractRotation(w);const q=new s.yGw;q.copyPosition(w);const J=q.clone().invert().multiply(w),V=H.clone().invert().multiply(J),z=o,ue=new s.yGw;if(O===0)ue.copy(H).multiply(N).multiply(V).multiply(z);else if(O===1)ue.copy(H).multiply(V).multiply(N).multiply(z);else{const lt=new s.yGw().scale(new s.Pa4().setFromMatrixScale(S)).clone().invert(),at=V.clone().multiply(lt);ue.copy(H).multiply(N).multiply(at).multiply(z)}const me=y.clone().invert(),Te=c.clone().invert();let Be=e.clone().multiply(m).multiply(y).multiply(t).multiply(n).multiply(i).multiply(me).multiply(f).multiply(c).multiply(o).multiply(Te);const He=new s.yGw().copyPosition(Be),tt=w.clone().multiply(He);return C.copyPosition(tt),Be=C.clone().multiply(ue),Be.premultiply(w.invert()),Be}function xt(l){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(l=l||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[l]}function Zt(l){return l.split(",").map(function(e){return parseFloat(e)})}function g(l,e,t){return e===void 0&&(e=0),t===void 0&&(t=l.byteLength),new TextDecoder().decode(new Uint8Array(l,e,t))}function b(l,e,t){return l.slice(0,e).concat(t).concat(l.slice(e))}class D extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi],this._importer=new Js(k,["fbx"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n,i,o;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&((o=(i=e.getManager())==null?void 0:i.importer)==null||o.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1))}}D.PluginType="FBXLoadPlugin";const L=new s.cPb(45,1,.1,1e3);function Y(l,e,t,n=7,i=new s.Pa4(0,0,1.5)){t=t??l.scene.modelObject;const o=new X().expandByObject(t??e,!0,!0),c=o.getCenter(new s.Pa4),f=o.getSize(new s.Pa4);L.position.copy(c).add(i.clone().multiplyScalar(Math.max(f.x,f.y,f.z))),L.lookAt(c),e&&e.traverseVisible(w=>{w.layers.enable(n)}),n>0?L.layers.set(n):L.layers.enableAll();const m=e==null?void 0:e.visible;e&&(e.visible=!0),l.renderer.rendererObject.setRenderTarget(null),l.renderer.rendererObject.render(t,L);const y=l.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=m,e.traverseVisible(w=>{w.layers.disable(n)}),L.layers.enableAll()),l.setDirty(),y}class ne{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new s.Kj0(new s.xo$(1)),cube:new s.Kj0(new s.DvJ(1,1,1)),cylinder:new s.Kj0(new s.fHI(.5,.5,1))};const t=new s.xsS;this._channel=7;const n=new s.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new s.Kj0(new s.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const i=n.material.envMapIntensity;typeof i=="number"&&(n.material.envMapIntensity=Math.max(i,2));const o=Y(this.viewer,n,this._scene,this._channel,new s.Pa4(0,0,1.5));return typeof i=="number"&&(n.material.envMapIntensity=i),this._scene.remove(n),n.material=void 0,o}}class be extends Ri{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e))},this.dependencies=[fi],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)==null?void 0:e.getSelectedObject())==null?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(zc).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())==null?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(t=>this.applyVariation(t,t.materials[0].uuid))}}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new ne(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())==null?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())==null?void 0:t.name)}applyVariation(e,t){var o,c;const n=e.materials.find(f=>f.uuid===t),i=(c=(o=this._viewer)==null?void 0:o.getManager())==null?void 0:c.materials;return!!i&&!!n&&i.applyMaterial(n,e.uuid)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var n;const t=(n=e==null?void 0:e.clone)==null?void 0:n.call(e);if(e&&t){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i||this.variations.push(i={uuid:e.name.length>0?e.name:e.uuid,title:e.name.length>0?e.name:"No Name",preview:"generate:sphere",materials:[]}),i.materials.push(t),this.refreshUi()}}}be.PluginType="MaterialConfiguratorBasePlugin",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([ze()],be.prototype,"variations",void 0);class Me{static _initialize(){this._inited=!0,(0,a.createStyles)(a.css`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(e,t,n,i,o,c,f){var C;this._inited||this._initialize();const m=(0,a.mobileAndTabletCheck)(),y=m?.15:.25,w=m?1.5:2.5,S=(0,a.createDiv)({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});S.style.top=o+"px",S.style.left=i+"px",S.style.gap=y+"rem",S.style.width=(w+y)*n-y+"rem",S.dataset.tag=e;for(const O of c){const N=(0,a.createDiv)({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${O.image}" class="customContextGridItemImage">
            `});N.style.width=w+"rem",N.style.height=w+"rem",S.appendChild(N),N.onclick=()=>{var H;return(H=O.onClick)==null?void 0:H.call(O,O.id)},f(N,O)}return(C=this.Elements)==null||C.push(S),S}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=(0,a.createDiv)({addToBody:!0,classList:["customContextGridParent"]}));for(const n of this.Elements)n.remove();this._container.innerHTML="";let t=20;e.appendChild(this._container);for(const n of this.Elements)n.style.top=t+"px",this._container.appendChild(n),t+=n.clientHeight+20}}function De(l){if(l==null)return window;if(l.toString()!=="[object Window]"){var e=l.ownerDocument;return e&&e.defaultView||window}return l}function je(l){return l instanceof De(l).Element||l instanceof Element}function st(l){return l instanceof De(l).HTMLElement||l instanceof HTMLElement}function nt(l){return typeof ShadowRoot<"u"&&(l instanceof De(l).ShadowRoot||l instanceof ShadowRoot)}Me.Elements=[],Me._inited=!1,Me._container=document.createElement("div");var ot=Math.max,Vt=Math.min,Jt=Math.round;function en(){var l=navigator.userAgentData;return l!=null&&l.brands?l.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Yt(){return!/^((?!chrome|android).)*safari/i.test(en())}function ln(l,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=l.getBoundingClientRect(),i=1,o=1;e&&st(l)&&(i=l.offsetWidth>0&&Jt(n.width)/l.offsetWidth||1,o=l.offsetHeight>0&&Jt(n.height)/l.offsetHeight||1);var c=(je(l)?De(l):window).visualViewport,f=!Yt()&&t,m=(n.left+(f&&c?c.offsetLeft:0))/i,y=(n.top+(f&&c?c.offsetTop:0))/o,w=n.width/i,S=n.height/o;return{width:w,height:S,top:y,right:m+w,bottom:y+S,left:m,x:m,y}}function et(l){var e=De(l);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function $e(l){return l?(l.nodeName||"").toLowerCase():null}function Gt(l){return((je(l)?l.ownerDocument:l.document)||window.document).documentElement}function Ut(l){return ln(Gt(l)).left+et(l).scrollLeft}function yt(l){return De(l).getComputedStyle(l)}function wt(l){var e=yt(l),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function qe(l,e,t){t===void 0&&(t=!1);var n,i,o=st(e),c=st(e)&&function(S){var C=S.getBoundingClientRect(),O=Jt(C.width)/S.offsetWidth||1,N=Jt(C.height)/S.offsetHeight||1;return O!==1||N!==1}(e),f=Gt(e),m=ln(l,c,t),y={scrollLeft:0,scrollTop:0},w={x:0,y:0};return(o||!o&&!t)&&(($e(e)!=="body"||wt(f))&&(y=(n=e)!==De(n)&&st(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:et(n)),st(e)?((w=ln(e,!0)).x+=e.clientLeft,w.y+=e.clientTop):f&&(w.x=Ut(f))),{x:m.left+y.scrollLeft-w.x,y:m.top+y.scrollTop-w.y,width:m.width,height:m.height}}function Ct(l){var e=ln(l),t=l.offsetWidth,n=l.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:l.offsetLeft,y:l.offsetTop,width:t,height:n}}function Dt(l){return $e(l)==="html"?l:l.assignedSlot||l.parentNode||(nt(l)?l.host:null)||Gt(l)}function hn(l){return["html","body","#document"].indexOf($e(l))>=0?l.ownerDocument.body:st(l)&&wt(l)?l:hn(Dt(l))}function Kt(l,e){var t;e===void 0&&(e=[]);var n=hn(l),i=n===((t=l.ownerDocument)==null?void 0:t.body),o=De(n),c=i?[o].concat(o.visualViewport||[],wt(n)?n:[]):n,f=e.concat(c);return i?f:f.concat(Kt(Dt(c)))}function yn(l){return["table","td","th"].indexOf($e(l))>=0}function ii(l){return st(l)&&yt(l).position!=="fixed"?l.offsetParent:null}function Ui(l){for(var e=De(l),t=ii(l);t&&yn(t)&&yt(t).position==="static";)t=ii(t);return t&&($e(t)==="html"||$e(t)==="body"&&yt(t).position==="static")?e:t||function(n){var i=/firefox/i.test(en());if(/Trident/i.test(en())&&st(n)&&yt(n).position==="fixed")return null;var o=Dt(n);for(nt(o)&&(o=o.host);st(o)&&["html","body"].indexOf($e(o))<0;){var c=yt(o);if(c.transform!=="none"||c.perspective!=="none"||c.contain==="paint"||["transform","perspective"].indexOf(c.willChange)!==-1||i&&c.willChange==="filter"||i&&c.filter&&c.filter!=="none")return o;o=o.parentNode}return null}(l)||e}var Bi="top",ci="bottom",Ii="right",$i="left",sr="auto",xs=[Bi,ci,Ii,$i],yo="start",Pr="end",ds="clippingParents",Ss="viewport",lu="popper",Jn="reference",xl=xs.reduce(function(l,e){return l.concat([e+"-"+yo,e+"-"+Pr])},[]),Vd=[].concat(xs,[sr]).reduce(function(l,e){return l.concat([e,e+"-"+yo,e+"-"+Pr])},[]),wl="beforeRead",Zh="read",zp="afterRead",D_="beforeMain",qt="main",cn="afterMain",$n="beforeWrite",_i="write",hi="afterWrite",Di=[wl,Zh,zp,D_,qt,cn,$n,_i,hi];function qi(l){var e=new Map,t=new Set,n=[];function i(o){t.add(o.name),[].concat(o.requires||[],o.requiresIfExists||[]).forEach(function(c){if(!t.has(c)){var f=e.get(c);f&&i(f)}}),n.push(o)}return l.forEach(function(o){e.set(o.name,o)}),l.forEach(function(o){t.has(o.name)||i(o)}),n}var wi={placement:"bottom",modifiers:[],strategy:"absolute"};function Li(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function vi(l){l===void 0&&(l={});var e=l,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?wi:i;return function(c,f,m){m===void 0&&(m=o);var y,w,S={placement:"bottom",orderedModifiers:[],options:Object.assign({},wi,o),modifiersData:{},elements:{reference:c,popper:f},attributes:{},styles:{}},C=[],O=!1,N={state:S,setOptions:function(q){var J=typeof q=="function"?q(S.options):q;H(),S.options=Object.assign({},o,S.options,J),S.scrollParents={reference:je(c)?Kt(c):c.contextElement?Kt(c.contextElement):[],popper:Kt(f)};var V,z,ue=function(me){var Te=qi(me);return Di.reduce(function(Be,He){return Be.concat(Te.filter(function(tt){return tt.phase===He}))},[])}((V=[].concat(n,S.options.modifiers),z=V.reduce(function(me,Te){var Be=me[Te.name];return me[Te.name]=Be?Object.assign({},Be,Te,{options:Object.assign({},Be.options,Te.options),data:Object.assign({},Be.data,Te.data)}):Te,me},{}),Object.keys(z).map(function(me){return z[me]})));return S.orderedModifiers=ue.filter(function(me){return me.enabled}),S.orderedModifiers.forEach(function(me){var Te=me.name,Be=me.options,He=Be===void 0?{}:Be,tt=me.effect;if(typeof tt=="function"){var lt=tt({state:S,name:Te,instance:N,options:He});C.push(lt||function(){})}}),N.update()},forceUpdate:function(){if(!O){var q=S.elements,J=q.reference,V=q.popper;if(Li(J,V)){S.rects={reference:qe(J,Ui(V),S.options.strategy==="fixed"),popper:Ct(V)},S.reset=!1,S.placement=S.options.placement,S.orderedModifiers.forEach(function(tt){return S.modifiersData[tt.name]=Object.assign({},tt.data)});for(var z=0;z<S.orderedModifiers.length;z++)if(S.reset!==!0){var ue=S.orderedModifiers[z],me=ue.fn,Te=ue.options,Be=Te===void 0?{}:Te,He=ue.name;typeof me=="function"&&(S=me({state:S,options:Be,name:He,instance:N})||S)}else S.reset=!1,z=-1}}},update:(y=function(){return new Promise(function(q){N.forceUpdate(),q(S)})},function(){return w||(w=new Promise(function(q){Promise.resolve().then(function(){w=void 0,q(y())})})),w}),destroy:function(){H(),O=!0}};if(!Li(c,f))return N;function H(){C.forEach(function(q){return q()}),C=[]}return N.setOptions(m).then(function(q){!O&&m.onFirstUpdate&&m.onFirstUpdate(q)}),N}}var mr=vi(),Tt={passive:!0},fn={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(l){var e=l.state,t=l.instance,n=l.options,i=n.scroll,o=i===void 0||i,c=n.resize,f=c===void 0||c,m=De(e.elements.popper),y=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&y.forEach(function(w){w.addEventListener("scroll",t.update,Tt)}),f&&m.addEventListener("resize",t.update,Tt),function(){o&&y.forEach(function(w){w.removeEventListener("scroll",t.update,Tt)}),f&&m.removeEventListener("resize",t.update,Tt)}},data:{}};function xn(l){return l.split("-")[0]}function Dn(l){return l.split("-")[1]}function ti(l){return["top","bottom"].indexOf(l)>=0?"x":"y"}function Oi(l){var e,t=l.reference,n=l.element,i=l.placement,o=i?xn(i):null,c=i?Dn(i):null,f=t.x+t.width/2-n.width/2,m=t.y+t.height/2-n.height/2;switch(o){case Bi:e={x:f,y:t.y-n.height};break;case ci:e={x:f,y:t.y+t.height};break;case Ii:e={x:t.x+t.width,y:m};break;case $i:e={x:t.x-n.width,y:m};break;default:e={x:t.x,y:t.y}}var y=o?ti(o):null;if(y!=null){var w=y==="y"?"height":"width";switch(c){case yo:e[y]=e[y]-(t[w]/2-n[w]/2);break;case Pr:e[y]=e[y]+(t[w]/2-n[w]/2)}}return e}var hr={name:"popperOffsets",enabled:!0,phase:"read",fn:function(l){var e=l.state,t=l.name;e.modifiersData[t]=Oi({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},gr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function es(l){var e,t=l.popper,n=l.popperRect,i=l.placement,o=l.variation,c=l.offsets,f=l.position,m=l.gpuAcceleration,y=l.adaptive,w=l.roundOffsets,S=l.isFixed,C=c.x,O=C===void 0?0:C,N=c.y,H=N===void 0?0:N,q=typeof w=="function"?w({x:O,y:H}):{x:O,y:H};O=q.x,H=q.y;var J=c.hasOwnProperty("x"),V=c.hasOwnProperty("y"),z=$i,ue=Bi,me=window;if(y){var Te=Ui(t),Be="clientHeight",He="clientWidth";Te===De(t)&&yt(Te=Gt(t)).position!=="static"&&f==="absolute"&&(Be="scrollHeight",He="scrollWidth"),(i===Bi||(i===$i||i===Ii)&&o===Pr)&&(ue=ci,H-=(S&&Te===me&&me.visualViewport?me.visualViewport.height:Te[Be])-n.height,H*=m?1:-1),i!==$i&&(i!==Bi&&i!==ci||o!==Pr)||(z=Ii,O-=(S&&Te===me&&me.visualViewport?me.visualViewport.width:Te[He])-n.width,O*=m?1:-1)}var tt,lt=Object.assign({position:f},y&&gr),at=w===!0?function(St){var mt=St.x,gt=St.y,Ot=window.devicePixelRatio||1;return{x:Jt(mt*Ot)/Ot||0,y:Jt(gt*Ot)/Ot||0}}({x:O,y:H}):{x:O,y:H};return O=at.x,H=at.y,m?Object.assign({},lt,((tt={})[ue]=V?"0":"",tt[z]=J?"0":"",tt.transform=(me.devicePixelRatio||1)<=1?"translate("+O+"px, "+H+"px)":"translate3d("+O+"px, "+H+"px, 0)",tt)):Object.assign({},lt,((e={})[ue]=V?H+"px":"",e[z]=J?O+"px":"",e.transform="",e))}var Bs={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(l){var e=l.state,t=l.options,n=t.gpuAcceleration,i=n===void 0||n,o=t.adaptive,c=o===void 0||o,f=t.roundOffsets,m=f===void 0||f,y={placement:xn(e.placement),variation:Dn(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,es(Object.assign({},y,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:c,roundOffsets:m})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,es(Object.assign({},y,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:m})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},as={name:"applyStyles",enabled:!0,phase:"write",fn:function(l){var e=l.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];st(o)&&$e(o)&&(Object.assign(o.style,n),Object.keys(i).forEach(function(c){var f=i[c];f===!1?o.removeAttribute(c):o.setAttribute(c,f===!0?"":f)}))})},effect:function(l){var e=l.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},c=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(f,m){return f[m]="",f},{});st(i)&&$e(i)&&(Object.assign(i.style,c),Object.keys(o).forEach(function(f){i.removeAttribute(f)}))})}},requires:["computeStyles"]},vs={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(l){var e=l.state,t=l.options,n=l.name,i=t.offset,o=i===void 0?[0,0]:i,c=Vd.reduce(function(w,S){return w[S]=function(C,O,N){var H=xn(C),q=[$i,Bi].indexOf(H)>=0?-1:1,J=typeof N=="function"?N(Object.assign({},O,{placement:C})):N,V=J[0],z=J[1];return V=V||0,z=(z||0)*q,[$i,Ii].indexOf(H)>=0?{x:z,y:V}:{x:V,y:z}}(S,e.rects,o),w},{}),f=c[e.placement],m=f.x,y=f.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=m,e.modifiersData.popperOffsets.y+=y),e.modifiersData[n]=c}},js={left:"right",right:"left",bottom:"top",top:"bottom"};function co(l){return l.replace(/left|right|bottom|top/g,function(e){return js[e]})}var ea={start:"end",end:"start"};function O_(l){return l.replace(/start|end/g,function(e){return ea[e]})}function ta(l,e){var t=e.getRootNode&&e.getRootNode();if(l.contains(e))return!0;if(t&&nt(t)){var n=e;do{if(n&&l.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function xa(l){return Object.assign({},l,{left:l.x,top:l.y,right:l.x+l.width,bottom:l.y+l.height})}function jp(l,e,t){return e===Ss?xa(function(n,i){var o=De(n),c=Gt(n),f=o.visualViewport,m=c.clientWidth,y=c.clientHeight,w=0,S=0;if(f){m=f.width,y=f.height;var C=Yt();(C||!C&&i==="fixed")&&(w=f.offsetLeft,S=f.offsetTop)}return{width:m,height:y,x:w+Ut(n),y:S}}(l,t)):je(e)?function(n,i){var o=ln(n,!1,i==="fixed");return o.top=o.top+n.clientTop,o.left=o.left+n.clientLeft,o.bottom=o.top+n.clientHeight,o.right=o.left+n.clientWidth,o.width=n.clientWidth,o.height=n.clientHeight,o.x=o.left,o.y=o.top,o}(e,t):xa(function(n){var i,o=Gt(n),c=et(n),f=(i=n.ownerDocument)==null?void 0:i.body,m=ot(o.scrollWidth,o.clientWidth,f?f.scrollWidth:0,f?f.clientWidth:0),y=ot(o.scrollHeight,o.clientHeight,f?f.scrollHeight:0,f?f.clientHeight:0),w=-c.scrollLeft+Ut(n),S=-c.scrollTop;return yt(f||o).direction==="rtl"&&(w+=ot(o.clientWidth,f?f.clientWidth:0)-m),{width:m,height:y,x:w,y:S}}(Gt(l)))}function el(l){return Object.assign({},{top:0,right:0,bottom:0,left:0},l)}function Qr(l,e){return e.reduce(function(t,n){return t[n]=l,t},{})}function Wo(l,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?l.placement:n,o=t.strategy,c=o===void 0?l.strategy:o,f=t.boundary,m=f===void 0?ds:f,y=t.rootBoundary,w=y===void 0?Ss:y,S=t.elementContext,C=S===void 0?lu:S,O=t.altBoundary,N=O!==void 0&&O,H=t.padding,q=H===void 0?0:H,J=el(typeof q!="number"?q:Qr(q,xs)),V=C===lu?Jn:lu,z=l.rects.popper,ue=l.elements[N?V:C],me=function(mt,gt,Ot,Bt){var Ft=gt==="clippingParents"?function(Rn){var En=Kt(Dt(Rn)),ai=["absolute","fixed"].indexOf(yt(Rn).position)>=0&&st(Rn)?Ui(Rn):Rn;return je(ai)?En.filter(function(ri){return je(ri)&&ta(ri,ai)&&$e(ri)!=="body"}):[]}(mt):[].concat(gt),_n=[].concat(Ft,[Ot]),mn=_n[0],qn=_n.reduce(function(Rn,En){var ai=jp(mt,En,Bt);return Rn.top=ot(ai.top,Rn.top),Rn.right=Vt(ai.right,Rn.right),Rn.bottom=Vt(ai.bottom,Rn.bottom),Rn.left=ot(ai.left,Rn.left),Rn},jp(mt,mn,Bt));return qn.width=qn.right-qn.left,qn.height=qn.bottom-qn.top,qn.x=qn.left,qn.y=qn.top,qn}(je(ue)?ue:ue.contextElement||Gt(l.elements.popper),m,w,c),Te=ln(l.elements.reference),Be=Oi({reference:Te,element:z,strategy:"absolute",placement:i}),He=xa(Object.assign({},z,Be)),tt=C===lu?He:Te,lt={top:me.top-tt.top+J.top,bottom:tt.bottom-me.bottom+J.bottom,left:me.left-tt.left+J.left,right:tt.right-me.right+J.right},at=l.modifiersData.offset;if(C===lu&&at){var St=at[i];Object.keys(lt).forEach(function(mt){var gt=[Ii,ci].indexOf(mt)>=0?1:-1,Ot=[Bi,ci].indexOf(mt)>=0?"y":"x";lt[mt]+=St[Ot]*gt})}return lt}var LA={name:"flip",enabled:!0,phase:"main",fn:function(l){var e=l.state,t=l.options,n=l.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0||i,c=t.altAxis,f=c===void 0||c,m=t.fallbackPlacements,y=t.padding,w=t.boundary,S=t.rootBoundary,C=t.altBoundary,O=t.flipVariations,N=O===void 0||O,H=t.allowedAutoPlacements,q=e.options.placement,J=xn(q),V=m||(J!==q&&N?function(Rn){if(xn(Rn)===sr)return[];var En=co(Rn);return[O_(Rn),En,O_(En)]}(q):[co(q)]),z=[q].concat(V).reduce(function(Rn,En){return Rn.concat(xn(En)===sr?function(ai,ri){ri===void 0&&(ri={});var Ei=ri,ki=Ei.placement,Xi=Ei.boundary,ts=Ei.rootBoundary,Cr=Ei.padding,wr=Ei.flipVariations,zn=Ei.allowedAutoPlacements,oi=zn===void 0?Vd:zn,Ti=Dn(ki),Hr=Ti?wr?xl:xl.filter(function(Fr){return Dn(Fr)===Ti}):xs,ps=Hr.filter(function(Fr){return oi.indexOf(Fr)>=0});ps.length===0&&(ps=Hr);var $r=ps.reduce(function(Fr,zr){return Fr[zr]=Wo(ai,{placement:zr,boundary:Xi,rootBoundary:ts,padding:Cr})[xn(zr)],Fr},{});return Object.keys($r).sort(function(Fr,zr){return $r[Fr]-$r[zr]})}(e,{placement:En,boundary:w,rootBoundary:S,padding:y,flipVariations:N,allowedAutoPlacements:H}):En)},[]),ue=e.rects.reference,me=e.rects.popper,Te=new Map,Be=!0,He=z[0],tt=0;tt<z.length;tt++){var lt=z[tt],at=xn(lt),St=Dn(lt)===yo,mt=[Bi,ci].indexOf(at)>=0,gt=mt?"width":"height",Ot=Wo(e,{placement:lt,boundary:w,rootBoundary:S,altBoundary:C,padding:y}),Bt=mt?St?Ii:$i:St?ci:Bi;ue[gt]>me[gt]&&(Bt=co(Bt));var Ft=co(Bt),_n=[];if(o&&_n.push(Ot[at]<=0),f&&_n.push(Ot[Bt]<=0,Ot[Ft]<=0),_n.every(function(Rn){return Rn})){He=lt,Be=!1;break}Te.set(lt,_n)}if(Be)for(var mn=function(Rn){var En=z.find(function(ai){var ri=Te.get(ai);if(ri)return ri.slice(0,Rn).every(function(Ei){return Ei})});if(En)return He=En,"break"},qn=N?3:1;qn>0&&mn(qn)!=="break";qn--);e.placement!==He&&(e.modifiersData[n]._skip=!0,e.placement=He,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function hy(l,e,t){return ot(l,Vt(e,t))}var jx={name:"preventOverflow",enabled:!0,phase:"main",fn:function(l){var e=l.state,t=l.options,n=l.name,i=t.mainAxis,o=i===void 0||i,c=t.altAxis,f=c!==void 0&&c,m=t.boundary,y=t.rootBoundary,w=t.altBoundary,S=t.padding,C=t.tether,O=C===void 0||C,N=t.tetherOffset,H=N===void 0?0:N,q=Wo(e,{boundary:m,rootBoundary:y,padding:S,altBoundary:w}),J=xn(e.placement),V=Dn(e.placement),z=!V,ue=ti(J),me=ue==="x"?"y":"x",Te=e.modifiersData.popperOffsets,Be=e.rects.reference,He=e.rects.popper,tt=typeof H=="function"?H(Object.assign({},e.rects,{placement:e.placement})):H,lt=typeof tt=="number"?{mainAxis:tt,altAxis:tt}:Object.assign({mainAxis:0,altAxis:0},tt),at=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,St={x:0,y:0};if(Te){if(o){var mt,gt=ue==="y"?Bi:$i,Ot=ue==="y"?ci:Ii,Bt=ue==="y"?"height":"width",Ft=Te[ue],_n=Ft+q[gt],mn=Ft-q[Ot],qn=O?-He[Bt]/2:0,Rn=V===yo?Be[Bt]:He[Bt],En=V===yo?-He[Bt]:-Be[Bt],ai=e.elements.arrow,ri=O&&ai?Ct(ai):{width:0,height:0},Ei=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},ki=Ei[gt],Xi=Ei[Ot],ts=hy(0,Be[Bt],ri[Bt]),Cr=z?Be[Bt]/2-qn-ts-ki-lt.mainAxis:Rn-ts-ki-lt.mainAxis,wr=z?-Be[Bt]/2+qn+ts+Xi+lt.mainAxis:En+ts+Xi+lt.mainAxis,zn=e.elements.arrow&&Ui(e.elements.arrow),oi=zn?ue==="y"?zn.clientTop||0:zn.clientLeft||0:0,Ti=(mt=at==null?void 0:at[ue])!=null?mt:0,Hr=Ft+wr-Ti,ps=hy(O?Vt(_n,Ft+Cr-Ti-oi):_n,Ft,O?ot(mn,Hr):mn);Te[ue]=ps,St[ue]=ps-Ft}if(f){var $r,Fr=ue==="x"?Bi:$i,zr=ue==="x"?ci:Ii,lr=Te[me],Sn=me==="y"?"height":"width",Si=lr+q[Fr],dr=lr-q[zr],mi=[Bi,$i].indexOf(J)!==-1,Br=($r=at==null?void 0:at[me])!=null?$r:0,Qo=mi?Si:lr-Be[Sn]-He[Sn]-Br+lt.altAxis,ma=mi?lr+Be[Sn]+He[Sn]-Br-lt.altAxis:dr,rl=O&&mi?function(Uc,pu,lc){var qr=hy(Uc,pu,lc);return qr>lc?lc:qr}(Qo,lr,ma):hy(O?Qo:Si,lr,O?ma:dr);Te[me]=rl,St[me]=rl-lr}e.modifiersData[n]=St}},requiresIfExists:["offset"]},dy={name:"arrow",enabled:!0,phase:"main",fn:function(l){var e,t=l.state,n=l.name,i=l.options,o=t.elements.arrow,c=t.modifiersData.popperOffsets,f=xn(t.placement),m=ti(f),y=[$i,Ii].indexOf(f)>=0?"height":"width";if(o&&c){var w=function(He,tt){return el(typeof(He=typeof He=="function"?He(Object.assign({},tt.rects,{placement:tt.placement})):He)!="number"?He:Qr(He,xs))}(i.padding,t),S=Ct(o),C=m==="y"?Bi:$i,O=m==="y"?ci:Ii,N=t.rects.reference[y]+t.rects.reference[m]-c[m]-t.rects.popper[y],H=c[m]-t.rects.reference[m],q=Ui(o),J=q?m==="y"?q.clientHeight||0:q.clientWidth||0:0,V=N/2-H/2,z=w[C],ue=J-S[y]-w[O],me=J/2-S[y]/2+V,Te=hy(z,me,ue),Be=m;t.modifiersData[n]=((e={})[Be]=Te,e.centerOffset=Te-me,e)}},effect:function(l){var e=l.state,t=l.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&ta(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Vx(l,e,t){return t===void 0&&(t={x:0,y:0}),{top:l.top-e.height-t.y,right:l.right-e.width+t.x,bottom:l.bottom-e.height+t.y,left:l.left-e.width-t.x}}function Gx(l){return[Bi,Ii,ci,$i].some(function(e){return l[e]>=0})}var Hx={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(l){var e=l.state,t=l.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,c=Wo(e,{elementContext:"reference"}),f=Wo(e,{altBoundary:!0}),m=Vx(c,n),y=Vx(f,i,o),w=Gx(m),S=Gx(y);e.modifiersData[t]={referenceClippingOffsets:m,popperEscapeOffsets:y,isReferenceHidden:w,hasPopperEscaped:S},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":S})}},Wx=vi({defaultModifiers:[fn,hr,Bs,as,vs,LA,jx,dy,Hx]}),JE="tippy-box",Qx="tippy-content",qx="tippy-backdrop",Xx="tippy-arrow",ro="tippy-svg-arrow",B_={passive:!0,capture:!0},Vp=function(){return document.body};function Nf(l,e,t){if(Array.isArray(l)){var n=l[e];return n??(Array.isArray(t)?t[e]:t)}return l}function NA(l,e){var t={}.toString.call(l);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function c0(l,e){return typeof l=="function"?l.apply(void 0,e):l}function kA(l,e){return e===0?l:function(n){clearTimeout(t),t=setTimeout(function(){l(n)},e)};var t}function wa(l){return[].concat(l)}function Km(l,e){l.indexOf(e)===-1&&l.push(e)}function u0(l){return[].slice.call(l)}function Gd(l){return Object.keys(l).reduce(function(e,t){return l[t]!==void 0&&(e[t]=l[t]),e},{})}function kc(){return document.createElement("div")}function py(l){return["Element","Fragment"].some(function(e){return NA(l,e)})}function rc(l,e){l.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function h0(l,e){l.forEach(function(t){t&&t.setAttribute("data-state",e)})}function kb(l,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){l[n](i,t)})}function Ub(l,e){for(var t=e;t;){var n;if(l.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var $m={isTouch:!1},eM=0;function dI(){$m.isTouch||($m.isTouch=!0,window.performance&&document.addEventListener("mousemove",tM))}function tM(){var l=performance.now();l-eM<20&&($m.isTouch=!1,document.removeEventListener("mousemove",tM)),eM=l}function pI(){var l,e=document.activeElement;if((l=e)&&l._tippy&&l._tippy.reference===l){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var fI=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),kf=Object.assign({appendTo:Vp,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),mI=Object.keys(kf);function nM(l){var e=(l.plugins||[]).reduce(function(t,n){var i,o=n.name,c=n.defaultValue;return o&&(t[o]=l[o]!==void 0?l[o]:(i=kf[o])!=null?i:c),t},{});return Object.assign({},l,e)}function iM(l,e){var t=Object.assign({},e,{content:c0(e.content,[l])},e.ignoreAttributes?{}:function(n,i){return(i?Object.keys(nM(Object.assign({},kf,{plugins:i}))):mI).reduce(function(o,c){var f=(n.getAttribute("data-tippy-"+c)||"").trim();if(!f)return o;if(c==="content")o[c]=f;else try{o[c]=JSON.parse(f)}catch{o[c]=f}return o},{})}(l,e.plugins));return t.aria=Object.assign({},kf.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var gI=function(){return"innerHTML"};function ZE(l,e){l[gI()]=e}function rM(l){var e=kc();return l===!0?e.className=Xx:(e.className=ro,py(l)?e.appendChild(l):ZE(e,l)),e}function sM(l,e){py(e.content)?(ZE(l,""),l.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ZE(l,e.content):l.textContent=e.content)}function e1(l){var e=l.firstElementChild,t=u0(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(Qx)}),arrow:t.find(function(n){return n.classList.contains(Xx)||n.classList.contains(ro)}),backdrop:t.find(function(n){return n.classList.contains(qx)})}}function oM(l){var e=kc(),t=kc();t.className=JE,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=kc();function i(o,c){var f=e1(e),m=f.box,y=f.content,w=f.arrow;c.theme?m.setAttribute("data-theme",c.theme):m.removeAttribute("data-theme"),typeof c.animation=="string"?m.setAttribute("data-animation",c.animation):m.removeAttribute("data-animation"),c.inertia?m.setAttribute("data-inertia",""):m.removeAttribute("data-inertia"),m.style.maxWidth=typeof c.maxWidth=="number"?c.maxWidth+"px":c.maxWidth,c.role?m.setAttribute("role",c.role):m.removeAttribute("role"),o.content===c.content&&o.allowHTML===c.allowHTML||sM(y,l.props),c.arrow?w?o.arrow!==c.arrow&&(m.removeChild(w),m.appendChild(rM(c.arrow))):m.appendChild(rM(c.arrow)):w&&m.removeChild(w)}return n.className=Qx,n.setAttribute("data-state","hidden"),sM(n,l.props),e.appendChild(t),t.appendChild(n),i(l.props,l.props),{popper:e,onUpdate:i}}oM.$$tippy=!0;var _I=1,Yx=[],t1=[];function vI(l,e){var t,n,i,o,c,f,m,y,w=iM(l,Object.assign({},kf,nM(Gd(e)))),S=!1,C=!1,O=!1,N=!1,H=[],q=kA(zn,w.interactiveDebounce),J=_I++,V=(y=w.plugins).filter(function(Sn,Si){return y.indexOf(Sn)===Si}),z={id:J,reference:l,popper:kc(),popperInstance:null,props:w,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:V,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(i)},setProps:function(Sn){if(!z.state.isDestroyed){Ft("onBeforeUpdate",[z,Sn]),Cr();var Si=z.props,dr=iM(l,Object.assign({},Si,Gd(Sn),{ignoreAttributes:!0}));z.props=dr,ts(),Si.interactiveDebounce!==dr.interactiveDebounce&&(qn(),q=kA(zn,dr.interactiveDebounce)),Si.triggerTarget&&!dr.triggerTarget?wa(Si.triggerTarget).forEach(function(mi){mi.removeAttribute("aria-expanded")}):dr.triggerTarget&&l.removeAttribute("aria-expanded"),mn(),Bt(),Te&&Te(Si,dr),z.popperInstance&&(ps(),Fr().forEach(function(mi){requestAnimationFrame(mi._tippy.popperInstance.forceUpdate)})),Ft("onAfterUpdate",[z,Sn])}},setContent:function(Sn){z.setProps({content:Sn})},show:function(){var Sn=z.state.isVisible,Si=z.state.isDestroyed,dr=!z.state.isEnabled,mi=$m.isTouch&&!z.props.touch,Br=Nf(z.props.duration,0,kf.duration);if(!(Sn||Si||dr||mi||St().hasAttribute("disabled")||(Ft("onShow",[z],!1),z.props.onShow(z)===!1))){if(z.state.isVisible=!0,at()&&(me.style.visibility="visible"),Bt(),ri(),z.state.isMounted||(me.style.transition="none"),at()){var Qo=gt();rc([Qo.box,Qo.content],0)}var ma,rl,Uc;f=function(){var pu;if(z.state.isVisible&&!N){if(N=!0,me.offsetHeight,me.style.transition=z.props.moveTransition,at()&&z.props.animation){var lc=gt(),qr=lc.box,mh=lc.content;rc([qr,mh],Br),h0([qr,mh],"visible")}_n(),mn(),Km(t1,z),(pu=z.popperInstance)==null||pu.forceUpdate(),Ft("onMount",[z]),z.props.animation&&at()&&function(tv,jt){ki(tv,function(){z.state.isShown=!0,Ft("onShown",[z])})}(Br)}},rl=z.props.appendTo,Uc=St(),(ma=z.props.interactive&&rl===Vp||rl==="parent"?Uc.parentNode:c0(rl,[Uc])).contains(me)||ma.appendChild(me),z.state.isMounted=!0,ps()}},hide:function(){var Sn=!z.state.isVisible,Si=z.state.isDestroyed,dr=!z.state.isEnabled,mi=Nf(z.props.duration,1,kf.duration);if(!(Sn||Si||dr)&&(Ft("onHide",[z],!1),z.props.onHide(z)!==!1)){if(z.state.isVisible=!1,z.state.isShown=!1,N=!1,S=!1,at()&&(me.style.visibility="hidden"),qn(),Ei(),Bt(!0),at()){var Br=gt(),Qo=Br.box,ma=Br.content;z.props.animation&&(rc([Qo,ma],mi),h0([Qo,ma],"hidden"))}_n(),mn(),z.props.animation?at()&&function(rl,Uc){ki(rl,function(){!z.state.isVisible&&me.parentNode&&me.parentNode.contains(me)&&Uc()})}(mi,z.unmount):z.unmount()}},hideWithInteractivity:function(Sn){mt().addEventListener("mousemove",q),Km(Yx,q),q(Sn)},enable:function(){z.state.isEnabled=!0},disable:function(){z.hide(),z.state.isEnabled=!1},unmount:function(){z.state.isVisible&&z.hide(),z.state.isMounted&&($r(),Fr().forEach(function(Sn){Sn._tippy.unmount()}),me.parentNode&&me.parentNode.removeChild(me),t1=t1.filter(function(Sn){return Sn!==z}),z.state.isMounted=!1,Ft("onHidden",[z]))},destroy:function(){z.state.isDestroyed||(z.clearDelayTimeouts(),z.unmount(),Cr(),delete l._tippy,z.state.isDestroyed=!0,Ft("onDestroy",[z]))}};if(!w.render)return z;var ue=w.render(z),me=ue.popper,Te=ue.onUpdate;me.setAttribute("data-tippy-root",""),me.id="tippy-"+z.id,z.popper=me,l._tippy=z,me._tippy=z;var Be=V.map(function(Sn){return Sn.fn(z)}),He=l.hasAttribute("aria-expanded");return ts(),mn(),Bt(),Ft("onCreate",[z]),w.showOnCreate&&zr(),me.addEventListener("mouseenter",function(){z.props.interactive&&z.state.isVisible&&z.clearDelayTimeouts()}),me.addEventListener("mouseleave",function(){z.props.interactive&&z.props.trigger.indexOf("mouseenter")>=0&&mt().addEventListener("mousemove",q)}),z;function tt(){var Sn=z.props.touch;return Array.isArray(Sn)?Sn:[Sn,0]}function lt(){return tt()[0]==="hold"}function at(){var Sn;return!((Sn=z.props.render)==null||!Sn.$$tippy)}function St(){return m||l}function mt(){var Sn,Si,dr=St().parentNode;return dr&&(Si=wa(dr)[0])!=null&&(Sn=Si.ownerDocument)!=null&&Sn.body?Si.ownerDocument:document}function gt(){return e1(me)}function Ot(Sn){return z.state.isMounted&&!z.state.isVisible||$m.isTouch||o&&o.type==="focus"?0:Nf(z.props.delay,Sn?0:1,kf.delay)}function Bt(Sn){Sn===void 0&&(Sn=!1),me.style.pointerEvents=z.props.interactive&&!Sn?"":"none",me.style.zIndex=""+z.props.zIndex}function Ft(Sn,Si,dr){var mi;dr===void 0&&(dr=!0),Be.forEach(function(Br){Br[Sn]&&Br[Sn].apply(Br,Si)}),dr&&(mi=z.props)[Sn].apply(mi,Si)}function _n(){var Sn=z.props.aria;if(Sn.content){var Si="aria-"+Sn.content,dr=me.id;wa(z.props.triggerTarget||l).forEach(function(mi){var Br=mi.getAttribute(Si);if(z.state.isVisible)mi.setAttribute(Si,Br?Br+" "+dr:dr);else{var Qo=Br&&Br.replace(dr,"").trim();Qo?mi.setAttribute(Si,Qo):mi.removeAttribute(Si)}})}}function mn(){!He&&z.props.aria.expanded&&wa(z.props.triggerTarget||l).forEach(function(Sn){z.props.interactive?Sn.setAttribute("aria-expanded",z.state.isVisible&&Sn===St()?"true":"false"):Sn.removeAttribute("aria-expanded")})}function qn(){mt().removeEventListener("mousemove",q),Yx=Yx.filter(function(Sn){return Sn!==q})}function Rn(Sn){if(!$m.isTouch||!O&&Sn.type!=="mousedown"){var Si=Sn.composedPath&&Sn.composedPath()[0]||Sn.target;if(!z.props.interactive||!Ub(me,Si)){if(wa(z.props.triggerTarget||l).some(function(dr){return Ub(dr,Si)})){if($m.isTouch||z.state.isVisible&&z.props.trigger.indexOf("click")>=0)return}else Ft("onClickOutside",[z,Sn]);z.props.hideOnClick===!0&&(z.clearDelayTimeouts(),z.hide(),C=!0,setTimeout(function(){C=!1}),z.state.isMounted||Ei())}}}function En(){O=!0}function ai(){O=!1}function ri(){var Sn=mt();Sn.addEventListener("mousedown",Rn,!0),Sn.addEventListener("touchend",Rn,B_),Sn.addEventListener("touchstart",ai,B_),Sn.addEventListener("touchmove",En,B_)}function Ei(){var Sn=mt();Sn.removeEventListener("mousedown",Rn,!0),Sn.removeEventListener("touchend",Rn,B_),Sn.removeEventListener("touchstart",ai,B_),Sn.removeEventListener("touchmove",En,B_)}function ki(Sn,Si){var dr=gt().box;function mi(Br){Br.target===dr&&(kb(dr,"remove",mi),Si())}if(Sn===0)return Si();kb(dr,"remove",c),kb(dr,"add",mi),c=mi}function Xi(Sn,Si,dr){dr===void 0&&(dr=!1),wa(z.props.triggerTarget||l).forEach(function(mi){mi.addEventListener(Sn,Si,dr),H.push({node:mi,eventType:Sn,handler:Si,options:dr})})}function ts(){var Sn;lt()&&(Xi("touchstart",wr,{passive:!0}),Xi("touchend",oi,{passive:!0})),(Sn=z.props.trigger,Sn.split(/\s+/).filter(Boolean)).forEach(function(Si){if(Si!=="manual")switch(Xi(Si,wr),Si){case"mouseenter":Xi("mouseleave",oi);break;case"focus":Xi(fI?"focusout":"blur",Ti);break;case"focusin":Xi("focusout",Ti)}})}function Cr(){H.forEach(function(Sn){var Si=Sn.node,dr=Sn.eventType,mi=Sn.handler,Br=Sn.options;Si.removeEventListener(dr,mi,Br)}),H=[]}function wr(Sn){var Si,dr=!1;if(z.state.isEnabled&&!Hr(Sn)&&!C){var mi=((Si=o)==null?void 0:Si.type)==="focus";o=Sn,m=Sn.currentTarget,mn(),!z.state.isVisible&&NA(Sn,"MouseEvent")&&Yx.forEach(function(Br){return Br(Sn)}),Sn.type==="click"&&(z.props.trigger.indexOf("mouseenter")<0||S)&&z.props.hideOnClick!==!1&&z.state.isVisible?dr=!0:zr(Sn),Sn.type==="click"&&(S=!dr),dr&&!mi&&lr(Sn)}}function zn(Sn){var Si=Sn.target,dr=St().contains(Si)||me.contains(Si);if(Sn.type!=="mousemove"||!dr){var mi=Fr().concat(me).map(function(Br){var Qo,ma=(Qo=Br._tippy.popperInstance)==null?void 0:Qo.state;return ma?{popperRect:Br.getBoundingClientRect(),popperState:ma,props:w}:null}).filter(Boolean);(function(Br,Qo){var ma=Qo.clientX,rl=Qo.clientY;return Br.every(function(Uc){var pu=Uc.popperRect,lc=Uc.popperState,qr=Uc.props.interactiveBorder,mh=lc.placement.split("-")[0],tv=lc.modifiersData.offset;if(!tv)return!0;var jt=mh==="bottom"?tv.top.y:0,An=mh==="top"?tv.bottom.y:0,kn=mh==="right"?tv.left.x:0,bi=mh==="left"?tv.right.x:0,Pi=pu.top-rl+jt>qr,jn=rl-pu.bottom-An>qr,xi=pu.left-ma+kn>qr,_r=ma-pu.right-bi>qr;return Pi||jn||xi||_r})})(mi,Sn)&&(qn(),lr(Sn))}}function oi(Sn){Hr(Sn)||z.props.trigger.indexOf("click")>=0&&S||(z.props.interactive?z.hideWithInteractivity(Sn):lr(Sn))}function Ti(Sn){z.props.trigger.indexOf("focusin")<0&&Sn.target!==St()||z.props.interactive&&Sn.relatedTarget&&me.contains(Sn.relatedTarget)||lr(Sn)}function Hr(Sn){return!!$m.isTouch&&lt()!==Sn.type.indexOf("touch")>=0}function ps(){$r();var Sn=z.props,Si=Sn.popperOptions,dr=Sn.placement,mi=Sn.offset,Br=Sn.getReferenceClientRect,Qo=Sn.moveTransition,ma=at()?e1(me).arrow:null,rl=Br?{getBoundingClientRect:Br,contextElement:Br.contextElement||St()}:l,Uc=[{name:"offset",options:{offset:mi}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Qo}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(pu){var lc=pu.state;if(at()){var qr=gt().box;["placement","reference-hidden","escaped"].forEach(function(mh){mh==="placement"?qr.setAttribute("data-placement",lc.placement):lc.attributes.popper["data-popper-"+mh]?qr.setAttribute("data-"+mh,""):qr.removeAttribute("data-"+mh)}),lc.attributes.popper={}}}}];at()&&ma&&Uc.push({name:"arrow",options:{element:ma,padding:3}}),Uc.push.apply(Uc,(Si==null?void 0:Si.modifiers)||[]),z.popperInstance=Wx(rl,me,Object.assign({},Si,{placement:dr,onFirstUpdate:f,modifiers:Uc}))}function $r(){z.popperInstance&&(z.popperInstance.destroy(),z.popperInstance=null)}function Fr(){return u0(me.querySelectorAll("[data-tippy-root]"))}function zr(Sn){z.clearDelayTimeouts(),Sn&&Ft("onTrigger",[z,Sn]),ri();var Si=Ot(!0),dr=tt(),mi=dr[0],Br=dr[1];$m.isTouch&&mi==="hold"&&Br&&(Si=Br),Si?t=setTimeout(function(){z.show()},Si):z.show()}function lr(Sn){if(z.clearDelayTimeouts(),Ft("onUntrigger",[z,Sn]),z.state.isVisible){if(!(z.props.trigger.indexOf("mouseenter")>=0&&z.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Sn.type)>=0&&S)){var Si=Ot(!1);Si?n=setTimeout(function(){z.state.isVisible&&z.hide()},Si):i=requestAnimationFrame(function(){z.hide()})}}else Ei()}}function UA(l,e){e===void 0&&(e={});var t=kf.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",dI,B_),window.addEventListener("blur",pI);var n,i=Object.assign({},e,{plugins:t}),o=(n=l,py(n)?[n]:function(c){return NA(c,"NodeList")}(n)?u0(n):Array.isArray(n)?n:u0(document.querySelectorAll(n))).reduce(function(c,f){var m=f&&vI(f,i);return m&&c.push(m),c},[]);return py(l)?o[0]:o}UA.defaultProps=kf,UA.setDefaultProps=function(l){Object.keys(l).forEach(function(e){kf[e]=l[e]})},UA.currentInput=$m;var yI=Object.assign({},as,{effect:function(l){var e=l.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),AI=function(l,e){var t;e===void 0&&(e={});var n,i=l,o=[],c=[],f=e.overrides,m=[],y=!1;function w(){c=i.map(function(Te){return wa(Te.props.triggerTarget||Te.reference)}).reduce(function(Te,Be){return Te.concat(Be)},[])}function S(){o=i.map(function(Te){return Te.reference})}function C(Te){i.forEach(function(Be){Te?Be.enable():Be.disable()})}function O(Te){return i.map(function(Be){var He=Be.setProps;return Be.setProps=function(tt){He(tt),Be.reference===n&&Te.setProps(tt)},function(){Be.setProps=He}})}function N(Te,Be){var He=c.indexOf(Be);if(Be!==n){n=Be;var tt=(f||[]).concat("content").reduce(function(lt,at){return lt[at]=i[He].props[at],lt},{});Te.setProps(Object.assign({},tt,{getReferenceClientRect:typeof tt.getReferenceClientRect=="function"?tt.getReferenceClientRect:function(){var lt;return(lt=o[He])==null?void 0:lt.getBoundingClientRect()}}))}}C(!1),S(),w();var H,q,J,V={fn:function(){return{onDestroy:function(){C(!0)},onHidden:function(){n=null},onClickOutside:function(Te){Te.props.showOnCreate&&!y&&(y=!0,n=null)},onShow:function(Te){Te.props.showOnCreate&&!y&&(y=!0,N(Te,o[0]))},onTrigger:function(Te,Be){N(Te,Be.currentTarget)}}}},z=UA(kc(),Object.assign({},(H=e,q=["overrides"],J=Object.assign({},H),q.forEach(function(Te){delete J[Te]}),J),{plugins:[V].concat(e.plugins||[]),triggerTarget:c,popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((t=e.popperOptions)==null?void 0:t.modifiers)||[],[yI])})})),ue=z.show;z.show=function(Te){if(ue(),!n&&Te==null)return N(z,o[0]);if(!n||Te!=null){if(typeof Te=="number")return o[Te]&&N(z,o[Te]);if(i.indexOf(Te)>=0){var Be=Te.reference;return N(z,Be)}return o.indexOf(Te)>=0?N(z,Te):void 0}},z.showNext=function(){var Te=o[0];if(!n)return z.show(0);var Be=o.indexOf(n);z.show(o[Be+1]||Te)},z.showPrevious=function(){var Te=o[o.length-1];if(!n)return z.show(Te);var Be=o.indexOf(n),He=o[Be-1]||Te;z.show(He)};var me=z.setProps;return z.setProps=function(Te){f=Te.overrides||f,me(Te)},z.setInstances=function(Te){C(!0),m.forEach(function(Be){return Be()}),i=Te,C(!1),S(),w(),m=O(z),z.setProps({triggerTarget:c})},m=O(z),z};UA.setDefaultProps({render:oM});var d0=UA;class L_ extends be{async _refreshUi(){var e;if(!await super._refreshUi())return!1;Me.RemoveAll(L_.PluginType);for(const t of this.variations)Me.Create(L_.PluginType,t.title,5,20,0,t.materials.map(n=>{let i;if(t.preview.startsWith("generate:"))i=this._previewGenerator.generate(n,t.preview.split(":")[1]);else{const o=n[t.preview]||"#ff00ff";i=o.image?(0,a.imageBitmapToBase64)(o.image,100):void 0,i||(i=(0,a.makeColorSvgCircle)(o!=null&&o.isColor?o.getHexString():o))}return{id:n.uuid,image:i,onClick:o=>this.applyVariation(t,o),tooltip:n.name||n.uuid}}),(n,i)=>d0(n,{placement:"bottom",content:i.tooltip}));return Me.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}L_.PluginType="MaterialConfiguratorPlugin";class n1 extends Ri{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this.dependencies=[fi],this.variations=[],this._selectedSwitchNode=()=>{var i;const e=(i=this._picking)==null?void 0:i.getSelectedObject();if(!e)return;const t=this.variations.map(o=>o.name);let n;return e.traverseAncestors(o=>{n||o.name&&t.includes(o.name)&&(n=o)}),n},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",()=>{var i,o;(o=(i=this.uiConfig).uiRefresh)==null||o.call(i)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer&&this.enabled){for(const i of this.variations){if(!i.name)continue;const o=this._viewer.scene.getObjectByName(i.name);if(!o||o.children.length<1)return;i.selected||(i.selected=o.children[0].name||o.children[0].uuid);for(const c of o.children)c.userData.__oldVisible=c.visible,c.visible=(c.name||c.uuid)===i.selected}this._isVisibleChanged=!0}}),e.addEventListener("postRender",()=>{if(this._viewer&&this._isVisibleChanged){for(const i of this.variations){if(!i.name)continue;const o=this._viewer.scene.getObjectByName(i.name);if(!o||o.children.length<1)return;for(const c of o.children){if(c.userData.__oldVisible===void 0)return;c.visible=c.userData.__oldVisible,delete c.userData.__oldVisible}}this._isVisibleChanged=!1}}),this.addEventListener("deserialize",async()=>{this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(t=(e=this.uiConfig).uiRefresh)==null||t.call(e),!0)}}(function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)})([ze()],n1.prototype,"variations",void 0);class N_ extends n1{_refreshUi(){var e;if(!super._refreshUi())return!1;Me.RemoveAll(N_.PluginType);for(const t of this.variations){const n=this._viewer.scene.getObjectByName(t.name);n?(n.children.length<1&&console.warn("SwitchNode does not have enough children",t),Me.Create(N_.PluginType,t.title,Math.min(5,n.children.length),20,0,n.children.map(i=>{const o=t.camView,c=new s.Pa4((o.includes("right")?1:0)-(o.includes("left")?1:0),(o.includes("top")?1:0)-(o.includes("bottom")?1:0),(o.includes("front")?1:0)-(o.includes("back")?1:0));t.camDistance||(t.camDistance=1);const f=Y(this._viewer,i,void 0,7,c.multiplyScalar(.5*t.camDistance));return{id:i.uuid,image:f,onClick:()=>{var m;t.selected=i.name||i.uuid,(m=this._viewer)==null||m.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:i.name||i.uuid}}),(i,o)=>d0(i,{placement:"bottom",content:o.tooltip}))):console.warn("no object found for variation, skipping",t)}return Me.RebuildUi((e=this._viewer)==null?void 0:e.container),!0}}N_.PluginType="SwitchNodePlugin";class Kx extends Ri{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0))},this.dependencies=[fi],this._selectedObject=()=>{var e;return((e=this._picking)==null?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())==null?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"),this._previewGenerator=new ne(this._viewer),(n=this._picking)==null||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)==null||t.dispose(),this._previewGenerator=void 0,(n=this._picking)==null||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}Kx.PluginType="MaterialLibraryBasePlugin",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([Yn("Enabled")],Kx.prototype,"enabled",void 0);class Jm extends Kx{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:ji(),children:[...Wt(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(fi).materials.getAllMaterials().map(e=>({label:e.name||e.uuid,value:e.uuid}))||[]]],getValue:()=>{var e;return(e=this._selectedMaterial())==null?void 0:e.uuid},setValue:e=>{var n,i,o,c,f;const t=(o=(i=(n=this._viewer)==null?void 0:n.getPlugin(fi))==null?void 0:i.materials)==null?void 0:o.findMaterial(e);if(t)if(this.replaceMaterial)(f=(c=this._selectedObject())==null?void 0:c.setMaterial)==null||f.call(c,t);else{const m=this._selectedMaterial();if(m){const y=m.name,w=m.uuid;m.copyProps(t),m.name=y,m.uuid=w,m.userData.uuid&&(m.userData.uuid=w)}}this._refreshUi()}})]}}async _refreshUi(){var i,o,c;if(!await super._refreshUi())return!1;const e=[Wr.TypeSlug,Ds.TypeSlug],t=(o=(i=this._viewer)==null?void 0:i.getPlugin(fi))==null?void 0:o.materials,n=e.map(f=>[f,t==null?void 0:t.getMaterialsOfType(f)]);Me.RemoveAll(Jm.PluginType);for(const[f,m]of n)Me.Create(Jm.PluginType,f,5,20,0,m==null?void 0:m.filter(y=>!y.userData.__runtimeMaterial).map(y=>{let w;const S="generate:sphere";if(S.startsWith("generate:"))w=this._previewGenerator.generate(y,S.split(":")[1]);else{const C=y[S]||"#ff00ff";w=C.image?(0,a.imageBitmapToBase64)(C.image,100):void 0,w||(w=(0,a.makeColorSvg)(C))}return{id:y.uuid,image:w,onClick:C=>{const O=t==null?void 0:t.findMaterial(C);if(O){const N=O.userData.__appliedMeshes;if(N!=null&&N.size){const H=N.keys().next().value;H.dispatchEvent({type:"select",value:H})}}},tooltip:y.name||y.uuid}}),(y,w)=>d0(y,{placement:"bottom",content:w.tooltip}));return Me.RebuildUi((c=this._viewer)==null?void 0:c.container),!0}}Jm.PluginType="MaterialLibraryPlugin",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([Yn("Replace Material")],Jm.prototype,"replaceMaterial",void 0);class i1 extends s.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",a.glsl`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)})([Ne({propKey:"tLastThis"})],i1.prototype,"lastFrameTexture",void 0);var fy=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class ed extends a.SimpleEventDispatcher{get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(e){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(n,i)=>a.glsl`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(n,i,o)=>{this.groundMapMode==="aoMap"?n.fragmentShader=ni(n.fragmentShader,"#include <aomap_fragment>",ni(s.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=ni(n.fragmentShader,"#include <map_fragment>",ni(s.WdD.map_fragment,"diffuseColor *= texture2D( map, vMapUv );","float groundShadow = mix(1., unpackRGBAToDepth(texture2D( map, vMapUv )), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=ni(n.fragmentShader,"#include <alphamap_fragment>",ni(s.WdD.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),n.fragmentShader=ni(n.fragmentShader,"#include <output_fragment>",a.glsl`#include <output_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&o.capabilities.isWebGL2&&(n.fragmentShader=ni(n.fragmentShader,"#include <output_fragment>",a.glsl`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,i)=>{i.materialObject.userData.gMapMode!==this.groundMapMode&&(i.materialObject.userData.gMapMode=this.groundMapMode,i.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new gm(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new s.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new s.Pa4(10,10,10),normalDirection:new s.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new i1({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:s.jFi}),this._shadowBlurMat=new Ar({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new s.FM8(.5,.5)},direction:{value:new s.FM8(.5,.5)}},vertexShader:eu,fragmentShader:`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e),(n=this._viewer)==null||n.setDirty()}fromJSON(e,t){return Mi(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(!e||++this._frameNumber>this.maxFrameNumber)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:s.ywz,depthBuffer:!1,size:new s.FM8(t,t),sizeMultiplier:void 0,colorSpace:s.aCh,format:s.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,i=n.shadowMap,o=i.type,c=i.needsUpdate,f=i.autoUpdate;i.type=s._MY,i.needsUpdate=!0,i.autoUpdate=!1;const m=this._viewer.scene,y=new s.S9g;y.disableAll(),m.modelObject.traverse(N=>{N.isLight&&N!==this._light.lightObject&&(N.userData.__gp_layers=N.layers,N.layers=y)});const w=m.activeCamera.cameraObject;if(w.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";w.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),_t(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(m)),w.layers.disable(this._lightLayer);const S=w.layers.mask;w.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const C=this._viewer.renderer.getTempTarget({type:s.ywz,depthBuffer:!1,size:new s.FM8(t,t),colorSpace:s.aCh,format:s.wk1}),O=C.texture.colorSpace;C.texture.colorSpace=s.aCh,this._viewer.renderer.blit(this._target.texture,C,{clear:!0});{const N=e.material,H=e.frustumCulled,q=n.getRenderTarget(),J=n.getActiveCubeFace(),V=n.getActiveMipmapLevel();e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=C.texture,this._shadowMat.needsUpdate=!0,_t(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(m)),n.setRenderTarget(q,J,V),e.frustumCulled=H,e.material=N,this.smoothShadow&&this._applySmoothFilter(this._target,C)}return C.texture.colorSpace=O,this._viewer.renderer.releaseTempTarget(C),e.layers.disable(this._lightLayer),w.layers.mask=S,m.modelObject.traverse(N=>{N.isLight&&N!==this._light.lightObject&&(N.layers=N.userData.__gp_layers,delete N.userData.__gp_layers)}),i.type=o,i.needsUpdate=c,i.autoUpdate=f,e.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,i;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)==null?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)==null?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((i=this._target)==null?void 0:i.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(e,t){this._shadowBlurMat.uniforms.colorTexture.value=e.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(e.width,e.height),this._viewer.renderer.blit(void 0,t,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=t.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(t.width,t.height),this._viewer.renderer.blit(void 0,e,{material:this._shadowBlurMat})}}fy([ze("randomizedLight")],ed.prototype,"_light",void 0),fy([(0,a.onChange)(ed.prototype.reset),ze()],ed.prototype,"maxFrameNumber",void 0),fy([(0,a.onChange)(ed.prototype.reset),ze()],ed.prototype,"smoothShadow",void 0),fy([(0,a.onChange)(ed.prototype._groundMapModeChanged),ze()],ed.prototype,"groundMapMode",void 0),fy([ze(),(0,a.onChange)(ed.prototype._alphaVignetteChanged)],ed.prototype,"alphaVignette",void 0),fy([ze(),(0,a.onChange)(ed.prototype._alphaVignetteChanged)],ed.prototype,"alphaVignetteAxis",void 0),fy([ze()],ed.prototype,"maxBakeCount",void 0);var aM=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class my extends s.Kj0{_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)==null?void 0:e.setDirty)==null||t.call(e)}constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new s.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(q,J,V)=>{if(this.enabled){q.vertexShader=q.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const z="#glMarker beforeModulation";q.fragmentShader=q.fragmentShader.replace(z,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+z)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?Oh+`
`+Ju+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:q=>this.enabled+" "+q.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(q,{materialObject:J})=>{J.userData.__lastTransparent!==J.transparent&&(J.needsUpdate=!0,J.userData.__lastTransparent=J.transparent)},isCompatible:q=>q.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const i=new s.JOQ,o=new s.Pa4,c=new s.Pa4,f=new s.Pa4,m=new s.yGw,y=new s.Pa4(0,0,-1),w=new s.Ltg,S=new s.Pa4,C=new s.Pa4,O=new s.Ltg,N=new s.yGw,H=new s.cPb;s.M8C.isPowerOfTwo(t.texture.image.width)&&s.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(q,J,V)=>{if(!this.enabled||!q.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const z=V.view?Object.assign({},V.view):null;if(z&&V.clearViewOffset&&V.clearViewOffset(),c.setFromMatrixPosition(this.matrixWorld),f.setFromMatrixPosition(V.matrixWorld),m.extractRotation(this.matrixWorld),o.set(0,0,1),o.applyMatrix4(m),S.subVectors(c,f),S.dot(o)>0)return;S.reflect(o).negate(),S.add(c),m.extractRotation(V.matrixWorld),y.set(0,0,-1),y.applyMatrix4(m),y.add(f),C.subVectors(c,y),C.reflect(o).negate(),C.add(c),H.position.copy(S),H.up.set(0,1,0),H.up.applyMatrix4(m),H.up.reflect(o),H.lookAt(C),H.far=2,H.near=0,H.updateMatrixWorld(),H.projectionMatrix.copy(V.projectionMatrix),N.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),N.multiply(H.projectionMatrix),N.multiply(H.matrixWorldInverse),N.multiply(this.matrixWorld),i.setFromNormalAndCoplanarPoint(o,c),i.applyMatrix4(H.matrixWorldInverse),w.set(i.normal.x,i.normal.y,i.normal.z,i.constant);const ue=H.projectionMatrix;O.x=(Math.sign(w.x)+ue.elements[8])/ue.elements[0],O.y=(Math.sign(w.y)+ue.elements[9])/ue.elements[5],O.z=-1,O.w=(1+ue.elements[10])/ue.elements[14],w.multiplyScalar(2/w.dot(O)),ue.elements[2]=w.x,ue.elements[6]=w.y,ue.elements[10]=w.z+1-n,ue.elements[14]=w.w,this.visible=!1;const me=q.getRenderTarget(),Te=q.xr.enabled,Be=q.shadowMap.autoUpdate;q.xr.enabled=!1,q.shadowMap.autoUpdate=!1,q.setRenderTarget(this._renderTarget),q.state.buffers.depth.setMask(!0),q.autoClear===!1&&q.clear();const He=J.background;this.transparentReflectionBackground&&(J.background=null);const tt=!this.transparentReflectionBackground;He&&tt&&(He.userData||(He.userData={}),He.userData.flipX=!He.userData.flipX),_t(q,{shadowMapRender:!1,backgroundRender:tt,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>q.render(J,H)),He&&tt&&(He.userData.flipX=!He.userData.flipX||void 0),this.transparentReflectionBackground&&(J.background=He),q.xr.enabled=Te,q.shadowMap.autoUpdate=Be,q.setRenderTarget(me),z!=null&&z.enabled&&V.setViewOffset&&V.setViewOffset(z.fullWidth,z.fullHeight,z.offsetX,z.offsetY,z.width,z.height);const lt=V.viewport;lt!==void 0&&q.state.viewport(lt),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=N,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new s.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=N}getRenderTarget(){return this._renderTarget}}aM([(0,a.onChange)(my.prototype._updateExtension)],my.prototype,"enabled",void 0),aM([(0,a.onChange)(my.prototype._updateExtension)],my.prototype,"reflectorModePhysical",void 0),my.prototype.isReflector=!0;var gy=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Uu extends Ri{get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[fi],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new s._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(e){this._options.autoAdjustTransform=e,this.refreshTransform()}_createMesh(){return new s.Kj0(this._geometry)}async onAdded(e){var n,i;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(fi);const t=this._createMesh();t.userData.physicsMass=0,this._iMesh=await((n=this._manager)==null?void 0:n.addImportedSingle(t,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(i=this._iMesh)==null?void 0:i.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n,i;return this._removeMaterial(),this._geometry.dispose(),(t=this._material)==null||t.dispose(),(i=(n=this._iMesh)==null?void 0:n.dispose)==null||i.call(n),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){(e==null?void 0:e.geometryChanged)!==!1&&(e==null?void 0:e.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var t;const e=(t=this._viewer)==null?void 0:t.scene.activeCamera.controls;e&&(e.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=e.maxPolarAngle),e.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(e.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var t,n,i;if(!this._mesh||!this._viewer)return;let e=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,e=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const o=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const c=o.getCenter(new s.Pa4).sub(new s.Pa4(0,o.getSize(new s.Pa4).y/2+this.yOffset,0));e=e||c.clone().sub(this._mesh.position).length()>1e-4,e&&this._mesh.position.copy(c)}e=e||Math.abs(this._mesh.scale.x-this.size)>1e-4,e&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new s.USm(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(n=(t=this._mesh).setDirty)==null||n.call(t)),this._transformNeedRefresh=!1}else e&&((i=this._viewer)==null||i.scene.setDirty())}_refreshMaterial(){var n,i,o,c;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const e=this._material??((i=(n=this._manager)==null?void 0:n.materials)==null?void 0:i.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215}));let t=!1;return e!==this._material&&(this._removeMaterial(),e&&(this._material=e),(o=this._material)!=null&&o.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,(((c=this._mesh)==null?void 0:c.setMaterial)??(m=>{this._mesh&&(this._mesh.material=m.materialObject)}))(this._material)),t=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),t}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)==null?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}gy([ze("material")],Uu.prototype,"_material",void 0),gy([(0,a.onChange)(Uu.prototype.refreshTransform),ze()],Uu.prototype,"visible",void 0),gy([(0,a.onChange2)(Uu.prototype._onSceneUpdate),ze()],Uu.prototype,"size",void 0),gy([(0,a.onChange2)(Uu.prototype._onSceneUpdate),ze()],Uu.prototype,"yOffset",void 0),gy([(0,a.onChange)(Uu.prototype._refreshOptions2),ze()],Uu.prototype,"renderToDepth",void 0),gy([(0,a.onChange)(Uu.prototype._refreshOptions2),ze()],Uu.prototype,"tonemapGround",void 0),gy([(0,a.onChange)(Uu.prototype._refreshCameraLimits),ze()],Uu.prototype,"limitCameraAboveGround",void 0);var $x=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Hd extends Uu{get shadowBaker(){return this._shadowBaker}bakeShadows(){var e;(e=this._shadowBaker)==null||e.reset()}constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoBakeShadows=!0,this._showDebug=t,t&&this.dependencies.push(Fd),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const e=new my(this._geometry,this._viewer.renderer.createTarget({type:s.ywz,format:s.wk1,colorSpace:s.aCh,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:s.D1R,magFilter:s.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var c,f,m,y,w;let i=(f=(c=this._viewer)==null?void 0:c.getPluginByType("SSReflection"))==null?void 0:f.passes.ssr.passObject;i&&!i.enabled&&(i=void 0),i&&(i.enabled=!1);let o=(w=(y=(m=this._viewer)==null?void 0:m.getPluginByType("SSBevelPlugin"))==null?void 0:y.pass)==null?void 0:w.passObject;o&&!o.enabled&&(o=void 0),o&&(o.enabled=!1),t(...n),i&&(i.enabled=!0),o&&(o.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(Fd))==null||t.addTexture("bake_ground_1",()=>{var i,o;return(o=(i=this._shadowBaker)==null?void 0:i.light.shadow.map)==null?void 0:o.texture},[100,100,200,200]),(n=e.getPlugin(Fd))==null||n.addTexture("bake_ground_2",()=>{var i,o;return(o=(i=this._shadowBaker)==null?void 0:i.target)==null?void 0:o.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,i;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)==null||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o||console.warn("unable to find the extension to unregister"),(i=(n=this._material).unregisterMaterialExtensions)==null||i.call(n,[o]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&this.autoBakeShadows&&((t=this._shadowBaker)==null||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new ed(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var t,n,i,o;if(!this._viewer)return!1;const e=super._refreshMaterial();if(!this._material)return e;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const c=this._mesh.materialExtension;c.updaters=[this._viewer.scene,this._viewer.renderer],(n=(t=this._material).registerMaterialExtensions)==null||n.call(t,[c]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((o=(i=this._material).registerMaterialExtensions)==null||o.call(i,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),e}_extraUiConfig(){var e,t,n,i,o,c,f,m,y,w,S,C,O,N,H,q,J,V,z,ue,me,Te,Be,He,tt,lt,at,St,mt,gt;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var Ot,Bt;return(Bt=(Ot=this._uiConfig)==null?void 0:Ot.uiRefresh)==null?void 0:Bt.call(Ot,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var Ot;return!((Ot=this._shadowBaker)!=null&&Ot.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(Ot=>({label:Ot,value:Ot})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)==null?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)==null?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(i=(n=this._shadowBaker)==null?void 0:n.light)==null?void 0:i.shadowParams,"enabled"],onChange:[(c=(o=this._shadowBaker)==null?void 0:o.light)==null?void 0:c.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(m=(f=this._shadowBaker)==null?void 0:f.light)==null?void 0:m.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(w=(y=this._shadowBaker)==null?void 0:y.light)==null?void 0:w.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(C=(S=this._shadowBaker)==null?void 0:S.light)==null?void 0:C.randomParams,"distanceScale"],onChange:[(N=(O=this._shadowBaker)==null?void 0:O.light)==null?void 0:N.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(q=(H=this._shadowBaker)==null?void 0:H.light)==null?void 0:q.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(V=(J=this._shadowBaker)==null?void 0:J.light)==null?void 0:V.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(ue=(z=this._shadowBaker)==null?void 0:z.light)==null?void 0:ue.shadowParams,"radius"],onChange:[(Te=(me=this._shadowBaker)==null?void 0:me.light)==null?void 0:Te.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(He=(Be=this._shadowBaker)==null?void 0:Be.light)==null?void 0:He.shadowParams,"frustumSize"],onChange:[(lt=(tt=this._shadowBaker)==null?void 0:tt.light)==null?void 0:lt.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(St=(at=this._shadowBaker)==null?void 0:at.light)==null?void 0:St.shadowParams,"bias"],onChange:[(gt=(mt=this._shadowBaker)==null?void 0:mt.light)==null?void 0:gt.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}Hd.PluginType="Ground",$x([(0,a.onChange)(Hd.prototype.refreshOptions),ze()],Hd.prototype,"bakedShadows",void 0),$x([(0,a.onChange)(Hd.prototype.refreshOptions),ze()],Hd.prototype,"groundReflection",void 0),$x([(0,a.onChange)(Hd.prototype.refreshOptions),ze()],Hd.prototype,"physicalReflections",void 0),$x([ze("shadowBaker")],Hd.prototype,"_shadowBaker",void 0);class lM extends So{constructor(e){super(e)}async initialize({caching:e=!0,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,enableDrop:o=!1,importPopup:c=!1,debug:f=!1}={}){return f&&await this.addPlugin(Fd),this.getPlugin(fi)||this.addPluginSync(fi,void 0,void 0,{storage:e&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await this.addPlugin(ms,!0),await Jx(this,{ground:t,bloom:n,depthTonemap:i,enableDrop:o,importPopup:c}),await this.addPlugin(kp),await this.addPlugin(D),await this.addPlugin(L_),await this.addPlugin(N_),await this.addPlugin(Jm),this}}async function Jx(l,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:i=!1,importPopup:o=!1}={}){await l.getOrAddPlugin(fi),o&&await l.getOrAddPlugin(Lc),await l.getOrAddPlugin(vr),await l.getOrAddPlugin(ru),i&&await l.getOrAddPlugin(of),await l.addPlugin(new to(32)),await l.getOrAddPlugin(Jc),await l.getOrAddPlugin(Og),await l.addPlugin(new pp(n||!l.useRgbm)),await l.getOrAddPlugin(Co),await l.getOrAddPlugin(Yh),await l.getOrAddPlugin(lm),await l.getOrAddPlugin(p_),await l.getOrAddPlugin(Ka),await l.getOrAddPlugin(Vo),await l.getOrAddPlugin(Fs),await l.getOrAddPlugin(Zu),await l.getOrAddPlugin(Ws),await l.getOrAddPlugin(Na),await l.getOrAddPlugin(Nu),await l.getOrAddPlugin(Ec),await l.getOrAddPlugin(dl),await l.getOrAddPlugin(yl),await l.getOrAddPlugin(Ll),await l.getOrAddPlugin(zl),await l.getOrAddPlugin(Bu),await l.getOrAddPlugin(Um,!1),await l.getOrAddPlugin(Dc),await l.getOrAddPlugin(ks),await l.getOrAddPlugin(Nl,!1),await l.getOrAddPlugin(fl,!1),await l.getOrAddPlugin(mp,!1),await l.getOrAddPlugin(ml,!1),await l.getOrAddPlugin(mm,!1),await l.getOrAddPlugin(Uh,!1),await l.getOrAddPlugin(Lu,!1),await l.getOrAddPlugin(nc),await l.getOrAddPlugin(uf),await l.getOrAddPlugin(Zl),await l.getOrAddPlugin(Fl),t&&await l.getOrAddPlugin(Go),e&&await l.getOrAddPlugin(Hd),l.renderer.refreshPipeline()}let bI=0;class cM extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=bI++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const e=window.freeViewers.pop(),t=document.createElement("style");t.textContent=a.css`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.shadowRoot.append(t,this.wrapper),this._initialized=!0,this._initialize(e).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(e){e!=null&&e._lastState&&(this._state.src=e._lastState.src||this._state.src,this._state.environment=e._lastState.environment||this._state.environment,delete e._lastState),e!=null&&e.__models&&(this._models={...this._models,...e.__models},delete e.__models),this.canvas=(e==null?void 0:e.canvas)||(0,a.createCanvasElement)(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=e??new lM({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),e||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var e,t;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((e=this.canvas)==null||e.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((t=this.canvas)==null||t.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(e,t,n){this.refreshAll()}clearViewer(){var e,t;(e=this.viewer)==null||e.scene.disposeSceneModels(),(t=this.viewer)==null||t.scene.setEnvironment(null),Object.values(this._models).forEach(async n=>n.then(i=>i.forEach(o=>o.dispose&&o.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],i=[],o=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const f of t)!this._models[f]&&f&&(this._models[f]=this.viewer.getManager().importer.importPath(f,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const c=this.viewer.scene.environment;c?this._environmentFromSource=c:this.viewer.scene.environment=o;for(const[f,m]of Object.entries(this._models))t.includes(f)?n.push(m.then(y=>[f,y])):i.push(m);await Promise.all([Promise.all(n).then(async f=>Promise.all(f.map(async m=>(this._models[m[0]]=this.viewer.getManager().importer.processImported(m[1]),this._models[m[0]])))).then(f=>{for(const m of f)for(const y of m)y&&y.assetType==="model"&&this.viewer.scene.addSceneObject(y)}),Promise.all(i).then(f=>{for(const m of f)for(const y of m)y&&y.assetType==="model"&&y.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:e}})),this._state.environment=e,this._refreshingEnvironment=!1)}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}addEventListener(e,t,n){super.addEventListener(e,t,n),e==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",cM);class p0{get basePath(){return this._basePath}get assets(){return this._assets}constructor(e){var t;this._basePath=(e==null?void 0:e.basePath)??"",this._assets=((t=e==null?void 0:e.assets)==null?void 0:t.map(n=>this._resolveAsset(n)))??[]}find(e){return this._assets.find(e)??void 0}_resolveAsset(e){return{...e,path:(0,a.pathJoin)([this._basePath,e.path])}}}class xI extends a.SimpleEventDispatcher{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(i=>{var o;return i&&(e.test(i.path)||e.test(((o=i.file)==null?void 0:o.name)??""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}const uM=new s.Pa4,hM=new s.Pa4,cu=new s.Ltg,uu=new s.Ltg,Zm=new s.Ltg,r1=new s.Pa4,s1=new s.yGw,hu=new s.Zzh,dM=new s.Pa4,Zx=new s.ZzF,ew=new s.aLr,eg=new s.Ltg;let tg,vy;function pM(l,e,t){return eg.set(0,0,-e,1).applyMatrix4(l.projectionMatrix),eg.multiplyScalar(1/eg.w),eg.x=vy/t.width,eg.y=vy/t.height,eg.applyMatrix4(l.projectionMatrixInverse),eg.multiplyScalar(1/eg.w),Math.abs(Math.max(eg.x,eg.y))}class fM extends s.Kj0{constructor(e=new Ug,t=new Fg({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let c=0,f=0,m=t.count;c<m;c++,f+=2)uM.fromBufferAttribute(t,c),hM.fromBufferAttribute(n,c),i[f]=f===0?0:i[f-1],i[f+1]=i[f]+uM.distanceTo(hM);const o=new s.$TI(i,2,1);return e.setAttribute("instanceDistanceStart",new s.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new s.kB5(o,1,1)),this}raycast(e,t){const n=this.material.worldUnits,i=e.camera;i!==null||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const o=e.params.Line2!==void 0&&e.params.Line2.threshold||0;tg=e.ray;const c=this.matrixWorld,f=this.geometry,m=this.material;let y,w;vy=m.linewidth+o,f.boundingSphere===null&&f.computeBoundingSphere(),ew.copy(f.boundingSphere).applyMatrix4(c),y=n?.5*vy:pM(i,Math.max(i.near,ew.distanceToPoint(tg.origin)),m.resolution),ew.radius+=y,tg.intersectsSphere(ew)!==!1&&(f.boundingBox===null&&f.computeBoundingBox(),Zx.copy(f.boundingBox).applyMatrix4(c),w=n?.5*vy:pM(i,Math.max(i.near,Zx.distanceToPoint(tg.origin)),m.resolution),Zx.expandByScalar(w),tg.intersectsBox(Zx)!==!1&&(n?function(S,C){const O=S.matrixWorld,N=S.geometry,H=N.attributes.instanceStart,q=N.attributes.instanceEnd;for(let J=0,V=Math.min(N.instanceCount,H.count);J<V;J++){hu.start.fromBufferAttribute(H,J),hu.end.fromBufferAttribute(q,J),hu.applyMatrix4(O);const z=new s.Pa4,ue=new s.Pa4;tg.distanceSqToSegment(hu.start,hu.end,ue,z),ue.distanceTo(z)<.5*vy&&C.push({point:ue,pointOnLine:z,distance:tg.origin.distanceTo(ue),object:S,face:null,faceIndex:J,uv:null,uv1:null})}}(this,t):function(S,C,O){const N=C.projectionMatrix,H=S.material.resolution,q=S.matrixWorld,J=S.geometry,V=J.attributes.instanceStart,z=J.attributes.instanceEnd,ue=Math.min(J.instanceCount,V.count),me=-C.near;tg.at(1,Zm),Zm.w=1,Zm.applyMatrix4(C.matrixWorldInverse),Zm.applyMatrix4(N),Zm.multiplyScalar(1/Zm.w),Zm.x*=H.x/2,Zm.y*=H.y/2,Zm.z=0,r1.copy(Zm),s1.multiplyMatrices(C.matrixWorldInverse,q);for(let Te=0,Be=ue;Te<Be;Te++){if(cu.fromBufferAttribute(V,Te),uu.fromBufferAttribute(z,Te),cu.w=1,uu.w=1,cu.applyMatrix4(s1),uu.applyMatrix4(s1),cu.z>me&&uu.z>me)continue;if(cu.z>me){const St=cu.z-uu.z,mt=(cu.z-me)/St;cu.lerp(uu,mt)}else if(uu.z>me){const St=uu.z-cu.z,mt=(uu.z-me)/St;uu.lerp(cu,mt)}cu.applyMatrix4(N),uu.applyMatrix4(N),cu.multiplyScalar(1/cu.w),uu.multiplyScalar(1/uu.w),cu.x*=H.x/2,cu.y*=H.y/2,uu.x*=H.x/2,uu.y*=H.y/2,hu.start.copy(cu),hu.start.z=0,hu.end.copy(uu),hu.end.z=0;const He=hu.closestPointToPointParameter(r1,!0);hu.at(He,dM);const tt=s.M8C.lerp(cu.z,uu.z,He),lt=tt>=-1&&tt<=1,at=r1.distanceTo(dM)<.5*vy;if(lt&&at){hu.start.fromBufferAttribute(V,Te),hu.end.fromBufferAttribute(z,Te),hu.start.applyMatrix4(q),hu.end.applyMatrix4(q);const St=new s.Pa4,mt=new s.Pa4;tg.distanceSqToSegment(hu.start,hu.end,mt,St),O.push({point:mt,pointOnLine:St,distance:tg.origin.distanceTo(mt),object:S,face:null,faceIndex:Te,uv:null,uv1:null})}}}(this,i,t)))}}class mM extends Ug{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setColors(n),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class wI extends fM{constructor(e=new mM,t=new Fg({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class EI extends s.yxD{constructor(e){super(e),this.type=s.cLu}parse(e){const me=Math.pow(2.7182818,2.2),Te={l:0,c:0,lc:0};function Be(jt,An,kn,bi,Pi){for(;kn<jt;)An=An<<8|zr(bi,Pi),kn+=8;kn-=jt,Te.l=An>>kn&(1<<jt)-1,Te.c=An,Te.lc=kn}const He=new Array(59);function tt(jt){return 63&jt}function lt(jt){return jt>>6}const at={c:0,lc:0};function St(jt,An,kn,bi){jt=jt<<8|zr(kn,bi),An+=8,at.c=jt,at.lc=An}const mt={c:0,lc:0};function gt(jt,An,kn,bi,Pi,jn,xi,_r,Lr){if(jt==An){bi<8&&(St(kn,bi,Pi,jn),kn=at.c,bi=at.lc);let Ur=kn>>(bi-=8);if(Ur=new Uint8Array([Ur])[0],_r.value+Ur>Lr)return!1;const Dr=xi[_r.value-1];for(;Ur-- >0;)xi[_r.value++]=Dr}else{if(!(_r.value<Lr))return!1;xi[_r.value++]=jt}mt.c=kn,mt.lc=bi}function Ot(jt){return 65535&jt}function Bt(jt){const An=Ot(jt);return An>32767?An-65536:An}const Ft={a:0,b:0};function _n(jt,An){const kn=Bt(jt),bi=Bt(An),Pi=kn+(1&bi)+(bi>>1),jn=Pi,xi=Pi-bi;Ft.a=jn,Ft.b=xi}function mn(jt,An){const kn=Ot(jt),bi=Ot(An),Pi=kn-(bi>>1)&65535,jn=bi+Pi-32768&65535;Ft.a=jn,Ft.b=Pi}function qn(jt,An,kn,bi,Pi,jn,xi){const _r=xi<16384,Lr=kn>Pi?Pi:kn;let Ur,Dr,ns=1;for(;ns<=Lr;)ns<<=1;for(ns>>=1,Ur=ns,ns>>=1;ns>=1;){Dr=0;const yr=Dr+jn*(Pi-Ur),pr=jn*ns,Jr=jn*Ur,Gi=bi*ns,Rr=bi*Ur;let Or,ls,ga,Do;for(;Dr<=yr;Dr+=Jr){let Sr=Dr;const hs=Dr+bi*(kn-Ur);for(;Sr<=hs;Sr+=Rr){const Rs=Sr+Gi,cc=Sr+pr,cd=cc+Gi;_r?(_n(jt[Sr+An],jt[cc+An]),Or=Ft.a,ga=Ft.b,_n(jt[Rs+An],jt[cd+An]),ls=Ft.a,Do=Ft.b,_n(Or,ls),jt[Sr+An]=Ft.a,jt[Rs+An]=Ft.b,_n(ga,Do),jt[cc+An]=Ft.a,jt[cd+An]=Ft.b):(mn(jt[Sr+An],jt[cc+An]),Or=Ft.a,ga=Ft.b,mn(jt[Rs+An],jt[cd+An]),ls=Ft.a,Do=Ft.b,mn(Or,ls),jt[Sr+An]=Ft.a,jt[Rs+An]=Ft.b,mn(ga,Do),jt[cc+An]=Ft.a,jt[cd+An]=Ft.b)}if(kn&ns){const Rs=Sr+pr;_r?_n(jt[Sr+An],jt[Rs+An]):mn(jt[Sr+An],jt[Rs+An]),Or=Ft.a,jt[Rs+An]=Ft.b,jt[Sr+An]=Or}}if(Pi&ns){let Sr=Dr;const hs=Dr+bi*(kn-Ur);for(;Sr<=hs;Sr+=Rr){const Rs=Sr+Gi;_r?_n(jt[Sr+An],jt[Rs+An]):mn(jt[Sr+An],jt[Rs+An]),Or=Ft.a,jt[Rs+An]=Ft.b,jt[Sr+An]=Or}}Ur=ns,ns>>=1}return Dr}function Rn(jt,An,kn,bi,Pi,jn){const xi=kn.value,_r=Fr(An,kn),Lr=Fr(An,kn);kn.value+=4;const Ur=Fr(An,kn);if(kn.value+=4,_r<0||_r>=65537||Lr<0||Lr>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Dr=new Array(65537),ns=new Array(16384);if(function(yr){for(let pr=0;pr<16384;pr++)yr[pr]={},yr[pr].len=0,yr[pr].lit=0,yr[pr].p=null}(ns),function(yr,pr,Jr,Gi,Rr,Or){const ls=pr;let ga=0,Do=0;for(;Gi<=Rr;Gi++){if(ls.value-pr.value>Jr)return!1;Be(6,ga,Do,yr,ls);const Sr=Te.l;if(ga=Te.c,Do=Te.lc,Or[Gi]=Sr,Sr==63){if(ls.value-pr.value>Jr)throw new Error("Something wrong with hufUnpackEncTable");Be(8,ga,Do,yr,ls);let hs=Te.l+6;if(ga=Te.c,Do=Te.lc,Gi+hs>Rr+1)throw new Error("Something wrong with hufUnpackEncTable");for(;hs--;)Or[Gi++]=0;Gi--}else if(Sr>=59){let hs=Sr-59+2;if(Gi+hs>Rr+1)throw new Error("Something wrong with hufUnpackEncTable");for(;hs--;)Or[Gi++]=0;Gi--}}(function(Sr){for(let Rs=0;Rs<=58;++Rs)He[Rs]=0;for(let Rs=0;Rs<65537;++Rs)He[Sr[Rs]]+=1;let hs=0;for(let Rs=58;Rs>0;--Rs){const cc=hs+He[Rs]>>1;He[Rs]=hs,hs=cc}for(let Rs=0;Rs<65537;++Rs){const cc=Sr[Rs];cc>0&&(Sr[Rs]=cc|He[cc]++<<6)}})(Or)}(jt,kn,bi-(kn.value-xi),_r,Lr,Dr),Ur>8*(bi-(kn.value-xi)))throw new Error("Something wrong with hufUncompress");(function(yr,pr,Jr,Gi){for(;pr<=Jr;pr++){const Rr=lt(yr[pr]),Or=tt(yr[pr]);if(Rr>>Or)throw new Error("Invalid table entry");if(Or>14){const ls=Gi[Rr>>Or-14];if(ls.len)throw new Error("Invalid table entry");if(ls.lit++,ls.p){const ga=ls.p;ls.p=new Array(ls.lit);for(let Do=0;Do<ls.lit-1;++Do)ls.p[Do]=ga[Do]}else ls.p=new Array(1);ls.p[ls.lit-1]=pr}else if(Or){let ls=0;for(let ga=1<<14-Or;ga>0;ga--){const Do=Gi[(Rr<<14-Or)+ls];if(Do.len||Do.p)throw new Error("Invalid table entry");Do.len=Or,Do.lit=pr,ls++}}}})(Dr,_r,Lr,ns),function(yr,pr,Jr,Gi,Rr,Or,ls,ga,Do){let Sr=0,hs=0;const Rs=ls,cc=Math.trunc(Gi.value+(Rr+7)/8);for(;Gi.value<cc;)for(St(Sr,hs,Jr,Gi),Sr=at.c,hs=at.lc;hs>=14;){const Fc=pr[Sr>>hs-14&16383];if(Fc.len)hs-=Fc.len,gt(Fc.lit,Or,Sr,hs,Jr,Gi,ga,Do,Rs),Sr=mt.c,hs=mt.lc;else{if(!Fc.p)throw new Error("hufDecode issues");let nv;for(nv=0;nv<Fc.lit;nv++){const Jy=tt(yr[Fc.p[nv]]);for(;hs<Jy&&Gi.value<cc;)St(Sr,hs,Jr,Gi),Sr=at.c,hs=at.lc;if(hs>=Jy&&lt(yr[Fc.p[nv]])==(Sr>>hs-Jy&(1<<Jy)-1)){hs-=Jy,gt(Fc.p[nv],Or,Sr,hs,Jr,Gi,ga,Do,Rs),Sr=mt.c,hs=mt.lc;break}}if(nv==Fc.lit)throw new Error("hufDecode issues")}}const cd=8-Rr&7;for(Sr>>=cd,hs-=cd;hs>0;){const Fc=pr[Sr<<14-hs&16383];if(!Fc.len)throw new Error("hufDecode issues");hs-=Fc.len,gt(Fc.lit,Or,Sr,hs,Jr,Gi,ga,Do,Rs),Sr=mt.c,hs=mt.lc}}(Dr,ns,jt,kn,Ur,Lr,jn,Pi,{value:0})}function En(jt){for(let An=1;An<jt.length;An++){const kn=jt[An-1]+jt[An]-128;jt[An]=kn}}function ai(jt,An){let kn=0,bi=Math.floor((jt.length+1)/2),Pi=0;const jn=jt.length-1;for(;!(Pi>jn||(An[Pi++]=jt[kn++],Pi>jn));)An[Pi++]=jt[bi++]}function ri(jt){let An=jt.byteLength;const kn=new Array;let bi=0;const Pi=new DataView(jt);for(;An>0;){const jn=Pi.getInt8(bi++);if(jn<0){const xi=-jn;An-=xi+1;for(let _r=0;_r<xi;_r++)kn.push(Pi.getUint8(bi++))}else{const xi=jn;An-=2;const _r=Pi.getUint8(bi++);for(let Lr=0;Lr<xi+1;Lr++)kn.push(_r)}}return kn}function Ei(jt,An,kn){let bi,Pi=1;for(;Pi<64;)bi=An[jt.value],bi==65280?Pi=64:bi>>8==255?Pi+=255&bi:(kn[Pi]=bi,Pi++),jt.value++}function ki(jt){const An=.5*Math.cos(.7853975),kn=.5*Math.cos(3.14159/16),bi=.5*Math.cos(3.14159/8),Pi=.5*Math.cos(3*3.14159/16),jn=.5*Math.cos(.981746875),xi=.5*Math.cos(3*3.14159/8),_r=.5*Math.cos(1.374445625),Lr=new Array(4),Ur=new Array(4),Dr=new Array(4),ns=new Array(4);for(let yr=0;yr<8;++yr){const pr=8*yr;Lr[0]=bi*jt[pr+2],Lr[1]=xi*jt[pr+2],Lr[2]=bi*jt[pr+6],Lr[3]=xi*jt[pr+6],Ur[0]=kn*jt[pr+1]+Pi*jt[pr+3]+jn*jt[pr+5]+_r*jt[pr+7],Ur[1]=Pi*jt[pr+1]-_r*jt[pr+3]-kn*jt[pr+5]-jn*jt[pr+7],Ur[2]=jn*jt[pr+1]-kn*jt[pr+3]+_r*jt[pr+5]+Pi*jt[pr+7],Ur[3]=_r*jt[pr+1]-jn*jt[pr+3]+Pi*jt[pr+5]-kn*jt[pr+7],Dr[0]=An*(jt[pr+0]+jt[pr+4]),Dr[3]=An*(jt[pr+0]-jt[pr+4]),Dr[1]=Lr[0]+Lr[3],Dr[2]=Lr[1]-Lr[2],ns[0]=Dr[0]+Dr[1],ns[1]=Dr[3]+Dr[2],ns[2]=Dr[3]-Dr[2],ns[3]=Dr[0]-Dr[1],jt[pr+0]=ns[0]+Ur[0],jt[pr+1]=ns[1]+Ur[1],jt[pr+2]=ns[2]+Ur[2],jt[pr+3]=ns[3]+Ur[3],jt[pr+4]=ns[3]-Ur[3],jt[pr+5]=ns[2]-Ur[2],jt[pr+6]=ns[1]-Ur[1],jt[pr+7]=ns[0]-Ur[0]}for(let yr=0;yr<8;++yr)Lr[0]=bi*jt[16+yr],Lr[1]=xi*jt[16+yr],Lr[2]=bi*jt[48+yr],Lr[3]=xi*jt[48+yr],Ur[0]=kn*jt[8+yr]+Pi*jt[24+yr]+jn*jt[40+yr]+_r*jt[56+yr],Ur[1]=Pi*jt[8+yr]-_r*jt[24+yr]-kn*jt[40+yr]-jn*jt[56+yr],Ur[2]=jn*jt[8+yr]-kn*jt[24+yr]+_r*jt[40+yr]+Pi*jt[56+yr],Ur[3]=_r*jt[8+yr]-jn*jt[24+yr]+Pi*jt[40+yr]-kn*jt[56+yr],Dr[0]=An*(jt[yr]+jt[32+yr]),Dr[3]=An*(jt[yr]-jt[32+yr]),Dr[1]=Lr[0]+Lr[3],Dr[2]=Lr[1]-Lr[2],ns[0]=Dr[0]+Dr[1],ns[1]=Dr[3]+Dr[2],ns[2]=Dr[3]-Dr[2],ns[3]=Dr[0]-Dr[1],jt[0+yr]=ns[0]+Ur[0],jt[8+yr]=ns[1]+Ur[1],jt[16+yr]=ns[2]+Ur[2],jt[24+yr]=ns[3]+Ur[3],jt[32+yr]=ns[3]-Ur[3],jt[40+yr]=ns[2]-Ur[2],jt[48+yr]=ns[1]-Ur[1],jt[56+yr]=ns[0]-Ur[0]}function Xi(jt){for(let An=0;An<64;++An){const kn=jt[0][An],bi=jt[1][An],Pi=jt[2][An];jt[0][An]=kn+1.5747*Pi,jt[1][An]=kn-.1873*bi-.4682*Pi,jt[2][An]=kn+1.8556*bi}}function ts(jt,An,kn){for(let Pi=0;Pi<64;++Pi)An[kn+Pi]=s.A5E.toHalfFloat((bi=jt[Pi])<=1?Math.sign(bi)*Math.pow(Math.abs(bi),2.2):Math.sign(bi)*Math.pow(me,Math.abs(bi)-1));var bi}function Cr(jt){return new DataView(jt.array.buffer,jt.offset.value,jt.size)}function wr(jt){const An=jt.viewer.buffer.slice(jt.offset.value,jt.offset.value+jt.size),kn=new Uint8Array(ri(An)),bi=new Uint8Array(kn.length);return En(kn),ai(kn,bi),new DataView(bi.buffer)}function zn(jt){const An=P_(jt.array.slice(jt.offset.value,jt.offset.value+jt.size)),kn=new Uint8Array(An.length);return En(An),ai(An,kn),new DataView(kn.buffer)}function oi(jt){const An=jt.viewer,kn={value:jt.offset.value},bi=new Uint16Array(jt.width*jt.scanlineBlockSize*(jt.channels*jt.type)),Pi=new Uint8Array(8192);let jn=0;const xi=new Array(jt.channels);for(let Jr=0;Jr<jt.channels;Jr++)xi[Jr]={},xi[Jr].start=jn,xi[Jr].end=xi[Jr].start,xi[Jr].nx=jt.width,xi[Jr].ny=jt.lines,xi[Jr].size=jt.type,jn+=xi[Jr].nx*xi[Jr].ny*xi[Jr].size;const _r=Br(An,kn),Lr=Br(An,kn);if(Lr>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(_r<=Lr)for(let Jr=0;Jr<Lr-_r+1;Jr++)Pi[Jr+_r]=lr(An,kn);const Ur=new Uint16Array(65536),Dr=function(Jr,Gi){let Rr=0;for(let ls=0;ls<65536;++ls)(ls==0||Jr[ls>>3]&1<<(7&ls))&&(Gi[Rr++]=ls);const Or=Rr-1;for(;Rr<65536;)Gi[Rr++]=0;return Or}(Pi,Ur),ns=Fr(An,kn);Rn(jt.array,An,kn,ns,bi,jn);for(let Jr=0;Jr<jt.channels;++Jr){const Gi=xi[Jr];for(let Rr=0;Rr<xi[Jr].size;++Rr)qn(bi,Gi.start+Rr,Gi.nx,Gi.size,Gi.ny,Gi.nx*Gi.size,Dr)}(function(Jr,Gi,Rr){for(let Or=0;Or<Rr;++Or)Gi[Or]=Jr[Gi[Or]]})(Ur,bi,jn);let yr=0;const pr=new Uint8Array(bi.buffer.byteLength);for(let Jr=0;Jr<jt.lines;Jr++)for(let Gi=0;Gi<jt.channels;Gi++){const Rr=xi[Gi],Or=Rr.nx*Rr.size,ls=new Uint8Array(bi.buffer,Rr.end*2,Or*2);pr.set(ls,yr),yr+=Or*2,Rr.end+=Or}return new DataView(pr.buffer)}function Ti(jt){const An=P_(jt.array.slice(jt.offset.value,jt.offset.value+jt.size)),kn=jt.lines*jt.channels*jt.width,bi=jt.type==1?new Uint16Array(kn):new Uint32Array(kn);let Pi=0,jn=0;const xi=new Array(4);for(let _r=0;_r<jt.lines;_r++)for(let Lr=0;Lr<jt.channels;Lr++){let Ur=0;switch(jt.type){case 1:xi[0]=Pi,xi[1]=xi[0]+jt.width,Pi=xi[1]+jt.width;for(let Dr=0;Dr<jt.width;++Dr)Ur+=An[xi[0]++]<<8|An[xi[1]++],bi[jn]=Ur,jn++;break;case 2:xi[0]=Pi,xi[1]=xi[0]+jt.width,xi[2]=xi[1]+jt.width,Pi=xi[2]+jt.width;for(let Dr=0;Dr<jt.width;++Dr)Ur+=An[xi[0]++]<<24|An[xi[1]++]<<16|An[xi[2]++]<<8,bi[jn]=Ur,jn++}}return new DataView(bi.buffer)}function Hr(jt){const An=jt.viewer,kn={value:jt.offset.value},bi=new Uint8Array(jt.width*jt.lines*(jt.channels*jt.type*2)),Pi={version:Sn(An,kn),unknownUncompressedSize:Sn(An,kn),unknownCompressedSize:Sn(An,kn),acCompressedSize:Sn(An,kn),dcCompressedSize:Sn(An,kn),rleCompressedSize:Sn(An,kn),rleUncompressedSize:Sn(An,kn),rleRawSize:Sn(An,kn),totalAcUncompressedCount:Sn(An,kn),totalDcUncompressedCount:Sn(An,kn),acCompression:Sn(An,kn)};if(Pi.version<2)throw new Error("EXRLoader.parse: "+lc.compression+" version "+Pi.version+" is unsupported");const jn=new Array;let xi=Br(An,kn)-2;for(;xi>0;){const Gi=ps(An.buffer,kn),Rr=lr(An,kn),Or=Rr>>2&3,ls=new Int8Array([(Rr>>4)-1])[0],ga=lr(An,kn);jn.push({name:Gi,index:ls,type:ga,compression:Or}),xi-=Gi.length+3}const _r=lc.channels,Lr=new Array(jt.channels);for(let Gi=0;Gi<jt.channels;++Gi){const Rr=Lr[Gi]={},Or=_r[Gi];Rr.name=Or.name,Rr.compression=0,Rr.decoded=!1,Rr.type=Or.pixelType,Rr.pLinear=Or.pLinear,Rr.width=jt.width,Rr.height=jt.lines}const Ur={idx:new Array(3)};for(let Gi=0;Gi<jt.channels;++Gi){const Rr=Lr[Gi];for(let Or=0;Or<jn.length;++Or){const ls=jn[Or];Rr.name==ls.name&&(Rr.compression=ls.compression,ls.index>=0&&(Ur.idx[ls.index]=Gi),Rr.offset=Gi)}}let Dr,ns,yr;if(Pi.acCompressedSize>0)switch(Pi.acCompression){case 0:Dr=new Uint16Array(Pi.totalAcUncompressedCount),Rn(jt.array,An,kn,Pi.acCompressedSize,Dr,Pi.totalAcUncompressedCount);break;case 1:const Gi=P_(jt.array.slice(kn.value,kn.value+Pi.totalAcUncompressedCount));Dr=new Uint16Array(Gi.buffer),kn.value+=Pi.totalAcUncompressedCount}if(Pi.dcCompressedSize>0){const Gi={array:jt.array,offset:kn,size:Pi.dcCompressedSize};ns=new Uint16Array(zn(Gi).buffer),kn.value+=Pi.dcCompressedSize}Pi.rleRawSize>0&&(yr=ri(P_(jt.array.slice(kn.value,kn.value+Pi.rleCompressedSize)).buffer),kn.value+=Pi.rleCompressedSize);let pr=0;const Jr=new Array(Lr.length);for(let Gi=0;Gi<Jr.length;++Gi)Jr[Gi]=new Array;for(let Gi=0;Gi<jt.lines;++Gi)for(let Rr=0;Rr<Lr.length;++Rr)Jr[Rr].push(pr),pr+=Lr[Rr].width*jt.type*2;(function(Gi,Rr,Or,ls,ga,Do){let Sr=new DataView(Do.buffer);const hs=Or[Gi.idx[0]].width,Rs=Or[Gi.idx[0]].height,cc=Math.floor(hs/8),cd=Math.ceil(hs/8),Fc=Math.ceil(Rs/8),nv=hs-8*(cd-1),Jy=Rs-8*(Fc-1),cN={value:0},ZS=new Array(3),Ux=new Array(3),Fx=new Array(3),Qf=new Array(3),KE=new Array(3);for(let _a=0;_a<3;++_a)KE[_a]=Rr[Gi.idx[_a]],ZS[_a]=_a<1?0:ZS[_a-1]+cd*Fc,Ux[_a]=new Float32Array(64),Fx[_a]=new Uint16Array(64),Qf[_a]=new Uint16Array(64*cd);for(let _a=0;_a<Fc;++_a){let Ab=8;_a==Fc-1&&(Ab=Jy);let bb=8;for(let Ao=0;Ao<cd;++Ao){Ao==cd-1&&(bb=nv);for(let ra=0;ra<3;++ra)Fx[ra].fill(0),Fx[ra][0]=ga[ZS[ra]++],Ei(cN,ls,Fx[ra]),ur=Fx[ra],(fr=Ux[ra])[0]=mi(ur[0]),fr[1]=mi(ur[1]),fr[2]=mi(ur[5]),fr[3]=mi(ur[6]),fr[4]=mi(ur[14]),fr[5]=mi(ur[15]),fr[6]=mi(ur[27]),fr[7]=mi(ur[28]),fr[8]=mi(ur[2]),fr[9]=mi(ur[4]),fr[10]=mi(ur[7]),fr[11]=mi(ur[13]),fr[12]=mi(ur[16]),fr[13]=mi(ur[26]),fr[14]=mi(ur[29]),fr[15]=mi(ur[42]),fr[16]=mi(ur[3]),fr[17]=mi(ur[8]),fr[18]=mi(ur[12]),fr[19]=mi(ur[17]),fr[20]=mi(ur[25]),fr[21]=mi(ur[30]),fr[22]=mi(ur[41]),fr[23]=mi(ur[43]),fr[24]=mi(ur[9]),fr[25]=mi(ur[11]),fr[26]=mi(ur[18]),fr[27]=mi(ur[24]),fr[28]=mi(ur[31]),fr[29]=mi(ur[40]),fr[30]=mi(ur[44]),fr[31]=mi(ur[53]),fr[32]=mi(ur[10]),fr[33]=mi(ur[19]),fr[34]=mi(ur[23]),fr[35]=mi(ur[32]),fr[36]=mi(ur[39]),fr[37]=mi(ur[45]),fr[38]=mi(ur[52]),fr[39]=mi(ur[54]),fr[40]=mi(ur[20]),fr[41]=mi(ur[22]),fr[42]=mi(ur[33]),fr[43]=mi(ur[38]),fr[44]=mi(ur[46]),fr[45]=mi(ur[51]),fr[46]=mi(ur[55]),fr[47]=mi(ur[60]),fr[48]=mi(ur[21]),fr[49]=mi(ur[34]),fr[50]=mi(ur[37]),fr[51]=mi(ur[47]),fr[52]=mi(ur[50]),fr[53]=mi(ur[56]),fr[54]=mi(ur[59]),fr[55]=mi(ur[61]),fr[56]=mi(ur[35]),fr[57]=mi(ur[36]),fr[58]=mi(ur[48]),fr[59]=mi(ur[49]),fr[60]=mi(ur[57]),fr[61]=mi(ur[58]),fr[62]=mi(ur[62]),fr[63]=mi(ur[63]),ki(Ux[ra]);Xi(Ux);for(let ra=0;ra<3;++ra)ts(Ux[ra],Qf[ra],64*Ao)}let $d=0;for(let Ao=0;Ao<3;++Ao){const ra=Or[Gi.idx[Ao]].type;for(let iv=8*_a;iv<8*_a+Ab;++iv){$d=KE[Ao][iv];for(let zx=0;zx<cc;++zx){const bg=64*zx+8*(7&iv);Sr.setUint16($d+0*2*ra,Qf[Ao][bg+0],!0),Sr.setUint16($d+1*2*ra,Qf[Ao][bg+1],!0),Sr.setUint16($d+2*2*ra,Qf[Ao][bg+2],!0),Sr.setUint16($d+3*2*ra,Qf[Ao][bg+3],!0),Sr.setUint16($d+4*2*ra,Qf[Ao][bg+4],!0),Sr.setUint16($d+5*2*ra,Qf[Ao][bg+5],!0),Sr.setUint16($d+6*2*ra,Qf[Ao][bg+6],!0),Sr.setUint16($d+7*2*ra,Qf[Ao][bg+7],!0),$d+=8*2*ra}}if(cc!=cd)for(let iv=8*_a;iv<8*_a+Ab;++iv){const zx=KE[Ao][iv]+8*cc*2*ra,bg=64*cc+8*(7&iv);for(let $E=0;$E<bb;++$E)Sr.setUint16(zx+$E*2*ra,Qf[Ao][bg+$E],!0)}}}var ur,fr;const uI=new Uint16Array(hs);Sr=new DataView(Do.buffer);for(let _a=0;_a<3;++_a){Or[Gi.idx[_a]].decoded=!0;const Ab=Or[Gi.idx[_a]].type;if(Or[_a].type==2)for(let bb=0;bb<Rs;++bb){const $d=KE[_a][bb];for(let Ao=0;Ao<hs;++Ao)uI[Ao]=Sr.getUint16($d+Ao*2*Ab,!0);for(let Ao=0;Ao<hs;++Ao)Sr.setFloat32($d+Ao*2*Ab,mi(uI[Ao]),!0)}}})(Ur,Jr,Lr,Dr,ns,bi);for(let Gi=0;Gi<Lr.length;++Gi){const Rr=Lr[Gi];if(!Rr.decoded){if(Rr.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Or=0,ls=0;for(let ga=0;ga<jt.lines;++ga){let Do=Jr[Gi][Or];for(let Sr=0;Sr<Rr.width;++Sr){for(let hs=0;hs<2*Rr.type;++hs)bi[Do++]=yr[ls+hs*Rr.width*Rr.height];ls++}Or++}}}}return new DataView(bi.buffer)}function ps(jt,An){const kn=new Uint8Array(jt);let bi=0;for(;kn[An.value+bi]!=0;)bi+=1;const Pi=new TextDecoder().decode(kn.slice(An.value,An.value+bi));return An.value=An.value+bi+1,Pi}function $r(jt,An){const kn=jt.getInt32(An.value,!0);return An.value=An.value+4,kn}function Fr(jt,An){const kn=jt.getUint32(An.value,!0);return An.value=An.value+4,kn}function zr(jt,An){const kn=jt[An.value];return An.value=An.value+1,kn}function lr(jt,An){const kn=jt.getUint8(An.value);return An.value=An.value+1,kn}const Sn=function(jt,An){let kn;return kn="getBigInt64"in DataView.prototype?Number(jt.getBigInt64(An.value,!0)):jt.getUint32(An.value+4,!0)+Number(jt.getUint32(An.value,!0)<<32),An.value+=8,kn};function Si(jt,An){const kn=jt.getFloat32(An.value,!0);return An.value+=4,kn}function dr(jt,An){return s.A5E.toHalfFloat(Si(jt,An))}function mi(jt){const An=(31744&jt)>>10,kn=1023&jt;return(jt>>15?-1:1)*(An?An===31?kn?NaN:1/0:Math.pow(2,An-15)*(1+kn/1024):kn/1024*6103515625e-14)}function Br(jt,An){const kn=jt.getUint16(An.value,!0);return An.value+=2,kn}function Qo(jt,An){return mi(Br(jt,An))}function ma(jt,An,kn,bi,Pi){return bi==="string"||bi==="stringvector"||bi==="iccProfile"?function(jn,xi,_r){const Lr=new TextDecoder().decode(new Uint8Array(jn).slice(xi.value,xi.value+_r));return xi.value=xi.value+_r,Lr}(An,kn,Pi):bi==="chlist"?function(jn,xi,_r,Lr){const Ur=_r.value,Dr=[];for(;_r.value<Ur+Lr-1;){const ns=ps(xi,_r),yr=$r(jn,_r),pr=lr(jn,_r);_r.value+=3;const Jr=$r(jn,_r),Gi=$r(jn,_r);Dr.push({name:ns,pixelType:yr,pLinear:pr,xSampling:Jr,ySampling:Gi})}return _r.value+=1,Dr}(jt,An,kn,Pi):bi==="chromaticities"?function(jn,xi){return{redX:Si(jn,xi),redY:Si(jn,xi),greenX:Si(jn,xi),greenY:Si(jn,xi),blueX:Si(jn,xi),blueY:Si(jn,xi),whiteX:Si(jn,xi),whiteY:Si(jn,xi)}}(jt,kn):bi==="compression"?function(jn,xi){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][lr(jn,xi)]}(jt,kn):bi==="box2i"?function(jn,xi){return{xMin:Fr(jn,xi),yMin:Fr(jn,xi),xMax:Fr(jn,xi),yMax:Fr(jn,xi)}}(jt,kn):bi==="lineOrder"?function(jn,xi){return["INCREASING_Y"][lr(jn,xi)]}(jt,kn):bi==="float"?Si(jt,kn):bi==="v2f"?function(jn,xi){return[Si(jn,xi),Si(jn,xi)]}(jt,kn):bi==="v3f"?function(jn,xi){return[Si(jn,xi),Si(jn,xi),Si(jn,xi)]}(jt,kn):bi==="int"?$r(jt,kn):bi==="rational"?function(jn,xi){return[$r(jn,xi),Fr(jn,xi)]}(jt,kn):bi==="timecode"?function(jn,xi){return[Fr(jn,xi),Fr(jn,xi)]}(jt,kn):bi==="preview"?(kn.value+=Pi,"skipped"):void(kn.value+=Pi)}const rl=new DataView(e),Uc=new Uint8Array(e),pu={value:0},lc=function(jt,An,kn){const bi={};if(jt.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");bi.version=jt.getUint8(4);const Pi=jt.getUint8(5);bi.spec={singleTile:!!(2&Pi),longName:!!(4&Pi),deepFormat:!!(8&Pi),multiPart:!!(16&Pi)},kn.value=8;let jn=!0;for(;jn;){const xi=ps(An,kn);if(xi==0)jn=!1;else{const _r=ps(An,kn),Lr=ma(jt,An,kn,_r,Fr(jt,kn));Lr===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${_r}'.`):bi[xi]=Lr}}if(-5&Pi)throw console.error("EXRHeader:",bi),new Error("THREE.EXRLoader: provided file is currently unsupported.");return bi}(rl,e,pu),qr=function(jt,An,kn,bi,Pi){const jn={size:0,viewer:An,array:kn,offset:bi,width:jt.dataWindow.xMax-jt.dataWindow.xMin+1,height:jt.dataWindow.yMax-jt.dataWindow.yMin+1,channels:jt.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:jt.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:s.GUF};switch(jt.compression){case"NO_COMPRESSION":jn.lines=1,jn.uncompress=Cr;break;case"RLE_COMPRESSION":jn.lines=1,jn.uncompress=wr;break;case"ZIPS_COMPRESSION":jn.lines=1,jn.uncompress=zn;break;case"ZIP_COMPRESSION":jn.lines=16,jn.uncompress=zn;break;case"PIZ_COMPRESSION":jn.lines=32,jn.uncompress=oi;break;case"PXR24_COMPRESSION":jn.lines=16,jn.uncompress=Ti;break;case"DWAA_COMPRESSION":jn.lines=32,jn.uncompress=Hr;break;case"DWAB_COMPRESSION":jn.lines=256,jn.uncompress=Hr;break;default:throw new Error("EXRLoader.parse: "+jt.compression+" is unsupported")}if(jn.scanlineBlockSize=jn.lines,jn.type==1)switch(Pi){case s.VzW:jn.getter=Qo,jn.inputSize=2;break;case s.cLu:jn.getter=Br,jn.inputSize=2}else{if(jn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+jn.type+" for "+jt.compression+".");switch(Pi){case s.VzW:jn.getter=Si,jn.inputSize=4;break;case s.cLu:jn.getter=dr,jn.inputSize=4}}jn.blockCount=(jt.dataWindow.yMax+1)/jn.scanlineBlockSize;for(let _r=0;_r<jn.blockCount;_r++)Sn(An,bi);jn.outputChannels=jn.channels==3?4:jn.channels;const xi=jn.width*jn.height*jn.outputChannels;switch(Pi){case s.VzW:jn.byteArray=new Float32Array(xi),jn.channels<jn.outputChannels&&jn.byteArray.fill(1,0,xi);break;case s.cLu:jn.byteArray=new Uint16Array(xi),jn.channels<jn.outputChannels&&jn.byteArray.fill(15360,0,xi);break;default:console.error("THREE.EXRLoader: unsupported type: ",Pi)}return jn.bytesPerLine=jn.width*jn.inputSize*jn.channels,jn.outputChannels==4?(jn.format=s.wk1,jn.colorSpace=s.GUF):(jn.format=s.hEm,jn.colorSpace=s.aCh),jn}(lc,rl,Uc,pu,this.type),mh={value:0},tv={R:0,G:1,B:2,A:3,Y:0};for(let jt=0;jt<qr.height/qr.scanlineBlockSize;jt++){const An=Fr(rl,pu);qr.size=Fr(rl,pu),qr.lines=An+qr.scanlineBlockSize>qr.height?qr.height-An:qr.scanlineBlockSize;const kn=qr.size<qr.lines*qr.bytesPerLine?qr.uncompress(qr):Cr(qr);pu.value+=qr.size;for(let bi=0;bi<qr.scanlineBlockSize;bi++){const Pi=bi+jt*qr.scanlineBlockSize;if(Pi>=qr.height)break;for(let jn=0;jn<qr.channels;jn++){const xi=tv[lc.channels[jn].name];for(let _r=0;_r<qr.width;_r++){mh.value=(bi*(qr.channels*qr.width)+jn*qr.width+_r)*qr.inputSize;const Lr=(qr.height-1-Pi)*(qr.width*qr.outputChannels)+_r*qr.outputChannels+xi;qr.byteArray[Lr]=qr.getter(kn,mh)}}}}return{header:lc,width:qr.width,height:qr.height,data:qr.byteArray,format:qr.format,colorSpace:qr.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){return super.load(e,function(o,c){o.colorSpace=c.colorSpace,o.minFilter=s.wem,o.magFilter=s.wem,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,c)},n,i)}}class o1 extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi]}async onAdded(e){var t,n;this._importer||(this._importer=new Js(class extends EI{constructor(i){super(i),this.setDataType(Ol(e.renderer.rendererObject))}},["exr"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}o1.PluginType="EXRLoadPlugin";const a1=new WeakMap;class SI extends s.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const o=new s.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),this.url=e,o.load(e,c=>{if(a1.has(c))return a1.get(c).promise.then(t).catch(i);this.decodeObjects(c,e).then(f=>{f.userData.warnings=this.warnings,this.warnings=[],t(f)}).catch(f=>i(f))},n,i)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,i;const o=e.byteLength,c=this._getWorker(o).then(f=>(n=f,i=this.workerNextTaskID++,new Promise((m,y)=>{n._callbacks[i]={resolve:m,reject:y},n.postMessage({type:"decode",id:i,buffer:e},[e])}))).then(f=>this._createGeometry(f.data)).catch(f=>{throw f});return c.catch(()=>!0).then(()=>{n&&i&&this._releaseTask(n,i)}),a1.set(e,{url:t,promise:c}),c}parse(e,t,n){this.decodeObjects(e,"").then(i=>{i.userData.warnings=this.warnings,t(i)}).catch(i=>n(i))}_compareMaterials(e){if(this.materials.includes(e))return e;const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;const n=JSON.stringify(t);for(let i=0;i<this.materials.length;i++){const o=this.materials[i],c={};if(c.name=o.name,c.color={},c.color.r=o.color.r,c.color.g=o.color.g,c.color.b=o.color.b,c.type=o.type,JSON.stringify(c)===n)return o}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new s.Wid({color:new s.Ilk(1,1,1),metalness:.8,name:"default",side:s.ehD});const t=e.diffuseColor,n=new s.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const i=new s.Wid({color:n,name:e.name,side:s.ehD,transparent:e.transparency>0,opacity:1-e.transparency}),o=new s.dpR;for(let c=0;c<e.textures.length;c++){const f=e.textures[c];if(f.image!==null){const m=o.load(f.image);switch(f.type){case"Diffuse":i.map=m;break;case"Bump":i.bumpMap=m;break;case"Transparency":i.alphaMap=m,i.transparent=!0;break;case"Emap":i.envMap=m}m.wrapS=f.wrapU===0?s.rpg:s.uWy,m.wrapT=f.wrapV===0?s.rpg:s.uWy,m.repeat.set(f.repeat[0],f.repeat[1])}}return i}_createGeometry(e){const t=new s.Tme,n=[],i=[],o=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.strings=e.strings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let c=e.objects;const f=e.materials;for(let m=0;m<c.length;m++){const y=c[m],w=y.attributes;switch(y.objectType){case"InstanceDefinition":i.push(y);break;case"InstanceReference":o.push(y);break;default:let S;if(w.materialIndex>=0){const O=f[w.materialIndex];let N=this._createMaterial(O);N=this._compareMaterials(N),S=this._createObject(y,N)}else{const O=this._createMaterial();S=this._createObject(y,O)}if(S===void 0)continue;const C=e.layers[w.layerIndex];S.visible=!C||C.visible,w.isInstanceDefinitionObject?n.push(S):t.add(S)}}for(let m=0;m<i.length;m++){const y=i[m];c=[];for(let w=0;w<y.attributes.objectIds.length;w++){const S=y.attributes.objectIds[w];for(let C=0;C<n.length;C++)S===n[C].userData.attributes.id&&c.push(n[C])}for(let w=0;w<o.length;w++){const S=o[w];if(S.geometry.parentIdefId===y.attributes.id){const C=S.geometry.xform.array,O=new s.yGw;if(O.set(...C),c.length===1){const N=c[0].clone(!0);if(N.name=S.attributes.name||N.name,N.applyMatrix4(O),S.attributes.materialIndex>=0&&S.attributes.materialIndex!==c[0].userData.attributes.materialIndex){const H=f[S.attributes.materialIndex],q=this._createMaterial(H);N.material=this._compareMaterials(q)}if(N.userData.defAttributes=N.userData.attributes,N.userData.defObjectType=N.userData.objectType,N.userData.attributes={...N.userData.attributes,...S.attributes},N.userData.objectType=S.objectType,S.attributes.layerIndex!==void 0){const H=e.layers[S.attributes.layerIndex];N.visible=H?H.visible:N.visible}t.add(N)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const N=new s.Tme;for(let H=0;H<c.length;H++)N.add(c[H].clone(!0));t.add(N)}}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new s.s4_,i=e.attributes;let o,c,f,m;switch(e.objectType){case"Point":case"PointSet":o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")?c=new s.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(f=i.drawColor,m=new s.Ilk(f.r/255,f.g/255,f.b/255),c=new s.UY4({color:m,sizeAttenuation:!1,size:2})),c=this._compareMaterials(c);const y=new s.woe(o,c);return y.userData.attributes=i,y.userData.objectType=e.objectType,i.name&&(y.name=i.name),y;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const w=new s.Kj0(o,t);return w.castShadow=i.castsShadows,w.receiveShadow=i.receivesShadows,w.userData.attributes=i,w.userData.objectType=e.objectType,i.name&&(w.name=i.name,o.name=i.name),w;case"Curve":o=n.parse(e.geometry),f=i.drawColor,m=new s.Ilk(f.r/255,f.g/255,f.b/255),c=new s.nls({color:m}),c=this._compareMaterials(c);const S=new s.x12(o,c);return S.userData.attributes=i,S.userData.objectType=e.objectType,i.name&&(S.name=i.name),S;case"TextDot":o=e.geometry;const C=document.createElement("canvas").getContext("2d"),O=`${o.fontHeight}px ${o.fontFace}`;C.font=O;const N=C.measureText(o.text).width+10,H=o.fontHeight+10,q=window.devicePixelRatio;C.canvas.width=N*q,C.canvas.height=H*q,C.canvas.style.width=N+"px",C.canvas.style.height=H+"px",C.setTransform(q,0,0,q,0,0),C.font=O,C.textBaseline="middle",C.textAlign="center",m=i.drawColor,C.fillStyle=`rgba(${m.r},${m.g},${m.b},${m.a})`,C.fillRect(0,0,N,H),C.fillStyle="white",C.fillText(o.text,N/2,H/2);const J=new s.ROQ(C.canvas);J.minFilter=s.wem,J.wrapS=s.uWy,J.wrapT=s.uWy,c=new s.xeV({map:J,depthTest:!1});const V=new s.jyi(c);return V.position.set(o.point[0],o.point[1],o.point[2]),V.scale.set(N/10,H/10,1),V.userData.attributes=i,V.userData.objectType=e.objectType,i.name&&(V.name=i.name),V;case"Light":let z;switch(o=e.geometry,o.lightStyle.name){case"LightStyle_WorldPoint":z=new s.cek,z.castShadow=i.castsShadows,z.position.set(o.location[0],o.location[1],o.location[2]),z.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":z=new s.PMe,z.castShadow=i.castsShadows,z.position.set(o.location[0],o.location[1],o.location[2]),z.target.position.set(o.direction[0],o.direction[1],o.direction[2]),z.angle=o.spotAngleRadians,z.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":z=new s.T_f;const ue=Math.abs(o.width[2]),me=Math.abs(o.length[0]);z.position.set(o.location[0]-me/2,o.location[1],o.location[2]-ue/2),z.height=me,z.width=ue,z.lookAt(o.direction[0],o.direction[1],o.direction[2]);break;case"LightStyle_WorldDirectional":z=new s.Ox3,z.castShadow=i.castsShadows,z.position.set(o.location[0],o.location[1],o.location[2]),z.target.position.set(o.direction[0],o.direction[1],o.direction[2]),z.shadow.normalBias=.1}return z&&(z.intensity=o.intensity,f=o.diffuse,m=new s.Ilk(f.r/255,f.g/255,f.b/255),z.color=m,z.userData.attributes=i,z.userData.objectType=e.objectType),z}}_initLibrary(){if(!this.libraryPending){const e=new s.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((o,c)=>{e.load("rhino3dm.js",o,void 0,c)}),n=new s.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const i=new Promise((o,c)=>{n.load("rhino3dm.wasm",o,void 0,c)});this.libraryPending=Promise.all([t,i]).then(([o,c])=>{this.libraryConfig.wasmBinary=c;const f=MI,m=["/* rhino3dm.js */",o,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([m]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=i=>{const o=i.data;switch(o.type){case"warning":this.warnings.push(o.data),console.warn(o.data);break;case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,i){return n._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}const MI=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				// console.log(message)
				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count(); i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count(); i ++ ) {

			const _material = doc.materials().get( i );
			const _pbrMaterial = _material.physicallyBased();

			let material = extractProperties( _material );

			const textures = [];

			for ( let j = 0; j < textureTypes.length; j ++ ) {

				const _texture = _material.getTexture( textureTypes[ j ] );
				if ( _texture ) {

					let textureType = textureTypes[ j ].constructor.name;
					textureType = textureType.substring( 12, textureType.length );
					const texture = { type: textureType };

					const image = doc.getEmbeddedFileAsBase64( _texture.fileName );

					texture.wrapU = _texture.wrapU;
					texture.wrapV = _texture.wrapV;
					texture.wrapW = _texture.wrapW;
					const uvw = _texture.uvwTransform.toFloatArray( true );
					texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

					if ( image ) {

						texture.image = 'data:image/png;base64,' + image;

					} else {

						self.postMessage( { type: 'warning', id: taskID, data: {
							message: \`THREE.3DMLoader: Image for \${textureType} texture not embedded in file.\`,
							type: 'missing resource'
						}

						} );

						texture.image = null;

					}

					textures.push( texture );

					_texture.delete();

				}

			}

			material.textures = textures;

			if ( _pbrMaterial.supported ) {

				for ( let j = 0; j < pbrTextureTypes.length; j ++ ) {

					const _texture = _material.getTexture( pbrTextureTypes[ j ] );
					if ( _texture ) {

						const image = doc.getEmbeddedFileAsBase64( _texture.fileName );
						let textureType = pbrTextureTypes[ j ].constructor.name;
						textureType = textureType.substring( 12, textureType.length );
						const texture = { type: textureType, image: 'data:image/png;base64,' + image };
						textures.push( texture );

						_texture.delete();

					}

				}

				const pbMaterialProperties = extractProperties( _material.physicallyBased() );

				material = Object.assign( pbMaterialProperties, material );

			}

			materials.push( material );

			_material.delete();
			_pbrMaterial.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count(); i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count(); i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count(); i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count(); i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		//console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count();

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings };

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;class ng extends SI{constructor(e){super(e),this.materials=[],this.setLibraryPath(ng.LIBRARY_PATH)}_createMaterial(e){return ng.ImportMaterials?super._createMaterial(e):this.materials[0]||new s.Wid({color:new s.Ilk(1,1,1),metalness:.8,name:"default",side:s.ehD})}async loadAsync(e,t){const n=await super.loadAsync(e,t);n.rotateX(-Math.PI/2),n.userData.materials&&delete n.userData.materials;const i=n.userData.layers;return n.traverse(o=>{var w,S,C,O;const c=(w=o.userData.attributes)==null?void 0:w.castsShadows,f=(S=o.userData.attributes)==null?void 0:S.receivesShadows;o.castShadow=c,o.receiveShadow=f;const m=((C=o.userData.attributes)==null?void 0:C.layerIndex)??((O=o.userData.defAttributes)==null?void 0:O.layerIndex),y=i[m];y&&(o.userData.rhinoLayer=y),o.userData.rhino3dmRoot=n.uuid,this._useInstancedMesh(o),this._useMaterialSource(o,y)}),this.materials=[],n}_useMaterialSource(e,t){var i,o,c,f,m;if(!ng.ImportMaterials)return;const n=e;if(((i=n.material)==null?void 0:i.name)==="default"){const y=((o=n.userData.attributes)==null?void 0:o.materialSource)||((c=n.userData.defAttributes)==null?void 0:c.materialSource),w=((f=n.userData.attributes)==null?void 0:f.colorSource)||((m=n.userData.defAttributes)==null?void 0:m.colorSource);if(!y&&!w)return;(y==null?void 0:y.value)===0||(y==null?void 0:y.value)===1&&(w==null?void 0:w.value)===0?t&&(n.material=this._compareMaterials(this._createMaterial({diffuseColor:t.color,name:t.name,transparency:0,textures:[]}))):(y==null?void 0:y.value)===3||(y==null?void 0:y.value)===1&&(w==null?void 0:w.value)===3?n.traverseAncestors(S=>{S!=null&&S.material&&(n.material=S.material)}):y&&y.value!==1&&console.warn("Unknown material source",y,n,n.userData.attributes)}}_useInstancedMesh(e){if(!ng.ReplaceWithInstancedMesh||e.children.length<=0)return;const t=e.children,n=t.map(o=>o.geometry);n.filter((o,c)=>n.indexOf(o)===c).forEach(o=>{var m;const c=t.filter(y=>y.geometry===o),f=c.length>0?c.filter(y=>y.material===c[0].material):[];if(f.length>1){const y=new s.SPe(o,f[0].material,f.length);y.userData={...f[0].userData},y.userData.instanceUserData=[],y.userData.attributes=y.userData.defAttributes||y.userData.attributes,y.userData.defAttributes&&delete y.userData.defAttributes,y.name=((m=y.userData.attributes)==null?void 0:m.name)||f[0].name,f.forEach((w,S)=>{y.setMatrixAt(S,w.matrix),e.remove(w),y.userData.instanceUserData.push(w.userData)}),e.add(y)}})}}ng.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/",ng.ImportMaterials=!0,ng.ReplaceWithInstancedMesh=!1;class l1 extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi],this._importer=new Js(ng,["3dm"],!0)}async onAdded(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){var t,n;(n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1)}}l1.PluginType="Rhino3dmLoadPlugin";class c1 extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}c1.PluginType="GLTFMeshOptPlugin";class TI extends s.aNw{constructor(e){super(e)}load(e,t,n,i){const o=this,c=new s.hH6(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(f){try{t(o.parse(f))}catch(m){i?i(m):console.error(m),o.manager.itemError(e)}},n,i)}parse(e){function t(o,c,f){for(let m=0,y=o.length;m<y;m++)if(o[m]!==c.getUint8(f+m))return!1;return!0}const n=function(o){if(typeof o=="string"){const c=new Uint8Array(o.length);for(let f=0;f<o.length;f++)c[f]=255&o.charCodeAt(f);return c.buffer||c}return o}(e);return function(o){const c=new DataView(o);if(84+50*c.getUint32(80,!0)===c.byteLength)return!0;const f=[115,111,108,105,100];for(let m=0;m<5;m++)if(t(f,c,m))return!1;return!0}(n)?function(o){const c=new DataView(o),f=c.getUint32(80,!0);let m,y,w,S,C,O,N,H,q=!1;for(let ue=0;ue<70;ue++)c.getUint32(ue,!1)==1129270351&&c.getUint8(ue+4)==82&&c.getUint8(ue+5)==61&&(q=!0,S=new Float32Array(3*f*3),C=c.getUint8(ue+6)/255,O=c.getUint8(ue+7)/255,N=c.getUint8(ue+8)/255,H=c.getUint8(ue+9)/255);const J=new s.u9r,V=new Float32Array(3*f*3),z=new Float32Array(3*f*3);for(let ue=0;ue<f;ue++){const me=84+50*ue,Te=c.getFloat32(me,!0),Be=c.getFloat32(me+4,!0),He=c.getFloat32(me+8,!0);if(q){const tt=c.getUint16(me+48,!0);32768&tt?(m=C,y=O,w=N):(m=(31&tt)/31,y=(tt>>5&31)/31,w=(tt>>10&31)/31)}for(let tt=1;tt<=3;tt++){const lt=me+12*tt,at=3*ue*3+3*(tt-1);V[at]=c.getFloat32(lt,!0),V[at+1]=c.getFloat32(lt+4,!0),V[at+2]=c.getFloat32(lt+8,!0),z[at]=Te,z[at+1]=Be,z[at+2]=He,q&&(S[at]=m,S[at+1]=y,S[at+2]=w)}}return J.setAttribute("position",new s.TlE(V,3)),J.setAttribute("normal",new s.TlE(z,3)),q&&(J.setAttribute("color",new s.TlE(S,3)),J.hasColors=!0,J.alpha=H),J}(n):function(o){const c=new s.u9r,f=/solid([\s\S]*?)endsolid/g,m=/facet([\s\S]*?)endfacet/g;let y=0;const w=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,S=new RegExp("vertex"+w+w+w,"g"),C=new RegExp("normal"+w+w+w,"g"),O=[],N=[],H=new s.Pa4;let q,J=0,V=0,z=0;for(;(q=f.exec(o))!==null;){V=z;const ue=q[0];for(;(q=m.exec(ue))!==null;){let Be=0,He=0;const tt=q[0];for(;(q=C.exec(tt))!==null;)H.x=parseFloat(q[1]),H.y=parseFloat(q[2]),H.z=parseFloat(q[3]),He++;for(;(q=S.exec(tt))!==null;)O.push(parseFloat(q[1]),parseFloat(q[2]),parseFloat(q[3])),N.push(H.x,H.y,H.z),Be++,z++;He!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+y),Be!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+y),y++}const me=V,Te=z-V;c.addGroup(me,Te,J),J++}return c.setAttribute("position",new s.a$l(O,3)),c.setAttribute("normal",new s.a$l(N,3)),c}(typeof(i=e)!="string"?new TextDecoder().decode(i):i);var i}}class u1 extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi]}async onAdded(e){var t,n;this._importer||(this._importer=new Js(TI,["stl"],!0)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}u1.PluginType="STLLoadPlugin";class CI extends s.DqL{constructor(e){super(e)}parse(e,t){const n=new RI(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class RI{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const i=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,12,13*i),c=o.getUint32(0,!0)===67305985;this.glType=o.getUint32(1*i,c),this.glTypeSize=o.getUint32(2*i,c),this.glFormat=o.getUint32(3*i,c),this.glInternalFormat=o.getUint32(4*i,c),this.glBaseInternalFormat=o.getUint32(5*i,c),this.pixelWidth=o.getUint32(6*i,c),this.pixelHeight=o.getUint32(7*i,c),this.pixelDepth=o.getUint32(8*i,c),this.numberOfArrayElements=o.getUint32(9*i,c),this.numberOfFaces=o.getUint32(10*i,c),this.numberOfMipmapLevels=o.getUint32(11*i,c),this.bytesOfKeyValueData=o.getUint32(12*i,c),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight;const c=e?this.numberOfMipmapLevels:1;for(let f=0;f<c;f++){const m=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let y=0;y<this.numberOfFaces;y++){const w=new Uint8Array(this.arrayBuffer,n,m);t.push({data:w,width:i,height:o}),n+=m,n+=3-(m+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}return t}}class h1 extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.dependencies=[fi]}async onAdded(e){var t,n;this._importer||(this._importer=new Js(CI,["ktx"],!1)),(n=(t=e.getManager())==null?void 0:t.importer)==null||n.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){var t,n;this._importer&&((n=(t=e.getManager())==null?void 0:t.importer)!=null&&n.Importers)&&e.getManager().importer.Importers.splice(e.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}h1.PluginType="KTXLoadPlugin";class II extends s.hH6{constructor(e){super(e),this.responseType="blob"}}class gM extends s.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,i){return super.load(e,o=>{try{t==null||t((0,a.blobToDataURL)(o))}catch(c){i==null||i(c)}},n,i)}}class _M{async parseAsync(e,t){return new Blob([JSON.stringify(e,null,t.jsonSpaces??2)],{type:"application/json"})}}class vM{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}const yM={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class tw{constructor(){this.pluginCallbacks=[],this.register(function(e){return new DI(e)}),this.register(function(e){return new OI(e)}),this.register(function(e){return new NI(e)}),this.register(function(e){return new kI(e)}),this.register(function(e){return new UI(e)}),this.register(function(e){return new FI(e)}),this.register(function(e){return new BI(e)}),this.register(function(e){return new LI(e)}),this.register(function(e){return new zI(e)}),this.register(function(e){return new jI(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i,o){const c=o||new EM,f=[];for(let m=0,y=this.pluginCallbacks.length;m<y;m++)f.push(this.pluginCallbacks[m](c));c.setPlugins(f),c.write(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,o){n.parse(e,i,o,t)})}}const d1=5120,p1=5121,f1=5122,m1=5123,g1="KHR_mesh_quantization",Wd={};Wd[s.TyD]=9728,Wd[s.YLQ]=9984,Wd[s.aH4]=9986,Wd[s.wem]=9729,Wd[s.qyh]=9985,Wd[s.D1R]=9987,Wd[s.uWy]=33071,Wd[s.rpg]=10497,Wd[s.OoA]=33648;const AM={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},PI=new s.Ilk;function Fb(l,e){return l.length===e.length&&l.every(function(t,n){return t===e[n]})}function bM(l){return 4*Math.ceil(l/4)}function nw(l,e=0){const t=bM(l.byteLength);if(t!==l.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(l)),e!==0)for(let i=l.byteLength;i<t;i++)n[i]=e;return n.buffer}return l}function xM(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function wM(l,e){if(l.toBlob!==void 0)return new Promise(n=>l.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),l.convertToBlob({type:e,quality:t})}class EM{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,o=i.buffers,c=i.json;n=i.options;const f=i.extensionsUsed,m=i.extensionsRequired,y=new Blob(o,{type:"application/octet-stream"}),w=Object.keys(f),S=Object.keys(m);if(w.length>0&&(c.extensionsUsed=w),S.length>0&&(c.extensionsRequired=S),c.buffers&&c.buffers.length>0&&(c.buffers[0].byteLength=y.size),n.binary===!0){const C=new FileReader;C.readAsArrayBuffer(y),C.onloadend=function(){const O=nw(C.result),N=new DataView(new ArrayBuffer(8));N.setUint32(0,O.byteLength,!0),N.setUint32(4,5130562,!0);const H=nw((q=JSON.stringify(c),new TextEncoder().encode(q).buffer),32);var q;const J=new DataView(new ArrayBuffer(8));J.setUint32(0,H.byteLength,!0),J.setUint32(4,1313821514,!0);const V=new ArrayBuffer(12),z=new DataView(V);z.setUint32(0,1179937895,!0),z.setUint32(4,2,!0);const ue=12+J.byteLength+H.byteLength+N.byteLength+O.byteLength;z.setUint32(8,ue,!0);const me=new Blob([V,J,H,N,O],{type:"application/octet-stream"}),Te=new FileReader;Te.readAsArrayBuffer(me),Te.onloadend=function(){t(Te.result)}}}else if(c.buffers&&c.buffers.length>0){const C=new FileReader;C.readAsDataURL(y),C.onloadend=function(){const O=C.result;c.buffers[0].uri=O,t(c)}}else t(c)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const c in o.gltfExtensions)t.extensions[c]=o.gltfExtensions[c],i[c]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new s.Pa4;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new s.Pa4;for(let o=0,c=n.count;o<c;o++)i.fromBufferAttribute(n,o),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(o,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};t.offset.x===0&&t.offset.y===0||(i.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(i.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(C){return C.colorSpace===s.KI_?function(O){return O<.04045?.0773993808*O:Math.pow(.9478672986*O+.0521327014,2.4)}:function(O){return O}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const i=e?e.image:null,o=t?t.image:null,c=Math.max(i?i.width:0,o?o.width:0),f=Math.max(i?i.height:0,o?o.height:0),m=xM();m.width=c,m.height=f;const y=m.getContext("2d");y.fillStyle="#00ffff",y.fillRect(0,0,c,f);const w=y.getImageData(0,0,c,f);if(i){y.drawImage(i,0,0,c,f);const C=n(e),O=y.getImageData(0,0,c,f).data;for(let N=2;N<O.length;N+=4)w.data[N]=256*C(O[N]/256)}if(o){y.drawImage(o,0,0,c,f);const C=n(t),O=y.getImageData(0,0,c,f).data;for(let N=1;N<O.length;N+=4)w.data[N]=256*C(O[N]/256)}y.putImageData(w,0,0);const S=(e||t).clone();return S.source=new s.Hw6(m),S.colorSpace=s.aCh,S.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),S}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,o){const c=this.json;let f;switch(c.bufferViews||(c.bufferViews=[]),t){case d1:case p1:f=1;break;case f1:case m1:f=2;break;default:f=4}const m=bM(i*e.itemSize*f),y=new DataView(new ArrayBuffer(m));let w=0;for(let C=n;C<n+i;C++)for(let O=0;O<e.itemSize;O++){let N;e.itemSize>4?N=e.array[C*e.itemSize+O]:(O===0?N=e.getX(C):O===1?N=e.getY(C):O===2?N=e.getZ(C):O===3&&(N=e.getW(C)),e.normalized===!0&&(N=s.M8C.normalize(N,e.array))),t===5126?y.setFloat32(w,N,!0):t===5124?y.setInt32(w,N,!0):t===5125?y.setUint32(w,N,!0):t===f1?y.setInt16(w,N,!0):t===m1?y.setUint16(w,N,!0):t===d1?y.setInt8(w,N):t===p1&&y.setUint8(w,N),w+=f}const S={buffer:this.processBuffer(y.buffer),byteOffset:this.byteOffset,byteLength:m};return o!==void 0&&(S.target=o),o===34962&&(S.byteStride=e.itemSize*f),this.byteOffset+=m,c.bufferViews.push(S),{id:c.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const c=nw(o.result),f={buffer:t.processBuffer(c),byteOffset:t.byteOffset,byteLength:c.byteLength};t.byteOffset+=c.byteLength,i(n.bufferViews.push(f)-1)}})}processBufferViewImageBuffer(e){const t=this,n=t.json;n.bufferViews||(n.bufferViews=[]),e=nw(e);const i={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};return t.byteOffset+=e.byteLength,n.bufferViews.push(i)-1}processAccessor(e,t,n,i){const o=this.json;let c;if(e.array.constructor===Float32Array)c=5126;else if(e.array.constructor===Int32Array)c=5124;else if(e.array.constructor===Uint32Array)c=5125;else if(e.array.constructor===Int16Array)c=f1;else if(e.array.constructor===Uint16Array)c=m1;else if(e.array.constructor===Int8Array)c=d1;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");c=p1}if(n===void 0&&(n=0),i===void 0&&(i=e.count),i===0)return null;const f=function(S,C,O){const N={min:new Array(S.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(S.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let H=C;H<C+O;H++)for(let q=0;q<S.itemSize;q++){let J;S.itemSize>4?J=S.array[H*S.itemSize+q]:(q===0?J=S.getX(H):q===1?J=S.getY(H):q===2?J=S.getZ(H):q===3&&(J=S.getW(H)),S.normalized===!0&&(J=s.M8C.normalize(J,S.array))),N.min[q]=Math.min(N.min[q],J),N.max[q]=Math.max(N.max[q],J)}return N}(e,n,i);let m;t!==void 0&&(m=e===t.index?34963:34962);const y=this.processBufferView(e,c,n,i,m),w={bufferView:y.id,byteOffset:y.byteOffset,componentType:c,count:i,max:f.max,min:f.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(w.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(w)-1}processImage(e,t,n,i="image/png",o=void 0,c=void 0){if(e!==null){const f=this,m=f.cache,y=f.json,w=f.options,S=f.pending;m.images.has(e)||m.images.set(e,{});const C=m.images.get(e),O=i+":flipY/"+n.toString()+(o||c?";"+o+";"+c:"");if(C[O]!==void 0)return C[O];y.images||(y.images=[]);const N={mimeType:i},H=xM();H.width=Math.min(o||e.width,w.maxTextureSize),H.height=Math.min(c||e.height,w.maxTextureSize);const q=H.getContext("2d");if(n===!0&&(q.translate(0,H.height),q.scale(1,-1)),e.data!==void 0){t!==s.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>w.maxTextureSize||e.height>w.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const V=new Uint8ClampedArray(e.height*e.width*4);for(let z=0;z<V.length;z+=4)V[z+0]=e.data[z+0],V[z+1]=e.data[z+1],V[z+2]=e.data[z+2],V[z+3]=e.data[z+3];q.putImageData(new ImageData(V,e.width,e.height),0,0)}else q.drawImage(e,0,0,H.width,H.height);w.binary===!0?S.push(wM(H,i).then(V=>f.processBufferViewImage(V)).then(V=>{N.bufferView=V})):H.toDataURL!==void 0?N.uri=H.toDataURL(i):S.push(wM(H,i).then(V=>new FileReader().readAsDataURL(V)).then(V=>{N.uri=V}));const J=y.images.push(N)-1;return C[O]=J,J}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Wd[e.magFilter],minFilter:Wd[e.minFilter],wrapS:Wd[e.wrapS],wrapT:Wd[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let i=e.userData.mimeType;i==="image/webp"&&(i="image/png"),i==="image/jpg"&&(i="image/jpeg");const o={sampler:this.processSampler(e),source:!i||["image/jpeg","image/png"].includes(i)?this.processImage(e.image,e.format,e.flipY,i):null};e.name&&(o.name=e.name),this._invokeAll(function(f){f.writeTexture&&f.writeTexture(e,o)}),o.source===null&&console.error("GLTFExporter: Unsupported mime type: "+i+". Cannot export texture.",e);const c=n.textures.push(o)-1;return t.textures.set(e,c),c}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=e.color.toArray().concat([e.opacity]);if(Fb(o,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const f=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),m={index:this.processTexture(f),channel:f.channel};this.applyTextureTransform(m,f),i.pbrMetallicRoughness.metallicRoughnessTexture=m}if(e.map){const f={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(f,e.map),i.pbrMetallicRoughness.baseColorTexture=f}if(e.emissive){const f=e.emissive;if(Math.max(f.r,f.g,f.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const m={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(m,e.emissiveMap),i.emissiveTexture=m}}if(e.normalMap){const f={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(f.scale=e.normalScale.x),this.applyTextureTransform(f,e.normalMap),i.normalTexture=f}if(e.aoMap){const f={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(f.strength=e.aoMapIntensity),this.applyTextureTransform(f,e.aoMap),i.occlusionTexture=f}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===s.ehD&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(f){f.writeMaterial&&f.writeMaterial(e,i)});const c=n.materials.push(i)-1;return t.materials.set(e,c),c}processMesh(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let z=0,ue=e.material.length;z<ue;z++)i.push(e.material[z].uuid);else i.push(e.material.uuid);const o=i.join(":");if(t.meshes.has(o))return t.meshes.get(o);const c=e.geometry;let f;f=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const m={},y={},w=[],S=[],C={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},O=c.getAttribute("normal");O===void 0||this.isNormalizedNormalAttribute(O)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),c.setAttribute("normal",this.createNormalizedNormalAttribute(O)));let N=null;for(let z in c.attributes){if(z.slice(0,5)==="morph")continue;const ue=c.attributes[z];if(z=C[z]||z.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(z)||(z="_"+z),t.attributes.has(this.getUID(ue))){y[z]=t.attributes.get(this.getUID(ue));continue}N=null;const me=ue.array;z!=="JOINTS_0"||me instanceof Uint16Array||me instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),N=new s.TlE(new Uint16Array(me),ue.itemSize,ue.normalized));const Te=this.processAccessor(N||ue,c);Te!==null&&(z.startsWith("_")||this.detectMeshQuantization(z,ue),y[z]=Te,t.attributes.set(this.getUID(ue),Te))}if(O!==void 0&&c.setAttribute("normal",O),Object.keys(y).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const z=[],ue=[],me={};if(e.morphTargetDictionary!==void 0)for(const Te in e.morphTargetDictionary)me[e.morphTargetDictionary[Te]]=Te;for(let Te=0;Te<e.morphTargetInfluences.length;++Te){const Be={};let He=!1;for(const tt in c.morphAttributes){if(tt!=="position"&&tt!=="normal"){He||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),He=!0);continue}const lt=c.morphAttributes[tt][Te],at=tt.toUpperCase(),St=c.attributes[tt];if(t.attributes.has(this.getUID(lt,!0))){Be[at]=t.attributes.get(this.getUID(lt,!0));continue}const mt=lt.clone();if(!c.morphTargetsRelative)for(let gt=0,Ot=lt.count;gt<Ot;gt++)for(let Bt=0;Bt<lt.itemSize;Bt++)Bt===0&&mt.setX(gt,lt.getX(gt)-St.getX(gt)),Bt===1&&mt.setY(gt,lt.getY(gt)-St.getY(gt)),Bt===2&&mt.setZ(gt,lt.getZ(gt)-St.getZ(gt)),Bt===3&&mt.setW(gt,lt.getW(gt)-St.getW(gt));Be[at]=this.processAccessor(mt,c),t.attributes.set(this.getUID(St,!0),Be[at])}S.push(Be),z.push(e.morphTargetInfluences[Te]),e.morphTargetDictionary!==void 0&&ue.push(me[Te])}m.weights=z,ue.length>0&&(m.extras={},m.extras.targetNames=ue)}const H=Array.isArray(e.material);if(H&&c.groups.length===0)return null;const q=H?e.material:[e.material],J=H?c.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let z=0,ue=J.length;z<ue;z++){const me={mode:f,attributes:y};if(this.serializeUserData(c,me),S.length>0&&(me.targets=S),c.index!==null){let Be=this.getUID(c.index);J[z].start===void 0&&J[z].count===void 0||(Be+=":"+J[z].start+":"+J[z].count),t.attributes.has(Be)?me.indices=t.attributes.get(Be):(me.indices=this.processAccessor(c.index,c,J[z].start,J[z].count),t.attributes.set(Be,me.indices)),me.indices===null&&delete me.indices}const Te=this.processMaterial(q[J[z].materialIndex]);Te!==null&&(me.material=Te),w.push(me)}m.primitives=w,n.meshes||(n.meshes=[]),this._invokeAll(function(z){z.writeMesh&&z.writeMesh(e,m)});const V=n.meshes.push(m)-1;return t.meshes.set(o,V),V}detectMeshQuantization(e,t){if(this.extensionsUsed[g1])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];yM[i]&&yM[i].includes(n)&&(this.extensionsUsed[g1]=!0,this.extensionsRequired[g1]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:s.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);const o=(e=tw.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,c=[],f=[];for(let m=0;m<o.length;++m){const y=o[m],w=s.iUV.parseTrackName(y.name);let S=s.iUV.findNode(t,w.nodeName);const C=AM[w.propertyName];if(w.objectName==="bones"&&(S=S.isSkinnedMesh===!0?S.skeleton.getBoneByName(w.objectIndex):void 0),!S||!C)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',y.name),null;const O=1;let N,H=y.values.length/y.times.length;C===AM.morphTargetInfluences&&(H/=S.morphTargetInfluences.length),y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(N="CUBICSPLINE",H/=3):N=y.getInterpolation()===s.Syv?"STEP":"LINEAR",f.push({input:this.processAccessor(new s.TlE(y.times,O)),output:this.processAccessor(new s.TlE(y.values,H)),interpolation:N}),c.push({sampler:f.length-1,target:{node:i.get(S),path:C}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:f,channels:c}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],o=e.skeleton;if(o===void 0)return null;const c=e.skeleton.bones[0];if(c===void 0)return null;const f=[],m=new Float32Array(16*o.bones.length),y=new s.yGw;for(let w=0;w<o.bones.length;++w)f.push(n.get(o.bones[w])),y.copy(o.boneInverses[w]),y.multiply(e.bindMatrix).toArray(m,16*w);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new s.TlE(m,16)),joints:f,skeleton:n.get(c)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const o={};if(n.trs){const f=e.quaternion.toArray(),m=e.position.toArray(),y=e.scale.toArray();Fb(f,[0,0,0,1])||(o.rotation=f),Fb(m,[0,0,0])||(o.translation=m),Fb(y,[1,1,1])||(o.scale=y)}else e.matrixAutoUpdate&&e.updateMatrix(),Fb(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const f=this.processMesh(e);f!==null&&(o.mesh=f)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const f=[];for(let m=0,y=e.children.length;m<y;m++){const w=e.children[m];if(w.visible||n.onlyVisible===!1){const S=this.processNode(w);S!==null&&f.push(S)}}f.length>0&&(o.children=f)}this._invokeAll(function(f){f.writeNode&&f.writeNode(e,o)});const c=t.nodes.push(o)-1;return i.set(e,c),c}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const o=[];for(let c=0,f=e.children.length;c<f;c++){const m=e.children[c];if(m.visible||n.onlyVisible===!1){const y=this.processNode(m);y!==null&&o.push(y)}}o.length>0&&(i.nodes=o),this.serializeUserData(e,i)}processObjects(e){const t=new s.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof s.xsS?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class DI{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,i=n.json,o=n.extensionsUsed,c={};e.name&&(c.name=e.name),c.color=e.color.toArray(),c.intensity=e.intensity,e.isDirectionalLight?c.type="directional":e.isPointLight?(c.type="point",e.distance>0&&(c.range=e.distance)):e.isSpotLight&&(c.type="spot",e.distance>0&&(c.range=e.distance),c.spot={},c.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,c.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},o[this.name]=!0);const f=i.extensions[this.name].lights;f.push(c),t.extensions=t.extensions||{},t.extensions[this.name]={light:f.length-1}}}class OI{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class BI{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const c={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(c,e.clearcoatMap),o.clearcoatTexture=c}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const c={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(c,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=c}if(e.clearcoatNormalMap){const c={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};n.applyTextureTransform(c,e.clearcoatNormalMap),o.clearcoatNormalTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class LI{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const c={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(c,e.iridescenceMap),o.iridescenceTexture=c}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const c={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(c,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class NI{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const c={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(c,e.transmissionMap),o.transmissionTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class kI{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const c={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(c,e.thicknessMap),o.thicknessTexture=c}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class UI{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class FI{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(PI)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.specularIntensityMap){const c={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(c,e.specularIntensityMap),o.specularTexture=c}if(e.specularColorMap){const c={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(c,e.specularColorMap),o.specularColorTexture=c}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class zI{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.001)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.sheenRoughnessMap){const c={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(c,e.sheenRoughnessMap),o.sheenRoughnessTexture=c}if(e.sheenColorMap){const c={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(c,e.sheenColorMap),o.sheenColorTexture=c}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,i[this.name]=!0}}class jI{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}tw.Utils={GLTFWriter:EM,insertKeyframe:function(l,e){const n=l.getValueSize(),i=new l.TimeBufferType(l.times.length+1),o=new l.ValueBufferType(l.values.length+n),c=l.createInterpolant(new l.ValueBufferType(n));let f;if(l.times.length===0){i[0]=e;for(let m=0;m<n;m++)o[m]=0;f=0}else if(e<l.times[0]){if(Math.abs(l.times[0]-e)<.001)return 0;i[0]=e,i.set(l.times,1),o.set(c.evaluate(e),0),o.set(l.values,n),f=0}else if(e>l.times[l.times.length-1]){if(Math.abs(l.times[l.times.length-1]-e)<.001)return l.times.length-1;i[i.length-1]=e,i.set(l.times,0),o.set(l.values,0),o.set(c.evaluate(e),l.values.length),f=i.length-1}else for(let m=0;m<l.times.length;m++){if(Math.abs(l.times[m]-e)<.001)return m;if(l.times[m]<e&&l.times[m+1]>e){i.set(l.times.slice(0,m+1),0),i[m+1]=e,i.set(l.times.slice(m+1),m+2),o.set(l.values.slice(0,(m+1)*n),0),o.set(c.evaluate(e),(m+1)*n),o.set(l.values.slice((m+1)*n),(m+2)*n),f=m+1;break}}return l.times=i,l.values=o,f},mergeMorphTargetTracks:function(l,e){const t=[],n={},i=l.tracks;for(let o=0;o<i.length;++o){let c=i[o];const f=s.iUV.parseTrackName(c.name),m=s.iUV.findNode(e,f.nodeName);if(f.propertyName!=="morphTargetInfluences"||f.propertyIndex===void 0){t.push(c);continue}if(c.createInterpolant!==c.InterpolantFactoryMethodDiscrete&&c.createInterpolant!==c.InterpolantFactoryMethodLinear){if(c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),c=c.clone(),c.setInterpolation(s.NMF)}const y=m.morphTargetInfluences.length,w=m.morphTargetDictionary[f.propertyIndex];if(w===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+f.propertyIndex);let S;if(n[m.uuid]===void 0){S=c.clone();const O=new S.ValueBufferType(y*S.times.length);for(let N=0;N<S.times.length;N++)O[N*y+w]=S.values[N];S.name=(f.nodeName||"")+".morphTargetInfluences",S.values=O,n[m.uuid]=S,t.push(S);continue}const C=c.createInterpolant(new c.ValueBufferType(1));S=n[m.uuid];for(let O=0;O<S.times.length;O++)S.values[O*y+w]=C.evaluate(S.times[O]);for(let O=0;O<c.times.length;O++){const N=this.insertKeyframe(S,c.times[O]);S.values[N*y+w]=c.values[O]}}return l.tracks=t,l}};class SM extends tw.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new s.Wid}serializeUserData(e,t){const n=e.userData,i={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([o,c])=>{(!c||typeof c=="function"||c.isObject3D||c.isTexture||c.isMaterial||c.assetType!=null||o.startsWith("_")||o!=="uuid"&&(Hl.includes(o)||ja.includes(o)||nn.includes(o)))&&(i[o]=c,delete n[o])}),super.serializeUserData(e,t),Object.entries(i).forEach(([o,c])=>{n[o]=c,delete i[o]})}processObjects(e){var t;e.length===1&&((t=e[0])!=null&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(n===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",e),null;if(!e||t===e)return n;const i=JSON.stringify(this.json.materials[n]),o=JSON.parse(i);this.serializeUserData(e,o),this._invokeAll(f=>{f.writeMaterial&&f.writeMaterial(e,o)});const c=this.json.materials.push(o)-1;return this.cache.materials.set(e,c),c}processImageBlob(e,t){if(!e)return-1;const n=this.cache,i=this.options,o=this.pending,c=this.json,f=t.image;n.images.has(f)||n.images.set(f,{});const m=n.images.get(f),y=e.type+":flipY/"+t.flipY.toString();if(m[y]!==void 0)return m[y];c.images||(c.images=[]);const w={mimeType:e.type};i.binary===!0?o.push(new Promise(C=>{this.processBufferViewImage(e).then(O=>{w.bufferView=O,C()})})):o.push((0,a.blobToDataURL)(e).then(C=>{w.uri=C}));const S=c.images.push(w)-1;return m[y]=S,S}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const i=e.source.data,o=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))&&(e.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||e.isDataTexture?e.source.data=null:e.source.data._savePreview=!0),delete e.userData.mimeType);const c=super.processTexture(e),f=n.textures[c];if(!f)return console.error("No texture def",c,e),c;const m=n.images?n.images[f.source]:null;if(m&&(m.extras||(m.extras={}),e.source&&(m.extras.uuid=e.source.uuid),m.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages&&(e.userData.rootPath.startsWith("http")||e.userData.rootPath.startsWith("data:"))){if(e.source.data?delete e.source.data._savePreview:e.source.data=i,e.userData.mimeType=o,!f)return console.error("textureDef is null",c,e),c;if(f.source>=0){const y=this.json.images[f.source];y.uri?console.warn("uri already set",y.uri):(y.uri=e.userData.rootPath,y.mimeType=o,y.extras||(y.extras={}),y.extras.flipY=e.flipY,y.extras.uri=e.userData.rootPath)}else f.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,o)}return f.source<0&&console.error("textureDef.source cannot be saved",f,e),c}processImage(e,t,n,i="image/png"){return e?super.processImage(e,t,n,i,e._savePreview?32:void 0,e._savePreview?32:void 0):-1}processImageUri(e,t,n,i="image/png"){const o=this.cache,c=this.json;o.images.has(e)||o.images.set(e,{});const f=o.images.get(e),m=i+":flipY/"+n.toString();if(f[m]!==void 0)return f[m];c.images||(c.images=[]);const y={mimeType:i,uri:t,extras:{flipY:n}},w=c.images.push(y)-1;return f[m]=w,w}}function VI(l,e){(e=e??document.createElement("script")).type=l.type||"text/javascript",e.text=l.text;for(let t=0;t<l.attributes.length;t++){const n=l.attributes[t];e.setAttribute(n.name,n.value)}return e}function MM(l,e=0){const t=(n=l.byteLength,4*Math.ceil(n/4));var n;if(t!==l.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(l)),e!==0)for(let o=l.byteLength;o<t;o++)i[o]=e;return i.buffer}return l}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(l,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-l),i=new Uint8Array(n);for(let o=0;o<i.length;o++)i[o]=t[o+l];return n});class _1 extends tw{register(e){return super.register(e)}async parseAsync(e,t){if(!e)throw new Error("No object to export");const n=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((i,o)=>this.parse(e,i,o,t));if(n&&typeof n=="object"&&!n.byteLength)return new Blob([JSON.stringify(n,(i,o)=>i.startsWith("__")?void 0:o,t.jsonSpaces??2)],{type:"model/gltf+json"});if(n){let i=null;return t.encrypt&&(!t.encryptKey&&window.prompt&&(t.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),t.encryptKey?i=function(o,c){const f=MM(o),m=new DataView(new ArrayBuffer(8));m.setUint32(0,f.byteLength,!0),m.setUint32(4,5130562,!0);const y=MM(new TextEncoder().encode(JSON.stringify({asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}})).buffer,32),w=new DataView(new ArrayBuffer(8));w.setUint32(0,y.byteLength,!0),w.setUint32(4,1313821514,!0);const S=new ArrayBuffer(12),C=new DataView(S);C.setUint32(0,1179937895,!0),C.setUint32(4,2,!0);const O=12+w.byteLength+y.byteLength+m.byteLength+f.byteLength;C.setUint32(8,O,!0);const N=new Blob([S,w,y,m,f],{type:"application/octet-stream"});return N.ext="glb",N}(await(0,a.aesGcmEncrypt)(new Uint8Array(n),t.encryptKey)):console.warn("GLTF Export: encryption key not provided, skipping encryption")),i||(i=new Blob([n],{type:"model/gltf+binary"})),i}throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,i={}){const o={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!i.embedUrlImages&&i.externalImagesInExtras||!1,embedUrlImages:i.embedUrlImages??!1,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0,exporterOptions:i};return i.exportExt==="glb"&&(o.binary=!0),i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(f=>{f.uuid&&(f.userData.gltfUUID=f.uuid)})),(Array.isArray(e)?e:[e]).forEach(c=>c.traverse(f=>{if(f.animations)for(const m of f.animations)m.__gltfExport===!1||o.animations.includes(m)||o.animations.push(...f.animations)})),super.parse(e,c=>{i.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(f=>f.traverse(m=>{delete m.userData.gltfUUID})),t(Object.assign(c,{__isGLTFOutput:!0}))},n,o,new SM)}}function TM(l,e){const t=l.getPlugin(fi).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&[...Object.entries(t.resources.textures)].forEach(([i,o])=>{e.json.textures.find(f=>{var m,y,w,S,C;return((m=f.extras)==null?void 0:m.uuid)===i||((w=(y=e.json.samplers[f.sampler])==null?void 0:y.extras)==null?void 0:w.uuid)===i||((C=(S=e.json.images[f.source])==null?void 0:S.extras)==null?void 0:C.t_uuid)===i})&&(o.image&&t.resources.images&&t.resources.images[o.image]&&delete t.resources.images[o.image],t.resources.textures[i]={})}),e.json.materials&&t.resources.materials&&[...Object.entries(t.resources.materials)].forEach(([i,o])=>{e.json.materials.find(c=>{var f;return((f=c.extras)==null?void 0:f.uuid)===i})&&(t.resources.materials[i]={})});const n=[];Object.values(t.resources).forEach(i=>{i&&Object.values(i).forEach(o=>{o.url&&(o.url.type==="Uint16Array"&&o.url.data?(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),n.push(o.url)):o.url.type==="Uint8Array"&&o.url.data&&(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),n.push(o.url)))})});for(const i of n){let o="application/octet-stream";if(i.mimeType&&(o=i.mimeType),e.options.exporterOptions.encodeUint16Rgbe&&i.type==="Uint16Array"&&i.width>0&&i.height>0){const y=GI(i.data,4),w=new ImageData(y,i.width,i.height),S=s.PpQ.getDataURL(w,!0).split(",")[1],C=2;o="image/png",C===1||(i.data=Uint8Array.from(atob(S),O=>O.charCodeAt(0))),i.encoding="rgbe",i.encodingVersion=C}e.json.images||(e.json.images=[]);const c={mimeType:o},f=e.json.images.push(c)-1,m=i.data;c.bufferView=e.processBufferViewImageBuffer(m),i.data={image:f}}return t}function GI(l,e=3,t){let n,i,o,c,f;const m=l.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*m);for(let y=0;y<m;y++){n=l[y*e],i=l[y*e+1],o=l[y*e+2],c=Math.max(Math.max(n,i),o);const w=Math.ceil(Math.log2(c));f=Math.pow(2,w-8),t[4*y]=n/f|0,t[4*y+1]=i/f|0,t[4*y+2]=o/f|0,t[4*y+3]=w+128}return t}function v1(l,e,t=_1,n){if(!e)return;const i=l.Exporters.findIndex(c=>c.ext.includes("gltf")||c.ext.includes("glb")),o=[];i>=0?(o.push(...l.Exporters[i].extensions??[]),l.Exporters.splice(i,1)):(o.push(QI),o.push(WI),o.push(HI),o.push(c=>new uo(c)),o.push(c=>new qI(c)),o.push(c=>new XI(c)),o.push(c=>new YI(c)),o.push(c=>new KI(c))),l.Exporters.push({ctor:()=>{const c=new t;return o.forEach(f=>c.register(f)),c.register(f=>({afterParse:m=>{var w,S;if(m=Array.isArray(m)?m[0]:m,!((w=m==null?void 0:m.userData)!=null&&w.rootSceneModelRoot)||((S=m==null?void 0:m.userData)==null?void 0:S.__exportViewerConfig)===!1)return;const y=f.json.scenes[f.json.scene||0];y.extensions||(y.extensions={}),y.extensions[Vr]=TM(e,f),f.extensionsUsed[Vr]=!0}})),n==null||n(c),c},ext:["gltf","glb"],extensions:o})}const HI=l=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[pc]=n,l.extensionsUsed[pc]=!0)}}),WI=l=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[jc]=n,l.extensionsUsed[jc]=!0)}}),QI=l=>({writeMaterial(e,t){if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const n={};e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.side!==void 0&&e.side!==s.ehD&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.vertexColors!==void 0&&(n.vertexColors=e.vertexColors),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.normalScale!==void 0&&(n.normalScale=[e.normalScale.x,e.normalScale.y]);const i=this.materialExternalResources[e.uuid];i&&Object.entries(i).forEach(([o,c])=>{var f;o.startsWith("_")||(c!=null&&c.userData&&(c.userData.__embedUrlImagePreviews=(f=l.options.exporterOptions)==null?void 0:f.embedUrlImagePreviews),n[o]=di(c,!1,this.serializedMeta),c!=null&&c.userData&&delete c.userData.__embedUrlImagePreviews)}),Object.keys(n).length>0&&(t.extensions[ko]=n,l.extensionsUsed[ko]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!l.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(i=>{var o;i&&((o=i.material)!=null&&o.isMaterial)&&t.push(i.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([i,o])=>{i.startsWith("_")||o&&o.isTexture&&o.userData.rootPath&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))&&(n[i]=null,this.materialExternalResources[n.uuid][i]=o)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(i=>{const o=i.__materialRef;o&&(Object.entries(i).forEach(([c,f])=>{c.startsWith("_")||f&&(o[c]=f)}),delete this.materialExternalResources[o.uuid])});const n=l.json.scenes[l.json.scene||0];n.extensions||(n.extensions={}),n.extensions[ko]={resources:this.serializedMeta},l.extensionsUsed[ko]=!0}});class qI{constructor(e){this.writer=e,this.name=pd}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.bumpScale=e.bumpScale,e.bumpMap){const c={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(c,e.bumpMap),o.bumpTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class XI{constructor(e){this.writer=e,this.name=_u}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.displacementScale=e.displacementScale,o.displacementBias=e.displacementBias,e.displacementMap){const c={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(c,e.displacementMap),o.displacementTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class YI{constructor(e){this.writer=e,this.name=fc}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,i=n.extensionsUsed,o={};if(o.lightMapIntensity=e.lightMapIntensity,e.lightMap){const c={index:n.processTexture(e.lightMap)};n.applyTextureTransform(c,e.lightMap),o.lightMapTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class KI{constructor(e){this.writer=e,this.name=Ql}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,i=n.extensionsUsed,o={};if(e.alphaMap){const c={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(c,e.alphaMap),o.alphaTexture=c}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}const $I=new TextEncoder;class JI{parse(e,t,n){if(!function(m,y){if(y.isWebGLRenderTarget&&(!m||!m.isWebGLRenderer))return console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1;if(!y||!y.isWebGLRenderTarget&&!y.isDataTexture)return console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget or DataTexture."),!1;const w=y.isWebGLRenderTarget?y.texture:y;return w.type!==s.VzW&&w.type!==s.cLu?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture type."),!1):w.format===s.wk1||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget or DataTexture texture format, expected RGBAFormat."),!1)}(e,t))return;const i=function(m,y={}){const w=m.isTexture?m:m.texture,S=m.isWebGLRenderTarget?m.width:m.image.width,C=m.isWebGLRenderTarget?m.height:m.image.height,O=w.type,N=w.format,H=w.colorSpace,q=y.compression!==void 0?y.compression:3,J=(y.type!==void 0?y.type:s.cLu)===s.VzW?2:1,V={0:1,2:1,3:16}[q];return{width:S,height:C,type:O,format:N,colorSpace:H,compression:q,blockLines:V,dataType:J,dataSize:2*J,numBlocks:Math.ceil(C/V),numInputChannels:4,numOutputChannels:4,flipY:m.isDataTexture&&m.flipY}}(t,n),o=function(m,y,w){if(y.isDataTexture)return y.image.data;let S;return S=w.type===s.VzW?new Float32Array(w.width*w.height*w.numInputChannels):new Uint16Array(w.width*w.height*w.numInputChannels),m.readRenderTargetPixels(y,0,0,w.width,w.height,S),S}(e,t,i),c=function(m,y){const w=y.width,S=y.height,C={r:0,g:0,b:0,a:0},O={value:0},N=y.numOutputChannels==4?1:0,H=y.type==s.VzW?sP:rP,q=y.dataType==1?nP:y1,J=new Uint8Array(y.width*y.height*y.numOutputChannels*y.dataSize),V=new DataView(J.buffer);for(let z=0;z<S;++z)for(let ue=0;ue<w;++ue){const me=z*w*4+4*ue,Te=H(m,me),Be=H(m,me+1),He=H(m,me+2),tt=H(m,me+3),lt=(y.flipY?z:S-z-1)*w*(3+N)*y.dataSize;tP(C,Te,Be,He,tt),O.value=lt+ue*y.dataSize,q(V,C.a,O),O.value=lt+N*w*y.dataSize+ue*y.dataSize,q(V,C.b,O),O.value=lt+(1+N)*w*y.dataSize+ue*y.dataSize,q(V,C.g,O),O.value=lt+(2+N)*w*y.dataSize+ue*y.dataSize,q(V,C.r,O)}return J}(o,i),f=function(m,y){let w,S,C=0;const O={data:new Array,totalSize:0},N=y.width*y.numOutputChannels*y.blockLines*y.dataSize;switch(y.compression){case 0:w=ZI;break;case 2:case 3:w=eP}y.compression!==0&&(S=new Uint8Array(N));for(let H=0;H<y.numBlocks;++H){const q=w(m.subarray(N*H,N*(H+1)),S);C+=q.length,O.data.push({dataChunk:q,size:q.length})}return O.totalSize=C,O}(c,i);return function(m,y){const w=8*y.numBlocks,S=259+18*y.numOutputChannels,C={value:S+w},O=new Uint8Array(S+w+m.totalSize+8*y.numBlocks),N=new DataView(O.buffer);(function(H,q,J){const V={value:0},z=new DataView(H.buffer);Vs(z,20000630,V),Vs(z,2,V),jl(z,"compression",V),jl(z,"compression",V),Vs(z,1,V),zb(z,J.compression,V),jl(z,"screenWindowCenter",V),jl(z,"v2f",V),Vs(z,8,V),Vs(z,0,V),Vs(z,0,V),jl(z,"screenWindowWidth",V),jl(z,"float",V),Vs(z,4,V),y1(z,1,V),jl(z,"pixelAspectRatio",V),jl(z,"float",V),Vs(z,4,V),y1(z,1,V),jl(z,"lineOrder",V),jl(z,"lineOrder",V),Vs(z,1,V),zb(z,0,V),jl(z,"dataWindow",V),jl(z,"box2i",V),Vs(z,16,V),Vs(z,0,V),Vs(z,0,V),Vs(z,J.width-1,V),Vs(z,J.height-1,V),jl(z,"displayWindow",V),jl(z,"box2i",V),Vs(z,16,V),Vs(z,0,V),Vs(z,0,V),Vs(z,J.width-1,V),Vs(z,J.height-1,V),jl(z,"channels",V),jl(z,"chlist",V),Vs(z,18*J.numOutputChannels+1,V),jl(z,"A",V),Vs(z,J.dataType,V),V.value+=4,Vs(z,1,V),Vs(z,1,V),jl(z,"B",V),Vs(z,J.dataType,V),V.value+=4,Vs(z,1,V),Vs(z,1,V),jl(z,"G",V),Vs(z,J.dataType,V),V.value+=4,Vs(z,1,V),Vs(z,1,V),jl(z,"R",V),Vs(z,J.dataType,V),V.value+=4,Vs(z,1,V),Vs(z,1,V),zb(z,0,V),zb(z,0,V);let ue=V.value+8*J.numBlocks;for(let me=0;me<q.data.length;++me)iP(z,ue,V),ue+=q.data[me].size+8})(O,m,y);for(let H=0;H<m.data.length;++H){const q=m.data[H].dataChunk,J=m.data[H].size;Vs(N,H*y.blockLines,C),Vs(N,J,C),O.set(q,C.value),C.value+=J}return O}(f,i)}}function ZI(l){return l}function eP(l,e){let t=0,n=Math.floor((l.length+1)/2),i=0;const o=l.length-1;for(;!(i>o||(e[t++]=l[i++],i>o));)e[n++]=l[i++];let c=e[0];for(let f=1;f<e.length;f++){const m=e[f]-c+384;c=e[f],e[f]=m}return function(f,m){m||(m={});var y=OA();y.p(f);var w=uy(f,m,2,4);return Ym(w,m),BA(w,w.length-4,y.d()),w}(e)}function tP(l,e,t,n,i){l.r=e,l.g=t,l.b=n,l.a=i}function zb(l,e,t){l.setUint8(t.value,e),t.value+=1}function Vs(l,e,t){l.setUint32(t.value,e,!0),t.value+=4}function nP(l,e,t){l.setUint16(t.value,s.A5E.toHalfFloat(e),!0),t.value+=2}function y1(l,e,t){l.setFloat32(t.value,e,!0),t.value+=4}function iP(l,e,t){l.setBigUint64(t.value,BigInt(e),!0),t.value+=8}function jl(l,e,t){const n=$I.encode(e+"\0");for(let i=0;i<n.length;++i)zb(l,n[i],t)}function rP(l,e){return function(t){const n=(31744&t)>>10,i=1023&t;return(t>>15?-1:1)*(n?n===31?i?NaN:1/0:Math.pow(2,n-15)*(1+i/1024):i/1024*6103515625e-14)}(l[e])}function sP(l,e){return l[e]}class iw extends JI{async parseAsync(e,t){const n=this.parse(e.renderer.rendererObject,e,t);return new Blob([n],{type:"image/x-exr"})}}class CM extends a.SimpleEventDispatcher{get processors(){return this._processors}getExporter(...e){return this.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}constructor(e,t={}){super(),this._processors=new xg,this.Exporters=[{ctor:()=>new _M,ext:["json"]},{ctor:()=>new vM,ext:["txt","text"]},{ctor:()=>new iw,ext:["exr"]}],this._cachedParsers=[],v1(this,e)}async exportObject(e,t={}){var o,c;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");(o=e==null?void 0:e.userData)!=null&&o.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const n=[];e.assetType==="model"&&e.modelObject.traverse(f=>{f.userData.excludeFromExport&&f.visible&&(f.visible=!1,n.push(f))});const i=await this._exportFile(e,t);return e.assetType==="model"&&n.forEach(f=>f.visible=!0),(c=e==null?void 0:e.userData)!=null&&c.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,i}async _exportFile(e,t={}){let n;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const i=await this.processBeforeExport(e,t),o=t.exportExt??(i==null?void 0:i.typeExt)??(i==null?void 0:i.ext);if(!i||!o)throw new Error(`Unable to preprocess before export ${o}`);const c=this._getParser(o);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const f=await c.parseAsync(i.obj,{exportExt:i.ext??o,...t});f.ext=i.ext,n=f}catch(i){return console.error("AssetExporter: Unable to Export file",e),console.error(i),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:i})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),n}_createParser(e){const t=this.Exporters.find(i=>i.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t;return((t=this._cachedParsers.find(n=>n.ext.includes(e)))==null?void 0:t.parser)??this._createParser(e)}async processBeforeExport(e,t={}){if(e.assetType!=null&&e.assetType!=="renderTarget"&&(e=await this._processors.process(e.assetType,e,t)),e.isWebGLRenderTarget)return{obj:e,ext:"exr"};switch(e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};case"renderTarget":return{obj:e,ext:"exr"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)==null||e.dispose()}}var jb;(function(l){l[l.EDGEBREAKER=1]="EDGEBREAKER",l[l.SEQUENTIAL=0]="SEQUENTIAL"})(jb||(jb={}));class f0 extends Ri{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:jb.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:""},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new CM(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var i;return n.convertMeshToIndexed&&((i=t.modelObject)==null||i.traverse(o=>{var c;o.geometry&&(o.geometry.attributes.index||((c=o.setGeometry)==null||c.call(o,ut(o.geometry))))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(n=this.exporter)==null?void 0:n.exportObject((t=this._viewer)==null?void 0:t.scene.modelRoot,e||{...this.exportOptions})}async downloadSceneGlb(){const e=await this.exportScene(this.exportOptions);e&&await this._downloadBlob(e,this.exportOptions.name+"."+e.ext)}async _downloadBlob(e,t){var i,o;const n=(i=this._viewer)==null?void 0:i.getPluginByType("FileTransferPlugin");n?await n.exportFile(e,t):(o=this._viewer)==null||o.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var i;typeof((i=n.plugin)==null?void 0:i.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,i])=>typeof(i==null?void 0:i.toJSON)=="function"&&(i==null?void 0:i.serializeWithViewer)!==!1).map(([n,i])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(jb).map(([n,i])=>({label:n,value:i}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(n=>({label:n}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(n=>({type:"slider",label:n,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,n]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var n,i;return(i=(n=this._uiConfig)==null?void 0:n.uiRefresh)==null?void 0:i.call(n,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var i;n.value=!1,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var i;n.value=!0,(i=n.uiRefresh)==null||i.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(fi).exportPluginPresets(t.filter(i=>!!i.value).map(i=>(0,a.getOrCall)(i.label)||"")),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+fi.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(fi).exportViewerConfig(!1),null,2)],{type:"application/json"});n&&await this._downloadBlob(n,this.exportOptions.name+"."+fi.ViewerTypeSlug)}}]}]}}}f0.PluginType="AssetExporterPlugin",function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);o>3&&c&&Object.defineProperty(e,t,c)}([ze()],f0.prototype,"exportOptions",void 0);class A1{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let i=0,o=n.length;i<o;i++)n[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class FA extends A1{constructor(e,t,n,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=i,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class oP extends A1{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(i=>t(i.getParent()))),n.forEach(i=>i.dispose()),this}createEdge(e,t,n,i){return this._registerEdge(new FA(e,t,n,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Vb(){return Vb=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l},Vb.apply(this,arguments)}function b1(l){return l instanceof FA}function Gb(l){return Array.isArray(l)&&l[0]instanceof FA}function Hb(l){return!!(function(e){return!!e&&Object.getPrototypeOf(e)===Object.prototype}(l)&&function(e){for(const t in e)return e[t]}(l)instanceof FA)}const Io=Symbol("attributes"),zA=Symbol("immutableKeys");class x1 extends A1{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Io]=void 0,this[zA]=void 0,this.graph=e,this[zA]=new Set,this[Io]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const i=e[n];if(i instanceof x1){const o=this.graph.createEdge(n,this,i);o.addEventListener("dispose",()=>i.dispose()),this[zA].add(n),t[n]=o}else t[n]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[Io]){const i=this[Io][n];if(b1(i)){const o=i;o.getChild()===e&&this.setRef(n,t,o.getAttributes())}else if(Gb(i)){const o=i.find(c=>c.getChild()===e);if(o){const c=o.getAttributes();this.removeRef(n,e).addRef(n,t,c)}}else if(Hb(i)){const o=i;for(const c in o){const f=o[c];f.getChild()===e&&this.setRefMap(n,c,t,f.getAttributes())}}}return this}get(e){return this[Io][e]}set(e,t){return this[Io][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[Io][e];return t?t.getChild():null}setRef(e,t,n){if(this[zA].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[Io][e];if(i&&i.dispose(),!t)return this;const o=this.graph.createEdge(e,this,t,n);return o.addEventListener("dispose",()=>{delete this[Io][e],this.dispatchEvent({type:"change",attribute:e})}),this[Io][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Io][e].map(t=>t.getChild())}addRef(e,t,n){const i=this.graph.createEdge(e,this,t,n),o=this[Io][e];return o.push(i),i.addEventListener("dispose",()=>{const c=o.filter(f=>f!==i);o.length=0;for(const f of c)o.push(f);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[Io][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[Io][e])}listRefMapValues(e){return Object.values(this[Io][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[Io][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,i){const o=this[Io][e],c=o[t];if(c&&c.dispose(),!n)return this;i=Object.assign(i||{},{key:t});const f=this.graph.createEdge(e,this,n,Vb({},i,{key:t}));return f.addEventListener("dispose",()=>{delete o[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),o[t]=f,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(Vb({},e,{target:this})),this.graph.dispatchEvent(Vb({},e,{target:this,type:`node:${e.type}`})),this}}const RM="@glb.bin";var Ni,rw,Qd,Ua,yy;(function(l){l.ACCESSOR="Accessor",l.ANIMATION="Animation",l.ANIMATION_CHANNEL="AnimationChannel",l.ANIMATION_SAMPLER="AnimationSampler",l.BUFFER="Buffer",l.CAMERA="Camera",l.MATERIAL="Material",l.MESH="Mesh",l.PRIMITIVE="Primitive",l.PRIMITIVE_TARGET="PrimitiveTarget",l.NODE="Node",l.ROOT="Root",l.SCENE="Scene",l.SKIN="Skin",l.TEXTURE="Texture",l.TEXTURE_INFO="TextureInfo"})(Ni||(Ni={})),function(l){l.INTERLEAVED="interleaved",l.SEPARATE="separate"}(rw||(rw={})),function(l){l.ARRAY_BUFFER="ARRAY_BUFFER",l.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",l.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",l.OTHER="OTHER",l.SPARSE="SPARSE"}(Qd||(Qd={})),function(l){l[l.R=4096]="R",l[l.G=256]="G",l[l.B=16]="B",l[l.A=1]="A"}(Ua||(Ua={})),function(l){l.GLTF="GLTF",l.GLB="GLB"}(yy||(yy={}));const sw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var ow,w1,E1=typeof Float32Array<"u"?Float32Array:Array;function S1(l){return Math.hypot(l[0],l[1],l[2])}function aP(l,e,t){var n=e[0],i=e[1],o=e[2],c=t[3]*n+t[7]*i+t[11]*o+t[15];return l[0]=(t[0]*n+t[4]*i+t[8]*o+t[12])/(c=c||1),l[1]=(t[1]*n+t[5]*i+t[9]*o+t[13])/c,l[2]=(t[2]*n+t[6]*i+t[10]*o+t[14])/c,l}function lP(l,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of l.listPrimitives()){const i=n.getAttribute("POSITION");if(!i)continue;let o=[0,0,0],c=[0,0,0];for(let f=0;f<i.getCount();f++)o=i.getElement(f,o),c=aP(c,o,e),M1(c,t)}return t}function M1(l,e){for(let t=0;t<3;t++)e.min[t]=Math.min(l[t],e.min[t]),e.max[t]=Math.max(l[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var l=0,e=arguments.length;e--;)l+=arguments[e]*arguments[e];return Math.sqrt(l)}),ow=new E1(3),E1!=Float32Array&&(ow[0]=0,ow[1]=0,ow[2]=0);class gs{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const n=new Uint8Array(t);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const i=new Uint8Array(n);if(i.set(e),t!==0)for(let o=e.byteLength;o<n;o++)i[o]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class td{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,i,o]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*i<<8^255*o<<0}static convertSRGBToLinear(e,t){const n=e,i=t;for(let o=0;o<3;o++)i[o]=n[o]<.04045?.0773993808*n[o]:Math.pow(.9478672986*n[o]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,i=t;for(let o=0;o<3;o++)i[o]=n[o]<.0031308?12.92*n[o]:1.055*Math.pow(n[o],.41666)-.055;return t}}class aw{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return gs.decodeText(e.slice(12,16))===aw.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}aw.PNG_FRIED_CHUNK_NAME="CgBI";class ig{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let n=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function cP(l,e){if(e>l.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(l.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return l}ig.impls={"image/jpeg":new class{match(l){return l.length>=3&&l[0]===255&&l[1]===216&&l[2]===255}getSize(l){let e,t,n=new DataView(l.buffer,l.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),cP(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(l.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(l){return 3}},"image/png":new aw};class jA{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return ig.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function IM(l){return Object.prototype.toString.call(l)==="[object Object]"}function Ay(l){if(IM(l)===!1)return!1;const e=l.constructor;if(e===void 0)return!0;const t=e.prototype;return IM(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}(function(l){l[l.SILENT=4]="SILENT",l[l.ERROR=3]="ERROR",l[l.WARN=2]="WARN",l[l.INFO=1]="INFO",l[l.DEBUG=0]="DEBUG"})(w1||(w1={}));class qd{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=qd.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=qd.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=qd.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=qd.Verbosity.ERROR&&console.error(e)}}function uP(l,e,t){var n=e[0],i=e[1],o=e[2],c=e[3],f=e[4],m=e[5],y=e[6],w=e[7],S=e[8],C=e[9],O=e[10],N=e[11],H=e[12],q=e[13],J=e[14],V=e[15],z=t[0],ue=t[1],me=t[2],Te=t[3];return l[0]=z*n+ue*f+me*S+Te*H,l[1]=z*i+ue*m+me*C+Te*q,l[2]=z*o+ue*y+me*O+Te*J,l[3]=z*c+ue*w+me*N+Te*V,l[4]=(z=t[4])*n+(ue=t[5])*f+(me=t[6])*S+(Te=t[7])*H,l[5]=z*i+ue*m+me*C+Te*q,l[6]=z*o+ue*y+me*O+Te*J,l[7]=z*c+ue*w+me*N+Te*V,l[8]=(z=t[8])*n+(ue=t[9])*f+(me=t[10])*S+(Te=t[11])*H,l[9]=z*i+ue*m+me*C+Te*q,l[10]=z*o+ue*y+me*O+Te*J,l[11]=z*c+ue*w+me*N+Te*V,l[12]=(z=t[12])*n+(ue=t[13])*f+(me=t[14])*S+(Te=t[15])*H,l[13]=z*i+ue*m+me*C+Te*q,l[14]=z*o+ue*y+me*O+Te*J,l[15]=z*c+ue*w+me*N+Te*V,l}qd.Verbosity=w1,qd.DEFAULT_INSTANCE=new qd(qd.Verbosity.INFO);class na{static identity(e){return e}static eq(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>n)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return na.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return na.encodeNormalizedInt(e,t)}static decompose(e,t,n,i){let o=S1([e[0],e[1],e[2]]);const c=S1([e[4],e[5],e[6]]),f=S1([e[8],e[9],e[10]]);var m,y,w,S,C,O,N,H,q,J,V,z,ue,me,Te,Be,He;((y=(m=e)[0])*(N=m[5])-(w=m[1])*(O=m[4]))*((z=m[10])*(He=m[15])-(ue=m[11])*(Be=m[14]))-(y*(H=m[6])-(S=m[2])*O)*((V=m[9])*He-ue*(Te=m[13]))+(y*(q=m[7])-(C=m[3])*O)*(V*Be-z*Te)+(w*H-S*N)*((J=m[8])*He-ue*(me=m[12]))-(w*q-C*N)*(J*Be-z*me)+(S*q-C*H)*(J*Te-V*me)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const tt=e.slice(),lt=1/o,at=1/c,St=1/f;tt[0]*=lt,tt[1]*=lt,tt[2]*=lt,tt[4]*=at,tt[5]*=at,tt[6]*=at,tt[8]*=St,tt[9]*=St,tt[10]*=St,function(mt,gt){var Ot=new E1(3);(function(wr,zn){var oi=zn[4],Ti=zn[5],Hr=zn[6],ps=zn[8],$r=zn[9],Fr=zn[10];wr[0]=Math.hypot(zn[0],zn[1],zn[2]),wr[1]=Math.hypot(oi,Ti,Hr),wr[2]=Math.hypot(ps,$r,Fr)})(Ot,gt);var Bt=1/Ot[0],Ft=1/Ot[1],_n=1/Ot[2],mn=gt[0]*Bt,qn=gt[1]*Ft,Rn=gt[2]*_n,En=gt[4]*Bt,ai=gt[5]*Ft,ri=gt[6]*_n,Ei=gt[8]*Bt,ki=gt[9]*Ft,Xi=gt[10]*_n,ts=mn+ai+Xi,Cr=0;ts>0?(Cr=2*Math.sqrt(ts+1),mt[3]=.25*Cr,mt[0]=(ri-ki)/Cr,mt[1]=(Ei-Rn)/Cr,mt[2]=(qn-En)/Cr):mn>ai&&mn>Xi?(Cr=2*Math.sqrt(1+mn-ai-Xi),mt[3]=(ri-ki)/Cr,mt[0]=.25*Cr,mt[1]=(qn+En)/Cr,mt[2]=(Ei+Rn)/Cr):ai>Xi?(Cr=2*Math.sqrt(1+ai-mn-Xi),mt[3]=(Ei-Rn)/Cr,mt[0]=(qn+En)/Cr,mt[1]=.25*Cr,mt[2]=(ri+ki)/Cr):(Cr=2*Math.sqrt(1+Xi-mn-ai),mt[3]=(qn-En)/Cr,mt[0]=(Ei+Rn)/Cr,mt[1]=(ri+ki)/Cr,mt[2]=.25*Cr)}(n,tt),i[0]=o,i[1]=c,i[2]=f}static compose(e,t,n,i){const o=i,c=t[0],f=t[1],m=t[2],y=t[3],w=c+c,S=f+f,C=m+m,O=c*w,N=c*S,H=c*C,q=f*S,J=f*C,V=m*C,z=y*w,ue=y*S,me=y*C,Te=n[0],Be=n[1],He=n[2];return o[0]=(1-(q+V))*Te,o[1]=(N+me)*Te,o[2]=(H-ue)*Te,o[3]=0,o[4]=(N-me)*Be,o[5]=(1-(O+V))*Be,o[6]=(J+z)*Be,o[7]=0,o[8]=(H+ue)*He,o[9]=(J-z)*He,o[10]=(1-(O+q))*He,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function hP(l,e){if(!!l!=!!e)return!1;const t=l.getChild(),n=e.getChild();return t===n||t.equals(n)}function dP(l,e){if(!!l!=!!e||l.length!==e.length)return!1;for(let t=0;t<l.length;t++){const n=l[t],i=e[t];if(n.getChild()!==i.getChild()&&!n.getChild().equals(i.getChild()))return!1}return!0}function pP(l,e){if(!!l!=!!e)return!1;const t=Object.keys(l),n=Object.keys(e);if(t.length!==n.length)return!1;for(const i in l){const o=l[i],c=e[i];if(!!o!=!!c)return!1;const f=o.getChild(),m=c.getChild();if(f!==m&&!f.equals(m))return!1}return!0}function PM(l,e){if(l===e)return!0;if(!!l!=!!e||!l||!e||l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(l[t]!==e[t])return!1;return!0}function DM(l,e){if(l===e)return!0;if(!!l!=!!e)return!1;if(!Ay(l)||!Ay(e))return l===e;const t=l,n=e;let i,o=0,c=0;for(i in t)o++;for(i in n)c++;if(o!==c)return!1;for(i in t){const f=t[i],m=n[i];if(lw(f)&&lw(m)){if(!PM(f,m))return!1}else if(Ay(f)&&Ay(m)){if(!DM(f,m))return!1}else if(f!==m)return!1}return!0}function lw(l){return Array.isArray(l)||ArrayBuffer.isView(l)}const OM="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",BM=new Set,fP=function(){let l="";for(let e=0;e<6;e++)l+=OM.charAt(Math.floor(Math.random()*OM.length));return l};class Wb{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return jA.basename(new URL(e,"https://null.example").pathname)}static extension(e){return jA.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),i=t.split("/");n.pop();for(let o=0;o<i.length;o++)i[o]!=="."&&(i[o]===".."?n.pop():n.push(i[o]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Wb.DEFAULT_INIT={},Wb.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const k_=l=>l,mP=new Set;class T1 extends x1{constructor(e,t=""){super(e),this[Io].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,k_)}copy(e,t=k_){for(const n in this[Io]){const i=this[Io][n];if(i instanceof FA)this[zA].has(n)||i.dispose();else if(Gb(i))for(const o of i)o.dispose();else if(Hb(i))for(const o in i)i[o].dispose()}for(const n in e[Io]){const i=this[Io][n],o=e[Io][n];if(o instanceof FA)this[zA].has(n)?i.getChild().copy(t(o.getChild()),t):this.setRef(n,t(o.getChild()),o.getAttributes());else if(Gb(o))for(const c of o)this.addRef(n,t(c.getChild()),c.getAttributes());else if(Hb(o))for(const c in o){const f=o[c];this.setRefMap(n,c,t(f.getChild()),f.getAttributes())}else this[Io][n]=Ay(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=mP){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[Io]){if(t.has(n))continue;const i=this[Io][n],o=e[Io][n];if(b1(i)||b1(o)){if(!hP(i,o))return!1}else if(Gb(i)||Gb(o)){if(!dP(i,o))return!1}else if(Hb(i)||Hb(o)){if(!pP(i,o))return!1}else if(Ay(i)||Ay(o)){if(!DM(i,o))return!1}else if(lw(i)||lw(o)){if(!PM(i,o))return!1}else if(i!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ch extends T1{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class or extends ch{constructor(...e){super(...e),this.i=na.identity,this.o=na.identity}init(){this.propertyType=Ni.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:or.Type.SCALAR,componentType:or.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=k_){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case or.Type.SCALAR:return 1;case or.Type.VEC2:return 2;case or.Type.VEC3:return 3;case or.Type.VEC4:case or.Type.MAT2:return 4;case or.Type.MAT3:return 9;case or.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case or.ComponentType.BYTE:case or.ComponentType.UNSIGNED_BYTE:return 1;case or.ComponentType.SHORT:case or.ComponentType.UNSIGNED_SHORT:return 2;case or.ComponentType.UNSIGNED_INT:case or.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=1/0;for(let o=0;o<n*i;o+=i)for(let c=0;c<i;c++){const f=t[o+c];Number.isFinite(f)&&(e[c]=Math.min(e[c],f))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=-1/0;for(let o=0;o<n*i;o+=i)for(let c=0;c<i;c++){const f=t[o+c];Number.isFinite(f)&&(e[c]=Math.max(e[c],f))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return or.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>na.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>na.encodeNormalizedInt(t,this.get("componentType"))):(this.o=na.identity,this.i=na.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let o=0;o<n;o++)t[o]=this.o(i[e*n+o]);return t}setElement(e,t){const n=this.getElementSize(),i=this.get("array");for(let o=0;o<n;o++)i[e*n+o]=this.i(t[o]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return or.ComponentType.FLOAT;case Uint32Array:return or.ComponentType.UNSIGNED_INT;case Uint16Array:return or.ComponentType.UNSIGNED_SHORT;case Uint8Array:return or.ComponentType.UNSIGNED_BYTE;case Int16Array:return or.ComponentType.SHORT;case Int8Array:return or.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):or.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}or.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},or.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class LM extends ch{init(){this.propertyType=Ni.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class C1 extends ch{init(){this.propertyType=Ni.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}C1.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class VA extends ch{init(){this.propertyType=Ni.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:VA.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Qd.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Qd.OTHER})}}VA.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class NM extends ch{init(){this.propertyType=Ni.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class by extends ch{init(){this.propertyType=Ni.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:by.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}by.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class tl extends T1{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}tl.EXTENSION_NAME=void 0;class ia extends ch{init(){this.propertyType=Ni.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:ia.WrapMode.REPEAT,wrapT:ia.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}ia.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ia.MagFilter={NEAREST:9728,LINEAR:9729},ia.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:cw,G:uw,B:hw,A:gP}=Ua;class xy extends ch{init(){this.propertyType=Ni.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:xy.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new ia(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new ia(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new ia(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new ia(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new ia(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return td.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",td.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:cw|uw|hw|gP})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return td.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",td.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:cw|uw|hw})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:cw|uw|hw})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:cw})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:uw|hw})}}xy.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class kM extends ch{init(){this.propertyType=Ni.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class UM extends ch{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Ni.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=k_){if(t===k_)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return na.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),i=this.get("scale").slice();return na.decompose(e,t,n,i),this.set("translation",t).set("rotation",n).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return na.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return na.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return na.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i!=null;i=i.u)e.push(i);let t;const n=e.pop().getMatrix();for(;t=e.pop();)uP(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[Io].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===Ni.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class wy extends ch{init(){this.propertyType=Ni.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:wy.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Qd.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Qd.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}wy.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class _P extends T1{init(){this.propertyType=Ni.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Qd.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function nd(){return(nd=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l}).apply(this,arguments)}class FM extends ch{init(){this.propertyType=Ni.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=k_){if(t===k_)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class zM extends ch{init(){this.propertyType=Ni.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Qd.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class jM extends ch{init(){this.propertyType=Ni.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ig.extensionToMimeType(jA.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=ig.extensionToMimeType(jA.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",gs.assertView(e))}getSize(){const e=this.get("image");return e?ig.getSize(e,this.getMimeType()):null}}class VM extends ch{init(){this.propertyType=Ni.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v3.2.1",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=k_){if(t===k_)throw new Error("Root cannot be copied.");this.set("asset",nd({},e.get("asset"))),this.setName(e.getName()),this.setExtras(nd({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const i=e.getExtension(n);this.setExtension(n,t(i))}return this}l(e){return e instanceof FM?this.addRef("scenes",e):e instanceof UM?this.addRef("nodes",e):e instanceof by?this.addRef("cameras",e):e instanceof zM?this.addRef("skins",e):e instanceof kM?this.addRef("meshes",e):e instanceof xy?this.addRef("materials",e):e instanceof jM?this.addRef("textures",e):e instanceof LM?this.addRef("animations",e):e instanceof or?this.addRef("accessors",e):e instanceof NM&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class GA{static fromGraph(e){return GA.m.get(e)||null}constructor(){this.v=new oP,this.T=new VM(this.v),this.M=qd.DEFAULT_INSTANCE,GA.m.set(this.v,this)}getRoot(){return this.T}getGraph(){return this.v}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new GA().setLogger(this.M).merge(this)}merge(e){for(const o of e.getRoot().listExtensionsUsed()){const c=this.createExtension(o.constructor);o.isRequired()&&c.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const o of e.v.listEdges())for(const c of[o.getParent(),o.getChild()]){if(t.has(c))continue;let f;f=c.propertyType===Ni.TEXTURE_INFO?c:new c.constructor(this.v),n.set(c,f),t.add(c)}const i=o=>{const c=n.get(o);if(!c)throw new Error("Could resolve property.");return c};for(const o of t){const c=n.get(o);if(!c)throw new Error("Could resolve property.");c.propertyType!==Ni.TEXTURE_INFO&&c.copy(o,i)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new FM(this.v,e)}createNode(e=""){return new UM(this.v,e)}createCamera(e=""){return new by(this.v,e)}createSkin(e=""){return new zM(this.v,e)}createMesh(e=""){return new kM(this.v,e)}createPrimitive(){return new wy(this.v)}createPrimitiveTarget(e=""){return new _P(this.v,e)}createMaterial(e=""){return new xy(this.v,e)}createTexture(e=""){return new jM(this.v,e)}createAnimation(e=""){return new LM(this.v,e)}createAnimationChannel(e=""){return new C1(this.v,e)}createAnimationSampler(e=""){return new VA(this.v,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new or(this.v,e).setBuffer(t)}createBuffer(e=""){return new NM(this.v,e)}}GA.m=new WeakMap;class fa{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const i=n,o=i.target;o instanceof tl&&o.extensionName===this.extensionName&&(i.type==="node:create"&&this.I(o),i.type==="node:dispose"&&this.N(o))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}I(e){return this.properties.add(e),this}N(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}fa.EXTENSION_NAME=void 0;class vP{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const i=this.jsonDoc.json.samplers[n.sampler];i.magFilter!==void 0&&e.setMagFilter(i.magFilter),i.minFilter!==void 0&&e.setMinFilter(i.minFilter),i.wrapS!==void 0&&e.setWrapS(i.wrapS),i.wrapT!==void 0&&e.setWrapT(i.wrapT)}}const GM={logger:qd.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function dw(l,e){const t=e.bufferViews[l.bufferView],n=e.jsonDoc.json.bufferViews[l.bufferView],i=sw[l.componentType],o=or.getElementSize(l.type),c=i.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==o*c)return function(m,y){const w=y.bufferViews[m.bufferView],S=y.jsonDoc.json.bufferViews[m.bufferView],C=sw[m.componentType],O=or.getElementSize(m.type),N=C.BYTES_PER_ELEMENT,H=m.byteOffset||0,q=new C(m.count*O),J=new DataView(w.buffer,w.byteOffset,w.byteLength),V=S.byteStride;for(let z=0;z<m.count;z++)for(let ue=0;ue<O;ue++){const me=H+z*V+ue*N;let Te;switch(m.componentType){case or.ComponentType.FLOAT:Te=J.getFloat32(me,!0);break;case or.ComponentType.UNSIGNED_INT:Te=J.getUint32(me,!0);break;case or.ComponentType.UNSIGNED_SHORT:Te=J.getUint16(me,!0);break;case or.ComponentType.UNSIGNED_BYTE:Te=J.getUint8(me);break;case or.ComponentType.SHORT:Te=J.getInt16(me,!0);break;case or.ComponentType.BYTE:Te=J.getInt8(me);break;default:throw new Error(`Unexpected componentType "${m.componentType}".`)}q[z*O+ue]=Te}return q}(l,e);const f=t.byteOffset+(l.byteOffset||0);return new i(t.buffer.slice(f,f+l.count*o*c))}var Qb;(function(l){l[l.ARRAY_BUFFER=34962]="ARRAY_BUFFER",l[l.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Qb||(Qb={}));class rg{constructor(e,t,n){this.O=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.C=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.O=e,this.jsonDoc=t,this.options=n;const i=e.getRoot(),o=i.listBuffers().length,c=i.listTextures().length;this.bufferURIGenerator=new HM(o>1,()=>n.basename||"buffer"),this.imageURIGenerator=new HM(c>1,f=>function(m,y){const w=m.getGraph().listParentEdges(y).find(S=>S.getParent()!==m.getRoot());return w?w.getName().replace(/texture$/i,""):""}(e,f)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(n);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},c=JSON.stringify(o);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const f={index:this.textureDefIndexMap.get(c)};return t.getTexCoord()!==0&&(f.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(f.extras=t.getExtras()),this.textureInfoDefMap.set(t,f),f}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.O.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===yy.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=ig.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.C.get(e);if(t)return t;if(e.getSparse())return Qd.SPARSE;for(const n of this.O.getGraph().listParentEdges(e)){const{usage:i}=n.getAttributes();if(i)return i;n.getParent().propertyType!==Ni.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Qd.OTHER}addAccessorToUsageGroup(e,t){const n=this.C.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.C.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.C.entries()))e[n]=e[n]||[],e[n].push(t);return e}}rg.BufferViewTarget=Qb,rg.BufferViewUsage=Qd,rg.USAGE_TO_TARGET={[Qd.ARRAY_BUFFER]:Qb.ARRAY_BUFFER,[Qd.ELEMENT_ARRAY_BUFFER]:Qb.ELEMENT_ARRAY_BUFFER};class HM{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:pw}=rg,{UNSIGNED_INT:yP,UNSIGNED_SHORT:AP,UNSIGNED_BYTE:bP}=or.ComponentType;var fw;(function(l){l[l.JSON=1313821514]="JSON",l[l.BIN=5130562]="BIN"})(fw||(fw={}));class xP{constructor(){this.M=qd.DEFAULT_INSTANCE,this.h=new Set,this.F={},this.U=rw.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.F,e),this}setVertexLayout(e){return this.U=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=WM(t)?this.P(t):{json:JSON.parse(gs.decodeText(t)),resources:{}};return await this.L(n,this.dirname(e)),this.j(n),n}async readJSON(e){return e=this.D(e),this.j(e),(class{static read(t,n=GM){const i=nd({},GM,n),{json:o}=t,c=new GA().setLogger(i.logger);this.validate(t,i);const f=new vP(t),m=o.asset,y=c.getRoot().getAsset();m.copyright&&(y.copyright=m.copyright),m.extras&&(y.extras=m.extras),o.extras!==void 0&&c.getRoot().setExtras(nd({},o.extras));const w=o.extensionsUsed||[],S=o.extensionsRequired||[];for(const z of i.extensions)if(w.includes(z.EXTENSION_NAME)){const ue=c.createExtension(z).setRequired(S.includes(z.EXTENSION_NAME));for(const me of ue.readDependencies)ue.install(me,i.dependencies[me])}const C=o.buffers||[];c.getRoot().listExtensionsUsed().filter(z=>z.prereadTypes.includes(Ni.BUFFER)).forEach(z=>z.preread(f,Ni.BUFFER)),f.buffers=C.map(z=>{const ue=c.createBuffer(z.name);return z.extras&&ue.setExtras(z.extras),z.uri&&z.uri.indexOf("__")!==0&&ue.setURI(z.uri),ue}),f.bufferViewBuffers=(o.bufferViews||[]).map((z,ue)=>{if(!f.bufferViews[ue]){const me=t.json.buffers[z.buffer];f.bufferViews[ue]=gs.toView(me.uri?t.resources[me.uri]:t.resources["@glb.bin"],z.byteOffset||0,z.byteLength)}return f.buffers[z.buffer]});const O=o.accessors||[];f.accessors=O.map(z=>{const ue=c.createAccessor(z.name,f.bufferViewBuffers[z.bufferView]).setType(z.type);return z.extras&&ue.setExtras(z.extras),z.normalized!==void 0&&ue.setNormalized(z.normalized),z.bufferView===void 0||ue.setArray(dw(z,f)),ue});const N=o.images||[],H=o.textures||[];c.getRoot().listExtensionsUsed().filter(z=>z.prereadTypes.includes(Ni.TEXTURE)).forEach(z=>z.preread(f,Ni.TEXTURE)),f.textures=N.map(z=>{const ue=c.createTexture(z.name);if(z.extras&&ue.setExtras(z.extras),z.bufferView!==void 0){const me=o.bufferViews[z.bufferView],Te=t.json.buffers[me.buffer],Be=me.byteOffset||0,He=(Te.uri?t.resources[Te.uri]:t.resources["@glb.bin"]).slice(Be,Be+me.byteLength);ue.setImage(He)}else z.uri!==void 0&&(ue.setImage(t.resources[z.uri]),z.uri.indexOf("__")!==0&&ue.setURI(z.uri));if(z.mimeType!==void 0)ue.setMimeType(z.mimeType);else if(z.uri){const me=jA.extension(z.uri);ue.setMimeType(ig.extensionToMimeType(me))}return ue}),f.materials=(o.materials||[]).map(z=>{const ue=c.createMaterial(z.name);z.extras&&ue.setExtras(z.extras),z.alphaMode!==void 0&&ue.setAlphaMode(z.alphaMode),z.alphaCutoff!==void 0&&ue.setAlphaCutoff(z.alphaCutoff),z.doubleSided!==void 0&&ue.setDoubleSided(z.doubleSided);const me=z.pbrMetallicRoughness||{};if(me.baseColorFactor!==void 0&&ue.setBaseColorFactor(me.baseColorFactor),z.emissiveFactor!==void 0&&ue.setEmissiveFactor(z.emissiveFactor),me.metallicFactor!==void 0&&ue.setMetallicFactor(me.metallicFactor),me.roughnessFactor!==void 0&&ue.setRoughnessFactor(me.roughnessFactor),me.baseColorTexture!==void 0){const Te=me.baseColorTexture;ue.setBaseColorTexture(f.textures[H[Te.index].source]),f.setTextureInfo(ue.getBaseColorTextureInfo(),Te)}if(z.emissiveTexture!==void 0){const Te=z.emissiveTexture;ue.setEmissiveTexture(f.textures[H[Te.index].source]),f.setTextureInfo(ue.getEmissiveTextureInfo(),Te)}if(z.normalTexture!==void 0){const Te=z.normalTexture;ue.setNormalTexture(f.textures[H[Te.index].source]),f.setTextureInfo(ue.getNormalTextureInfo(),Te),z.normalTexture.scale!==void 0&&ue.setNormalScale(z.normalTexture.scale)}if(z.occlusionTexture!==void 0){const Te=z.occlusionTexture;ue.setOcclusionTexture(f.textures[H[Te.index].source]),f.setTextureInfo(ue.getOcclusionTextureInfo(),Te),z.occlusionTexture.strength!==void 0&&ue.setOcclusionStrength(z.occlusionTexture.strength)}if(me.metallicRoughnessTexture!==void 0){const Te=me.metallicRoughnessTexture;ue.setMetallicRoughnessTexture(f.textures[H[Te.index].source]),f.setTextureInfo(ue.getMetallicRoughnessTextureInfo(),Te)}return ue});const q=o.meshes||[];c.getRoot().listExtensionsUsed().filter(z=>z.prereadTypes.includes(Ni.PRIMITIVE)).forEach(z=>z.preread(f,Ni.PRIMITIVE)),f.meshes=q.map(z=>{const ue=c.createMesh(z.name);return z.extras&&ue.setExtras(z.extras),z.weights!==void 0&&ue.setWeights(z.weights),(z.primitives||[]).forEach(me=>{const Te=c.createPrimitive();me.extras&&Te.setExtras(me.extras),me.material!==void 0&&Te.setMaterial(f.materials[me.material]),me.mode!==void 0&&Te.setMode(me.mode);for(const[He,tt]of Object.entries(me.attributes||{}))Te.setAttribute(He,f.accessors[tt]);me.indices!==void 0&&Te.setIndices(f.accessors[me.indices]);const Be=z.extras&&z.extras.targetNames||[];(me.targets||[]).forEach((He,tt)=>{const lt=Be[tt]||tt.toString(),at=c.createPrimitiveTarget(lt);for(const[St,mt]of Object.entries(He))at.setAttribute(St,f.accessors[mt]);Te.addTarget(at)}),ue.addPrimitive(Te)}),ue}),f.cameras=(o.cameras||[]).map(z=>{const ue=c.createCamera(z.name).setType(z.type);if(z.extras&&ue.setExtras(z.extras),z.type===by.Type.PERSPECTIVE){const me=z.perspective;ue.setYFov(me.yfov),ue.setZNear(me.znear),me.zfar!==void 0&&ue.setZFar(me.zfar),me.aspectRatio!==void 0&&ue.setAspectRatio(me.aspectRatio)}else{const me=z.orthographic;ue.setZNear(me.znear).setZFar(me.zfar).setXMag(me.xmag).setYMag(me.ymag)}return ue});const J=o.nodes||[];c.getRoot().listExtensionsUsed().filter(z=>z.prereadTypes.includes(Ni.NODE)).forEach(z=>z.preread(f,Ni.NODE)),f.nodes=J.map(z=>{const ue=c.createNode(z.name);if(z.extras&&ue.setExtras(z.extras),z.translation!==void 0&&ue.setTranslation(z.translation),z.rotation!==void 0&&ue.setRotation(z.rotation),z.scale!==void 0&&ue.setScale(z.scale),z.matrix!==void 0){const me=[0,0,0],Te=[0,0,0,1],Be=[1,1,1];na.decompose(z.matrix,me,Te,Be),ue.setTranslation(me),ue.setRotation(Te),ue.setScale(Be)}return z.weights!==void 0&&ue.setWeights(z.weights),ue}),f.skins=(o.skins||[]).map(z=>{const ue=c.createSkin(z.name);z.extras&&ue.setExtras(z.extras),z.inverseBindMatrices!==void 0&&ue.setInverseBindMatrices(f.accessors[z.inverseBindMatrices]),z.skeleton!==void 0&&ue.setSkeleton(f.nodes[z.skeleton]);for(const me of z.joints)ue.addJoint(f.nodes[me]);return ue}),J.map((z,ue)=>{const me=f.nodes[ue];(z.children||[]).forEach(Te=>me.addChild(f.nodes[Te])),z.mesh!==void 0&&me.setMesh(f.meshes[z.mesh]),z.camera!==void 0&&me.setCamera(f.cameras[z.camera]),z.skin!==void 0&&me.setSkin(f.skins[z.skin])}),f.animations=(o.animations||[]).map(z=>{const ue=c.createAnimation(z.name);z.extras&&ue.setExtras(z.extras);const me=(z.samplers||[]).map(Te=>{const Be=c.createAnimationSampler().setInput(f.accessors[Te.input]).setOutput(f.accessors[Te.output]).setInterpolation(Te.interpolation||VA.Interpolation.LINEAR);return Te.extras&&Be.setExtras(Te.extras),ue.addSampler(Be),Be});return(z.channels||[]).forEach(Te=>{const Be=c.createAnimationChannel().setSampler(me[Te.sampler]).setTargetPath(Te.target.path);Te.target.node!==void 0&&Be.setTargetNode(f.nodes[Te.target.node]),Te.extras&&Be.setExtras(Te.extras),ue.addChannel(Be)}),ue});const V=o.scenes||[];return c.getRoot().listExtensionsUsed().filter(z=>z.prereadTypes.includes(Ni.SCENE)).forEach(z=>z.preread(f,Ni.SCENE)),f.scenes=V.map(z=>{const ue=c.createScene(z.name);return z.extras&&ue.setExtras(z.extras),(z.nodes||[]).map(me=>f.nodes[me]).forEach(me=>ue.addChild(me)),ue}),o.scene!==void 0&&c.getRoot().setDefaultScene(f.scenes[o.scene]),c.getRoot().listExtensionsUsed().forEach(z=>z.read(f)),O.forEach((z,ue)=>{const me=f.accessors[ue],Te=!!z.sparse,Be=!z.bufferView&&!me.getArray();(Te||Be)&&me.setSparse(!0).setArray(function(He,tt){const lt=sw[He.componentType],at=or.getElementSize(He.type);let St;St=He.bufferView!==void 0?dw(He,tt):new lt(He.count*at);const mt=He.sparse;if(!mt)return St;const gt=mt.count,Ot=nd({},He,mt.indices,{count:gt,type:"SCALAR"}),Bt=nd({},He,mt.values,{count:gt}),Ft=dw(Ot,tt),_n=dw(Bt,tt);for(let mn=0;mn<Ot.count;mn++)for(let qn=0;qn<at;qn++)St[Ft[mn]*at+qn]=_n[mn*at+qn];return St}(z,f))}),c}static validate(t,n){const i=t.json;if(i.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${i.asset.version}".`);if(i.extensionsRequired){for(const o of i.extensionsRequired)if(!n.extensions.find(c=>c.EXTENSION_NAME===o))throw new Error(`Missing required extension, "${o}".`)}if(i.extensionsUsed)for(const o of i.extensionsUsed)n.extensions.find(c=>c.EXTENSION_NAME===o)||n.logger.warn(`Missing optional extension, "${o}".`)}}).read(e,{extensions:Array.from(this.h),dependencies:this.F,logger:this.M})}async binaryToJSON(e){const t=this.P(gs.assertView(e));this.j(t);const n=t.json;if(n.buffers&&n.buffers.some(i=>function(o,c){return c.uri!==void 0&&!(c.uri in o.resources)}(t,i)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(i=>function(o,c){return c.uri!==void 0&&!(c.uri in o.resources)&&c.bufferView===void 0}(t,i)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(gs.assertView(e)))}async writeJSON(e,t={}){if(t.format===yy.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return(class{static write(n,i){const o=n.getRoot(),c={asset:nd({generator:"glTF-Transform v3.2.1"},o.getAsset()),extras:nd({},o.getExtras())},f={json:c,resources:{}},m=new rg(n,f,i),y=i.logger||qd.DEFAULT_INSTANCE,w=new Set(i.extensions.map(V=>V.EXTENSION_NAME)),S=n.getRoot().listExtensionsUsed().filter(V=>w.has(V.extensionName)),C=n.getRoot().listExtensionsRequired().filter(V=>w.has(V.extensionName));S.length<n.getRoot().listExtensionsUsed().length&&y.warn("Some extensions were not registered for I/O, and will not be written.");for(const V of S)for(const z of V.writeDependencies)V.install(z,i.dependencies[z]);function O(V,z,ue,me){const Te=[];let Be=0;for(const tt of V){const lt=m.createAccessorDef(tt);lt.bufferView=c.bufferViews.length;const at=tt.getArray(),St=gs.pad(gs.toView(at));lt.byteOffset=Be,Be+=St.byteLength,Te.push(St),m.accessorIndexMap.set(tt,c.accessors.length),c.accessors.push(lt)}const He={buffer:z,byteOffset:ue,byteLength:gs.concat(Te).byteLength};return me&&(He.target=me),c.bufferViews.push(He),{buffers:Te,byteLength:Be}}function N(V,z,ue){const me=V[0].getCount();let Te=0;for(const lt of V){const at=m.createAccessorDef(lt);at.bufferView=c.bufferViews.length,at.byteOffset=Te;const St=lt.getElementSize(),mt=lt.getComponentSize();Te+=gs.padNumber(St*mt),m.accessorIndexMap.set(lt,c.accessors.length),c.accessors.push(at)}const Be=me*Te,He=new ArrayBuffer(Be),tt=new DataView(He);for(let lt=0;lt<me;lt++){let at=0;for(const St of V){const mt=St.getElementSize(),gt=St.getComponentSize(),Ot=St.getComponentType(),Bt=St.getArray();for(let Ft=0;Ft<mt;Ft++){const _n=lt*Te+at+Ft*gt,mn=Bt[lt*mt+Ft];switch(Ot){case or.ComponentType.FLOAT:tt.setFloat32(_n,mn,!0);break;case or.ComponentType.BYTE:tt.setInt8(_n,mn);break;case or.ComponentType.SHORT:tt.setInt16(_n,mn,!0);break;case or.ComponentType.UNSIGNED_BYTE:tt.setUint8(_n,mn);break;case or.ComponentType.UNSIGNED_SHORT:tt.setUint16(_n,mn,!0);break;case or.ComponentType.UNSIGNED_INT:tt.setUint32(_n,mn,!0);break;default:throw new Error("Unexpected component type: "+Ot)}}at+=gs.padNumber(mt*gt)}}return c.bufferViews.push({buffer:z,byteOffset:ue,byteLength:Be,byteStride:Te,target:rg.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Be,buffers:[new Uint8Array(He)]}}function H(V,z,ue){const me=[];let Te=0;const Be=new Map;let He=-1/0;for(const Ot of V){const Bt=m.createAccessorDef(Ot);c.accessors.push(Bt),m.accessorIndexMap.set(Ot,c.accessors.length-1);const Ft=[],_n=[],mn=[],qn=new Array(Ot.getElementSize()).fill(0);for(let ri=0,Ei=Ot.getCount();ri<Ei;ri++)if(Ot.getElement(ri,mn),!na.eq(mn,qn,0)){He=Math.max(ri,He),Ft.push(ri);for(let ki=0;ki<mn.length;ki++)_n.push(mn[ki])}const Rn=Ft.length,En={accessorDef:Bt,count:Rn};if(Be.set(Ot,En),Rn===0)continue;if(Rn>Ot.getCount()/3){const ri=(100*Ft.length/Ot.getCount()).toFixed(1);y.warn(`Sparse accessor with many non-zero elements (${ri}%) may increase file size.`)}const ai=sw[Ot.getComponentType()];En.indices=Ft,En.values=new ai(_n)}if(!Number.isFinite(He))return{buffers:me,byteLength:Te};const tt=He<255?Uint8Array:He<65535?Uint16Array:Uint32Array,lt=He<255?bP:He<65535?AP:yP,at={buffer:z,byteOffset:ue+Te,byteLength:0};for(const Ot of V){const Bt=Be.get(Ot);if(Bt.count===0)continue;Bt.indicesByteOffset=at.byteLength;const Ft=gs.pad(gs.toView(new tt(Bt.indices)));me.push(Ft),Te+=Ft.byteLength,at.byteLength+=Ft.byteLength}c.bufferViews.push(at);const St=c.bufferViews.length-1,mt={buffer:z,byteOffset:ue+Te,byteLength:0};for(const Ot of V){const Bt=Be.get(Ot);if(Bt.count===0)continue;Bt.valuesByteOffset=mt.byteLength;const Ft=gs.pad(gs.toView(Bt.values));me.push(Ft),Te+=Ft.byteLength,mt.byteLength+=Ft.byteLength}c.bufferViews.push(mt);const gt=c.bufferViews.length-1;for(const Ot of V){const Bt=Be.get(Ot);Bt.count!==0&&(Bt.accessorDef.sparse={count:Bt.count,indices:{bufferView:St,byteOffset:Bt.indicesByteOffset,componentType:lt},values:{bufferView:gt,byteOffset:Bt.valuesByteOffset}})}return{buffers:me,byteLength:Te}}const q=new Map;for(const V of n.getGraph().listEdges()){if(V.getParent()===o)continue;const z=V.getChild();if(z instanceof or){const ue=q.get(z)||[];ue.push(V),q.set(z,ue)}}if(c.accessors=[],c.bufferViews=[],c.samplers=[],c.textures=[],c.images=o.listTextures().map((V,z)=>{const ue=m.createPropertyDef(V);V.getMimeType()&&(ue.mimeType=V.getMimeType());const me=V.getImage();return me&&m.createImageData(ue,me,V),m.imageIndexMap.set(V,z),ue}),S.filter(V=>V.prewriteTypes.includes(Ni.ACCESSOR)).forEach(V=>V.prewrite(m,Ni.ACCESSOR)),o.listAccessors().forEach(V=>{const z=m.accessorUsageGroupedByParent,ue=m.accessorParents;if(m.accessorIndexMap.has(V))return;const me=q.get(V)||[],Te=m.getAccessorUsage(V);if(m.addAccessorToUsageGroup(V,Te),z.has(Te)){const Be=me[0].getParent(),He=ue.get(Be)||new Set;He.add(V),ue.set(Be,He)}}),S.filter(V=>V.prewriteTypes.includes(Ni.BUFFER)).forEach(V=>V.prewrite(m,Ni.BUFFER)),(o.listAccessors().length>0||o.listTextures().length>0||m.otherBufferViews.size>0)&&o.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");c.buffers=[],o.listBuffers().forEach((V,z)=>{const ue=m.createPropertyDef(V),me=m.accessorUsageGroupedByParent,Te=m.accessorParents,Be=V.listParents().filter(mt=>mt instanceof or),He=new Set(Be),tt=[],lt=c.buffers.length;let at=0;const St=m.listAccessorUsageGroups();for(const mt in St)if(me.has(mt))for(const gt of Array.from(Te.values())){const Ot=Array.from(gt).filter(Bt=>He.has(Bt)).filter(Bt=>m.getAccessorUsage(Bt)===mt);if(Ot.length)if(mt!==pw.ARRAY_BUFFER||i.vertexLayout===rw.INTERLEAVED){const Bt=mt===pw.ARRAY_BUFFER?N(Ot,lt,at):O(Ot,lt,at);at+=Bt.byteLength,tt.push(...Bt.buffers)}else for(const Bt of Ot){const Ft=N([Bt],lt,at);at+=Ft.byteLength,tt.push(...Ft.buffers)}}else{const gt=St[mt].filter(Ft=>He.has(Ft));if(!gt.length)continue;const Ot=mt===pw.ELEMENT_ARRAY_BUFFER?rg.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,Bt=mt===pw.SPARSE?H(gt,lt,at):O(gt,lt,at,Ot);at+=Bt.byteLength,tt.push(...Bt.buffers)}if(m.imageBufferViews.length&&z===0){for(let mt=0;mt<m.imageBufferViews.length;mt++)if(c.bufferViews[c.images[mt].bufferView].byteOffset=at,at+=m.imageBufferViews[mt].byteLength,tt.push(m.imageBufferViews[mt]),at%8){const gt=8-at%8;at+=gt,tt.push(new Uint8Array(gt))}}if(m.otherBufferViews.has(V))for(const mt of m.otherBufferViews.get(V))c.bufferViews.push({buffer:lt,byteOffset:at,byteLength:mt.byteLength}),m.otherBufferViewsIndexMap.set(mt,c.bufferViews.length-1),at+=mt.byteLength,tt.push(mt);if(at){let mt;i.format===yy.GLB?mt="@glb.bin":(mt=m.bufferURIGenerator.createURI(V,"bin"),ue.uri=mt),ue.byteLength=at,f.resources[mt]=gs.concat(tt)}c.buffers.push(ue),m.bufferIndexMap.set(V,z)}),o.listAccessors().find(V=>!V.getBuffer())&&y.warn("Skipped writing one or more Accessors: no Buffer assigned."),c.materials=o.listMaterials().map((V,z)=>{const ue=m.createPropertyDef(V);if(V.getAlphaMode()!==xy.AlphaMode.OPAQUE&&(ue.alphaMode=V.getAlphaMode()),V.getAlphaMode()===xy.AlphaMode.MASK&&(ue.alphaCutoff=V.getAlphaCutoff()),V.getDoubleSided()&&(ue.doubleSided=!0),ue.pbrMetallicRoughness={},na.eq(V.getBaseColorFactor(),[1,1,1,1])||(ue.pbrMetallicRoughness.baseColorFactor=V.getBaseColorFactor()),na.eq(V.getEmissiveFactor(),[0,0,0])||(ue.emissiveFactor=V.getEmissiveFactor()),V.getRoughnessFactor()!==1&&(ue.pbrMetallicRoughness.roughnessFactor=V.getRoughnessFactor()),V.getMetallicFactor()!==1&&(ue.pbrMetallicRoughness.metallicFactor=V.getMetallicFactor()),V.getBaseColorTexture()){const me=V.getBaseColorTexture(),Te=V.getBaseColorTextureInfo();ue.pbrMetallicRoughness.baseColorTexture=m.createTextureInfoDef(me,Te)}if(V.getEmissiveTexture()){const me=V.getEmissiveTexture(),Te=V.getEmissiveTextureInfo();ue.emissiveTexture=m.createTextureInfoDef(me,Te)}if(V.getNormalTexture()){const me=V.getNormalTexture(),Te=V.getNormalTextureInfo(),Be=m.createTextureInfoDef(me,Te);V.getNormalScale()!==1&&(Be.scale=V.getNormalScale()),ue.normalTexture=Be}if(V.getOcclusionTexture()){const me=V.getOcclusionTexture(),Te=V.getOcclusionTextureInfo(),Be=m.createTextureInfoDef(me,Te);V.getOcclusionStrength()!==1&&(Be.strength=V.getOcclusionStrength()),ue.occlusionTexture=Be}if(V.getMetallicRoughnessTexture()){const me=V.getMetallicRoughnessTexture(),Te=V.getMetallicRoughnessTextureInfo();ue.pbrMetallicRoughness.metallicRoughnessTexture=m.createTextureInfoDef(me,Te)}return m.materialIndexMap.set(V,z),ue}),c.meshes=o.listMeshes().map((V,z)=>{const ue=m.createPropertyDef(V);let me=null;return ue.primitives=V.listPrimitives().map(Te=>{const Be={attributes:{}};Be.mode=Te.getMode();const He=Te.getMaterial();He&&(Be.material=m.materialIndexMap.get(He)),Object.keys(Te.getExtras()).length&&(Be.extras=Te.getExtras());const tt=Te.getIndices();tt&&(Be.indices=m.accessorIndexMap.get(tt));for(const lt of Te.listSemantics())Be.attributes[lt]=m.accessorIndexMap.get(Te.getAttribute(lt));for(const lt of Te.listTargets()){const at={};for(const St of lt.listSemantics())at[St]=m.accessorIndexMap.get(lt.getAttribute(St));Be.targets=Be.targets||[],Be.targets.push(at)}return Te.listTargets().length&&!me&&(me=Te.listTargets().map(lt=>lt.getName())),Be}),V.getWeights().length&&(ue.weights=V.getWeights()),me&&(ue.extras=ue.extras||{},ue.extras.targetNames=me),m.meshIndexMap.set(V,z),ue}),c.cameras=o.listCameras().map((V,z)=>{const ue=m.createPropertyDef(V);if(ue.type=V.getType(),ue.type===by.Type.PERSPECTIVE){ue.perspective={znear:V.getZNear(),zfar:V.getZFar(),yfov:V.getYFov()};const me=V.getAspectRatio();me!==null&&(ue.perspective.aspectRatio=me)}else ue.orthographic={znear:V.getZNear(),zfar:V.getZFar(),xmag:V.getXMag(),ymag:V.getYMag()};return m.cameraIndexMap.set(V,z),ue}),c.nodes=o.listNodes().map((V,z)=>{const ue=m.createPropertyDef(V);return na.eq(V.getTranslation(),[0,0,0])||(ue.translation=V.getTranslation()),na.eq(V.getRotation(),[0,0,0,1])||(ue.rotation=V.getRotation()),na.eq(V.getScale(),[1,1,1])||(ue.scale=V.getScale()),V.getWeights().length&&(ue.weights=V.getWeights()),m.nodeIndexMap.set(V,z),ue}),c.skins=o.listSkins().map((V,z)=>{const ue=m.createPropertyDef(V),me=V.getInverseBindMatrices();me&&(ue.inverseBindMatrices=m.accessorIndexMap.get(me));const Te=V.getSkeleton();return Te&&(ue.skeleton=m.nodeIndexMap.get(Te)),ue.joints=V.listJoints().map(Be=>m.nodeIndexMap.get(Be)),m.skinIndexMap.set(V,z),ue}),o.listNodes().forEach((V,z)=>{const ue=c.nodes[z],me=V.getMesh();me&&(ue.mesh=m.meshIndexMap.get(me));const Te=V.getCamera();Te&&(ue.camera=m.cameraIndexMap.get(Te));const Be=V.getSkin();Be&&(ue.skin=m.skinIndexMap.get(Be)),V.listChildren().length>0&&(ue.children=V.listChildren().map(He=>m.nodeIndexMap.get(He)))}),c.animations=o.listAnimations().map((V,z)=>{const ue=m.createPropertyDef(V),me=new Map;return ue.samplers=V.listSamplers().map((Te,Be)=>{const He=m.createPropertyDef(Te);return He.input=m.accessorIndexMap.get(Te.getInput()),He.output=m.accessorIndexMap.get(Te.getOutput()),He.interpolation=Te.getInterpolation(),me.set(Te,Be),He}),ue.channels=V.listChannels().map(Te=>{const Be=m.createPropertyDef(Te);return Be.sampler=me.get(Te.getSampler()),Be.target={node:m.nodeIndexMap.get(Te.getTargetNode()),path:Te.getTargetPath()},Be}),m.animationIndexMap.set(V,z),ue}),c.scenes=o.listScenes().map((V,z)=>{const ue=m.createPropertyDef(V);return ue.nodes=V.listChildren().map(me=>m.nodeIndexMap.get(me)),m.sceneIndexMap.set(V,z),ue});const J=o.getDefaultScene();return J&&(c.scene=o.listScenes().indexOf(J)),c.extensionsUsed=S.map(V=>V.extensionName),c.extensionsRequired=C.map(V=>V.extensionName),S.forEach(V=>V.write(m)),function(V){const z=[];for(const ue in V){const me=V[ue];(Array.isArray(me)&&me.length===0||me===null||me===""||me&&typeof me=="object"&&Object.keys(me).length===0)&&z.push(ue)}for(const ue of z)delete V[ue]}(c),f}}).write(e,{format:t.format||yy.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.U,dependencies:nd({},this.F),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:yy.GLB}),i=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),c=gs.pad(gs.encodeText(o),32),f=gs.toView(new Uint32Array([c.byteLength,1313821514])),m=gs.concat([f,c]);i[i.length-1]+=m.byteLength;const y=Object.values(n)[0];if(!y||!y.byteLength)return gs.concat([gs.toView(i),m]);const w=gs.pad(y,0),S=gs.toView(new Uint32Array([w.byteLength,5130562])),C=gs.concat([S,w]);return i[i.length-1]+=C.byteLength,gs.concat([gs.toView(i),m,C])}async L(e,t){var n=this;const i=[...e.json.images||[],...e.json.buffers||[]].map(async function(o){const c=o.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(t,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(i)}j(e){function t(n){if(n.uri){if(n.uri in e.resources)gs.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const i=`__${function(){for(let o=0;o<999;o++){const c=fP();if(!BM.has(c))return BM.add(c),c}return""}()}.${jA.extension(n.uri)}`;e.resources[i]=gs.createBufferFromDataURI(n.uri),n.uri=i}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}D(e){const{images:t,buffers:n}=e.json;return e={json:nd({},e.json),resources:nd({},e.resources)},t&&(e.json.images=t.map(i=>nd({},i))),n&&(e.json.buffers=n.map(i=>nd({},i))),e}P(e){if(!WM(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==fw.JSON)throw new Error("Missing required GLB JSON chunk.");const n=t[0],i=gs.decodeText(gs.toView(e,20,n)),o=JSON.parse(i),c=20+n;if(e.byteLength<=c)return{json:o,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+c,2);if(f[1]!==fw.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:o,resources:{"@glb.bin":gs.toView(e,c+8,f[0])}}}}function WM(l){if(l.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(l.buffer,l.byteOffset,3);return e[0]===1179937895&&e[1]===2}class wP extends xP{constructor(e=Wb.DEFAULT_INIT){super(),this.k=void 0,this.k=e}async readURI(e,t){const n=await fetch(e,this.k);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return Wb.resolve(e,t)}dirname(e){return Wb.dirname(e)}}const EP=64;class SP{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class qb{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const uh=[171,75,84,88,32,50,48,187,13,10,26,10];function QM(l){return typeof TextDecoder<"u"?new TextDecoder().decode(l):Buffer.from(l).toString("utf8")}function R1(l){const e=new Uint8Array(l.buffer,l.byteOffset,uh.length);if(e[0]!==uh[0]||e[1]!==uh[1]||e[2]!==uh[2]||e[3]!==uh[3]||e[4]!==uh[4]||e[5]!==uh[5]||e[6]!==uh[6]||e[7]!==uh[7]||e[8]!==uh[8]||e[9]!==uh[9]||e[10]!==uh[10]||e[11]!==uh[11])throw new Error("Missing KTX 2.0 identifier.");const t=new SP,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new qb(l,uh.length,n,!0);t.vkFormat=i._nextUint32(),t.typeSize=i._nextUint32(),t.pixelWidth=i._nextUint32(),t.pixelHeight=i._nextUint32(),t.pixelDepth=i._nextUint32(),t.layerCount=i._nextUint32(),t.faceCount=i._nextUint32();const o=i._nextUint32();t.supercompressionScheme=i._nextUint32();const c=i._nextUint32(),f=i._nextUint32(),m=i._nextUint32(),y=i._nextUint32(),w=i._nextUint64(),S=i._nextUint64(),C=3*o*8,O=new qb(l,uh.length+n,C,!0);for(let _n=0;_n<o;_n++)t.levels.push({levelData:new Uint8Array(l.buffer,l.byteOffset+O._nextUint64(),O._nextUint64()),uncompressedByteLength:O._nextUint64()});const N=new qb(l,c,f,!0),H={vendorId:N._skip(4)._nextUint16(),descriptorType:N._nextUint16(),versionNumber:N._nextUint16(),descriptorBlockSize:N._nextUint16(),colorModel:N._nextUint8(),colorPrimaries:N._nextUint8(),transferFunction:N._nextUint8(),flags:N._nextUint8(),texelBlockDimension:[N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8()],bytesPlane:[N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8()],samples:[]},q=(H.descriptorBlockSize/4-6)/4;for(let _n=0;_n<q;_n++){const mn={bitOffset:N._nextUint16(),bitLength:N._nextUint8(),channelType:N._nextUint8(),samplePosition:[N._nextUint8(),N._nextUint8(),N._nextUint8(),N._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};mn.channelType&EP?(mn.sampleLower=N._nextInt32(),mn.sampleUpper=N._nextInt32()):(mn.sampleLower=N._nextUint32(),mn.sampleUpper=N._nextUint32()),H.samples[_n]=mn}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(H);const J=new qb(l,m,y,!0);for(;J._offset<y;){const _n=J._nextUint32(),mn=J._scan(_n),qn=QM(mn),Rn=J._scan(_n-mn.byteLength);t.keyValue[qn]=qn.match(/^ktx/i)?QM(Rn):Rn,J._offset%4&&J._skip(4-J._offset%4)}if(S<=0)return t;const V=new qb(l,w,S,!0),z=V._nextUint16(),ue=V._nextUint16(),me=V._nextUint32(),Te=V._nextUint32(),Be=V._nextUint32(),He=V._nextUint32(),tt=[];for(let _n=0;_n<o;_n++)tt.push({imageFlags:V._nextUint32(),rgbSliceByteOffset:V._nextUint32(),rgbSliceByteLength:V._nextUint32(),alphaSliceByteOffset:V._nextUint32(),alphaSliceByteLength:V._nextUint32()});const lt=w+V._offset,at=lt+me,St=at+Te,mt=St+Be,gt=new Uint8Array(l.buffer,l.byteOffset+lt,me),Ot=new Uint8Array(l.buffer,l.byteOffset+at,Te),Bt=new Uint8Array(l.buffer,l.byteOffset+St,Be),Ft=new Uint8Array(l.buffer,l.byteOffset+mt,He);return t.globalData={endpointCount:z,selectorCount:ue,imageDescs:tt,endpointsData:gt,selectorsData:Ot,tablesData:Bt,extendedData:Ft},t}class qM extends tl{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Ni.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}qM.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Ey="EXT_mesh_gpu_instancing";class XM extends fa{constructor(...e){super(...e),this.extensionName=Ey,this.provideTypes=[Ni.NODE],this.prewriteTypes=[Ni.ACCESSOR]}createInstancedMesh(){return new qM(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[Ey])return;const i=t.extensions[Ey],o=this.createInstancedMesh();for(const c in i.attributes)o.setAttribute(c,e.accessors[i.attributes[c]]);e.nodes[n].setExtension(Ey,o)}),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(Ey);if(i){const o=e.nodeIndexMap.get(n),c=t.json.nodes[o],f={attributes:{}};i.listSemantics().forEach(m=>{const y=i.getAttribute(m);f.attributes[m]=e.accessorIndexMap.get(y)}),c.extensions=c.extensions||{},c.extensions[Ey]=f}}),this}}function m0(){return(m0=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l}).apply(this,arguments)}var Xb,HA,El;XM.EXTENSION_NAME=Ey,function(l){l.QUANTIZE="quantize",l.FILTER="filter"}(Xb||(Xb={})),function(l){l.ATTRIBUTES="ATTRIBUTES",l.TRIANGLES="TRIANGLES",l.INDICES="INDICES"}(HA||(HA={})),function(l){l.NONE="NONE",l.OCTAHEDRAL="OCTAHEDRAL",l.QUATERNION="QUATERNION",l.EXPONENTIAL="EXPONENTIAL"}(El||(El={}));const{BYTE:MP,SHORT:YM,FLOAT:TP}=or.ComponentType,{encodeNormalizedInt:KM,decodeNormalizedInt:I1}=na;function CP(l,e,t,n){const{filter:i,bits:o}=n,c={array:l.getArray(),byteStride:l.getElementSize()*l.getComponentSize(),componentType:l.getComponentType(),normalized:l.getNormalized()};if(t!==HA.ATTRIBUTES)return c;if(i!==El.NONE){let f=l.getNormalized()?function(m){const y=m.getComponentType(),w=m.getArray(),S=new Float32Array(w.length);for(let C=0;C<w.length;C++)S[C]=I1(w[C],y);return S}(l):new Float32Array(c.array);switch(i){case El.EXPONENTIAL:c.byteStride=4*l.getElementSize(),c.componentType=TP,c.normalized=!1,c.array=e.encodeFilterExp(f,l.getCount(),c.byteStride,o);break;case El.OCTAHEDRAL:c.byteStride=o>8?8:4,c.componentType=o>8?YM:MP,c.normalized=!0,f=l.getElementSize()===3?function(m){const y=new Float32Array(4*m.length/3);for(let w=0,S=m.length/3;w<S;w++)y[4*w]=m[3*w],y[4*w+1]=m[3*w+1],y[4*w+2]=m[3*w+2];return y}(f):f,c.array=e.encodeFilterOct(f,l.getCount(),c.byteStride,o);break;case El.QUATERNION:c.byteStride=8,c.componentType=YM,c.normalized=!0,c.array=e.encodeFilterQuat(f,l.getCount(),c.byteStride,o);break;default:throw new Error("Invalid filter.")}c.min=l.getMin([]),c.max=l.getMax([]),l.getNormalized()&&(c.min=c.min.map(m=>I1(m,l.getComponentType())),c.max=c.max.map(m=>I1(m,l.getComponentType()))),c.normalized&&(c.min=c.min.map(m=>KM(m,c.componentType)),c.max=c.max.map(m=>KM(m,c.componentType)))}else c.byteStride%4&&(c.array=function(f,m){const y=gs.padNumber(f.BYTES_PER_ELEMENT*m)/f.BYTES_PER_ELEMENT,w=new f.constructor(f.length/m*y);for(let S=0;S*m<f.length;S++)for(let C=0;C<m;C++)w[S*y+C]=f[S*m+C];return w}(c.array,l.getElementSize()),c.byteStride=c.array.byteLength/l.getCount());return c}function RP(l,e){return e===rg.BufferViewUsage.ELEMENT_ARRAY_BUFFER?l.listParents().some(t=>t instanceof wy&&t.getMode()===wy.Mode.TRIANGLES)?HA.TRIANGLES:HA.INDICES:HA.ATTRIBUTES}function IP(l,e){const t=e.getGraph().listParentEdges(l).filter(n=>!(n.getParent()instanceof VM));for(const n of t){const i=n.getName(),o=n.getAttributes().key||"";if(i==="indices")return{filter:El.NONE};if(i==="attributes"){if(o==="POSITION")return{filter:El.NONE};if(o==="TEXCOORD_0")return{filter:El.NONE};if(o==="NORMAL")return{filter:El.OCTAHEDRAL,bits:8};if(o==="TANGENT")return{filter:El.OCTAHEDRAL,bits:8};if(o.startsWith("JOINTS_"))return{filter:El.NONE};if(o.startsWith("WEIGHTS_"))return{filter:El.NONE}}if(i==="output"){const c=$M(l);return c==="rotation"?{filter:El.QUATERNION,bits:16}:c==="translation"||c==="scale"?{filter:El.EXPONENTIAL,bits:12}:{filter:El.NONE}}if(i==="input")return{filter:El.NONE};if(i==="inverseBindMatrices")return{filter:El.NONE}}return{filter:El.NONE}}function $M(l){for(const e of l.listParents())if(e instanceof VA){for(const t of e.listParents())if(t instanceof C1)return t.getTargetPath()}return null}const hh="EXT_meshopt_compression",JM={method:Xb.QUANTIZE};class P1 extends fa{constructor(...e){super(...e),this.extensionName=hh,this.prereadTypes=[Ni.BUFFER,Ni.PRIMITIVE],this.prewriteTypes=[Ni.BUFFER,Ni.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=JM,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=m0({},JM,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${hh}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${hh}]: Missing WASM support.`)}return t===Ni.BUFFER?this._prereadBuffers(e):t===Ni.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,i)=>{if(!n.extensions||!n.extensions[hh])return;const o=n.extensions[hh],c=o.byteOffset||0,f=o.byteLength||0,m=o.count,y=o.byteStride,w=new Uint8Array(m*y),S=t.json.buffers[o.buffer],C=gs.toView(S.uri?t.resources[S.uri]:t.resources[RM],c,f);this._decoder.decodeGltfBuffer(w,m,y,C,o.mode,o.filter),e.bufferViews[i]=w})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var i;n.extensions&&n.extensions[hh]&&(i=t.json.buffers[n.buffer]).extensions&&i.extensions.EXT_meshopt_compression&&i.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[hh].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof or&&i.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===Ni.ACCESSOR?this._prewriteAccessors(e):t===Ni.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,i=this._encoderOptions,o=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if($M(f)==="weights"||f.getSparse())continue;const m=e.getAccessorUsage(f),y=RP(f,m),w=i.method===Xb.FILTER?IP(f,this.document):{filter:El.NONE},S=CP(f,n,y,w),{array:C,byteStride:O}=S,N=f.getBuffer();if(!N)throw new Error(`${hh}: Missing buffer for accessor.`);const H=this.document.getRoot().listBuffers().indexOf(N),q=[m,y,w.filter,O,H].join(":");let J=this._encoderBufferViews[q],V=this._encoderBufferViewData[q],z=this._encoderBufferViewAccessors[q];J&&V||(z=this._encoderBufferViewAccessors[q]=[],V=this._encoderBufferViewData[q]=[],J=this._encoderBufferViews[q]={buffer:c,target:rg.USAGE_TO_TARGET[m],byteOffset:0,byteLength:0,byteStride:m===rg.BufferViewUsage.ARRAY_BUFFER?O:void 0,extensions:{[hh]:{buffer:H,byteOffset:0,byteLength:0,mode:y,filter:w.filter!==El.NONE?w.filter:void 0,byteStride:O,count:0}}});const ue=e.createAccessorDef(f);ue.componentType=S.componentType,ue.normalized=S.normalized,ue.byteOffset=J.byteLength,ue.min&&S.min&&(ue.min=S.min),ue.max&&S.max&&(ue.max=S.max),e.accessorIndexMap.set(f,t.accessors.length),t.accessors.push(ue),z.push(ue),V.push(new Uint8Array(C.buffer,C.byteOffset,C.byteLength)),J.byteLength+=C.byteLength,J.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const i=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[i.extensions[hh].buffer],f=e.otherBufferViews.get(c)||[],{count:m,byteStride:y,mode:w}=i.extensions[hh],S=gs.concat(o),C=t.encodeGltfBuffer(S,m,y,w),O=gs.pad(C);i.extensions[hh].byteLength=C.byteLength,o.length=0,o.push(O),f.push(O),e.otherBufferViews.set(c,f)}}write(e){let t=0;for(const c in this._encoderBufferViews){const f=this._encoderBufferViews[c],m=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),y=this._encoderBufferViewAccessors[c];for(const C of y)C.bufferView=m;const w=e.jsonDoc.json.bufferViews[m],S=w.byteOffset||0;Object.assign(w,f),w.byteOffset=t,w.extensions[hh].byteOffset=S,t+=gs.padNumber(f.byteLength)}const n=this._encoderFallbackBuffer,i=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[i];return o.byteLength=t,o.extensions={[hh]:{fallback:!0}},n.dispose(),this}}P1.EXTENSION_NAME=hh,P1.EncoderMethod=Xb;const Yb="EXT_texture_avif";class PP{match(e){return e.length>=12&&gs.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=eT(t,0);if(!n)return null;let i=n.end;for(;n=eT(t,i);)if(n.type==="meta")i=n.start+4;else if(n.type==="iprp"||n.type==="ipco")i=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;i=n.end}return null}getChannels(e){return 4}}class ZM extends fa{constructor(...e){super(...e),this.extensionName=Yb,this.prereadTypes=[Ni.TEXTURE]}static register(){ig.registerFormat("image/avif",new PP)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[Yb]&&(t.source=t.extensions[Yb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[Yb]={source:o.source},delete o.source)})}}),this}}function eT(l,e){if(l.byteLength<4+e)return null;const t=l.getUint32(e);return l.byteLength<t+e||t<8?null:{type:gs.decodeText(new Uint8Array(l.buffer,l.byteOffset+e+4,4)),start:e+8,end:e+t}}ZM.EXTENSION_NAME=Yb;const Kb="EXT_texture_webp";class DP{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=gs.decodeText(e.slice(0,4)),n=gs.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const i=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<i.byteLength;){const c=gs.decodeText(new Uint8Array([i.getUint8(o),i.getUint8(o+1),i.getUint8(o+2),i.getUint8(o+3)])),f=i.getUint32(o+4,!0);if(c==="VP8 ")return[16383&i.getInt16(o+14,!0),16383&i.getInt16(o+16,!0)];if(c==="VP8L"){const m=i.getUint8(o+9),y=i.getUint8(o+10),w=i.getUint8(o+11);return[1+((63&y)<<8|m),1+((15&i.getUint8(o+12))<<10|w<<2|(192&y)>>6)]}o+=8+f+f%2}return null}getChannels(e){return 4}}class tT extends fa{constructor(...e){super(...e),this.extensionName=Kb,this.prereadTypes=[Ni.TEXTURE]}static register(){ig.registerFormat("image/webp",new DP)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[Kb]&&(t.source=t.extensions[Kb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const i=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[Kb]={source:o.source},delete o.source)})}}),this}}tT.EXTENSION_NAME=Kb;const nT="KHR_draco_mesh_compression";let sc,iT,rT,id;function OP(l,e){const t=new sc.DecoderBuffer;try{if(t.Init(e,e.length),l.GetEncodedGeometryType(t)!==sc.TRIANGULAR_MESH)throw new Error(`[${nT}] Unknown geometry type.`);const n=new sc.Mesh;if(!l.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${nT}] Decoding failure.`);return n}finally{sc.destroy(t)}}function BP(l,e){const t=3*e.num_faces();let n,i;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=sc._malloc(o),l.GetTrianglesUInt16Array(e,o,n),i=new Uint16Array(sc.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=sc._malloc(o),l.GetTrianglesUInt32Array(e,o,n),i=new Uint32Array(sc.HEAPU32.buffer,n,t).slice()}return sc._free(n),i}function LP(l,e,t,n){const i=rT[n.componentType],o=iT[n.componentType],c=t.num_components(),f=e.num_points()*c,m=f*o.BYTES_PER_ELEMENT,y=sc._malloc(m);l.GetAttributeDataArrayForAllPoints(e,t,i,m,y);const w=new o(sc.HEAPF32.buffer,y,f).slice();return sc._free(y),w}var $b,Gp;(function(l){l[l.EDGEBREAKER=1]="EDGEBREAKER",l[l.SEQUENTIAL=0]="SEQUENTIAL"})($b||($b={})),function(l){l.POSITION="POSITION",l.NORMAL="NORMAL",l.COLOR="COLOR",l.TEX_COORD="TEX_COORD",l.GENERIC="GENERIC"}(Gp||(Gp={}));const sT={[Gp.POSITION]:14,[Gp.NORMAL]:10,[Gp.COLOR]:8,[Gp.TEX_COORD]:12,[Gp.GENERIC]:12},oT={decodeSpeed:5,encodeSpeed:5,method:$b.EDGEBREAKER,quantizationBits:sT,quantizationVolume:"mesh"};function NP(l,e=oT){const t=m0({},oT,e);t.quantizationBits=m0({},sT,e.quantizationBits);const n=new id.Encoder,i=new id.MeshBuilder,o=new id.Mesh,c={},f=new id.DracoInt8Array,m=l.listTargets().length>0;let y=!1;for(const q of l.listSemantics()){const J=l.getAttribute(q);if(J.getSparse()){y=!0;continue}const V=kP(q),z=UP(i,J.getComponentType(),o,id[V],J.getCount(),J.getElementSize(),J.getArray());if(z===-1)throw new Error(`Error compressing "${q}" attribute.`);if(c[q]=z,t.quantizationVolume==="mesh"||q!=="POSITION")n.SetAttributeQuantization(id[V],t.quantizationBits[V]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:ue}=t,me=Math.max(ue.max[0]-ue.min[0],ue.max[1]-ue.min[1],ue.max[2]-ue.min[2]);n.SetAttributeExplicitQuantization(id[V],t.quantizationBits[V],J.getElementSize(),ue.min,me)}}}const w=l.getIndices();if(!w)throw new mw("Primitive must have indices.");i.AddFacesToMesh(o,w.getCount()/3,w.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),n.SetEncodingMethod(t.method===$b.SEQUENTIAL||m||y?id.MESH_SEQUENTIAL_ENCODING:id.MESH_EDGEBREAKER_ENCODING);const S=n.EncodeMeshToDracoBuffer(o,f);if(S<=0)throw new mw("Error applying Draco compression.");const C=new Uint8Array(S);for(let q=0;q<S;++q)C[q]=f.GetValue(q);const O=l.getAttribute("POSITION").getCount(),N=n.GetNumberOfEncodedPoints(),H=3*n.GetNumberOfEncodedFaces();if((m||y)&&N!==O)throw new mw('Compression reduced vertex count unexpectedly, corrupting mesh data. Applying the "weld" function before compression may resolve the issue. See: https://github.com/google/draco/issues/929');return id.destroy(f),id.destroy(o),id.destroy(i),id.destroy(n),{numVertices:N,numIndices:H,data:C,attributeIDs:c}}function kP(l){return l==="POSITION"?Gp.POSITION:l==="NORMAL"?Gp.NORMAL:l.startsWith("COLOR_")?Gp.COLOR:l.startsWith("TEXCOORD_")?Gp.TEX_COORD:Gp.GENERIC}function UP(l,e,t,n,i,o,c){switch(e){case or.ComponentType.UNSIGNED_BYTE:return l.AddUInt8Attribute(t,n,i,o,c);case or.ComponentType.BYTE:return l.AddInt8Attribute(t,n,i,o,c);case or.ComponentType.UNSIGNED_SHORT:return l.AddUInt16Attribute(t,n,i,o,c);case or.ComponentType.SHORT:return l.AddInt16Attribute(t,n,i,o,c);case or.ComponentType.UNSIGNED_INT:return l.AddUInt32Attribute(t,n,i,o,c);case or.ComponentType.FLOAT:return l.AddFloatAttribute(t,n,i,o,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class mw extends Error{}const Sl="KHR_draco_mesh_compression";class Jb extends fa{constructor(...e){super(...e),this.extensionName=Sl,this.prereadTypes=[Ni.PRIMITIVE],this.prewriteTypes=[Ni.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,sc=this._decoderModule,iT={[or.ComponentType.FLOAT]:Float32Array,[or.ComponentType.UNSIGNED_INT]:Uint32Array,[or.ComponentType.UNSIGNED_SHORT]:Uint16Array,[or.ComponentType.UNSIGNED_BYTE]:Uint8Array,[or.ComponentType.SHORT]:Int16Array,[or.ComponentType.BYTE]:Int8Array},rT={[or.ComponentType.FLOAT]:sc.DT_FLOAT32,[or.ComponentType.UNSIGNED_INT]:sc.DT_UINT32,[or.ComponentType.UNSIGNED_SHORT]:sc.DT_UINT16,[or.ComponentType.UNSIGNED_BYTE]:sc.DT_UINT8,[or.ComponentType.SHORT]:sc.DT_INT16,[or.ComponentType.BYTE]:sc.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,id=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Sl}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,i=new Map;try{const o=n.json.meshes||[];for(const c of o)for(const f of c.primitives){if(!f.extensions||!f.extensions[Sl])continue;const m=f.extensions[Sl];let[y,w]=i.get(m.bufferView)||[];if(!w||!y){const S=n.json.bufferViews[m.bufferView],C=n.json.buffers[S.buffer],O=gs.toView(C.uri?n.resources[C.uri]:n.resources[RM],S.byteOffset||0,S.byteLength);y=new this._decoderModule.Decoder,w=OP(y,O),i.set(m.bufferView,[y,w]),t.debug(`[${Sl}] Decompressed ${O.byteLength} bytes.`)}for(const S in f.attributes){const C=e.jsonDoc.json.accessors[f.attributes[S]],O=y.GetAttributeByUniqueId(w,m.attributes[S]),N=LP(y,w,O,C);e.accessors[f.attributes[S]].setArray(N)}f.indices!==void 0&&e.accessors[f.indices].setArray(BP(y,w))}}finally{for(const[o,c]of Array.from(i.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Sl}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Sl}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const i=function(f){const m=f.getLogger(),y=new Set,w=new Set;for(const q of f.getRoot().listMeshes())for(const J of q.listPrimitives())J.getIndices()?J.getMode()!==wy.Mode.TRIANGLES?(w.add(J),m.warn(`[${Sl}] Skipping Draco compression on non-TRIANGLES primitive.`)):y.add(J):(w.add(J),m.warn(`[${Sl}] Skipping Draco compression on non-indexed primitive.`));const S=f.getRoot().listAccessors(),C=new Map;for(let q=0;q<S.length;q++)C.set(S[q],q);const O=new Map,N=new Set,H=new Map;for(const q of Array.from(y)){let J=aT(q,C);if(N.has(J))H.set(q,J);else{if(O.has(q.getIndices())){const V=q.getIndices(),z=V.clone();C.set(z,f.getRoot().listAccessors().length-1),q.swap(V,z)}for(const V of q.listAttributes())if(O.has(V)){const z=V.clone();C.set(z,f.getRoot().listAccessors().length-1),q.swap(V,z)}J=aT(q,C),N.add(J),H.set(q,J),O.set(q.getIndices(),J);for(const V of q.listAttributes())O.set(V,J)}}for(const q of Array.from(O.keys())){const J=new Set(q.listParents().map(V=>V.propertyType));if(J.size!==2||!J.has(Ni.PRIMITIVE)||!J.has(Ni.ROOT))throw new Error(`[${Sl}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const q of Array.from(y)){const J=H.get(q),V=q.getIndices();if(O.get(V)!==J||q.listAttributes().some(z=>O.get(z)!==J))throw new Error(`[${Sl}] Draco primitives must share all, or no, accessors.`)}for(const q of Array.from(w)){const J=q.getIndices();if(O.has(J)||q.listAttributes().some(V=>O.has(V)))throw new Error(`[${Sl}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return H}(this.document),o=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Sl}]: quantizationVolume=scene requires exactly 1 scene.`):c=function(f){const m={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},y=f.propertyType===Ni.NODE?[f]:f.listChildren();for(const w of y)w.traverse(S=>{const C=S.getMesh();if(!C)return;const O=lP(C,S.getWorldMatrix());M1(O.min,m),M1(O.max,m)});return m}(this.document.getRoot().listScenes().pop()));for(const f of Array.from(i.keys())){const m=i.get(f);if(!m)throw new Error("Unexpected primitive.");if(o.has(m)){o.set(m,o.get(m));continue}const y=f.getIndices(),w=e.jsonDoc.json.accessors;let S;try{S=NP(f,m0({},this._encoderOptions,{quantizationVolume:c}))}catch(N){if(N instanceof mw){n.warn(`[${Sl}]: ${N.message} Skipping primitive compression.`);continue}throw N}o.set(m,S);const C=e.createAccessorDef(y);C.count=S.numIndices,e.accessorIndexMap.set(y,w.length),w.push(C);for(const N of f.listSemantics()){const H=f.getAttribute(N);if(S.attributeIDs[N]===void 0)continue;const q=e.createAccessorDef(H);q.count=S.numVertices,e.accessorIndexMap.set(H,w.length),w.push(q)}const O=f.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(O)||e.otherBufferViews.set(O,[]),e.otherBufferViews.get(O).push(S.data)}return n.debug(`[${Sl}] Compressed ${i.size} primitives.`),e.extensionData[Sl]={primitiveHashMap:i,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Sl];for(const n of this.document.getRoot().listMeshes()){const i=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const c=n.listPrimitives()[o],f=i.primitives[o],m=t.primitiveHashMap.get(c);if(!m)continue;const y=t.primitiveEncodingMap.get(m);y&&(f.extensions=f.extensions||{},f.extensions[Sl]={bufferView:e.otherBufferViewsIndexMap.get(y.data),attributes:y.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(i=>i!==Sl),n.extensionsRequired=(n.extensionsRequired||[]).filter(i=>i!==Sl)}return this}}function aT(l,e){const t=[],n=l.getIndices();t.push(e.get(n));for(const i of l.listAttributes())t.push(e.get(i));return t.sort().join("|")}Jb.EXTENSION_NAME=Sl,Jb.EncoderMethod=$b;class WA extends tl{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Ni.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:WA.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return td.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return td.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}WA.EXTENSION_NAME="KHR_lights_punctual",WA.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const sg="KHR_lights_punctual";class lT extends fa{constructor(...e){super(...e),this.extensionName=sg}createLight(e=""){return new WA(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[sg])return this;const n=(t.json.extensions[sg].lights||[]).map(i=>{var o,c;const f=this.createLight().setName(i.name||"").setType(i.type);return i.color!==void 0&&f.setColor(i.color),i.intensity!==void 0&&f.setIntensity(i.intensity),i.range!==void 0&&f.setRange(i.range),((o=i.spot)==null?void 0:o.innerConeAngle)!==void 0&&f.setInnerConeAngle(i.spot.innerConeAngle),((c=i.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(i.spot.outerConeAngle),f});return t.json.nodes.forEach((i,o)=>{i.extensions&&i.extensions[sg]&&e.nodes[o].setExtension(sg,n[i.extensions[sg].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],i=new Map;for(const o of this.properties){const c=o,f={type:c.getType()};na.eq(c.getColor(),[1,1,1])||(f.color=c.getColor()),c.getIntensity()!==1&&(f.intensity=c.getIntensity()),c.getRange()!=null&&(f.range=c.getRange()),c.getName()&&(f.name=c.getName()),c.getType()===WA.Type.SPOT&&(f.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(f),i.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const c=o.getExtension(sg);if(c){const f=e.nodeIndexMap.get(o),m=t.json.nodes[f];m.extensions=m.extensions||{},m.extensions[sg]={light:i.get(c)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[sg]={lights:n},this}}lT.EXTENSION_NAME=sg;const{R:FP,G:zP}=Ua;class cT extends tl{init(){this.extensionName="KHR_materials_anisotropy",this.propertyType="Anisotropy",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new ia(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:FP|zP})}}cT.EXTENSION_NAME="KHR_materials_anisotropy";const Sy="KHR_materials_anisotropy";class uT extends fa{constructor(...e){super(...e),this.extensionName=Sy}createAnisotropy(){return new cT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Sy]){const c=this.createAnisotropy();e.materials[o].setExtension(Sy,c);const f=i.extensions[Sy];if(f.anisotropyStrength!==void 0&&c.setAnisotropyStrength(f.anisotropyStrength),f.anisotropyRotation!==void 0&&c.setAnisotropyRotation(f.anisotropyRotation),f.anisotropyTexture!==void 0){const m=f.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Sy);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Sy]={};if(i.getAnisotropyStrength()>0&&(f.anisotropyStrength=i.getAnisotropyStrength()),i.getAnisotropyRotation()!==0&&(f.anisotropyRotation=i.getAnisotropyRotation()),i.getAnisotropyTexture()){const m=i.getAnisotropyTexture(),y=i.getAnisotropyTextureInfo();f.anisotropyTexture=e.createTextureInfoDef(m,y)}}}),this}}uT.EXTENSION_NAME=Sy;const{R:hT,G:dT,B:jP}=Ua;class pT extends tl{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new ia(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new ia(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new ia(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:hT})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:dT})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:hT|dT|jP})}}pT.EXTENSION_NAME="KHR_materials_clearcoat";const My="KHR_materials_clearcoat";class fT extends fa{constructor(...e){super(...e),this.extensionName=My}createClearcoat(){return new pT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[My]){const c=this.createClearcoat();e.materials[o].setExtension(My,c);const f=i.extensions[My];if(f.clearcoatFactor!==void 0&&c.setClearcoatFactor(f.clearcoatFactor),f.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(f.clearcoatRoughnessFactor),f.clearcoatTexture!==void 0){const m=f.clearcoatTexture;c.setClearcoatTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),m)}if(f.clearcoatRoughnessTexture!==void 0){const m=f.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),m)}if(f.clearcoatNormalTexture!==void 0){const m=f.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),m),m.scale!==void 0&&c.setClearcoatNormalScale(m.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(My);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[My]={clearcoatFactor:i.getClearcoatFactor(),clearcoatRoughnessFactor:i.getClearcoatRoughnessFactor()};if(i.getClearcoatTexture()){const m=i.getClearcoatTexture(),y=i.getClearcoatTextureInfo();f.clearcoatTexture=e.createTextureInfoDef(m,y)}if(i.getClearcoatRoughnessTexture()){const m=i.getClearcoatRoughnessTexture(),y=i.getClearcoatRoughnessTextureInfo();f.clearcoatRoughnessTexture=e.createTextureInfoDef(m,y)}if(i.getClearcoatNormalTexture()){const m=i.getClearcoatNormalTexture(),y=i.getClearcoatNormalTextureInfo();f.clearcoatNormalTexture=e.createTextureInfoDef(m,y),i.getClearcoatNormalScale()!==1&&(f.clearcoatNormalTexture.scale=i.getClearcoatNormalScale())}}}),this}}fT.EXTENSION_NAME=My;class mT extends tl{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}mT.EXTENSION_NAME="KHR_materials_emissive_strength";const Ty="KHR_materials_emissive_strength";class gT extends fa{constructor(...e){super(...e),this.extensionName=Ty}createEmissiveStrength(){return new mT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Ty]){const i=this.createEmissiveStrength();e.materials[n].setExtension(Ty,i);const o=t.extensions[Ty];o.emissiveStrength!==void 0&&i.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ty);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{},c.extensions[Ty]={emissiveStrength:i.getEmissiveStrength()}}}),this}}gT.EXTENSION_NAME=Ty;class _T extends tl{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}_T.EXTENSION_NAME="KHR_materials_ior";const Cy="KHR_materials_ior";class vT extends fa{constructor(...e){super(...e),this.extensionName=Cy}createIOR(){return new _T(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Cy]){const i=this.createIOR();e.materials[n].setExtension(Cy,i);const o=t.extensions[Cy];o.ior!==void 0&&i.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Cy);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{},c.extensions[Cy]={ior:i.getIOR()}}}),this}}vT.EXTENSION_NAME=Cy;const{R:VP,G:GP}=Ua;class yT extends tl{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new ia(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new ia(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:VP})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:GP})}}yT.EXTENSION_NAME="KHR_materials_iridescence";const Ry="KHR_materials_iridescence";class AT extends fa{constructor(...e){super(...e),this.extensionName=Ry}createIridescence(){return new yT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Ry]){const c=this.createIridescence();e.materials[o].setExtension(Ry,c);const f=i.extensions[Ry];if(f.iridescenceFactor!==void 0&&c.setIridescenceFactor(f.iridescenceFactor),f.iridescenceIor!==void 0&&c.setIridescenceIOR(f.iridescenceIor),f.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(f.iridescenceThicknessMaximum),f.iridescenceTexture!==void 0){const m=f.iridescenceTexture;c.setIridescenceTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),m)}if(f.iridescenceThicknessTexture!==void 0){const m=f.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Ry);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Ry]={};if(i.getIridescenceFactor()>0&&(f.iridescenceFactor=i.getIridescenceFactor()),i.getIridescenceIOR()!==1.3&&(f.iridescenceIor=i.getIridescenceIOR()),i.getIridescenceThicknessMinimum()!==100&&(f.iridescenceThicknessMinimum=i.getIridescenceThicknessMinimum()),i.getIridescenceThicknessMaximum()!==400&&(f.iridescenceThicknessMaximum=i.getIridescenceThicknessMaximum()),i.getIridescenceTexture()){const m=i.getIridescenceTexture(),y=i.getIridescenceTextureInfo();f.iridescenceTexture=e.createTextureInfoDef(m,y)}if(i.getIridescenceThicknessTexture()){const m=i.getIridescenceThicknessTexture(),y=i.getIridescenceThicknessTextureInfo();f.iridescenceThicknessTexture=e.createTextureInfoDef(m,y)}}}),this}}AT.EXTENSION_NAME=Ry;const{R:bT,G:xT,B:wT,A:ET}=Ua;class ST extends tl{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new ia(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new ia(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return td.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(td.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:bT|xT|wT|ET})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:bT|xT|wT|ET})}}ST.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const Iy="KHR_materials_pbrSpecularGlossiness";class MT extends fa{constructor(...e){super(...e),this.extensionName=Iy}createPBRSpecularGlossiness(){return new ST(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Iy]){const c=this.createPBRSpecularGlossiness();e.materials[o].setExtension(Iy,c);const f=i.extensions[Iy];if(f.diffuseFactor!==void 0&&c.setDiffuseFactor(f.diffuseFactor),f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.glossinessFactor!==void 0&&c.setGlossinessFactor(f.glossinessFactor),f.diffuseTexture!==void 0){const m=f.diffuseTexture;c.setDiffuseTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),m)}if(f.specularGlossinessTexture!==void 0){const m=f.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Iy);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Iy]={diffuseFactor:i.getDiffuseFactor(),specularFactor:i.getSpecularFactor(),glossinessFactor:i.getGlossinessFactor()};if(i.getDiffuseTexture()){const m=i.getDiffuseTexture(),y=i.getDiffuseTextureInfo();f.diffuseTexture=e.createTextureInfoDef(m,y)}if(i.getSpecularGlossinessTexture()){const m=i.getSpecularGlossinessTexture(),y=i.getSpecularGlossinessTextureInfo();f.specularGlossinessTexture=e.createTextureInfoDef(m,y)}}}),this}}MT.EXTENSION_NAME=Iy;const{R:HP,G:WP,B:QP,A:qP}=Ua;class TT extends tl{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new ia(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new ia(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return td.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",td.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:HP|WP|QP})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:qP})}}TT.EXTENSION_NAME="KHR_materials_sheen";const Py="KHR_materials_sheen";class CT extends fa{constructor(...e){super(...e),this.extensionName=Py}createSheen(){return new TT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Py]){const c=this.createSheen();e.materials[o].setExtension(Py,c);const f=i.extensions[Py];if(f.sheenColorFactor!==void 0&&c.setSheenColorFactor(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(f.sheenRoughnessFactor),f.sheenColorTexture!==void 0){const m=f.sheenColorTexture;c.setSheenColorTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),m)}if(f.sheenRoughnessTexture!==void 0){const m=f.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Py);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Py]={sheenColorFactor:i.getSheenColorFactor(),sheenRoughnessFactor:i.getSheenRoughnessFactor()};if(i.getSheenColorTexture()){const m=i.getSheenColorTexture(),y=i.getSheenColorTextureInfo();f.sheenColorTexture=e.createTextureInfoDef(m,y)}if(i.getSheenRoughnessTexture()){const m=i.getSheenRoughnessTexture(),y=i.getSheenRoughnessTextureInfo();f.sheenRoughnessTexture=e.createTextureInfoDef(m,y)}}}),this}}CT.EXTENSION_NAME=Py;const{R:XP,G:YP,B:KP,A:$P}=Ua;class RT extends tl{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new ia(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new ia(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return td.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",td.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:$P})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:XP|YP|KP})}}RT.EXTENSION_NAME="KHR_materials_specular";const Dy="KHR_materials_specular";class IT extends fa{constructor(...e){super(...e),this.extensionName=Dy}createSpecular(){return new RT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Dy]){const c=this.createSpecular();e.materials[o].setExtension(Dy,c);const f=i.extensions[Dy];if(f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.specularColorFactor!==void 0&&c.setSpecularColorFactor(f.specularColorFactor),f.specularTexture!==void 0){const m=f.specularTexture;c.setSpecularTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),m)}if(f.specularColorTexture!==void 0){const m=f.specularColorTexture;c.setSpecularColorTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Dy);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Dy]={};if(i.getSpecularFactor()!==1&&(f.specularFactor=i.getSpecularFactor()),na.eq(i.getSpecularColorFactor(),[1,1,1])||(f.specularColorFactor=i.getSpecularColorFactor()),i.getSpecularTexture()){const m=i.getSpecularTexture(),y=i.getSpecularTextureInfo();f.specularTexture=e.createTextureInfoDef(m,y)}if(i.getSpecularColorTexture()){const m=i.getSpecularColorTexture(),y=i.getSpecularColorTextureInfo();f.specularColorTexture=e.createTextureInfoDef(m,y)}}}),this}}IT.EXTENSION_NAME=Dy;const{R:JP}=Ua;class PT extends tl{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new ia(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:JP})}}PT.EXTENSION_NAME="KHR_materials_transmission";const Oy="KHR_materials_transmission";class DT extends fa{constructor(...e){super(...e),this.extensionName=Oy}createTransmission(){return new PT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[Oy]){const c=this.createTransmission();e.materials[o].setExtension(Oy,c);const f=i.extensions[Oy];if(f.transmissionFactor!==void 0&&c.setTransmissionFactor(f.transmissionFactor),f.transmissionTexture!==void 0){const m=f.transmissionTexture;c.setTransmissionTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(Oy);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[Oy]={transmissionFactor:i.getTransmissionFactor()};if(i.getTransmissionTexture()){const m=i.getTransmissionTexture(),y=i.getTransmissionTextureInfo();f.transmissionTexture=e.createTextureInfoDef(m,y)}}}),this}}DT.EXTENSION_NAME=Oy;class OT extends tl{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Ni.MATERIAL]}}OT.EXTENSION_NAME="KHR_materials_unlit";const QA="KHR_materials_unlit";class BT extends fa{constructor(...e){super(...e),this.extensionName=QA}createUnlit(){return new OT(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[QA]&&e.materials[n].setExtension(QA,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(QA)){const i=e.materialIndexMap.get(n),o=t.json.materials[i];o.extensions=o.extensions||{},o.extensions[QA]={}}}),this}}BT.EXTENSION_NAME=QA;class LT extends tl{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}LT.EXTENSION_NAME="KHR_materials_variants";class NT extends tl{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Ni.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}NT.EXTENSION_NAME="KHR_materials_variants";class D1 extends tl{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}D1.EXTENSION_NAME="KHR_materials_variants";const og="KHR_materials_variants";class kT extends fa{constructor(...e){super(...e),this.extensionName=og}createMappingList(){return new NT(this.document.getGraph())}createVariant(e=""){return new D1(this.document.getGraph(),e)}createMapping(){return new LT(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof D1)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[og])return this;const n=(t.json.extensions[og].variants||[]).map(i=>this.createVariant().setName(i.name||""));return(t.json.meshes||[]).forEach((i,o)=>{const c=e.meshes[o];(i.primitives||[]).forEach((f,m)=>{if(!f.extensions||!f.extensions[og])return;const y=this.createMappingList(),w=f.extensions[og];for(const S of w.mappings){const C=this.createMapping();S.material!==void 0&&C.setMaterial(e.materials[S.material]);for(const O of S.variants||[])C.addVariant(n[O]);y.addMapping(C)}c.listPrimitives()[m].setExtension(og,y)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const i=[],o=new Map;for(const c of n)o.set(c,i.length),i.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const f=e.meshIndexMap.get(c);c.listPrimitives().forEach((m,y)=>{const w=m.getExtension(og);if(!w)return;const S=e.jsonDoc.json.meshes[f].primitives[y],C=w.listMappings().map(O=>{const N=e.createPropertyDef(O),H=O.getMaterial();return H&&(N.material=e.materialIndexMap.get(H)),N.variants=O.listVariants().map(q=>o.get(q)),N});S.extensions=S.extensions||{},S.extensions[og]={mappings:C}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[og]={variants:i},this}}kT.EXTENSION_NAME=og;const{G:ZP}=Ua;class UT extends tl{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Ni.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new ia(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:ZP})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return td.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",td.hexToFactor(e,t))}}UT.EXTENSION_NAME="KHR_materials_volume";const By="KHR_materials_volume";class FT extends fa{constructor(...e){super(...e),this.extensionName=By}createVolume(){return new UT(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((i,o)=>{if(i.extensions&&i.extensions[By]){const c=this.createVolume();e.materials[o].setExtension(By,c);const f=i.extensions[By];if(f.thicknessFactor!==void 0&&c.setThicknessFactor(f.thicknessFactor),f.attenuationDistance!==void 0&&c.setAttenuationDistance(f.attenuationDistance),f.attenuationColor!==void 0&&c.setAttenuationColor(f.attenuationColor),f.thicknessTexture!==void 0){const m=f.thicknessTexture;c.setThicknessTexture(e.textures[n[m.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),m)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(By);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f=c.extensions[By]={};if(i.getThicknessFactor()>0&&(f.thicknessFactor=i.getThicknessFactor()),Number.isFinite(i.getAttenuationDistance())&&(f.attenuationDistance=i.getAttenuationDistance()),na.eq(i.getAttenuationColor(),[1,1,1])||(f.attenuationColor=i.getAttenuationColor()),i.getThicknessTexture()){const m=i.getThicknessTexture(),y=i.getThicknessTextureInfo();f.thicknessTexture=e.createTextureInfoDef(m,y)}}}),this}}FT.EXTENSION_NAME=By;const zT="KHR_mesh_quantization";class jT extends fa{constructor(...e){super(...e),this.extensionName=zT}read(e){return this}write(e){return this}}jT.EXTENSION_NAME=zT;const Zb="KHR_texture_basisu";class eD{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=R1(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=R1(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=R1(e),n=this.getChannels(e)>3;let i=0;for(let o=0;o<t.levels.length;o++){const c=t.levels[o];i+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return i}}class VT extends fa{constructor(...e){super(...e),this.extensionName=Zb,this.prereadTypes=[Ni.TEXTURE]}static register(){ig.registerFormat("image/ktx2",new eD)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[Zb]&&(t.source=t.extensions[Zb].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const i=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===i&&(o.extensions=o.extensions||{},o.extensions[Zb]={source:o.source},delete o.source)})}}),this}}VT.EXTENSION_NAME=Zb;class GT extends tl{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Ni.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}GT.EXTENSION_NAME="KHR_texture_transform";const Ly="KHR_texture_transform";class HT extends fa{constructor(...e){super(...e),this.extensionName=Ly}createTransform(){return new GT(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Ly])continue;const i=this.createTransform(),o=n.extensions[Ly];o.offset!==void 0&&i.setOffset(o.offset),o.rotation!==void 0&&i.setRotation(o.rotation),o.scale!==void 0&&i.setScale(o.scale),o.texCoord!==void 0&&i.setTexCoord(o.texCoord),t.setExtension(Ly,i)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,i]of t){const o=n.getExtension(Ly);if(!o)continue;i.extensions=i.extensions||{};const c={},f=na.eq;f(o.getOffset(),[0,0])||(c.offset=o.getOffset()),o.getRotation()!==0&&(c.rotation=o.getRotation()),f(o.getScale(),[1,1])||(c.scale=o.getScale()),o.getTexCoord()!=null&&(c.texCoord=o.getTexCoord()),i.extensions[Ly]=c}return this}}HT.EXTENSION_NAME=Ly;const tD=[Ni.ROOT,Ni.SCENE,Ni.NODE,Ni.MESH,Ni.MATERIAL,Ni.TEXTURE,Ni.ANIMATION];class WT extends tl{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=tD}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",m0({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=m0({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return m0({"@context":O1(this.get("context"))},O1(this.get("properties")))}fromJSONLD(e){const t=(e=O1(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function O1(l){return JSON.parse(JSON.stringify(l))}WT.EXTENSION_NAME="KHR_xmp_json_ld";const U_="KHR_xmp_json_ld";class QT extends fa{constructor(...e){super(...e),this.extensionName=U_}createPacket(){return new WT(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[U_];if(!n||!n.packets)return this;const i=e.jsonDoc.json,o=this.document.getRoot(),c=n.packets.map(y=>this.createPacket().fromJSONLD(y)),f=[[i.asset],i.scenes,i.nodes,i.meshes,i.materials,i.images,i.animations],m=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let y=0;y<f.length;y++){const w=f[y]||[];for(let S=0;S<w.length;S++){const C=w[S];C.extensions&&C.extensions[U_]&&m[y][S].setExtension(U_,c[C.extensions[U_].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const i of this.properties){n.push(i.toJSONLD());for(const o of i.listParents()){let c;switch(o.propertyType){case Ni.ROOT:c=t.asset;break;case Ni.SCENE:c=t.scenes[e.sceneIndexMap.get(o)];break;case Ni.NODE:c=t.nodes[e.nodeIndexMap.get(o)];break;case Ni.MESH:c=t.meshes[e.meshIndexMap.get(o)];break;case Ni.MATERIAL:c=t.materials[e.materialIndexMap.get(o)];break;case Ni.TEXTURE:c=t.images[e.imageIndexMap.get(o)];break;case Ni.ANIMATION:c=t.animations[e.animationIndexMap.get(o)];break;default:c=null,this.document.getLogger().warn(`[${U_}]: Unsupported parent property, "${o.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[U_]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[U_]={packets:n}),this}}QT.EXTENSION_NAME=U_;const nD=[XM,P1,ZM,tT,Jb,lT,uT,fT,gT,vT,AT,MT,IT,CT,DT,BT,kT,FT,jT,VT,HT,QT];class qT extends _1{constructor(e){super(),this._loadedLibs=!1,e=e||{method:Jb.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new wP().registerExtensions(nD).registerExtensions([XT,bw,_w,vw,yw,xw,ww,Ew,Sw,Mw,Tw,Cw,Rw,Pw,Iw,Dw,Aw]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,dracoOptions:n,...i}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,i);await this._loadLibs();const o={...i};t&&(o.externalImagesInExtras=!0);const c=await new Promise((C,O)=>this.parse(e,C,O,o)),f=await super.parseAsync(c,o);if(!t)return f;if(!c)throw new Error("GLTFDracoExporter: gltf is null");let m=c;const y=m.byteLength||1/0,w=await(typeof m!="object"||m.byteLength?this._io.readBinary(new Uint8Array(m)):this._io.readJSON({json:m,resources:{}}));if(w.createExtension(Jb).setRequired(!0).setEncoderOptions({...this._encoderOptions,...n??{}}),o.exportExt==="glb")m=await this._io.writeBinary(w),isFinite(y)&&console.log("DRACO Compression ratio: "+(m.byteLength/y).toFixed(5));else{const C=await this._io.writeJSON(w);m=C.json,Object.values(C.resources).filter(O=>O).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),m.resources=C.resources)}m.__isGLTFOutput=!0;const S=await super.parseAsync(m,o);if(!S)throw new Error("GLTFDracoExporter: blob is null");return S.ext="glb",S.__uncompressed=f,S}}class B1 extends Ri{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[fi,f0]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer,n=e.getManager().exporter;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(i,o,c){v1(i,o,qT,f=>{const m=ji()+".drc",y=f;y.loader=c.registerFile(m),y.loader.setDecoderConfig({type:"js"}),y.loader.preload(!0,!0)})})(n,e,t)}}B1.PluginType="GLTFDracoExportPlugin";class iD extends tl{constructor(){super(...arguments),this.extensionName=Vr,this.parentTypes=[Ni.SCENE],this.propertyType="ViewerJSON"}init(){}}class XT extends fa{constructor(){super(...arguments),this.extensionName=Vr,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)==null||t.forEach((n,i)=>{if(n.extensions&&n.extensions[Vr]){const o=new iD(this.document.getGraph());e.scenes[i].setExtension(Vr,o),this._viewerConfig=n.extensions[Vr]}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(Vr)){const i=(n=e.jsonDoc.json.scenes)==null?void 0:n[e.jsonDoc.json.scene||0];i&&Object.keys(this._viewerConfig).length>0&&(i.extensions=i.extensions||{},i.extensions[Vr]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}XT.EXTENSION_NAME=Vr;class gw extends tl{addTexture(e,t,n,i=4369){this.setRef(e,n,{channels:i}),this.textures[e]=[t,n]}constructor(e,t,n){super(e,t),this.parentTypes=[Ni.MATERIAL,Ni.MESH,Ni.NODE,Ni.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}init(){}}class Fu extends fa{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],i=t.json.textures||[];return n.forEach((o,c)=>{var f;if(o.extensions&&o.extensions[this.extensionName]){const m=new gw(this.document.getGraph(),"",this.extensionName);e.materials[c].setExtension(this.extensionName,m);const y={...o.extensions[this.extensionName]};for(const[w,S]of Object.entries(y))if(typeof(S==null?void 0:S.index)=="number"){const C=S,O=(f=i[C.index])==null?void 0:f.source;if(typeof O!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",C);continue}const N=e.textures[O],H=new ia(this.document.getGraph()),q=this.textureChannels[w]??4369;m.addTexture(w,H,N,q),e.setTextureInfo(H,C),delete y[w]}m.setExtras(y)}}),(t.json.meshes||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[this.extensionName]){const f=new gw(this.document.getGraph(),"",this.extensionName);e.meshes[c].setExtension(this.extensionName,f);const m=o.extensions[this.extensionName];f.setExtras(m)}}),(t.json.nodes||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[this.extensionName]){const f=new gw(this.document.getGraph(),"",this.extensionName);e.nodes[c].setExtension(this.extensionName,f);const m=o.extensions[this.extensionName];f.setExtras(m)}}),(t.json.scenes||[]).forEach((o,c)=>{if(o.extensions&&o.extensions[this.extensionName]){const f=new gw(this.document.getGraph(),"",this.extensionName);e.scenes[c].setExtension(this.extensionName,f);const m=o.extensions[this.extensionName];f.setExtras(m)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.materialIndexMap.get(n),c=t.json.materials[o];c.extensions=c.extensions||{};const f={...i.getExtras()};for(const[m,y]of Object.entries(i.textures)){const w=y[0],S=y[1];S&&(f[m]=e.createTextureInfoDef(S,w))}c.extensions[this.extensionName]=f}}),this.document.getRoot().listMeshes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.meshIndexMap.get(n),c=t.json.meshes[o];c.extensions=c.extensions||{},c.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.nodeIndexMap.get(n),c=t.json.nodes[o];c.extensions=c.extensions||{},c.extensions[this.extensionName]=i.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const i=n.getExtension(this.extensionName);if(i){const o=e.jsonDoc.json.scene||0,c=t.json.scenes[o];if(!c)return;c.extensions=c.extensions||{},c.extensions[this.extensionName]=i.getExtras()}}),this}}class _w extends Fu{constructor(){super(...arguments),this.extensionName=_w.EXTENSION_NAME,this.textureChannels={bumpTexture:Ua.R}}}_w.EXTENSION_NAME=pd;class vw extends Fu{constructor(){super(...arguments),this.extensionName=vw.EXTENSION_NAME,this.textureChannels={lightMapTexture:Ua.R|Ua.G|Ua.B}}}vw.EXTENSION_NAME=fc;class yw extends Fu{constructor(){super(...arguments),this.extensionName=yw.EXTENSION_NAME,this.textureChannels={alphaTexture:Ua.G}}}yw.EXTENSION_NAME=Ql;class Aw extends Fu{constructor(){super(...arguments),this.extensionName=Aw.EXTENSION_NAME,this.textureChannels={displacementTexture:Ua.R}}}Aw.EXTENSION_NAME=_u;class bw extends Fu{constructor(){super(...arguments),this.extensionName=bw.EXTENSION_NAME}}bw.EXTENSION_NAME=Fs.DIAMOND_GLTF_EXTENSION;class xw extends Fu{constructor(){super(...arguments),this.extensionName=xw.EXTENSION_NAME}}xw.EXTENSION_NAME=Ws.AnimationMarkersExtension;class ww extends Fu{constructor(){super(...arguments),this.extensionName=ww.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Ua.R|Ua.G|Ua.B}}}ww.EXTENSION_NAME=Na.ANISOTROPY_GLTF_EXTENSION;class Ew extends Fu{constructor(){super(...arguments),this.extensionName=Ew.EXTENSION_NAME,this.textureChannels={customBumpMap:Ua.R|Ua.G|Ua.B}}}Ew.EXTENSION_NAME=Ll.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class Sw extends Fu{constructor(){super(...arguments),this.extensionName=Sw.EXTENSION_NAME}}Sw.EXTENSION_NAME=pc;class Mw extends Fu{constructor(){super(...arguments),this.extensionName=Mw.EXTENSION_NAME}}Mw.EXTENSION_NAME=jc;class Tw extends Fu{constructor(){super(...arguments),this.extensionName=Tw.EXTENSION_NAME}}Tw.EXTENSION_NAME=ko;class Cw extends Fu{constructor(){super(...arguments),this.extensionName=Cw.EXTENSION_NAME}}Cw.EXTENSION_NAME=zl.CLEARCOAT_TINT_GLTF_EXTENSION;class Rw extends Fu{constructor(){super(...arguments),this.extensionName=Rw.EXTENSION_NAME}}Rw.EXTENSION_NAME=Ec.THIN_FILM_LAYER_GLTF_EXTENSION;class Iw extends Fu{constructor(){super(...arguments),this.extensionName=Iw.EXTENSION_NAME}}Iw.EXTENSION_NAME=Nu.TRIPLANAR_GLTF_EXTENSION;class Pw extends Fu{constructor(){super(...arguments),this.extensionName=Pw.EXTENSION_NAME}}Pw.EXTENSION_NAME=Lu.SSBEVEL_GLTF_EXTENSION;class Dw extends Fu{constructor(){super(...arguments),this.extensionName=Dw.EXTENSION_NAME}}Dw.EXTENSION_NAME=yl.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class YT extends a.SimpleEventDispatcher{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}YT.PluginType="PMREMGenerator";const KT=new s.Pa4,rD=new s._fP,$T=new s.Pa4;class sD extends s.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const ag=new s.yGw,oD=new s.yGw;class aD{constructor(e={}){const t=this;let n,i,o,c;const f={camera:{fov:0,style:""},objects:new WeakMap},m=e.element!==void 0?e.element:document.createElement("div");m.style.overflow="hidden",this.domElement=m;const y=document.createElement("div");y.style.transformOrigin="0 0",y.style.pointerEvents="none",m.appendChild(y);const w=document.createElement("div");function S(H){return Math.abs(H)<1e-10?0:H}function C(H){const q=H.elements;return"matrix3d("+S(q[0])+","+S(-q[1])+","+S(q[2])+","+S(q[3])+","+S(q[4])+","+S(-q[5])+","+S(q[6])+","+S(q[7])+","+S(q[8])+","+S(-q[9])+","+S(q[10])+","+S(q[11])+","+S(q[12])+","+S(-q[13])+","+S(q[14])+","+S(q[15])+")"}function O(H){const q=H.elements;return"translate(-50%,-50%)matrix3d("+S(q[0])+","+S(q[1])+","+S(q[2])+","+S(q[3])+","+S(-q[4])+","+S(-q[5])+","+S(-q[6])+","+S(-q[7])+","+S(q[8])+","+S(q[9])+","+S(q[10])+","+S(q[11])+","+S(q[12])+","+S(q[13])+","+S(q[14])+","+S(q[15])+")"}function N(H,q,J,V){if(H.isCSS3DObject){const z=H.visible===!0&&H.layers.test(J.layers)===!0;if(H.element.style.display=z===!0?"":"none",z===!0){let ue;H.onBeforeRender(t,q,J),H.isCSS3DSprite?(ag.copy(J.matrixWorldInverse),ag.transpose(),H.rotation2D!==0&&ag.multiply(oD.makeRotationZ(H.rotation2D)),H.matrixWorld.decompose(KT,rD,$T),ag.setPosition(KT),ag.scale($T),ag.elements[3]=0,ag.elements[7]=0,ag.elements[11]=0,ag.elements[15]=1,ue=O(ag)):ue=O(H.matrixWorld);const me=H.element,Te=f.objects.get(H);if(Te===void 0||Te.style!==ue){me.style.transform=ue;const Be={style:ue};f.objects.set(H,Be)}me.parentNode!==w&&w.appendChild(me),H.onAfterRender(t,q,J)}}for(let z=0,ue=H.children.length;z<ue;z++)N(H.children[z],q,J)}w.style.transformStyle="preserve-3d",y.appendChild(w),this.getSize=function(){return{width:n,height:i}},this.render=function(H,q){const J=q.projectionMatrix.elements[5]*c;let V,z;f.camera.fov!==J&&(y.style.perspective=q.isPerspectiveCamera?J+"px":"",f.camera.fov=J),q.view&&q.view.enabled?(y.style.transform=`translate( ${-q.view.offsetX*(n/q.view.width)}px, ${-q.view.offsetY*(i/q.view.height)}px )`,y.style.transform+=`scale( ${q.view.fullWidth/q.view.width}, ${q.view.fullHeight/q.view.height} )`):y.style.transform="",H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),q.parent===null&&q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),q.isOrthographicCamera&&(V=-(q.right+q.left)/2,z=(q.top+q.bottom)/2);const ue=q.view&&q.view.enabled?q.view.height/q.view.fullHeight:1,me=q.isOrthographicCamera?`scale( ${ue} )scale(`+J+")translate("+S(V)+"px,"+S(z)+"px)"+C(q.matrixWorldInverse):`scale( ${ue} )translateZ(`+J+"px)"+C(q.matrixWorldInverse),Te=me+"translate("+o+"px,"+c+"px)";f.camera.style!==Te&&(w.style.transform=Te,f.camera.style=Te),N(H,H,q)},this.setSize=function(H,q){n=H,i=q,o=n/2,c=i/2,m.style.width=H+"px",m.style.height=q+"px",y.style.width=H+"px",y.style.height=q+"px",w.style.width=H+"px",w.style.height=q+"px"}}}var Ow,Bw=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let lg=Ow=class extends Ri{constructor(l=!0){super(),this._scene=new s.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var i,o,c,f,m;const e=(o=(i=this._viewer)==null?void 0:i.getPlugin(us))==null?void 0:o.getSelectedObject();if(!(e!=null&&e.geometry))return void await((c=this._viewer)==null?void 0:c.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const t=await((f=this._viewer)==null?void 0:f.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!t)return;const n=await((m=this._viewer)==null?void 0:m.prompt("Width: Enter the width for the object.","512",!1))||"512";n&&this.attachIFrame(e,t,parseInt(n))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)==null||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=l,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const l=this._viewer;l&&this._renderer&&(l.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",l.canvas):this._renderer.domElement.appendChild(l.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new aD;const l=this._viewer.renderer.rendererObject.getSize(new s.FM8);this._renderer.setSize(l.width,l.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new s.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(l){await super.onAdded(l);let e=!0,t=!0;l.addEventListener("postFrame",o=>{var c,f;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(m=>{var S,C;let y=!0;const w=m.modelObj.material.side;if(w!==s.ehD){const O=new s.Pa4(0,0,1).applyQuaternion(m.cssObj.quaternion),N=(C=(S=this._viewer)==null?void 0:S.scene.activeCamera)==null?void 0:C.cameraObject,H=O.dot(N.getWorldDirection(new s.Pa4));y=w===s._Li?H>0:H<0}m.cssObj.element.style.visibility=y?"visible":"hidden"}),this._trackers.filter(m=>m.dirty).forEach(m=>this._syncProperties(m)),(f=this._renderer)==null||f.render(this._scene,(c=l.scene.activeCamera)==null?void 0:c.cameraObject),e=!1))}),l.addEventListener("update",o=>{this.enabled&&(e=this._trackers.length>0)}),l.scene.addEventListener("sceneUpdate",o=>{this.enabled&&(this._trackers.forEach(c=>c.dirty=!0),e=this._trackers.length>0)}),l.scene.addEventListener("activeCameraUpdate",o=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const i=new s.iMs;l.container.addEventListener("mousemove",o=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const c=this._viewer.canvas.getBoundingClientRect(),f=(o.clientX-c.x)/c.width*2-1,m=-(o.clientY-c.y)/c.height*2+1;i.setFromCamera({x:f,y:m},this._viewer.scene.activeCamera.cameraObject);const y=this._trackers.map(S=>S.modelObj),w=i.intersectObjects(y,!1);if(console.log(w),w.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(l,e,t){const n=Nw(l.modelObject),i=JT(e,t,t*n.y/n.x,()=>{var o;return(o=l.setDirty)==null?void 0:o.call(l)});return this.attachCSS3DObject(i,l),i}attachCSS3DObject(l,e){var n,i,o,c,f;if(this._trackers.push({cssObj:l,modelObj:e.modelObject,dirty:!0}),l.element&&(this._resizeObserver.observe(l.element),l.element.__isCSS3DObjectElement=!0,console.log(l.element,l.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const t=(n=this._viewer)==null?void 0:n.createMaterial("basic",{opacity:0,color:new s.Ilk("black"),blending:s.jFi,side:s.Wl3});if(!t)throw"cannot create mat";t.userData.forcedLinearDepth=0,(i=e.setMaterial)==null||i.call(e,t),Lw(e.modelObject),L1(e.modelObject),Nw(e.modelObject),this._scene.add(l),(c=(o=this.uiConfig)==null?void 0:o.uiRefresh)==null||c.call(o),(f=e.setDirty)==null||f.call(e)}_syncProperties(l){const e=l.modelObj,t=l.cssObj;e.updateMatrixWorld();const n=l.cssObj.element.clientWidth<1.5?0:(l.cssObj.element.clientWidth-1.5)/Nw(e).x,i=Lw(e);t.quaternion.setFromUnitVectors(new s.Pa4(0,0,1),i),t.position.copy(L1(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),l.dirty=!1}async onDispose(l){return this._resizeObserver.disconnect(),super.onDispose(l)}};function JT(l,e,t,n){const i=document.createElement("div");i.style.width=e.toString()+"px",i.style.height=t.toString()+"px",i.style.backgroundColor="transparent";const o=document.createElement("iframe",{is:"x-frame-bypass"});o.style.width="100%",o.style.height="100%",o.style.border="0px";const c=()=>{var f;try{o.contentWindow.name}catch(m){(typeof m=="string"?m:((f=m==null?void 0:m.toString)==null?void 0:f.call(m))??"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(m)}n(),o.removeEventListener("load",c)};return o.addEventListener("load",c),o.src=l,i.appendChild(o),new sD(i)}function Lw(l){if(l.geometry.userData.geometryNormal)return l.geometry.userData.geometryNormal;const e=l.geometry.attributes.normal,t=new s.Pa4,n=new s.Pa4;for(let i=0,o=e.count;i<o;i++)t.fromBufferAttribute(e,i),n.add(t);return n.normalize(),l.geometry.userData.geometryNormal=n,n}function L1(l){if(l.geometry.userData.geometryCenter)return l.geometry.userData.geometryCenter;const e=l.geometry;if(!e)return new s.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new s.Pa4);return l.geometry.userData.geometryCenter=t,t}function Nw(l,e=new s.Pa4(0,0,1)){if(l.geometry.userData.geometrySize)return l.geometry.userData.geometrySize;const t=l.geometry;if(!t)return new s.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new s.yGw().makeRotationFromQuaternion(new s._fP().setFromUnitVectors(e,Lw(l)).invert())),n.computeBoundingBox();const i=n.boundingBox.getSize(new s.Pa4);return l.geometry.userData.geometrySize=i,n.dispose(),i}lg.PluginType="CSS3DRenderer",Bw([Yn("Enabled"),(0,a.onChange)(Ow.prototype._refreshEnabled),ze()],lg.prototype,"enabled",void 0),Bw([Yn("Over canvas"),(0,a.onChange)(Ow.prototype._refreshCanvasInDOM),ze()],lg.prototype,"overCanvas",void 0),Bw([ht("Attach iframe")],lg.prototype,"attachIFrameToSelected",void 0),lg=Ow=Bw([on("CSS3D Renderer")],lg);class lD extends Ks{constructor(e,t,n,i=new s.Ilk(1,1,1),o=1){super(void 0,void 0,n,i,o),this.target=t,this._getSelectedObject=e}render(e,t,n,i,o){const c=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=this._getSelectedObject();if(y)this._renderSelectedObject(e,y,t,i,o);else{e.setRenderTarget(this.target);const w=new s.Ilk;e.getClearColor(w),e.setClearColor(new s.Ilk(16777215)),e.clear(!0,!0),e.setClearColor(w)}e.setRenderTarget(c,f,m)}_renderSelectedObject(e,t,n,i,o){if(!this.camera)return;t.traverse(m=>{m.layers.enable(6)});const c=this.camera.layers.mask;this.camera.layers.set(6);const f=e.userData;f||console.error("threejs is not patched?"),f.transmissionRenderTarget=n,_t(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(e,n,this.target,i,o)),f.transmissionRenderTarget=void 0,t.traverse(m=>{m.layers.disable(6)}),this.camera.layers.mask=c}}var F_,g0=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Uf=F_=class{constructor(l,e){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new s.Ilk(15305317),this.debugOutline=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new s.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new s.Ilk(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(t,n)=>this.enabled?a.glsl`
            ${As}
            ${`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`}
        `:"",this._combinedPostPlugin=l.getPlugin(Jc),this._pickingPlugin=l.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),e&&(this.extraUniforms.outlineBuffer.value=e.texture),this._enable()}shaderExtender(l,e,t){this.enabled&&(l.fragmentShader=ni(l.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(l){return this.enabled?"1":"0"}isCompatible(l){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var l;(l=this.__setDirty)==null||l.call(this),this._setDirty()}_enable(){var l;(l=this._pickingPlugin)==null||l.enableWidget(!this.enabled),this._setDirty()}};Uf.PluginType="Outline",g0([(0,a.onChange)(F_.prototype._enable),Yn("Enable"),ze()],Uf.prototype,"enabled",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Yn("Highlight"),ze()],Uf.prototype,"enableHighlight",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Yn("DynamicSelection"),ze()],Uf.prototype,"enableDynamicSelection",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Pe("Intensity",[0,2],.001,{limitedUi:!0}),ze()],Uf.prototype,"outlineIntensity",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Pe("Transparency",[0,1],.01,{limitedUi:!0}),ze()],Uf.prototype,"highlightTransparency",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Lt("Color"),ze()],Uf.prototype,"outlineColor",void 0),g0([(0,a.onChange)(F_.prototype._setDirty),Yn("Debug")],Uf.prototype,"debugOutline",void 0),Uf=F_=g0([on("Outline")],Uf);class ex extends Bl{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(e){return new Uf(e,this._outlineTarget)}async onAdded(e){this._outlineTarget=e.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(e);const t=e==null?void 0:e.getPluginByType("Picking"),n=new s.jyz({uniforms:{cameraNearFar:{value:new s.FM8(.1,100)}},vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:"uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(linearZ,0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",side:s.ehD}),i=No(e,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new lD(()=>t==null?void 0:t.getSelectedObject(),this._outlineTarget,n),update(){e.scene.activeCamera.updateShaderProperties(this.passObject.overrideMaterial)}});e.renderer.registerPass(i),i.passObject.scene=e.scene.modelObject,i.passObject.camera=e.scene.activeCamera.cameraObject,e.scene.addEventListener("activeCameraChange",()=>{i.passObject.camera=e.scene.activeCamera.cameraObject}),t==null||t.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(t!=null&&t.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",o=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const c=t==null?void 0:t.getSelectedObject();c&&this._extension.enableDynamicSelection?o.target!==e.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=c?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,t,n){return Nm(this._extension,"transparency",{from:e,to:t,duration:n,onComplete:()=>{this._animationCallBack=null}})}}ex.PluginType="Outline";const kw=.2,cD=Math.PI/24,ZT=new s.FM8,Uw=(l,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let i=0;i<=12;++i)l.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+kw*Math.cos(n),t+kw*Math.sin(n),0),n+=cD};class eC extends s.Kj0{constructor(e,t,n=!1){super(((m,y)=>{const w=new s.u9r,S=[],C=[],O=m.getSize(new s.Pa4),N=O.x/2,H=(y?O.y:O.z)/2;Uw(C,N,H),Uw(C,-N,H),Uw(C,-N,-H),Uw(C,N,-H);const q=C.length/3;for(let V=0;V<q-2;V+=2)S.push(V,V+1,V+3,V,V+3,V+2);const J=q-2;return S.push(J,J+1,1,J,1,0),w.setAttribute("position",new s.a$l(C,3)),w.setIndex(S),w})(e,n)),this.boundingSize=new s.Pa4,this._raycaster=new s.iMs,this._camera=t,this._placeOnWall=n;const i=this.material;i.side=s.Wl3,i.color=new pt(16711935),i.opacity=0,this.userData.bboxVisible=!1;const o=e.getSize(this.boundingSize),c=o.x/2,f=(n?o.y:o.z)/2;this.hitPlane=new s.Kj0(new s._12(2*(c+kw),2*(f+kw))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){ZT.set(t,-n),this.hitPlane.visible=!0;const i=this._positionAndNormalFromPoint(ZT,this.hitPlane);return this.hitPlane.visible=!1,i==null?null:i.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const i=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),i}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var n;const{geometry:e,material:t}=this.hitPlane;e.dispose(),t.dispose(),this.geometry.dispose(),this.material.dispose(),(n=this.parent)==null||n.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const i=n[0];return i.face==null?null:i.uv==null?{position:i.point,normal:i.face.normal,uv:null}:(i.face.normal.applyNormalMatrix(new s.Vkp().getNormalMatrix(i.object.matrixWorld)),{position:i.point,normal:i.face.normal,uv:i.uv})}}const N1=new s.Pa4;class tC{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new s.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new s.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new s.Pa4,this._hitMatrix=new s.yGw,this.xDamper=new a.Damper,this.yDamper=new a.Damper,this.zDamper=new a.Damper,this.yawDamper=new a.Damper,this.scaleDamper=new a.Damper,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),i=this.presentedScene,o=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:c}=this.inputSource.gamepad||{axes:[0,0]},f=o.getHit(i,c[0],c[1]);o.show=!0,f!=null?(this.isTranslating=!0,this.lastDragPosition.copy(f),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*c[0])}else if(n.length===2){o.show=!0,this.isTwoFingering=!0;const{separation:c}=this.fingerPolar(n);this.firstRatio=c/i.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n){var i;this.transientHitTestSource=await((i=e.requestHitTestSourceForTransientInput)==null?void 0:i.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const t=(i=this.xr)==null?void 0:i.getReferenceSpace(),n=t?e.getPose(t):null;return n?(this._hitMatrix.fromArray(n.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,i=t.rotation.y,o=this.placementBox,c=Math.max(o.boundingSize.x,o.boundingSize.y,o.boundingSize.z)/2,f=this.goalPosition,m=t.scale.x;if(!f.equals(n)||this.goalScale!==m){let{x:y,y:w,z:S}=n;y=this.xDamper.update(y,f.x,e,c),w=this.yDamper.update(w,f.y,e,c),S=this.zDamper.update(S,f.z,e,c),n.set(y,w,S);const C=this.scaleDamper.update(m,this.goalScale,e,1);if(t.scale.set(C,C,C),!this.isTranslating){const O=f.y-w;this.placementComplete&&!this.placeOnWall?o.offsetHeight=O/C:O===0&&(this.placementComplete=!0,o.show=!1)}}o.updateOpacity(e),t.rotation.y=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}processInput(e){var c;this.frame=e;const t=this.transientHitTestSource;if(!t||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),i=this.presentedScene,o=i.scale.x;if(this.isTwoFingering)if(n.length<2)this.isTwoFingering=!1;else{const{separation:f,deltaYaw:m}=this.fingerPolar(n);if(this.placeOnWall||(this.goalYaw+=m),!i.userData.__scaleDisabled){const y=f/this.firstRatio;this.goalScale=y<1.3&&y>.7692307692307692?1:y}}else if(n.length!==2)if(this.isRotating&&((c=this.inputSource)!=null&&c.gamepad)){const f=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=f-this.lastAngle,this.lastAngle=f}else this.isTranslating&&(console.log("translating"),n.forEach(f=>{if(f.inputSource!==this.inputSource)return;let m=null;if(f.results.length>0&&(m=this.getHitPoint(f.results[0])),m==null&&(m=this.getTouchLocation()),m!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const y=m.y-this.lastDragPosition.y;if(y<0){this.placementBox.offsetHeight=y/o;const w=N1.copy(this.xr.getCamera().position),S=-y/(w.y-m.y);w.multiplyScalar(S),m.multiplyScalar(1-S).add(w)}}this.goalPosition.add(m),this.lastDragPosition.copy(m)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:f}=this.fingerPolar(n);this.firstRatio=f/o}}getTouchLocation(){var n;const{axes:e}=this.inputSource.gamepad??{axes:[0,0]},t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(N1.copy(t).sub((n=this.xr)==null?void 0:n.getCamera().position),N1.length()>10)?null:t}fingerPolar(e){var m,y,w,S;const t=((y=(m=e[0].inputSource)==null?void 0:m.gamepad)==null?void 0:y.axes)??[0,0],n=((S=(w=e[1].inputSource)==null?void 0:w.gamepad)==null?void 0:S.axes)??[0,0],i=n[0]-t[0],o=n[1]-t[1],c=Math.atan2(o,i);let f=this.lastAngle-c;return f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI),this.lastAngle=c,{separation:Math.sqrt(i*i+o*o),deltaYaw:f}}}class uD{constructor(e,t,n,i,o){this.xrLight=e,this.renderer=t,this.lightProbe=n,this.xrWebGLBinding=null,this.estimationStartCallback=o,this.frameCallback=this.onXRFrame.bind(this);const c=t.xr.getSession();if(i&&"XRWebGLBinding"in window){const f=new s.oAp(16);e.environment=f.texture;const m=t.getContext();switch(c.preferredReflectionFormat){case"srgba8":m.getExtension("EXT_sRGB");break;case"rgba16f":m.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(c,m),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}c.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const i=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/i,n.primaryLightIntensity.y/i,n.primaryLightIntensity.z/i),this.xrLight.directionalLight.intensity=i,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class hD extends s.ZAu{constructor(e,t=!0){super(),this.lightProbe=new s.lk7,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new s.Ox3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let n=null,i=!1;e.xr.addEventListener("sessionstart",()=>{const o=e.xr.getSession();"requestLightProbe"in o&&o.requestLightProbe({reflectionFormat:o.preferredReflectionFormat}).then(c=>{n=new uD(this,e,c,t,()=>{i=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{n&&(n.dispose(),n=null),i&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{n&&(n.dispose(),n=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var qA=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let z_=class extends Ri{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new tC,this.dependencies=[vr],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var l;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):((l=this._xrManager)==null||l.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const l=this._xrManager.getCamera(),e=l.cameras[0]||l,t=this._viewer.scene.activeCamera;t.cameraObject.projectionMatrix.copy(e.projectionMatrix),t.cameraObject.projectionMatrixInverse.copy(t.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var t,n;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const l=this._viewer.renderer,e=(n=(t=this._xrManager)==null?void 0:t.getCamera())==null?void 0:n.cameras[0].viewport;e?l.rendererObject.setViewport(e):console.warn("no viewport for ar camera"),this._viewer.getPlugin(vr).updateShaderProperties(XA.material),XA.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,_t(l.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{XA.render(l.rendererObject,null,l.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._preFrame=({xrFrame:l,deltaTime:e})=>{var o,c;if(this.dirty=!!l&&((o=this._xrManager)==null?void 0:o.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!l)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const t=this._xrManager.getReferenceSpace(),n=l.getViewerPose(t);if(n==null&&this._frameCount,n==null||((c=this._viewer)==null?void 0:c.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const i=this._viewer.scene.activeCamera;this._xrManager.updateCamera(i.cameraObject),i.setDirty(),this.moveToFloor(l),this._touchInputHelper.processInput(l),this._touchInputHelper.moveScene(e),this._updateShadow()},this._preXRState={viewerBg:null,modelScale:new s.Pa4(1,1,1),modelPosition:new s.Pa4,modelRotation:new s._fP,cameraPosition:new s.Pa4(0,0,5),cameraTarget:new s.Pa4,cameraUp:new s.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new s.yGw,cameraAutoNearFar:void 0,groundOffset:new s.Pa4,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new s.FM8,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.getBackground(!0);const l=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera;l.updateMatrix(),l.updateMatrixWorld(!0),this._preXRState.modelScale.copy(l.scale),this._preXRState.modelPosition.copy(l.position),this._preXRState.modelRotation.copy(l.quaternion),this._preXRState.cameraPosition.copy(e.position),this._preXRState.cameraTarget.copy(e.target),this._preXRState.cameraUp.copy(e.cameraObject.up),e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=e.cameraObject.fov,this._preXRState.cameraAspect=e.cameraObject.aspect),this._preXRState.cameraZoom=e.cameraObject.zoom,this._preXRState.cameraNear=e.cameraObject.near,this._preXRState.cameraFar=e.cameraObject.far,this._preXRState.cameraAutoNearFar=e.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(e.cameraObject.projectionMatrix);const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(this._preXRState.groundOffset.subVectors(l.position,t.mesh.modelObject.position),this._preXRState.groundScale=t.mesh.modelObject.scale.x,this._preXRState.groundRotation=t.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=t.renderToDepth,this._preXRState.groundShadowBaker=t.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const l=20*Math.PI/180,e=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(l),z:-Math.cos(l)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var t,n;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const i=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((n=(t=this._xrSession).requestHitTestSource)==null?void 0:n.call(t,{space:i,offsetRay:e}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.useTotalFrameCount=!1,this._restorePreXRState())},this._onSessionStarted=async l=>{l.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new hD(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(l),this._xrSession=l},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(l){await super.onAdded(l);const e=l.renderer.rendererObject.xr;if(e.enabled=!0,e.cameraAutoUpdate=!1,this._xrManager=e,this._touchInputHelper.xr=e,!this.domOverlay){const t=document.getElementById("tweakpaneUiContainer");this.domOverlay=t?{root:t}:void 0}if(l.addEventListener("preRender",this._preRender),l.addEventListener("postRender",this._postRender),l.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return l.console.error("XR not supported in insecure context, try https://"),this.enabled=!1,void(e.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(t=>{if(!t)throw new Error("AR not supported")}).catch(t=>{l.console.error("AR not supported:",t),e.enabled=!1,this.enabled=!1}):(e.enabled=!1,this.enabled=!1)}_updateShadow(){var t,n;if(!this._viewer)return;const l=this._viewer.scene.modelRoot,e=(n=(t=this._viewer.getPluginByType("Ground"))==null?void 0:t.mesh)==null?void 0:n.modelObject;e&&(e.rotation.z=this._viewer.scene.modelRoot.rotation.y,e.position.copy(this._preXRState.groundOffset).multiplyScalar(l.modelObject.scale.x).sub(l.modelObject.position).negate(),e.scale.setScalar(l.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(l){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const e=l.getHitTestResults(this._hitTestSource);if(!e.length)return;const t=e[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const n=this._touchInputHelper.getHitPoint(t);if(!n)return;this._placementBox.show=!0;const i=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(n),i.position.copy(n),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var m,y;const l=this._viewer.scene.modelRoot,e=this._viewer.scene.activeCamera,t=(m=this._xrManager)==null?void 0:m.getCamera(),n=t.cameras[0]||t;this._removePlacementBox();const i=this._viewer.scene.getBounds(!0,!0);i.getSize(new s.Pa4).length()>.01&&(this._placementBox=new eC(i,t,this.placeOnWall),l.add(this._placementBox),this._placementBox.show=!1);const o=t.getWorldDirection(new s.Pa4);l.rotation.y=Math.atan2(-o.x,-o.z)-0,e.cameraObject.zoom=n.zoom,e.cameraObject.near=n.near,e.cameraObject.far=n.far,e.cameraObject.userData.autoNearFar=!1,e.cameraObject.isPerspectiveCamera?(e.cameraObject.fov=n.fov,e.cameraObject.aspect=n.viewport.width/n.viewport.height):console.warn("Perspective camera required."),e.cameraObject.updateProjectionMatrix();const c=l.userData.arScale||1;l.scale.set(c,c,c),l.position.copy(t.position).add(o.multiplyScalar(5)),l.visible=!0;const f=(y=this._viewer)==null?void 0:y.getPluginByType("Ground");f!=null&&f.mesh&&(f.shadowBaker.enabled=!1,f.renderToDepth=!1)}_restorePreXRState(){if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.interactionsEnabled=!0,this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const l=this._viewer.scene.modelRoot;l.scale.copy(this._preXRState.modelScale),l.position.copy(this._preXRState.modelPosition),l.quaternion.copy(this._preXRState.modelRotation),l.updateMatrix(),l.updateMatrixWorld(!0),l.visible=!0;const e=this._viewer.scene.activeCamera;e.position.copy(this._preXRState.cameraPosition),e.target.copy(this._preXRState.cameraTarget),e.cameraObject.up.copy(this._preXRState.cameraUp),e.cameraObject.near=this._preXRState.cameraNear,e.cameraObject.far=this._preXRState.cameraFar,e.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,e.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(e.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(e.cameraObject.aspect=this._preXRState.cameraAspect)),e.positionUpdated(!1),e.targetUpdated(!0),e.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),e.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),e.cameraObject.updateMatrixWorld(!0),e.cameraObject.updateProjectionMatrix();const t=this._viewer.getPluginByType("Ground");t!=null&&t.mesh&&(t.mesh.modelObject.position.subVectors(l.position,this._preXRState.groundOffset),t.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),t.mesh.modelObject.rotation.z=this._preXRState.groundRotation,t.renderToDepth=this._preXRState.groundRenderToDepth,t.shadowBaker.enabled=this._preXRState.groundShadowBaker,t.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};z_.PluginType="WEBXR_ARPlugin",qA([Yn("Light Estimate")],z_.prototype,"estimateLighting",void 0),qA([Yn("Place on Wall")],z_.prototype,"placeOnWall",void 0),qA([Pe("Resilution scale",[.1,1],.1)],z_.prototype,"xrResolutionScale",void 0),qA([ht("Enter AR")],z_.prototype,"enterAR",void 0),qA([ht("Exit AR")],z_.prototype,"exitAR",void 0),z_=qA([on("WebXR AR")],z_);const XA=new Ms({vertexShader:v.vertexShader,fragmentShader:`
        ${As}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...v.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});XA.renderToScreen=!1,XA.useExistingRenderTarget=!0,XA.clear=!1;class Fw extends a.SimpleEventDispatcher{get state(){return this._state}setState(e,t){this._state=e,this.dispatchEvent({type:e,...t})}_setOptions(e){Object.assign(this.options,e)}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=n=>{n.data&&n.data.size>0&&this._currentRecording.push(n.data)},this._canvas=e,t==null||t.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(t||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()})}}class nC extends Fw{constructor(){super(...arguments),this._currentImages=[],this._onstop=e=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=e=>{this.setState("error",{error:e}),this._console.error(e)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async e=>{const t=await(e==null?void 0:e.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=t,this._frameCount=0,this.setState("recording")}).catch(e=>{this._onerror({detail:e})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const e=this.options.mimeType;return this._canvas.toBlob(t=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t])},e,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(e){if(!this._imgDirectory)return;const t=[];for(const n of e){const i=await this._imgDirectory.getFileHandle(n[0],{create:!0});t.push((0,a.writeFile)(i,n[1]))}await Promise.all(t)}}class tx extends Fw{_setOptions(e){var t;super._setOptions(e),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=tx.GetSupportedMimeTypes([],["h264"],!0)??tx.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!((t=this.options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(e,t),this._resumeSyncTime=0,this._onstop=n=>{var i;if(this._recorder&&this._currentRecording.length>0){const o=new Blob(this._currentRecording,{type:this.options.mimeType});(i=this._recordingCallback)==null||i.call(this,o)}this._recorder=void 0,this.setState("stopped")},this._onstart=n=>{var i;this._frameCount=0,this.options.stepMode&&((i=this._recorder)==null||i.pause()),this.setState("recording")},this._onresume=n=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const i=()=>{var c;this.state==="recording"&&((c=this._recorder)==null||c.pause())},o=Math.min(this._resumeSyncTime-(0,a.now)(),0)+1e3/this.options.frameRate;o>0?(0,a.timeout)(o).then(i):i()},this._onerror=n=>{this.setState("error",{error:n}),this._console.error(n),this._recorder=void 0}}start(){var t,n,i;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const e={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const o=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),c=(n=o.getVideoTracks())==null?void 0:n[0];this._track=c,this._recorder=new window.MediaRecorder(o,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((i=this._recorder)==null||i.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=(0,a.now)(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(f=>!e||e.length<1||e.includes(f)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(f=>!t||t.length<1||t.includes(f)),c=[];return i.forEach(f=>{const m=`video/${f}`;o.forEach(y=>{[`${m};codecs=${y}`,`${m};codecs:${y}`,`${m};codecs=${y.toUpperCase()}`,`${m};codecs:${y.toUpperCase()}`,`${m}`].forEach(w=>{MediaRecorder.isTypeSupported(w)&&c.push(w)})})}),n?c.length>0?c[0]:void 0:c}}class YA extends Fw{constructor(e,t){super(e,t),this._workerRunning=!1,this.worker=new Worker((0,a.remoteWorkerURL)(YA.LIBRARY_PATH+"ffmpeg-worker-mp4.js",YA.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=n=>{var o;const i=n.data;switch(i.type){case"stdout":case"stderr":if(i.data.indexOf("frame=")===0){const c=parseInt(i.data.split("frame=")[1].split("fps")[0].trim()),f=this._frameCount,m=Math.round(c/f*100);this.dispatchEvent({type:"encode-progress",progress:m,frame:c,totalFrames:f})}console.log(i.data+`
`);break;case"exit":console.log("Process exited with code "+i.data),parseInt(i.data);break;case"done":if(i.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(o=this._recordingCallback)==null||o.call(this,new Blob([i.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(e){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=e,this.setState("stopping"),this._onStop()):console.error("Recorder in error state, cannot stop, call start again."))}_onStop(){const e=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const t=this.options.frameRate.toString(),n=this.options.frameRate.toString();this.worker.postMessage({type:"run",arguments:["-r",t,"-an","-i","img%03d.jpeg","-c:v","libx264","-crf","17","-filter:v",`scale=${e}:-2`,"-pix_fmt","yuv420p","-b:v","10M","-preset","ultrafast","-r",n,"out.mp4"]})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}sendBlobToWorker(e){this._canvas.toBlob(t=>{this.worker.postMessage({type:"image",file:{name:`img${this.pad(e,3)}.jpeg`,data:t}})},"image/jpeg",90)}pad(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}}YA.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var k1=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class Ff extends Ri{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!1,this.mimeType="image/jpeg",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&((e=this._recorder)!=null&&e.isRecording())){const i=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))==null?void 0:n.isConverged())||!1,i&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if((e=this._recorder)!=null&&e.isRecording()&&(!this.convergeMode||(n=(t=this._viewer)==null?void 0:t.getPluginByType("Progressive"))!=null&&n.isConverged(!0))){const i=()=>{var o;return(o=this._recorder)==null?void 0:o.requestFrame()};this.convergeMode?(0,a.timeout)(1).then(i):i()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e;(e=this.uiConfig.children)==null||e.map(t=>(0,a.getOrCall)(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)==null?void 0:n.call(t)})},this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["MP4 Video (ffmpeg)","video/mp4"]].map(e=>({label:e[0],value:e[1]}))},{type:"input",disabled:!0,label:"State",getValue:()=>{var e;return((e=this.recorder)==null?void 0:e.state)??"not initialized"}},{type:"button",label:()=>{var e;return(e=this.recorder)!=null&&e.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var e;(e=this.recorder)!=null&&e.isRecording()?this.stopRecording().then(async t=>{if(t){const n=t.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(t,n)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var e,t;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))},value:()=>{var e,t;(t=(e=this._viewer)==null?void 0:e.getPluginByType("CameraViews"))==null||t.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var e,t,n,i;return!!((e=this.recorder)!=null&&e.isRecording())||!((t=this._viewer)!=null&&t.getPluginByType("CameraViews"))||!((i=(n=this._viewer)==null?void 0:n.getPluginByType("GLTFAnimation"))!=null&&i.animations.length)},value:()=>{var t,n,i,o;const e=((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))==null?void 0:n.animationState)==="playing";(o=(i=this._viewer)==null?void 0:i.getPluginByType("CameraViews"))==null||o.recordAllViews(()=>{var c,f;(f=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation"))==null||f.playAnimation()}).then(()=>{var c,f;e||((f=(c=this._viewer)==null?void 0:c.getPluginByType("GLTFAnimation"))==null||f.stopAnimation())})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var e,t,n;return!!((e=this.recorder)!=null&&e.isRecording())||!((n=(t=this._viewer)==null?void 0:t.getPluginByType("GLTFAnimation"))!=null&&n.animations.length)},value:async()=>{var i,o;if((i=this.recorder)!=null&&i.isRecording())return;const e=(o=this._viewer)==null?void 0:o.getPluginByType("GLTFAnimation");if(!e)return;let t=!1;e.loopAnimations&&(t=!0),t&&(e.loopAnimations=!1);const n=await this.record(async()=>e.playAnimation());if(t&&(e.loopAnimations=!0),n){const c=n.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(n,c)}}},{type:"button",limitedUi:!0,label:"Record 360 animation",hidden:()=>{var e;return!!((e=this.recorder)!=null&&e.isRecording())},value:async()=>{var y;if((y=this.recorder)!=null&&y.isRecording()||!this._viewer)return;const e=await this._viewer.prompt("Enter duration in seconds","5",!0);if(e===null)return;const t=parseFloat(e||"5");if(!isFinite(t)||t<=0)return;const n=this._viewer.scene.activeCamera,i=n.interactionsEnabled;i&&(n.interactionsEnabled=!1);const o=n.position.clone(),c=await this._viewer.getPluginByType("PopmotionPlugin");if(!c)return void console.error("Popmotion plugin not found");const f=new s.$V().setFromVector3(o);n.position.setFromSpherical(f),n.positionUpdated(!0);const m=await this.record(async()=>c.animate({from:f.theta,to:f.theta+2*Math.PI,duration:1e3*t,ease:Ul.linear,onUpdate:w=>{f.theta=w,n.position.setFromSpherical(f),n.positionUpdated(!0)}}).promise);if(n.position.copy(o),n.positionUpdated(!0),i&&(n.interactionsEnabled=!0),m){const w=m.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(m,w)}}}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var e;return((e=this._recorder)==null?void 0:e.isRecording())??!1}refreshRecorderOptions(){if(!this._viewer)return;let e="image";this.mimeType==="video/mp4"?e="ffmpeg.js":this.mimeType==="auto"?e="canvas-media":this.mimeType.startsWith("image")&&(e="image"),this._recorder=this._getRecorder(e),this._recorder&&this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode})}async onAdded(e){var t;await super.onAdded(e),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(t=e.canvas.parentElement)==null||t.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(e){var t,n;this.dirty=e,(t=this._viewer)==null||t.setDirty(),(n=this.uiConfig.children)==null||n.map(i=>(0,a.getOrCall)(i)).flat(2).forEach(i=>{var o;return(o=i==null?void 0:i.uiRefresh)==null?void 0:o.call(i)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(t=this._recorder)==null||t.dispose(),Object.values(this._recorders).forEach(n=>{n==null||n.dispose()}),super.onRemove(e)}async record(e,t){var n;if(this.enabled&&!((n=this._recorder)!=null&&n.isRecording()))return await new Promise((i,o)=>{const c=()=>{this.removeEventListener("start",f),this.removeEventListener("stop",c),this.removeEventListener("error",m)},f=async()=>{c(),t==null||t(),await e(),i()},m=async()=>{c(),o()};this.addEventListener("start",f),this.addEventListener("stop",c),this.addEventListener("error",m),this.startRecording()}),await this.stopRecording()}startRecording(){var e;return!!this.enabled&&((e=this.recorder)==null?void 0:e.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if((e=this.recorder)!=null&&e.isRecording())return new Promise((t,n)=>{var i;return(i=this.recorder)==null?void 0:i.stop(t)})}async _downloadBlob(e,t){var o,c,f;const n=await((o=this._viewer)==null?void 0:o.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),i=(c=this._viewer)==null?void 0:c.getPluginByType("FileTransferPlugin");i?await i.exportFile(e,n||"recording.mp4"):(f=this._viewer)==null||f.console.error("FileTransferPlugin required to export/download file")}_getRecorder(e){if(!this._viewer)throw new Error("No viewer");if(this._recorders[e])return this._recorders[e];let t;return t=e==="canvas-media"?new tx(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):e==="ffmpeg.js"?new YA(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new nC(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),t.addEventListener("starting",()=>this._stateChange(!1)),t.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),t.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),t.addEventListener("paused",()=>this._stateChange(!1)),t.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),t.addEventListener("encode-progress",n=>{this.dispatchEvent({...n})}),this._recorders[e]=t,t}}Ff.PluginType="CanvasRecorder",k1([(0,a.onChange)(Ff.prototype.refreshRecorderOptions),ze()],Ff.prototype,"convergeMode",void 0),k1([(0,a.onChange)(Ff.prototype.refreshRecorderOptions),ze()],Ff.prototype,"mimeType",void 0),k1([(0,a.onChange)(Ff.prototype.refreshRecorderOptions),ze()],Ff.prototype,"videoFrameRate",void 0);var zw=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const U1=new s.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});U1.depthTest=!1;const F1=new s.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});F1.depthTest=!1;class Hp extends Uu{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new s.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Fd)}async onAdded(e){const t=e.renderer.createTarget({type:s.ywz,format:s.wk1,colorSpace:s.aCh,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:s.wem,magFilter:s.wem});t.texture.name="groundContactDepthTexture";const n=new s.lRF({depthPacking:s.z81});n.onBeforeCompile=function(o){o.uniforms.opacity.value=1,o.fragmentShader=`
						${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const i=new $s(t,n,new s.Ilk(0,0,0),0);this._depthPass=i,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const e=this._viewer.renderer.getTempTarget({type:s.ywz,format:s.wk1,colorSpace:s.aCh,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:s.wem,magFilter:s.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(U1.uniforms.h.value=t*this.blurAmount/256,F1.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:U1,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:F1,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new s.Pa4)),this.shadowCamera.setRotationFromEuler(new s.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)==null||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var t;if(!this._viewer)return!1;const e=super._refreshMaterial();return this._material&&(this._material.alphaMap=((t=this._depthPass)==null?void 0:t.target.texture)||null,e&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),e}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function iC(l,e,t,n){l.traverse(i=>{i&&(i.userData.cloneRotI=e,i.userData.rotationCount=t,i.userData.rotationAxis=n,i.addEventListener("beforeRender",o=>function(c,f){var m;f&&((m=f.map)!=null&&m.isTexture)&&(f.extraUniformsToUpload||(f.extraUniformsToUpload={}),f.extraUniformsToUpload.uvTransform||(f.extraUniformsToUpload.uvTransform={value:new s.Vkp}),f.extraUniformsToUpload.uvTransform.value.setUvTransform(f.map.offset.x*f.map.repeat.x*c.userData.cloneRotI/(c.userData.rotationCount||1),f.map.offset.y*f.map.repeat.y*c.userData.cloneRotI/(c.userData.rotationCount||1),f.map.repeat.x,f.map.repeat.y,f.map.rotation,f.map.center.x,f.map.center.y))}(i,o.material)))})}function rC(l,e,t,n="x"){if(l.userData.rotationCount>1&&!l.userData.rotationRoot)return l;const i=l.parent;if(!i)throw new Error("No parent");if(l.userData.cloneParent){const c=l.userData.cloneParent;if(!(l=i.children.find(f=>c===f.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",c,i),l}let o=i.children.filter(c=>{var f;return((f=c.userData)==null?void 0:f.cloneParent)===l.uuid}).sort((c,f)=>c.userData.cloneRotI-f.userData.cloneRotI);if(l.userData.rotationCount===e&&e===o.length&&t===void 0&&l.userData.rotationAxis===n)return l;if(t==null&&(t=l.userData.rotationSkips??[]),t!==l.userData.rotationSkips&&(l.userData.rotationSkips=[...t]),iC(l,0,e,n),l.userData.rotationRoot=!0,l.visible=!0,e<=o.length){for(let c=e-1;c<o.length;c++)i.remove(o[c]),o[c].traverse(f=>f.userData={__disposed:!0});o=o.slice(0,e)}for(let c=1;c<e;c++){const f=c<=o.length?o[c-1]:l.clone();f.rotation.copy(l.rotation),f.rotation[n]+=c/e*Math.PI*2,iC(f,c,e,n),c>o.length&&i.add(f),f.visible=!t.includes(c)}return l.visible=!t.includes(0),l}Hp.PluginType="ContactShadowGroundPlugin",zw([(0,a.onChange)(Hp.prototype.refreshOptions),ze()],Hp.prototype,"contactShadows",void 0),zw([ze(),(0,a.onChange)(Hp.prototype._setDirty)],Hp.prototype,"blurAmount",void 0),zw([ze(),(0,a.onChange)(Hp.prototype._refreshShadowCameraFrustum)],Hp.prototype,"shadowScale",void 0),zw([ze(),(0,a.onChange)(Hp.prototype._refreshShadowCameraFrustum)],Hp.prototype,"shadowHeight",void 0);var KA,nx=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let zf=KA=class extends Ri{async onAdded(l){var e;await super.onAdded(l),(e=l.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}_selectedObjectChanged(){var t,n,i,o,c,f,m;if(!this.enabled)return;const l=(n=(t=this._viewer)==null?void 0:t.getPluginByType("Picking"))==null?void 0:n.getSelectedObject();if(!l)return void((o=(i=this.uiConfig).uiRefresh)==null?void 0:o.call(i,"postFrame",!0));const e=l.userData.rotationRoot?l.userData.rotationCount??1:1;this.rotations=e,this.skips=((c=l.userData.rotationSkips)==null?void 0:c.join(","))??"",this.axis=l.userData.rotationAxis||"x",(m=(f=this.uiConfig).uiRefresh)==null||m.call(f,"postFrame",!0)}_paramsChanged(){var e,t,n,i,o,c;if(!this.enabled)return;const l=(t=(e=this._viewer)==null?void 0:e.getPluginByType("Picking"))==null?void 0:t.getSelectedObject();if(l){if(this.rotations>1||l.userData.rotationCount){const f=l.userData.rotationCount,m=rC(l,this.rotations,this.skips.split(",").map(w=>parseInt(w)).filter(w=>isFinite(w)),this.axis),y=m==null?void 0:m.userData.rotationCount;if(y&&y!==f){const w=[];m==null||m.traverseAncestors(S=>{w.push(S)});for(const S of w)if(S.userData.autoScaled){vt(S),(n=this._viewer)==null||n.resetCamera({rootObject:S,centerOffset:new s.Pa4(4,4,4)});break}}l.parent&&!l.userData.__disposed||((o=(i=this._viewer)==null?void 0:i.getPluginByType("Picking"))==null||o.setSelectedObject(m,!0))}(c=this._viewer)==null||c.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};zf.PluginType="ObjectRotationPlugin",nx([ze(),Yn("Enabled"),(0,a.onChange)(KA.prototype._paramsChanged)],zf.prototype,"enabled",void 0),nx([Pe("Rotation Count",[1,100],1,l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!l.rotations}})),(0,a.onChange)(KA.prototype._paramsChanged)],zf.prototype,"rotations",void 0),nx([ct("Axis",["x","y","z"].map(l=>({label:l})),l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!l.rotations}})),(0,a.onChange)(KA.prototype._paramsChanged)],zf.prototype,"axis",void 0),nx([Ke("Rotation Skips",l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPluginByType("Picking"))!=null&&t.getSelectedObject())||!l.rotations}})),(0,a.onChange)(KA.prototype._paramsChanged)],zf.prototype,"skips",void 0),zf=KA=nx([on("Object Rotations")],zf);var Ny,$A=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Wp=Ny=class extends Ri{constructor(l=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const i of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=ni(e.fragmentShader,`#include <${i}>`,s.WdD[i].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=ni(e.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=ni(e.fragmentShader,"#include <normal_fragment_maps>",ni(ni(s.WdD.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)==null?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{if(this.enabled)for(const[i,o]of Object.entries(this._defines)){const c=typeof o=="number"?o:o?1:0;t.defines[i]!==c&&(t.defines[i]=c,t.needsUpdate=!0)}}},this.dependencies=[fi],this.enabled=l,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var l,e,t;(e=(l=this._bumpMapExtension)==null?void 0:l.setDirty)==null||e.call(l),(t=this._viewer)==null||t.setDirty()}async onAdded(l){var e,t;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(l)}async onRemove(l){var e,t;return(t=(e=l.getPlugin(fi))==null?void 0:e.materials)==null||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(l)}};Wp.PluginType="ReliefParallaxMapping",$A([(0,a.onChange)(Ny.prototype._updateExtension),ze(),Yn("Enabled")],Wp.prototype,"enabled",void 0),$A([(0,a.onChange)(Ny.prototype._updateExtension),Yn("Debug Normals")],Wp.prototype,"debugNormals",void 0),$A([(0,a.onChange)(Ny.prototype._updateExtension),Yn("Debug Hit Height")],Wp.prototype,"debugHitHeight",void 0),$A([Ze("PARALLAX_MAP_STEPS",void 0,!0,Ny.prototype._updateExtension),Pe("Step count",[1,32],1),ze()],Wp.prototype,"stepCount",void 0),$A([Ze("PARALLAX_MAP_B_STEPS",void 0,!0,Ny.prototype._updateExtension),Pe("Binary search steps",[1,8],1),ze()],Wp.prototype,"binaryStepCount",void 0),Wp=Ny=$A([on("Parallax Mapping")],Wp);class z1 extends s.u9r{constructor(e,t,n=32,i=64,o=!1,c=new s.FM8(1,1),f="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:i,closed:o,primary:f,shapeScale:c.clone()};const m=t.computeFrenetFrames(i,o);this.frames=m;const y=new s.Pa4,w=new s.Pa4,S=new s.Pa4,C=new s.FM8;let O=new s.Pa4;const N=[],H=[],q=[],J=e.getSpacedPoints(n);for(const ue of J)ue.multiply(c);(function(){for(let ue=0;ue<i;ue++)z(ue);z(o===!1?i:0),function(){for(let ue=0;ue<=i;ue++)for(let me=0;me<=n;me++)C.x=ue/i,C.y=me/n,H.push(C.x,C.y)}(),function(){const ue=f==="shape",me=ue?n:i,Te=ue?i:n;for(let Be=1;Be<=me;Be++)for(let He=1;He<=Te;He++){const[tt,lt]=ue?[He,Be]:[Be,He],at=(n+1)*(tt-1)+(lt-1),St=(n+1)*tt+(lt-1),mt=(n+1)*tt+lt,gt=(n+1)*(tt-1)+lt;q.push(at,St,gt),q.push(St,mt,gt)}}()})(),this.setIndex(q),this.setAttribute("position",new s.a$l(N,3)),this.setAttribute("uv",new s.a$l(H,2)),this.computeVertexNormals();const V=this.attributes.normal;function z(ue){O=t.getPointAt(ue/i,O);const me=m.normals[ue],Te=m.binormals[ue];for(let Be=0;Be<=n;Be++){const He=J[Be%n];w.set(0,0,0).addScaledVector(me,He.x).addScaledVector(Te,He.y),y.copy(O).add(w),N.push(y.x,y.y,y.z)}}(function(){for(let me=1;me<n;me++){const Te=me+i*(n+1);w.fromBufferAttribute(V,me),S.fromBufferAttribute(V,Te),w.add(S).normalize(),V.setXYZ(me,w.x,w.y,w.z),V.setXYZ(Te,w.x,w.y,w.z)}for(let me=1;me<i;me++){const Te=me*(n+1),Be=Te+n;w.fromBufferAttribute(V,Te),S.fromBufferAttribute(V,Be),w.add(S).normalize(),V.setXYZ(Te,w.x,w.y,w.z),V.setXYZ(Be,w.x,w.y,w.z)}w.fromBufferAttribute(V,0),S.fromBufferAttribute(V,n),w.add(S);const ue=i*(n+1);S.fromBufferAttribute(V,ue),w.add(S),S.fromBufferAttribute(V,ue+n),w.add(S),w.normalize(),V.setXYZ(0,w.x,w.y,w.z),V.setXYZ(n,w.x,w.y,w.z),V.setXYZ(ue,w.x,w.y,w.z),V.setXYZ(ue+n,w.x,w.y,w.z),V.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,i=[...e,1].sort((f,m)=>f-m);let o=0,c=0;for(const f of i){const m=Math.round(t*f)*n/t;this.addGroup(o,m-o,c++),o=m}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var j1,_0=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let rd=j1=class extends Ri{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new s.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var n,i;const l=(i=(n=this._viewer)==null?void 0:n.getPlugin(us))==null?void 0:i.getSelectedObject();if(!l)return;let e=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!e)return;e=parseFloat(e);const t=new V1(0,0,e,e,0,2*Math.PI,!0,0);await this.extrudeObject(l,t)}}async onAdded(l){await super.onAdded(l)}static CreateCurve(l,e){if(l==="circle")return new V1(0,0,e.radius??1,e.radius??1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(l,e,t=this.shapeSegments,n=this.tubularSegments,i=this.shapeScale,o=this.materialSplits.split(",").map(f=>parseFloat(f.trim())),c=this.horizontalSplits){var C,O,N,H,q,J,V,z;if(l.userData.isExtrudedTube,l.userData._extrudeSource){const ue=l.userData._extrudeSource;if(l=(C=l.parent)==null?void 0:C.children.find(me=>ue===me.uuid),!l)return void console.warn("Could not find extrude source with uuid",ue)}if(l.userData.extrudedObject){const ue=l.userData.extrudedObject,me=(O=l.parent)==null?void 0:O.children.find(Te=>ue===Te.uuid);me&&(me.removeFromParent(),me.geometry.dispose(),me.geometry=null,me.material=null),delete l.userData.extrudedObject}const f=l.geometry;if(!f)return void((N=this._viewer)==null?void 0:N.alert("Extrude: No geometry to extrude"));const m=[l.material];let y;try{const ue=j1.ConvertGeometryToFlatShape(f);y=new z1(ue,e,t,n,!0,i,c?"shape":"path"),y.computeBoundingBox(),y.createSplits(o)}catch(ue){return void((H=this._viewer)==null?void 0:H.alert(typeof ue=="string"?ue:ue==null?void 0:ue.message))}m[0].color.set(16777215);for(let ue=m.length;ue<y.groups.length;ue++){const me=m[0].clone();m.push(me),me.color.set(16777215*Math.random())}const w=new s.Kj0(y,m);w.userData._extrudeSource=l.uuid,w.userData.isExtrudedTube=!0,l.visible=!1,l.userData.bboxVisible=!1,w.name=l.name+"_extruded";const S=await((V=(J=(q=this._viewer)==null?void 0:q.getManager())==null?void 0:J.importer)==null?void 0:V.processImportedSingle(w,{autoCenter:!1,autoScale:!1}));S&&((z=l.parent)==null||z.add(S.modelObject),l.userData.extrudedObject=S.modelObject.uuid,S.dispatchEvent({type:"select",ui:!0,value:S}))}static ExtrudeShape(l,e,t,n,i,o,c,f){const m=new z1(l,n,e,t,!0,new s.FM8(i,o),f?"shape":"path");m.computeBoundingBox(),m.createSplits(c);const y=new s.Kj0(m,[]);return y.userData.isExtrudedTube=!0,y}static ConvertGeometryToFlatShape(l,e=!0){if(l.userData.__planarShape)return l.userData.__planarShape;let t=l.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=l;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const i=n.boundingBox.getSize(new s.Pa4),o=i.x<.001?"x":i.y<.001?"y":i.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let c=[];for(let m=0;m<t.count;m++){const y=new s.FM8;o==="x"?y.set(t.getY(m),t.getZ(m)):o==="y"?y.set(t.getX(m),t.getZ(m)):y.set(t.getX(m),t.getY(m)),c.push(y)}if(e){let m=0;for(let y=0;y<c.length;y++)(c[y].x<c[m].x||c[y].x===c[m].x&&c[y].y<c[m].y)&&(m=y);m!==0&&(c=c.slice(m).concat(c.slice(0,m)))}const f=new s.bnF(c);return l.userData.__planarShape=f,f}};rd.PluginType="ShapeTubeExtrudePlugin",_0([Yn("Enabled")],rd.prototype,"enabled",void 0),_0([Pe("Shape Segments (X)",[1,100],1,l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"shapeSegments",void 0),_0([Pe("Tube Segments (Y)",[1,100],1,l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"tubularSegments",void 0),_0([Le("Shape scale",[.01,10],.01,l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"shapeScale",void 0),_0([Ke("Material Splits",l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"materialSplits",void 0),_0([Yn("Horizontal Splits",l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"horizontalSplits",void 0),_0([ht("Extrude Circle Tube",l=>({hidden:()=>{var e,t;return!((t=(e=l._viewer)==null?void 0:e.getPlugin(us))!=null&&t.getSelectedObject())}}))],rd.prototype,"extrudeCirceTube",void 0),rd=j1=_0([on("Extrude Tube Shapes")],rd);class V1 extends s.Ny0{getPoint(e,t){return super.getPoint(e,t||new s.Pa4)}}class JA extends Ri{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var o,c;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))==null||o.enable(JA.PluginType),this._fadeDisabled=!1));const t=(0,a.now)()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=t-1/60);let n=t-this._lastFrameTime;this._lastFrameTime=t;const i=(c=this._viewer.getPluginByType("Progressive"))==null?void 0:c.postFrameConvergedRecordingDelta();if(i&&i>0&&(n=i),i!==0&&(n*=1e3,!(n<=.001)&&(this._updaters.forEach(f=>{let m=n;f.time+m<0&&(m=-f.time),f.time+=m,Math.abs(m)>.001&&f.u(m)}),!this._fadeDisabled&&this.disableFrameFade))){const f=this._viewer.getPluginByType("FrameFade");f&&(f.disable(JA.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=ji(),n={id:t,options:e,stop:()=>{var i,o,c;(i=this.animations[t])!=null&&i._stop?(c=(o=this.animations[t])==null?void 0:o._stop)==null||c.call(o):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((i,o)=>{const c={driver:this.defaultDriver,...e,onComplete:()=>{var m;try{(m=e.onComplete)==null||m.call(e)}catch(y){return void o(y)}i()},onStop:()=>{var m;try{(m=e.onStop)==null||m.call(e)}catch(y){return void o(y)}i()}},f=Yr(c);this.animations[t]._stop=f.stop,this.animations[t].options=c}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}JA.PluginType="PopmotionPlugin";var G1,jf,Ea=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const zu=l=>({onChange:e=>{e.last&&l.onChange()}});let Vl=G1=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(l){Object.assign(this,l)}reset(){const l=this.onChange;Object.assign(this,new G1),this.onChange=l}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};Ea([Ke("Text",zu)],Vl.prototype,"text",void 0),Ea([Pe("Font Size",[2,400],1,zu)],Vl.prototype,"fontSize",void 0),Ea([Pe("Width",[2,4096],1,zu)],Vl.prototype,"width",void 0),Ea([Pe("Height",[2,4096],1,zu)],Vl.prototype,"height",void 0),Ea([Pe("X Offset",[-1024,1024],1,zu)],Vl.prototype,"xOffset",void 0),Ea([Pe("Y Offset",[-1024,1024],1,zu)],Vl.prototype,"yOffset",void 0),Ea([Pe("V-Width",[2,4096],1,zu)],Vl.prototype,"boxWidth",void 0),Ea([Pe("V-Height",[2,4096],1,zu)],Vl.prototype,"boxHeight",void 0),Ea([ct("Text Anchor",["start","middle","end"].map(l=>({label:l})),zu)],Vl.prototype,"textAnchor",void 0),Ea([Ke("Font",zu)],Vl.prototype,"fontFamily",void 0),Ea([Ke("Font Url",zu)],Vl.prototype,"fontPath",void 0),Ea([Yn("Mask Text",zu)],Vl.prototype,"maskText",void 0),Ea([Yn("Inner Shadow",zu)],Vl.prototype,"innerShadow",void 0),Ea([Lt("Text Color",zu)],Vl.prototype,"textColor",void 0),Ea([Lt("BG Fill",zu)],Vl.prototype,"bgFillColor",void 0),Ea([Lt("SVG BG",zu)],Vl.prototype,"svgBackground",void 0),Vl=G1=Ea([on("Text SVG Options")],Vl);const sC={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},ix=l=>({hidden:()=>{const e=l.getSelected();return!e||!e.userData[sd.PluginType]}});let sd=jf=class extends Ri{async onAdded(l){var e;await super.onAdded(l),(e=l.getPluginByType("Picking"))==null||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var l,e;return(e=(l=this._viewer)==null?void 0:l.getPluginByType("Picking"))==null?void 0:e.getSelectedObject()},this.options=new Vl,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var t,n,i,o,c,f;if(!this.enabled)return;const l=this.getSelected();if(!l)return void((n=(t=this.uiConfig).uiRefresh)==null?void 0:n.call(t,"postFrame",!0));const e=l.userData[jf.PluginType];if(!e)return this.options.reset(),this._lastMeta=void 0,void((o=(i=this.uiConfig).uiRefresh)==null?void 0:o.call(i,"postFrame",!0));this._lastMeta!==e&&(this.options.set(e),this._lastMeta=e),(f=(c=this.uiConfig).uiRefresh)==null||f.call(c,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const l=this.getSelected();l&&l.isMesh&&l.userData[jf.PluginType]&&this.updateText(l,this.options.toJSON())}async addTextToSelected(){var e;const l=this.getSelected();l&&l.isMesh?l.material?(l.userData[jf.PluginType]||!l.material.map||await((e=this._viewer)==null?void 0:e.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(l):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(l,e){return this.updateText(l,Object.assign(this.options.toJSON(),e))}async updateText(l,e){var o,c;if(!l.isMesh)return;if(!l.material)return void console.error("updateText: no material on mesh");let t=l.userData[jf.PluginType];t||(l.userData[jf.PluginType]=t={}),Object.assign(t,e);const n=l.material;n.map&&(n.map._isSimpleTextTexture&&n.map.dispose(),n.map=void 0),n.alphaMap&&(n.alphaMap._isSimpleTextTexture&&n.alphaMap.dispose(),n.alphaMap=void 0),n.bumpMap&&(n.bumpMap._isSimpleTextTexture&&n.bumpMap.dispose(),n.bumpMap=void 0);const i=await this.makeTextSvg(t);this.applyToMap&&(n.map=i),this.applyToAlphaMap&&(n.alphaMap=i,n.transparent=!0),this.applyToBumpMap&&(n.bumpMap=i),n.userData.inverseAlphaMap=this.inverseAlphaMap,n.setDirty(),n.needsUpdate=!0,(c=(o=this.uiConfig).uiRefresh)==null||c.call(o,"postFrame",!0)}async makeTextSvg(l){const e=l.fontFamily||"Arial",t=l.fontPath||this.fonts[e]||"";let n=l.style;if(t.length>0){const c=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${sC[c]||c});
            }`:"")}let i=function({text:c="Custom Text",svgBackground:f="#ffffff",xOffset:m=0,yOffset:y=0,width:w=1024,height:S=1024,boxWidth:C=1024,boxHeight:O=1024,fontFamily:N="",fontSize:H=32,maskText:q=!0,innerShadow:J=!0,bgFillColor:V="#000000",textColor:z="#ffffff",textAnchor:ue="middle",style:me=""}){return`
<svg style="background-color:${f}" width="${w}" height="${S}" viewBox="0 0 ${C} ${O}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${me}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${ue}; font-size: ${H}px; font-family: ${N||"Arial"}">
        <defs>

`+(q?`
<mask id="textMask">
<text style="fill:white; font-size: ${H}px;" x="${m+C/2}" y="${O/2+y+H/4}" > ${c} </text>
</mask>
`:"")+`

`+(J?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(q?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${C}" height="${O}" style="fill:${V}"/>
        <text style="${J?"filter: url(#innerShadow);":""} fill:${z};" x="${m+C/2}" y="${O/2+y+H/4}"> ${c} </text>

`+(q?`
        </g>
`:"")+`

    </g>
</svg>
`}({...l,fontFamily:e,style:n});i=await(0,a.embedUrlRefs)(i,async c=>this._getAssetData(c)),i=(0,a.svgUrl)(i);const o=await this._viewer.getManager().importer.importSinglePath(i,{generateMipmaps:!1,minFilter:s.wem});return o._isSimpleTextTexture=!0,o.flipY=!1,o.needsUpdate=!0,o}async _getAssetData(l){var t,n;if(l.startsWith("http://www.w3.org"))return l;const e=(n=(t=this._viewer)==null?void 0:t.getManager())==null?void 0:n.importer;if(!e)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new gM(e.loadingManager),processImported:!1};try{return await e.importPath(l,this._assetLoadOptions)}catch(i){return console.error(i),""}}};sd.PluginType="SimpleTextPlugin",Ea([ir(void 0,{params:ix})],sd.prototype,"options",void 0),Ea([Yn("Apply Map",ix),(0,a.onChange)(jf.prototype._paramsChanged)],sd.prototype,"applyToMap",void 0),Ea([Yn("Apply Bump Map",ix),(0,a.onChange)(jf.prototype._paramsChanged)],sd.prototype,"applyToBumpMap",void 0),Ea([Yn("Apply Alpha Map",ix),(0,a.onChange)(jf.prototype._paramsChanged)],sd.prototype,"applyToAlphaMap",void 0),Ea([Yn("Invert Alpha Map",ix),(0,a.onChange)(jf.prototype._paramsChanged)],sd.prototype,"inverseAlphaMap",void 0),Ea([ht("Add Text",l=>({hidden:()=>!l.getSelected()}))],sd.prototype,"addTextToSelected",null),sd=jf=Ea([on("Simple Text")],sd);class H1{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class dD{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class cg{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new cg;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let i=0;i<e.length;i++)this.plane.splitPolygon(e[i],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new cg),this.front.build(t)),n.length&&(this.back||(this.back=new cg),this.back.build(n))}}class od{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new od(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new od().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,i=t.y,o=t.z,c=e.x,f=e.y,m=e.z;return this.x=i*m-o*f,this.y=o*c-n*m,this.z=n*f-i*c,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new s.Pa4(this.x,this.y,this.z)}}class ky{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new ky(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,i,o){let c=0;const f=[];for(let m=0;m<e.vertices.length;m++){const y=this.normal.dot(e.vertices[m].pos)-this.w,w=y<-ky.EPSILON?2:y>ky.EPSILON?1:0;c|=w,f.push(w)}switch(c){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:i.push(e);break;case 2:o.push(e);break;case 3:{const m=[],y=[];for(let w=0;w<e.vertices.length;w++){const S=(w+1)%e.vertices.length,C=f[w],O=f[S],N=e.vertices[w],H=e.vertices[S];if(C!=2&&m.push(N),C!=1&&y.push(C!=2?N.clone():N),(C|O)==3){const q=(this.w-this.normal.dot(N.pos))/this.normal.dot(new od().copy(H.pos).sub(N.pos)),J=N.interpolate(H,q);m.push(J),y.push(J.clone())}}m.length>=3&&i.push(new ZA(m,e.shared)),y.length>=3&&o.push(new ZA(y,e.shared));break}}}static fromPoints(e,t,n){const i=new od().copy(t).sub(e).cross(new od().copy(n).sub(e)).normalize();return new ky(i.clone(),i.dot(e))}}ky.EPSILON=1e-5;class ZA{constructor(e,t){this.vertices=e,this.shared=t,this.plane=ky.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new ZA(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class jw{constructor(e,t,n,i){this.pos=new od().copy(e),this.normal=new od().copy(t),this.uv=new od().copy(n),this.uv.z=0,i&&(this.color=new od().copy(i))}clone(){return new jw(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new jw(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class nl{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new nl;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const i=e.attributes.position,o=e.attributes.normal,c=e.attributes.uv,f=e.attributes.color,m=e.groups;let y;if(e.index)y=e.index.array;else{y=new Array(i.array.length/i.itemSize|0);for(let S=0;S<y.length;S++)y[S]=S}const w=y.length/3|0;n=new Array(w);for(let S=0,C=0,O=y.length;S<O;S+=3,C++){const N=new Array(3);for(let H=0;H<3;H++){const q=y[S+H],J=3*q,V=2*q,z=i.array[J],ue=i.array[J+1],me=i.array[J+2],Te=o.array[J],Be=o.array[J+1],He=o.array[J+2],tt=c==null?void 0:c.array[V],lt=c==null?void 0:c.array[V+1];N[H]=new jw(new od(z,ue,me),new od(Te,Be,He),new od(tt,lt,0),f&&new od(f.array[V],f.array[V+1],f.array[V+2]))}if(t===void 0&&m&&m.length>0)for(const H of m)S>=H.start&&S<H.start+H.count&&(n[C]=new ZA(N,H.materialIndex));else n[C]=new ZA(N,t)}return nl.fromPolygons(n.filter(S=>!isNaN(S.plane.normal.x)))}static toGeometry(e,t){let n=0;const i=e.polygons;for(const O of i)n+=O.vertices.length-2;const o=new s.u9r,c=new H1(3*n*3),f=new H1(3*n*3),m=new dD(2*n*3);let y;const w=[],S=[];for(const O of i){const N=O.vertices,H=N.length;O.shared!==void 0&&(w[O.shared]||(w[O.shared]=[])),H&&N[0].color!==void 0&&(y||(y=new H1(3*n*3)));for(let q=3;q<=H;q++)(O.shared===void 0?S:w[O.shared]).push(c.top/3,c.top/3+1,c.top/3+2),c.write(N[0].pos),c.write(N[q-2].pos),c.write(N[q-1].pos),f.write(N[0].normal),f.write(N[q-2].normal),f.write(N[q-1].normal),m&&(m.write(N[0].uv),m.write(N[q-2].uv),m.write(N[q-1].uv)),y&&(y.write(N[0].color),y.write(N[q-2].color),y.write(N[q-1].color))}o.setAttribute("position",new s.TlE(c.array,3)),o.setAttribute("normal",new s.TlE(f.array,3)),m&&o.setAttribute("uv",new s.TlE(m.array,2)),y&&o.setAttribute("color",new s.TlE(y.array,3));for(let O=0;O<w.length;O++)w[O]===void 0&&(w[O]=[]);if(w.length){let O=[],N=0;for(let H=0;H<w.length;H++)o.addGroup(N,w[H].length,H),N+=w[H].length,O=O.concat(w[H]);o.addGroup(N,S.length,w.length),O=O.concat(S),o.setIndex(O)}const C=new s.yGw().copy(t).invert();return o.applyMatrix4(C),o.computeBoundingSphere(),o.computeBoundingBox(),o}static fromMesh(e,t){const n=nl.fromGeometry(e.geometry,t),i=new s.Pa4,o=new s.Vkp;o.getNormalMatrix(e.matrix);for(let c=0;c<n.polygons.length;c++){const f=n.polygons[c];for(let m=0;m<f.vertices.length;m++){const y=f.vertices[m];y.pos.copy(i.copy(y.pos.toVector3()).applyMatrix4(e.matrix)),y.normal.copy(i.copy(y.normal.toVector3()).applyMatrix3(o))}}return n}static toMesh(e,t,n){const i=nl.toGeometry(e,t),o=new s.Kj0(i,n);return o.matrix.copy(t),o.matrix.decompose(o.position,o.quaternion,o.scale),o.rotation.setFromQuaternion(o.quaternion),o.updateMatrixWorld(),o.castShadow=o.receiveShadow=!0,o}static union(e,t){const n=nl.fromMesh(e),i=nl.fromMesh(t);return nl.toMesh(n.union(i),e.matrix,e.material)}static subtract(e,t){const n=nl.fromMesh(e),i=nl.fromMesh(t);return nl.toMesh(n.subtract(i),e.matrix,e.material)}static intersect(e,t){const n=nl.fromMesh(e),i=nl.fromMesh(t);return nl.toMesh(n.intersect(i),e.matrix,e.material)}clone(){const e=new nl;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new cg(this.clone().polygons),n=new cg(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),nl.fromPolygons(t.allPolygons())}subtract(e){const t=new cg(this.clone().polygons),n=new cg(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),nl.fromPolygons(t.allPolygons())}intersect(e){const t=new cg(this.clone().polygons),n=new cg(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),nl.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return nl.toMesh(this,e,t)}toGeometry(e){return nl.toGeometry(this,e)}}var eb=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const W1=["union","subtract","intersect"];class j_ extends Ri{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[us],this.rootMesh=new s.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(us))==null||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();e&&e.geometry&&(e.userData._isCSGMesh||(e.userData.csgBrush||(e.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&(0,a.downloadBlob)(e,"csg."+e.ext)}async exportObject(){var i,o;const e=(o=(i=this._viewer)==null?void 0:i.getPluginByType("AssetExporterPlugin"))==null?void 0:o.exporter;if(!e||!this.rootObject)return;const t=this.rootMesh.visible;this.rootMesh.visible=!0;const n=await e.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=t,n}_updateSelectedProperties(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();e&&e.userData.csgBrush&&(e.userData.csgBrush.enabled=this.csgSelectedEnabled,e.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var t,n,i,o,c,f;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();e&&(this.csgSelectedEnabled=((i=e.userData.csgBrush)==null?void 0:i.enabled)??!1,this.csgSelectedOperation=((o=e.userData.csgBrush)==null?void 0:o.operation)??"union"),(f=(c=this.uiConfig)==null?void 0:c.uiRefresh)==null||f.call(c,"postFrame",!0)}_preFrame(){var t,n;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const e=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(t=this.rootObject)==null||t.modelObject.updateMatrixWorld(!0),(this.rootMesh.userData.dispose??this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(e)),this.rootMesh&&!this.rootMesh.parent&&((n=this.rootObject)==null||n.modelObject.add(this.rootMesh)),this.showResult?(e.forEach(i=>{i[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(e.forEach(i=>{i[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var t;const e=[];return(t=this._viewer)==null||t.scene.traverse(n=>{var i;n.isMesh&&n.geometry&&((i=n.userData.csgBrush)!=null&&i.enabled)&&e.push([n,n.userData.csgBrush.operation])}),e}_sceneUpdate(e){var t,n;(n=(t=e==null?void 0:e.object)==null?void 0:t.userData)!=null&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}eb([Yn("Show Result",l=>({onChange:()=>{var e;return(e=l._viewer)==null?void 0:e.setDirty()}}))],j_.prototype,"showResult",void 0),eb([ht("Make CSG Brush",l=>({hidden:()=>{var t,n;const e=(n=(t=l._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();return!(e!=null&&e.userData)||!!e.userData.csgBrush||e.userData._isCSGMesh}}))],j_.prototype,"makeSelectedCSGBrush",null),eb([Yn("Enabled",l=>({hidden:()=>{var t,n;const e=(n=(t=l._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:l._updateSelectedProperties}))],j_.prototype,"csgSelectedEnabled",void 0),eb([ct("Operation",W1.map(l=>({label:l})),l=>({hidden:()=>{var t,n;const e=(n=(t=l._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();return!e||!e.userData.csgBrush},onChange:l._updateSelectedProperties}))],j_.prototype,"csgSelectedOperation",void 0),eb([ht("Refresh CSG")],j_.prototype,"refreshCSG",null),eb([ht("Export Result",l=>({hidden:()=>{var e;return!((e=l._viewer)!=null&&e.getPluginByType("AssetExporterPlugin"))}}))],j_.prototype,"downloadObject",null);function oC(l,e){let t=new nl;const n=l.map(o=>o[0].material).flatMap(o=>o);l.forEach(([o,c])=>{if(!W1.includes(c))return void console.error(`Unknown operation ${c}`);o.updateMatrix(),o.updateMatrixWorld();const f=o.matrix;o.matrix=o.matrixWorld;let m=0;m=Array.isArray(o.material)?void 0:n.indexOf(o.material),t=t[c](nl.fromMesh(o,m)),o.matrix=f});const i=t.toMesh(e??new s.yGw().identity(),n);return i.userData._isCSGMesh=!0,i.geometry.groups=i.geometry.groups.filter(o=>o.count>0),i}let rx=class extends j_{_buildCSGMesh(l){return oC(l)}};rx.PluginType="CSGPluginBSP",rx=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("CSG Plugin (BSP)")],rx);const aC=0,lC=1,cC=3,uC=4;class V_{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,i=-1/0;for(let o=0,c=e.length;o<c;o++){const f=e[o][t];n=f<n?f:n,i=f>i?f:i}this.min=n,this.max=i}setFromPoints(e,t){let n=1/0,i=-1/0;for(let o=0,c=t.length;o<c;o++){const f=t[o],m=e.dot(f);n=m<n?m:n,i=m>i?m:i}this.min=n,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}V_.prototype.setFromBox=function(){const l=new s.Pa4;return function(e,t){const n=t.min,i=t.max;let o=1/0,c=-1/0;for(let f=0;f<=1;f++)for(let m=0;m<=1;m++)for(let y=0;y<=1;y++){l.x=n.x*f+i.x*(1-f),l.y=n.y*m+i.y*(1-m),l.z=n.z*y+i.z*(1-y);const w=e.dot(l);o=Math.min(w,o),c=Math.max(w,c)}this.min=o,this.max=c}}();const pD=function(){const l=new s.Pa4,e=new s.Pa4,t=new s.Pa4;return function(n,i,o){const c=n.start,f=l,m=i.start,y=e;t.subVectors(c,m),l.subVectors(n.end,n.start),e.subVectors(i.end,i.start);const w=t.dot(y),S=y.dot(f),C=y.dot(y),O=t.dot(f),N=f.dot(f)*C-S*S;let H,q;H=N!==0?(w*S-O*C)/N:0,q=(w+H*S)/C,o.x=H,o.y=q}}(),Q1=function(){const l=new s.FM8,e=new s.Pa4,t=new s.Pa4;return function(n,i,o,c){pD(n,i,l);let f=l.x,m=l.y;if(f>=0&&f<=1&&m>=0&&m<=1)return n.at(f,o),void i.at(m,c);if(f>=0&&f<=1)return m<0?i.at(0,c):i.at(1,c),void n.closestPointToPoint(c,!0,o);if(m>=0&&m<=1)return f<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,c);{let y,w;y=f<0?n.start:n.end,w=m<0?i.start:i.end;const S=e,C=t;return n.closestPointToPoint(w,!0,e),i.closestPointToPoint(y,!0,t),S.distanceToSquared(w)<=C.distanceToSquared(y)?(o.copy(S),void c.copy(w)):(o.copy(y),void c.copy(C))}}}(),fD=function(){const l=new s.Pa4,e=new s.Pa4,t=new s.JOQ,n=new s.Zzh;return function(i,o){const{radius:c,center:f}=i,{a:m,b:y,c:w}=o;if(n.start=m,n.end=y,n.closestPointToPoint(f,!0,l).distanceTo(f)<=c||(n.start=m,n.end=w,n.closestPointToPoint(f,!0,l).distanceTo(f)<=c)||(n.start=y,n.end=w,n.closestPointToPoint(f,!0,l).distanceTo(f)<=c))return!0;const S=o.getPlane(t);if(Math.abs(S.distanceToPoint(f))<=c){const C=S.projectPoint(f,e);if(o.containsPoint(C))return!0}return!1}}(),mD=1e-15;function tb(l){return Math.abs(l)<mD}class ug extends s.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new s.Pa4),this.satBounds=new Array(4).fill().map(()=>new V_),this.points=[this.a,this.b,this.c],this.sphere=new s.aLr,this.plane=new s.JOQ,this.needsUpdate=!0}intersectsSphere(e){return fD(e,this)}update(){const e=this.a,t=this.b,n=this.c,i=this.points,o=this.satAxes,c=this.satBounds,f=o[0],m=c[0];this.getNormal(f),m.setFromPoints(f,i);const y=o[1],w=c[1];y.subVectors(e,t),w.setFromPoints(y,i);const S=o[2],C=c[2];S.subVectors(t,n),C.setFromPoints(S,i);const O=o[3],N=c[3];O.subVectors(n,e),N.setFromPoints(O,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(f,e),this.needsUpdate=!1}}ug.prototype.closestPointToSegment=function(){const l=new s.Pa4,e=new s.Pa4,t=new s.Zzh;return function(n,i=null,o=null){const{start:c,end:f}=n,m=this.points;let y,w=1/0;for(let S=0;S<3;S++){const C=(S+1)%3;t.start.copy(m[S]),t.end.copy(m[C]),Q1(t,n,l,e),y=l.distanceToSquared(e),y<w&&(w=y,i&&i.copy(l),o&&o.copy(e))}return this.closestPointToPoint(c,l),y=c.distanceToSquared(l),y<w&&(w=y,i&&i.copy(l),o&&o.copy(c)),this.closestPointToPoint(f,l),y=f.distanceToSquared(l),y<w&&(w=y,i&&i.copy(l),o&&o.copy(f)),Math.sqrt(w)}}(),ug.prototype.intersectsTriangle=function(){const l=new ug,e=new Array(3),t=new Array(3),n=new V_,i=new V_,o=new s.Pa4,c=new s.Pa4,f=new s.Pa4,m=new s.Pa4,y=new s.Zzh,w=new s.Zzh,S=new s.Zzh;return function(C,O=null,N=!1){this.needsUpdate&&this.update(),C.isExtendedTriangle?C.needsUpdate&&C.update():(l.copy(C),l.update(),C=l);const H=this.plane,q=C.plane;if(Math.abs(H.normal.dot(q.normal))>1-1e-10){const J=this.satBounds,V=this.satAxes;t[0]=C.a,t[1]=C.b,t[2]=C.c;for(let me=0;me<4;me++){const Te=J[me],Be=V[me];if(n.setFromPoints(Be,t),Te.isSeparated(n))return!1}const z=C.satBounds,ue=C.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let me=0;me<4;me++){const Te=z[me],Be=ue[me];if(n.setFromPoints(Be,e),Te.isSeparated(n))return!1}for(let me=0;me<4;me++){const Te=V[me];for(let Be=0;Be<4;Be++){const He=ue[Be];if(o.crossVectors(Te,He),n.setFromPoints(o,e),i.setFromPoints(o,t),n.isSeparated(i))return!1}}return O&&(N||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),O.start.set(0,0,0),O.end.set(0,0,0)),!0}{const J=this.points;let V=!1,z=0;for(let at=0;at<3;at++){const St=J[at],mt=J[(at+1)%3];y.start.copy(St),y.end.copy(mt),y.delta(c);const gt=V?w.start:w.end,Ot=tb(q.distanceToPoint(St));if(tb(q.normal.dot(c))&&Ot){w.copy(y),z=2;break}if((q.intersectLine(y,gt)||Ot)&&!tb(gt.distanceTo(mt))){if(z++,V)break;V=!0}}if(z===1&&C.containsPoint(w.end))return O&&(O.start.copy(w.end),O.end.copy(w.end)),!0;if(z!==2)return!1;const ue=C.points;let me=!1,Te=0;for(let at=0;at<3;at++){const St=ue[at],mt=ue[(at+1)%3];y.start.copy(St),y.end.copy(mt),y.delta(f);const gt=me?S.start:S.end,Ot=tb(H.distanceToPoint(St));if(tb(H.normal.dot(f))&&Ot){S.copy(y),Te=2;break}if((H.intersectLine(y,gt)||Ot)&&!tb(gt.distanceTo(mt))){if(Te++,me)break;me=!0}}if(Te===1&&this.containsPoint(S.end))return O&&(O.start.copy(S.end),O.end.copy(S.end)),!0;if(Te!==2)return!1;if(w.delta(c),S.delta(f),c.dot(f)<0){let at=S.start;S.start=S.end,S.end=at}const Be=w.start.dot(c),He=w.end.dot(c),tt=S.start.dot(c),lt=S.end.dot(c);return(Be===lt||tt===He||He<tt!=Be<lt)&&(O&&(m.subVectors(w.start,S.start),m.dot(c)>0?O.start.copy(w.start):O.start.copy(S.start),m.subVectors(w.end,S.end),m.dot(c)<0?O.end.copy(w.end):O.end.copy(S.end)),!0)}}}(),ug.prototype.distanceToPoint=function(){const l=new s.Pa4;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}(),ug.prototype.distanceToTriangle=function(){const l=new s.Pa4,e=new s.Pa4,t=["a","b","c"],n=new s.Zzh,i=new s.Zzh;return function(o,c=null,f=null){const m=c||f?n:null;if(this.intersectsTriangle(o,m))return(c||f)&&(c&&m.getCenter(c),f&&m.getCenter(f)),0;let y=1/0;for(let w=0;w<3;w++){let S;const C=t[w],O=o[C];this.closestPointToPoint(O,l),S=O.distanceToSquared(l),S<y&&(y=S,c&&c.copy(l),f&&f.copy(O));const N=this[C];o.closestPointToPoint(N,l),S=N.distanceToSquared(l),S<y&&(y=S,c&&c.copy(N),f&&f.copy(l))}for(let w=0;w<3;w++){const S=t[w],C=t[(w+1)%3];n.set(this[S],this[C]);for(let O=0;O<3;O++){const N=t[O],H=t[(O+1)%3];i.set(o[N],o[H]),Q1(n,i,l,e);const q=l.distanceToSquared(e);q<y&&(y=q,c&&c.copy(l),f&&f.copy(e))}}return Math.sqrt(y)}}();const nb=1e-14,ib=1e-10,G_=new s.Zzh,Ml=new s.Zzh,H_=new s.Pa4,hC=new s.Pa4,sx=new s.JOQ,gD=new ug;function ox(l){return l.a.distanceToSquared(l.b)<nb||l.a.distanceToSquared(l.c)<nb||l.b.distanceToSquared(l.c)<nb}class _D{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new s.CJI),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class vD{constructor(){this.trianglePool=new _D,this.triangles=[],this.normal=new s.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:i}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let o=0,c=e.length;o<c;o++){const f=e[o];if(o===0)f.getNormal(i);else if(Math.abs(1-f.getNormal(H_).dot(i))>nb)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const m=n.getTriangle();m.copy(f),t.push(m)}else{e.getNormal(i);const o=n.getTriangle();o.copy(e),t.push(o)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(sx),Math.abs(1-Math.abs(sx.normal.dot(t)))<ib){const i=[e.a,e.b,e.c];for(let o=0;o<3;o++){const c=(o+1)%3,f=i[o],m=i[c];H_.subVectors(m,f).normalize(),hC.crossVectors(t,H_),sx.setFromNormalAndCoplanarPoint(hC,f),this.splitByPlane(sx,e,o)}for(let o=0,c=n.length;o<c;o++)n[o].coplanarCount=0}else this.splitByPlane(sx,e)}splitByPlane(e,t=null,n=-1){const{triangles:i,trianglePool:o}=this;let c=null;t!==null&&(c=gD,c.copy(t),c.needsUpdate=!0);for(let f=0,m=i.length;f<m;f++){const y=i[f],{a:w,b:S,c:C}=y;if(c&&!c.intersectsTriangle(y,G_,!0))continue;let O=0,N=-1,H=0,q=!1;const J=[w,S,C];for(let V=0;V<3;V++){const z=(V+1)%3;G_.start.copy(J[V]),G_.end.copy(J[z]);const ue=e.distanceToPoint(G_.start),me=e.distanceToPoint(G_.end);if(Math.abs(ue)<ib&&Math.abs(me)<ib){q=!0;break}if(Math.abs(ue)<ib)continue;ue>0&&H++;let Te=!!e.intersectLine(G_,H_);!Te&&Math.abs(me)<ib&&(H_.copy(G_.end),Te=!0),!Te||H_.distanceTo(G_.start)<nb||(H_.distanceTo(G_.end)<nb&&(N=V),O===0?Ml.start.copy(H_):Ml.end.copy(H_),O++)}if(!q)if(O===2&&Ml.distance()>ib)if(N!==-1){N=(N+1)%3;let V=0;V===N&&(V=(V+1)%3);let z=V+1;z===N&&(z=(z+1)%3);const ue=o.getTriangle();ue.a.copy(J[z]),ue.b.copy(Ml.end),ue.c.copy(Ml.start),ox(ue)||i.push(ue),y.a.copy(J[V]),y.b.copy(Ml.start),y.c.copy(Ml.end),ox(y)&&(i.splice(f,1),f--,m--)}else{const V=J.findIndex(Be=>H>=2?e.distanceToPoint(Be)<0:e.distanceToPoint(Be)>0);if(V===0){let Be=Ml.start;Ml.start=Ml.end,Ml.end=Be}else if(V===-1)continue;const z=(V+1)%3,ue=(V+2)%3,me=o.getTriangle(),Te=o.getTriangle();J[z].distanceToSquared(Ml.start)<J[ue].distanceToSquared(Ml.end)?(me.a.copy(J[z]),me.b.copy(Ml.start),me.c.copy(Ml.end),Te.a.copy(J[z]),Te.b.copy(J[ue]),Te.c.copy(Ml.start)):(me.a.copy(J[ue]),me.b.copy(Ml.start),me.c.copy(Ml.end),Te.a.copy(J[z]),Te.b.copy(J[ue]),Te.c.copy(Ml.end)),y.a.copy(J[V]),y.b.copy(Ml.end),y.c.copy(Ml.start),ox(me)||i.push(me),ox(Te)||i.push(Te),ox(y)&&(i.splice(f,1),f--,m--)}else O===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function dC(){return typeof SharedArrayBuffer<"u"}function yD(l){if(l.buffer instanceof SharedArrayBuffer)return l;const e=l.constructor,t=l.buffer,n=new SharedArrayBuffer(t.byteLength),i=new Uint8Array(t);return new Uint8Array(n).set(i,0),new e(n)}class pC{constructor(e,t=500){const n=dC()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:i}=this;e===null&&(e=~~(n.length*i));const o=new t(e);o.set(n,0),this.array=o}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let i=0,o=e.length;i<o;i++)t[n+i]=e[i];this.length+=e.length}clear(){this.length=0}}class AD{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let i=0;for(let o=0;o<t;o++)i+=n[o][e].length;return i}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const i={};t.push(i);for(const o in n)i[o]=new pC(n[o].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,i=n[0][e];if(i){if(i.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let o=0,c=n.length;o<c;o++)n[o][e]=new pC(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class bD{constructor(e){this.triangle=new s.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new s.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class fC{constructor(){this.data={}}addTriangleIntersection(e,t,n,i){const{data:o}=this;o[e]||(o[e]=new bD(t)),o[e].addTriangle(n,i)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const i in t)n.push(t[i].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,i=new Set,o=[],c=f=>{if(n[f])if(t!==null)n[f].intersects[t]&&o.push(n[f].intersects[t]);else{const m=n[f].intersects;for(const y in m)i.has(y)||(i.add(y),o.push(m[y]))}};if(e!==null)c(e);else for(const f in n)c(f);return o}reset(){this.data={}}}class xD{constructor(){this.enabled=!1,this.triangleIntersectsA=new fC,this.triangleIntersectsB=new fC,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,i){const{triangleIntersectsA:o,triangleIntersectsB:c}=this;o.addTriangleIntersection(e,t,n,i),c.addTriangleIntersection(n,i,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}class mC{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:i}=this;n[e]||(n[e]=[],i.push(e)),n[e].push(t)}}const v0=new s.zHn,gC=new s.yGw,dh=new s.CJI,W_=new s.Pa4,_C=new s.Ltg,vC=new s.Ltg,yC=new s.Ltg,q1=new s.Ltg,Vw=new s.Ltg,Gw=new s.Ltg,X1=new s.Zzh,Y1=new s.Pa4,K1=1e-8,wD=1e-15,Hw=-1,Ww=1,AC=-2,$1=2,Qw=0,qw=1,J1=2;let Xw=null;function bC(l){Xw=l}function xC(l,e){function t(){return Math.random()-.5}l.getNormal(Y1),v0.direction.copy(Y1),l.getMidpoint(v0.origin);let n=0,i=1/0;for(let o=0;o<3;o++){v0.direction.x+=t()*K1,v0.direction.y+=t()*K1,v0.direction.z+=t()*K1,v0.direction.multiplyScalar(-1);const c=e.raycastFirst(v0,s.ehD);if(c&&v0.direction.dot(c.face.normal)>0&&n++,c!==null&&(i=Math.min(i,c.distance)),i<=wD)return c.face.normal.dot(Y1)>0?$1:AC;if(n/3>.5||(o-n+1)/3>.5)break}return n/3>.5?Hw:Ww}function ED(l,e,t,n,i,o,c=!1){const f=t.attributes,m=t.index,y=3*l,w=m.getX(y+0),S=m.getX(y+1),C=m.getX(y+2);for(const O in o){const N=f[O],H=o[O];if(!(O in f))throw new Error(`CSG Operations: Attribute ${O} not available on geometry.`);const q=N.itemSize;O==="position"?(dh.a.fromBufferAttribute(N,w).applyMatrix4(n),dh.b.fromBufferAttribute(N,S).applyMatrix4(n),dh.c.fromBufferAttribute(N,C).applyMatrix4(n),Z1(dh.a,dh.b,dh.c,e,3,H,c)):O==="normal"?(dh.a.fromBufferAttribute(N,w).applyNormalMatrix(i),dh.b.fromBufferAttribute(N,S).applyNormalMatrix(i),dh.c.fromBufferAttribute(N,C).applyNormalMatrix(i),c&&(dh.a.multiplyScalar(-1),dh.b.multiplyScalar(-1),dh.c.multiplyScalar(-1)),Z1(dh.a,dh.b,dh.c,e,3,H,c,!0)):(_C.fromBufferAttribute(N,w),vC.fromBufferAttribute(N,S),yC.fromBufferAttribute(N,C),Z1(_C,vC,yC,e,q,H,c))}}function SD(l,e,t,n,i,o,c,f=!1){eS(l,n,i,o,c,f),eS(f?t:e,n,i,o,c,f),eS(f?e:t,n,i,o,c,f)}function wC(l,e,t=!1){switch(l){case aC:if(e===Ww||e===$1&&!t)return qw;break;case lC:if(t){if(e===Hw)return Qw}else if(e===Ww||e===AC)return qw;break;case cC:if(e===Hw)return Qw;if(e===Ww)return qw;break;case uC:if(e===Hw||e===$1&&!t)return qw;break;default:throw new Error(`Unrecognized CSG operation enum "${l}".`)}return J1}function Z1(l,e,t,n,i,o,c=!1,f=!1){const m=y=>{o.push(y.x),i>1&&o.push(y.y),i>2&&o.push(y.z),i>3&&o.push(y.w)};q1.set(0,0,0,0).addScaledVector(l,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),Vw.set(0,0,0,0).addScaledVector(l,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Gw.set(0,0,0,0).addScaledVector(l,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),f&&(q1.normalize(),Vw.normalize(),Gw.normalize()),m(q1),c?(m(Gw),m(Vw)):(m(Vw),m(Gw))}function eS(l,e,t,n,i,o=!1){for(const c in i){const f=e[c],m=i[c];if(!(c in e))throw new Error(`CSG Operations: Attribute ${c} no available on geometry.`);const y=f.itemSize;c==="position"?(W_.fromBufferAttribute(f,l).applyMatrix4(t),m.push(W_.x,W_.y,W_.z)):c==="normal"?(W_.fromBufferAttribute(f,l).applyNormalMatrix(n),o&&W_.multiplyScalar(-1),m.push(W_.x,W_.y,W_.z)):(m.push(f.getX(l)),y>1&&m.push(f.getY(l)),y>2&&m.push(f.getZ(l)),y>3&&m.push(f.getW(l)))}}const y0=new s.yGw,Yw=new s.Vkp,Uy=new s.CJI,Kw=new s.CJI,$w=new s.CJI,Jw=new s.CJI;function MD(l){for(const e of l)return e}function EC(l,e,t,n,i,o,c,f=0){const m=l.matrixWorld.determinant()<0;y0.copy(e.matrixWorld).invert().multiply(l.matrixWorld),Yw.getNormalMatrix(l.matrixWorld).multiplyScalar(m?-1:1);const y=l.geometry.groupIndices,w=l.geometry.index,S=l.geometry.attributes.position,C=e.geometry.boundsTree,O=e.geometry.index,N=e.geometry.attributes.position,H=t.ids,q=t.intersectionSet;for(let J=0,V=H.length;J<V;J++){const z=H[J],ue=f===-1?0:y[z]+f,me=c.getGroupSet(ue),Te=3*z,Be=w.getX(Te+0),He=w.getX(Te+1),tt=w.getX(Te+2);Uy.a.fromBufferAttribute(S,Be).applyMatrix4(y0),Uy.b.fromBufferAttribute(S,He).applyMatrix4(y0),Uy.c.fromBufferAttribute(S,tt).applyMatrix4(y0),o.initialize(Uy);const lt=q[z];for(let St=0,mt=lt.length;St<mt;St++){const gt=3*lt[St],Ot=O.getX(gt+0),Bt=O.getX(gt+1),Ft=O.getX(gt+2);Kw.a.fromBufferAttribute(N,Ot),Kw.b.fromBufferAttribute(N,Bt),Kw.c.fromBufferAttribute(N,Ft),o.splitByTriangle(Kw)}const at=o.triangles;for(let St=0,mt=at.length;St<mt;St++){const gt=at[St],Ot=wC(n,xC(gt,C),i);if(Ot!==J1){Uy.getBarycoord(gt.a,Jw.a),Uy.getBarycoord(gt.b,Jw.b),Uy.getBarycoord(gt.c,Jw.c);const Bt=Ot===Qw;ED(z,Jw,l.geometry,l.matrixWorld,Yw,me,m!==Bt)}}}return H.length}function SC(l,e,t,n,i,o,c=0){const f=l.matrixWorld.determinant()<0;y0.copy(e.matrixWorld).invert().multiply(l.matrixWorld),Yw.getNormalMatrix(l.matrixWorld).multiplyScalar(f?-1:1);const m=e.geometry.boundsTree,y=l.geometry.groupIndices,w=l.geometry.index,S=l.geometry.attributes,C=S.position,O=[],N=l.geometry.halfEdges,H=new Set;for(let q=0,J=w.count/3;q<J;q++)q in t.intersectionSet||H.add(q);for(;H.size>0;){const q=MD(H);H.delete(q),O.push(q);const J=3*q,V=w.getX(J+0),z=w.getX(J+1),ue=w.getX(J+2);$w.a.fromBufferAttribute(C,V).applyMatrix4(y0),$w.b.fromBufferAttribute(C,z).applyMatrix4(y0),$w.c.fromBufferAttribute(C,ue).applyMatrix4(y0);const me=wC(n,xC($w,m),i);for(;O.length>0;){const Te=O.pop(),Be=c===-1?0:y[Te]+c,He=o.getGroupSet(Be);for(let gt=0;gt<3;gt++){const Ot=N.getSiblingTriangleIndex(Te,gt);Ot!==-1&&H.has(Ot)&&(O.push(Ot),H.delete(Ot))}if(me===J1)continue;const tt=3*Te,lt=w.getX(tt+0),at=w.getX(tt+1),St=w.getX(tt+2),mt=me===Qw;SD(lt,at,St,S,l.matrixWorld,Yw,He,mt!==f)}}}const MC=0,TD=1,CD=2,tS=1.25,TC=1,nS=65535,RD=Math.pow(2,-24);class Zw{constructor(){}}function hg(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function CC(l){let e=-1,t=-1/0;for(let n=0;n<3;n++){const i=l[n+3]-l[n];i>t&&(t=i,e=n)}return e}function RC(l,e){e.set(l)}function IC(l,e,t){let n,i;for(let o=0;o<3;o++){const c=o+3;n=l[o],i=e[o],t[o]=n<i?n:i,n=l[c],i=e[c],t[c]=n>i?n:i}}function eE(l,e,t){for(let n=0;n<3;n++){const i=e[l+2*n],o=e[l+2*n+1],c=i-o,f=i+o;c<t[n]&&(t[n]=c),f>t[n+3]&&(t[n+3]=f)}}function ax(l){const e=l[3]-l[0],t=l[4]-l[1],n=l[5]-l[2];return 2*(e*t+t*n+n*e)}function iS(l,e,t,n,i=null){let o=1/0,c=1/0,f=1/0,m=-1/0,y=-1/0,w=-1/0,S=1/0,C=1/0,O=1/0,N=-1/0,H=-1/0,q=-1/0;const J=i!==null;for(let V=6*e,z=6*(e+t);V<z;V+=6){const ue=l[V+0],me=l[V+1],Te=ue-me,Be=ue+me;Te<o&&(o=Te),Be>m&&(m=Be),J&&ue<S&&(S=ue),J&&ue>N&&(N=ue);const He=l[V+2],tt=l[V+3],lt=He-tt,at=He+tt;lt<c&&(c=lt),at>y&&(y=at),J&&He<C&&(C=He),J&&He>H&&(H=He);const St=l[V+4],mt=l[V+5],gt=St-mt,Ot=St+mt;gt<f&&(f=gt),Ot>w&&(w=Ot),J&&St<O&&(O=St),J&&St>q&&(q=St)}n[0]=o,n[1]=c,n[2]=f,n[3]=m,n[4]=y,n[5]=w,J&&(i[0]=S,i[1]=C,i[2]=O,i[3]=N,i[4]=H,i[5]=q)}const Q_=32,ID=(l,e)=>l.candidate-e.candidate,A0=new Array(Q_).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),tE=new Float32Array(6);class dg{constructor(e,t,n){this.isOrientedBox=!0,this.min=new s.Pa4,this.max=new s.Pa4,this.matrix=new s.yGw,this.invMatrix=new s.yGw,this.points=new Array(8).fill().map(()=>new s.Pa4),this.satAxes=new Array(3).fill().map(()=>new s.Pa4),this.satBounds=new Array(3).fill().map(()=>new V_),this.alignedSatBounds=new Array(3).fill().map(()=>new V_),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}dg.prototype.update=function(){const l=this.matrix,e=this.min,t=this.max,n=this.points;for(let m=0;m<=1;m++)for(let y=0;y<=1;y++)for(let w=0;w<=1;w++){const S=n[1*m|2*y|4*w];S.x=m?t.x:e.x,S.y=y?t.y:e.y,S.z=w?t.z:e.z,S.applyMatrix4(l)}const i=this.satBounds,o=this.satAxes,c=n[0];for(let m=0;m<3;m++){const y=o[m],w=i[m],S=n[1<<m];y.subVectors(c,S),w.setFromPoints(y,n)}const f=this.alignedSatBounds;f[0].setFromPointsField(n,"x"),f[1].setFromPointsField(n,"y"),f[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dg.prototype.intersectsBox=function(){const l=new V_;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,i=this.satBounds,o=this.satAxes,c=this.alignedSatBounds;if(l.min=t.x,l.max=n.x,c[0].isSeparated(l)||(l.min=t.y,l.max=n.y,c[1].isSeparated(l))||(l.min=t.z,l.max=n.z,c[2].isSeparated(l)))return!1;for(let f=0;f<3;f++){const m=o[f],y=i[f];if(l.setFromBox(m,e),y.isSeparated(l))return!1}return!0}}(),dg.prototype.intersectsTriangle=function(){const l=new ug,e=new Array(3),t=new V_,n=new V_,i=new s.Pa4;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(l.copy(o),l.update(),o=l);const c=this.satBounds,f=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let S=0;S<3;S++){const C=c[S],O=f[S];if(t.setFromPoints(O,e),C.isSeparated(t))return!1}const m=o.satBounds,y=o.satAxes,w=this.points;for(let S=0;S<3;S++){const C=m[S],O=y[S];if(t.setFromPoints(O,w),C.isSeparated(t))return!1}for(let S=0;S<3;S++){const C=f[S];for(let O=0;O<4;O++){const N=y[O];if(i.crossVectors(C,N),t.setFromPoints(i,e),n.setFromPoints(i,w),t.isSeparated(n))return!1}}return!0}}(),dg.prototype.closestPointToPoint=function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},dg.prototype.distanceToPoint=function(){const l=new s.Pa4;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}(),dg.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new s.Zzh),t=new Array(12).fill().map(()=>new s.Zzh),n=new s.Pa4,i=new s.Pa4;return function(o,c=0,f=null,m=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(f||m)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),f&&f.copy(n),m&&m.copy(i)),0;const y=c*c,w=o.min,S=o.max,C=this.points;let O=1/0;for(let H=0;H<8;H++){const q=C[H];i.copy(q).clamp(w,S);const J=q.distanceToSquared(i);if(J<O&&(O=J,f&&f.copy(q),m&&m.copy(i),J<y))return Math.sqrt(J)}let N=0;for(let H=0;H<3;H++)for(let q=0;q<=1;q++)for(let J=0;J<=1;J++){const V=(H+1)%3,z=(H+2)%3,ue=1<<H|q<<V|J<<z,me=C[q<<V|J<<z],Te=C[ue];e[N].set(me,Te);const Be=l[H],He=l[V],tt=l[z],lt=t[N],at=lt.start,St=lt.end;at[Be]=w[Be],at[He]=q?w[He]:S[He],at[tt]=J?w[tt]:S[He],St[Be]=S[Be],St[He]=q?w[He]:S[He],St[tt]=J?w[tt]:S[He],N++}for(let H=0;H<=1;H++)for(let q=0;q<=1;q++)for(let J=0;J<=1;J++){i.x=H?S.x:w.x,i.y=q?S.y:w.y,i.z=J?S.z:w.z,this.closestPointToPoint(i,n);const V=i.distanceToSquared(n);if(V<O&&(O=V,f&&f.copy(n),m&&m.copy(i),V<y))return Math.sqrt(V)}for(let H=0;H<12;H++){const q=e[H];for(let J=0;J<12;J++){const V=t[J];Q1(q,V,n,i);const z=n.distanceToSquared(i);if(z<O&&(O=z,f&&f.copy(n),m&&m.copy(i),z<y))return Math.sqrt(z)}}return Math.sqrt(O)}}();const nE=new s.Pa4,iE=new s.Pa4,rE=new s.Pa4,PC=new s.FM8,DC=new s.FM8,OC=new s.FM8,BC=new s.Pa4;function LC(l,e,t,n,i){const o=3*n,c=l.index.getX(o),f=l.index.getX(o+1),m=l.index.getX(o+2),y=function(w,S,C,O,N,H,q){nE.fromBufferAttribute(S,O),iE.fromBufferAttribute(S,N),rE.fromBufferAttribute(S,H);const J=function(V,z,ue,me,Te,Be){let He;return He=Be===s._Li?V.intersectTriangle(me,ue,z,!0,Te):V.intersectTriangle(z,ue,me,Be!==s.ehD,Te),He===null?null:{distance:V.origin.distanceTo(Te),point:Te.clone()}}(w,nE,iE,rE,BC,q);if(J){C&&(PC.fromBufferAttribute(C,O),DC.fromBufferAttribute(C,N),OC.fromBufferAttribute(C,H),J.uv=s.CJI.getUV(BC,nE,iE,rE,PC,DC,OC,new s.FM8));const V={a:O,b:N,c:H,normal:new s.Pa4,materialIndex:0};s.CJI.getNormal(nE,iE,rE,V.normal),J.face=V,J.faceIndex=O}return J}(t,l.attributes.position,l.attributes.uv,c,f,m,e);return y?(y.faceIndex=n,i&&i.push(y),y):null}function pg(l,e,t,n){const i=l.a,o=l.b,c=l.c;let f=e,m=e+1,y=e+2;t&&(f=t.getX(e),m=t.getX(e+1),y=t.getX(e+2)),i.x=n.getX(f),i.y=n.getY(f),i.z=n.getZ(f),o.x=n.getX(m),o.y=n.getY(m),o.z=n.getZ(m),c.x=n.getX(y),c.y=n.getY(y),c.z=n.getZ(y)}function NC(l,e,t,n,i,o,c){const f=t.index,m=t.attributes.position;for(let y=l,w=e+l;y<w;y++)if(pg(c,3*y,f,m),c.needsUpdate=!0,n(c,y,i,o))return!0;return!1}class kC{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function b0(l,e){return e[l+15]===65535}function rb(l,e){return e[l+6]}function lx(l,e){return e[l+14]}function cx(l){return l+8}function ux(l,e){return e[l+6]}const sb=new s.ZzF,sE=new s.Pa4,PD=["x","y","z"];function rS(l,e,t,n,i){let o=2*l,c=ob,f=x0,m=w0;if(b0(o,f))(function(y,w,S,C,O,N){for(let H=C,q=C+O;H<q;H++)LC(y,w,S,H,N)})(e,t,n,rb(l,m),lx(o,f),i);else{const y=cx(l);oE(y,c,n,sE)&&rS(y,e,t,n,i);const w=ux(l,m);oE(w,c,n,sE)&&rS(w,e,t,n,i)}}function sS(l,e,t,n){let i=2*l,o=ob,c=x0,f=w0;if(b0(i,c))return function(m,y,w,S,C){let O=1/0,N=null;for(let H=S,q=S+C;H<q;H++){const J=LC(m,y,w,H);J&&J.distance<O&&(N=J,O=J.distance)}return N}(e,t,n,rb(l,f),lx(i,c));{const m=function(H,q){return q[H+7]}(l,f),y=PD[m],w=n.direction[y]>=0;let S,C;w?(S=cx(l),C=ux(l,f)):(S=ux(l,f),C=cx(l));const O=oE(S,o,n,sE)?sS(S,e,t,n):null;if(O){const H=O.point[y];if(w?H<=o[C+m]:H>=o[C+m+3])return O}const N=oE(C,o,n,sE)?sS(C,e,t,n):null;return O&&N?O.distance<=N.distance?O:N:O||N||null}}const DD=function(){let l,e;const t=[],n=new kC(()=>new s.ZzF);return function(...o){l=n.getPrimitive(),e=n.getPrimitive(),t.push(l,e);const c=i(...o);n.releasePrimitive(l),n.releasePrimitive(e),t.pop(),t.pop();const f=t.length;return f>0&&(e=t[f-1],l=t[f-2]),c};function i(o,c,f,m,y=null,w=0,S=0){function C(V){let z=2*V,ue=x0,me=w0;for(;!b0(z,ue);)z=2*(V=cx(V));return rb(V,me)}function O(V){let z=2*V,ue=x0,me=w0;for(;!b0(z,ue);)z=2*(V=ux(V,me));return rb(V,me)+lx(z,ue)}let N=2*o,H=ob,q=x0,J=w0;if(b0(N,q)){const V=rb(o,J),z=lx(N,q);return hg(o,H,l),m(V,z,!1,S,w+o,l)}{const V=cx(o),z=ux(o,J);let ue,me,Te,Be,He=V,tt=z;if(y&&(Te=l,Be=e,hg(He,H,Te),hg(tt,H,Be),ue=y(Te),me=y(Be),me<ue)){He=z,tt=V;const gt=ue;ue=me,me=gt,Te=Be}Te||(Te=l,hg(He,H,Te));const lt=f(Te,b0(2*He,q),ue,S+1,w+He);let at;if(lt===2){const gt=C(He);at=m(gt,O(He)-gt,!0,S+1,w+He,Te)}else at=lt&&i(He,c,f,m,y,w,S+1);if(at)return!0;Be=e,hg(tt,H,Be);const St=f(Be,b0(2*tt,q),me,S+1,w+tt);let mt;if(St===2){const gt=C(tt);mt=m(gt,O(tt)-gt,!0,S+1,w+tt,Be)}else mt=St&&i(tt,c,f,m,y,w,S+1);return!!mt}}}(),OD=function(){const l=new ug,e=new ug,t=new s.yGw,n=new dg,i=new dg;return function o(c,f,m,y,w=null){let S=2*c,C=ob,O=x0,N=w0;if(w===null&&(m.boundingBox||m.computeBoundingBox(),n.set(m.boundingBox.min,m.boundingBox.max,y),w=n),!b0(S,O)){const H=c+8,q=N[c+6];return hg(H,C,sb),w.intersectsBox(sb)&&o(H,f,m,y,w)?!0:(hg(q,C,sb),!(!w.intersectsBox(sb)||!o(q,f,m,y,w)))}{const H=f,q=H.index,J=H.attributes.position,V=m.index,z=m.attributes.position,ue=rb(c,N),me=lx(S,O);if(t.copy(y).invert(),m.boundsTree)return hg(c,C,i),i.matrix.copy(t),i.needsUpdate=!0,m.boundsTree.shapecast({intersectsBounds:Be=>i.intersectsBox(Be),intersectsTriangle:Be=>{Be.a.applyMatrix4(y),Be.b.applyMatrix4(y),Be.c.applyMatrix4(y),Be.needsUpdate=!0;for(let He=3*ue,tt=3*(me+ue);He<tt;He+=3)if(pg(e,He,q,J),e.needsUpdate=!0,Be.intersectsTriangle(e))return!0;return!1}});for(let Te=3*ue,Be=me+3*ue;Te<Be;Te+=3){pg(l,Te,q,J),l.a.applyMatrix4(t),l.b.applyMatrix4(t),l.c.applyMatrix4(t),l.needsUpdate=!0;for(let He=0,tt=V.count;He<tt;He+=3)if(pg(e,He,V,z),e.needsUpdate=!0,l.intersectsTriangle(e))return!0}}}}();function oE(l,e,t,n){return hg(l,e,sb),t.intersectBox(sb,n)}const oS=[];let aE,ob,x0,w0;function hx(l){aE&&oS.push(aE),aE=l,ob=new Float32Array(l),x0=new Uint16Array(l),w0=new Uint32Array(l)}function lE(){aE=null,ob=null,x0=null,w0=null,oS.length&&hx(oS.pop())}const aS=Symbol("skip tree generation"),lS=new s.ZzF,cS=new s.ZzF,ab=new s.yGw,Fy=new dg,dx=new dg,px=new s.Pa4,cE=new s.Pa4,BD=new s.Pa4,LD=new s.Pa4,ND=new s.Pa4,UC=new s.ZzF,fg=new kC(()=>new ug);class fx{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),fx.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,i=e._roots,o=n.getIndex();let c;return c=t.cloneBuffers?{roots:i.map(f=>f.slice()),index:o.array.slice()}:{roots:i,index:o.array},c}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),fx.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:i,roots:o}=e,c=new fx(t,{...n,[aS]:!0});if(c._roots=o,n.setIndex){const f=t.getIndex();if(f===null){const m=new s.TlE(e.index,1,!1);t.setIndex(m)}else f.array!==i&&(f.array.set(i),f.needsUpdate=!0)}return c}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:MC,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[aS]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[aS]||(this._roots=function(n,i){const o=function(O,N){function H(gt){tt&&tt(gt/lt)}function q(gt,Ot,Bt,Ft=null,_n=0){if(!at&&_n>=me&&(at=!0,Te&&(console.warn(`MeshBVH: Max depth of ${me} reached when generating BVH. Consider increasing maxDepth.`),console.warn(O))),Bt<=Be||_n>=me)return H(Ot+Bt),gt.offset=Ot,gt.count=Bt,gt;const mn=function(Rn,En,ai,ri,Ei,ki){let Xi=-1,ts=0;if(ki===MC)Xi=CC(En),Xi!==-1&&(ts=(En[Xi]+En[Xi+3])/2);else if(ki===TD)Xi=CC(Rn),Xi!==-1&&(ts=function(Cr,wr,zn,oi){let Ti=0;for(let Hr=wr,ps=wr+zn;Hr<ps;Hr++)Ti+=Cr[6*Hr+2*oi];return Ti/zn}(ai,ri,Ei,Xi));else if(ki===CD){const Cr=ax(Rn);let wr=tS*Ei;const zn=6*ri,oi=6*(ri+Ei);for(let Ti=0;Ti<3;Ti++){const Hr=En[Ti],ps=(En[Ti+3]-Hr)/Q_;if(Ei<Q_/4){const $r=[...A0];$r.length=Ei;let Fr=0;for(let lr=zn;lr<oi;lr+=6,Fr++){const Sn=$r[Fr];Sn.candidate=ai[lr+2*Ti],Sn.count=0;const{bounds:Si,leftCacheBounds:dr,rightCacheBounds:mi}=Sn;for(let Br=0;Br<3;Br++)mi[Br]=1/0,mi[Br+3]=-1/0,dr[Br]=1/0,dr[Br+3]=-1/0,Si[Br]=1/0,Si[Br+3]=-1/0;eE(lr,ai,Si)}$r.sort(ID);let zr=Ei;for(let lr=0;lr<zr;lr++){const Sn=$r[lr];for(;lr+1<zr&&$r[lr+1].candidate===Sn.candidate;)$r.splice(lr+1,1),zr--}for(let lr=zn;lr<oi;lr+=6){const Sn=ai[lr+2*Ti];for(let Si=0;Si<zr;Si++){const dr=$r[Si];Sn>=dr.candidate?eE(lr,ai,dr.rightCacheBounds):(eE(lr,ai,dr.leftCacheBounds),dr.count++)}}for(let lr=0;lr<zr;lr++){const Sn=$r[lr],Si=Sn.count,dr=Ei-Sn.count,mi=Sn.leftCacheBounds,Br=Sn.rightCacheBounds;let Qo=0;Si!==0&&(Qo=ax(mi)/Cr);let ma=0;dr!==0&&(ma=ax(Br)/Cr);const rl=TC+tS*(Qo*Si+ma*dr);rl<wr&&(Xi=Ti,wr=rl,ts=Sn.candidate)}}else{for(let zr=0;zr<Q_;zr++){const lr=A0[zr];lr.count=0,lr.candidate=Hr+ps+zr*ps;const Sn=lr.bounds;for(let Si=0;Si<3;Si++)Sn[Si]=1/0,Sn[Si+3]=-1/0}for(let zr=zn;zr<oi;zr+=6){let lr=~~((ai[zr+2*Ti]-Hr)/ps);lr>=Q_&&(lr=Q_-1);const Sn=A0[lr];Sn.count++,eE(zr,ai,Sn.bounds)}const $r=A0[Q_-1];RC($r.bounds,$r.rightCacheBounds);for(let zr=Q_-2;zr>=0;zr--){const lr=A0[zr],Sn=A0[zr+1];IC(lr.bounds,Sn.rightCacheBounds,lr.rightCacheBounds)}let Fr=0;for(let zr=0;zr<Q_-1;zr++){const lr=A0[zr],Sn=lr.count,Si=lr.bounds,dr=A0[zr+1].rightCacheBounds;Sn!==0&&(Fr===0?RC(Si,tE):IC(Si,tE,tE)),Fr+=Sn;let mi=0,Br=0;Fr!==0&&(mi=ax(tE)/Cr);const Qo=Ei-Fr;Qo!==0&&(Br=ax(dr)/Cr);const ma=TC+tS*(mi*Fr+Br*Qo);ma<wr&&(Xi=Ti,wr=ma,ts=lr.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${ki} used.`);return{axis:Xi,pos:ts}}(gt.boundingData,Ft,z,Ot,Bt,He);if(mn.axis===-1)return H(Ot+Bt),gt.offset=Ot,gt.count=Bt,gt;const qn=function(Rn,En,ai,ri,Ei){let ki=ai,Xi=ai+ri-1;const ts=Ei.pos,Cr=2*Ei.axis;for(;;){for(;ki<=Xi&&En[6*ki+Cr]<ts;)ki++;for(;ki<=Xi&&En[6*Xi+Cr]>=ts;)Xi--;if(!(ki<Xi))return ki;for(let wr=0;wr<3;wr++){let zn=Rn[3*ki+wr];Rn[3*ki+wr]=Rn[3*Xi+wr],Rn[3*Xi+wr]=zn;let oi=En[6*ki+2*wr+0];En[6*ki+2*wr+0]=En[6*Xi+2*wr+0],En[6*Xi+2*wr+0]=oi;let Ti=En[6*ki+2*wr+1];En[6*ki+2*wr+1]=En[6*Xi+2*wr+1],En[6*Xi+2*wr+1]=Ti}ki++,Xi--}}(ue,z,Ot,Bt,mn);if(qn===Ot||qn===Ot+Bt)H(Ot+Bt),gt.offset=Ot,gt.count=Bt;else{gt.splitAxis=mn.axis;const Rn=new Zw,En=Ot,ai=qn-Ot;gt.left=Rn,Rn.boundingData=new Float32Array(6),iS(z,En,ai,Rn.boundingData,V),q(Rn,En,ai,V,_n+1);const ri=new Zw,Ei=qn,ki=Bt-ai;gt.right=ri,ri.boundingData=new Float32Array(6),iS(z,Ei,ki,ri.boundingData,V),q(ri,Ei,ki,V,_n+1)}return gt}(function(gt,Ot){if(!gt.index){const Bt=gt.attributes.position.count,Ft=Ot.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let _n;_n=Bt>65535?new Uint32Array(new Ft(4*Bt)):new Uint16Array(new Ft(2*Bt)),gt.setIndex(new s.TlE(_n,1));for(let mn=0;mn<Bt;mn++)_n[mn]=mn}})(O,N);const J=new Float32Array(6),V=new Float32Array(6),z=function(gt,Ot){const Bt=gt.attributes.position,Ft=gt.index.array,_n=Ft.length/3,mn=new Float32Array(6*_n),qn=Bt.normalized,Rn=Bt.array,En=Bt.offset||0;let ai=3;Bt.isInterleavedBufferAttribute&&(ai=Bt.data.stride);const ri=["getX","getY","getZ"];for(let Ei=0;Ei<_n;Ei++){const ki=3*Ei,Xi=6*Ei;let ts,Cr,wr;qn?(ts=Ft[ki+0],Cr=Ft[ki+1],wr=Ft[ki+2]):(ts=Ft[ki+0]*ai+En,Cr=Ft[ki+1]*ai+En,wr=Ft[ki+2]*ai+En);for(let zn=0;zn<3;zn++){let oi,Ti,Hr;qn?(oi=Bt[ri[zn]](ts),Ti=Bt[ri[zn]](Cr),Hr=Bt[ri[zn]](wr)):(oi=Rn[ts+zn],Ti=Rn[Cr+zn],Hr=Rn[wr+zn]);let ps=oi;Ti<ps&&(ps=Ti),Hr<ps&&(ps=Hr);let $r=oi;Ti>$r&&($r=Ti),Hr>$r&&($r=Hr);const Fr=($r-ps)/2,zr=2*zn;mn[Xi+zr+0]=ps+Fr,mn[Xi+zr+1]=Fr+(Math.abs(ps)+Fr)*RD,ps<Ot[zn]&&(Ot[zn]=ps),$r>Ot[zn+3]&&(Ot[zn+3]=$r)}}return mn}(O,J),ue=O.index.array,me=N.maxDepth,Te=N.verbose,Be=N.maxLeafTris,He=N.strategy,tt=N.onProgress,lt=O.index.count/3;let at=!1;const St=[],mt=function(gt){if(!gt.groups||!gt.groups.length)return[{offset:0,count:gt.index.count/3}];const Ot=[],Bt=new Set;for(const _n of gt.groups)Bt.add(_n.start),Bt.add(_n.start+_n.count);const Ft=Array.from(Bt.values()).sort((_n,mn)=>_n-mn);for(let _n=0;_n<Ft.length-1;_n++){const mn=Ft[_n],qn=Ft[_n+1];Ot.push({offset:mn/3,count:(qn-mn)/3})}return Ot}(O);if(mt.length===1){const gt=mt[0],Ot=new Zw;Ot.boundingData=J,function(Bt,Ft,_n,mn){let qn=1/0,Rn=1/0,En=1/0,ai=-1/0,ri=-1/0,Ei=-1/0;for(let ki=6*Ft,Xi=6*(Ft+_n);ki<Xi;ki+=6){const ts=Bt[ki+0];ts<qn&&(qn=ts),ts>ai&&(ai=ts);const Cr=Bt[ki+2];Cr<Rn&&(Rn=Cr),Cr>ri&&(ri=Cr);const wr=Bt[ki+4];wr<En&&(En=wr),wr>Ei&&(Ei=wr)}mn[0]=qn,mn[1]=Rn,mn[2]=En,mn[3]=ai,mn[4]=ri,mn[5]=Ei}(z,gt.offset,gt.count,V),q(Ot,gt.offset,gt.count,V),St.push(Ot)}else for(let gt of mt){const Ot=new Zw;Ot.boundingData=new Float32Array(6),iS(z,gt.offset,gt.count,Ot.boundingData,V),q(Ot,gt.offset,gt.count,V),St.push(Ot)}return St}(n,i);let c,f,m;const y=[],w=i.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let O=0;O<o.length;O++){const N=o[O],H=new w(32*S(N));c=new Float32Array(H),f=new Uint32Array(H),m=new Uint16Array(H),C(0,N),y.push(H)}return y;function S(O){return O.count?1:1+S(O.left)+S(O.right)}function C(O,N){const H=O/4,q=O/2,J=!!N.count,V=N.boundingData;for(let z=0;z<6;z++)c[H+z]=V[z];if(J){const z=N.offset,ue=N.count;return f[H+6]=z,m[q+14]=ue,m[q+15]=nS,O+32}{const z=N.left,ue=N.right,me=N.splitAxis;let Te;if(Te=C(O+32,z),Te/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return f[H+6]=Te/4,Te=C(Te,ue),f[H+7]=me,Te}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new s.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,i=t.attributes.position;let o,c,f,m,y=0;const w=this._roots;for(let C=0,O=w.length;C<O;C++)o=w[C],c=new Uint32Array(o),f=new Uint16Array(o),m=new Float32Array(o),S(0,y),y+=o.byteLength;function S(C,O,N=!1){const H=2*C;if(f[H+15]===nS){const q=c[C+6];let J=1/0,V=1/0,z=1/0,ue=-1/0,me=-1/0,Te=-1/0;for(let Be=3*q,He=3*(q+f[H+14]);Be<He;Be++){const tt=n[Be],lt=i.getX(tt),at=i.getY(tt),St=i.getZ(tt);lt<J&&(J=lt),lt>ue&&(ue=lt),at<V&&(V=at),at>me&&(me=at),St<z&&(z=St),St>Te&&(Te=St)}return(m[C+0]!==J||m[C+1]!==V||m[C+2]!==z||m[C+3]!==ue||m[C+4]!==me||m[C+5]!==Te)&&(m[C+0]=J,m[C+1]=V,m[C+2]=z,m[C+3]=ue,m[C+4]=me,m[C+5]=Te,!0)}{const q=C+8,J=c[C+6],V=q+O,z=J+O;let ue=N,me=!1,Te=!1;e?ue||(me=e.has(V),Te=e.has(z),ue=!me&&!Te):(me=!0,Te=!0);const Be=ue||Te;let He=!1;(ue||me)&&(He=S(q,O,ue));let tt=!1;Be&&(tt=S(J,O,ue));const lt=He||tt;if(lt)for(let at=0;at<3;at++){const St=q+at,mt=J+at,gt=m[St],Ot=m[St+3],Bt=m[mt],Ft=m[mt+3];m[C+at]=gt<Bt?gt:Bt,m[C+at+3]=Ot>Ft?Ot:Ft}return lt}}}traverse(e,t=0){const n=this._roots[t],i=new Uint32Array(n),o=new Uint16Array(n);(function c(f,m=0){const y=2*f,w=o[y+15]===nS;if(w){const S=i[f+6],C=o[y+14];e(m,w,new Float32Array(n,4*f,6),S,C)}else{const S=f+8,C=i[f+6],O=i[f+7];e(m,w,new Float32Array(n,4*f,6),O)||(c(S,m+1),c(C,m+1))}})(0)}raycast(e,t=s.Wl3){const n=this._roots,i=this.geometry,o=[],c=t.isMaterial,f=Array.isArray(t),m=i.groups,y=c?t.side:t;for(let w=0,S=n.length;w<S;w++){const C=f?t[m[w].materialIndex].side:y,O=o.length;if(hx(n[w]),rS(0,i,C,e,o),lE(),f){const N=m[w].materialIndex;for(let H=O,q=o.length;H<q;H++)o[H].face.materialIndex=N}}return o}raycastFirst(e,t=s.Wl3){const n=this._roots,i=this.geometry,o=t.isMaterial,c=Array.isArray(t);let f=null;const m=i.groups,y=o?t.side:t;for(let w=0,S=n.length;w<S;w++){const C=c?t[m[w].materialIndex].side:y;hx(n[w]);const O=sS(0,i,C,e);lE(),O!=null&&(f==null||O.distance<f.distance)&&(f=O,c&&(O.face.materialIndex=m[w].materialIndex))}return f}intersectsGeometry(e,t){const n=this.geometry;let i=!1;for(const o of this._roots)if(hx(o),i=OD(0,n,e,t),lE(),i)break;return i}shapecast(e,t,n){const i=this.geometry;if(e instanceof Function){if(t){const C=t;t=(O,N,H,q)=>{const J=3*N;return C(O,J,J+1,J+2,H,q)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const o=fg.getPrimitive();let{boundsTraverseOrder:c,intersectsBounds:f,intersectsRange:m,intersectsTriangle:y}=e;if(m&&y){const C=m;m=(O,N,H,q,J)=>!!C(O,N,H,q,J)||NC(O,N,i,y,H,q,o)}else m||(m=y?(C,O,N,H)=>NC(C,O,i,y,N,H,o):(C,O,N)=>N);let w=!1,S=0;for(const C of this._roots){if(hx(C),w=DD(0,i,f,m,c,S),lE(),w)break;S+=C.byteLength}return fg.releasePrimitive(o),w}bvhcast(e,t,n){let{intersectsRanges:i,intersectsTriangles:o}=n;const c=this.geometry.index,f=this.geometry.attributes.position,m=e.geometry.index,y=e.geometry.attributes.position;ab.copy(t).invert();const w=fg.getPrimitive(),S=fg.getPrimitive();if(o){let O=function(N,H,q,J,V,z,ue,me){for(let Te=q,Be=q+J;Te<Be;Te++){pg(S,3*Te,m,y),S.a.applyMatrix4(t),S.b.applyMatrix4(t),S.c.applyMatrix4(t),S.needsUpdate=!0;for(let He=N,tt=N+H;He<tt;He++)if(pg(w,3*He,c,f),w.needsUpdate=!0,o(w,S,He,Te,V,z,ue,me))return!0}return!1};if(i){const N=i;i=function(H,q,J,V,z,ue,me,Te){return!!N(H,q,J,V,z,ue,me,Te)||O(H,q,J,V,z,ue,me,Te)}}else i=O}e.getBoundingBox(cS),cS.applyMatrix4(t);const C=this.shapecast({intersectsBounds:O=>cS.intersectsBox(O),intersectsRange:(O,N,H,q,J,V)=>(lS.copy(V),lS.applyMatrix4(ab),e.shapecast({intersectsBounds:z=>lS.intersectsBox(z),intersectsRange:(z,ue,me,Te,Be)=>i(O,N,z,ue,q,J,Te,Be)}))});return fg.releasePrimitive(w),fg.releasePrimitive(S),C}intersectsBox(e,t){return Fy.set(e.min,e.max,t),Fy.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Fy.intersectsBox(n),intersectsTriangle:n=>Fy.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},i={},o=0,c=1/0){e.boundingBox||e.computeBoundingBox(),Fy.set(e.boundingBox.min,e.boundingBox.max,t),Fy.needsUpdate=!0;const f=this.geometry,m=f.attributes.position,y=f.index,w=e.attributes.position,S=e.index,C=fg.getPrimitive(),O=fg.getPrimitive();let N=cE,H=BD,q=null,J=null;i&&(q=LD,J=ND);let V=1/0,z=null,ue=null;return ab.copy(t).invert(),dx.matrix.copy(ab),this.shapecast({boundsTraverseOrder:me=>Fy.distanceToBox(me),intersectsBounds:(me,Te,Be)=>Be<V&&Be<c&&(Te&&(dx.min.copy(me.min),dx.max.copy(me.max),dx.needsUpdate=!0),!0),intersectsRange:(me,Te)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Be=>dx.distanceToBox(Be),intersectsBounds:(Be,He,tt)=>tt<V&&tt<c,intersectsRange:(Be,He)=>{for(let tt=3*Be,lt=3*(Be+He);tt<lt;tt+=3){pg(O,tt,S,w),O.a.applyMatrix4(t),O.b.applyMatrix4(t),O.c.applyMatrix4(t),O.needsUpdate=!0;for(let at=3*me,St=3*(me+Te);at<St;at+=3){pg(C,at,y,m),C.needsUpdate=!0;const mt=C.distanceToTriangle(O,N,q);if(mt<V&&(H.copy(N),J&&J.copy(q),V=mt,z=at/3,ue=tt/3),mt<o)return!0}}}});for(let Be=0,He=S?S.count:w.count;Be<He;Be+=3){pg(O,Be,S,w),O.a.applyMatrix4(t),O.b.applyMatrix4(t),O.c.applyMatrix4(t),O.needsUpdate=!0;for(let tt=3*me,lt=3*(me+Te);tt<lt;tt+=3){pg(C,tt,y,m),C.needsUpdate=!0;const at=C.distanceToTriangle(O,N,q);if(at<V&&(H.copy(N),J&&J.copy(q),V=at,z=tt/3,ue=Be/3),at<o)return!0}}}}),fg.releasePrimitive(C),fg.releasePrimitive(O),V===1/0?null:(n.point?n.point.copy(H):n.point=H.clone(),n.distance=V,n.faceIndex=z,i&&(i.point?i.point.copy(J):i.point=J.clone(),i.point.applyMatrix4(ab),H.applyMatrix4(ab),i.distance=H.sub(i.point).length(),i.faceIndex=ue),n)}closestPointToPoint(e,t={},n=0,i=1/0){const o=n*n,c=i*i;let f=1/0,m=null;if(this.shapecast({boundsTraverseOrder:w=>(px.copy(e).clamp(w.min,w.max),px.distanceToSquared(e)),intersectsBounds:(w,S,C)=>C<f&&C<c,intersectsTriangle:(w,S)=>{w.closestPointToPoint(e,px);const C=e.distanceToSquared(px);return C<f&&(cE.copy(px),f=C,m=S),C<o}}),f===1/0)return null;const y=Math.sqrt(f);return t.point?t.point.copy(cE):t.point=cE.clone(),t.distance=y,t.faceIndex=m,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{hg(0,new Float32Array(t),UC),e.union(UC)}),e}}const kD=1e6*(1+1e-7);function uS(l){return~~(l*kD)}function FC(l){return`${uS(l.x)},${uS(l.y)},${uS(l.z)}`}const hS=[new s.Pa4,new s.Pa4,new s.Pa4];class UD{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,i=e.index,o=n.position;let c=i?i.count/3:o.count/3;const f=c;let m=0;this.useDrawRange&&(m=e.drawRange.start,e.drawRange.count!==1/0&&(c=~~(e.drawRange.count/3)));let y=this.data;(!y||y.length<3*f)&&(y=new Int32Array(3*f)),y.fill(-1);let w=0,S=0;for(let C=0;C<c;C++){const O=3*C+m;for(let N=0;N<3;N++){let H=O+N;i&&(H=i.getX(H)),hS[N].fromBufferAttribute(o,H)}for(let N=0;N<3;N++){const H=(N+1)%3,q=hS[N],J=hS[H],V=FC(q),z=FC(J),ue=`${z}_${V}`;if(t.has(ue)){const me=t.get(ue);y[O+N]=me,y[me]=O+N,t.delete(ue),w--,S++}else{const me=`${V}_${z}`;t.set(me,O+N),w++}}}this.matchedEdges=S,this.unmatchedEdges=w,this.data=y}}class uE extends s.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new s.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,i=t.elements;for(let o=0;o<16;o++)if(n[o]!==i[o])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(dC())for(const n in t){const i=t[n];if(i.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");i.array=yD(i.array)}if(e.boundsTree||(e.boundsTree=new fx(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new UD(e)),!e.groupIndices){const n=e.index.count/3,i=new Uint16Array(n),o=e.groups;for(let c=0,f=o.length;c<f;c++){const{start:m,count:y}=o[c];for(let w=m/3,S=(m+y)/3;w<S;w++)i[w]=c}e.groupIndices=i}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function zC(l,e){let t=e;return Array.isArray(e)||(t=[],l.forEach(n=>{t[n.materialIndex]=e})),t}class FD{constructor(){this.triangleSplitter=new vD,this.attributeData=new AD,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new xD}evaluate(e,t,n,i=new uE){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:o,attributeData:c,attributes:f,useGroups:m,debug:y}=this,w=i.geometry,S=e.geometry.attributes;for(let J=0,V=f.length;J<V;J++){const z=f[J],ue=S[z];c.initializeArray(z,ue.array.constructor)}for(const J in c.attributes)f.includes(J)||c.delete(J);for(const J in w.attributes)f.includes(J)||(w.deleteAttribute(J),w.dispose());c.clear(),y.enabled&&(y.reset(),bC(y)),function(J,V,z,ue,me,Te){const{useGroups:Be=!0}=Te,{aIntersections:He,bIntersections:tt}=function(at,St){const mt=new mC,gt=new mC;return gC.copy(at.matrixWorld).invert().multiply(St.matrixWorld),at.geometry.boundsTree.bvhcast(St.geometry.boundsTree,gC,{intersectsTriangles(Ot,Bt,Ft,_n){if(Ot.intersectsTriangle(Bt,X1,!0)){if(X1.distanceSq()===0&&Ot.plane.normal.dot(Bt.plane.normal)<1-1e-10)return!1;mt.add(Ft,_n),gt.add(_n,Ft),Xw&&(Xw.addEdge(X1),Xw.addIntersectingTriangles(Ft,Ot,_n,Bt))}return!1}}),{aIntersections:mt,bIntersections:gt}}(J,V);let lt;lt=Be?0:-1,SC(J,V,He,z,!1,me,lt),EC(J,V,He,z,!1,ue,me,lt),lt=Be?J.geometry.groups.length||1:-1,SC(V,J,tt,z,!0,me,lt),EC(V,J,tt,z,!0,ue,me,lt)}(e,t,n,o,c,{useGroups:m}),y.enabled&&bC(null);const C=m&&e.geometry.groups.length!==0?e.geometry.groups.map(J=>({...J})):[{start:0,count:1/0,materialIndex:0}],O=m&&t.geometry.groups.length!==0?t.geometry.groups.map(J=>({...J})):[{start:0,count:1/0,materialIndex:0}],N=zC(C,e.material),H=zC(O,t.material);O.forEach(J=>{J.materialIndex+=N.length}),function(J,V,z,ue){let me=!1,Te=-1;const Be=ue.groupCount,He=J.attributes,tt=ue.groupAttributes[0];for(const at in tt){const St=ue.getTotalLength(at,Be),mt=tt[at].type;let gt=He[at];if(!gt||gt.array.length<St){const Bt=V.attributes[at];gt=new s.TlE(new mt(St),Bt.itemSize,Bt.normalized),J.setAttribute(at,gt),me=!0}let Ot=0;for(let Bt=0;Bt<Be;Bt++){const{array:Ft,type:_n,length:mn}=ue.groupAttributes[Bt][at],qn=new _n(Ft.buffer,0,mn);gt.array.set(qn,Ot),Ot+=qn.length}gt.needsUpdate=!0,Te=St/gt.itemSize}J.setDrawRange(0,Te),J.clearGroups();let lt=0;for(let at=0;at<Be;at++){const St=ue.getGroupArray("position",at).length/3;if(St!==0){const mt=z[at];J.addGroup(lt,St,mt.materialIndex),lt+=St}}if(J.index){const at=J.index.array;if(at.length<Te)J.index=null,me=!0;else for(let St=0,mt=at.length;St<mt;St++)at[St]=St}J.boundsTree=null,me&&J.dispose()}(w,e.geometry,[...C,...O],c);const q=w.groups;if(m){const J=new Map,V=[...N,...H];let z=0;for(let ue=0,me=V.length;ue<me;ue++)q.find(Te=>Te.materialIndex===ue)?(J.set(ue,z),z++):V[ue]=null;for(let ue=0,me=q.length;ue<me;ue++){const Te=q[ue];Te.materialIndex=J.get(Te.materialIndex)}i.material=V.filter(ue=>ue)}return i}evaluateHierarchy(e,t=new uE){e.updateMatrixWorld(!0);const n=(o,c)=>{const f=o.children;for(let m=0,y=f.length;m<y;m++){const w=f[m];w.isOperationGroup?n(w,c):c(w)}},i=o=>{const c=o.children;let f=!1;for(let y=0,w=c.length;y<w;y++){const S=c[y];f=i(S)||f}const m=o.isDirty();if(m&&o.markUpdated(),f&&!o.isOperationGroup){let y;return n(o,w=>{y=y?this.evaluate(y,w,w.operation):this.evaluate(o,w,w.operation)}),o._cachedGeometry=y.geometry,o._cachedMaterials=y.material,!0}return f||m};return i(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const jC={union:aC,subtract:lC,intersect:uC,difference:cC};function VC(l,e){const t=new FD;t.useGroups=!0,t.attributes=["position","normal","uv"],l.forEach(o=>{for(const c of[...t.attributes])o[0].geometry.getAttribute(c)||t.attributes.splice(t.attributes.indexOf(c),1)});let n=new uE(new s._12(.01,.01,2,2));l.forEach(([o,c])=>{if(!Object.keys(jC).includes(c))return void console.error(`Unknown operation ${c}`);o.updateMatrix(),o.updateMatrixWorld();const f=new uE;f.geometry=o.geometry,f.material=o.material,o.matrixWorld.decompose(f.position,f.quaternion,f.scale),f.updateMatrix(),f.updateMatrixWorld(),n=t.evaluate(n,f,jC[c])});const i=n;return i.userData._isCSGMesh=!0,i}let mx=class extends j_{_buildCSGMesh(l){return VC(l)}};mx.PluginType="CSGPluginBVH",mx=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c}([on("CSG Plugin (BVH)")],mx);class hE extends Ri{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,i,o;(n=(t=e.lastCamera)==null?void 0:t.removeControlsCtor)==null||n.call(t,this.controlsKey),(o=(i=e.camera)==null?void 0:i.setControlsCtor)==null||o.call(i,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var GC=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const zD=new s.Pa4(0,0,1),HC=new s.USm,jD=new s._fP,VD=new s._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),lb=new s._fP,GD={type:"change"};let gx=class extends a.SimpleEventDispatcher{constructor(l){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new s._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new s._fP,this._initQuaternionInvert=new s._fP,this._initQuaternionDest=new s._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=l,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(l=>{l=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(l=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",l)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new s._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const l=this.deviceOrientation;if(l){const e=l.alpha!==null?s.M8C.degToRad(l.alpha):0,t=l.beta!==null?s.M8C.degToRad(l.beta):0,n=l.gamma!==null?s.M8C.degToRad(l.gamma):0,i=this.screenOrientation?s.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,i),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(GD))}}dispose(){this.disconnect()}setObjectQuaternion(l,e,t,n){const i=(0,a.now)()/1e3;HC.set(e,l,-t,"YXZ"),lb.setFromEuler(HC),lb.multiply(VD),lb.multiply(jD.setFromAxisAngle(zD,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(lb).invert(),this._initQuaternionDest.__init=!0),lb.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(lb,this.dampingFactor/(Math.min(1,i-this._lastTime)/(1/60))),this._lastTime=i}};GC([ze(),Pe("Damping",[0,1],.01)],gx.prototype,"dampingFactor",void 0),gx=GC([gn("Device Orientation Controls")],gx);class dS extends hE{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new gx(e)}}dS.PluginType="DeviceOrientationControlsPlugin";var ju=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const WC=new s.Pa4,pS=new s.$V,fS=new s.Pa4,HD={type:"change"};let oc=class extends a.SimpleEventDispatcher{constructor(l,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new s.Pa4,this._lastTime=-1,this.object=l,this.domElement=e,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const l=this.object.quaternion;WC.set(0,0,-1).applyQuaternion(l),pS.setFromVector3(WC),this.lat=90-s.M8C.radToDeg(pS.phi),this.lon=s.M8C.radToDeg(pS.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(l){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(l.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(l){if(this.activeLook)switch(l.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(l){this.domElement===document?(this.pointerX=l.pageX-this.viewHalfX,this.pointerY=l.pageY-this.viewHalfY):(this.pointerX=l.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=l.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(l){if(this.enableKeys)switch(l.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(l){if(this.enableKeys)switch(l.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(l,e,t){return l.isVector3?fS.copy(l):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):fS.set(l,e,t),this.object.lookAt(fS),this.setOrientation(),this}update(){const l=(0,a.now)(),e=(this._lastTime<0?16:Math.min(l-this._lastTime,1e3))/1e3;if(this._lastTime=l,!this.enabled)return;if(this.heightSpeed){const m=s.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(m*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*n,this.lookVertical&&(this.lat-=this.pointerY*n*i),this.lat=Math.max(-85,Math.min(85,this.lat));let o=s.M8C.degToRad(90-this.lat);const c=s.M8C.degToRad(this.lon);this.constrainVertical&&(o=s.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const f=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,c).add(f),this.object.lookAt(this.targetPosition),this.dispatchEvent(HD)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(l){this.enableKeys&&l.preventDefault()}};ju([ze(),Yn()],oc.prototype,"enabled",void 0),ju([ze(),Yn()],oc.prototype,"enableKeys",void 0),ju([ze(),Ke()],oc.prototype,"movementSpeed",void 0),ju([ze(),Ke()],oc.prototype,"lookSpeed",void 0),ju([ze(),Yn()],oc.prototype,"lookVertical",void 0),ju([ze(),Yn()],oc.prototype,"autoForward",void 0),ju([ze(),Yn()],oc.prototype,"activeLook",void 0),ju([ze(),Yn()],oc.prototype,"heightSpeed",void 0),ju([ze(),Ke()],oc.prototype,"heightCoef",void 0),ju([ze(),Ke()],oc.prototype,"heightMin",void 0),ju([ze(),Ke()],oc.prototype,"heightMax",void 0),ju([ze(),Yn()],oc.prototype,"constrainVertical",void 0),ju([ze(),Ke()],oc.prototype,"verticalMin",void 0),ju([ze(),Ke()],oc.prototype,"verticalMax",void 0),ju([ze(),Yn()],oc.prototype,"mouseDragOn",void 0),oc=ju([on("First Person Controls")],oc);class mS extends hE{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new oc(e,t)}}mS.PluginType="FirstPersonControlsPlugin";var cb=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};const ub=new s.USm(0,0,0,"YXZ"),hb=new s.Pa4,WD={type:"change"},QD={type:"lock"},qD={type:"unlock"},QC=Math.PI/2;let q_=class extends a.SimpleEventDispatcher{constructor(l,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new s.Pa4(0,0,-1),this.domElement=e,this.object=l,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(l){this.isLocked||this.autoLockOnClick&&(l.preventDefault(),this.lock())}onMouseMove(l){this.isLocked&&(this._movementX+=l.movementX||l.mozMovementX||l.webkitMovementX||0,this._movementY+=l.movementY||l.mozMovementY||l.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(QD),this.isLocked=!0):(this.dispatchEvent(qD),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(l){return l.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(l){hb.setFromMatrixColumn(this.object.matrix,0),hb.crossVectors(this.object.up,hb),this.object.position.addScaledVector(hb,l)}moveRight(l){hb.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(hb,l)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(ub.setFromQuaternion(this.object.quaternion),ub.y-=.002*this._movementX*this.pointerSpeed,ub.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,ub.x=Math.max(QC-this.maxPolarAngle,Math.min(QC-this.minPolarAngle,ub.x)),this.object.quaternion.setFromEuler(ub),this.dispatchEvent(WD))}};cb([Yn(),ze()],q_.prototype,"enabled",void 0),cb([Ke(),ze()],q_.prototype,"minPolarAngle",void 0),cb([Ke(),ze()],q_.prototype,"maxPolarAngle",void 0),cb([Ke(),ze()],q_.prototype,"pointerSpeed",void 0),cb([Yn(),ze()],q_.prototype,"autoLockOnClick",void 0),q_=cb([gn("Pointer Lock Controls")],q_);class gS extends hE{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new q_(e,t.ownerDocument?t:t.documentElement)}}gS.PluginType="PointerLockControlsPlugin";class qC{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new s.SUY}loadModel(e){this._model=e,this.mixer=new s.Xcj(e),e&&(this._animations=[...e.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(e){var n;const t=[];(n=this._animations)==null||n.forEach(i=>{t.push(this.playClip(i,e))}),await Promise.all(t)}async reverseAllAnimation(e){var n;const t=[];(n=this._animations)==null||n.forEach(i=>{t.push(this.playClip(i,e,1,!0))}),await Promise.all(t)}async playClip(e,t,n=1,i=!1,o=!1){if(!this.mixer)return;const c=this.mixer.clipAction(e);return this._playingAnimations.has(c)&&this.mixer.dispatchEvent({type:"canceled",action:c}),o&&(this.mixer.setTime(0),this.mixer.stopAllAction()),i?(c.paused=!1,c.timeScale=-n):(c.reset(),c.timeScale=n),c.loop=t?s.YKA:s.jAl,c.clampWhenFinished=!0,new Promise(f=>{const m=async y=>{y.action===c&&(this.mixer.removeEventListener("finished",m),this.mixer.removeEventListener("canceled",m),this._playingAnimations.delete(c),f())};this.mixer.addEventListener("finished",m),this.mixer.addEventListener("canceled",m),this._playingAnimations.add(c),c.play()})}playClipByName(e,t,n=1,i=!1){let o;this._animations.forEach(c=>{c.name===e&&(o=c)}),o&&this.playClip(o,t,n,i)}update(){const e=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(e),!0)}}class XC extends Ri{constructor(){super(),this.helperIdentities=new Map}async onAdded(e){var t;await super.onAdded(e),(t=this._viewer)==null||t.addEventListener("postFrame",()=>{this.helperIdentities.forEach(n=>{var i;n.update()&&((i=this._viewer)==null||i.setDirty())})})}createHelper(e,t){var n;if(this.helperIdentities.has(e))(n=this._viewer)==null||n.console.warn("Helper with this id already exists");else{const i=new qC;i.loadModel(t),this.helperIdentities.set(e,i)}}getAnimationClips(e){if(this.helperIdentities.has(e))return this.helperIdentities.get(e).getAnimationClips}async playClip(e,t,n,i=1,o=!1,c=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClip(t,n,i,o,c)}async playAllAnimations(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playAllAnimations(t)}async playAllAnimationsInReverse(e,t){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).reverseAllAnimation(t)}async playAnimationByName(e,t,n,i=1,o=!1){this.helperIdentities.has(e)&&await this.helperIdentities.get(e).playClipByName(t,n,i,o)}}XC.PluginType="AnimationHelperPlugin";class vx extends Ri{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(e,t,n)=>{(0,a.downloadBlob)(e,t)}},this.actions={...this.defaultActions}}async exportFile(e,t){t=t||e.name||"file_export",this.dispatchEvent({type:"transferFile",path:t,state:"exporting"}),await this.actions.exportFile(e,t,({state:n,progress:i})=>{this.dispatchEvent({type:"transferFile",path:t,state:n??"exporting",progress:i})}),this.dispatchEvent({type:"transferFile",path:t,state:"done"})}}vx.PluginType="FileTransferPlugin";var db=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};class mg extends Ri{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const e=this._cameraViews.length;this._oldState=e<2?0:s.M8C.clamp(this._currentState,0,e-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(e=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[ks],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=t=>{this._preFrame(t)},this.enabled=e,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var e,t;return((t=(e=this._viewer)==null?void 0:e.getPlugin(ks))==null?void 0:t.camViews)??[]}setState(e){this._currentState=e}async onAdded(e){await super.onAdded(e),this.enabled&&this._onEnabledChanged(),e.addEventListener("preFrame",this._preFrame1)}async onRemove(e){return e.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(e)}_preFrame(e){var y;if(!this.enabled)return;const t=this._cameraViews;if(t.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=s.M8C.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=s.M8C.clamp(this._oldState,0,t.length-1.001);const n=Math.floor(this._oldState),i=this._overrideStartView||t[n],o=this._overrideEndView||t[n+1];let c,f=this._overrideStartView?this._overrideTime:this._oldState-n;f=Ul[this.animEase](f),c=this.interpolateMode==="spherical"?this._lerpViewsSpherical(i,o,f):this._lerpViewsLinear(i,o,f);const m=(y=this._viewer)==null?void 0:y.scene.activeCamera;m&&(m.position.copy(c[0]),m.target.copy(c[1]),m.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=e.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(e,t,n){const i=new s.Pa4,o=new s.Pa4;return o.lerpVectors(e.position,t.position,n),i.lerpVectors(e.target,t.target,n),[o,i]}_lerpViewsSpherical(e,t,n){const i=e.target.clone(),o=new s.Pa4,c=new s.Pa4,f=km(e,e.target),m=km(t,t.target),y=new s.$V;return y.phi=Pp(f.phi,m.phi,n),y.theta=Pp(f.theta,m.theta,n),y.radius=s.M8C.lerp(f.radius,m.radius,n),o.copy(i).lerp(t.target,n),c.setFromSpherical(y),c.add(o),[c,o]}_animateCameraToView(){const e=this._cameraViews;if(!this._viewer||e.length<2||!this.enabled)return;this._overrideStartView=new Jo(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const t=Math.floor(this._oldState),n=this._oldState-t;let i;i=this.interpolateMode==="spherical"?this._lerpViewsSpherical(e[t],e[t+1],n):this._lerpViewsLinear(e[t],e[t+1],n),this._overrideEndView=new Jo(i[0],i[1]),this._overrideTime=0}}mg.PluginType="CameraViewControlPlugin",db([Yn("Enabled"),(0,a.onChange)(mg.prototype._onEnabledChanged1),ze()],mg.prototype,"enabled",void 0),db([ze(),ct("Ease",Object.keys(Ul).map(l=>({label:l})))],mg.prototype,"animEase",void 0),db([ze(),ct("Interpolation",["spherical","linear"].map(l=>({label:l})))],mg.prototype,"interpolateMode",void 0),db([Yn("Enable Damping"),ze()],mg.prototype,"enableDamping",void 0),db([Pe("Damping",[.01,1],.001),ze()],mg.prototype,"damping",void 0),db([Pe("Init Anim Time",[.01,5],.001),ze()],mg.prototype,"initAnimationTime",void 0);class _S extends mg{constructor(e=document.body,t=!0){super(t),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...Wt(this)]},typeof e=="string"?(this.parent=document.getElementById(e),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=e}_preFrame(e){if(!this.enabled||this._cameraViews.length<=1)return;const t=this._findActiveView(),n=this._getScroll(t);this.setState(n+t),super._preFrame(e)}_getScroll(e){if(e>=this._cameraViews.length-1)return 0;const t=this.parent.querySelector(this._cameraViews[e].name)??this.parent.getElementsByTagName("section")[e],n=this.parent.querySelector(this._cameraViews[e+1].name)??this.parent.getElementsByTagName("section")[e+1],i=this.parent.getBoundingClientRect();if(!t||!n)return 0;const o=t.getBoundingClientRect(),c=n.getBoundingClientRect(),f=this.parent===document.body?0:i.top;return s.M8C.clamp((f-o.top)/Math.max(c.top-o.top,1e-4),0,1)}_findActiveView(){var e;for(let t=this._cameraViews.length-1;t>=0;t--){const n=this.parent.querySelector(this._cameraViews[t].name)??this.parent.getElementsByTagName("section")[t],i=this.parent.getBoundingClientRect();if(n){if(n.getBoundingClientRect().top<(this.parent===document.body?0:i.top))return t}else(e=this._cameraViews[t].name)!=null&&e.startsWith("#")&&console.error("section with id "+this._cameraViews[t].name+" doesn't exist!")}return 0}}_S.PluginType="ScrollableCameraViewPlugin";var vS,yS=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let E0=vS=class extends _S{generateCode(){var i;const l=document.createElement("div");l.style.position="absolute",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.display="flex",l.style.flexDirection="column",l.style.justifyContent="center",l.style.alignItems="center",l.style.zIndex="200";const e=document.createElement("textarea");e.rows=20,e.style.border="3px solid #27223a",e.style.borderRadius="5px",e.style.width="30%",e.style.padding="5px",e.style.zIndex="1000";const t=document.createElement("div");t.textContent="X",t.style.color="red",t.style.width="20px",t.style.height="20px",t.style.padding="2",t.style.textAlign="center",t.style.backgroundColor="white",t.style.borderRadius="100%",t.style.border="2px solid #27223a",t.style.cursor="pointer",t.addEventListener("click",()=>{var o;(o=this._viewer)==null||o.container.removeChild(l)});const n=document.createElement("div");n.textContent="Update",n.style.marginTop="10px",n.style.color="white",n.style.padding="4px 10px 4px 10px",n.style.justifyContent="center",n.style.alignItems="center",n.style.backgroundColor="green",n.style.borderRadius="10px",n.style.border="2px solid #fff",n.style.cursor="pointer",n.addEventListener("click",()=>{var f;const o=this.parent.innerHTML;this.parent.innerHTML=e.value;let c=0;for(;c<this._cameraViews.length;c++){const m=this.parent.querySelector(this._cameraViews[c].name)??this.parent.getElementsByTagName("section")[c];if(!m&&c<2){alert("you need to add 2 sections at least");break}if(!m){const y=((f=this._cameraViews[c].name)==null||f.startsWith("#"),this._cameraViews[c].name.replace(/^#/,""));e.value+=y,e.value=this._format(e.value)}}c<2?this.parent.innerHTML=o:async function(m,y){var S;m.innerHTML=y;const w=m.getElementsByTagName("script");for(let C=0;C<w.length;C++){const O=w[C],N=VI(O);let H=!1;await new Promise(q=>{N.onload=q,N.onerror=()=>{H=!0,q(void 0)}}),H||((S=O.parentNode)==null||S.replaceChild(N,O))}}(this.parent,e.value)}),l.appendChild(t),l.appendChild(e),l.appendChild(n),e.value=this._format(this.parent.innerHTML),(i=this._viewer)==null||i.container.appendChild(l)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(l=document.body,e=!1){super(l,e),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(l){var e,t,n,i,o,c;this.parent=this.wrapper,await super.onAdded(l),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(t=(e=this._viewer)==null?void 0:e.getPlugin(ks))==null||t.addEventListener("viewDelete",this.deleteView),(i=(n=this._viewer)==null?void 0:n.getPlugin(ks))==null||i.addEventListener("deserialize",this.deserialize),(c=(o=this._viewer)==null?void 0:o.getPlugin(ks))==null||c.addEventListener("viewAdd",this.addView)}deserialize(l){this._cameraViews.forEach(e=>{this._createSection(e.name)})}_addWrapper(){var l;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(l=this._viewer)==null||l.container.appendChild(this.wrapper)}_createSection(l){const e=document.createElement("section");e.style.width="100%",e.style.height="100%",e.style.opacity="50%",e.style.backgroundColor="black",e.style.zIndex="100",e.style.top="0",e.textContent=l,e.style.color="white",e.style.fontSize="100px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.id=l,this.parent.appendChild(e)}addView(l){this._cameraViews.forEach((e,t)=>{var n;if(!(this.parent.querySelector(e.name)??this.parent.getElementsByTagName("section")[t])){const i=`<section id="${(n=e.name)!=null&&n.startsWith("#")?e.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${e.name}
                    </section>`;this.parent.innerHTML+=i}})}deleteView(l){const e=this.parent.querySelector(l.view.name)??this.parent.getElementsByTagName("section").namedItem(l.view.name);e==null||e.remove()}_format(l){let e="",t="";return l.split(/>\s*</).forEach(function(n){n.match(/^\/\w/)&&(t=t.substring(1)),e+=t+"<"+n+`>\r
`,n.match(/^<?\w[^>]*[^/]$/)&&!n.startsWith("input")&&(t+="	")}),e.substring(1,e.length-3)}};yS([ht("Show/Edit Code")],E0.prototype,"generateCode",null),yS([Yn("Canvas on top"),(0,a.onChange)(vS.prototype._togglePreview)],E0.prototype,"canvasUp",void 0),E0=vS=yS([on("Scrollable Camera View Preview (Dev)")],E0);var AS={d:(l,e)=>{for(var t in e)AS.o(e,t)&&!AS.o(l,t)&&Object.defineProperty(l,t,{enumerable:!0,get:e[t]})},o:(l,e)=>Object.prototype.hasOwnProperty.call(l,e)},YC={};AS.d(YC,{Q:()=>$D});var bS=function(l,e,t,n){return new(t||(t=Promise))(function(i,o){function c(y){try{m(n.next(y))}catch(w){o(w)}}function f(y){try{m(n.throw(y))}catch(w){o(w)}}function m(y){var w;y.done?i(y.value):(w=y.value,w instanceof t?w:new t(function(S){S(w)})).then(c,f)}m((n=n.apply(l,e||[])).next())})};const KC=Symbol("Comlink.proxy"),XD=Symbol("Comlink.endpoint"),YD=Symbol("Comlink.releaseProxy"),xS=Symbol("Comlink.thrown"),$C=l=>typeof l=="object"&&l!==null||typeof l=="function",JC=new Map([["proxy",{canHandle:l=>$C(l)&&l[KC],serialize(l){const{port1:e,port2:t}=new MessageChannel;return ZC(l,e),[t,[t]]},deserialize:l=>(l.start(),tR(l))}],["throw",{canHandle:l=>$C(l)&&xS in l,serialize({value:l}){let e;return e=l instanceof Error?{isError:!0,value:{message:l.message,name:l.name,stack:l.stack}}:{isError:!1,value:l},[e,[]]},deserialize(l){throw l.isError?Object.assign(new Error(l.value.message),l.value):l.value}}]]);function ZC(l,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;const{id:i,type:o,path:c}=Object.assign({path:[]},n.data),f=(n.data.argumentList||[]).map(zy);let m;try{const y=c.slice(0,-1).reduce((S,C)=>S[C],l),w=c.reduce((S,C)=>S[C],l);switch(o){case"GET":m=w;break;case"SET":y[c.slice(-1)[0]]=zy(n.data.value),m=!0;break;case"APPLY":m=w.apply(y,f);break;case"CONSTRUCT":m=pE(new w(...f));break;case"ENDPOINT":{const{port1:S,port2:C}=new MessageChannel;ZC(l,C),m=function(O,N){return iR.set(O,N),O}(S,[S])}break;case"RELEASE":m=void 0;break;default:return}}catch(y){m={value:y,[xS]:0}}Promise.resolve(m).catch(y=>({value:y,[xS]:0})).then(y=>{const[w,S]=ES(y);e.postMessage(Object.assign(Object.assign({},w),{id:i}),S),o==="RELEASE"&&(e.removeEventListener("message",t),eR(e))})}),e.start&&e.start()}function eR(l){(function(e){return e.constructor.name==="MessagePort"})(l)&&l.close()}function tR(l,e){return wS(l,[],e)}function dE(l){if(l)throw new Error("Proxy has been released and is not useable")}function wS(l,e=[],t=function(){}){let n=!1;const i=new Proxy(t,{get(o,c){if(dE(n),c===YD)return()=>pb(l,{type:"RELEASE",path:e.map(f=>f.toString())}).then(()=>{eR(l),n=!0});if(c==="then"){if(e.length===0)return{then:()=>i};const f=pb(l,{type:"GET",path:e.map(m=>m.toString())}).then(zy);return f.then.bind(f)}return wS(l,[...e,c])},set(o,c,f){dE(n);const[m,y]=ES(f);return pb(l,{type:"SET",path:[...e,c].map(w=>w.toString()),value:m},y).then(zy)},apply(o,c,f){dE(n);const m=e[e.length-1];if(m===XD)return pb(l,{type:"ENDPOINT"}).then(zy);if(m==="bind")return wS(l,e.slice(0,-1));const[y,w]=nR(f);return pb(l,{type:"APPLY",path:e.map(S=>S.toString()),argumentList:y},w).then(zy)},construct(o,c){dE(n);const[f,m]=nR(c);return pb(l,{type:"CONSTRUCT",path:e.map(y=>y.toString()),argumentList:f},m).then(zy)}});return i}function nR(l){const e=l.map(ES);return[e.map(n=>n[0]),(t=e.map(n=>n[1]),Array.prototype.concat.apply([],t))];var t}const iR=new WeakMap;function pE(l){return Object.assign(l,{[KC]:!0})}function ES(l){for(const[e,t]of JC)if(t.canHandle(l)){const[n,i]=t.serialize(l);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:l},iR.get(l)||[]]}function zy(l){switch(l.type){case"HANDLER":return JC.get(l.name).deserialize(l.value);case"RAW":return l.value}}function pb(l,e,t){return new Promise(n=>{const i=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");l.addEventListener("message",function o(c){c.data&&c.data.id&&c.data.id===i&&(l.removeEventListener("message",o),n(c.data))}),l.start&&l.start(),l.postMessage(Object.assign({id:i},e),t)})}class KD extends class{}{init(e,t,n,i){if(!this.api){if(!i)throw new Error("workerFilePath is required");(()=>{var o,c,f;o=this,f=function*(){const m=yield fetch(i).then(S=>S.blob()),y=URL.createObjectURL(m),w=new Worker(y,{type:"module"});this.api=yield new(tR(w))(pE(()=>{e(),URL.revokeObjectURL(y)}),pE((S,C)=>S==="xatlas_web.wasm"?n:S+C),pE(t))},new((c=void 0)||(c=Promise))(function(m,y){function w(O){try{C(f.next(O))}catch(N){y(N)}}function S(O){try{C(f.throw(O))}catch(N){y(N)}}function C(O){var N;O.done?m(O.value):(N=O.value,N instanceof c?N:new c(function(H){H(N)})).then(w,S)}C((f=f.apply(o,[])).next())})})()}}}class $D extends class{constructor(e,t={resolution:2048},n={},i=!1,o=!1,c=!1){this.THREE=e,this.packOptions=t,this.chartOptions=n,this.useNormals=i,this.timeUnwrap=o,this.logProgress=c,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(e,t,n){return bS(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((i,o)=>{try{this.xAtlas.init(()=>{i()},e,t,n)}catch(c){o(c)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(i=>setTimeout(i,100));this._libraryLoaded=!0}})}packAtlas(e,t="uv2",n="uv"){return bS(this,void 0,void 0,function*(){if(!this._libraryLoaded)return console.warn("xatlas-three: library not loaded"),[];if(!e)return[];if(e.length<1)return[];const i=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(y=>setTimeout(y,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let o=[],c="";for(let y of e){let{uuid:w,index:S,attributes:C}=y;const O=y.userData.worldScale||1;o.push(w),S&&C.position&&C.position.itemSize===3?(c="Mesh"+o.length+" added to atlas: "+w,this.timeUnwrap&&console.time(c),yield this.xAtlas.api.addMesh(S.array,C.position.array,C.normal?C.normal.array:void 0,C.uv?C.uv.array:void 0,w,this.useNormals,i,O),this.timeUnwrap&&console.timeEnd(c)):console.warn("xatlas-three: Geometry not supported: ",y)}c="Generated atlas with "+o.length+" meshes",this.timeUnwrap&&console.time(c);let f=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(c);let m=[];for(let y of f){let w=e.find(S=>S.uuid===y.mesh);w?(y.vertex.vertices&&w.setAttribute("position",new this.THREE.BufferAttribute(y.vertex.vertices,3,!1)),y.vertex.normals&&w.setAttribute("normal",new this.THREE.BufferAttribute(y.vertex.normals,3,!0)),y.vertex.coords1&&w.setAttribute(t,new this.THREE.BufferAttribute(y.vertex.coords1,2,!1)),y.vertex.coords&&t!==n&&w.setAttribute(n,new this.THREE.BufferAttribute(y.vertex.coords,2,!1)),y.index&&w.setIndex(new this.THREE.BufferAttribute(y.index,1,!1)),m.push(w)):console.error("xatlas-three: Mesh not found: ",y.mesh)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,m})}unwrapGeometry(e,t="uv",n="uv2"){return bS(this,void 0,void 0,function*(){return this.packAtlas([e],t,n)})}}{_createXAtlas(){return new KD}}var yx,JD=YC.Q,Po=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let ph=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};Po([ze()],ph.prototype,"fixWinding",void 0),Po([ze()],ph.prototype,"maxBoundaryLength",void 0),Po([ze()],ph.prototype,"maxChartArea",void 0),Po([ze()],ph.prototype,"maxCost",void 0),Po([ze()],ph.prototype,"maxIterations",void 0),Po([ze()],ph.prototype,"normalDeviationWeight",void 0),Po([ze()],ph.prototype,"normalSeamWeight",void 0),Po([ze()],ph.prototype,"roundnessWeight",void 0),Po([ze()],ph.prototype,"straightnessWeight",void 0),Po([ze()],ph.prototype,"textureSeamWeight",void 0),Po([ze()],ph.prototype,"useInputMeshUvs",void 0),ph=Po([on("Chart Options"),jr("UChartOptions")],ph);let ad=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};Po([ze()],ad.prototype,"bilinear",void 0),Po([ze()],ad.prototype,"blockAlign",void 0),Po([ze()],ad.prototype,"bruteForce",void 0),Po([ze()],ad.prototype,"createImage",void 0),Po([ze()],ad.prototype,"maxChartSize",void 0),Po([ze()],ad.prototype,"padding",void 0),Po([ze()],ad.prototype,"resolution",void 0),Po([ze()],ad.prototype,"rotateCharts",void 0),Po([ze()],ad.prototype,"rotateChartsToAxis",void 0),Po([ze()],ad.prototype,"texelsPerUnit",void 0),ad=Po([on("Pack Options"),jr("UPackOptions")],ad);let Qp=yx=class extends Ri{constructor(l=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new ph,this.packOptions=new ad,this._loaded=!1,this._unwrapProgress=(e,t)=>{console.log("Unwrapping",e,t)},this.unwrapSelected=async()=>{var t,n,i,o,c;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(us))==null?void 0:n.getSelectedObject();if(e)if(e.geometry){if(e.geometry.attributes.uv&&!await((i=this._viewer)==null?void 0:i.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(e.geometry)}else(o=this._viewer)==null||o.alert("Unwrap: Selected object has no geometry");else(c=this._viewer)==null||c.alert("Unwrap: No object selected")},l&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await(0,a.timeout)(100);else this._unwrapper=new JD({BufferAttribute:s.TlE},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,yx.LIBRARY_PATH+"xatlas.wasm",yx.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(l,e="uv",t="uv"){var n;await this.loadLibrary(),await((n=this._unwrapper)==null?void 0:n.unwrapGeometry(l,e,t))}async packAtlas(l,e=!0,t="uv2",n="uv"){var o;await this.loadLibrary(),Array.isArray(l)||(l=[l]);const i=[];e?l.forEach(c=>c.traverse(f=>{f.geometry&&i.push(f.geometry)})):l.forEach(c=>{c.geometry&&i.push(c.geometry)}),await((o=this._unwrapper)==null?void 0:o.packAtlas(i,t,n))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};Qp.PluginType="XAtlasPlugin",Qp.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",Po([(0,a.onChange)(yx.prototype._useNormalsChanged),ze()],Qp.prototype,"useNormals",void 0),Po([ze()],Qp.prototype,"chartOptions",void 0),Po([ze()],Qp.prototype,"packOptions",void 0),Po([ht("Unwrap Selected Geometry")],Qp.prototype,"unwrapSelected",void 0),Qp=yx=Po([on("UV Unwrapping (xAtlas)")],Qp);class Ax extends Ri{constructor(){super(...arguments),this.dependencies=[fi],this.enabled=!0,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:e=>e.name||e.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:e=>e.title||this.utils.getName(e),getIcon:(e,t)=>{let n=e.icon;return(n&&/^(\w+)\(([^)]*)\)/.exec(n)||/^#([A-Fa-f\d]+)$/.exec(n))&&(n=(0,a.makeColorSvg)(n)),n&&n.startsWith("http")&&n.startsWith("data:")||(n=this.utils.pathToIcon(this.baseUrl+t+"/"+e.prefix+(n||""))),n},getItemIcon:(e,t,n)=>{const i=e.iconFiles[t];if(i)return URL.createObjectURL(i);let o=e.icons[t];return(o&&/^(\w+)\(([^)]*)\)/.exec(o)||/^#([A-Fa-f\d]+)$/.exec(o))&&(o=(0,a.makeColorSvg)(o)),o||(o=this.utils.pathToIcon(e.items[t])),!o||o.startsWith("http")||o.startsWith("data:")||(o=this.baseUrl+n+"/"+e.prefix+o),o},getItemTitle:(e,t)=>e.titles[t]||this.utils.pathToTitle(e.items[t]),getItemPath:(e,t,n)=>e.items[t].startsWith("http")?e.items[t]:`${this.baseUrl}${n}/${e.prefix}${e.items[t]}`,pathToTitle:e=>e.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:e=>e.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(e){return this.utils.getName(e)}async applyVariation(e,t,n,i=!1){var S,C;if(!this._viewer)return;const o=this._getVariationId(e);typeof t=="number"&&(t=e.items[t]);const c=e.items.indexOf(t);if(c===-1)return void this._viewer.console.warn(`Item ${t} not found`);const f=e.itemFiles[c],m=e.selected;if(!i&&m===c)return;e.selected=c;const y=this._viewer.getManager(),w=this.utils.getItemPath(e,c,n);if(n==="objects"){let O=this._viewer.scene.findObjectsByName(o).map(V=>V.modelObject);O.length===0&&(O=[(await this._viewer.createObject3D()).modelObject],O[0].name=o),this._viewer.renderEnabled=!1;for(const V of O)[...V.children].forEach(z=>z.dispose&&this.autoDispose?z.dispose():z.removeFromParent());const N=await this._loadObject(w,f);if(!N.length)return void(w.endsWith("json")||this._viewer.console.warn(`Object ${w} not found`));let H=!1;for(const V of O){[...V.children].forEach(z=>z.dispose&&this.autoDispose?z.dispose():z.removeFromParent());for(const z of N)H?V.add(z.modelObject.clone()):V.add(z.modelObject);H=!0}const q=[],J=this.variations.materials.filter(V=>V&&typeof V.selected=="number");for(const V of J)q.push(this.applyVariation(V,V.selected,"materials",!0));await Promise.all(q),this._viewer.renderEnabled=!0}if(n==="materials"){const O=await this._loadMaterial(w,f);if(!O)return void this._viewer.console.warn(`Material ${w} not found`);O.userData.__isVariation=!0;const N=this._viewer.scene.findObjectsByName(o),H=q=>{var J,V,z;q.material&&(Array.isArray(q.material)?q.material.length!==0&&((J=e.data)==null?void 0:J.matType)!==q.material[0].typeSlug:((V=e.data)==null?void 0:V.matType)!==q.material.typeSlug)||((z=q==null?void 0:q.setMaterial)==null||z.call(q,O))};for(const q of N)(S=e.data)!=null&&S.traverse?q.traverse(H):H(q);(C=y.materials)==null||C.applyMaterial(O,o)}}clearVariations(){const e=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const t of e){const n=this._getVariationId(t),i=this._viewer.scene.findObjectsByName(n);for(const o of i)[...o.children].forEach(c=>(c.dispose??c.removeFromParent)())}}async _loadMaterial(e,t){var n,i,o;return(o=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:o.importSinglePath(e,{importedFile:t})}async _loadObject(e,t){var n,i,o;return(o=(i=(n=this._viewer)==null?void 0:n.getManager())==null?void 0:i.importer)==null?void 0:o.importPath(e,{importedFile:t,reimportDisposed:!0})}importConfig(e,t){typeof e=="string"&&(e=JSON.parse(e)),e.baseUrl!==void 0&&(this.baseUrl=e.baseUrl),!t&&e.folder&&(t=typeof e.folder=="object"?e.folder:typeof e.folder=="string"?Da(cl(e.folder)):Da(e.folder));for(const n of this._ty)if(e[n])for(const i of e[n]){const o={items:i.items,prefix:i.prefix,name:i.name,title:i.title||"",icon:i.icon||"",icons:i.icons??i.items.map(()=>""),titles:i.titles??i.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...i.data}};if(t)for(let c=0;c<i.items.length;c++){const f=i.items[c],m=t[n+"/"+i.prefix+f];o.itemFiles[c]=m?new File([m],f):void 0;const y=i.icons[c];if(!y)continue;const w=t[n+"/"+i.prefix+y];o.iconFiles[c]=w?new File([w],y):void 0}this.variations[n].push(o)}}async importPath(e){var t,n;if(e.endsWith(".json")){const i=await((n=(t=this._viewer)==null?void 0:t.getManager().importer)==null?void 0:n.importSinglePath(e,{processImported:!1})),o=e.split("?")[0];return this.baseUrl||(this.baseUrl=o.substring(0,o.lastIndexOf("/")+1)),this.importConfig(i)}e.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(e){var t;return((t=this.variations.materials.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getObjects(e){var t;return((t=this.variations.objects.find(n=>this.utils.getName(n)===e))==null?void 0:t.items)||[]}getMaterialVariations(){return this.variations.materials.map(e=>this.utils.getName(e))}getObjectVariations(){return this.variations.objects.map(e=>this.utils.getName(e))}async onRemove(e){return super.onRemove(e)}fromJSON(e){return super.fromJSON(e)?(this.importConfig(e),this):null}async _exportConfiguratorState(){var i;let e={objects:{},materials:{}};const t={objects:[],materials:[],type:Ax.PluginType};this.baseUrl&&(t.baseUrl=this.baseUrl);let n=!1;for(const o of this._ty)for(const c of this.variations[o]){const f={...c};f.data={...f.data},delete f.itemFiles,delete f.iconFiles,t[o].push(f);const m=c.prefix.replace(/^\//,""),y=m.trimEnd().endsWith("/")?"":m.split("/").pop()||"",w=m.replace(y,"").trimEnd().replace(/\/$/,""),S={};let C=!1;for(let H=0;H<c.items.length;H++){const q=c.items[H],J=c.itemFiles[H],V=c.iconFiles[H],z=c.icons[H];J?(S[y+q]=new Uint8Array(await J.arrayBuffer()),V&&!z&&((i=this._viewer)==null||i.console.error("Icon file without icon name")),V&&z&&(S[y+z]=new Uint8Array(await V.arrayBuffer())),C=!0):V&&alert("Icon file without model/material file not supported")}if(!C)continue;n=!0;const O=w.split("/");let N=e[o];for(const H of O){N[H]||(N[H]={});const q=N[H];if(typeof q!="object")throw new Error("Invalid prefix: "+c.prefix);N=q}Object.assign(N,S)}return n||(e=void 0),{folder:e,config:t}}}Ax.PluginType="VariationConfiguratorPlugin";class fb extends Ax{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("preFrame",this._refreshUi)}async onRemove(e){return e.removeEventListener("preFrame",this._refreshUi),super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,Me.RemoveAll(fb.PluginType);for(const e of["objects","materials"])for(const t of this.variations[e])Me.Create(fb.PluginType,this.utils.getTitle(t),5,20,0,t.items.map((n,i)=>({id:n,image:this.utils.getItemIcon(t,i,e),onClick:async o=>this.applyVariation(t,o,e,!1),tooltip:this.utils.getItemTitle(t,i)})),(n,i)=>d0(n,{placement:"bottom",content:i.tooltip}));return Me.RebuildUi(this._viewer.container),!0}}fb.PluginType="VariationConfiguratorPlugin";class bx extends fb{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(e=>({type:"folder",expanded:this._uiExpandedState["__/"+e],onExpand:()=>this._uiExpandedState["__/"+e]=!0,onCollapse:()=>this._uiExpandedState["__/"+e]=!1,label:e,children:[()=>this.variations[e].map(t=>({type:"folder",expanded:this._uiExpandedState[t.name],onExpand:()=>this._uiExpandedState[t.name]=!0,onCollapse:()=>this._uiExpandedState[t.name]=!1,label:()=>this.utils.getName(t),children:[{type:"input",placeholder:()=>this.utils.getName(t),property:[t,"name"]},{type:"input",property:[t,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(t)),property:[t,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+t.prefix),property:[t,"icon"]},{type:"folder",label:"items",children:t.items.map((n,i)=>({type:"folder",label:()=>t.items[i],children:[{type:"input",label:"File/URL",isMonitor:!t.itemFiles[i],getValue:()=>t.items[i],setValue:o=>{t.items[i]=o}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(t.items[i]),getValue:()=>t.icons[i],setValue:o=>{t.icons[i]=o}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(t.items[i]),getValue:()=>t.titles[i],setValue:o=>{t.titles[i]=o}},{type:"button",label:"Apply",value:async()=>this.applyVariation(t,i,e)},t.itemFiles[i]?[{type:"button",label:"Remove",value:()=>{t.items.splice(i,1),t.itemFiles.splice(i,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const o=await(0,a.uploadFile)(!1,!1);o.length!==0&&(t.itemFiles[i]=o[0],t.items[i]=o[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const o=t.itemFiles[i];(0,a.downloadBlob)(o,o.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var i,o;const n=await(0,a.uploadFile)(!0,!1);if(n.length!==0){for(const c of n){if(!this._extForType[e].includes(c.name.split(".").pop()??"")){await((i=this._viewer)==null?void 0:i.alert(`Invalid file: ${c.name} is not a valid ${e} file`));continue}if(t.items.includes(c.name)){await((o=this._viewer)==null?void 0:o.alert(`Already exists: Item with name ${c.name} already exists`));continue}const f=t.items.push(c.name)-1;t.icons[f]="",t.titles[f]="",t.itemFiles[f]=c}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var o,c,f,m;const n=await((o=this._viewer)==null?void 0:o.prompt("URL: Enter the url of the object/material"));if(!n)return;if(!n.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((c=this._viewer)==null?void 0:c.alert(`Invalid url: ${n} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[e].includes(n.split(".").pop()??""))return void await((f=this._viewer)==null?void 0:f.alert(`Invalid url: ${n} should be of a material ending with mat`));t.items.includes(n)&&await((m=this._viewer)==null?void 0:m.alert(`Already exists: Item with url ${n} already exists`)),t.items.push(n);const i=t.items.length-1;t.icons[i]="",t.titles[i]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(t),value:async()=>{var n;await((n=this._viewer)==null?void 0:n.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(t)}?`))&&(this.variations[e].splice(this.variations[e].indexOf(t),1),this.refreshUi())}}]})),{type:"button",label:`Add ${e} group (empty)`,value:async()=>{var n;const t=await((n=this._viewer)==null?void 0:n.prompt("Name: Enter the name of the object/material"));t&&(this.variations[e].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:t+"/",name:t,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${e} group (local folder)`,value:async()=>{var S,C,O;const t=await(0,a.uploadFile)(!1,!0);if(t.length===0)return;const n=[],i=[],o=[],c=[];for(const N of t){if(N.name.startsWith("."))continue;const H=N.name.split(".").pop()??"";H?this._extForType[e].includes(H)?(n.push(N.webkitRelativePath.replace(/^\//,"")),i.push(N)):this._extForType.images.includes(H)?(o.push(N.webkitRelativePath.replace(/^\//,"")),c.push(N)):await((S=this._viewer)==null?void 0:S.alert(`Invalid file: ${N.name} is not a valid ${e} file`)):await((C=this._viewer)==null?void 0:C.alert(`Invalid file: ${N.name} has no extension`))}const f=(0,a.longestCommonPrefix)(n),m=this.utils.getName({prefix:f});let y=await((O=this._viewer)==null?void 0:O.prompt("Name: Enter the name of the object/material",m,!0));if(y===null)return;y=y||m;const w=n.map(N=>{const H=N.replace(f,""),q=H.split(".").pop()??"",J=H.replace("."+q,"")+".",V=o.findIndex(z=>z.replace(f,"").startsWith(J));return V<0?["",void 0]:[o[V].replace(f,""),c[V]||void 0]});this.variations[e].push({items:n.map(N=>N.replace(f,"")),icons:w.map(N=>N[0]),iconFiles:w.map(N=>N[1]),titles:n.map(()=>""),itemFiles:i,prefix:f,name:y,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var e,t;try{const{folder:n,config:i}=await this._exportConfiguratorState(),o=JSON.stringify(i,null,4);if(n){n["config.json"]=cl(o);const c=await Ku(n),f=new Blob([c],{type:"application/zip"});(0,a.downloadBlob)(f,"configurator.zip")}else{const c=new Blob([o],{type:"application/json"});(0,a.downloadBlob)(c,"config.json")}}catch(n){return(e=this._viewer)==null||e.console.error(n),void await((t=this._viewer)==null?void 0:t.alert("Error: "+((n==null?void 0:n.message)||n)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var n,i,o;const e=await(0,a.uploadFile)(!1,!1,"application/zip,application/json");if(e.length===0)return;const t=e[0];if(t.name.endsWith(".zip")){const c=Da(new Uint8Array(await t.arrayBuffer()));if(!c["config.json"])return void await((n=this._viewer)==null?void 0:n.alert("Invalid zip: config.json not found"));const f=JSON.parse(Pa(c["config.json"]));this.importConfig(f,c)}else{if(!t.name.endsWith(".json"))return void await((i=this._viewer)==null?void 0:i.alert("Invalid file: "+t.name));{const c=JSON.parse(await t.text());this.importConfig(c)}}await((o=this._viewer)==null?void 0:o.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var t,n;const e=await((t=this._viewer)==null?void 0:t.prompt("URL: Enter the url of the json file."));e&&(await this.importPath(e),await((n=this._viewer)==null?void 0:n.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var e,t;(t=(e=this.uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(e,t){const n=await super._loadObject(e,t);for(const i of n)(i.modelObject||i).userData.excludeFromExport=!0;return n}}bx.PluginType="VariationConfiguratorPlugin";class Vf{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new rt);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new rt);const n=this.elements,i=e.x,o=e.y,c=e.z;return t.x=n[0]*i+n[1]*o+n[2]*c,t.y=n[3]*i+n[4]*o+n[5]*c,t.z=n[6]*i+n[7]*o+n[8]*c,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Vf);const n=this.elements,i=e.elements,o=t.elements,c=n[0],f=n[1],m=n[2],y=n[3],w=n[4],S=n[5],C=n[6],O=n[7],N=n[8],H=i[0],q=i[1],J=i[2],V=i[3],z=i[4],ue=i[5],me=i[6],Te=i[7],Be=i[8];return o[0]=c*H+f*V+m*me,o[1]=c*q+f*z+m*Te,o[2]=c*J+f*ue+m*Be,o[3]=y*H+w*V+S*me,o[4]=y*q+w*z+S*Te,o[5]=y*J+w*ue+S*Be,o[6]=C*H+O*V+N*me,o[7]=C*q+O*z+N*Te,o[8]=C*J+O*ue+N*Be,t}scale(e,t){t===void 0&&(t=new Vf);const n=this.elements,i=t.elements;for(let o=0;o!==3;o++)i[3*o+0]=e.x*n[3*o+0],i[3*o+1]=e.y*n[3*o+1],i[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new rt);const n=[];let i,o;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(o=0;o<3;o++)n[i+4*o]=this.elements[i+3*o];n[3]=e.x,n[7]=e.y,n[11]=e.z;let c=3;const f=c;let m,y;do{if(i=f-c,n[i+4*i]===0){for(o=i+1;o<f;o++)if(n[i+4*o]!==0){m=4;do y=4-m,n[y+4*i]+=n[y+4*o];while(--m);break}}if(n[i+4*i]!==0)for(o=i+1;o<f;o++){const w=n[i+4*o]/n[i+4*i];m=4;do y=4-m,n[y+4*o]=y<=i?0:n[y+4*o]-n[y+4*i]*w;while(--m)}}while(--c);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){e===void 0&&(e=new Vf);const t=ZD;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let o=3;const c=o;let f,m;do{if(n=c-o,t[n+6*n]===0){for(i=n+1;i<c;i++)if(t[n+6*i]!==0){f=6;do m=6-f,t[m+6*n]+=t[m+6*i];while(--f);break}}if(t[n+6*n]!==0)for(i=n+1;i<c;i++){const y=t[n+6*i]/t[n+6*n];f=6;do m=6-f,t[m+6*i]=m<=n?0:t[m+6*i]-t[m+6*n]*y;while(--f)}}while(--o);n=2;do{i=n-1;do{const y=t[n+6*i]/t[n+6*n];f=6;do m=6-f,t[m+6*i]=t[m+6*i]-t[m+6*n]*y;while(--f)}while(i--)}while(--n);n=2;do{const y=1/t[n+6*n];f=6;do m=6-f,t[m+6*n]=t[m+6*n]*y;while(--f)}while(n--);n=2;do{i=2;do{if(m=t[3+i+6*n],isNaN(m)||m===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(n,i,m)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,o=e.w,c=t+t,f=n+n,m=i+i,y=t*c,w=t*f,S=t*m,C=n*f,O=n*m,N=i*m,H=o*c,q=o*f,J=o*m,V=this.elements;return V[0]=1-(C+N),V[1]=w-J,V[2]=S+q,V[3]=w+J,V[4]=1-(y+N),V[5]=O-H,V[6]=S-q,V[7]=O+H,V[8]=1-(y+C),this}transpose(e){e===void 0&&(e=new Vf);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const ZD=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class rt{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new rt);const n=e.x,i=e.y,o=e.z,c=this.x,f=this.y,m=this.z;return t.x=f*o-m*i,t.y=m*n-c*o,t.z=c*i-f*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new rt(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new rt(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new Vf([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const o=1/i;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new rt);const t=this.x,n=this.y,i=this.z;let o=Math.sqrt(t*t+n*n+i*i);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=i*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,o=e.x,c=e.y,f=e.z;return Math.sqrt((o-t)*(o-t)+(c-n)*(c-n)+(f-i)*(f-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,o=e.x,c=e.y,f=e.z;return(o-t)*(o-t)+(c-n)*(c-n)+(f-i)*(f-i)}scale(e,t){t===void 0&&(t=new rt);const n=this.x,i=this.y,o=this.z;return t.x=e*n,t.y=e*i,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new rt),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new rt),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new rt),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=e2,o=1/n;i.set(this.x*o,this.y*o,this.z*o);const c=t2;Math.abs(i.x)<.9?(c.set(1,0,0),i.cross(c,e)):(c.set(0,1,0),i.cross(c,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,o=this.y,c=this.z;n.x=i+(e.x-i)*t,n.y=o+(e.y-o)*t,n.z=c+(e.z-c)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(rR),rR.almostEquals(e,t)}clone(){return new rt(this.x,this.y,this.z)}}rt.ZERO=new rt(0,0,0),rt.UNIT_X=new rt(1,0,0),rt.UNIT_Y=new rt(0,1,0),rt.UNIT_Z=new rt(0,0,1);const e2=new rt,t2=new rt,rR=new rt;class Sa{constructor(e){e===void 0&&(e={}),this.lowerBound=new rt,this.upperBound=new rt,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const o=this.lowerBound,c=this.upperBound,f=n;o.copy(e[0]),f&&f.vmult(o,o),c.copy(o);for(let m=1;m<e.length;m++){let y=e[m];f&&(f.vmult(y,sR),y=sR),y.x>c.x&&(c.x=y.x),y.x<o.x&&(o.x=y.x),y.y>c.y&&(c.y=y.y),y.y<o.y&&(o.y=y.y),y.z>c.z&&(c.z=y.z),y.z<o.z&&(o.z=y.z)}return t&&(t.vadd(o,o),t.vadd(c,c)),i&&(o.x-=i,o.y-=i,o.z-=i,c.x+=i,c.y+=i,c.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Sa().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound,c=i.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,f=i.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,m=i.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return c&&f&&m}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound;return t.x<=i.x&&n.x>=o.x&&t.y<=i.y&&n.y>=o.y&&t.z<=i.z&&n.z>=o.z}getCorners(e,t,n,i,o,c,f,m){const y=this.lowerBound,w=this.upperBound;e.copy(y),t.set(w.x,y.y,y.z),n.set(w.x,w.y,y.z),i.set(y.x,w.y,w.z),o.set(w.x,y.y,w.z),c.set(y.x,w.y,y.z),f.set(y.x,y.y,w.z),m.copy(w)}toLocalFrame(e,t){const n=oR,i=n[0],o=n[1],c=n[2],f=n[3],m=n[4],y=n[5],w=n[6],S=n[7];this.getCorners(i,o,c,f,m,y,w,S);for(let C=0;C!==8;C++){const O=n[C];e.pointToLocal(O,O)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=oR,i=n[0],o=n[1],c=n[2],f=n[3],m=n[4],y=n[5],w=n[6],S=n[7];this.getCorners(i,o,c,f,m,y,w,S);for(let C=0;C!==8;C++){const O=n[C];e.pointToWorld(O,O)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,o=1/t.y,c=1/t.z,f=(this.lowerBound.x-n.x)*i,m=(this.upperBound.x-n.x)*i,y=(this.lowerBound.y-n.y)*o,w=(this.upperBound.y-n.y)*o,S=(this.lowerBound.z-n.z)*c,C=(this.upperBound.z-n.z)*c,O=Math.max(Math.max(Math.min(f,m),Math.min(y,w)),Math.min(S,C)),N=Math.min(Math.min(Math.max(f,m),Math.max(y,w)),Math.max(S,C));return!(N<0||O>N)}}const sR=new rt,oR=[new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt];class aR{constructor(){this.matrix=[]}get(e,t){let{index:n}=e,{index:i}=t;if(i>n){const o=i;i=n,n=o}return this.matrix[(n*(n+1)>>1)+i-1]}set(e,t,n){let{index:i}=e,{index:o}=t;if(o>i){const c=o;o=i,i=c}this.matrix[(i*(i+1)>>1)+o-1]=n?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class lR{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return!(n[e]===void 0||!n[e].includes(t))}hasAnyEventListener(e){return this._listeners!==void 0&&this._listeners[e]!==void 0}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners;if(n[e]===void 0)return this;const i=n[e].indexOf(t);return i!==-1&&n[e].splice(i,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class Fa{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){e===void 0&&(e=new rt),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=n2,i=i2;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Fa);const n=this.x,i=this.y,o=this.z,c=this.w,f=e.x,m=e.y,y=e.z,w=e.w;return t.x=n*w+c*f+i*y-o*m,t.y=i*w+c*m+o*f-n*y,t.z=o*w+c*y+n*m-i*f,t.w=c*w-n*f-i*m-o*y,t}inverse(e){e===void 0&&(e=new Fa);const t=this.x,n=this.y,i=this.z,o=this.w;this.conjugate(e);const c=1/(t*t+n*n+i*i+o*o);return e.x*=c,e.y*=c,e.z*=c,e.w*=c,e}conjugate(e){return e===void 0&&(e=new Fa),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new rt);const n=e.x,i=e.y,o=e.z,c=this.x,f=this.y,m=this.z,y=this.w,w=y*n+f*o-m*i,S=y*i+m*n-c*o,C=y*o+c*i-f*n,O=-c*n-f*i-m*o;return t.x=w*y+O*-c+S*-m-C*-f,t.y=S*y+O*-f+C*-c-w*-m,t.z=C*y+O*-m+w*-f-S*-c,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,o;t===void 0&&(t="YZX");const c=this.x,f=this.y,m=this.z,y=this.w;if(t!=="YZX")throw new Error(`Euler order ${t} not supported yet.`);{const w=c*f+m*y;if(w>.499&&(n=2*Math.atan2(c,y),i=Math.PI/2,o=0),w<-.499&&(n=-2*Math.atan2(c,y),i=-Math.PI/2,o=0),n===void 0){const S=c*c,C=f*f,O=m*m;n=Math.atan2(2*f*y-2*c*m,1-2*C-2*O),i=Math.asin(2*w),o=Math.atan2(2*c*y-2*f*m,1-2*S-2*O)}}e.y=n,e.z=i,e.x=o}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const o=Math.cos(e/2),c=Math.cos(t/2),f=Math.cos(n/2),m=Math.sin(e/2),y=Math.sin(t/2),w=Math.sin(n/2);return i==="XYZ"?(this.x=m*c*f+o*y*w,this.y=o*y*f-m*c*w,this.z=o*c*w+m*y*f,this.w=o*c*f-m*y*w):i==="YXZ"?(this.x=m*c*f+o*y*w,this.y=o*y*f-m*c*w,this.z=o*c*w-m*y*f,this.w=o*c*f+m*y*w):i==="ZXY"?(this.x=m*c*f-o*y*w,this.y=o*y*f+m*c*w,this.z=o*c*w+m*y*f,this.w=o*c*f-m*y*w):i==="ZYX"?(this.x=m*c*f-o*y*w,this.y=o*y*f+m*c*w,this.z=o*c*w-m*y*f,this.w=o*c*f+m*y*w):i==="YZX"?(this.x=m*c*f+o*y*w,this.y=o*y*f+m*c*w,this.z=o*c*w-m*y*f,this.w=o*c*f-m*y*w):i==="XZY"&&(this.x=m*c*f-o*y*w,this.y=o*y*f-m*c*w,this.z=o*c*w+m*y*f,this.w=o*c*f+m*y*w),this}clone(){return new Fa(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Fa);const i=this.x,o=this.y,c=this.z,f=this.w;let m,y,w,S,C,O=e.x,N=e.y,H=e.z,q=e.w;return y=i*O+o*N+c*H+f*q,y<0&&(y=-y,O=-O,N=-N,H=-H,q=-q),1-y>1e-6?(m=Math.acos(y),w=Math.sin(m),S=Math.sin((1-t)*m)/w,C=Math.sin(t*m)/w):(S=1-t,C=t),n.x=S*i+C*O,n.y=S*o+C*N,n.z=S*c+C*H,n.w=S*f+C*q,n}integrate(e,t,n,i){i===void 0&&(i=new Fa);const o=e.x*n.x,c=e.y*n.y,f=e.z*n.z,m=this.x,y=this.y,w=this.z,S=this.w,C=.5*t;return i.x+=C*(o*S+c*w-f*y),i.y+=C*(c*S+f*m-o*w),i.z+=C*(f*S+o*y-c*m),i.w+=C*(-o*m-c*y-f*w),i}}const n2=new rt,i2=new rt;class nr{constructor(e){e===void 0&&(e={}),this.id=nr.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}nr.idCounter=0,nr.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Ys{constructor(e){e===void 0&&(e={}),this.position=new rt,this.quaternion=new Fa,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Ys.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Ys.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new rt),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new rt),n.vsub(e,i),t.conjugate(cR),cR.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new rt),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new rt),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new rt),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const cR=new Fa;class jy extends nr{constructor(e){e===void 0&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:o,boundingSphereRadius:c}=e;super({type:nr.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=n,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),c?this.boundingSphereRadius=c:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new rt;for(let o=0;o!==e.length;o++){const c=e[o],f=c.length;for(let m=0;m!==f;m++){const y=(m+1)%f;t[c[m]].vsub(t[c[y]],i),i.normalize();let w=!1;for(let S=0;S!==n.length;S++)if(n[S].almostEquals(i)||n[S].almostEquals(i)){w=!0;break}w||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error(`Vertex ${this.faces[e][i]} not found!`);const t=this.faceNormals[e]||new rt;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let i=0;i<this.faces[e].length;i++)console.warn(`.vertices[${this.faces[e][i]}] = Vec3(${this.vertices[this.faces[e][i]].toString()})`)}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],o=this.vertices[n[1]],c=this.vertices[n[2]];jy.computeNormal(i,o,c,t)}static computeNormal(e,t,n,i){const o=new rt,c=new rt;t.vsub(e,c),n.vsub(t,o),o.cross(c,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,o,c,f,m,y){const w=new rt;let S=-1,C=-Number.MAX_VALUE;for(let N=0;N<n.faces.length;N++){w.copy(n.faceNormals[N]),o.vmult(w,w);const H=w.dot(c);H>C&&(C=H,S=N)}const O=[];for(let N=0;N<n.faces[S].length;N++){const H=n.vertices[n.faces[S][N]],q=new rt;q.copy(H),o.vmult(q,q),i.vadd(q,q),O.push(q)}S>=0&&this.clipFaceAgainstHull(c,e,t,O,f,m,y)}findSeparatingAxis(e,t,n,i,o,c,f,m){const y=new rt,w=new rt,S=new rt,C=new rt,O=new rt,N=new rt;let H=Number.MAX_VALUE;const q=this;if(q.uniqueAxes)for(let J=0;J!==q.uniqueAxes.length;J++){n.vmult(q.uniqueAxes[J],y);const V=q.testSepAxis(y,e,t,n,i,o);if(V===!1)return!1;V<H&&(H=V,c.copy(y))}else{const J=f?f.length:q.faces.length;for(let V=0;V<J;V++){const z=f?f[V]:V;y.copy(q.faceNormals[z]),n.vmult(y,y);const ue=q.testSepAxis(y,e,t,n,i,o);if(ue===!1)return!1;ue<H&&(H=ue,c.copy(y))}}if(e.uniqueAxes)for(let J=0;J!==e.uniqueAxes.length;J++){o.vmult(e.uniqueAxes[J],w);const V=q.testSepAxis(w,e,t,n,i,o);if(V===!1)return!1;V<H&&(H=V,c.copy(w))}else{const J=m?m.length:e.faces.length;for(let V=0;V<J;V++){const z=m?m[V]:V;w.copy(e.faceNormals[z]),o.vmult(w,w);const ue=q.testSepAxis(w,e,t,n,i,o);if(ue===!1)return!1;ue<H&&(H=ue,c.copy(w))}}for(let J=0;J!==q.uniqueEdges.length;J++){n.vmult(q.uniqueEdges[J],C);for(let V=0;V!==e.uniqueEdges.length;V++)if(o.vmult(e.uniqueEdges[V],O),C.cross(O,N),!N.almostZero()){N.normalize();const z=q.testSepAxis(N,e,t,n,i,o);if(z===!1)return!1;z<H&&(H=z,c.copy(N))}}return i.vsub(t,S),S.dot(c)>0&&c.negate(c),!0}testSepAxis(e,t,n,i,o,c){jy.project(this,e,n,i,SS),jy.project(t,e,o,c,MS);const f=SS[0],m=SS[1],y=MS[0],w=MS[1];if(f<w||y<m)return!1;const S=f-w,C=y-m;return S<C?S:C}calculateLocalInertia(e,t){const n=new rt,i=new rt;this.computeLocalAABB(i,n);const o=n.x-i.x,c=n.y-i.y,f=n.z-i.z;t.x=1/12*e*(2*c*2*c+2*f*2*f),t.y=1/12*e*(2*o*2*o+2*f*2*f),t.z=1/12*e*(2*c*2*c+2*o*2*o)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,o,c,f){const m=new rt,y=new rt,w=new rt,S=new rt,C=new rt,O=new rt,N=new rt,H=new rt,q=this,J=i,V=[];let z=-1,ue=Number.MAX_VALUE;for(let tt=0;tt<q.faces.length;tt++){m.copy(q.faceNormals[tt]),n.vmult(m,m);const lt=m.dot(e);lt<ue&&(ue=lt,z=tt)}if(z<0)return;const me=q.faces[z];me.connectedFaces=[];for(let tt=0;tt<q.faces.length;tt++)for(let lt=0;lt<q.faces[tt].length;lt++)me.indexOf(q.faces[tt][lt])!==-1&&tt!==z&&me.connectedFaces.indexOf(tt)===-1&&me.connectedFaces.push(tt);const Te=me.length;for(let tt=0;tt<Te;tt++){const lt=q.vertices[me[tt]],at=q.vertices[me[(tt+1)%Te]];lt.vsub(at,y),w.copy(y),n.vmult(w,w),t.vadd(w,w),S.copy(this.faceNormals[z]),n.vmult(S,S),t.vadd(S,S),w.cross(S,C),C.negate(C),O.copy(lt),n.vmult(O,O),t.vadd(O,O);const St=me.connectedFaces[tt];N.copy(this.faceNormals[St]);const mt=this.getPlaneConstantOfFace(St);H.copy(N),n.vmult(H,H);const gt=mt-H.dot(t);for(this.clipFaceAgainstPlane(J,V,H,gt);J.length;)J.shift();for(;V.length;)J.push(V.shift())}N.copy(this.faceNormals[z]);const Be=this.getPlaneConstantOfFace(z);H.copy(N),n.vmult(H,H);const He=Be-H.dot(t);for(let tt=0;tt<J.length;tt++){let lt=H.dot(J[tt])+He;if(lt<=o&&(console.log(`clamped: depth=${lt} to minDist=${o}`),lt=o),lt<=c){const at=J[tt];if(lt<=1e-6){const St={point:at,normal:H,depth:lt};f.push(St)}}}}clipFaceAgainstPlane(e,t,n,i){let o,c;const f=e.length;if(f<2)return t;let m=e[e.length-1],y=e[0];o=n.dot(m)+i;for(let w=0;w<f;w++){if(y=e[w],c=n.dot(y)+i,o<0)if(c<0){const S=new rt;S.copy(y),t.push(S)}else{const S=new rt;m.lerp(y,o/(o-c),S),t.push(S)}else if(c<0){const S=new rt;m.lerp(y,o/(o-c),S),t.push(S),t.push(y)}m=y,o=c}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new rt);const n=this.vertices,i=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)t.vmult(n[o],i[o]),e.vadd(i[o],i[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const o=n[i];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new rt);const n=this.faceNormals,i=this.worldFaceNormals;for(let o=0;o!==t;o++)e.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=this.vertices;let c,f,m,y,w,S,C=new rt;for(let O=0;O<o.length;O++){C.copy(o[O]),t.vmult(C,C),e.vadd(C,C);const N=C;(c===void 0||N.x<c)&&(c=N.x),(y===void 0||N.x>y)&&(y=N.x),(f===void 0||N.y<f)&&(f=N.y),(w===void 0||N.y>w)&&(w=N.y),(m===void 0||N.z<m)&&(m=N.z),(S===void 0||N.z>S)&&(S=N.z)}n.set(c,f,m),i.set(y,w,S)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new rt);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let o=0;o<n;o++){const c=i[o];t.vmult(c,c)}for(let o=0;o<this.faceNormals.length;o++){const c=this.faceNormals[o];t.vmult(c,c)}}if(e)for(let o=0;o<n;o++){const c=i[o];c.vadd(e,c)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,o=new rt;this.getAveragePointLocal(o);for(let c=0;c<this.faces.length;c++){let f=i[c];const m=t[n[c][0]],y=new rt;e.vsub(m,y);const w=f.dot(y),S=new rt;o.vsub(m,S);const C=f.dot(S);if(w<0&&C>0||w>0&&C<0)return!1}return-1}static project(e,t,n,i,o){const c=e.vertices.length,f=r2;let m=0,y=0;const w=s2,S=e.vertices;w.setZero(),Ys.vectorToLocalFrame(n,i,t,f),Ys.pointToLocalFrame(n,i,w,w);const C=w.dot(f);y=m=S[0].dot(f);for(let O=1;O<c;O++){const N=S[O].dot(f);N>m&&(m=N),N<y&&(y=N)}if(y-=C,m-=C,y>m){const O=y;y=m,m=O}o[0]=m,o[1]=y}}const SS=[],MS=[],r2=(new rt,new rt),s2=new rt;class fE extends nr{constructor(e){super({type:nr.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=rt,o=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],c=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],f=new jy({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:c});this.convexPolyhedronRepresentation=f,f.material=this.material}calculateLocalInertia(e,t){return t===void 0&&(t=new rt),fE.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),t!==void 0)for(let o=0;o!==n.length;o++)t.vmult(n[o],n[o]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,o=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let c=0;c<o.length;c++)S0.set(o[c][0],o[c][1],o[c][2]),t.vmult(S0,S0),e.vadd(S0,S0),n(S0.x,S0.y,S0.z)}calculateWorldAABB(e,t,n,i){const o=this.halfExtents;gg[0].set(o.x,o.y,o.z),gg[1].set(-o.x,o.y,o.z),gg[2].set(-o.x,-o.y,o.z),gg[3].set(-o.x,-o.y,-o.z),gg[4].set(o.x,-o.y,-o.z),gg[5].set(o.x,o.y,-o.z),gg[6].set(-o.x,o.y,-o.z),gg[7].set(o.x,-o.y,o.z);const c=gg[0];t.vmult(c,c),e.vadd(c,c),i.copy(c),n.copy(c);for(let f=1;f<8;f++){const m=gg[f];t.vmult(m,m),e.vadd(m,m);const y=m.x,w=m.y,S=m.z;y>i.x&&(i.x=y),w>i.y&&(i.y=w),S>i.z&&(i.z=S),y<n.x&&(n.x=y),w<n.y&&(n.y=w),S<n.z&&(n.z=S)}}}const S0=new rt,gg=[new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt];class ar extends lR{constructor(e){e===void 0&&(e={}),super(),this.id=ar.idCounter++,this.index=-1,this.world=null,this.vlambda=new rt,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse!="boolean"||e.collisionResponse,this.position=new rt,this.previousPosition=new rt,this.interpolatedPosition=new rt,this.initPosition=new rt,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new rt,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new rt,this.force=new rt;const t=typeof e.mass=="number"?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=t<=0?ar.STATIC:ar.DYNAMIC,typeof e.type==typeof ar.STATIC&&(this.type=e.type),this.allowSleep=e.allowSleep===void 0||e.allowSleep,this.sleepState=ar.AWAKE,this.sleepSpeedLimit=e.sleepSpeedLimit!==void 0?e.sleepSpeedLimit:.1,this.sleepTimeLimit=e.sleepTimeLimit!==void 0?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new rt,this.quaternion=new Fa,this.initQuaternion=new Fa,this.previousQuaternion=new Fa,this.interpolatedQuaternion=new Fa,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new rt,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new rt,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new rt,this.invInertia=new rt,this.invInertiaWorld=new Vf,this.invMassSolve=0,this.invInertiaSolve=new rt,this.invInertiaWorldSolve=new Vf,this.fixedRotation=e.fixedRotation!==void 0&&e.fixedRotation,this.angularDamping=e.angularDamping!==void 0?e.angularDamping:.01,this.linearFactor=new rt(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new rt(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new Sa,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new rt,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=ar.AWAKE,this.wakeUpAfterNarrowphase=!1,e===ar.SLEEPING&&this.dispatchEvent(ar.wakeupEvent)}sleep(){this.sleepState=ar.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===ar.AWAKE&&n<i?(this.sleepState=ar.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(ar.sleepyEvent)):t===ar.SLEEPY&&n>i?this.wakeUp():t===ar.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(ar.sleepEvent))}}updateSolveMassProperties(){this.sleepState===ar.SLEEPING||this.type===ar.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return t===void 0&&(t=new rt),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return t===void 0&&(t=new rt),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return t===void 0&&(t=new rt),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return t===void 0&&(t=new rt),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new rt,o=new Fa;return t&&i.copy(t),n&&o.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let o=0;o!==n;o++){const c=e[o];c.updateBoundingSphereRadius();const f=t[o].length(),m=c.boundingSphereRadius;f+m>i&&(i=f+m)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,o=o2,c=a2,f=this.quaternion,m=this.aabb,y=l2;for(let w=0;w!==i;w++){const S=e[w];f.vmult(t[w],o),o.vadd(this.position,o),f.mult(n[w],c),S.calculateWorldAABB(o,c,y.lowerBound,y.upperBound),w===0?m.copy(y):m.extend(y)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const n=c2,i=u2;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}}applyForce(e,t){if(t===void 0&&(t=new rt),this.type!==ar.DYNAMIC)return;this.sleepState===ar.SLEEPING&&this.wakeUp();const n=h2;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(t===void 0&&(t=new rt),this.type!==ar.DYNAMIC)return;const n=d2,i=p2;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===ar.DYNAMIC&&(this.sleepState===ar.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(t===void 0&&(t=new rt),this.type!==ar.DYNAMIC)return;this.sleepState===ar.SLEEPING&&this.wakeUp();const n=t,i=f2;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const o=m2;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t){if(t===void 0&&(t=new rt),this.type!==ar.DYNAMIC)return;const n=g2,i=_2;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=v2;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),fE.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new rt;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==ar.DYNAMIC&&this.type!==ar.KINEMATIC||this.sleepState===ar.SLEEPING)return;const i=this.velocity,o=this.angularVelocity,c=this.position,f=this.force,m=this.torque,y=this.quaternion,w=this.invMass,S=this.invInertiaWorld,C=this.linearFactor,O=w*e;i.x+=f.x*O*C.x,i.y+=f.y*O*C.y,i.z+=f.z*O*C.z;const N=S.elements,H=this.angularFactor,q=m.x*H.x,J=m.y*H.y,V=m.z*H.z;o.x+=e*(N[0]*q+N[1]*J+N[2]*V),o.y+=e*(N[3]*q+N[4]*J+N[5]*V),o.z+=e*(N[6]*q+N[7]*J+N[8]*V),c.x+=i.x*e,c.y+=i.y*e,c.z+=i.z*e,y.integrate(this.angularVelocity,e,this.angularFactor,y),t&&(n?y.normalizeFast():y.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}ar.idCounter=0,ar.COLLIDE_EVENT_NAME="collide",ar.DYNAMIC=1,ar.STATIC=2,ar.KINEMATIC=4,ar.AWAKE=0,ar.SLEEPY=1,ar.SLEEPING=2,ar.wakeupEvent={type:"wakeup"},ar.sleepyEvent={type:"sleepy"},ar.sleepEvent={type:"sleep"};const o2=new rt,a2=new Fa,l2=new Sa,c2=new Vf,u2=new Vf,h2=(new Vf,new rt),d2=new rt,p2=new rt,f2=new rt,m2=new rt,g2=new rt,_2=new rt,v2=new rt;class y2{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&ar.STATIC)==0&&e.sleepState!==ar.SLEEPING||(t.type&ar.STATIC)==0&&t.sleepState!==ar.SLEEPING)}intersectionTest(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)}doBoundingSphereBroadphase(e,t,n,i){const o=A2;t.position.vsub(e.position,o);const c=(e.boundingRadius+t.boundingRadius)**2;o.lengthSquared()<c&&(n.push(e),i.push(t))}doBoundingBoxBroadphase(e,t,n,i){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))}makePairsUnique(e,t){const n=b2,i=x2,o=w2,c=e.length;for(let f=0;f!==c;f++)i[f]=e[f],o[f]=t[f];e.length=0,t.length=0;for(let f=0;f!==c;f++){const m=i[f].id,y=o[f].id,w=m<y?`${m},${y}`:`${y},${m}`;n[w]=f,n.keys.push(w)}for(let f=0;f!==n.keys.length;f++){const m=n.keys.pop(),y=n[m];e.push(i[y]),t.push(o[y]),delete n[m]}}setWorld(e){}static boundingSphereCheck(e,t){const n=new rt;e.position.vsub(t.position,n);const i=e.shapes[0],o=t.shapes[0];return Math.pow(i.boundingSphereRadius+o.boundingSphereRadius,2)>n.lengthSquared()}aabbQuery(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const A2=new rt;new rt,new Fa,new rt;const b2={keys:[]},x2=[],w2=[];new rt,new rt,new rt;class E2 extends y2{constructor(){super()}collisionPairs(e,t,n){const i=e.bodies,o=i.length;let c,f;for(let m=0;m!==o;m++)for(let y=0;y!==m;y++)c=i[m],f=i[y],this.needBroadphaseCollision(c,f)&&this.intersectionTest(c,f,t,n)}aabbQuery(e,t,n){n===void 0&&(n=[]);for(let i=0;i<e.bodies.length;i++){const o=e.bodies[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&n.push(o)}return n}}class mE{constructor(){this.rayFromWorld=new rt,this.rayToWorld=new rt,this.hitNormalWorld=new rt,this.hitPointWorld=new rt,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,o,c,f){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=o,this.body=c,this.distance=f}}let uR,hR,dR,pR,fR,mR,gR;uR=nr.types.SPHERE,hR=nr.types.PLANE,dR=nr.types.BOX,pR=nr.types.CYLINDER,fR=nr.types.CONVEXPOLYHEDRON,mR=nr.types.HEIGHTFIELD,gR=nr.types.TRIMESH;class Gl{get[uR](){return this._intersectSphere}get[hR](){return this._intersectPlane}get[dR](){return this._intersectBox}get[pR](){return this._intersectConvex}get[fR](){return this._intersectConvex}get[mR](){return this._intersectHeightfield}get[gR](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new rt),t===void 0&&(t=new rt),this.from=e.clone(),this.to=t.clone(),this.direction=new rt,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Gl.ANY,this.result=new mE,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Gl.ANY,this.result=t.result||new mE,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:-1,this.checkCollisionResponse=t.checkCollisionResponse===void 0||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(_R),TS.length=0,e.broadphase.aabbQuery(e,_R,TS),this.intersectBodies(TS),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const i=S2,o=M2;for(let c=0,f=e.shapes.length;c<f;c++){const m=e.shapes[c];if((!n||m.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[c],o),e.quaternion.vmult(e.shapeOffsets[c],i),i.vadd(e.position,i),this.intersectShape(m,o,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){if(function(f,m,y){y.vsub(f,Vy);const w=Vy.dot(m);return m.scale(w,_E),_E.vadd(f,_E),y.distanceTo(_E)}(this.from,this.direction,n)>e.boundingSphereRadius)return;const c=this[e.type];c&&c.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,o)}_intersectPlane(e,t,n,i,o){const c=this.from,f=this.to,m=this.direction,y=new rt(0,0,1);t.vmult(y,y);const w=new rt;c.vsub(n,w);const S=w.dot(y);if(f.vsub(n,w),S*w.dot(y)>0||c.distanceTo(f)<S)return;const C=y.dot(m);if(Math.abs(C)<this.precision)return;const O=new rt,N=new rt,H=new rt;c.vsub(n,O);const q=-y.dot(O)/C;m.scale(q,N),c.vadd(N,H),this.reportIntersection(y,H,o,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,o=this.from;t.x=Math.min(i.x,o.x),t.y=Math.min(i.y,o.y),t.z=Math.min(i.z,o.z),n.x=Math.max(i.x,o.x),n.y=Math.max(i.y,o.y),n.z=Math.max(i.z,o.z)}_intersectHeightfield(e,t,n,i,o){e.data,e.elementSize;const c=T2;c.from.copy(this.from),c.to.copy(this.to),Ys.pointToLocalFrame(n,t,c.from,c.from),Ys.pointToLocalFrame(n,t,c.to,c.to),c.updateDirection();const f=C2;let m,y,w,S;m=y=0,w=S=e.data.length-1;const C=new Sa;c.getAABB(C),e.getIndexOfPosition(C.lowerBound.x,C.lowerBound.y,f,!0),m=Math.max(m,f[0]),y=Math.max(y,f[1]),e.getIndexOfPosition(C.upperBound.x,C.upperBound.y,f,!0),w=Math.min(w,f[0]+1),S=Math.min(S,f[1]+1);for(let O=m;O<w;O++)for(let N=y;N<S;N++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(O,N,C),C.overlapsRay(c)){if(e.getConvexTrianglePillar(O,N,!1),Ys.pointToWorldFrame(n,t,e.pillarOffset,gE),this._intersectConvex(e.pillarConvex,t,gE,i,o,vR),this.result.shouldStop)return;e.getConvexTrianglePillar(O,N,!0),Ys.pointToWorldFrame(n,t,e.pillarOffset,gE),this._intersectConvex(e.pillarConvex,t,gE,i,o,vR)}}}_intersectSphere(e,t,n,i,o){const c=this.from,f=this.to,m=e.radius,y=(f.x-c.x)**2+(f.y-c.y)**2+(f.z-c.z)**2,w=2*((f.x-c.x)*(c.x-n.x)+(f.y-c.y)*(c.y-n.y)+(f.z-c.z)*(c.z-n.z)),S=w**2-4*y*((c.x-n.x)**2+(c.y-n.y)**2+(c.z-n.z)**2-m**2),C=R2,O=I2;if(!(S<0))if(S===0)c.lerp(f,S,C),C.vsub(n,O),O.normalize(),this.reportIntersection(O,C,o,i,-1);else{const N=(-w-Math.sqrt(S))/(2*y),H=(-w+Math.sqrt(S))/(2*y);if(N>=0&&N<=1&&(c.lerp(f,N,C),C.vsub(n,O),O.normalize(),this.reportIntersection(O,C,o,i,-1)),this.result.shouldStop)return;H>=0&&H<=1&&(c.lerp(f,H,C),C.vsub(n,O),O.normalize(),this.reportIntersection(O,C,o,i,-1))}}_intersectConvex(e,t,n,i,o,c){const f=P2,m=yR,y=c&&c.faceList||null,w=e.faces,S=e.vertices,C=e.faceNormals,O=this.direction,N=this.from,H=this.to,q=N.distanceTo(H),J=y?y.length:w.length,V=this.result;for(let z=0;!V.shouldStop&&z<J;z++){const ue=y?y[z]:z,me=w[ue],Te=C[ue],Be=t,He=n;m.copy(S[me[0]]),Be.vmult(m,m),m.vadd(He,m),m.vsub(N,m),Be.vmult(Te,f);const tt=O.dot(f);if(Math.abs(tt)<this.precision)continue;const lt=f.dot(m)/tt;if(!(lt<0)){O.scale(lt,ld),ld.vadd(N,ld),Gf.copy(S[me[0]]),Be.vmult(Gf,Gf),He.vadd(Gf,Gf);for(let at=1;!V.shouldStop&&at<me.length-1;at++){_g.copy(S[me[at]]),vg.copy(S[me[at+1]]),Be.vmult(_g,_g),Be.vmult(vg,vg),He.vadd(_g,_g),He.vadd(vg,vg);const St=ld.distanceTo(N);!Gl.pointInTriangle(ld,Gf,_g,vg)&&!Gl.pointInTriangle(ld,_g,Gf,vg)||St>q||this.reportIntersection(f,ld,o,i,ue)}}}}_intersectTrimesh(e,t,n,i,o,c){const f=D2,m=U2,y=F2,w=yR,S=O2,C=B2,O=L2,N=k2,H=N2,q=e.indices;e.vertices;const J=this.from,V=this.to,z=this.direction;y.position.copy(n),y.quaternion.copy(t),Ys.vectorToLocalFrame(n,t,z,S),Ys.pointToLocalFrame(n,t,J,C),Ys.pointToLocalFrame(n,t,V,O),O.x*=e.scale.x,O.y*=e.scale.y,O.z*=e.scale.z,C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,O.vsub(C,S),S.normalize();const ue=C.distanceSquared(O);e.tree.rayQuery(this,y,m);for(let me=0,Te=m.length;!this.result.shouldStop&&me!==Te;me++){const Be=m[me];e.getNormal(Be,f),e.getVertex(q[3*Be],Gf),Gf.vsub(C,w);const He=S.dot(f),tt=f.dot(w)/He;if(tt<0)continue;S.scale(tt,ld),ld.vadd(C,ld),e.getVertex(q[3*Be+1],_g),e.getVertex(q[3*Be+2],vg);const lt=ld.distanceSquared(C);!Gl.pointInTriangle(ld,_g,Gf,vg)&&!Gl.pointInTriangle(ld,Gf,_g,vg)||lt>ue||(Ys.vectorToWorldFrame(t,f,H),Ys.pointToWorldFrame(n,t,ld,N),this.reportIntersection(H,N,o,i,Be))}m.length=0}reportIntersection(e,t,n,i,o){const c=this.from,f=this.to,m=c.distanceTo(t),y=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(y.hitFaceIndex=o!==void 0?o:-1,this.mode){case Gl.ALL:this.hasHit=!0,y.set(c,f,e,t,n,i,m),y.hasHit=!0,this.callback(y);break;case Gl.CLOSEST:(m<y.distance||!y.hasHit)&&(this.hasHit=!0,y.hasHit=!0,y.set(c,f,e,t,n,i,m));break;case Gl.ANY:this.hasHit=!0,y.hasHit=!0,y.set(c,f,e,t,n,i,m),y.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,Vy),n.vsub(t,xx),e.vsub(t,CS);const o=Vy.dot(Vy),c=Vy.dot(xx),f=Vy.dot(CS),m=xx.dot(xx),y=xx.dot(CS);let w,S;return(w=m*f-c*y)>=0&&(S=o*y-c*f)>=0&&w+S<o*m-c*c}}Gl.CLOSEST=1,Gl.ANY=2,Gl.ALL=4;const _R=new Sa,TS=[],xx=new rt,CS=new rt,S2=new rt,M2=new Fa,ld=new rt,Gf=new rt,_g=new rt,vg=new rt;new rt,new mE;const vR={faceList:[0]},gE=new rt,T2=new Gl,C2=[],R2=new rt,I2=new rt,P2=new rt,yR=(new rt,new rt,new rt),D2=new rt,O2=new rt,B2=new rt,L2=new rt,N2=new rt,k2=new rt;new Sa;const U2=[],F2=new Ys,Vy=new rt,_E=new rt;class AR{static defaults(e,t){e===void 0&&(e={});for(let n in t)n in e||(e[n]=t[n]);return e}}class vE{constructor(e,t,n){n===void 0&&(n={}),n=AR.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=vE.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}vE.idCounter=0;class bR{constructor(){this.spatial=new rt,this.rotational=new rt}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class wx{constructor(e,t,n,i){n===void 0&&(n=-1e6),i===void 0&&(i=1e6),this.id=wx.idCounter++,this.minForce=n,this.maxForce=i,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new bR,this.jacobianElementB=new bR,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,n){const i=t,o=e,c=n;this.a=4/(c*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(c*c*o*(1+4*i))}computeB(e,t,n){const i=this.computeGW();return-this.computeGq()*e-i*t-this.computeGiMf()*n}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.position,c=i.position;return e.spatial.dot(o)+t.spatial.dot(c)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.velocity,c=i.velocity,f=n.angularVelocity,m=i.angularVelocity;return e.multiplyVectors(o,f)+t.multiplyVectors(c,m)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.vlambda,c=i.vlambda,f=n.wlambda,m=i.wlambda;return e.multiplyVectors(o,f)+t.multiplyVectors(c,m)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.force,c=n.torque,f=i.force,m=i.torque,y=n.invMassSolve,w=i.invMassSolve;return o.scale(y,xR),f.scale(w,wR),n.invInertiaWorldSolve.vmult(c,ER),i.invInertiaWorldSolve.vmult(m,SR),e.multiplyVectors(xR,ER)+t.multiplyVectors(wR,SR)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,o=n.invMassSolve,c=i.invMassSolve,f=n.invInertiaWorldSolve,m=i.invInertiaWorldSolve;let y=o+c;return f.vmult(e.rotational,yE),y+=yE.dot(e.rotational),m.vmult(t.rotational,yE),y+=yE.dot(t.rotational),y}addToWlambda(e){const t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,o=this.bj,c=z2;i.vlambda.addScaledVector(i.invMassSolve*e,t.spatial,i.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,n.spatial,o.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,c),i.wlambda.addScaledVector(e,c,i.wlambda),o.invInertiaWorldSolve.vmult(n.rotational,c),o.wlambda.addScaledVector(e,c,o.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}wx.idCounter=0;const xR=new rt,wR=new rt,ER=new rt,SR=new rt,yE=new rt,z2=new rt;class AE extends wx{constructor(e,t,n){n===void 0&&(n=1e6),super(e,t,0,n),this.restitution=0,this.ri=new rt,this.rj=new rt,this.ni=new rt}computeB(e){const t=this.a,n=this.b,i=this.bi,o=this.bj,c=this.ri,f=this.rj,m=j2,y=V2,w=i.velocity,S=i.angularVelocity;i.force,i.torque;const C=o.velocity,O=o.angularVelocity;o.force,o.torque;const N=G2,H=this.jacobianElementA,q=this.jacobianElementB,J=this.ni;c.cross(J,m),f.cross(J,y),J.negate(H.spatial),m.negate(H.rotational),q.spatial.copy(J),q.rotational.copy(y),N.copy(o.position),N.vadd(f,N),N.vsub(i.position,N),N.vsub(c,N);const V=J.dot(N),z=this.restitution+1;return-V*t-(z*C.dot(J)-z*w.dot(J)+O.dot(y)-S.dot(m))*n-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=H2,t=W2,n=Q2,i=q2,o=X2;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,o),this.ni.dot(o)}}const j2=new rt,V2=new rt,G2=new rt,H2=new rt,W2=new rt,Q2=new rt,q2=new rt,X2=new rt;class Y2 extends vE{constructor(e,t,n,i,o){t===void 0&&(t=new rt),i===void 0&&(i=new rt),o===void 0&&(o=1e6),super(e,n),this.pivotA=t.clone(),this.pivotB=i.clone();const c=this.equationX=new AE(e,n),f=this.equationY=new AE(e,n),m=this.equationZ=new AE(e,n);this.equations.push(c,f,m),c.minForce=f.minForce=m.minForce=-o,c.maxForce=f.maxForce=m.maxForce=o,c.ni.set(1,0,0),f.ni.set(0,1,0),m.ni.set(0,0,1)}update(){const e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,o=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),o.ri.copy(n.ri),o.rj.copy(n.rj)}}new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt;class MR extends wx{constructor(e,t,n){super(e,t,-n,n),this.ri=new rt,this.rj=new rt,this.t=new rt}computeB(e){this.a;const t=this.b;this.bi,this.bj;const n=this.ri,i=this.rj,o=K2,c=$2,f=this.t;n.cross(f,o),i.cross(f,c);const m=this.jacobianElementA,y=this.jacobianElementB;return f.negate(m.spatial),o.negate(m.rotational),y.spatial.copy(f),y.rotational.copy(c),-this.computeGW()*t-e*this.computeGiMf()}}const K2=new rt,$2=new rt;class bE{constructor(e,t,n){n=AR.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=bE.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}}bE.idCounter=0;class xE{constructor(e){e===void 0&&(e={});let t="";typeof e=="string"&&(t=e,e={}),this.name=t,this.id=xE.idCounter++,this.friction=e.friction!==void 0?e.friction:-1,this.restitution=e.restitution!==void 0?e.restitution:-1}}xE.idCounter=0,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new Gl,new rt,new rt,new rt,new rt(1,0,0),new rt(0,1,0),new rt(0,0,1),new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt;class TR extends nr{constructor(e){if(super({type:nr.types.SPHERE}),this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){t===void 0&&(t=new rt);const n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,n,i){const o=this.radius,c=["x","y","z"];for(let f=0;f<c.length;f++){const m=c[f];n[m]=e[m]-o,i[m]=e[m]+o}}}new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt;class J2 extends jy{constructor(e,t,n,i){if(e===void 0&&(e=1),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const o=i,c=[],f=[],m=[],y=[],w=[],S=Math.cos,C=Math.sin;c.push(new rt(-t*C(0),.5*-n,t*S(0))),y.push(0),c.push(new rt(-e*C(0),.5*n,e*S(0))),w.push(1);for(let N=0;N<o;N++){const H=2*Math.PI/o*(N+1),q=2*Math.PI/o*(N+.5);N<o-1?(c.push(new rt(-t*C(H),.5*-n,t*S(H))),y.push(2*N+2),c.push(new rt(-e*C(H),.5*n,e*S(H))),w.push(2*N+3),m.push([2*N,2*N+1,2*N+3,2*N+2])):m.push([2*N,2*N+1,1,0]),(o%2==1||N<o/2)&&f.push(new rt(-C(q),0,S(q)))}m.push(y),f.push(new rt(0,1,0));const O=[];for(let N=0;N<w.length;N++)O.push(w[w.length-N-1]);m.push(O),super({vertices:c,faces:m,axes:f}),this.type=nr.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=n,this.numSegments=i}}class Z2 extends nr{constructor(){super({type:nr.types.PLANE}),this.worldNormal=new rt,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return t===void 0&&(t=new rt),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,n,i){X_.set(0,0,1),t.vmult(X_,X_);const o=Number.MAX_VALUE;n.set(-o,-o,-o),i.set(o,o,o),X_.x===1?i.x=e.x:X_.x===-1&&(n.x=e.x),X_.y===1?i.y=e.y:X_.y===-1&&(n.y=e.y),X_.z===1?i.z=e.z:X_.z===-1&&(n.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const X_=new rt;new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt;class yg{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new Sa,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,n){n===void 0&&(n=0);const i=this.data;if(!this.aabb.contains(e))return!1;const o=this.children;if(n<(this.maxDepth||this.root.maxDepth)){let c=!1;o.length||(this.subdivide(),c=!0);for(let f=0;f!==8;f++)if(o[f].insert(e,t,n+1))return!0;c&&(o.length=0)}return i.push(t),!0}subdivide(){const e=this.aabb,t=e.lowerBound,n=e.upperBound,i=this.children;i.push(new yg({aabb:new Sa({lowerBound:new rt(0,0,0)})}),new yg({aabb:new Sa({lowerBound:new rt(1,0,0)})}),new yg({aabb:new Sa({lowerBound:new rt(1,1,0)})}),new yg({aabb:new Sa({lowerBound:new rt(1,1,1)})}),new yg({aabb:new Sa({lowerBound:new rt(0,1,1)})}),new yg({aabb:new Sa({lowerBound:new rt(0,0,1)})}),new yg({aabb:new Sa({lowerBound:new rt(1,0,1)})}),new yg({aabb:new Sa({lowerBound:new rt(0,1,0)})})),n.vsub(t,Gy),Gy.scale(.5,Gy);const o=this.root||this;for(let c=0;c!==8;c++){const f=i[c];f.root=o;const m=f.aabb.lowerBound;m.x*=Gy.x,m.y*=Gy.y,m.z*=Gy.z,m.vadd(t,m),m.vadd(Gy,f.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;const n=[this];for(;n.length;){const i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t}rayQuery(e,t,n){return e.getAABB(wE),wE.toLocalFrame(t,wE),this.aabbQuery(wE,n),n}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class eO extends yg{constructor(e,t){t===void 0&&(t={}),super({root:null,aabb:e}),this.maxDepth=t.maxDepth!==void 0?t.maxDepth:8}}const Gy=new rt,wE=new Sa;class EE extends nr{constructor(e,t){super({type:nr.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new Sa,this.edges=null,this.scale=new rt(1,1,1),this.tree=new eO,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;const n=new Sa,i=new rt,o=new rt,c=new rt,f=[i,o,c];for(let m=0;m<this.indices.length/3;m++){const y=3*m;this._getUnscaledVertex(this.indices[y],i),this._getUnscaledVertex(this.indices[y+1],o),this._getUnscaledVertex(this.indices[y+2],c),n.setFromPoints(f),e.insert(n,m)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){SE.copy(e);const n=this.scale,i=n.x,o=n.y,c=n.z,f=SE.lowerBound,m=SE.upperBound;return f.x/=i,f.y/=o,f.z/=c,m.x/=i,m.y/=o,m.z/=c,this.tree.aabbQuery(SE,t)}setScale(e){const t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,n=e.x===e.y&&e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=tO,t=this.normals;for(let n=0;n<this.indices.length/3;n++){const i=3*n,o=this.indices[i],c=this.indices[i+1],f=this.indices[i+2];this.getVertex(o,IR),this.getVertex(c,PR),this.getVertex(f,DR),EE.computeNormal(PR,IR,DR,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}}updateEdges(){const e={},t=(i,o)=>{e[i<o?`${i}_${o}`:`${o}_${i}`]=!0};for(let i=0;i<this.indices.length/3;i++){const o=3*i,c=this.indices[o],f=this.indices[o+1],m=this.indices[o+2];t(c,f),t(f,m),t(m,c)}const n=Object.keys(e);this.edges=new Int16Array(2*n.length);for(let i=0;i<n.length;i++){const o=n[i].split("_");this.edges[2*i]=parseInt(o[0],10),this.edges[2*i+1]=parseInt(o[1],10)}}getEdgeVertex(e,t,n){const i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)}getEdgeVector(e,t){const n=nO,i=iO;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)}static computeNormal(e,t,n,i){t.vsub(e,RR),n.vsub(t,CR),CR.cross(RR,i),i.isZero()||i.normalize()}getVertex(e,t){const n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t}_getUnscaledVertex(e,t){const n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])}getWorldVertex(e,t,n,i){return this.getVertex(e,i),Ys.pointToWorldFrame(t,n,i,i),i}getTriangleVertices(e,t,n,i){const o=3*e;this.getVertex(this.indices[o],t),this.getVertex(this.indices[o+1],n),this.getVertex(this.indices[o+2],i)}getNormal(e,t){const n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])}calculateLocalInertia(e,t){this.computeLocalAABB(Hy);const n=Hy.upperBound.x-Hy.lowerBound.x,i=Hy.upperBound.y-Hy.lowerBound.y,o=Hy.upperBound.z-Hy.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*o*2*o),1/12*e*(2*n*2*n+2*o*2*o),1/12*e*(2*i*2*i+2*n*2*n))}computeLocalAABB(e){const t=e.lowerBound,n=e.upperBound,i=this.vertices.length;this.vertices;const o=rO;this.getVertex(0,o),t.copy(o),n.copy(o);for(let c=0;c!==i;c++)this.getVertex(c,o),o.x<t.x?t.x=o.x:o.x>n.x&&(n.x=o.x),o.y<t.y?t.y=o.y:o.y>n.y&&(n.y=o.y),o.z<t.z?t.z=o.z:o.z>n.z&&(n.z=o.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const t=this.vertices,n=new rt;for(let i=0,o=t.length/3;i!==o;i++){this.getVertex(i,n);const c=n.lengthSquared();c>e&&(e=c)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=sO,c=oO;o.position=e,o.quaternion=t,this.aabb.toWorldFrame(o,c),n.copy(c.lowerBound),i.copy(c.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,n,i,o){e===void 0&&(e=1),t===void 0&&(t=.5),n===void 0&&(n=8),i===void 0&&(i=6),o===void 0&&(o=2*Math.PI);const c=[],f=[];for(let m=0;m<=n;m++)for(let y=0;y<=i;y++){const w=y/i*o,S=m/n*Math.PI*2,C=(e+t*Math.cos(S))*Math.cos(w),O=(e+t*Math.cos(S))*Math.sin(w),N=t*Math.sin(S);c.push(C,O,N)}for(let m=1;m<=n;m++)for(let y=1;y<=i;y++){const w=(i+1)*m+y-1,S=(i+1)*(m-1)+y-1,C=(i+1)*(m-1)+y,O=(i+1)*m+y;f.push(w,S,O),f.push(S,C,O)}return new EE(c,f)}}const tO=new rt,SE=new Sa,nO=new rt,iO=new rt,CR=new rt,RR=new rt,IR=new rt,PR=new rt,DR=new rt,Hy=new Sa,rO=new rt,sO=new Ys,oO=new Sa;class aO{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,n=t.indexOf(e);n!==-1&&t.splice(n,1)}removeAllEquations(){this.equations.length=0}}class lO extends aO{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let n=0;const i=this.iterations,o=this.tolerance*this.tolerance,c=this.equations,f=c.length,m=t.bodies,y=m.length,w=e;let S,C,O,N,H,q;if(f!==0)for(let ue=0;ue!==y;ue++)m[ue].updateSolveMassProperties();const J=uO,V=hO,z=cO;J.length=f,V.length=f,z.length=f;for(let ue=0;ue!==f;ue++){const me=c[ue];z[ue]=0,V[ue]=me.computeB(w),J[ue]=1/me.computeC()}if(f!==0){for(let Te=0;Te!==y;Te++){const Be=m[Te],He=Be.vlambda,tt=Be.wlambda;He.set(0,0,0),tt.set(0,0,0)}for(n=0;n!==i;n++){N=0;for(let Te=0;Te!==f;Te++){const Be=c[Te];S=V[Te],C=J[Te],q=z[Te],H=Be.computeGWlambda(),O=C*(S-H-Be.eps*q),q+O<Be.minForce?O=Be.minForce-q:q+O>Be.maxForce&&(O=Be.maxForce-q),z[Te]+=O,N+=O>0?O:-O,Be.addToWlambda(O)}if(N*N<o)break}for(let Te=0;Te!==y;Te++){const Be=m[Te],He=Be.velocity,tt=Be.angularVelocity;Be.vlambda.vmul(Be.linearFactor,Be.vlambda),He.vadd(Be.vlambda,He),Be.wlambda.vmul(Be.angularFactor,Be.wlambda),tt.vadd(Be.wlambda,tt)}let ue=c.length;const me=1/w;for(;ue--;)c[ue].multiplier=z[ue]*me}return n}}const cO=[],uO=[],hO=[];ar.STATIC;class dO{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class pO extends dO{constructor(){super(...arguments),this.type=rt}constructObject(){return new rt}}const fO=nr.types.SPHERE,mO=nr.types.SPHERE|nr.types.PLANE,gO=nr.types.BOX|nr.types.BOX,_O=nr.types.SPHERE|nr.types.BOX,vO=nr.types.PLANE|nr.types.BOX,yO=nr.types.CONVEXPOLYHEDRON,AO=nr.types.SPHERE|nr.types.CONVEXPOLYHEDRON,bO=nr.types.PLANE|nr.types.CONVEXPOLYHEDRON,xO=nr.types.BOX|nr.types.CONVEXPOLYHEDRON,wO=nr.types.SPHERE|nr.types.HEIGHTFIELD,EO=nr.types.BOX|nr.types.HEIGHTFIELD,SO=nr.types.CONVEXPOLYHEDRON|nr.types.HEIGHTFIELD,MO=nr.types.PARTICLE|nr.types.SPHERE,TO=nr.types.PLANE|nr.types.PARTICLE,CO=nr.types.BOX|nr.types.PARTICLE,RO=nr.types.PARTICLE|nr.types.CONVEXPOLYHEDRON,IO=nr.types.CYLINDER,PO=nr.types.SPHERE|nr.types.CYLINDER,DO=nr.types.PLANE|nr.types.CYLINDER,OO=nr.types.BOX|nr.types.CYLINDER,BO=nr.types.CONVEXPOLYHEDRON|nr.types.CYLINDER,LO=nr.types.HEIGHTFIELD|nr.types.CYLINDER,kO=nr.types.PARTICLE|nr.types.CYLINDER,UO=nr.types.SPHERE|nr.types.TRIMESH,FO=nr.types.PLANE|nr.types.TRIMESH;class zO{get[fO](){return this.sphereSphere}get[mO](){return this.spherePlane}get[gO](){return this.boxBox}get[_O](){return this.sphereBox}get[vO](){return this.planeBox}get[yO](){return this.convexConvex}get[AO](){return this.sphereConvex}get[bO](){return this.planeConvex}get[xO](){return this.boxConvex}get[wO](){return this.sphereHeightfield}get[EO](){return this.boxHeightfield}get[SO](){return this.convexHeightfield}get[MO](){return this.sphereParticle}get[TO](){return this.planeParticle}get[CO](){return this.boxParticle}get[RO](){return this.convexParticle}get[IO](){return this.convexConvex}get[PO](){return this.sphereConvex}get[DO](){return this.planeConvex}get[OO](){return this.boxConvex}get[BO](){return this.convexConvex}get[LO](){return this.heightfieldCylinder}get[kO](){return this.particleCylinder}get[UO](){return this.sphereTrimesh}get[FO](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new pO,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,n,i,o,c){let f;this.contactPointPool.length?(f=this.contactPointPool.pop(),f.bi=e,f.bj=t):f=new AE(e,t),f.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;const m=this.currentContactMaterial;f.restitution=m.restitution,f.setSpookParams(m.contactEquationStiffness,m.contactEquationRelaxation,this.world.dt);const y=n.material||e.material,w=i.material||t.material;return y&&w&&y.restitution>=0&&w.restitution>=0&&(f.restitution=y.restitution*w.restitution),f.si=o||n,f.sj=c||i,f}createFrictionEquationsFromContact(e,t){const n=e.bi,i=e.bj,o=e.si,c=e.sj,f=this.world,m=this.currentContactMaterial;let y=m.friction;const w=o.material||n.material,S=c.material||i.material;if(w&&S&&w.friction>=0&&S.friction>=0&&(y=w.friction*S.friction),y>0){const C=y*f.gravity.length();let O=n.invMass+i.invMass;O>0&&(O=1/O);const N=this.frictionEquationPool,H=N.length?N.pop():new MR(n,i,C*O),q=N.length?N.pop():new MR(n,i,C*O);return H.bi=q.bi=n,H.bj=q.bj=i,H.minForce=q.minForce=-C*O,H.maxForce=q.maxForce=C*O,H.ri.copy(e.ri),H.rj.copy(e.rj),q.ri.copy(e.ri),q.rj.copy(e.rj),e.ni.tangents(H.t,q.t),H.setSpookParams(m.frictionEquationStiffness,m.frictionEquationRelaxation,f.dt),q.setSpookParams(m.frictionEquationStiffness,m.frictionEquationRelaxation,f.dt),H.enabled=q.enabled=e.enabled,t.push(H,q),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||e===1)return;const n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];Wy.setZero(),mb.setZero(),gb.setZero();const o=t.bi;t.bj;for(let f=0;f!==e;f++)t=this.result[this.result.length-1-f],t.bi!==o?(Wy.vadd(t.ni,Wy),mb.vadd(t.ri,mb),gb.vadd(t.rj,gb)):(Wy.vsub(t.ni,Wy),mb.vadd(t.rj,mb),gb.vadd(t.ri,gb));const c=1/e;mb.scale(c,n.ri),gb.scale(c,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),Wy.normalize(),Wy.tangents(n.t,i.t)}getContacts(e,t,n,i,o,c,f){this.contactPointPool=o,this.frictionEquationPool=f,this.result=i,this.frictionResult=c;const m=GO,y=HO,w=jO,S=VO;for(let C=0,O=e.length;C!==O;C++){const N=e[C],H=t[C];let q=null;N.material&&H.material&&(q=n.getContactMaterial(N.material,H.material)||null);const J=N.type&ar.KINEMATIC&&H.type&ar.STATIC||N.type&ar.STATIC&&H.type&ar.KINEMATIC||N.type&ar.KINEMATIC&&H.type&ar.KINEMATIC;for(let V=0;V<N.shapes.length;V++){N.quaternion.mult(N.shapeOrientations[V],m),N.quaternion.vmult(N.shapeOffsets[V],w),w.vadd(N.position,w);const z=N.shapes[V];for(let ue=0;ue<H.shapes.length;ue++){H.quaternion.mult(H.shapeOrientations[ue],y),H.quaternion.vmult(H.shapeOffsets[ue],S),S.vadd(H.position,S);const me=H.shapes[ue];if(!(z.collisionFilterMask&me.collisionFilterGroup&&me.collisionFilterMask&z.collisionFilterGroup)||w.distanceTo(S)>z.boundingSphereRadius+me.boundingSphereRadius)continue;let Te=null;z.material&&me.material&&(Te=n.getContactMaterial(z.material,me.material)||null),this.currentContactMaterial=Te||q||n.defaultContactMaterial;const Be=this[z.type|me.type];if(Be){let He=!1;He=z.type<me.type?Be.call(this,z,me,w,S,m,y,N,H,z,me,J):Be.call(this,me,z,S,w,y,m,H,N,z,me,J),He&&J&&(n.shapeOverlapKeeper.set(z.id,me.id),n.bodyOverlapKeeper.set(N.id,H.id))}}}}}sphereSphere(e,t,n,i,o,c,f,m,y,w,S){if(S)return n.distanceSquared(i)<(e.radius+t.radius)**2;const C=this.createContactEquation(f,m,e,t,y,w);i.vsub(n,C.ni),C.ni.normalize(),C.ri.copy(C.ni),C.rj.copy(C.ni),C.ri.scale(e.radius,C.ri),C.rj.scale(-t.radius,C.rj),C.ri.vadd(n,C.ri),C.ri.vsub(f.position,C.ri),C.rj.vadd(i,C.rj),C.rj.vsub(m.position,C.rj),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}spherePlane(e,t,n,i,o,c,f,m,y,w,S){const C=this.createContactEquation(f,m,e,t,y,w);if(C.ni.set(0,0,1),c.vmult(C.ni,C.ni),C.ni.negate(C.ni),C.ni.normalize(),C.ni.scale(e.radius,C.ri),n.vsub(i,ME),C.ni.scale(C.ni.dot(ME),OR),ME.vsub(OR,C.rj),-ME.dot(C.ni)<=e.radius){if(S)return!0;const O=C.ri,N=C.rj;O.vadd(n,O),O.vsub(f.position,O),N.vadd(i,N),N.vsub(m.position,N),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}}boxBox(e,t,n,i,o,c,f,m,y,w,S){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,o,c,f,m,e,t,S)}sphereBox(e,t,n,i,o,c,f,m,y,w,S){const C=this.v3pool,O=gB;n.vsub(i,TE),t.getSideNormals(O,c);const N=e.radius;let H=!1;const q=vB,J=yB,V=AB;let z=null,ue=0,me=0,Te=0,Be=null;for(let Bt=0,Ft=O.length;Bt!==Ft&&H===!1;Bt++){const _n=pB;_n.copy(O[Bt]);const mn=_n.length();_n.normalize();const qn=TE.dot(_n);if(qn<mn+N&&qn>0){const Rn=fB,En=mB;Rn.copy(O[(Bt+1)%3]),En.copy(O[(Bt+2)%3]);const ai=Rn.length(),ri=En.length();Rn.normalize(),En.normalize();const Ei=TE.dot(Rn),ki=TE.dot(En);if(Ei<ai&&Ei>-ai&&ki<ri&&ki>-ri){const Xi=Math.abs(qn-mn-N);if((Be===null||Xi<Be)&&(Be=Xi,me=Ei,Te=ki,z=mn,q.copy(_n),J.copy(Rn),V.copy(En),ue++,S))return!0}}}if(ue){H=!0;const Bt=this.createContactEquation(f,m,e,t,y,w);q.scale(-N,Bt.ri),Bt.ni.copy(q),Bt.ni.negate(Bt.ni),q.scale(z,q),J.scale(me,J),q.vadd(J,q),V.scale(Te,V),q.vadd(V,Bt.rj),Bt.ri.vadd(n,Bt.ri),Bt.ri.vsub(f.position,Bt.ri),Bt.rj.vadd(i,Bt.rj),Bt.rj.vsub(m.position,Bt.rj),this.result.push(Bt),this.createFrictionEquationsFromContact(Bt,this.frictionResult)}let He=C.get();const tt=_B;for(let Bt=0;Bt!==2&&!H;Bt++)for(let Ft=0;Ft!==2&&!H;Ft++)for(let _n=0;_n!==2&&!H;_n++)if(He.set(0,0,0),Bt?He.vadd(O[0],He):He.vsub(O[0],He),Ft?He.vadd(O[1],He):He.vsub(O[1],He),_n?He.vadd(O[2],He):He.vsub(O[2],He),i.vadd(He,tt),tt.vsub(n,tt),tt.lengthSquared()<N*N){if(S)return!0;H=!0;const mn=this.createContactEquation(f,m,e,t,y,w);mn.ri.copy(tt),mn.ri.normalize(),mn.ni.copy(mn.ri),mn.ri.scale(N,mn.ri),mn.rj.copy(He),mn.ri.vadd(n,mn.ri),mn.ri.vsub(f.position,mn.ri),mn.rj.vadd(i,mn.rj),mn.rj.vsub(m.position,mn.rj),this.result.push(mn),this.createFrictionEquationsFromContact(mn,this.frictionResult)}C.release(He),He=null;const lt=C.get(),at=C.get(),St=C.get(),mt=C.get(),gt=C.get(),Ot=O.length;for(let Bt=0;Bt!==Ot&&!H;Bt++)for(let Ft=0;Ft!==Ot&&!H;Ft++)if(Bt%3!=Ft%3){O[Ft].cross(O[Bt],lt),lt.normalize(),O[Bt].vadd(O[Ft],at),St.copy(n),St.vsub(at,St),St.vsub(i,St);const _n=St.dot(lt);lt.scale(_n,mt);let mn=0;for(;mn===Bt%3||mn===Ft%3;)mn++;gt.copy(n),gt.vsub(mt,gt),gt.vsub(at,gt),gt.vsub(i,gt);const qn=Math.abs(_n),Rn=gt.length();if(qn<O[mn].length()&&Rn<N){if(S)return!0;H=!0;const En=this.createContactEquation(f,m,e,t,y,w);at.vadd(mt,En.rj),En.rj.copy(En.rj),gt.negate(En.ni),En.ni.normalize(),En.ri.copy(En.rj),En.ri.vadd(i,En.ri),En.ri.vsub(n,En.ri),En.ri.normalize(),En.ri.scale(N,En.ri),En.ri.vadd(n,En.ri),En.ri.vsub(f.position,En.ri),En.rj.vadd(i,En.rj),En.rj.vsub(m.position,En.rj),this.result.push(En),this.createFrictionEquationsFromContact(En,this.frictionResult)}}C.release(lt,at,St,mt,gt)}planeBox(e,t,n,i,o,c,f,m,y,w,S){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,o,c,f,m,e,t,S)}convexConvex(e,t,n,i,o,c,f,m,y,w,S,C,O){const N=LB;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,o,i,c,N,C,O)){const H=[],q=NB;e.clipAgainstHull(n,o,t,i,c,N,-100,100,H);let J=0;for(let V=0;V!==H.length;V++){if(S)return!0;const z=this.createContactEquation(f,m,e,t,y,w),ue=z.ri,me=z.rj;N.negate(z.ni),H[V].normal.negate(q),q.scale(H[V].depth,q),H[V].point.vadd(q,ue),me.copy(H[V].point),ue.vsub(n,ue),me.vsub(i,me),ue.vadd(n,ue),ue.vsub(f.position,ue),me.vadd(i,me),me.vsub(m.position,me),this.result.push(z),J++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(z,this.frictionResult)}this.enableFrictionReduction&&J&&this.createFrictionFromAverage(J)}}sphereConvex(e,t,n,i,o,c,f,m,y,w,S){const C=this.v3pool;n.vsub(i,bB);const O=t.faceNormals,N=t.faces,H=t.vertices,q=e.radius;let J=!1;for(let V=0;V!==H.length;V++){const z=H[V],ue=SB;c.vmult(z,ue),i.vadd(ue,ue);const me=EB;if(ue.vsub(n,me),me.lengthSquared()<q*q){if(S)return!0;J=!0;const Te=this.createContactEquation(f,m,e,t,y,w);return Te.ri.copy(me),Te.ri.normalize(),Te.ni.copy(Te.ri),Te.ri.scale(q,Te.ri),ue.vsub(i,Te.rj),Te.ri.vadd(n,Te.ri),Te.ri.vsub(f.position,Te.ri),Te.rj.vadd(i,Te.rj),Te.rj.vsub(m.position,Te.rj),this.result.push(Te),void this.createFrictionEquationsFromContact(Te,this.frictionResult)}}for(let V=0,z=N.length;V!==z&&J===!1;V++){const ue=O[V],me=N[V],Te=MB;c.vmult(ue,Te);const Be=TB;c.vmult(H[me[0]],Be),Be.vadd(i,Be);const He=CB;Te.scale(-q,He),n.vadd(He,He);const tt=RB;He.vsub(Be,tt);const lt=tt.dot(Te),at=IB;if(n.vsub(Be,at),lt<0&&at.dot(Te)>0){const St=[];for(let mt=0,gt=me.length;mt!==gt;mt++){const Ot=C.get();c.vmult(H[me[mt]],Ot),i.vadd(Ot,Ot),St.push(Ot)}if(dB(St,Te,n)){if(S)return!0;J=!0;const mt=this.createContactEquation(f,m,e,t,y,w);Te.scale(-q,mt.ri),Te.negate(mt.ni);const gt=C.get();Te.scale(-lt,gt);const Ot=C.get();Te.scale(-q,Ot),n.vsub(i,mt.rj),mt.rj.vadd(Ot,mt.rj),mt.rj.vadd(gt,mt.rj),mt.rj.vadd(i,mt.rj),mt.rj.vsub(m.position,mt.rj),mt.ri.vadd(n,mt.ri),mt.ri.vsub(f.position,mt.ri),C.release(gt),C.release(Ot),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult);for(let Bt=0,Ft=St.length;Bt!==Ft;Bt++)C.release(St[Bt]);return}for(let mt=0;mt!==me.length;mt++){const gt=C.get(),Ot=C.get();c.vmult(H[me[(mt+1)%me.length]],gt),c.vmult(H[me[(mt+2)%me.length]],Ot),i.vadd(gt,gt),i.vadd(Ot,Ot);const Bt=xB;Ot.vsub(gt,Bt);const Ft=wB;Bt.unit(Ft);const _n=C.get(),mn=C.get();n.vsub(gt,mn);const qn=mn.dot(Ft);Ft.scale(qn,_n),_n.vadd(gt,_n);const Rn=C.get();if(_n.vsub(n,Rn),qn>0&&qn*qn<Bt.lengthSquared()&&Rn.lengthSquared()<q*q){if(S)return!0;const En=this.createContactEquation(f,m,e,t,y,w);_n.vsub(i,En.rj),_n.vsub(n,En.ni),En.ni.normalize(),En.ni.scale(q,En.ri),En.rj.vadd(i,En.rj),En.rj.vsub(m.position,En.rj),En.ri.vadd(n,En.ri),En.ri.vsub(f.position,En.ri),this.result.push(En),this.createFrictionEquationsFromContact(En,this.frictionResult);for(let ai=0,ri=St.length;ai!==ri;ai++)C.release(St[ai]);return C.release(gt),C.release(Ot),C.release(_n),C.release(Rn),void C.release(mn)}C.release(gt),C.release(Ot),C.release(_n),C.release(Rn),C.release(mn)}for(let mt=0,gt=St.length;mt!==gt;mt++)C.release(St[mt])}}}planeConvex(e,t,n,i,o,c,f,m,y,w,S){const C=PB,O=DB;O.set(0,0,1),o.vmult(O,O);let N=0;const H=OB;for(let q=0;q!==t.vertices.length;q++)if(C.copy(t.vertices[q]),c.vmult(C,C),i.vadd(C,C),C.vsub(n,H),O.dot(H)<=0){if(S)return!0;const J=this.createContactEquation(f,m,e,t,y,w),V=BB;O.scale(O.dot(H),V),C.vsub(V,V),V.vsub(n,J.ri),J.ni.copy(O),C.vsub(i,J.rj),J.ri.vadd(n,J.ri),J.ri.vsub(f.position,J.ri),J.rj.vadd(i,J.rj),J.rj.vsub(m.position,J.rj),this.result.push(J),N++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(J,this.frictionResult)}this.enableFrictionReduction&&N&&this.createFrictionFromAverage(N)}boxConvex(e,t,n,i,o,c,f,m,y,w,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,o,c,f,m,e,t,S)}sphereHeightfield(e,t,n,i,o,c,f,m,y,w,S){const C=t.data,O=e.radius,N=t.elementSize,H=XB,q=qB;Ys.pointToLocalFrame(i,c,n,q);let J=Math.floor((q.x-O)/N)-1,V=Math.ceil((q.x+O)/N)+1,z=Math.floor((q.y-O)/N)-1,ue=Math.ceil((q.y+O)/N)+1;if(V<0||ue<0||J>C.length||z>C[0].length)return;J<0&&(J=0),V<0&&(V=0),z<0&&(z=0),ue<0&&(ue=0),J>=C.length&&(J=C.length-1),V>=C.length&&(V=C.length-1),ue>=C[0].length&&(ue=C[0].length-1),z>=C[0].length&&(z=C[0].length-1);const me=[];t.getRectMinMax(J,z,V,ue,me);const Te=me[0],Be=me[1];if(q.z-O>Be||q.z+O<Te)return;const He=this.result;for(let tt=J;tt<V;tt++)for(let lt=z;lt<ue;lt++){const at=He.length;let St=!1;if(t.getConvexTrianglePillar(tt,lt,!1),Ys.pointToWorldFrame(i,c,t.pillarOffset,H),n.distanceTo(H)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(St=this.sphereConvex(e,t.pillarConvex,n,H,o,c,f,m,e,t,S)),S&&St||(t.getConvexTrianglePillar(tt,lt,!0),Ys.pointToWorldFrame(i,c,t.pillarOffset,H),n.distanceTo(H)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(St=this.sphereConvex(e,t.pillarConvex,n,H,o,c,f,m,e,t,S)),S&&St))return!0;if(He.length-at>2)return}}boxHeightfield(e,t,n,i,o,c,f,m,y,w,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,o,c,f,m,e,t,S)}convexHeightfield(e,t,n,i,o,c,f,m,y,w,S){const C=t.data,O=t.elementSize,N=e.boundingSphereRadius,H=WB,q=QB,J=HB;Ys.pointToLocalFrame(i,c,n,J);let V=Math.floor((J.x-N)/O)-1,z=Math.ceil((J.x+N)/O)+1,ue=Math.floor((J.y-N)/O)-1,me=Math.ceil((J.y+N)/O)+1;if(z<0||me<0||V>C.length||ue>C[0].length)return;V<0&&(V=0),z<0&&(z=0),ue<0&&(ue=0),me<0&&(me=0),V>=C.length&&(V=C.length-1),z>=C.length&&(z=C.length-1),me>=C[0].length&&(me=C[0].length-1),ue>=C[0].length&&(ue=C[0].length-1);const Te=[];t.getRectMinMax(V,ue,z,me,Te);const Be=Te[0],He=Te[1];if(!(J.z-N>He||J.z+N<Be))for(let tt=V;tt<z;tt++)for(let lt=ue;lt<me;lt++){let at=!1;if(t.getConvexTrianglePillar(tt,lt,!1),Ys.pointToWorldFrame(i,c,t.pillarOffset,H),n.distanceTo(H)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(at=this.convexConvex(e,t.pillarConvex,n,H,o,c,f,m,null,null,S,q,null)),S&&at||(t.getConvexTrianglePillar(tt,lt,!0),Ys.pointToWorldFrame(i,c,t.pillarOffset,H),n.distanceTo(H)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(at=this.convexConvex(e,t.pillarConvex,n,H,o,c,f,m,null,null,S,q,null)),S&&at))return!0}}sphereParticle(e,t,n,i,o,c,f,m,y,w,S){const C=zB;if(C.set(0,0,1),i.vsub(n,C),C.lengthSquared()<=e.radius*e.radius){if(S)return!0;const O=this.createContactEquation(m,f,t,e,y,w);C.normalize(),O.rj.copy(C),O.rj.scale(e.radius,O.rj),O.ni.copy(C),O.ni.negate(O.ni),O.ri.set(0,0,0),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}planeParticle(e,t,n,i,o,c,f,m,y,w,S){const C=kB;C.set(0,0,1),f.quaternion.vmult(C,C);const O=UB;if(i.vsub(f.position,O),C.dot(O)<=0){if(S)return!0;const N=this.createContactEquation(m,f,t,e,y,w);N.ni.copy(C),N.ni.negate(N.ni),N.ri.set(0,0,0);const H=FB;C.scale(C.dot(i),H),i.vsub(H,H),N.rj.copy(H),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}boxParticle(e,t,n,i,o,c,f,m,y,w,S){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,o,c,f,m,e,t,S)}convexParticle(e,t,n,i,o,c,f,m,y,w,S){let C=-1;const O=VB,N=GB;let H=null;const q=jB;if(q.copy(i),q.vsub(n,q),o.conjugate(BR),BR.vmult(q,q),e.pointIsInside(q)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(let J=0,V=e.faces.length;J!==V;J++){const z=[e.worldVertices[e.faces[J][0]]],ue=e.worldFaceNormals[J];i.vsub(z[0],LR);const me=-ue.dot(LR);if(H===null||Math.abs(me)<Math.abs(H)){if(S)return!0;H=me,C=J,O.copy(ue)}}if(C!==-1){const J=this.createContactEquation(m,f,t,e,y,w);O.scale(H,N),N.vadd(i,N),N.vsub(n,N),J.rj.copy(N),O.negate(J.ni),J.ri.set(0,0,0);const V=J.ri,z=J.rj;V.vadd(i,V),V.vsub(m.position,V),z.vadd(n,z),z.vsub(f.position,z),this.result.push(J),this.createFrictionEquationsFromContact(J,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,n,i,o,c,f,m,y,w,S){return this.convexHeightfield(t,e,i,n,c,o,m,f,y,w,S)}particleCylinder(e,t,n,i,o,c,f,m,y,w,S){return this.convexParticle(t,e,i,n,c,o,m,f,y,w,S)}sphereTrimesh(e,t,n,i,o,c,f,m,y,w,S){const C=JO,O=ZO,N=eB,H=tB,q=nB,J=iB,V=aB,z=$O,ue=YO,me=lB;Ys.pointToLocalFrame(i,c,n,q);const Te=e.radius;V.lowerBound.set(q.x-Te,q.y-Te,q.z-Te),V.upperBound.set(q.x+Te,q.y+Te,q.z+Te),t.getTrianglesInAABB(V,me);const Be=KO,He=e.radius*e.radius;for(let mt=0;mt<me.length;mt++)for(let gt=0;gt<3;gt++)if(t.getVertex(t.indices[3*me[mt]+gt],Be),Be.vsub(q,ue),ue.lengthSquared()<=He){if(z.copy(Be),Ys.pointToWorldFrame(i,c,z,Be),Be.vsub(n,ue),S)return!0;let Ot=this.createContactEquation(f,m,e,t,y,w);Ot.ni.copy(ue),Ot.ni.normalize(),Ot.ri.copy(Ot.ni),Ot.ri.scale(e.radius,Ot.ri),Ot.ri.vadd(n,Ot.ri),Ot.ri.vsub(f.position,Ot.ri),Ot.rj.copy(Be),Ot.rj.vsub(m.position,Ot.rj),this.result.push(Ot),this.createFrictionEquationsFromContact(Ot,this.frictionResult)}for(let mt=0;mt<me.length;mt++)for(let gt=0;gt<3;gt++){t.getVertex(t.indices[3*me[mt]+gt],C),t.getVertex(t.indices[3*me[mt]+(gt+1)%3],O),O.vsub(C,N),q.vsub(O,J);const Ot=J.dot(N);q.vsub(C,J);let Bt=J.dot(N);if(Bt>0&&Ot<0&&(q.vsub(C,J),H.copy(N),H.normalize(),Bt=J.dot(H),H.scale(Bt,J),J.vadd(C,J),J.distanceTo(q)<e.radius)){if(S)return!0;const Ft=this.createContactEquation(f,m,e,t,y,w);J.vsub(q,Ft.ni),Ft.ni.normalize(),Ft.ni.scale(e.radius,Ft.ri),Ft.ri.vadd(n,Ft.ri),Ft.ri.vsub(f.position,Ft.ri),Ys.pointToWorldFrame(i,c,J,J),J.vsub(m.position,Ft.rj),Ys.vectorToWorldFrame(c,Ft.ni,Ft.ni),Ys.vectorToWorldFrame(c,Ft.ri,Ft.ri),this.result.push(Ft),this.createFrictionEquationsFromContact(Ft,this.frictionResult)}}const tt=rB,lt=sB,at=oB,St=XO;for(let mt=0,gt=me.length;mt!==gt;mt++){t.getTriangleVertices(me[mt],tt,lt,at),t.getNormal(me[mt],St),q.vsub(tt,J);let Ot=J.dot(St);if(St.scale(Ot,J),q.vsub(J,J),Ot=J.distanceTo(q),Gl.pointInTriangle(J,tt,lt,at)&&Ot<e.radius){if(S)return!0;let Bt=this.createContactEquation(f,m,e,t,y,w);J.vsub(q,Bt.ni),Bt.ni.normalize(),Bt.ni.scale(e.radius,Bt.ri),Bt.ri.vadd(n,Bt.ri),Bt.ri.vsub(f.position,Bt.ri),Ys.pointToWorldFrame(i,c,J,J),J.vsub(m.position,Bt.rj),Ys.vectorToWorldFrame(c,Bt.ni,Bt.ni),Ys.vectorToWorldFrame(c,Bt.ri,Bt.ri),this.result.push(Bt),this.createFrictionEquationsFromContact(Bt,this.frictionResult)}}me.length=0}planeTrimesh(e,t,n,i,o,c,f,m,y,w,S){const C=new rt,O=WO;O.set(0,0,1),o.vmult(O,O);for(let N=0;N<t.vertices.length/3;N++){t.getVertex(N,C);const H=new rt;H.copy(C),Ys.pointToWorldFrame(i,c,H,C);const q=QO;if(C.vsub(n,q),O.dot(q)<=0){if(S)return!0;const J=this.createContactEquation(f,m,e,t,y,w);J.ni.copy(O);const V=qO;O.scale(q.dot(O),V),C.vsub(V,V),J.ri.copy(V),J.ri.vsub(f.position,J.ri),J.rj.copy(C),J.rj.vsub(m.position,J.rj),this.result.push(J),this.createFrictionEquationsFromContact(J,this.frictionResult)}}}}const Wy=new rt,mb=new rt,gb=new rt,jO=new rt,VO=new rt,GO=new Fa,HO=new Fa,WO=new rt,QO=new rt,qO=new rt,XO=new rt,YO=new rt;new rt;const KO=new rt,$O=new rt,JO=new rt,ZO=new rt,eB=new rt,tB=new rt,nB=new rt,iB=new rt,rB=new rt,sB=new rt,oB=new rt,aB=new Sa,lB=[],ME=new rt,OR=new rt,cB=new rt,uB=new rt,hB=new rt;function dB(l,e,t){let n=null;const i=l.length;for(let o=0;o!==i;o++){const c=l[o],f=cB;l[(o+1)%i].vsub(c,f);const m=uB;f.cross(e,m);const y=hB;t.vsub(c,y);const w=m.dot(y);if(!(n===null||w>0&&n===!0||w<=0&&n===!1))return!1;n===null&&(n=w>0)}return!0}const TE=new rt,pB=new rt,fB=new rt,mB=new rt,gB=[new rt,new rt,new rt,new rt,new rt,new rt],_B=new rt,vB=new rt,yB=new rt,AB=new rt,bB=new rt,xB=new rt,wB=new rt,EB=new rt,SB=new rt,MB=new rt,TB=new rt,CB=new rt,RB=new rt,IB=new rt;new rt,new rt;const PB=new rt,DB=new rt,OB=new rt,BB=new rt,LB=new rt,NB=new rt,kB=new rt,UB=new rt,FB=new rt,zB=new rt,BR=new Fa,jB=new rt;new rt;const VB=new rt,LR=new rt,GB=new rt,HB=new rt,WB=new rt,QB=[0],qB=new rt,XB=new rt;class NR{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const n=t;t=e,e=n}return e<<16|t}set(e,t){const n=this.getKey(e,t),i=this.current;let o=0;for(;n>i[o];)o++;if(n!==i[o]){for(let c=i.length-1;c>=o;c--)i[c+1]=i[c];i[o]=n}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const n=this.current,i=this.previous,o=n.length,c=i.length;let f=0;for(let m=0;m<o;m++){let y=!1;const w=n[m];for(;w>i[f];)f++;y=w===i[f],y||kR(e,w)}f=0;for(let m=0;m<c;m++){let y=!1;const w=i[m];for(;w>n[f];)f++;y=n[f]===w,y||kR(t,w)}}}function kR(l,e){l.push((4294901760&e)>>16,65535&e)}const RS=(l,e)=>l<e?`${l}-${e}`:`${e}-${l}`;class YB{constructor(){this.data={keys:[]}}get(e,t){const n=RS(e,t);return this.data[n]}set(e,t,n){const i=RS(e,t);this.get(e,t)||this.data.keys.push(i),this.data[i]=n}delete(e,t){const n=RS(e,t),i=this.data.keys.indexOf(n);i!==-1&&this.data.keys.splice(i,1),delete this.data[n]}reset(){const e=this.data,t=e.keys;for(;t.length>0;)delete e[t.pop()]}}class KB extends lR{constructor(e){e===void 0&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new rt,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new E2,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new lO,this.constraints=[],this.narrowphase=new zO(this),this.collisionMatrix=new aR,this.collisionMatrixPrevious=new aR,this.bodyOverlapKeeper=new NR,this.shapeOverlapKeeper=new NR,this.contactmaterials=[],this.contactMaterialTable=new YB,this.defaultMaterial=new xE("default"),this.defaultContactMaterial=new bE(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);t!==-1&&this.constraints.splice(t,1)}rayTest(e,t,n){n instanceof mE?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)}raycastAll(e,t,n,i){return n===void 0&&(n={}),n.mode=Gl.ALL,n.from=e,n.to=t,n.callback=i,IS.intersectWorld(this,n)}raycastAny(e,t,n,i){return n===void 0&&(n={}),n.mode=Gl.ANY,n.from=e,n.to=t,n.result=i,IS.intersectWorld(this,n)}raycastClosest(e,t,n,i){return n===void 0&&(n={}),n.mode=Gl.CLOSEST,n.from=e,n.to=t,n.result=i,IS.intersectWorld(this,n)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof ar&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(i!==-1){n.splice(i,1);for(let o=0;o!==n.length;o++)n[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let n=0;n<t.length;n++){const i=t[n].shapes;for(let o=0;o<i.length;o++){const c=i[o];if(c.id===e)return c}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);t!==-1&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){e===void 0&&(e=1/60),t===void 0&&(t=10);const n=ac.now()/1e3;if(this.lastCallTime){const i=n-this.lastCallTime;this.step(e,i,t)}else this.step(e,void 0,t);this.lastCallTime=n}step(e,t,n){if(n===void 0&&(n=10),t===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const i=ac.now();let o=0;for(;this.accumulator>=e&&o<n&&(this.internalStep(e),this.accumulator-=e,o++,!(ac.now()-i>1e3*e)););this.accumulator=this.accumulator%e;const c=this.accumulator/e;for(let f=0;f!==this.bodies.length;f++){const m=this.bodies[f];m.previousPosition.lerp(m.position,c,m.interpolatedPosition),m.previousQuaternion.slerp(m.quaternion,c,m.interpolatedQuaternion),m.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,n=tL,i=nL,o=this.bodies.length,c=this.bodies,f=this.solver,m=this.gravity,y=this.doProfiling,w=this.profile,S=ar.DYNAMIC;let C=-1/0;const O=this.constraints,N=eL;m.length();const H=m.x,q=m.y,J=m.z;let V=0;for(y&&(C=ac.now()),V=0;V!==o;V++){const St=c[V];if(St.type===S){const mt=St.force,gt=St.mass;mt.x+=gt*H,mt.y+=gt*q,mt.z+=gt*J}}for(let St=0,mt=this.subsystems.length;St!==mt;St++)this.subsystems[St].update();y&&(C=ac.now()),n.length=0,i.length=0,this.broadphase.collisionPairs(this,n,i),y&&(w.broadphase=ac.now()-C);let z=O.length;for(V=0;V!==z;V++){const St=O[V];if(!St.collideConnected)for(let mt=n.length-1;mt>=0;mt-=1)(St.bodyA===n[mt]&&St.bodyB===i[mt]||St.bodyB===n[mt]&&St.bodyA===i[mt])&&(n.splice(mt,1),i.splice(mt,1))}this.collisionMatrixTick(),y&&(C=ac.now());const ue=ZB,me=t.length;for(V=0;V!==me;V++)ue.push(t[V]);t.length=0;const Te=this.frictionEquations.length;for(V=0;V!==Te;V++)N.push(this.frictionEquations[V]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,i,this,t,ue,this.frictionEquations,N),y&&(w.narrowphase=ac.now()-C),y&&(C=ac.now()),V=0;V<this.frictionEquations.length;V++)f.addEquation(this.frictionEquations[V]);const Be=t.length;for(let St=0;St!==Be;St++){const mt=t[St],gt=mt.bi,Ot=mt.bj,Bt=mt.si,Ft=mt.sj;let _n;_n=gt.material&&Ot.material&&this.getContactMaterial(gt.material,Ot.material)||this.defaultContactMaterial,_n.friction,gt.material&&Ot.material&&(gt.material.friction>=0&&Ot.material.friction>=0&&(gt.material.friction,Ot.material.friction),gt.material.restitution>=0&&Ot.material.restitution>=0&&(mt.restitution=gt.material.restitution*Ot.material.restitution)),f.addEquation(mt),gt.allowSleep&&gt.type===ar.DYNAMIC&&gt.sleepState===ar.SLEEPING&&Ot.sleepState===ar.AWAKE&&Ot.type!==ar.STATIC&&Ot.velocity.lengthSquared()+Ot.angularVelocity.lengthSquared()>=2*Ot.sleepSpeedLimit**2&&(gt.wakeUpAfterNarrowphase=!0),Ot.allowSleep&&Ot.type===ar.DYNAMIC&&Ot.sleepState===ar.SLEEPING&&gt.sleepState===ar.AWAKE&&gt.type!==ar.STATIC&&gt.velocity.lengthSquared()+gt.angularVelocity.lengthSquared()>=2*gt.sleepSpeedLimit**2&&(Ot.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(gt,Ot,!0),this.collisionMatrixPrevious.get(gt,Ot)||(Ex.body=Ot,Ex.contact=mt,gt.dispatchEvent(Ex),Ex.body=gt,Ot.dispatchEvent(Ex)),this.bodyOverlapKeeper.set(gt.id,Ot.id),this.shapeOverlapKeeper.set(Bt.id,Ft.id)}for(this.emitContactEvents(),y&&(w.makeContactConstraints=ac.now()-C,C=ac.now()),V=0;V!==o;V++){const St=c[V];St.wakeUpAfterNarrowphase&&(St.wakeUp(),St.wakeUpAfterNarrowphase=!1)}for(z=O.length,V=0;V!==z;V++){const St=O[V];St.update();for(let mt=0,gt=St.equations.length;mt!==gt;mt++){const Ot=St.equations[mt];f.addEquation(Ot)}}f.solve(e,this),y&&(w.solve=ac.now()-C),f.removeAllEquations();const He=Math.pow;for(V=0;V!==o;V++){const St=c[V];if(St.type&S){const mt=He(1-St.linearDamping,e),gt=St.velocity;gt.scale(mt,gt);const Ot=St.angularVelocity;if(Ot){const Bt=He(1-St.angularDamping,e);Ot.scale(Bt,Ot)}}}this.dispatchEvent(JB),y&&(C=ac.now());const tt=this.stepnumber%(this.quatNormalizeSkip+1)==0,lt=this.quatNormalizeFast;for(V=0;V!==o;V++)c[V].integrate(e,tt,lt);this.clearForces(),this.broadphase.dirty=!0,y&&(w.integrate=ac.now()-C),this.stepnumber+=1,this.dispatchEvent($B);let at=!0;if(this.allowSleep)for(at=!1,V=0;V!==o;V++){const St=c[V];St.sleepTick(this.time),St.sleepState!==ar.SLEEPING&&(at=!0)}this.hasActiveBodies=at}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Y_,K_),e){for(let o=0,c=Y_.length;o<c;o+=2)Sx.bodyA=this.getBodyById(Y_[o]),Sx.bodyB=this.getBodyById(Y_[o+1]),this.dispatchEvent(Sx);Sx.bodyA=Sx.bodyB=null}if(t){for(let o=0,c=K_.length;o<c;o+=2)Mx.bodyA=this.getBodyById(K_[o]),Mx.bodyB=this.getBodyById(K_[o+1]),this.dispatchEvent(Mx);Mx.bodyA=Mx.bodyB=null}Y_.length=K_.length=0;const n=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((n||i)&&this.shapeOverlapKeeper.getDiff(Y_,K_),n){for(let o=0,c=Y_.length;o<c;o+=2){const f=this.getShapeById(Y_[o]),m=this.getShapeById(Y_[o+1]);$_.shapeA=f,$_.shapeB=m,f&&($_.bodyA=f.body),m&&($_.bodyB=m.body),this.dispatchEvent($_)}$_.bodyA=$_.bodyB=$_.shapeA=$_.shapeB=null}if(i){for(let o=0,c=K_.length;o<c;o+=2){const f=this.getShapeById(K_[o]),m=this.getShapeById(K_[o+1]);J_.shapeA=f,J_.shapeB=m,f&&(J_.bodyA=f.body),m&&(J_.bodyB=m.body),this.dispatchEvent(J_)}J_.bodyA=J_.bodyB=J_.shapeA=J_.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let n=0;n!==t;n++){const i=e[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new Sa;const IS=new Gl,ac=globalThis.performance||{};if(!ac.now){let l=Date.now();ac.timing&&ac.timing.navigationStart&&(l=ac.timing.navigationStart),ac.now=()=>Date.now()-l}new rt;const $B={type:"postStep"},JB={type:"preStep"},Ex={type:ar.COLLIDE_EVENT_NAME,body:null,contact:null},ZB=[],eL=[],tL=[],nL=[],Y_=[],K_=[],Sx={type:"beginContact",bodyA:null,bodyB:null},Mx={type:"endContact",bodyA:null,bodyB:null},$_={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},J_={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var iL=function(){var l,e,t,n,i=0,o=new s.Pa4;function c(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new w,this.unassigned=new w,this.vertices=[]}function f(){this.normal=new s.Pa4,this.midpoint=new s.Pa4,this.area=0,this.constant=0,this.outside=null,this.mark=i,this.edge=null}function m(S,C){this.vertex=S,this.prev=null,this.next=null,this.twin=null,this.face=C}function y(S,C){this.point=S,this.index=C,this.prev=null,this.next=null,this.face=null}function w(){this.head=null,this.tail=null}return Object.assign(c.prototype,{toJSON:function(){const S=this.faces.map(q=>q.toArray()),C=Array.from(new Set(S.flat())).sort(),O=[];for(let q=0;q<C.length;q++)O.push(this.vertices[C[q]].point.x,this.vertices[C[q]].point.y,this.vertices[C[q]].point.z);const N=new Map;for(let q=0;q<C.length;q++)N.set(C[q],q);const H=[];for(let q=0;q<S.length;q++)H.push([N.get(S[q][0]),N.get(S[q][1]),N.get(S[q][2])]);return[O,H]},setFromPoints:function(S){Array.isArray(S)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),S.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var C=0,O=S.length;C<O;C++)this.vertices.push(new y(S[C],C));return this.compute(),this},setFromObject:function(S){var C=[];return S.updateMatrixWorld(!0),S.traverse(function(O){var N,H,q,J=O.geometry;if(J!==void 0&&(J.isGeometry&&(J=J.toBufferGeometry?J.toBufferGeometry():new BufferGeometry().fromGeometry(J)),J.isBufferGeometry)){var V=J.attributes.position;if(V!==void 0)for(N=0,H=V.count;N<H;N++)(q=new s.Pa4).fromBufferAttribute(V,N).applyMatrix4(O.matrixWorld),C.push(q)}}),this.setFromPoints(C)},containsPoint:function(S){for(var C=this.faces,O=0,N=C.length;O<N;O++)if(C[O].distanceToPoint(S)>this.tolerance)return!1;return!0},intersectRay:function(S,C){for(var O=this.faces,N=-1/0,H=1/0,q=0,J=O.length;q<J;q++){var V=O[q],z=V.distanceToPoint(S.origin),ue=V.normal.dot(S.direction);if(z>0&&ue>=0)return null;var me=ue!==0?-z/ue:0;if(!(me<=0)&&(ue>0?H=Math.min(me,H):N=Math.max(me,N),N>H))return null}return N!==-1/0?S.at(N,C):S.at(H,C),C},intersectsRay:function(S){return this.intersectRay(S,o)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(S,C){return S.face=C,C.outside===null?this.assigned.append(S):this.assigned.insertBefore(C.outside,S),C.outside=S,this},removeVertexFromFace:function(S,C){return S===C.outside&&(S.next!==null&&S.next.face===C?C.outside=S.next:C.outside=null),this.assigned.remove(S),this},removeAllVerticesFromFace:function(S){if(S.outside!==null){for(var C=S.outside,O=S.outside;O.next!==null&&O.next.face===S;)O=O.next;return this.assigned.removeSubList(C,O),C.prev=O.next=null,S.outside=null,C}},deleteFaceVertices:function(S,C){var O=this.removeAllVerticesFromFace(S);if(O!==void 0)if(C===void 0)this.unassigned.appendChain(O);else{var N=O;do{var H=N.next;C.distanceToPoint(N.point)>this.tolerance?this.addVertexToFace(N,C):this.unassigned.append(N),N=H}while(N!==null)}return this},resolveUnassignedPoints:function(S){if(this.unassigned.isEmpty()===!1){var C=this.unassigned.first();do{for(var O=C.next,N=this.tolerance,H=null,q=0;q<S.length;q++){var J=S[q];if(J.mark===i){var V=J.distanceToPoint(C.point);if(V>N&&(N=V,H=J),N>1e3*this.tolerance)break}}H!==null&&this.addVertexToFace(C,H),C=O}while(C!==null)}return this},computeExtremes:function(){var S,C,O,N=new s.Pa4,H=new s.Pa4,q=[],J=[];for(S=0;S<3;S++)q[S]=J[S]=this.vertices[0];for(N.copy(this.vertices[0].point),H.copy(this.vertices[0].point),S=0,C=this.vertices.length;S<C;S++){var V=this.vertices[S],z=V.point;for(O=0;O<3;O++)z.getComponent(O)<N.getComponent(O)&&(N.setComponent(O,z.getComponent(O)),q[O]=V);for(O=0;O<3;O++)z.getComponent(O)>H.getComponent(O)&&(H.setComponent(O,z.getComponent(O)),J[O]=V)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(N.x),Math.abs(H.x))+Math.max(Math.abs(N.y),Math.abs(H.y))+Math.max(Math.abs(N.z),Math.abs(H.z))),{min:q,max:J}},computeInitialHull:function(){l===void 0&&(l=new s.Zzh,e=new s.JOQ,t=new s.Pa4);var S,C,O,N,H,q,J,V,z,ue=this.vertices,me=this.computeExtremes(),Te=me.min,Be=me.max,He=0,tt=0;for(q=0;q<3;q++)(z=Be[q].point.getComponent(q)-Te[q].point.getComponent(q))>He&&(He=z,tt=q);for(C=Te[tt],O=Be[tt],He=0,l.set(C.point,O.point),q=0,J=this.vertices.length;q<J;q++)(S=ue[q])!==C&&S!==O&&(l.closestPointToPoint(S.point,!0,t),(z=t.distanceToSquared(S.point))>He&&(He=z,N=S));for(He=-1,e.setFromCoplanarPoints(C.point,O.point,N.point),q=0,J=this.vertices.length;q<J;q++)(S=ue[q])!==C&&S!==O&&S!==N&&(z=Math.abs(e.distanceToPoint(S.point)))>He&&(He=z,H=S);var lt=[];if(e.distanceToPoint(H.point)<0)for(lt.push(f.create(C,O,N),f.create(H,O,C),f.create(H,N,O),f.create(H,C,N)),q=0;q<3;q++)V=(q+1)%3,lt[q+1].getEdge(2).setTwin(lt[0].getEdge(V)),lt[q+1].getEdge(1).setTwin(lt[V+1].getEdge(0));else for(lt.push(f.create(C,N,O),f.create(H,C,O),f.create(H,O,N),f.create(H,N,C)),q=0;q<3;q++)V=(q+1)%3,lt[q+1].getEdge(2).setTwin(lt[0].getEdge((3-q)%3)),lt[q+1].getEdge(0).setTwin(lt[V+1].getEdge(1));for(q=0;q<4;q++)this.faces.push(lt[q]);for(q=0,J=ue.length;q<J;q++)if((S=ue[q])!==C&&S!==O&&S!==N&&S!==H){He=this.tolerance;var at=null;for(V=0;V<4;V++)(z=this.faces[V].distanceToPoint(S.point))>He&&(He=z,at=this.faces[V]);at!==null&&this.addVertexToFace(S,at)}return this},reindexFaces:function(){for(var S=[],C=0;C<this.faces.length;C++){var O=this.faces[C];O.mark===i&&S.push(O)}return this.faces=S,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var S,C=0,O=this.assigned.first().face,N=O.outside;do{var H=O.distanceToPoint(N.point);H>C&&(C=H,S=N),N=N.next}while(N!==null&&N.face===O);return S}},computeHorizon:function(S,C,O,N){var H;this.deleteFaceVertices(O),O.mark=1,H=C===null?C=O.getEdge(0):C.next;do{var q=H.twin,J=q.face;J.mark===i&&(J.distanceToPoint(S)>this.tolerance?this.computeHorizon(S,q,J,N):N.push(H)),H=H.next}while(H!==C);return this},addAdjoiningFace:function(S,C){var O=f.create(S,C.tail(),C.head());return this.faces.push(O),O.getEdge(-1).setTwin(C.twin),O.getEdge(0)},addNewFaces:function(S,C){this.newFaces=[];for(var O=null,N=null,H=0;H<C.length;H++){var q=C[H],J=this.addAdjoiningFace(S,q);O===null?O=J:J.next.setTwin(N),this.newFaces.push(J.face),N=J}return O.next.setTwin(N),this},addVertexToHull:function(S){var C=[];return this.unassigned.clear(),this.removeVertexFromFace(S,S.face),this.computeHorizon(S.point,null,S.face,C),this.addNewFaces(S,C),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var S;for(this.computeInitialHull();(S=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(S);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(f,{create:function(S,C,O){var N=new f,H=new m(S,N),q=new m(C,N),J=new m(O,N);return H.next=J.prev=q,q.next=H.prev=J,J.next=q.prev=H,N.edge=H,N.compute()}}),Object.assign(f.prototype,{toArray:function(){const S=[];let C=this.edge;do S.push(C.head().index),C=C.next;while(C!==this.edge);return S},getEdge:function(S){for(var C=this.edge;S>0;)C=C.next,S--;for(;S<0;)C=C.prev,S++;return C},compute:function(){n===void 0&&(n=new s.CJI);var S=this.edge.tail(),C=this.edge.head(),O=this.edge.next.head();return n.set(S.point,C.point,O.point),n.getNormal(this.normal),n.getMidpoint(this.midpoint),this.area=n.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(S){return this.normal.dot(S)-this.constant}}),Object.assign(m.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var S=this.head(),C=this.tail();return C!==null?C.point.distanceTo(S.point):-1},lengthSquared:function(){var S=this.head(),C=this.tail();return C!==null?C.point.distanceToSquared(S.point):-1},setTwin:function(S){return this.twin=S,S.twin=this,this}}),Object.assign(w.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(S,C){return C.prev=S.prev,C.next=S,C.prev===null?this.head=C:C.prev.next=C,S.prev=C,this},insertAfter:function(S,C){return C.prev=S,C.next=S.next,C.next===null?this.tail=C:C.next.prev=C,S.next=C,this},append:function(S){return this.head===null?this.head=S:this.tail.next=S,S.prev=this.tail,S.next=null,this.tail=S,this},appendChain:function(S){for(this.head===null?this.head=S:this.tail.next=S,S.prev=this.tail;S.next!==null;)S=S.next;return this.tail=S,this},remove:function(S){return S.prev===null?this.head=S.next:S.prev.next=S.next,S.next===null?this.tail=S.prev:S.next.prev=S.prev,this},removeSubList:function(S,C){return S.prev===null?this.head=C.next:S.prev.next=C.next,C.next===null?this.tail=S.prev:C.next.prev=S.prev,this},isEmpty:function(){return this.head===null}}),c}();const rL=new s.Pa4,CE=new s.Pa4,sL=new s._fP;function RE(l){const e=function(i){const o=[];return i.traverse(function(c){c.isMesh&&o.push(c)}),o}(l);if(e.length===0)return null;if(e.length===1)return UR(e[0]);let t;const n=[];for(;t=e.pop();)n.push(oL(UR(t)));return function(i){let o=0;for(let m=0;m<i.length;m++){const y=i[m].attributes.position;y&&y.itemSize===3&&(o+=y.count)}const c=new Float32Array(3*o);let f=0;for(let m=0;m<i.length;m++){const y=i[m].attributes.position;if(y&&y.itemSize===3)for(let w=0;w<y.count;w++)c[f++]=y.getX(w),c[f++]=y.getY(w),c[f++]=y.getZ(w)}return new s.u9r().setAttribute("position",new s.TlE(c,3))}(n)}function UR(l){let e=l.geometry;return e=e.toBufferGeometry?e.toBufferGeometry():e.clone(),l.updateMatrixWorld(),l.matrixWorld.decompose(rL,sL,CE),e.scale(CE.x,CE.y,CE.z),e}function FR(l){const e=l.attributes.position,t=new Float32Array(3*e.count);for(let n=0;n<e.count;n++)t[3*n]=e.getX(n),t[3*n+1]=e.getY(n),t[3*n+2]=e.getZ(n);return t}function IE(l,e){switch(e){case"x":return l.x;case"y":return l.y;case"z":return l.z}throw new Error(`Unexpected component ${e}`)}function oL(l,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=l.getIndex(),i=l.getAttribute("position"),o=n?n.count:i.count;let c=0;const f=[],m=[],y=Math.log10(1/e),w=Math.pow(10,y);for(let O=0;O<o;O++){const N=n?n.getX(O):O;let H="";H+=~~(i.getX(N)*w)+",",H+=~~(i.getY(N)*w)+",",H+=~~(i.getZ(N)*w)+",",H in t?f.push(t[H]):(m.push(i.getX(N)),m.push(i.getY(N)),m.push(i.getZ(N)),t[H]=c,f.push(c),c++)}const S=new s.TlE(new Float32Array(m),i.itemSize,i.normalized),C=new s.u9r;return C.setAttribute("position",S),C.setIndex(f),C}const zR=Math.PI/2;var il;(function(l){l.BOX="Box",l.CYLINDER="Cylinder",l.SPHERE="Sphere",l.HULL="ConvexPolyhedron",l.MESH="Trimesh"})(il||(il={}));const aL=function(l,e={}){const t=function(m,y={}){let w;if(y.type===il.BOX)return VR(m);if(y.type===il.CYLINDER)return function(S,C){const O=["x","y","z"],N=C.cylinderAxis||"y",H=O.splice(O.indexOf(N),1)&&O,q=new s.ZzF().setFromObject(S);if(!isFinite(q.min.lengthSq()))return null;const J=q.max[N]-q.min[N],V=.5*Math.max(IE(q.max,H[0])-IE(q.min,H[0]),IE(q.max,H[1])-IE(q.min,H[1])),z=N==="y"?zR:0,ue=N==="z"?zR:0;return{type:il.CYLINDER,params:{radiusTop:V,radiusBottom:V,height:J,segments:12},orientation:new Fa().setFromEuler(z,ue,0,"XYZ").normalize()}}(m,y);if(y.type===il.SPHERE)return function(S,C){if(C.sphereRadius)return{type:il.SPHERE,params:{radius:C.sphereRadius}};const O=RE(S);return O?(O.computeBoundingSphere(),{type:il.SPHERE,params:{radius:O.boundingSphere.radius}}):null}(m,y);if(y.type===il.HULL)return function(S){const C=RE(S);if(!C)return null;const O=1e-4;for(let q=0;q<C.attributes.position.count;q++)C.attributes.position.setXYZ(q,C.attributes.position.getX(q)+(Math.random()-.5)*O,C.attributes.position.getY(q)+(Math.random()-.5)*O,C.attributes.position.getZ(q)+(Math.random()-.5)*O);const[N,H]=new iL().setFromObject(new s.Kj0(C)).toJSON();return{type:il.HULL,params:{vertices:new Float32Array(N),faces:H}}}(m);if(y.type===il.MESH)return w=RE(m),w?function(S){const C=FR(S);if(!C.length)return null;const O=new Uint32Array(C.length);for(let N=0;N<C.length;N++)O[N]=N;return{type:il.MESH,params:{vertices:C,indices:O}}}(w):null;if(y.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${y.type}".`);if(w=RE(m),!w)return null;switch(w.type){case"BoxGeometry":case"BoxBufferGeometry":return jR(w);case"CylinderGeometry":case"CylinderBufferGeometry":return function(S){const C=S.parameters;return{type:il.CYLINDER,params:{radiusTop:C.radiusTop,radiusBottom:C.radiusBottom,height:C.height,segments:C.radialSegments},orientation:new Fa().setFromEuler(s.M8C.degToRad(-90),0,0,"XYZ").normalize()}}(w);case"PlaneGeometry":case"PlaneBufferGeometry":return function(S){S.computeBoundingBox();const C=S.boundingBox;return{type:il.BOX,params:{x:(C.max.x-C.min.x)/2||.1,y:(C.max.y-C.min.y)/2||.1,z:(C.max.z-C.min.z)/2||.1}}}(w);case"SphereGeometry":case"SphereBufferGeometry":return function(S){return{type:il.SPHERE,params:{radius:S.parameters.radius}}}(w);case"TubeGeometry":case"BufferGeometry":return VR(m);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',w.type),jR(w)}}(l,e);if(!t)return null;const{type:n,params:i,offset:o,orientation:c}=t;let f;return f=n===il.BOX?function(m){const{x:y,y:w,z:S}=m;return new fE(new rt(y,w,S))}(i):n===il.CYLINDER?function(m){const{radiusTop:y,radiusBottom:w,height:S,segments:C}=m,O=new J2(y,w,S,C);return O.radiusTop=w,O.radiusBottom=w,O.height=S,O.numSegments=C,O}(i):n===il.SPHERE?function(m){return new TR(m.radius)}(i):n===il.HULL?function(m){const{faces:y,vertices:w}=m,S=[];for(let C=0;C<w.length;C+=3)S.push(new rt(w[C],w[C+1],w[C+2]));return new jy({faces:y,vertices:S})}(i):function(m){const{vertices:y,indices:w}=m;return new EE(y,w)}(i),{shape:f,offset:o,orientation:c}};function jR(l){if(!FR(l).length)return null;l.computeBoundingBox();const e=l.boundingBox;return{type:il.BOX,params:{x:(e.max.x-e.min.x)/2,y:(e.max.y-e.min.y)/2,z:(e.max.z-e.min.z)/2}}}function VR(l){const e=l.clone();e.quaternion.set(0,0,0,1),e.updateMatrixWorld();const t=new s.ZzF().setFromObject(e);if(!isFinite(t.min.lengthSq()))return null;const n=t.translate(e.position.negate()).getCenter(new s.Pa4);return{type:il.BOX,params:{x:(t.max.x-t.min.x)/2,y:(t.max.y-t.min.y)/2,z:(t.max.z-t.min.z)/2},offset:n.lengthSq()?new rt(n.x,n.y,n.z):void 0}}var PE,DE=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Ag=PE=class extends Ri{constructor(l=!1){super(),this._world=new KB,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var i;(i=this._viewer)==null||i.scene.modelRoot.children.forEach(o=>{this.makeBody(o)})},this._bodyMeshMap=new Map,this._movementPlane=new s.Kj0(new s._12(100,100),new s.vBJ({color:65280,side:s.ehD})),this.enabled=l,this._world.gravity.set(0,-9.81,0);const e=new Z2,t=new ar({mass:0,position:new rt(0,-2,0)});t.addShape(e),t.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=t,this._world.addBody(t);const n=new TR(.1);this._jointBody=new ar({mass:0}),this._jointBody.addShape(n),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(l){await super.onAdded(l);const e=new s.Pa4,t=new s.Pa4,n=new s.Pa4,i=new s._fP,o=new s._fP,c=new s.yGw,f=new s.yGw;let m=!1,y=!1;function w(S){const C=l.canvas.getBoundingClientRect(),O=new s.FM8;return O.x=(S.clientX-C.x)/C.width*2-1,O.y=-(S.clientY-C.y)/C.height*2+1,O}l.addEventListener("preFrame",()=>{const S=l.getPlugin(Hd),C=l.getPlugin(Zu);if(!this.enabled){if(!(this.nextSteps>0))return S&&m&&(S.enableRefreshTransform=!0,m=!1),C&&y&&(C.enable(PE.PluginType),y=!1),void(this._dirty=!1);this.enabled=!0}if(S&&S.enableRefreshTransform&&!m&&(S.enableRefreshTransform=!1,m=!0),C&&!y&&C.disable(PE.PluginType),this.nextSteps>0)for(let N=0;N<this.stepPhysics.stepCount;N++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let O=!1;for(const N of this._world.bodies){if(N.mass===0)continue;const H=this._bodyMeshMap.get(N);if(H&&(H.updateMatrixWorld(),H.getWorldPosition(t),H.getWorldQuaternion(o),H.getWorldScale(n),t.manhattanDistanceTo(e.copy(N.position))>0&&(O=!0),o.angleTo(i.copy(N.quaternion))>0&&(O=!0),O)){if(c.compose(e,i,n),!H.parent)throw new Error("no parent");f.copy(H.parent.matrixWorld).invert(),f.multiply(c),f.decompose(e,i,n),H.position.copy(e),H.quaternion.copy(i)}}this._dirty=O,l.setDirty(),l.renderer.resetShadows(),S==null||S.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),l.scene.addEventListener("update",S=>{this._bodyMeshMap.forEach((C,O)=>{O.velocity.set(0,0,0),O.angularVelocity.set(0,0,0)})}),l.scene.addEventListener("addSceneObject",S=>{var O;const C=(O=S.object)==null?void 0:O.modelObject;C&&C.traverse(N=>{const H=N.uiConfig;H&&Array.isArray(H.children)&&(H.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(N)},{type:"number",label:"Mass",hidden:()=>!N._physicsBody,getValue:()=>{var q;return((q=N._physicsBody)==null?void 0:q.mass)??0},setValue:q=>{N._physicsBody&&(N._physicsBody.mass=q)}}]}),N.userData.physicsMass!==void 0&&this.makeBody(N))})}),l.canvas.addEventListener("pointerdown",S=>{if(!this.enabled||!S.isPrimary)return;l.getPlugin(us).enabled=!1;const C=w(S),O=new s.iMs;O.setFromCamera(C,l.scene.activeCamera.cameraObject);const N=O.intersectObjects([...this._bodyMeshMap.values()],!0);if(!N.length)return;let H,q=null,J=N[0];for(const ue of N){for(q=ue.object,J=ue;!(q==null||q.visible&&q.material);)q=q.parent;if(q)break}if(!q)return;for(;q.parent&&!H;){for(const[ue,me]of this._bodyMeshMap.entries())if(me===q){ue.mass>0&&(H=ue);break}q=q.parent}if(!H)return;l.scene.activeCamera.interactionsEnabled=!1,this._movementPlane.position.copy(J.point),this._movementPlane.lookAt(l.scene.activeCamera.cameraObject.getWorldPosition(new s.Pa4));const V=new rt().copy(J.point).vsub(H.position),z=H.quaternion.inverse().vmult(V);this._jointBody.position.copy(J.point),this._jointConstraint=new Y2(H,z,this._jointBody,new rt(0,0,0)),this._world.addConstraint(this._jointConstraint)}),l.canvas.addEventListener("pointermove",S=>{if(!this.enabled||!S.isPrimary||!this._jointConstraint)return;const C=w(S),O=new s.iMs;O.setFromCamera(C,l.scene.activeCamera.cameraObject);const N=O.intersectObject(this._movementPlane);if(!N.length)return;const H=N[0];this._jointBody.position.copy(H.point),this._jointConstraint.update()}),l.canvas.addEventListener("pointerup",S=>{this.enabled&&S.isPrimary&&(l.getPlugin(us).enabled=!0,l.scene.activeCamera.interactionsEnabled=!0,this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(l){if(l.isLight||l._physicsBody)return;const e=[];let t=0;if(l.updateMatrixWorld(),l.traverse(m=>{const y=m;if(!y.isMesh)return;if(y._physicsShape)return void e.push(y._physicsShape);if(t+=y.userData.physicsMass??1,y.addEventListener("objectUpdate",()=>{y.userData.physicsMass===0&&(this._ground.position.y=y.position.y,this._bodyMeshMap.forEach((S,C)=>{C.velocity.set(0,0,0),C.angularVelocity.set(0,0,0),C.force.set(0,0,0),C.torque.set(0,0,0)}))}),y.userData.physicsMass===0)return;const w=aL(y,{type:il.HULL});w?(e.push([w.shape,y]),y._physicsShape=w.shape):console.warn("Failed to convert mesh to cannon shape",y)}),!e.length)return;const n=new ar({mass:t,angularVelocity:new rt(0,0,0),velocity:new rt(0,0,0)}),i=new s.Pa4,o=new s._fP,c=new s.Pa4,f=new s.yGw;for(const[m,y]of e)y!==l?(y.updateMatrixWorld(),f.copy(l.matrixWorld).invert(),f.multiply(y.matrixWorld),f.decompose(i,o,c),n.addShape(m,new rt(...i.toArray()),new Fa(...o.toArray()))):n.addShape(m);n.position.set(...l.getWorldPosition(i).toArray()),n.quaternion.set(...l.getWorldQuaternion(o).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0),l.addEventListener("objectUpdate",()=>{n.position.set(...l.getWorldPosition(i).toArray()),n.quaternion.set(...l.getWorldQuaternion(o).toArray()),n.angularVelocity.set(0,0,0),n.velocity.set(0,0,0)}),this._world.addBody(n),this._bodyMeshMap.set(n,l),l._physicsBody=n,l.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};Ag.PluginType="CannonPhysics",DE([Yn("Enabled",l=>({onChange:()=>{}})),ze()],Ag.prototype,"enabled",void 0),DE([ir()],Ag.prototype,"stepPhysics",void 0),DE([ht("Make Root Bodies")],Ag.prototype,"makeRootBodies",void 0),Ag=PE=DE([on("Physics (dev)")],Ag);var lL=__webpackgi_require__(819);class Xd{static _initialize(){this._inited=!0,(0,a.createStyles)(a.css`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const i=(0,a.createDiv)({id:"customContextMenu",addToBody:!1});i.style.top=n+"px",i.style.left=t+"px";for(const[o,c]of Object.entries(e)){const f=(0,a.createDiv)({classList:["customContextMenuItems"],addToBody:!1,innerHTML:o});i.appendChild(f),f.onclick=c}return this.Element=i,i}static Remove(){var e;(e=this.Element)==null||e.remove(),this.Element=void 0}}Xd.Element=void 0,Xd._inited=!1;var cL=__webpackgi_require__(665);const uL=(l,e,t)=>{var c,f;const n=l.controller_,i=(f=(c=n.parent)==null?void 0:c.children)==null?void 0:f.indexOf(n);return!(((m,y)=>y.controller_.rackController.rack===m.controller_.parent)(l,e)&&i===t||(e.add(l,t),0))},GR=(l,e,t,n)=>{var S;let i=e.uiRef;i!=null&&i.controller_.viewProps.get("disposed")&&(i=void 0);const o=i==null?void 0:i.expanded;if(!i){const C=l.addFolder({title:""});i=C,i.on("fold",O=>{var H,q,J;let N=C.expanded;(0,a.safeSetProperty)(e,"expanded",N,!0),N=(0,a.getOrCall)(e.expanded)??N,N!==C.expanded&&(C.expanded=N),(H=e.uiRefresh)==null||H.call(e,"postFrame",!0,10),N?(q=e.onExpand)==null||q.call(e,e):(J=e.onCollapse)==null||J.call(e,e)})}if(!i)return i;i.expanded=(0,a.getOrCall)(e.expanded)??o??!1;const c=(e.children??[]).map(C=>C&&(0,a.getOrCall)(C)).flat(2).filter(C=>C);let f=0;for(const C of c){if(Array.isArray(C)||typeof C!="object"){console.error("child is not an object",C);continue}let O=C.uiRef;O&&O.controller_.viewProps.get("disposed")&&(C.uiRef=void 0,C.uiRefresh=void 0),O=C.uiRef,O||(t.appendUiObject({uiConfig:C},i),O=C.uiRef),O&&uL(O,i,f++)&&t.appendUiObject({uiConfig:C},i)}let m=i.children;for(;m.length>f;){const C=m[m.length-1];i.remove(C),C.dispose(),m=i.children}i.controller_.props.set("title",(0,a.getOrCall)(e.label)??"");const y=i.controller_.view.containerElement,w=(0,a.getOrCall)(e.domChildren,[]);if((w==null?void 0:w.length)!==void 0){const C=[];for(let O=0;O<y.children.length;O++){const N=y.children[O];(S=N.dataset)!=null&&S.tpCustomDOM&&C.push(N)}for(const O of C)y.removeChild(O);for(const O of w)O.parentElement!==y&&(y.appendChild(O),O.dataset.tpCustomDOM="true");i.controller_.foldable.cleanUpTransition()}return i},hL=(l,e,t,n)=>{const[i,o]=e.property??[void 0,void 0],c=(0,a.getOrCall)(e.label)??o;let f=e.uiRef;return f!=null&&f.controller_.viewProps.get("disposed")&&(f=void 0),f||(f=l.addButton({title:""}),f.on("click",async()=>{const m=[];e.prompt&&m.push(await t.prompt(...e.prompt));const y=(i&&o?i[o]:void 0)??e.value;if(typeof y=="function"){const w=()=>{t.removeEventListener("postFrame",w),y.call(e,...m)};t.addEventListener("postFrame",w)}else console.warn("Invalid action type for button")})),f&&(f.title=(c??"click me")+""),f},dL=(l,e,t,n)=>{const i=Object.fromEntries(((0,a.getOrCall)(e.children)??[]).map(o=>(0,a.getOrCall)(o)).flat(2).filter(o=>o).map(o=>{const c=(0,a.getOrCall)(o.label);return[c,o.value??c]}));return Hf(l,e,t,{options:i,...n??{}})},pL=(l,e,t,n)=>{const i=(0,a.getOrCall)(e.bounds),o=((i==null?void 0:i.length)??0)>=2?i[1]:1,c=((i==null?void 0:i.length)??0)>=1?i[0]:0,f=e.stepSize||void 0;return Hf(l,e,t,{min:c,max:o,step:f,...n??{}})},OE=(l,e,t,n)=>{const i=(0,a.getOrCall)(e.bounds);if(!i||i.length<1)return Hf(l,e,t,{...n??{}});const o=(i.length??0)>=2?i[1]:1,c=(i.length??0)>=1?i[0]:0,f={min:c,max:o,step:e.stepSize??(o-c)/100},m={x:f,y:f};e.type!=="vec3"&&e.type!=="vec4"||(m.z=f),e.type==="vec4"&&(m.w=f);const y=e.property;if(e.value===void 0&&y&&y[0]&&typeof y[0]=="object"&&y[0][y[1]]&&Array.isArray(y[0][y[1]])){const[w,S]=y,C=w[S],O=C.length,N=new(O===2?s.FM8:O===3?s.Pa4:s.Ltg)().fromArray(C);e.value=N,e.property=void 0,e.onChange=[()=>{w[S]=N.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(H=>H),e.label===void 0&&(e.label=S)}return Hf(l,e,t,{...m,...n??{}})},fL=(l,e,t,n)=>{var o;const i=e.property;if(e.value===void 0&&i&&typeof i[0]=="object"&&((o=i[0][i[1]])!=null&&o.isColor)){const[c,f]=i,m=s.KI_;Object.defineProperty(e,"value",{get:()=>{const y=c[f];return y?new pt(y).getHex(m):0},set:y=>{const w=c[f],S=new pt().setHex(y,m);w.isColor?w.copy(S):typeof w=="number"?c[f]=S.getHex():typeof w=="string"&&(c[f]="#"+S.getHexString()),typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(y=>y),e.label===void 0&&(e.label=f+"")}return(n=n??{}).view="color",(0,a.getOrCall)(e.inlinePicker)&&(n.picker="inline"),Hf(l,e,t,n)},Hf=(l,e,t,n)=>{var f;let i=(0,a.getOrCall)(e.property);if((e.getValue||e.setValue)&&i&&console.error("specify either property or value, or getValue and setValue",e),i)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if((Object.hasOwn?Object.hasOwn(e,"value"):e.hasOwnProperty("value"))||e.value!==void 0||!e.getValue&&!e.setValue||(Object.defineProperty(e,"value",{get:()=>{var m;return(m=e.getValue)==null?void 0:m.call(e)},set:m=>{var y;return(y=e.setValue)==null?void 0:y.call(e,m)}}),i=[e,"value"]),i||e.value===void 0||(i=[e,"value"]),!i)return void console.error("cannot determine property",e);n=n??{};const o={label:(0,a.getOrCall)(e.label)??i[1],...n};let c=e.uiRef;if(c!=null&&c.controller_.viewProps.get("disposed")&&(c=void 0),!c&&typeof i[0]=="object"&&i[0]){const[m,y]=i;try{c=e.isMonitor?l.addMonitor(m,y,o):l.addInput(m,y,o).on("change",w=>{[e.onChange].flat().forEach(S=>typeof S=="function"&&(S==null?void 0:S(w))),typeof(m==null?void 0:m.setDirty)=="function"&&m.setDirty(w)})}catch(w){if(!w.message.startsWith("No matching controller for"))throw w;c=void 0}}if(c){for(const[m,y]of Object.entries(o)){const w=c.controller_.props.value(m);w!==void 0&&w.rawValue!==y&&c.controller_.props.set(m,y)}e.type==="slider"&&(o.min!==void 0&&c.controller_.valueController.sliderController.props.set("minValue",o.min),o.max!==void 0&&c.controller_.valueController.sliderController.props.set("maxValue",o.max)),(f=c==null?void 0:c.controller_.valueController.view.inputElement)==null||f.setAttribute("placeholder",(0,a.getOrCall)(e.placeholder)??""),c.refresh()}return c};class HR extends a.SimpleEventDispatcher{constructor(e=!1,t=!1,n=!1,i=!0,o=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:GR,folder:GR,input:Hf,number:Hf,slider:pL,dropdown:dL,checkbox:Hf,color:fL,vec:OE,vec2:OE,vec3:OE,vec4:OE,button:hL,monitor:(f,m,y,w)=>(m.isMonitor=!0,Hf(f,m,y,w)),dummy:(f,m,y,w)=>Hf(f,m,y,w)},this.alert=async f=>alert(f),this.confirm=async f=>confirm(f),this.prompt=async(f,m,y=!0)=>prompt(f,m),this._expand=e,this._limitedOptions=n;const c=this._createUiContainer();o.appendChild(c),this._pane=new cL.Pane({title:"Configuration",container:c}),this._pane.expanded=this._expand,i&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],i=(0,a.now)(),o=i-this._lastModeTime[e];t.forEach(c=>{c[2]>.001?(c[2]-=o,n.push(c)):this._refreshUiObject(c[0],c[1],c[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=i}addToRefreshQueue(e,t){var f;const n=(f=t[0])==null?void 0:f.uiConfig,i=n==null?void 0:n.uuid,o=this._refreshQueue[e],c=o.find(m=>m[3]===i);c?c[2]=Math.max(c[2],t[2]):o.push([...t,i]),this._refreshQueue[e]=o}dispose(){var e;(e=this._pane)==null||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var i,o;const{uiConfig:n}=e??{};if(n&&(!this._limitedOptions||n.limitedUi)&&(t=t??this._pane,n.type)){n.uuid||(n.uuid=ji()),n.uiRef&&n.uiRefType!==n.type&&this.removeUiConfig(n);const c=(o=(i=this._typeGenerators)[n.type])==null?void 0:o.call(i,t,n,this);c&&(c.hidden=(0,a.getOrCall)(n.hidden)??!1,c.disabled=(0,a.getOrCall)(n.disabled)??!1),n.uiRef=c,n.uiRefType=c?n.type:void 0,n.uiRefresh=(f="postFrame",m=!1,y=0)=>this._uiObjectRefresh(f,(e==null?void 0:e.uiConfig)??n,t,m,y),c==null||c.controller_.viewProps.handleDispose(()=>{n.uiRef=void 0,n.uiRefType=void 0,n.uiRefresh=void 0})}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)==null||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,i,o){(i?BE(t,n):[{uiConfig:t,parentFolder:n}]).forEach(c=>{const f=[{uiConfig:c.uiConfig},c.parentFolder,o];e==="immediate"?this._refreshUiObject(...f):this.addToRefreshQueue(e,f)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=(0,a.createDiv)({id:"tweakpaneUiContainer",addToBody:!1});return(0,a.createStyles)(a.css`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function BE(l,e,t){return t=t??[],l&&l.uiRef&&(t.push({uiConfig:l,parentFolder:e}),[...l.children||[]].forEach(n=>{typeof n!="function"&&n&&(Array.isArray(n)?n.forEach(i=>t=BE(i,l.uiRef,t)):t=BE(n,l.uiRef,t))})),t}class mL{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let i=0,o=n.length;i<o;i++)n[i].call(this,e);e.target=null}}}function WR(l){return document.createElementNS("http://www.w3.org/1999/xhtml",l)}const QR={};function PS(l){l in QR||(QR[l]=!0,console.warn(l))}let _b;class gL{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{_b===void 0&&(_b=WR("canvas")),_b.width=e.width,_b.height=e.height;const i=_b.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=_b}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=WR("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),o=i.data;for(let c=0;c<o.length;c++)o[c]=255*pn(o[c]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*pn(t[n]/255)):t[n]=pn(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class _L{constructor(e=null){this.isSource=!0,this.uuid=se(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let c=0,f=i.length;c<f;c++)i[c].isDataTexture?o.push(DS(i[c].image)):o.push(DS(i[c]))}else o=DS(i);n.url=o}return t||(e.images[this.uuid]=n),n}}function DS(l){if(typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&l instanceof ImageBitmap)return gL.getDataURL(l);if(l.data){let e=[];try{e=Array.from(l.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=l.data}return{data:e,width:l.width,height:l.height,type:l.data.constructor.name}}return l.url!==void 0?l.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let vL=0;class M0 extends mL{constructor(e=M0.DEFAULT_IMAGE,t=M0.DEFAULT_MAPPING,n=1001,i=1001,o=bn,c=1008,f=1023,m=1009,y=M0.DEFAULT_ANISOTROPY,w=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:vL++}),this.uuid=se(),this.name="",this.source=new _L(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=c,this.anisotropy=y,this.format=f,this.internalFormat=null,this.type=m,this.offset=new K(0,0),this.repeat=new K(1,1),this.center=new K(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof w=="string"?this.colorSpace=w:(PS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=w===Un?pi:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===pi?Un:3e3,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return PS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===pi?Un:3e3}set encoding(e){PS("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Un?pi:""}}M0.DEFAULT_IMAGE=null,M0.DEFAULT_MAPPING=300,M0.DEFAULT_ANISOTROPY=1;var LE=__webpackgi_require__(898),Tx={};LE.Z&&LE.Z.locals&&(Tx.locals=LE.Z.locals);var OS,BS=0,Qy={};Qy.styleTagTransform=Bf(),Qy.setAttributes=kd(),Qy.insert=function(l,e){(e.target||document.head).appendChild(l)},Qy.domAPI=Df(),Qy.insertStyleElement=io(),Tx.use=function(l){return Qy.options=l||{},BS++||(OS=ku()(LE.Z,Qy)),Tx},Tx.unuse=function(){BS>0&&!--BS&&(OS(),OS=null)};var yL=Tx;class NE extends HR{constructor(e=!1,t=!1,n=!1,i=document.body){super(e,t,n,!1),this.dependencies=[fi],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=o=>{this.dispatchEvent(o),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async o=>this._viewer?this._viewer.alert(o):super.alert(o),this.confirm=async o=>this._viewer?this._viewer.confirm(o):super.confirm(o),this.prompt=async(o,c,f=!0)=>this._viewer?this._viewer.prompt(o,c,f):super.prompt(o,c,f),this._pane.registerPlugin(lL),yL.use({target:i})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,i,o,c)=>{let f=i.property||i.__property;const m="placeholder";if(i.value===void 0&&(i.getValue||i.setValue)&&(Object.defineProperty(i,"_value",{get:()=>{var y;return(y=i.getValue)==null?void 0:y.call(i)},set:y=>{var w;return(w=i.setValue)==null?void 0:w.call(i,y)}}),f=[i,"_value"]),(!(Object.hasOwn?Object.hasOwn(i,"value"):i.hasOwnProperty("value"))||i.value===void 0)&&f&&typeof f[0]=="object"){const[y,w]=f,S=(0,a.makeTextSvg)("Render Target"),C=(0,a.makeTextSvg)("Data Texture"),O=(0,a.makeTextSvg)("CUBE Texture"),N=(0,a.makeTextSvg)("Compressed Texture"),H={},q={};Object.defineProperty(i,"value",{get:()=>{let J,V=y[w];if(V!=null&&V.get&&(V=V.get()),!V)return m;if(V.isCompressedTexture&&!V.image.tp_src&&(V.image.tp_src=N),V.isTexture?(V.image&&!V.image.tp_src&&(V.image instanceof ImageBitmap||V.image instanceof HTMLImageElement||V.image instanceof HTMLVideoElement)?V.image.tp_src=(0,a.imageBitmapToBase64)(V.image,160):V.image&&V.isRenderTargetTexture&&!V.image.tp_src?V.__target&&(V.image.tp_src=t.renderer.renderTargetToDataUrl(V.__target)):V.image&&!V.image.tp_src&&(V.image.tp_src=Nn(V,160,!1).toDataURL("image/png",90)),V.isRenderTargetTexture&&!V.image.tp_src&&(V.image.tp_src=S),V.isDataTexture&&!V.image.tp_src&&(V.image.tp_src=C),V.image&&(J=V.image.tp_src_uuid,J=J?H[J]:void 0,J||(J=V.image.tp_src||V.image.src))):typeof V=="string"?J=V:V.domainMin?(J=V.texture,V.texture.image&&!V.texture.image.tp_src&&(V.texture.image.tp_src=O),V.texture.image&&(J=V.texture.image.tp_src_uuid,J=J?H[J]:void 0,J||(J=V.texture.image.tp_src||V.texture.image.src))):V&&console.error("unknown value",V),J||(J=m),V.image&&!V.image.tp_src_uuid){const z=ji();V.image.tp_src_uuid=z,q[J]=z}return typeof J=="string"&&(J=H[J]??J),J},set:J=>{var me,Te,Be,He,tt,lt,at,St,mt;const V=y[w],z=gt=>{y[w]=gt,gt!=null&&gt.isTexture&&(gt.flipY=gt.isDataTexture?gt.flipY:(V==null?void 0:V.flipY)??!0)};if(typeof J=="string")return void(typeof V=="string"&&z(J));if(!J)return void(i.value=m);if(J.isPlaceholder)return void(V&&(z(typeof V=="string"?"":null),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty()));let ue=J.tp_src_uuid;if(ue||(ue=J.src??J.tp_src,ue=q[ue]??ue,delete q[ue],J.tp_src_uuid=ue),ue&&(H[ue]=J),typeof V!="string"){if(!((V==null?void 0:V.image)===J||((me=V==null?void 0:V.image)==null?void 0:me.src)===J.src||((Te=V==null?void 0:V.image)==null?void 0:Te.tp_src)===J.tp_src&&J.tp_src!=null||((Be=V==null?void 0:V.image)==null?void 0:Be.tp_src)===J.src&&J.src!=null||((He=V==null?void 0:V.image)==null?void 0:He.src)===J.tp_src&&J.tp_src!=null))if(J instanceof File){const gt=t==null?void 0:t.getPlugin(fi);if(!gt)throw"Viewer or AssetManagerPlugin not found";(tt=gt.importer)==null||tt.importSingle({file:J,path:J.src}).then(Ot=>{var Bt,Ft,_n,mn;if(Ot){Ot.isDataTexture&&(Ot.needsUpdate=!0);const qn=(_n=(Ft=(Bt=J.src)==null?void 0:Bt.split("?"))==null?void 0:Ft[0])==null?void 0:_n.split(".").pop();Ot.userData&&(Ot.userData.mimeType||(Ot.userData.mimeType="image/"+(["jpg","jpeg"].includes(qn)?"jpeg":"png"))),z(Ot),[i.onChange].flat().forEach(Rn=>typeof Rn=="function"&&(Rn==null?void 0:Rn())),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty(),(mn=i.uiRefresh)==null||mn.call(i,"postFrame",!1)}})}else{const gt=new M0(J);gt.assetType="texture",gt.needsUpdate=!0;const Ot=(St=(at=(lt=J.src)==null?void 0:lt.split("?"))==null?void 0:at[0])==null?void 0:St.split(".").pop();gt.userData.mimeType||(gt.userData.mimeType="image/"+(["jpg","jpeg"].includes(Ot)?"jpeg":"png"));const Bt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(w);gt.colorSpace=Bt?s.GUF:s.KI_,gt.wrapS=s.rpg,gt.wrapT=s.rpg,z(gt),[i.onChange].flat().forEach(Ft=>typeof Ft=="function"&&(Ft==null?void 0:Ft())),typeof(y==null?void 0:y.setDirty)=="function"&&y.setDirty(),(mt=i.uiRefresh)==null||mt.call(i,"postFrame",!1)}}else z(ue)}}),i.__property=i.property,i.property=void 0,i.label===void 0&&(i.label=w)}return(c=c??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],c.imageFit===void 0&&(c.imageFit="contain"),c.clickCallback===void 0&&(c.clickCallback=(y,w)=>{var q;const S=y==null?void 0:y.target,C=S==null?void 0:S.getBoundingClientRect();if(!C)return void w.click();const O=i.uiRef.controller_.valueController.value.rawValue,N=O===m||O!=null&&O.isPlaceholder?{}:{"remove image":()=>{var ue;i.uiRef.controller_.valueController.value.setRawValue("");const[J,V]=i.property||i.__property||[i,"value"],z=typeof J[V]=="string";J[V]=z?"":null,[i.onChange].flat().forEach(me=>typeof me=="function"&&(me==null?void 0:me())),typeof(J==null?void 0:J.setDirty)=="function"&&J.setDirty(),(ue=i.uiRefresh)==null||ue.call(i,"postFrame",!1),Xd.Remove()},"download image":async()=>{Xd.Remove();const[J,V]=i.property||i.__property||[i,"value"],z=J[V];if(!z)return;const ue=(z==null?void 0:z.image)??i.uiRef.controller_.valueController.value.rawValue;let me=z.__rootBlob?z.__rootBlob.objectUrl||URL.createObjectURL(z.__rootBlob):z.userData.rootPath||(ue==null?void 0:ue.src);ue&&(ue instanceof ImageBitmap||ue instanceof HTMLImageElement||ue instanceof HTMLVideoElement)&&!me&&(me=(0,a.imageBitmapToBase64)(ue));let Te=z.__rootBlob?z.__rootBlob.name||"image."+(z.__rootBlob.ext||"png"):null;if(!me&&z.isRenderTargetTexture){const He=z.__target;if(z.type===s.ywz)me=t.renderer.renderTargetToDataUrl(He,"image/png",90),Te="renderTarget.png";else{const tt=new iw().parse(t.renderer.rendererObject,He),lt=new Blob([tt],{type:"image/x-exr"});if(!lt)return void console.error("cannot export render target",ue,J[V],J,V,i);Te="renderTarget.exr",me=URL.createObjectURL(lt)}}if(!me&&z.isDataTexture){const He=new iw().parse(void 0,z),tt=new Blob([He],{type:"image/x-exr"});if(!tt)return void console.error("cannot export data texture",ue,J[V],J,V,i);Te="dataTexture.exr",me=URL.createObjectURL(tt)}if(!me)return void console.error("cannot export image",ue,J[V],J,V,i);const Be=document.createElement("a");document.body.appendChild(Be),Be.style.display="none",Be.href=me,Be.download=Te||(me.startsWith("data:")?"image.png":me.split("/").pop()??"image.png"),Be.target="_blank",Be.click(),document.body.removeChild(Be)}},H=Xd.Create({...N,"set/replace image":()=>{w.click(),Xd.Remove()},"from url":async()=>{var me,Te;let J="";if(J=await o.prompt("Load texture: Enter Image/Texture URL",J,!0),!J||!J.startsWith("http")&&!J.startsWith("data:image"))return J!==null&&await o.alert("Loading Image: Invalid URL"),void Xd.Remove();J=J.trim();const[V,z]=i.property||i.__property||[i,"value"],ue=V[z];if(typeof ue=="string")V[z]=J,[i.onChange].flat().forEach(Be=>typeof Be=="function"&&(Be==null?void 0:Be())),typeof(V==null?void 0:V.setDirty)=="function"&&V.setDirty(),(me=i.uiRefresh)==null||me.call(i,"postFrame",!1);else{const Be=t==null?void 0:t.getPlugin(fi);if(!Be)throw"Viewer or AssetManagerPlugin not found";(Te=Be.importer)==null||Te.importSinglePath(J).then(He=>{var tt;if(He){He.isDataTexture?He.needsUpdate=!0:He&&(ue==null?void 0:ue.flipY)!==void 0&&(He.flipY=ue.flipY);const lt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(z);He.colorSpace=lt?s.GUF:s.KI_,V[z]=He,[i.onChange].flat().forEach(at=>typeof at=="function"&&(at==null?void 0:at())),typeof(V==null?void 0:V.setDirty)=="function"&&V.setDirty(),(tt=i.uiRefresh)==null||tt.call(i,"postFrame",!1)}else console.warn("Failed to load texture",J)})}Xd.Remove()},cancel:()=>{Xd.Remove()}},2,C.height+8);(q=S.parentElement)==null||q.appendChild(H),C.y>.7*document.body.clientHeight&&(H.style.top="auto",H.style.bottom=C.height+8+"px")}),c.view="input-image",Hf(n,i,o,c)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const t=(i=this._viewer)==null?void 0:i.getPlugin(e);if(!t)return void console.warn("plugin not found:",e);this._plugins.push(t),t.uiConfig&&(t.uiConfig.limitedUi=!0),t.uiConfig&&t.uiConfig.hidden===void 0&&(t.uiConfig.hidden=!1),this._appendUiObject(t);const n=t.uiConfig;if(n!=null&&n.uiRef&&t.toJSON){const o=typeof t.toJSON=="function"?t.toJSON():null;t.resetDefaults=async()=>{var m,y;await((m=t.fromJSON)==null?void 0:m.call(t,o)),(y=n.uiRefresh)==null||y.call(n,"postFrame",!0)};const c=n.uiRef.controller_.view.element,f=(0,a.createDiv)({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});f.onclick=m=>{const y={};typeof t.toJSON=="function"&&(y["download preset"]=async()=>{var C,O;const S=(O=(C=this._viewer)==null?void 0:C.getPlugin(fi))==null?void 0:O.exportPluginPreset(t);await(0,a.downloadBlob)(new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),"preset."+t.constructor.PluginType+".json"),Xd.Remove()}),typeof t.fromJSON=="function"&&(y["upload preset"]=async()=>{var H,q,J;Xd.Remove();const S=await(0,a.uploadFile)(!1,!1);if(S.length===0)return;const C=S[0],O=await C.text(),N=JSON.parse(O);await((q=(H=this._viewer)==null?void 0:H.getPlugin(fi))==null?void 0:q.importPluginPreset(N,t)),(J=n.uiRefresh)==null||J.call(n,"postFrame",!0)},o&&(y["reset defaults"]=async()=>{var S;Xd.Remove(),await((S=t.resetDefaults)==null?void 0:S.call(t))}));const w=Xd.Create(y,c.clientWidth-120,12);c.append(w),m.preventDefault()},c.appendChild(f)}return n}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var n;const t=e.uiConfig;t&&((0,a.getOrCall)(t.hidden)!==!0?(n=t.uiRefresh)==null||n.call(t,"postFrame",!0):t.uiRef&&(t.uiRef.hidden=!0))})}}NE.PluginType="TweakpaneUi";class Cx extends Ri{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.scene.backgroundIntensity)??1},setValue:e=>{this._viewer&&(this._viewer.scene.backgroundIntensity=e)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0},{type:"checkbox",label:"Fixed Env Direction",property:[this,"sceneEnvironmentFixedDirection"]},{type:"checkbox",label:"Artistic Lighting",getValue:()=>{var e;return((e=this._viewer)==null?void 0:e.renderer.useLegacyLights)??!0},setValue:e=>{this._viewer&&(this._viewer.renderer.useLegacyLights=e)}}]}}get sceneBackgroundColor(){var t,n;const e=(n=(t=this._viewer)==null?void 0:t.scene.backgroundColor)==null?void 0:n.getHex(s.KI_);return e!==void 0&&(this._savedBg=!0),e||0}set sceneBackgroundColor(e){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new pt),this._viewer.scene.backgroundColor.setHex(e),this._viewer.scene.setDirty())}get sceneBackground(){var t;const e=(t=this._viewer)==null?void 0:t.scene.background;return e&&(e.isTexture||e.assetType==="texture")?e:null}set sceneBackground(e){this._viewer&&(this._viewer.scene.background=e)}get sceneEnvironment(){var e;return((e=this._viewer)==null?void 0:e.scene.environment)||null}set sceneEnvironment(e){this._viewer&&(this._viewer.scene.environment=e)}get sceneEnvironmentRotation(){var e,t;return((t=(e=this._viewer)==null?void 0:e.scene.environment)==null?void 0:t.rotation)??0}set sceneEnvironmentRotation(e){var n,i;const t=(n=this._viewer)==null?void 0:n.scene.environment;t&&(t.rotation=e,(i=this._viewer)==null||i.scene.setDirty())}get sceneEnvironmentIntensity(){var e;return((e=this._viewer)==null?void 0:e.scene.envMapIntensity)??1}set sceneEnvironmentIntensity(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get sceneEnvironmentFixedDirection(){var e;return((e=this._viewer)==null?void 0:e.scene.fixedEnvMapDirection)??!1}set sceneEnvironmentFixedDirection(e){var t;(t=this._viewer)!=null&&t.scene&&(this._viewer.scene.fixedEnvMapDirection=e)}get envmapBg(){var e,t,n;return((e=this._viewer)==null?void 0:e.scene.background)==="environment"||((t=this._viewer)==null?void 0:t.scene.background)===((n=this._viewer)==null?void 0:n.scene.environment)}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.scene.background;t&&t!==this._viewer.scene.environment&&t!=="environment"&&(this.lastBgVal=t),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(e){await super.onAdded(e),this.lastBgVal=e.scene.background,e.scene.addEventListener("backgroundChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)}),e.scene.addEventListener("environmentChanged",()=>{var t,n;(n=(t=this.uiConfig).uiRefresh)==null||n.call(t,"postFrame",!0)})}}Cx.PluginType="SimpleBackgroundEnvUiPlugin1";class Rx extends Ri{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)==null||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)==null||e.setDirty()}get uiConfig(){var e,t;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...((t=(e=this._viewer)==null?void 0:e.scene.modelRoot.modelObject.children)==null?void 0:t.map(n=>n.assetType==="light"?null:n.uiConfig).filter(n=>n!=null))??[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;(t=(e=this._uiConfig)==null?void 0:e.uiRefresh)==null||t.call(e,"postFrame",!0)}}Rx.PluginType="SimpleUi";var AL=__webpackgi_require__(1),bL=__webpackgi_require__.n(AL)();class Ix extends Ri{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=(0,a.createDiv)({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n;(n=this._viewer)==null||n.doOnce("postFrame",()=>{var c,f,m;const i=(c=this._viewer)==null?void 0:c.scene.modelRoot;if(!i||t==null)return;const o=new Set;i.traverse(y=>{y!==i&&(y.visible=t.includes(y.uuid),y.visible&&y.traverseAncestors(w=>o.add(w)))}),o.forEach(y=>y.visible=!0),(m=(f=this._viewer)==null?void 0:f.scene)==null||m.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=e,this.reset=this.reset.bind(this),(0,a.createStyles)(a.css`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var c;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const t=(c=this._viewer)==null?void 0:c.scene.modelRoot;if(!t)return;const n=t.children.reduce(this._buildData,[]),i=t.children.reduce(this._findVisible,[]);let o=!1;return new Promise((f,m)=>{this.treeView=new bL(this.hierarchyDiv,{closeDepth:1,data:n,loaded:function(){this.values=i,f()},onChange:()=>{o?(0,a.timeout)(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):o=!0},onItemLabelClick:y=>{var S;const w=(S=this._viewer)==null?void 0:S.scene.modelRoot.modelObject.getObjectByProperty("uuid",y);w&&t.visible&&w.dispatchEvent({type:"select",value:w,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Ix.PluginType="HierarchyUiPlugin";class Px extends Ri{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Gc;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[fi],this._sceneUpdate=e=>{var n,i,o;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(c=>{if(!c.lightObject)return;const f=c.uiConfig;f&&!t.includes(f)&&t.push(f)}),[...this.uiConfig.children].forEach(c=>{(c==null?void 0:c.type)==="button"||t.includes(c)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(c),1)}),t.forEach(c=>{this.uiConfig.children.includes(c)||this.uiConfig.children.push(c)}),(o=(i=this.uiConfig).uiRefresh)==null||o.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Px.PluginType="SimpleLightsUi";class Dx extends Ri{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[fi],this._sceneUpdate=e=>{var n,i,o;if(!e.hierarchyChanged)return;const t=[];(n=this._viewer)==null||n.traverseSceneObjects(c=>{if(!c.cameraObject)return;const f=c.uiConfig;f&&!t.includes(f)&&t.push(f)}),[...this.uiConfig.children].forEach(c=>{(c==null?void 0:c.type)==="button"||t.includes(c)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(c),1)}),t.forEach(c=>{this.uiConfig.children.includes(c)||this.uiConfig.children.push(c)}),(o=(i=this.uiConfig).uiRefresh)==null||o.call(i,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Dx.PluginType="SimpleSceneCamerasUi";var Z_,vb=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Yd=Z_=class extends Ri{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(l=!0){if(!this._viewer)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const e={width:Math.floor(this.width),height:Math.floor(this.height)},t=this._viewer.container.getBoundingClientRect(),n={width:Math.floor(t.width),height:Math.floor(t.height)};let i=1;if(e.width>n.width){const o=e.width;e.width=n.width;const c=e.width/o;if(e.height=Math.floor(e.height*c),i/=c,i>Z_.MaxCanvasScale)return this.width=n.width*Z_.MaxCanvasScale,console.log("loop",this.width,n.width,i),void this._sizeChanged()}if(e.height>n.height){const o=e.height;e.height=n.height;const c=e.height/o;if(e.width=Math.floor(e.width*c),i/=c,i>Z_.MaxCanvasScale)return this.height=n.height*Z_.MaxCanvasScale,console.log("loop",this.width,n.width,this.height,n.height,i),void this._sizeChanged()}(e.width>=n.width||e.width<1)&&delete e.width,(e.height>=n.height||e.height<1)&&delete e.height,this._viewer.setSize(e),this._setScale(i),l&&(this.scale=i),this._refresh()}_setScale(l){this._viewer&&(this._viewer.renderer.displayCanvasScaling=l)}_scaleChanged(){if(!this._viewer)return;const l=this.scale;if(Math.abs(l-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const e=this.width/this.height,t=this._viewer.container.getBoundingClientRect(),n=Math.floor(t.width*l),i=Math.floor(n/e);this.width=n,this.height=i,this._sizeChanged(!1)}async onAdded(l){await super.onAdded(l);const e=l.canvas.clientWidth,t=l.canvas.clientHeight,n=l.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,l.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",()=>this._sizeChanged(!0)),this._refresh()}async onRemove(l){return l.renderer.removeEventListener("resize",this._refresh),super.onRemove(l)}_refresh(){var l,e;(e=(l=this.uiConfig)==null?void 0:l.uiRefresh)==null||e.call(l,"postFrame",!0)}fromJSON(l,e){if(!l.mode)if(l.width||l.height){const t=this._viewer.container.getBoundingClientRect();l.width||(l.width=t.width),l.height||(l.height=t.height),l.scale&&(l.width*=l.scale,l.height*=l.scale,delete l.scale),l.width=Math.round(l.width),l.height=Math.round(l.height),l.mode="custom"}else l.mode="full";return super.fromJSON(l,e)}toJSON(l){const e=super.toJSON(l);return e.mode==="full"&&(delete e.width,delete e.height),e.mode==="custom"&&delete e.scale,e}};Yd.PluginType="RendererParamsUiPlugin",Yd.MaxCanvasScale=4,vb([ze("version")],Yd.prototype,"_serializeVersion",void 0),vb([ze(),ct("Mode",["full","custom"].map(l=>({label:l}))),(0,a.onChange2)(Z_.prototype._sizeChanged)],Yd.prototype,"mode",void 0),vb([ze(),Pe("Width",void 0,1,l=>({onChange:()=>l._sizeChanged(),hidden:()=>l.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=l._viewer)==null?void 0:e.container.getBoundingClientRect().width)||1024)+2))]}}))],Yd.prototype,"width",void 0),vb([ze(),Pe("Height",void 0,1,l=>({onChange:()=>l._sizeChanged(),hidden:()=>l.mode==="full",bounds:()=>{var e;return[10,Math.pow(2,Math.ceil(Math.log2(((e=l._viewer)==null?void 0:e.container.getBoundingClientRect().height)||1024)+2))]}}))],Yd.prototype,"height",void 0),vb([ze(),(0,a.onChange)(Z_.prototype._scaleChanged),Pe("Scale",[.25,Z_.MaxCanvasScale],.001,l=>({disabled:()=>l.mode==="custom"}))],Yd.prototype,"scale",void 0),Yd=Z_=vb([on("Renderer")],Yd);class Ox extends Ri{async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(e){var n;const t=super.toJSON(e);return t.activeCamera=(n=this._viewer)==null?void 0:n.scene.activeCamera.toJSON(),t}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)==null||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)==null||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)==null?void 0:e.scene.activeCamera.uiConfig)||{}}}Ox.PluginType="CameraUiPlugin";var xL={create:l=>{let e="button"+(l.type?" "+l.type:""),t=Kr.createDiv(e,l.text);return t.addEventListener("click",l.onClick),t}};let fh={createElement:(l,e,t,n)=>{let i=document.createElement(l);if(e&&(i.className=e),t&&(i.innerHTML=t),n)for(let o in n)i.setAttribute(o,n[o]);return i},createDiv:(l,e,t)=>fh.createElement("div",l,e,t),createDomTree:l=>{if(!l||!l.hasOwnProperty("dom"))return l;let e=l.dom;if(l.children)for(let t in l.children)l.children[t]&&e.appendChild(fh.createDomTree(l.children[t]));return e},removeElement:l=>{l!=null&&l.parentNode.removeChild(l)},appendToBody:l=>{document.body.appendChild(l)},makeIconHTML:l=>{let e="";return l=="ok"&&(e="#tick"),l=="error"&&(e="#cancel"),l=="info"&&(e="#info-button"),l=="caution"&&(e="#danger"),l=="min"&&(e="#line"),l=="close"&&(e="#close"),`<svg class="icon ${l}"><use xlink:href="${e}" /></svg>`},makeNftContent:l=>{let e=null;if(l.type){let t=null;t=typeof l.content=="string"?fh.createDiv("inner-content",l.content):fh.createDomTree({dom:fh.createDiv("inner-content"),children:[l.content]}),e=l.type=="text"?fh.createDomTree({dom:fh.createDiv("content text"),children:[t]}):fh.createDomTree({dom:fh.createDiv("content"),children:[fh.createDiv("state",fh.makeIconHTML(l.type)),t]})}else typeof l.content=="string"&&(e=fh.createDiv("content",l.content));return e},standardizeButtons:(l,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:l.close.bind(l,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:l.close.bind(l,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=l.close.bind(l,t[n].id));return t},makeButtons:l=>{let e=[];if(l)for(let t in l)e.push(xL.create({text:l[t].text?l[t].text:"OK",type:l[t].normal?null:"main",onClick:l[t].onClick}));return fh.createDomTree({dom:fh.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:l=>{let e=t=>{for(let n in l)if(l[n].key===t.keyCode)return void l[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:l=>{window.removeEventListener("keydown",l)}};var Kr=fh,Tl=__webpackgi_require__(476),du={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let Wf={};Wf.overlay_in=[new Tl.Frame(du["wwise-overlay-in-1"],0),new Tl.Frame(du["wwise-overlay-in-2"],400)],Wf.overlay_out=[new Tl.Frame(du["wwise-overlay-out-1"],300)],Wf.pop_in=[new Tl.Frame(du["wwise-pop-in-1"],0),new Tl.Frame(du["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new Tl.Frame(du["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new Tl.Frame(du["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],Wf.pop_out=[new Tl.Frame(du["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],Wf.flip_in=[new Tl.Frame(du["wwise-flip-in-1"],0),new Tl.Frame(du["wwise-flip-in-2"],500)],Wf.flip_out=[new Tl.Frame(du["wwise-flip-out-1"],400)],Wf.min_in=[new Tl.Frame(du["wwise-min-in-1"],0),new Tl.Frame(du["wwise-min-in-2"],350)],Wf.min_out=[new Tl.Frame(du["wwise-min-out-1"],400)];let qR=["top","bottom","left","right"];for(let l in qR){let e=qR[l];Wf[e+"_in"]=[new Tl.Frame(du["wwise-"+e+"-in-1"],0),new Tl.Frame(du["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],Wf[e+"_out"]=[new Tl.Frame(du["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var kE=Wf;let wL={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class LS{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let i=e.getElementsByClassName("content")[0];return i&&(i=i.innerHTML),Kr.removeElement(e),t.title=n,t.content=i,new LS(t)}constructor(e){this.options=JSON.parse(JSON.stringify(wL));for(let m in e)e[m]!=null&&(this.options[m]=e[m]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let m=document.getElementsByClassName("wwise-overlay");m.length?(this.overlay=m[0],this.hasOverlay=!0):(this.overlay=Kr.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let m=[];this.options.topbar.showMin&&(m.push(Kr.createDiv(null,Kr.makeIconHTML("min"))),m[m.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(m.push(Kr.createDiv(null,Kr.makeIconHTML("close"))),m[m.length-1].addEventListener("click",this.close.bind(this,void 0)));let y=null;y=typeof this.options.title=="string"?Kr.createDiv("title",this.options.title):Kr.createDomTree({dom:Kr.createDiv("title"),children:[this.options.title]}),this.topbar=Kr.createDomTree({dom:Kr.createDiv("topbar"),children:[{dom:Kr.createDiv("control"),children:m.map(w=>({dom:w}))},{dom:y},{dom:Kr.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=Kr.createDomTree({dom:Kr.createDiv(n,this.options.content)}):this.content=Kr.createDomTree({dom:Kr.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Kr.createDomTree({dom:Kr.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let i=Kr.createDiv("wwise-wrapper");this.options.zIndex&&(i.style.zIndex=this.options.zIndex),this.wrapper=Kr.createDomTree({dom:i,children:[this.window]}),this.dom=Kr.createDomTree({dom:Kr.createDiv(),children:[this.wrapper]});let o=this.options.position.split(" "),c=-50,f=-50;if(o[0]=="left"?(c=0,this.wrapper.classList.add("left")):o[0]=="right"?(c=-100,this.wrapper.classList.add("right")):o[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=o[0],o[1]=="top"?(f=0,this.wrapper.classList.add("top")):o[1]=="bottom"?(f=-100,this.wrapper.classList.add("bottom")):o[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${c}%, ${f}%)`,this.options.style)for(let m in this.options.style)this.window.style[m]=this.options.style[m];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new Tl.Queue(this.wrapper,kE[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new Tl.Queue(this.overlay,kE.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new Tl.Queue(this.wrapper,kE[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new Tl.Queue(this.overlay,kE.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Kr.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Kr.appendToBody(this.dom)}removeDoms(){Kr.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Kr.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),i=this.options.draggable,o=parseFloat(n.left),c=parseFloat(n.top);if(n.left.indexOf("%")!=-1){o=n.left,o=o.substr(0,o.length-1),o=parseInt(o);let f=window,m=document,y=m.documentElement,w=m.getElementsByTagName("body")[0];o=o*(f.innerWidth||y.clientWidth||w.clientWidth)/100}if(n.top.indexOf("%")!=-1){c=n.top,c=c.substr(0,c.length-1),c=parseInt(c);let f=window,m=document,y=m.documentElement,w=m.getElementsByTagName("body")[0];c=c*(f.innerHeight||y.clientHeight||w.clientHeight)/100}i!=1&&i!="horizontal"||(this.wrapper.style.left=o+t.x+"px"),i!=1&&i!="vertical"||(this.wrapper.style.top=c+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var EL=LS,NS=class{constructor(l){let e=this.options=l;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new EL(t)}constructContent(l){let e=Kr.createDiv("modal"),t=Kr.createDomTree({dom:Kr.createDiv("main "+l.type),children:[Kr.createDiv(null,Kr.makeIconHTML(l.type)),Kr.createDiv("title",l.title),Kr.createDiv("text",l.text)]});this.buttonArr=Kr.standardizeButtons(this,l);let n=Kr.makeButtons(this.buttonArr),i=null;l.content&&(i=typeof l.content=="string"?Kr.createDiv(null,l.content):l.content);let o=null;return n.innerHTML&&(o=Kr.createDomTree({dom:Kr.createDiv("operation "+l.type),children:[n]})),i||o||t.classList.add("no-op"),Kr.createDomTree({dom:e,children:[t,i,o]})}open(){if(this.wwise.opened)return;let l=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Kr.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),l}close(l){if(this.wwise.opened)return this.value=l,Kr.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let SL={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},ML={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var UE=__webpackgi_require__(513),Bx={};UE.Z&&UE.Z.locals&&(Bx.locals=UE.Z.locals);var kS,US=0,qy={};qy.styleTagTransform=Bf(),qy.setAttributes=kd(),qy.insert=function(l,e){(e.target||document.head).appendChild(l)},qy.domAPI=Df(),qy.insertStyleElement=io(),Bx.use=function(l){return qy.options=l||{},US++||(kS=ku()(UE.Z,qy)),Bx},Bx.unuse=function(){US>0&&!--US&&(kS(),kS=null)};var TL=Bx;class FS extends Ri{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Kr.appendToBody=t=>{e.container.appendChild(t)},Kr.makeIconHTML=t=>"",TL.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],i=new NS({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return i.open(),i.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],i=new NS({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return i.open(),await i.getPromise()==="yes"},e.prompt=async(t,n,i=!0)=>{const o=t==null?void 0:t.split(":")[0],c=new class{constructor(f){this.options=JSON.parse(JSON.stringify(SL));for(let S in f)f[S]!=null&&(this.options[S]=f[S]);let m=this.options,y=JSON.parse(JSON.stringify(ML));for(let S in y)m.hasOwnProperty(S)&&(y[S]=m[S]);let w=[];m.showCancel&&w.push({key:27,text:m.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),w.push({key:13,text:m.okText,onClick:this.handleOk.bind(this)}),y.buttons=w,this.input=Kr.createElement("input","input",null,{placeholder:m.placeholder}),this.error=Kr.createDiv("error"),y.content=Kr.createDomTree({dom:Kr.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new NS(y)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},f=>{this.error.innerText=f}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let f=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((m,y)=>{this.promiseResolve=m,this.promiseReject=y}),f}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:o??"&ndsp;",placeholder:n??"",showCancel:i,animation:"overlay",text:(t==null?void 0:t.replace(o||"","").replace(":",""))||""});return c.open(),await c.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}FS.PluginType="WindowiseDialogPlugin";class zS extends Ri{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>({label:"Shadow type",type:"dropdown",children:[["Basic",s._MY],["PCF",s._iA],["PCFSoft",Nt],["VSM",Qt]].map(e=>({label:e[0],value:e[1]})),getValue:()=>{var e;return(e=this._viewer)==null?void 0:e.renderer.rendererObject.shadowMap.type},setValue:e=>{var t;(t=this._viewer)==null||t.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=e,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var e;return{label:((e=this._viewer)!=null&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,a.setUrlQueryParam)("rgbm",(n=this._viewer)!=null&&n.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,a.setUrlQueryParam)("msaa",(n=this._viewer)!=null&&n.isAntialiased?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,a.setUrlQueryParam)("depthPrepass",(n=this._viewer)!=null&&n.useGBufferDepth?"no":"yes",!0)}}},()=>{var e;return{label:((e=this._viewer)!=null&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var t,n;await((t=this._viewer)==null?void 0:t.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&(0,a.setUrlQueryParam)("debug",(n=this._viewer)!=null&&n.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var e;await((e=this._viewer)==null?void 0:e.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var t,n;const e=(n=(t=this._viewer)==null?void 0:t.getPlugin(fi))==null?void 0:n.storage;if(e instanceof Storage)e.clear();else if(e instanceof Cache){const i=await e.keys();await Promise.all(i.map(async o=>e.delete(o)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var t;const e=new Set;(t=this._viewer)==null||t.scene.modelRoot.traverse(n=>n.geometry&&e.add(n.geometry)),e.forEach(n=>za(n))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var t;const e=new Set;(t=this._viewer)==null||t.scene.modelRoot.traverse(n=>n.geometry&&e.add(n.geometry)),e.forEach(n=>{const i=new s.Pa4;n.center(i),n.userData.__appliedMeshes.forEach(o=>{o.position.sub(i),o.setDirty&&o.setDirty()})})}}]}}}zS.PluginType="ExtrasUiPlugin1";var FE=__webpackgi_require__(729),Lx={};FE.Z&&FE.Z.locals&&(Lx.locals=FE.Z.locals);var jS,VS=0,Xy={};Xy.styleTagTransform=Bf(),Xy.setAttributes=kd(),Xy.insert=function(l,e){(e.target||document.head).appendChild(l)},Xy.domAPI=Df(),Xy.insertStyleElement=io(),Lx.use=function(l){return Xy.options=l||{},VS++||(jS=ku()(FE.Z,Xy)),Lx},Lx.unuse=function(){VS>0&&!--VS&&(jS(),jS=null)};var CL=Lx,zE=__webpackgi_require__(109),Nx={};zE.Z&&zE.Z.locals&&(Nx.locals=zE.Z.locals);var GS,HS=0,Yy={};Yy.styleTagTransform=Bf(),Yy.setAttributes=kd(),Yy.insert=function(l,e){(e.target||document.head).appendChild(l)},Yy.domAPI=Df(),Yy.insertStyleElement=io(),Nx.use=function(l){return Yy.options=l||{},HS++||(GS=ku()(zE.Z,Yy)),Nx},Nx.unuse=function(){HS>0&&!--HS&&(GS(),GS=null)};var RL=Nx;const WS=new TextEncoder,IL={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},PL=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class DL{constructor({accessKeyId:e,secretAccessKey:t,sessionToken:n,service:i,region:o,cache:c,retries:f,initRetryMs:m}){if(e==null)throw new TypeError("accessKeyId is a required option");if(t==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=e,this.secretAccessKey=t,this.sessionToken=n,this.service=i,this.region=o,this.cache=c||new Map,this.retries=f??10,this.initRetryMs=m||50}async sign(e,t){if(e instanceof Request){const{method:o,url:c,headers:f,body:m}=e;(t=Object.assign({method:o,url:c,headers:f},t)).body==null&&f.has("Content-Type")&&(t.body=m!=null&&f.has("X-Amz-Content-Sha256")?m:await e.clone().arrayBuffer()),e=c}const n=new OL(Object.assign({url:e},t,this,t&&t.aws)),i=Object.assign({},t,await n.sign());delete i.aws;try{return new Request(i.url.toString(),i)}catch(o){if(o instanceof TypeError)return new Request(i.url.toString(),Object.assign({duplex:"half"},i));throw o}}async fetch(e,t){for(let n=0;n<=this.retries;n++){const i=fetch(await this.sign(e,t));if(n===this.retries)return i;const o=await i;if(o.status<500&&o.status!==429)return o;await new Promise(c=>setTimeout(c,Math.random()*this.initRetryMs*Math.pow(2,n)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class OL{constructor({method:e,url:t,headers:n,body:i,accessKeyId:o,secretAccessKey:c,sessionToken:f,service:m,region:y,cache:w,datetime:S,signQuery:C,appendSessionToken:O,allHeaders:N,singleEncode:H}){if(t==null)throw new TypeError("url is a required option");if(o==null)throw new TypeError("accessKeyId is a required option");if(c==null)throw new TypeError("secretAccessKey is a required option");let q,J;this.method=e||(i?"POST":"GET"),this.url=new URL(t),this.headers=new Headers(n||{}),this.body=i,this.accessKeyId=o,this.secretAccessKey=c,this.sessionToken=f,m&&y||([q,J]=function(ue,me){const{hostname:Te,pathname:Be}=ue;if(Te.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(Te.endsWith(".backblazeb2.com")){const at=Te.match(/^(?:[^.]+\.)?s3\.([^.]+)\.backblazeb2\.com$/);return at!=null?["s3",at[1]]:["",""]}const He=Te.replace("dualstack.","").match(/([^.]+)\.(?:([^.]*)\.)?amazonaws\.com(?:\.cn)?$/);let[tt,lt]=(He||["",""]).slice(1,3);if(lt==="us-gov")lt="us-gov-west-1";else if(lt==="s3"||lt==="s3-accelerate")lt="us-east-1",tt="s3";else if(tt==="iot")tt=Te.startsWith("iot.")?"execute-api":Te.startsWith("data.jobs.iot.")?"iot-jobs-data":Be==="/mqtt"?"iotdevicegateway":"iotdata";else if(tt==="autoscaling"){const at=(me.get("X-Amz-Target")||"").split(".")[0];at==="AnyScaleFrontendService"?tt="application-autoscaling":at==="AnyScaleScalingPlannerFrontendService"&&(tt="autoscaling-plans")}else lt==null&&tt.startsWith("s3-")?(lt=tt.slice(3).replace(/^fips-|^external-1/,""),tt="s3"):tt.endsWith("-fips")?tt=tt.slice(0,-5):lt&&/-\d$/.test(tt)&&!/-\d$/.test(lt)&&([tt,lt]=[lt,tt]);return[IL[tt]||tt,lt]}(this.url,this.headers)),this.service=m||q||"",this.region=y||J||"us-east-1",this.cache=w||new Map,this.datetime=S||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=C,this.appendSessionToken=O||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const V=this.signQuery?this.url.searchParams:this.headers;if(V.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&V.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(ue=>N||!PL.has(ue)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(ue=>ue+":"+(ue==="host"?this.url.host:(this.headers.get(ue)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||V.has("X-Amz-Expires")||V.set("X-Amz-Expires","86400"),V.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),V.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),V.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");H||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=YR(this.encodedPath);const z=new Set;this.encodedSearch=[...this.url.searchParams].filter(([ue])=>{if(!ue)return!1;if(this.service==="s3"){if(z.has(ue))return!1;z.add(ue)}return!0}).map(ue=>ue.map(me=>YR(encodeURIComponent(me)))).sort(([ue,me],[Te,Be])=>ue<Te?-1:ue>Te?1:me<Be?-1:me>Be?1:0).map(ue=>ue.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const e=this.datetime.slice(0,8),t=[this.secretAccessKey,e,this.region,this.service].join();let n=this.cache.get(t);if(!n){const i=await kx("AWS4"+this.secretAccessKey,e),o=await kx(i,this.region),c=await kx(o,this.service);n=await kx(c,"aws4_request"),this.cache.set(t,n)}return QS(await kx(n,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,QS(await XR(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let e=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(e==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");e=QS(await XR(this.body||""))}return e}}async function kx(l,e){const t=await crypto.subtle.importKey("raw",typeof l=="string"?WS.encode(l):l,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",t,WS.encode(e))}async function XR(l){return crypto.subtle.digest("SHA-256",typeof l=="string"?WS.encode(l):l)}function QS(l){return Array.prototype.map.call(new Uint8Array(l),e=>("0"+e.toString(16)).slice(-2)).join("")}function YR(l){return l.replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}var Ky=function(l,e,t,n){var i,o=arguments.length,c=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(l,e,t,n);else for(var f=l.length-1;f>=0;f--)(i=l[f])&&(c=(o<3?i(c):o>3?i(e,t,c):i(e,t))||c);return o>3&&c&&Object.defineProperty(e,t,c),c};let Kd=class extends Ri{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[vx],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1}connect(){this._connected&&this.disconnect(),this._client=new DL({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var l,e;(e=(l=this.uiConfig)==null?void 0:l.uiRefresh)==null||e.call(l,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(l){return this.serializeSettings?super.toJSON(l):{type:this.constructor.PluginType}}async onAdded(l){await super.onAdded(l);const e=l.getPlugin(vx);e.actions.exportFile=async(t,n,i)=>{if(!this._connected)return void await e.defaultActions.exportFile(t,n);const o=(0,a.pathJoin)([this.endpointURL,this.pathPrefix,n]),c=await this._fetch(o,{method:"PUT",body:t},i);if(!c.ok)return l.console.error("Error uploading file",c),void await e.defaultActions.exportFile(t,n);this.dispatchEvent({type:"fileUpload",name:n,blob:t,response:c,path:o}),l.console.log("File uploaded",c)}}async _fetch(l,e,t){if(!this._client)throw new Error("Not connected");for(let n=0;n<=this._client.retries;n++){const i=fetch(await this._client.sign(l,e));if(n===this._client.retries)return i;const o=await i;if(o.status<500&&o.status!==429)return o;await(0,a.timeout)(Math.random()*this._client.initRetryMs*Math.pow(2,n))}throw new Error("An unknown error occurred, ensure retries is not negative")}};function KR(){CL.use(),RL.use()}async function $R(l,e={}){var N,H;d0.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>l.container});const t=(0,a.createDiv)({classList:["mode-buttons-container","button-bar"],addToBody:!0}),n=(0,a.createDiv)({innerHTML:"",id:"webgi-logo",addToBody:!1});(0,a.getUrlQueryParam)("logo-img")&&(n.style.backgroundImage=`url(${(0,a.getUrlQueryParam)("logo-img")})`),n.onclick=()=>{window.open((0,a.getUrlQueryParam)("logo-link")||"https://webgi.xyz","_blank")};const i=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;l.container.appendChild(n),d0(n,{placement:"right",content:"Powered by WebGi SDK"});const o=(0,a.createDiv)({innerHTML:i,id:"fsToggle",classList:["round-button"],addToBody:!1});o.dataset.tippyContent="Full-Screen",(N=l.getPlugin(ru))==null||N.addEventListener("enter",()=>{o.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,o.dataset.tippyContent="Exit Full-Screen"}),(H=l.getPlugin(ru))==null||H.addEventListener("exit",()=>{o.innerHTML=i,o.dataset.tippyContent="Full-Screen"}),o.onclick=()=>{var q;(q=l.getPlugin(ru))==null||q.toggle(l.container)},l.container.appendChild(o),d0(o,{placement:"left"});const c=(0,a.createDiv)({classList:["button-bar","util-buttons-container"],addToBody:!1});l.container.appendChild(c);const f=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var J;if(!await l.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const q=C.map(V=>l.getPlugin(V));for(const V of q)await((J=V==null?void 0:V.resetDefaults)==null?void 0:J.call(V))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await l.confirm("Clear scene: Are you sure you want to clear the scene?")&&l.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var q;await l.fitToView((q=l.getPlugin(us))==null?void 0:q.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{l.getPlugin(ks)&&(l.getPlugin(ks).viewLooping=!l.getPlugin(ks).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var q;(q=l.getPlugin(Ws))==null||q.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const q=l.scene.activeCamera.controls;q&&q.autoRotate!==void 0&&(q.autoRotate=!q.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const q=l.getPlugin(Cu);q?await q.downloadSnapshot():l.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const q=l.getPlugin(f0);q?await(q==null?void 0:q.downloadSceneGlb()):l.console.error("AssetExporterPlugin not added")}}];for(const q of f){const J=(0,a.createDiv)({innerHTML:q.icon,id:q.id,classList:["button-bar-button","util-button"],addToBody:!1});J.dataset.tippyContent=q.tooltip,J.onclick=()=>{q.toggle&&J.classList.toggle("button-bar-selected-box"),q.onclick()},c.appendChild(J)}AI(d0(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const m=l.getPlugin(us),y=[{title:"Viewer",plugins:[Yd,Ox,uf,of]},{title:"Picking",plugins:[Ix,us,Fs,Jm,Qp]},{title:"Scene",plugins:[Cx,Hd,Rx,Px,Dx,Nl,fl,Hp]},{title:"Anti-aliasing",plugins:[to,Dc,Um]},{title:"Post Processing",plugins:[pp,ex,Co,Og,lm,Yh,Ka,Vo,Go,mp,mm,ml]},{title:"Export",plugins:[f0,Cu,Ff,Kd]},{title:"Animations",plugins:[Ws,ks,Zl,E0,Ag]},{title:"Modifiers",plugins:[zf,rd,sd,Wp,rx,mx,Fl]},{title:"Configurators",plugins:[N_,L_,Bu,bx]},{title:"Plugins",plugins:[Na,ru,Ll,Zu,zl,Ec,dl,Lu,Uh,yl,Lc,lg]},{title:"Extras",plugins:[zS]}];for(const[q,J]of Object.entries(e)){const V=y.find(z=>z.title===q);V?V.plugins.push(...J):y.push({title:q,plugins:[...J]})}let w=y[2],S=[];const C=y.reduce((q,J)=>q.concat(J.plugins),[]);function O(q){var J;w=q,m&&(m.enabled=!0),S=[];for(const V of C){const z=l.getPlugin(V);if(!(z!=null&&z.uiConfig))continue;const ue=q.plugins.includes(V);(0,a.safeSetProperty)(z.uiConfig,"hidden",!ue,!0),ue&&S.push(z)}for(const V of y)(J=V.div)==null||J.classList[w!==V?"remove":"add"]("mode-button-selected","button-bar-selected");l.getPlugin(NE).refreshPluginsEnabled()}for(const q of y){const J=(0,a.createDiv)({innerHTML:q.title,classList:["mode-button","button-bar-button"]});J.onclick=()=>{O(q)},q.div=J,t.appendChild(J)}O(y[0]),m==null||m.addEventListener("selectedObjectChanged",()=>{m!=null&&m.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(w.title)&&O(y.find(q=>q.plugins.includes(us)))})}Kd.PluginType="AWSClientPlugin1",Ky([ze(),Ke("Access Key ID",l=>({disabled:()=>!l.enabled||l._connected}))],Kd.prototype,"accessKeyId",void 0),Ky([ze(),Ke("Access Key Secret",l=>({disabled:()=>!l.enabled||l._connected}))],Kd.prototype,"accessKeySecret",void 0),Ky([ze(),Ke("Endpoint URL",l=>({disabled:()=>!l.enabled||l._connected}))],Kd.prototype,"endpointURL",void 0),Ky([ze(),Ke("Path Prefix",l=>({disabled:()=>!l.enabled}))],Kd.prototype,"pathPrefix",void 0),Ky([ze(),Yn("Remember",l=>({disabled:()=>!l.enabled||l._connected}))],Kd.prototype,"serializeSettings",void 0),Ky([ht(void 0,l=>({label:()=>l._connected?"Disconnect":"Connect"}))],Kd.prototype,"toggleConnection",void 0),Kd=Ky([on("S3 Connection")],Kd);var BL=vi({defaultModifiers:[fn,hr,Bs,as]}),LL=__webpackgi_require__(388),NL=__webpackgi_require__.n(LL);function kL(l){const e=[];l.traverse(i=>{i.geometry&&e.push(i)});const t={},n={};e.forEach(i=>{if(!t[i.geometry.uuid]){const f=i.geometry.toJSON().data,m=f?NL()({a:f.attributes||{},b:f.index||[]}):"";t[i.geometry.uuid]=m}const o=t[i.geometry.uuid],c=n[o]??(n[o]=[]);c.includes(i)||c.push(i)}),Object.values(n).forEach(i=>{if(i.length<2)return;const o=i[0].geometry;i.forEach((c,f)=>{f<1||(c.geometry.dispose(),c.geometry=o)})})}const ev=new s.Pa4,$y=new s.Pa4,jE=new s.Pa4,qS=new s.Pa4,VE=new s.Pa4,yb=new s.Pa4;let XS=1;const UL=new s.Pa4(0,1,0);class FL extends Bn{constructor(e,t){super(e,t),this.throttleUpdate=60,this.targetOffset=new s.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),ev.copy(this.object.position).sub(this.target),XS=ev.length(),yb.copy(this.target);const t=e();return yb.sub(this.target),ev.copy(this.object.position).sub(this.target),XS/=ev.length(),this.target.add(yb),this.object.position.copy(this.target).add(ev),ev.normalize(),$y.crossVectors(UL,ev).normalize(),jE.crossVectors(ev,$y).normalize(),qS.crossVectors($y,jE).normalize().negate(),$y.length()>.1&&this.object.up.crossVectors(ev.clone().normalize(),$y),this.enablePan&&(VE.set(0,0,0).addScaledVector($y,yb.x).addScaledVector(jE,yb.y).addScaledVector(qS,yb.z),this.targetOffset.add(VE),this.targetOffset.multiplyScalar(1/XS)),VE.set(0,0,0).addScaledVector($y,-this.targetOffset.x).addScaledVector(jE,-this.targetOffset.y).addScaledVector(qS,-this.targetOffset.z),this.object.lookAt(VE.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class GE extends a.SimpleEventDispatcher{_setOptions(e){var t;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=GE.GetSupportedMimeTypes([],["h264"],!0)??GE.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!((t=this._options.mimeType)!=null&&t.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=i=>{var o;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const c=new Blob(this._currentRecording,{type:this._options.mimeType});(o=this._recordingCallback)==null||o.call(this,c)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=i=>{var o;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((o=this._recorder)==null||o.pause())},this._onresume=i=>{if(!this.stepMode)return;const o=()=>{var f;this._state==="recording"&&((f=this._recorder)==null||f.pause())},c=Math.min(this._resumeSyncTime-(0,a.now)(),0)+1e3/this._options.frameRate;c>0?(0,a.timeout)(c).then(o):o()},this._onpause=i=>{},this._ondataavailable=i=>{i.data&&i.data.size>0&&this._currentRecording.push(i.data)},this._onerror=i=>{this._state="error",this._console.error(i),this.dispatchEvent({type:"error",error:i}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30,stepMode:!1},this._setOptions(t||this._options)}isRecording(){return this._state==="recording"}start(){var t,n,i;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const e={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(t=e.mimeType)==null?void 0:t.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const o=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),c=(n=o.getVideoTracks())==null?void 0:n[0];this._track=c,this._recorder=new window.MediaRecorder(o,e),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(i=this._recorder)==null||i.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const c=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=c,this._state="recording",this._onstart({})}).catch(o=>{this._onerror({detail:o})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=(0,a.now)(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([i,o])=>await(await fetch(o)).blob())),n=[];for(let i=0;i<e.length;i++){const o=await this._imgDirectory.getFileHandle(e[i][0],{create:!0});n.push((0,a.writeFile)(o,t[i]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const i=["webm","ogg","mp4","x-matroska"].filter(f=>!e||e.length<1||e.includes(f)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(f=>!t||t.length<1||t.includes(f)),c=[];return i.forEach(f=>{const m=`video/${f}`;o.forEach(y=>{[`${m};codecs=${y}`,`${m};codecs:${y}`,`${m};codecs=${y.toUpperCase()}`,`${m};codecs:${y.toUpperCase()}`,`${m}`].forEach(w=>{MediaRecorder.isTypeSupported(w)&&c.push(w)})})}),n?c.length>0?c[0]:void 0:c}}class zL extends N0{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new s.cJO(1,0))}}function YS(l,e){const t=Array.from((l.access??"").split(".")),n=t.pop();let i=l.targetObject??e;if(!n||n.length===0)return{key:void 0,tar:i};if(i=(0,a.deepAccessObject)(t,i),i&&!(n in i))throw console.error("invalid key",n,i,e,l),"";return{key:n,tar:i}}function KS(l,e,t,n){const{key:i,tar:o}=YS(l,e);return i&&o?Ho(o,i,()=>{var c;t&&((c=l.updater)!=null&&c.length)&&l.updater.forEach(f=>t[f]()),n==null||n()}):c=>console.warn("Unable to set ",c,i,o,l,e)}async function HE(l,e,t){const{key:n,tar:i}=YS(e,l),o=e.animSet?[JR(i,e.animSet,t,e.animSetParallel??!1)]:[];if(n&&i){const c=e.updater??[],f=async()=>Nm(i,n,{...e,onUpdate:m=>{var y;(y=e.onUpdate)==null||y.call(e,m),c.forEach(w=>{var S;return(S=t[w])==null?void 0:S.call(t)})}});e.delay?o.push((0,a.timeout)(e.delay).then(f)):o.push(f())}else(e.duration||e.delay)&&o.push((0,a.timeout)((e.delay??0)+(e.duration??0)));return o.length===1?o[0]:Promise.all(o)}async function JR(l,e,t,n=!1){if(n)return Promise.all(e.map(async i=>HE(l,i,t)));for(const i of e)await HE(l,i,t)}function ZR(l,e,t,n){var c,f;if(!l)return;e||(e=[]);const i=n??{},o=l;for(let m=0,y=e.length;m<y;m++){const w=e[m];if(w.uiRef){const C=(o==null?void 0:o.indexOf(w.uiRef))??-1;C!==m&&(C>=0&&(o==null||o.splice(C,1)),o==null||o.splice(m,0,w.uiRef))}else{w.uiRef={type:"folder",label:w.name??"Animation "+m,children:[]};const C=[{type:"button",label:"animate",value:()=>{HE(t,w,i).then(()=>{var O;return console.log(((O=w.uiRef)==null?void 0:O.label)+" finished")})}}];w.access!==void 0&&C.push({type:"input",property:[w,"access"]}),w.from!==void 0&&C.push({type:w.uiObjectType??"input",property:[w,"from"],onChange:()=>{var O;KS(w,t)(w.from),(O=w.updater)==null||O.forEach(N=>N in i&&i[N]())}}),w.to!==void 0&&C.push({type:w.uiObjectType??"input",property:[w,"to"],onChange:()=>{var O;KS(w,t)(w.to),(O=w.updater)==null||O.forEach(N=>N in i&&i[N]())}}),w.duration!==void 0&&C.push({type:"input",property:[w,"duration"]}),w.animSet&&(w.animSetParallel||(w.animSetParallel=!1),C.push({type:"input",label:"run parallel",property:[w,"animSetParallel"]})),w.animSet&&C.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(c=w.uiRef.children)==null||c.push(...C),o==null||o.splice(m,0,w.uiRef)}const S=(f=w.uiRef.children)==null?void 0:f.map(C=>(0,a.getOrCall)(C)).flat(2).find(C=>C==null?void 0:C.animSetContainer);w.animSet&&S&&ZR(S.children,w.animSet,w.targetObject??t,n)}}const jL={Background:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(l=>({path:l}))}).assets,Environment:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(l=>({path:l}))}).assets,GemEnvironment:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(l=>({path:l}))}).assets,Ground:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(l=>({path:l}))}).assets,CameraViews:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(l=>({path:l}))}).assets,MaterialConfiguration:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(l=>({path:l}))}).assets,MaterialLibraries:new p0({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(l=>({path:l}))}).assets};function eI(l,e){return e?l*(1e3/e):0}function VL(l){var e,t=l.from,n=t===void 0?0:t,i=l.velocity,o=i===void 0?0:i,c=l.min,f=l.max,m=l.power,y=m===void 0?.8:m,w=l.timeConstant,S=w===void 0?750:w,C=l.bounceStiffness,O=C===void 0?500:C,N=l.bounceDamping,H=N===void 0?10:N,q=l.restDelta,J=q===void 0?1:q,V=l.modifyTarget,z=l.driver,ue=l.onUpdate,me=l.onComplete,Te=l.onStop;function Be(Bt){return c!==void 0&&Bt<c||f!==void 0&&Bt>f}function He(Bt){return c===void 0?f:f===void 0||Math.abs(c-Bt)<Math.abs(f-Bt)?c:f}function tt(Bt){e==null||e.stop(),e=Yr(lo(lo({},Bt),{driver:z,onUpdate:function(Ft){var _n;ue==null||ue(Ft),(_n=Bt.onUpdate)===null||_n===void 0||_n.call(Bt,Ft)},onComplete:me,onStop:Te}))}function lt(Bt){tt(lo({type:"spring",stiffness:O,damping:H,restDelta:J},Bt))}if(Be(n))lt({from:n,velocity:o,to:He(n)});else{var at=y*o+n;V!==void 0&&(at=V(at));var St,mt,gt=He(at),Ot=gt===c?-1:1;tt({type:"decay",from:n,velocity:o,timeConstant:S,power:y,restDelta:J,modifyTarget:V,onUpdate:Be(at)?function(Bt){St=mt,mt=Bt,o=eI(Bt-St,oh().delta),(Ot===1&&Bt>gt||Ot===-1&&Bt<gt)&&lt({from:Bt,to:gt,velocity:o})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var tI=function(l){return 180*l/Math.PI},GL=function(l,e){return e===void 0&&(e=Fv),tI(Math.atan2(e.y-l.y,e.x-l.x))},HL=function(l,e){var t=!0;return e===void 0&&(e=l,t=!1),function(n){return t?n-l+e:(l=n,t=!0,e)}},WL=function(l){return l},$S=function(l){return l===void 0&&(l=WL),function(e,t,n){var i=t-n,o=-(0-e+1)*(0-l(Math.abs(i)));return i<=0?t+o:t-o}},QL=$S(),qL=$S(Math.sqrt),nI=function(l){return l*Math.PI/180},WE=function(l){return l.hasOwnProperty("x")&&l.hasOwnProperty("y")},JS=function(l){return WE(l)&&l.hasOwnProperty("z")},QE=function(l,e){return Math.abs(l-e)};function XL(l,e){if(a_(l)&&a_(e))return QE(l,e);if(WE(l)&&WE(e)){var t=QE(l.x,e.x),n=QE(l.y,e.y),i=JS(l)&&JS(e)?QE(l.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(i,2))}}var YL=function(l,e,t){return e=nI(e),{x:t*Math.cos(e)+l.x,y:t*Math.sin(e)+l.y}},iI=function(l,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(l*e)/e},rI=function(l,e,t,n){return n===void 0&&(n=0),iI(l+t*(e-l)/Math.max(n,t))},KL=function(l){l===void 0&&(l=50);var e=0,t=0;return function(n){var i=oh().timestamp,o=i!==t?i-t:0,c=o?rI(e,n,o,l):e;return t=i,e=c,c}},$L=function(l){if(typeof l=="number")return function(n){return Math.round(n/l)*l};var e=0,t=l.length;return function(n){var i=Math.abs(l[0]-n);for(e=1;e<t;e++){var o=l[e],c=Math.abs(o-n);if(c===0)return o;if(c>i)return l[e-1];if(e===t-1)return o;i=c}}};function JL(l,e){return l/(1e3/e)}var ZL=function(l,e,t){var n=e-l;return((t-l)%n+n)%n+l},sI=function(l,e){return 1-3*e+3*l},oI=function(l,e){return 3*e-6*l},aI=function(l){return 3*l},qE=function(l,e,t){return((sI(e,t)*l+oI(e,t))*l+aI(e))*l},lI=function(l,e,t){return 3*sI(e,t)*l*l+2*oI(e,t)*l+aI(e)},eN=1e-7,tN=10,nN=8,iN=.001,XE=11,YE=1/(XE-1);function rN(l,e,t,n){if(l===e&&t===n)return $g;for(var i=new Float32Array(XE),o=0;o<XE;++o)i[o]=qE(o*YE,l,t);return function(c){return c===0||c===1?c:qE(function(f){for(var m=0,y=1,w=XE-1;y!==w&&i[y]<=f;++y)m+=YE;--y;var S=m+(f-i[y])/(i[y+1]-i[y])*YE,C=lI(S,l,t);return C>=iN?function(O,N,H,q){for(var J=0;J<nN;++J){var V=lI(N,H,q);if(V===0)return N;N-=(qE(N,H,q)-O)/V}return N}(f,S,l,t):C===0?S:function(O,N,H,q,J){var V,z,ue=0;do(V=qE(z=N+(H-N)/2,q,J)-O)>0?H=z:N=z;while(Math.abs(V)>eN&&++ue<tN);return z}(f,m,m+YE,l,t)}(c),e,n)}}var sN=function(l,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*l,i=e==="end"?Math.floor(n):Math.ceil(n);return Mm(0,1,i/l)}};class oN extends So{get editorInitialized(){return this._editorInitialized}constructor(e){super(e),this._editorInitialized=!1,KR()}async setupUi(e){await $R(this,e),this._editorInitialized=!0}}async function cI(l,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:o=!0,caching:c=!0}){l.enabled=!1,e&&await l.addPlugin(Fd),l.getPlugin(fi)||await l.addPlugin(fi,void 0,void 0,{storage:c&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await l.addPlugin(f0),await l.addPlugin(B1),await l.addPlugin(vx),o&&await l.addPlugin(Lc),await l.addPlugin(ms,!1),await l.addPlugin(FS),await l.addPlugin(kp),await l.addPlugin(D),await l.addPlugin(l1),await l.addPlugin(u1),await l.addPlugin(o1),await l.addPlugin(h1),await l.addPlugin(c1),await l.addPlugin(JA),await l.addPlugin(of),await l.addPlugin(Ag),await l.addPlugin(us,k0,!1,!0),await Jx(l,{ground:t,bloom:n,depthTonemap:i}),await l.addPlugin(ex),await l.addPlugin(Wp,!1),await l.addPlugin(dS),await l.addPlugin(mS),await l.addPlugin(gS),await l.addPlugin(lg,!1),await l.addPlugin(zf),await l.addPlugin(rd),await l.addPlugin(sd),await l.addPlugin(L_),await l.addPlugin(N_),await l.addPlugin(bx),await l.addPlugin(Jm),await l.addPlugin(Ff),await l.addPlugin(Cu),await l.addPlugin(Ix),await l.addPlugin(Rx),await l.addPlugin(Px),await l.addPlugin(Dx),await l.addPlugin(Yd),await l.addPlugin(Ox),await l.addPlugin(Cx),await l.addPlugin(Qp),await l.addPlugin(E0,l.container,!1),await l.addPlugin(Kd);const f=await l.addPlugin(new NE(!(0,a.mobileAndTabletCheck)()));return l.renderer.refreshPipeline(),l.scene.addEventListener("textureAdded",m=>{m.texture&&l.scene.setEnvironment(m.texture)}),f.setupPluginUi(ru),f.setupPluginUi(Yd),f.setupPluginUi(Ox),f.setupPluginUi(of),f.setupPluginUi(Cx),f.setupPluginUi(f0),f.setupPluginUi(Ws),f.setupPluginUi(Nl),f.setupPluginUi(N_),f.setupPluginUi(L_),f.setupPluginUi(Ag),f.setupPluginUi(Ix),f.setupPluginUi(Jm),f.setupPluginUi(Fs),f.setupPluginUi(us),t&&f.setupPluginUi(Hd),t&&f.setupPluginUi(Hp),f.setupPluginUi(Ka),f.setupPluginUi(ks),f.setupPluginUi(Ff),f.setupPluginUi(pp),f.setupPluginUi(ex),f.setupPluginUi(Og),f.setupPluginUi(lm),f.setupPluginUi(Co),f.setupPluginUi(Yh),f.setupPluginUi(mp),f.setupPluginUi(Vo),f.setupPluginUi(Uh),f.setupPluginUi(Lu),f.setupPluginUi(Rx),f.setupPluginUi(zf),f.setupPluginUi(rd),f.setupPluginUi(to),f.setupPluginUi(Px),f.setupPluginUi(Dx),f.setupPluginUi(Ec),f.setupPluginUi(dl),f.setupPluginUi(yl),n&&f.setupPluginUi(Go),f.setupPluginUi(Cu),f.setupPluginUi(Na),f.setupPluginUi(Dc),f.setupPluginUi(fl),f.setupPluginUi(mm),f.setupPluginUi(ml),f.setupPluginUi(sd),f.setupPluginUi(Zu),f.setupPluginUi(Um),f.setupPluginUi(uf),f.setupPluginUi(Bu),f.setupPluginUi(Ll),f.setupPluginUi(Wp),f.setupPluginUi(Lc),f.setupPluginUi(Zl),f.setupPluginUi(lg),f.setupPluginUi(Kd),f.setupPluginUi(E0),f.setupPluginUi(Qp),f.setupPluginUi(bx),f.setupPluginUi(Fl),l.enabled=!0,l}async function aN(l,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!1,importPopup:o=!0,caching:c=!0}){const f=new So(l);return await cI(f,{debug:e,ground:t,bloom:n,depthTonemap:i,importPopup:o,caching:c}),f}async function lN(l,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:i=!0,importPopup:o=!1,enableDrop:c=!1,caching:f=!0}={}){const m=new So(l);return e&&await m.addPlugin(Fd),m.getPlugin(fi)||m.addPluginSync(fi,void 0,void 0,{storage:f&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await m.addPlugin(ms,!0),await Jx(m,{ground:t,bloom:n,depthTonemap:i,enableDrop:c,importPopup:o}),m}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.GPz;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.Mp4;__webpackgi_exports__.QvI;__webpackgi_exports__.PrA;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.bBp;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.w7U;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.MMq;var __webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx;__webpackgi_exports__.Hmi;__webpackgi_exports__.X4S;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.Z_g;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__.N_j;__webpackgi_exports__.hNv;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.c0Q;__webpackgi_exports__.re0;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.ntt;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.n94;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.N1Y;__webpackgi_exports__.itK;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.hFL;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.izP;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.Dzq;__webpackgi_exports__.zCA;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.NKC;__webpackgi_exports__.jrv;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.SJj;__webpackgi_exports__.cF0;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;__webpackgi_exports__.s5b;__webpackgi_exports__.BHZ;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__.lth;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.OPJ;__webpackgi_exports__.PpQ;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.w_R;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.L1_;__webpackgi_exports__.blk;__webpackgi_exports__.YRm;__webpackgi_exports__.ejS;__webpackgi_exports__.wUb;__webpackgi_exports__.zOz;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.ZqF;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.CRe;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.oxT;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.mjX;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.eqi;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__.B2H;__webpackgi_exports__._Pm;__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.ZTh;__webpackgi_exports__.HdW;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.G_r;__webpackgi_exports__.N3F;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.lGU;__webpackgi_exports__.vuL;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.X6w;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.Rnn;__webpackgi_exports__.TyN;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.Jxm;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.Y4W;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.zG7;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.ub3;__webpackgi_exports__.OV;__webpackgi_exports__.G_n;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.t0w;__webpackgi_exports__.M7$;__webpackgi_exports__.ML4;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.v27;__webpackgi_exports__.Uk6;__webpackgi_exports__.H7Z;__webpackgi_exports__._sL;__webpackgi_exports__.czO;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.zC5;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.b5G;__webpackgi_exports__.UeO;__webpackgi_exports__.qCx;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.P39;__webpackgi_exports__.HI1;__webpackgi_exports__.ZYi;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.YQ8;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.Wz1;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.CN8;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Zj8;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.f1L;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.a95;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.JFD;__webpackgi_exports__.gw2;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.V4T;__webpackgi_exports__.H4P;__webpackgi_exports__.NLp;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.hiB;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.NN$;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.GGm;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.i8W;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__.N4A;__webpackgi_exports__.hjq;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.Kd3;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.pJq;__webpackgi_exports__.YPW;__webpackgi_exports__._tY;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.Rgz;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.Sy1;__webpackgi_exports__.Vs_;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.doP;__webpackgi_exports__.$jA;__webpackgi_exports__.T99;__webpackgi_exports__.LJS;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.NSm;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function defaultOnError(u){throw u}function defaultOnWarn(u){}function createCompilerError(u,a,s,v){const x=u,M=new SyntaxError(String(x));return M.code=u,M.loc=a,M}const FRAGMENT=Symbol(""),TELEPORT=Symbol(""),SUSPENSE=Symbol(""),KEEP_ALIVE=Symbol(""),BASE_TRANSITION=Symbol(""),OPEN_BLOCK=Symbol(""),CREATE_BLOCK=Symbol(""),CREATE_ELEMENT_BLOCK=Symbol(""),CREATE_VNODE=Symbol(""),CREATE_ELEMENT_VNODE=Symbol(""),CREATE_COMMENT=Symbol(""),CREATE_TEXT=Symbol(""),CREATE_STATIC=Symbol(""),RESOLVE_COMPONENT=Symbol(""),RESOLVE_DYNAMIC_COMPONENT=Symbol(""),RESOLVE_DIRECTIVE=Symbol(""),RESOLVE_FILTER=Symbol(""),WITH_DIRECTIVES=Symbol(""),RENDER_LIST=Symbol(""),RENDER_SLOT=Symbol(""),CREATE_SLOTS=Symbol(""),TO_DISPLAY_STRING=Symbol(""),MERGE_PROPS=Symbol(""),NORMALIZE_CLASS=Symbol(""),NORMALIZE_STYLE=Symbol(""),NORMALIZE_PROPS=Symbol(""),GUARD_REACTIVE_PROPS=Symbol(""),TO_HANDLERS=Symbol(""),CAMELIZE=Symbol(""),CAPITALIZE=Symbol(""),TO_HANDLER_KEY=Symbol(""),SET_BLOCK_TRACKING=Symbol(""),PUSH_SCOPE_ID=Symbol(""),POP_SCOPE_ID=Symbol(""),WITH_CTX=Symbol(""),UNREF=Symbol(""),IS_REF=Symbol(""),WITH_MEMO=Symbol(""),IS_MEMO_SAME=Symbol(""),helperNameMap={[FRAGMENT]:"Fragment",[TELEPORT]:"Teleport",[SUSPENSE]:"Suspense",[KEEP_ALIVE]:"KeepAlive",[BASE_TRANSITION]:"BaseTransition",[OPEN_BLOCK]:"openBlock",[CREATE_BLOCK]:"createBlock",[CREATE_ELEMENT_BLOCK]:"createElementBlock",[CREATE_VNODE]:"createVNode",[CREATE_ELEMENT_VNODE]:"createElementVNode",[CREATE_COMMENT]:"createCommentVNode",[CREATE_TEXT]:"createTextVNode",[CREATE_STATIC]:"createStaticVNode",[RESOLVE_COMPONENT]:"resolveComponent",[RESOLVE_DYNAMIC_COMPONENT]:"resolveDynamicComponent",[RESOLVE_DIRECTIVE]:"resolveDirective",[RESOLVE_FILTER]:"resolveFilter",[WITH_DIRECTIVES]:"withDirectives",[RENDER_LIST]:"renderList",[RENDER_SLOT]:"renderSlot",[CREATE_SLOTS]:"createSlots",[TO_DISPLAY_STRING]:"toDisplayString",[MERGE_PROPS]:"mergeProps",[NORMALIZE_CLASS]:"normalizeClass",[NORMALIZE_STYLE]:"normalizeStyle",[NORMALIZE_PROPS]:"normalizeProps",[GUARD_REACTIVE_PROPS]:"guardReactiveProps",[TO_HANDLERS]:"toHandlers",[CAMELIZE]:"camelize",[CAPITALIZE]:"capitalize",[TO_HANDLER_KEY]:"toHandlerKey",[SET_BLOCK_TRACKING]:"setBlockTracking",[PUSH_SCOPE_ID]:"pushScopeId",[POP_SCOPE_ID]:"popScopeId",[WITH_CTX]:"withCtx",[UNREF]:"unref",[IS_REF]:"isRef",[WITH_MEMO]:"withMemo",[IS_MEMO_SAME]:"isMemoSame"};function registerRuntimeHelpers(u){Object.getOwnPropertySymbols(u).forEach(a=>{helperNameMap[a]=u[a]})}const locStub={source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}};function createRoot(u,a=locStub){return{type:0,children:u,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:0,temps:0,codegenNode:void 0,loc:a}}function createVNodeCall(u,a,s,v,x,M,I,B=!1,U=!1,j=!1,te=locStub){return u&&(B?(u.helper(OPEN_BLOCK),u.helper(getVNodeBlockHelper(u.inSSR,j))):u.helper(getVNodeHelper(u.inSSR,j)),I&&u.helper(WITH_DIRECTIVES)),{type:13,tag:a,props:s,children:v,patchFlag:x,dynamicProps:M,directives:I,isBlock:B,disableTracking:U,isComponent:j,loc:te}}function createArrayExpression(u,a=locStub){return{type:17,loc:a,elements:u}}function createObjectExpression(u,a=locStub){return{type:15,loc:a,properties:u}}function createObjectProperty(u,a){return{type:16,loc:locStub,key:isString(u)?createSimpleExpression(u,!0):u,value:a}}function createSimpleExpression(u,a=!1,s=locStub,v=0){return{type:4,loc:s,content:u,isStatic:a,constType:a?3:v}}function createCompoundExpression(u,a=locStub){return{type:8,loc:a,children:u}}function createCallExpression(u,a=[],s=locStub){return{type:14,loc:s,callee:u,arguments:a}}function createFunctionExpression(u,a=void 0,s=!1,v=!1,x=locStub){return{type:18,params:u,returns:a,newline:s,isSlot:v,loc:x}}function createConditionalExpression(u,a,s,v=!0){return{type:19,test:u,consequent:a,alternate:s,newline:v,loc:locStub}}function createCacheExpression(u,a,s=!1){return{type:20,index:u,value:a,isVNode:s,loc:locStub}}function createBlockStatement(u){return{type:21,body:u,loc:locStub}}function getVNodeHelper(u,a){return u||a?CREATE_VNODE:CREATE_ELEMENT_VNODE}function getVNodeBlockHelper(u,a){return u||a?CREATE_BLOCK:CREATE_ELEMENT_BLOCK}function convertToBlock(u,{helper:a,removeHelper:s,inSSR:v}){u.isBlock||(u.isBlock=!0,s(getVNodeHelper(v,u.isComponent)),a(OPEN_BLOCK),a(getVNodeBlockHelper(v,u.isComponent)))}const isStaticExp=u=>u.type===4&&u.isStatic,isBuiltInType=(u,a)=>u===a||u===hyphenate(a);function isCoreComponent(u){if(isBuiltInType(u,"Teleport"))return TELEPORT;if(isBuiltInType(u,"Suspense"))return SUSPENSE;if(isBuiltInType(u,"KeepAlive"))return KEEP_ALIVE;if(isBuiltInType(u,"BaseTransition"))return BASE_TRANSITION}const nonIdentifierRE=/^\d|[^\$\w]/,isSimpleIdentifier=u=>!nonIdentifierRE.test(u),validFirstIdentCharRE=/[A-Za-z_$\xA0-\uFFFF]/,validIdentCharRE=/[\.\?\w$\xA0-\uFFFF]/,whitespaceRE=/\s+[.[]\s*|\s*[.[]\s+/g,isMemberExpressionBrowser=u=>{u=u.trim().replace(whitespaceRE,I=>I.trim());let a=0,s=[],v=0,x=0,M=null;for(let I=0;I<u.length;I++){const B=u.charAt(I);switch(a){case 0:if(B==="[")s.push(a),a=1,v++;else if(B==="(")s.push(a),a=2,x++;else if(!(I===0?validFirstIdentCharRE:validIdentCharRE).test(B))return!1;break;case 1:B==="'"||B==='"'||B==="`"?(s.push(a),a=3,M=B):B==="["?v++:B==="]"&&(--v||(a=s.pop()));break;case 2:if(B==="'"||B==='"'||B==="`")s.push(a),a=3,M=B;else if(B==="(")x++;else if(B===")"){if(I===u.length-1)return!1;--x||(a=s.pop())}break;case 3:B===M&&(a=s.pop(),M=null);break}}return!v&&!x},isMemberExpression=isMemberExpressionBrowser;function getInnerRange(u,a,s){const x={source:u.source.slice(a,a+s),start:advancePositionWithClone(u.start,u.source,a),end:u.end};return s!=null&&(x.end=advancePositionWithClone(u.start,u.source,a+s)),x}function advancePositionWithClone(u,a,s=a.length){return advancePositionWithMutation(extend({},u),a,s)}function advancePositionWithMutation(u,a,s=a.length){let v=0,x=-1;for(let M=0;M<s;M++)a.charCodeAt(M)===10&&(v++,x=M);return u.offset+=s,u.line+=v,u.column=x===-1?u.column+s:s-x,u}function findDir(u,a,s=!1){for(let v=0;v<u.props.length;v++){const x=u.props[v];if(x.type===7&&(s||x.exp)&&(isString(a)?x.name===a:a.test(x.name)))return x}}function findProp(u,a,s=!1,v=!1){for(let x=0;x<u.props.length;x++){const M=u.props[x];if(M.type===6){if(s)continue;if(M.name===a&&(M.value||v))return M}else if(M.name==="bind"&&(M.exp||v)&&isStaticArgOf(M.arg,a))return M}}function isStaticArgOf(u,a){return!!(u&&isStaticExp(u)&&u.content===a)}function hasDynamicKeyVBind(u){return u.props.some(a=>a.type===7&&a.name==="bind"&&(!a.arg||a.arg.type!==4||!a.arg.isStatic))}function isText$1(u){return u.type===5||u.type===2}function isVSlot(u){return u.type===7&&u.name==="slot"}function isTemplateNode(u){return u.type===1&&u.tagType===3}function isSlotOutlet(u){return u.type===1&&u.tagType===2}const propsHelperSet=new Set([NORMALIZE_PROPS,GUARD_REACTIVE_PROPS]);function getUnnormalizedProps(u,a=[]){if(u&&!isString(u)&&u.type===14){const s=u.callee;if(!isString(s)&&propsHelperSet.has(s))return getUnnormalizedProps(u.arguments[0],a.concat(u))}return[u,a]}function injectProp(u,a,s){let v,x=u.type===13?u.props:u.arguments[2],M=[],I;if(x&&!isString(x)&&x.type===14){const B=getUnnormalizedProps(x);x=B[0],M=B[1],I=M[M.length-1]}if(x==null||isString(x))v=createObjectExpression([a]);else if(x.type===14){const B=x.arguments[0];!isString(B)&&B.type===15?hasProp(a,B)||B.properties.unshift(a):x.callee===TO_HANDLERS?v=createCallExpression(s.helper(MERGE_PROPS),[createObjectExpression([a]),x]):x.arguments.unshift(createObjectExpression([a])),!v&&(v=x)}else x.type===15?(hasProp(a,x)||x.properties.unshift(a),v=x):(v=createCallExpression(s.helper(MERGE_PROPS),[createObjectExpression([a]),x]),I&&I.callee===GUARD_REACTIVE_PROPS&&(I=M[M.length-2]));u.type===13?I?I.arguments[0]=v:u.props=v:I?I.arguments[0]=v:u.arguments[2]=v}function hasProp(u,a){let s=!1;if(u.key.type===4){const v=u.key.content;s=a.properties.some(x=>x.key.type===4&&x.key.content===v)}return s}function toValidAssetId(u,a){return`_${a}_${u.replace(/[^\w]/g,(s,v)=>s==="-"?"_":u.charCodeAt(v).toString())}`}function getMemoedVNodeCall(u){return u.type===14&&u.callee===WITH_MEMO?u.arguments[1].returns:u}function getCompatValue(u,a){const s=a.options?a.options.compatConfig:a.compatConfig,v=s&&s[u];return u==="MODE"?v||3:v}function isCompatEnabled(u,a){const s=getCompatValue("MODE",a),v=getCompatValue(u,a);return s===3?v===!0:v!==!1}function checkCompatEnabled(u,a,s,...v){return isCompatEnabled(u,a)}const decodeRE=/&(gt|lt|amp|apos|quot);/g,decodeMap={gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},defaultParserOptions={delimiters:["{{","}}"],getNamespace:()=>0,getTextMode:()=>0,isVoidTag:NO,isPreTag:NO,isCustomElement:NO,decodeEntities:u=>u.replace(decodeRE,(a,s)=>decodeMap[s]),onError:defaultOnError,onWarn:defaultOnWarn,comments:!1};function baseParse(u,a={}){const s=createParserContext(u,a),v=getCursor(s);return createRoot(parseChildren(s,0,[]),getSelection(s,v))}function createParserContext(u,a){const s=extend({},defaultParserOptions);let v;for(v in a)s[v]=a[v]===void 0?defaultParserOptions[v]:a[v];return{options:s,column:1,line:1,offset:0,originalSource:u,source:u,inPre:!1,inVPre:!1,onWarn:s.onWarn}}function parseChildren(u,a,s){const v=last(s),x=v?v.ns:0,M=[];for(;!isEnd(u,a,s);){const B=u.source;let U;if(a===0||a===1){if(!u.inVPre&&startsWith(B,u.options.delimiters[0]))U=parseInterpolation(u,a);else if(a===0&&B[0]==="<")if(B.length===1)emitError(u,5,1);else if(B[1]==="!")startsWith(B,"<!--")?U=parseComment(u):startsWith(B,"<!DOCTYPE")?U=parseBogusComment(u):startsWith(B,"<![CDATA[")?x!==0?U=parseCDATA(u,s):(emitError(u,1),U=parseBogusComment(u)):(emitError(u,11),U=parseBogusComment(u));else if(B[1]==="/")if(B.length===2)emitError(u,5,2);else if(B[2]===">"){emitError(u,14,2),advanceBy(u,3);continue}else if(/[a-z]/i.test(B[2])){emitError(u,23),parseTag(u,TagType.End,v);continue}else emitError(u,12,2),U=parseBogusComment(u);else/[a-z]/i.test(B[1])?(U=parseElement(u,s),isCompatEnabled("COMPILER_NATIVE_TEMPLATE",u)&&U&&U.tag==="template"&&!U.props.some(j=>j.type===7&&isSpecialTemplateDirective(j.name))&&(U=U.children)):B[1]==="?"?(emitError(u,21,1),U=parseBogusComment(u)):emitError(u,12,1)}if(U||(U=parseText(u,a)),isArray(U))for(let j=0;j<U.length;j++)pushNode(M,U[j]);else pushNode(M,U)}let I=!1;if(a!==2&&a!==1){const B=u.options.whitespace!=="preserve";for(let U=0;U<M.length;U++){const j=M[U];if(j.type===2)if(u.inPre)j.content=j.content.replace(/\r\n/g,`
`);else if(/[^\t\r\n\f ]/.test(j.content))B&&(j.content=j.content.replace(/[\t\r\n\f ]+/g," "));else{const te=M[U-1],Z=M[U+1];!te||!Z||B&&(te.type===3&&Z.type===3||te.type===3&&Z.type===1||te.type===1&&Z.type===3||te.type===1&&Z.type===1&&/[\r\n]/.test(j.content))?(I=!0,M[U]=null):j.content=" "}else j.type===3&&!u.options.comments&&(I=!0,M[U]=null)}if(u.inPre&&v&&u.options.isPreTag(v.tag)){const U=M[0];U&&U.type===2&&(U.content=U.content.replace(/^\r?\n/,""))}}return I?M.filter(Boolean):M}function pushNode(u,a){if(a.type===2){const s=last(u);if(s&&s.type===2&&s.loc.end.offset===a.loc.start.offset){s.content+=a.content,s.loc.end=a.loc.end,s.loc.source+=a.loc.source;return}}u.push(a)}function parseCDATA(u,a){advanceBy(u,9);const s=parseChildren(u,3,a);return u.source.length===0?emitError(u,6):advanceBy(u,3),s}function parseComment(u){const a=getCursor(u);let s;const v=/--(\!)?>/.exec(u.source);if(!v)s=u.source.slice(4),advanceBy(u,u.source.length),emitError(u,7);else{v.index<=3&&emitError(u,0),v[1]&&emitError(u,10),s=u.source.slice(4,v.index);const x=u.source.slice(0,v.index);let M=1,I=0;for(;(I=x.indexOf("<!--",M))!==-1;)advanceBy(u,I-M+1),I+4<x.length&&emitError(u,16),M=I+1;advanceBy(u,v.index+v[0].length-M+1)}return{type:3,content:s,loc:getSelection(u,a)}}function parseBogusComment(u){const a=getCursor(u),s=u.source[1]==="?"?1:2;let v;const x=u.source.indexOf(">");return x===-1?(v=u.source.slice(s),advanceBy(u,u.source.length)):(v=u.source.slice(s,x),advanceBy(u,x+1)),{type:3,content:v,loc:getSelection(u,a)}}function parseElement(u,a){const s=u.inPre,v=u.inVPre,x=last(a),M=parseTag(u,TagType.Start,x),I=u.inPre&&!s,B=u.inVPre&&!v;if(M.isSelfClosing||u.options.isVoidTag(M.tag))return I&&(u.inPre=!1),B&&(u.inVPre=!1),M;a.push(M);const U=u.options.getTextMode(M,x),j=parseChildren(u,U,a);a.pop();{const te=M.props.find(Z=>Z.type===6&&Z.name==="inline-template");if(te&&checkCompatEnabled("COMPILER_INLINE_TEMPLATE",u,te.loc)){const Z=getSelection(u,M.loc.end);te.value={type:2,content:Z.source,loc:Z}}}if(M.children=j,startsWithEndTagOpen(u.source,M.tag))parseTag(u,TagType.End,x);else if(emitError(u,24,0,M.loc.start),u.source.length===0&&M.tag.toLowerCase()==="script"){const te=j[0];te&&startsWith(te.loc.source,"<!--")&&emitError(u,8)}return M.loc=getSelection(u,M.loc.start),I&&(u.inPre=!1),B&&(u.inVPre=!1),M}var TagType=(u=>(u[u.Start=0]="Start",u[u.End=1]="End",u))(TagType||{});const isSpecialTemplateDirective=makeMap("if,else,else-if,for,slot");function parseTag(u,a,s){const v=getCursor(u),x=/^<\/?([a-z][^\t\r\n\f />]*)/i.exec(u.source),M=x[1],I=u.options.getNamespace(M,s);advanceBy(u,x[0].length),advanceSpaces(u);const B=getCursor(u),U=u.source;u.options.isPreTag(M)&&(u.inPre=!0);let j=parseAttributes(u,a);a===0&&!u.inVPre&&j.some(oe=>oe.type===7&&oe.name==="pre")&&(u.inVPre=!0,extend(u,B),u.source=U,j=parseAttributes(u,a).filter(oe=>oe.name!=="v-pre"));let te=!1;if(u.source.length===0?emitError(u,9):(te=startsWith(u.source,"/>"),a===1&&te&&emitError(u,4),advanceBy(u,te?2:1)),a===1)return;let Z=0;return u.inVPre||(M==="slot"?Z=2:M==="template"?j.some(oe=>oe.type===7&&isSpecialTemplateDirective(oe.name))&&(Z=3):isComponent(M,j,u)&&(Z=1)),{type:1,ns:I,tag:M,tagType:Z,props:j,isSelfClosing:te,children:[],loc:getSelection(u,v),codegenNode:void 0}}function isComponent(u,a,s){const v=s.options;if(v.isCustomElement(u))return!1;if(u==="component"||/^[A-Z]/.test(u)||isCoreComponent(u)||v.isBuiltInComponent&&v.isBuiltInComponent(u)||v.isNativeTag&&!v.isNativeTag(u))return!0;for(let x=0;x<a.length;x++){const M=a[x];if(M.type===6){if(M.name==="is"&&M.value){if(M.value.content.startsWith("vue:"))return!0;if(checkCompatEnabled("COMPILER_IS_ON_ELEMENT",s,M.loc))return!0}}else{if(M.name==="is")return!0;if(M.name==="bind"&&isStaticArgOf(M.arg,"is")&&checkCompatEnabled("COMPILER_IS_ON_ELEMENT",s,M.loc))return!0}}}function parseAttributes(u,a){const s=[],v=new Set;for(;u.source.length>0&&!startsWith(u.source,">")&&!startsWith(u.source,"/>");){if(startsWith(u.source,"/")){emitError(u,22),advanceBy(u,1),advanceSpaces(u);continue}a===1&&emitError(u,3);const x=parseAttribute(u,v);x.type===6&&x.value&&x.name==="class"&&(x.value.content=x.value.content.replace(/\s+/g," ").trim()),a===0&&s.push(x),/^[^\t\r\n\f />]/.test(u.source)&&emitError(u,15),advanceSpaces(u)}return s}function parseAttribute(u,a){var s;const v=getCursor(u),M=/^[^\t\r\n\f />][^\t\r\n\f />=]*/.exec(u.source)[0];a.has(M)&&emitError(u,2),a.add(M),M[0]==="="&&emitError(u,19);{const U=/["'<]/g;let j;for(;j=U.exec(M);)emitError(u,17,j.index)}advanceBy(u,M.length);let I;/^[\t\r\n\f ]*=/.test(u.source)&&(advanceSpaces(u),advanceBy(u,1),advanceSpaces(u),I=parseAttributeValue(u),I||emitError(u,13));const B=getSelection(u,v);if(!u.inVPre&&/^(v-[A-Za-z0-9-]|:|\.|@|#)/.test(M)){const U=/(?:^v-([a-z0-9-]+))?(?:(?::|^\.|^@|^#)(\[[^\]]+\]|[^\.]+))?(.+)?$/i.exec(M);let j=startsWith(M,"."),te=U[1]||(j||startsWith(M,":")?"bind":startsWith(M,"@")?"on":"slot"),Z;if(U[2]){const le=te==="slot",se=M.lastIndexOf(U[2],M.length-(((s=U[3])==null?void 0:s.length)||0)),ve=getSelection(u,getNewPosition(u,v,se),getNewPosition(u,v,se+U[2].length+(le&&U[3]||"").length));let ce=U[2],K=!0;ce.startsWith("[")?(K=!1,ce.endsWith("]")?ce=ce.slice(1,ce.length-1):(emitError(u,27),ce=ce.slice(1))):le&&(ce+=U[3]||""),Z={type:4,content:ce,isStatic:K,constType:K?3:0,loc:ve}}if(I&&I.isQuoted){const le=I.loc;le.start.offset++,le.start.column++,le.end=advancePositionWithClone(le.start,I.content),le.source=le.source.slice(1,-1)}const oe=U[3]?U[3].slice(1).split("."):[];return j&&oe.push("prop"),te==="bind"&&Z&&oe.includes("sync")&&checkCompatEnabled("COMPILER_V_BIND_SYNC",u,B,Z.loc.source)&&(te="model",oe.splice(oe.indexOf("sync"),1)),{type:7,name:te,exp:I&&{type:4,content:I.content,isStatic:!1,constType:0,loc:I.loc},arg:Z,modifiers:oe,loc:B}}return!u.inVPre&&startsWith(M,"v-")&&emitError(u,26),{type:6,name:M,value:I&&{type:2,content:I.content,loc:I.loc},loc:B}}function parseAttributeValue(u){const a=getCursor(u);let s;const v=u.source[0],x=v==='"'||v==="'";if(x){advanceBy(u,1);const M=u.source.indexOf(v);M===-1?s=parseTextData(u,u.source.length,4):(s=parseTextData(u,M,4),advanceBy(u,1))}else{const M=/^[^\t\r\n\f >]+/.exec(u.source);if(!M)return;const I=/["'<=`]/g;let B;for(;B=I.exec(M[0]);)emitError(u,18,B.index);s=parseTextData(u,M[0].length,4)}return{content:s,isQuoted:x,loc:getSelection(u,a)}}function parseInterpolation(u,a){const[s,v]=u.options.delimiters,x=u.source.indexOf(v,s.length);if(x===-1){emitError(u,25);return}const M=getCursor(u);advanceBy(u,s.length);const I=getCursor(u),B=getCursor(u),U=x-s.length,j=u.source.slice(0,U),te=parseTextData(u,U,a),Z=te.trim(),oe=te.indexOf(Z);oe>0&&advancePositionWithMutation(I,j,oe);const le=U-(te.length-Z.length-oe);return advancePositionWithMutation(B,j,le),advanceBy(u,v.length),{type:5,content:{type:4,isStatic:!1,constType:0,content:Z,loc:getSelection(u,I,B)},loc:getSelection(u,M)}}function parseText(u,a){const s=a===3?["]]>"]:["<",u.options.delimiters[0]];let v=u.source.length;for(let I=0;I<s.length;I++){const B=u.source.indexOf(s[I],1);B!==-1&&v>B&&(v=B)}const x=getCursor(u);return{type:2,content:parseTextData(u,v,a),loc:getSelection(u,x)}}function parseTextData(u,a,s){const v=u.source.slice(0,a);return advanceBy(u,a),s===2||s===3||!v.includes("&")?v:u.options.decodeEntities(v,s===4)}function getCursor(u){const{column:a,line:s,offset:v}=u;return{column:a,line:s,offset:v}}function getSelection(u,a,s){return s=s||getCursor(u),{start:a,end:s,source:u.originalSource.slice(a.offset,s.offset)}}function last(u){return u[u.length-1]}function startsWith(u,a){return u.startsWith(a)}function advanceBy(u,a){const{source:s}=u;advancePositionWithMutation(u,s,a),u.source=s.slice(a)}function advanceSpaces(u){const a=/^[\t\r\n\f ]+/.exec(u.source);a&&advanceBy(u,a[0].length)}function getNewPosition(u,a,s){return advancePositionWithClone(a,u.originalSource.slice(a.offset,s),s)}function emitError(u,a,s,v=getCursor(u)){s&&(v.offset+=s,v.column+=s),u.options.onError(createCompilerError(a,{start:v,end:v,source:""}))}function isEnd(u,a,s){const v=u.source;switch(a){case 0:if(startsWith(v,"</")){for(let x=s.length-1;x>=0;--x)if(startsWithEndTagOpen(v,s[x].tag))return!0}break;case 1:case 2:{const x=last(s);if(x&&startsWithEndTagOpen(v,x.tag))return!0;break}case 3:if(startsWith(v,"]]>"))return!0;break}return!v}function startsWithEndTagOpen(u,a){return startsWith(u,"</")&&u.slice(2,2+a.length).toLowerCase()===a.toLowerCase()&&/[\t\r\n\f />]/.test(u[2+a.length]||">")}function hoistStatic(u,a){walk(u,a,isSingleElementRoot(u,u.children[0]))}function isSingleElementRoot(u,a){const{children:s}=u;return s.length===1&&a.type===1&&!isSlotOutlet(a)}function walk(u,a,s=!1){const{children:v}=u,x=v.length;let M=0;for(let I=0;I<v.length;I++){const B=v[I];if(B.type===1&&B.tagType===0){const U=s?0:getConstantType(B,a);if(U>0){if(U>=2){B.codegenNode.patchFlag="-1",B.codegenNode=a.hoist(B.codegenNode),M++;continue}}else{const j=B.codegenNode;if(j.type===13){const te=getPatchFlag(j);if((!te||te===512||te===1)&&getGeneratedPropsConstantType(B,a)>=2){const Z=getNodeProps(B);Z&&(j.props=a.hoist(Z))}j.dynamicProps&&(j.dynamicProps=a.hoist(j.dynamicProps))}}}if(B.type===1){const U=B.tagType===1;U&&a.scopes.vSlot++,walk(B,a),U&&a.scopes.vSlot--}else if(B.type===11)walk(B,a,B.children.length===1);else if(B.type===9)for(let U=0;U<B.branches.length;U++)walk(B.branches[U],a,B.branches[U].children.length===1)}M&&a.transformHoist&&a.transformHoist(v,a,u),M&&M===x&&u.type===1&&u.tagType===0&&u.codegenNode&&u.codegenNode.type===13&&isArray(u.codegenNode.children)&&(u.codegenNode.children=a.hoist(createArrayExpression(u.codegenNode.children)))}function getConstantType(u,a){const{constantCache:s}=a;switch(u.type){case 1:if(u.tagType!==0)return 0;const v=s.get(u);if(v!==void 0)return v;const x=u.codegenNode;if(x.type!==13||x.isBlock&&u.tag!=="svg"&&u.tag!=="foreignObject")return 0;if(getPatchFlag(x))return s.set(u,0),0;{let B=3;const U=getGeneratedPropsConstantType(u,a);if(U===0)return s.set(u,0),0;U<B&&(B=U);for(let j=0;j<u.children.length;j++){const te=getConstantType(u.children[j],a);if(te===0)return s.set(u,0),0;te<B&&(B=te)}if(B>1)for(let j=0;j<u.props.length;j++){const te=u.props[j];if(te.type===7&&te.name==="bind"&&te.exp){const Z=getConstantType(te.exp,a);if(Z===0)return s.set(u,0),0;Z<B&&(B=Z)}}if(x.isBlock){for(let j=0;j<u.props.length;j++)if(u.props[j].type===7)return s.set(u,0),0;a.removeHelper(OPEN_BLOCK),a.removeHelper(getVNodeBlockHelper(a.inSSR,x.isComponent)),x.isBlock=!1,a.helper(getVNodeHelper(a.inSSR,x.isComponent))}return s.set(u,B),B}case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return getConstantType(u.content,a);case 4:return u.constType;case 8:let I=3;for(let B=0;B<u.children.length;B++){const U=u.children[B];if(isString(U)||isSymbol(U))continue;const j=getConstantType(U,a);if(j===0)return 0;j<I&&(I=j)}return I;default:return 0}}const allowHoistedHelperSet=new Set([NORMALIZE_CLASS,NORMALIZE_STYLE,NORMALIZE_PROPS,GUARD_REACTIVE_PROPS]);function getConstantTypeOfHelperCall(u,a){if(u.type===14&&!isString(u.callee)&&allowHoistedHelperSet.has(u.callee)){const s=u.arguments[0];if(s.type===4)return getConstantType(s,a);if(s.type===14)return getConstantTypeOfHelperCall(s,a)}return 0}function getGeneratedPropsConstantType(u,a){let s=3;const v=getNodeProps(u);if(v&&v.type===15){const{properties:x}=v;for(let M=0;M<x.length;M++){const{key:I,value:B}=x[M],U=getConstantType(I,a);if(U===0)return U;U<s&&(s=U);let j;if(B.type===4?j=getConstantType(B,a):B.type===14?j=getConstantTypeOfHelperCall(B,a):j=0,j===0)return j;j<s&&(s=j)}}return s}function getNodeProps(u){const a=u.codegenNode;if(a.type===13)return a.props}function getPatchFlag(u){const a=u.patchFlag;return a?parseInt(a,10):void 0}function createTransformContext(u,{filename:a="",prefixIdentifiers:s=!1,hoistStatic:v=!1,cacheHandlers:x=!1,nodeTransforms:M=[],directiveTransforms:I={},transformHoist:B=null,isBuiltInComponent:U=NOOP,isCustomElement:j=NOOP,expressionPlugins:te=[],scopeId:Z=null,slotted:oe=!0,ssr:le=!1,inSSR:se=!1,ssrCssVars:ve="",bindingMetadata:ce=EMPTY_OBJ,inline:K=!1,isTS:X=!1,onError:W=defaultOnError,onWarn:_e=defaultOnWarn,compatConfig:ge}){const Ae=a.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),ee={selfName:Ae&&capitalize(camelize(Ae[1])),prefixIdentifiers:s,hoistStatic:v,cacheHandlers:x,nodeTransforms:M,directiveTransforms:I,transformHoist:B,isBuiltInComponent:U,isCustomElement:j,expressionPlugins:te,scopeId:Z,slotted:oe,ssr:le,inSSR:se,ssrCssVars:ve,bindingMetadata:ce,inline:K,isTS:X,onError:W,onWarn:_e,compatConfig:ge,root:u,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],constantCache:new Map,temps:0,cached:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,currentNode:u,childIndex:0,inVOnce:!1,helper($){const ae=ee.helpers.get($)||0;return ee.helpers.set($,ae+1),$},removeHelper($){const ae=ee.helpers.get($);if(ae){const Re=ae-1;Re?ee.helpers.set($,Re):ee.helpers.delete($)}},helperString($){return`_${helperNameMap[ee.helper($)]}`},replaceNode($){ee.parent.children[ee.childIndex]=ee.currentNode=$},removeNode($){const ae=ee.parent.children,Re=$?ae.indexOf($):ee.currentNode?ee.childIndex:-1;!$||$===ee.currentNode?(ee.currentNode=null,ee.onNodeRemoved()):ee.childIndex>Re&&(ee.childIndex--,ee.onNodeRemoved()),ee.parent.children.splice(Re,1)},onNodeRemoved:()=>{},addIdentifiers($){},removeIdentifiers($){},hoist($){isString($)&&($=createSimpleExpression($)),ee.hoists.push($);const ae=createSimpleExpression(`_hoisted_${ee.hoists.length}`,!1,$.loc,2);return ae.hoisted=$,ae},cache($,ae=!1){return createCacheExpression(ee.cached++,$,ae)}};return ee.filters=new Set,ee}function transform(u,a){const s=createTransformContext(u,a);traverseNode(u,s),a.hoistStatic&&hoistStatic(u,s),a.ssr||createRootCodegen(u,s),u.helpers=new Set([...s.helpers.keys()]),u.components=[...s.components],u.directives=[...s.directives],u.imports=s.imports,u.hoists=s.hoists,u.temps=s.temps,u.cached=s.cached,u.filters=[...s.filters]}function createRootCodegen(u,a){const{helper:s}=a,{children:v}=u;if(v.length===1){const x=v[0];if(isSingleElementRoot(u,x)&&x.codegenNode){const M=x.codegenNode;M.type===13&&convertToBlock(M,a),u.codegenNode=M}else u.codegenNode=x}else if(v.length>1){let x=64;u.codegenNode=createVNodeCall(a,s(FRAGMENT),void 0,u.children,x+"",void 0,void 0,!0,void 0,!1)}}function traverseChildren(u,a){let s=0;const v=()=>{s--};for(;s<u.children.length;s++){const x=u.children[s];isString(x)||(a.parent=u,a.childIndex=s,a.onNodeRemoved=v,traverseNode(x,a))}}function traverseNode(u,a){a.currentNode=u;const{nodeTransforms:s}=a,v=[];for(let M=0;M<s.length;M++){const I=s[M](u,a);if(I&&(isArray(I)?v.push(...I):v.push(I)),a.currentNode)u=a.currentNode;else return}switch(u.type){case 3:a.ssr||a.helper(CREATE_COMMENT);break;case 5:a.ssr||a.helper(TO_DISPLAY_STRING);break;case 9:for(let M=0;M<u.branches.length;M++)traverseNode(u.branches[M],a);break;case 10:case 11:case 1:case 0:traverseChildren(u,a);break}a.currentNode=u;let x=v.length;for(;x--;)v[x]()}function createStructuralDirectiveTransform(u,a){const s=isString(u)?v=>v===u:v=>u.test(v);return(v,x)=>{if(v.type===1){const{props:M}=v;if(v.tagType===3&&M.some(isVSlot))return;const I=[];for(let B=0;B<M.length;B++){const U=M[B];if(U.type===7&&s(U.name)){M.splice(B,1),B--;const j=a(v,U,x);j&&I.push(j)}}return I}}}const PURE_ANNOTATION="/*#__PURE__*/",aliasHelper=u=>`${helperNameMap[u]}: _${helperNameMap[u]}`;function createCodegenContext(u,{mode:a="function",prefixIdentifiers:s=a==="module",sourceMap:v=!1,filename:x="template.vue.html",scopeId:M=null,optimizeImports:I=!1,runtimeGlobalName:B="Vue",runtimeModuleName:U="vue",ssrRuntimeModuleName:j="vue/server-renderer",ssr:te=!1,isTS:Z=!1,inSSR:oe=!1}){const le={mode:a,prefixIdentifiers:s,sourceMap:v,filename:x,scopeId:M,optimizeImports:I,runtimeGlobalName:B,runtimeModuleName:U,ssrRuntimeModuleName:j,ssr:te,isTS:Z,inSSR:oe,source:u.loc.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(ve){return`_${helperNameMap[ve]}`},push(ve,ce){le.code+=ve},indent(){se(++le.indentLevel)},deindent(ve=!1){ve?--le.indentLevel:se(--le.indentLevel)},newline(){se(le.indentLevel)}};function se(ve){le.push(`
`+"  ".repeat(ve))}return le}function generate(u,a={}){const s=createCodegenContext(u,a);a.onContextCreated&&a.onContextCreated(s);const{mode:v,push:x,prefixIdentifiers:M,indent:I,deindent:B,newline:U,scopeId:j,ssr:te}=s,Z=Array.from(u.helpers),oe=Z.length>0,le=!M&&v!=="module",se=!1,ve=se?createCodegenContext(u,a):s;genFunctionPreamble(u,ve);const ce=te?"ssrRender":"render",X=(te?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(x(`function ${ce}(${X}) {`),I(),le&&(x("with (_ctx) {"),I(),oe&&(x(`const { ${Z.map(aliasHelper).join(", ")} } = _Vue`),x(`
`),U())),u.components.length&&(genAssets(u.components,"component",s),(u.directives.length||u.temps>0)&&U()),u.directives.length&&(genAssets(u.directives,"directive",s),u.temps>0&&U()),u.filters&&u.filters.length&&(U(),genAssets(u.filters,"filter",s),U()),u.temps>0){x("let ");for(let W=0;W<u.temps;W++)x(`${W>0?", ":""}_temp${W}`)}return(u.components.length||u.directives.length||u.temps)&&(x(`
`),U()),te||x("return "),u.codegenNode?genNode(u.codegenNode,s):x("null"),le&&(B(),x("}")),B(),x("}"),{ast:u,code:s.code,preamble:se?ve.code:"",map:s.map?s.map.toJSON():void 0}}function genFunctionPreamble(u,a){const{ssr:s,prefixIdentifiers:v,push:x,newline:M,runtimeModuleName:I,runtimeGlobalName:B,ssrRuntimeModuleName:U}=a,j=B,te=Array.from(u.helpers);if(te.length>0&&(x(`const _Vue = ${j}
`),u.hoists.length)){const Z=[CREATE_VNODE,CREATE_ELEMENT_VNODE,CREATE_COMMENT,CREATE_TEXT,CREATE_STATIC].filter(oe=>te.includes(oe)).map(aliasHelper).join(", ");x(`const { ${Z} } = _Vue
`)}genHoists(u.hoists,a),M(),x("return ")}function genAssets(u,a,{helper:s,push:v,newline:x,isTS:M}){const I=s(a==="filter"?RESOLVE_FILTER:a==="component"?RESOLVE_COMPONENT:RESOLVE_DIRECTIVE);for(let B=0;B<u.length;B++){let U=u[B];const j=U.endsWith("__self");j&&(U=U.slice(0,-6)),v(`const ${toValidAssetId(U,a)} = ${I}(${JSON.stringify(U)}${j?", true":""})${M?"!":""}`),B<u.length-1&&x()}}function genHoists(u,a){if(!u.length)return;a.pure=!0;const{push:s,newline:v,helper:x,scopeId:M,mode:I}=a;v();for(let B=0;B<u.length;B++){const U=u[B];U&&(s(`const _hoisted_${B+1} = `),genNode(U,a),v())}a.pure=!1}function genNodeListAsArray(u,a){const s=u.length>3||!1;a.push("["),s&&a.indent(),genNodeList(u,a,s),s&&a.deindent(),a.push("]")}function genNodeList(u,a,s=!1,v=!0){const{push:x,newline:M}=a;for(let I=0;I<u.length;I++){const B=u[I];isString(B)?x(B):isArray(B)?genNodeListAsArray(B,a):genNode(B,a),I<u.length-1&&(s?(v&&x(","),M()):v&&x(", "))}}function genNode(u,a){if(isString(u)){a.push(u);return}if(isSymbol(u)){a.push(a.helper(u));return}switch(u.type){case 1:case 9:case 11:genNode(u.codegenNode,a);break;case 2:genText(u,a);break;case 4:genExpression(u,a);break;case 5:genInterpolation(u,a);break;case 12:genNode(u.codegenNode,a);break;case 8:genCompoundExpression(u,a);break;case 3:genComment(u,a);break;case 13:genVNodeCall(u,a);break;case 14:genCallExpression(u,a);break;case 15:genObjectExpression(u,a);break;case 17:genArrayExpression(u,a);break;case 18:genFunctionExpression(u,a);break;case 19:genConditionalExpression(u,a);break;case 20:genCacheExpression(u,a);break;case 21:genNodeList(u.body,a,!0,!1);break}}function genText(u,a){a.push(JSON.stringify(u.content),u)}function genExpression(u,a){const{content:s,isStatic:v}=u;a.push(v?JSON.stringify(s):s,u)}function genInterpolation(u,a){const{push:s,helper:v,pure:x}=a;x&&s(PURE_ANNOTATION),s(`${v(TO_DISPLAY_STRING)}(`),genNode(u.content,a),s(")")}function genCompoundExpression(u,a){for(let s=0;s<u.children.length;s++){const v=u.children[s];isString(v)?a.push(v):genNode(v,a)}}function genExpressionAsPropertyKey(u,a){const{push:s}=a;if(u.type===8)s("["),genCompoundExpression(u,a),s("]");else if(u.isStatic){const v=isSimpleIdentifier(u.content)?u.content:JSON.stringify(u.content);s(v,u)}else s(`[${u.content}]`,u)}function genComment(u,a){const{push:s,helper:v,pure:x}=a;x&&s(PURE_ANNOTATION),s(`${v(CREATE_COMMENT)}(${JSON.stringify(u.content)})`,u)}function genVNodeCall(u,a){const{push:s,helper:v,pure:x}=a,{tag:M,props:I,children:B,patchFlag:U,dynamicProps:j,directives:te,isBlock:Z,disableTracking:oe,isComponent:le}=u;te&&s(v(WITH_DIRECTIVES)+"("),Z&&s(`(${v(OPEN_BLOCK)}(${oe?"true":""}), `),x&&s(PURE_ANNOTATION);const se=Z?getVNodeBlockHelper(a.inSSR,le):getVNodeHelper(a.inSSR,le);s(v(se)+"(",u),genNodeList(genNullableArgs([M,I,B,U,j]),a),s(")"),Z&&s(")"),te&&(s(", "),genNode(te,a),s(")"))}function genNullableArgs(u){let a=u.length;for(;a--&&u[a]==null;);return u.slice(0,a+1).map(s=>s||"null")}function genCallExpression(u,a){const{push:s,helper:v,pure:x}=a,M=isString(u.callee)?u.callee:v(u.callee);x&&s(PURE_ANNOTATION),s(M+"(",u),genNodeList(u.arguments,a),s(")")}function genObjectExpression(u,a){const{push:s,indent:v,deindent:x,newline:M}=a,{properties:I}=u;if(!I.length){s("{}",u);return}const B=I.length>1||!1;s(B?"{":"{ "),B&&v();for(let U=0;U<I.length;U++){const{key:j,value:te}=I[U];genExpressionAsPropertyKey(j,a),s(": "),genNode(te,a),U<I.length-1&&(s(","),M())}B&&x(),s(B?"}":" }")}function genArrayExpression(u,a){genNodeListAsArray(u.elements,a)}function genFunctionExpression(u,a){const{push:s,indent:v,deindent:x}=a,{params:M,returns:I,body:B,newline:U,isSlot:j}=u;j&&s(`_${helperNameMap[WITH_CTX]}(`),s("(",u),isArray(M)?genNodeList(M,a):M&&genNode(M,a),s(") => "),(U||B)&&(s("{"),v()),I?(U&&s("return "),isArray(I)?genNodeListAsArray(I,a):genNode(I,a)):B&&genNode(B,a),(U||B)&&(x(),s("}")),j&&(u.isNonScopedSlot&&s(", undefined, true"),s(")"))}function genConditionalExpression(u,a){const{test:s,consequent:v,alternate:x,newline:M}=u,{push:I,indent:B,deindent:U,newline:j}=a;if(s.type===4){const Z=!isSimpleIdentifier(s.content);Z&&I("("),genExpression(s,a),Z&&I(")")}else I("("),genNode(s,a),I(")");M&&B(),a.indentLevel++,M||I(" "),I("? "),genNode(v,a),a.indentLevel--,M&&j(),M||I(" "),I(": ");const te=x.type===19;te||a.indentLevel++,genNode(x,a),te||a.indentLevel--,M&&U(!0)}function genCacheExpression(u,a){const{push:s,helper:v,indent:x,deindent:M,newline:I}=a;s(`_cache[${u.index}] || (`),u.isVNode&&(x(),s(`${v(SET_BLOCK_TRACKING)}(-1),`),I()),s(`_cache[${u.index}] = `),genNode(u.value,a),u.isVNode&&(s(","),I(),s(`${v(SET_BLOCK_TRACKING)}(1),`),I(),s(`_cache[${u.index}]`),M()),s(")")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const transformIf=createStructuralDirectiveTransform(/^(if|else|else-if)$/,(u,a,s)=>processIf(u,a,s,(v,x,M)=>{const I=s.parent.children;let B=I.indexOf(v),U=0;for(;B-->=0;){const j=I[B];j&&j.type===9&&(U+=j.branches.length)}return()=>{if(M)v.codegenNode=createCodegenNodeForBranch(x,U,s);else{const j=getParentCondition(v.codegenNode);j.alternate=createCodegenNodeForBranch(x,U+v.branches.length-1,s)}}}));function processIf(u,a,s,v){if(a.name!=="else"&&(!a.exp||!a.exp.content.trim())){const x=a.exp?a.exp.loc:u.loc;s.onError(createCompilerError(28,a.loc)),a.exp=createSimpleExpression("true",!1,x)}if(a.name==="if"){const x=createIfBranch(u,a),M={type:9,loc:u.loc,branches:[x]};if(s.replaceNode(M),v)return v(M,x,!0)}else{const x=s.parent.children;let M=x.indexOf(u);for(;M-->=-1;){const I=x[M];if(I&&I.type===3){s.removeNode(I);continue}if(I&&I.type===2&&!I.content.trim().length){s.removeNode(I);continue}if(I&&I.type===9){a.name==="else-if"&&I.branches[I.branches.length-1].condition===void 0&&s.onError(createCompilerError(30,u.loc)),s.removeNode();const B=createIfBranch(u,a);I.branches.push(B);const U=v&&v(I,B,!1);traverseNode(B,s),U&&U(),s.currentNode=null}else s.onError(createCompilerError(30,u.loc));break}}}function createIfBranch(u,a){const s=u.tagType===3;return{type:10,loc:u.loc,condition:a.name==="else"?void 0:a.exp,children:s&&!findDir(u,"for")?u.children:[u],userKey:findProp(u,"key"),isTemplateIf:s}}function createCodegenNodeForBranch(u,a,s){return u.condition?createConditionalExpression(u.condition,createChildrenCodegenNode(u,a,s),createCallExpression(s.helper(CREATE_COMMENT),['""',"true"])):createChildrenCodegenNode(u,a,s)}function createChildrenCodegenNode(u,a,s){const{helper:v}=s,x=createObjectProperty("key",createSimpleExpression(`${a}`,!1,locStub,2)),{children:M}=u,I=M[0];if(M.length!==1||I.type!==1)if(M.length===1&&I.type===11){const U=I.codegenNode;return injectProp(U,x,s),U}else{let U=64;return createVNodeCall(s,v(FRAGMENT),createObjectExpression([x]),M,U+"",void 0,void 0,!0,!1,!1,u.loc)}else{const U=I.codegenNode,j=getMemoedVNodeCall(U);return j.type===13&&convertToBlock(j,s),injectProp(j,x,s),U}}function getParentCondition(u){for(;;)if(u.type===19)if(u.alternate.type===19)u=u.alternate;else return u;else u.type===20&&(u=u.value)}const transformFor=createStructuralDirectiveTransform("for",(u,a,s)=>{const{helper:v,removeHelper:x}=s;return processFor(u,a,s,M=>{const I=createCallExpression(v(RENDER_LIST),[M.source]),B=isTemplateNode(u),U=findDir(u,"memo"),j=findProp(u,"key"),te=j&&(j.type===6?createSimpleExpression(j.value.content,!0):j.exp),Z=j?createObjectProperty("key",te):null,oe=M.source.type===4&&M.source.constType>0,le=oe?64:j?128:256;return M.codegenNode=createVNodeCall(s,v(FRAGMENT),void 0,I,le+"",void 0,void 0,!0,!oe,!1,u.loc),()=>{let se;const{children:ve}=M,ce=ve.length!==1||ve[0].type!==1,K=isSlotOutlet(u)?u:B&&u.children.length===1&&isSlotOutlet(u.children[0])?u.children[0]:null;if(K?(se=K.codegenNode,B&&Z&&injectProp(se,Z,s)):ce?se=createVNodeCall(s,v(FRAGMENT),Z?createObjectExpression([Z]):void 0,u.children,"64",void 0,void 0,!0,void 0,!1):(se=ve[0].codegenNode,B&&Z&&injectProp(se,Z,s),se.isBlock!==!oe&&(se.isBlock?(x(OPEN_BLOCK),x(getVNodeBlockHelper(s.inSSR,se.isComponent))):x(getVNodeHelper(s.inSSR,se.isComponent))),se.isBlock=!oe,se.isBlock?(v(OPEN_BLOCK),v(getVNodeBlockHelper(s.inSSR,se.isComponent))):v(getVNodeHelper(s.inSSR,se.isComponent))),U){const X=createFunctionExpression(createForLoopParams(M.parseResult,[createSimpleExpression("_cached")]));X.body=createBlockStatement([createCompoundExpression(["const _memo = (",U.exp,")"]),createCompoundExpression(["if (_cached",...te?[" && _cached.key === ",te]:[],` && ${s.helperString(IS_MEMO_SAME)}(_cached, _memo)) return _cached`]),createCompoundExpression(["const _item = ",se]),createSimpleExpression("_item.memo = _memo"),createSimpleExpression("return _item")]),I.arguments.push(X,createSimpleExpression("_cache"),createSimpleExpression(String(s.cached++)))}else I.arguments.push(createFunctionExpression(createForLoopParams(M.parseResult),se,!0))}})});function processFor(u,a,s,v){if(!a.exp){s.onError(createCompilerError(31,a.loc));return}const x=parseForExpression(a.exp);if(!x){s.onError(createCompilerError(32,a.loc));return}const{addIdentifiers:M,removeIdentifiers:I,scopes:B}=s,{source:U,value:j,key:te,index:Z}=x,oe={type:11,loc:a.loc,source:U,valueAlias:j,keyAlias:te,objectIndexAlias:Z,parseResult:x,children:isTemplateNode(u)?u.children:[u]};s.replaceNode(oe),B.vFor++;const le=v&&v(oe);return()=>{B.vFor--,le&&le()}}const forAliasRE=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,forIteratorRE=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,stripParensRE=/^\(|\)$/g;function parseForExpression(u,a){const s=u.loc,v=u.content,x=v.match(forAliasRE);if(!x)return;const[,M,I]=x,B={source:createAliasExpression(s,I.trim(),v.indexOf(I,M.length)),value:void 0,key:void 0,index:void 0};let U=M.trim().replace(stripParensRE,"").trim();const j=M.indexOf(U),te=U.match(forIteratorRE);if(te){U=U.replace(forIteratorRE,"").trim();const Z=te[1].trim();let oe;if(Z&&(oe=v.indexOf(Z,j+U.length),B.key=createAliasExpression(s,Z,oe)),te[2]){const le=te[2].trim();le&&(B.index=createAliasExpression(s,le,v.indexOf(le,B.key?oe+Z.length:j+U.length)))}}return U&&(B.value=createAliasExpression(s,U,j)),B}function createAliasExpression(u,a,s){return createSimpleExpression(a,!1,getInnerRange(u,s,a.length))}function createForLoopParams({value:u,key:a,index:s},v=[]){return createParamsList([u,a,s,...v])}function createParamsList(u){let a=u.length;for(;a--&&!u[a];);return u.slice(0,a+1).map((s,v)=>s||createSimpleExpression("_".repeat(v+1),!1))}const defaultFallback=createSimpleExpression("undefined",!1),trackSlotScopes=(u,a)=>{if(u.type===1&&(u.tagType===1||u.tagType===3)){const s=findDir(u,"slot");if(s)return s.exp,a.scopes.vSlot++,()=>{a.scopes.vSlot--}}},buildClientSlotFn=(u,a,s)=>createFunctionExpression(u,a,!1,!0,a.length?a[0].loc:s);function buildSlots(u,a,s=buildClientSlotFn){a.helper(WITH_CTX);const{children:v,loc:x}=u,M=[],I=[];let B=a.scopes.vSlot>0||a.scopes.vFor>0;const U=findDir(u,"slot",!0);if(U){const{arg:ce,exp:K}=U;ce&&!isStaticExp(ce)&&(B=!0),M.push(createObjectProperty(ce||createSimpleExpression("default",!0),s(K,v,x)))}let j=!1,te=!1;const Z=[],oe=new Set;let le=0;for(let ce=0;ce<v.length;ce++){const K=v[ce];let X;if(!isTemplateNode(K)||!(X=findDir(K,"slot",!0))){K.type!==3&&Z.push(K);continue}if(U){a.onError(createCompilerError(37,X.loc));break}j=!0;const{children:W,loc:_e}=K,{arg:ge=createSimpleExpression("default",!0),exp:Ae,loc:ee}=X;let $;isStaticExp(ge)?$=ge?ge.content:"default":B=!0;const ae=s(Ae,W,_e);let Re,pe,he;if(Re=findDir(K,"if"))B=!0,I.push(createConditionalExpression(Re.exp,buildDynamicSlot(ge,ae,le++),defaultFallback));else if(pe=findDir(K,/^else(-if)?$/,!0)){let we=ce,Ce;for(;we--&&(Ce=v[we],Ce.type===3););if(Ce&&isTemplateNode(Ce)&&findDir(Ce,"if")){v.splice(ce,1),ce--;let Ne=I[I.length-1];for(;Ne.alternate.type===19;)Ne=Ne.alternate;Ne.alternate=pe.exp?createConditionalExpression(pe.exp,buildDynamicSlot(ge,ae,le++),defaultFallback):buildDynamicSlot(ge,ae,le++)}else a.onError(createCompilerError(30,pe.loc))}else if(he=findDir(K,"for")){B=!0;const we=he.parseResult||parseForExpression(he.exp);we?I.push(createCallExpression(a.helper(RENDER_LIST),[we.source,createFunctionExpression(createForLoopParams(we),buildDynamicSlot(ge,ae),!0)])):a.onError(createCompilerError(32,he.loc))}else{if($){if(oe.has($)){a.onError(createCompilerError(38,ee));continue}oe.add($),$==="default"&&(te=!0)}M.push(createObjectProperty(ge,ae))}}if(!U){const ce=(K,X)=>{const W=s(K,X,x);return a.compatConfig&&(W.isNonScopedSlot=!0),createObjectProperty("default",W)};j?Z.length&&Z.some(K=>isNonWhitespaceContent(K))&&(te?a.onError(createCompilerError(39,Z[0].loc)):M.push(ce(void 0,Z))):M.push(ce(void 0,v))}const se=B?2:hasForwardedSlots(u.children)?3:1;let ve=createObjectExpression(M.concat(createObjectProperty("_",createSimpleExpression(se+"",!1))),x);return I.length&&(ve=createCallExpression(a.helper(CREATE_SLOTS),[ve,createArrayExpression(I)])),{slots:ve,hasDynamicSlots:B}}function buildDynamicSlot(u,a,s){const v=[createObjectProperty("name",u),createObjectProperty("fn",a)];return s!=null&&v.push(createObjectProperty("key",createSimpleExpression(String(s),!0))),createObjectExpression(v)}function hasForwardedSlots(u){for(let a=0;a<u.length;a++){const s=u[a];switch(s.type){case 1:if(s.tagType===2||hasForwardedSlots(s.children))return!0;break;case 9:if(hasForwardedSlots(s.branches))return!0;break;case 10:case 11:if(hasForwardedSlots(s.children))return!0;break}}return!1}function isNonWhitespaceContent(u){return u.type!==2&&u.type!==12?!0:u.type===2?!!u.content.trim():isNonWhitespaceContent(u.content)}const directiveImportMap=new WeakMap,transformElement=(u,a)=>function(){if(u=a.currentNode,!(u.type===1&&(u.tagType===0||u.tagType===1)))return;const{tag:v,props:x}=u,M=u.tagType===1;let I=M?resolveComponentType(u,a):`"${v}"`;const B=isObject(I)&&I.callee===RESOLVE_DYNAMIC_COMPONENT;let U,j,te,Z=0,oe,le,se,ve=B||I===TELEPORT||I===SUSPENSE||!M&&(v==="svg"||v==="foreignObject");if(x.length>0){const ce=buildProps(u,a,void 0,M,B);U=ce.props,Z=ce.patchFlag,le=ce.dynamicPropNames;const K=ce.directives;se=K&&K.length?createArrayExpression(K.map(X=>buildDirectiveArgs(X,a))):void 0,ce.shouldUseBlock&&(ve=!0)}if(u.children.length>0)if(I===KEEP_ALIVE&&(ve=!0,Z|=1024),M&&I!==TELEPORT&&I!==KEEP_ALIVE){const{slots:K,hasDynamicSlots:X}=buildSlots(u,a);j=K,X&&(Z|=1024)}else if(u.children.length===1&&I!==TELEPORT){const K=u.children[0],X=K.type,W=X===5||X===8;W&&getConstantType(K,a)===0&&(Z|=1),W||X===2?j=K:j=u.children}else j=u.children;Z!==0&&(te=String(Z),le&&le.length&&(oe=stringifyDynamicPropNames(le))),u.codegenNode=createVNodeCall(a,I,U,j,te,oe,se,!!ve,!1,M,u.loc)};function resolveComponentType(u,a,s=!1){let{tag:v}=u;const x=isComponentTag(v),M=findProp(u,"is");if(M)if(x||isCompatEnabled("COMPILER_IS_ON_ELEMENT",a)){const U=M.type===6?M.value&&createSimpleExpression(M.value.content,!0):M.exp;if(U)return createCallExpression(a.helper(RESOLVE_DYNAMIC_COMPONENT),[U])}else M.type===6&&M.value.content.startsWith("vue:")&&(v=M.value.content.slice(4));const I=!x&&findDir(u,"is");if(I&&I.exp)return createCallExpression(a.helper(RESOLVE_DYNAMIC_COMPONENT),[I.exp]);const B=isCoreComponent(v)||a.isBuiltInComponent(v);return B?(s||a.helper(B),B):(a.helper(RESOLVE_COMPONENT),a.components.add(v),toValidAssetId(v,"component"))}function buildProps(u,a,s=u.props,v,x,M=!1){const{tag:I,loc:B,children:U}=u;let j=[];const te=[],Z=[],oe=U.length>0;let le=!1,se=0,ve=!1,ce=!1,K=!1,X=!1,W=!1,_e=!1;const ge=[],Ae=ae=>{j.length&&(te.push(createObjectExpression(dedupeProperties(j),B)),j=[]),ae&&te.push(ae)},ee=({key:ae,value:Re})=>{if(isStaticExp(ae)){const pe=ae.content,he=isOn(pe);if(he&&(!v||x)&&pe.toLowerCase()!=="onclick"&&pe!=="onUpdate:modelValue"&&!isReservedProp(pe)&&(X=!0),he&&isReservedProp(pe)&&(_e=!0),Re.type===20||(Re.type===4||Re.type===8)&&getConstantType(Re,a)>0)return;pe==="ref"?ve=!0:pe==="class"?ce=!0:pe==="style"?K=!0:pe!=="key"&&!ge.includes(pe)&&ge.push(pe),v&&(pe==="class"||pe==="style")&&!ge.includes(pe)&&ge.push(pe)}else W=!0};for(let ae=0;ae<s.length;ae++){const Re=s[ae];if(Re.type===6){const{loc:pe,name:he,value:we}=Re;let Ce=!0;if(he==="ref"&&(ve=!0,a.scopes.vFor>0&&j.push(createObjectProperty(createSimpleExpression("ref_for",!0),createSimpleExpression("true")))),he==="is"&&(isComponentTag(I)||we&&we.content.startsWith("vue:")||isCompatEnabled("COMPILER_IS_ON_ELEMENT",a)))continue;j.push(createObjectProperty(createSimpleExpression(he,!0,getInnerRange(pe,0,he.length)),createSimpleExpression(we?we.content:"",Ce,we?we.loc:pe)))}else{const{name:pe,arg:he,exp:we,loc:Ce}=Re,Ne=pe==="bind",Ze=pe==="on";if(pe==="slot"){v||a.onError(createCompilerError(40,Ce));continue}if(pe==="once"||pe==="memo"||pe==="is"||Ne&&isStaticArgOf(he,"is")&&(isComponentTag(I)||isCompatEnabled("COMPILER_IS_ON_ELEMENT",a))||Ze&&M)continue;if((Ne&&isStaticArgOf(he,"key")||Ze&&oe&&isStaticArgOf(he,"vue:before-update"))&&(le=!0),Ne&&isStaticArgOf(he,"ref")&&a.scopes.vFor>0&&j.push(createObjectProperty(createSimpleExpression("ref_for",!0),createSimpleExpression("true"))),!he&&(Ne||Ze)){if(W=!0,we)if(Ne){if(Ae(),isCompatEnabled("COMPILER_V_BIND_OBJECT_ORDER",a)){te.unshift(we);continue}te.push(we)}else Ae({type:14,loc:Ce,callee:a.helper(TO_HANDLERS),arguments:v?[we]:[we,"true"]});else a.onError(createCompilerError(Ne?34:35,Ce));continue}const Ye=a.directiveTransforms[pe];if(Ye){const{props:it,needRuntime:_t}=Ye(Re,u,a);!M&&it.forEach(ee),Ze&&he&&!isStaticExp(he)?Ae(createObjectExpression(it,B)):j.push(...it),_t&&(Z.push(Re),isSymbol(_t)&&directiveImportMap.set(Re,_t))}else isBuiltInDirective(pe)||(Z.push(Re),oe&&(le=!0))}}let $;if(te.length?(Ae(),te.length>1?$=createCallExpression(a.helper(MERGE_PROPS),te,B):$=te[0]):j.length&&($=createObjectExpression(dedupeProperties(j),B)),W?se|=16:(ce&&!v&&(se|=2),K&&!v&&(se|=4),ge.length&&(se|=8),X&&(se|=32)),!le&&(se===0||se===32)&&(ve||_e||Z.length>0)&&(se|=512),!a.inSSR&&$)switch($.type){case 15:let ae=-1,Re=-1,pe=!1;for(let Ce=0;Ce<$.properties.length;Ce++){const Ne=$.properties[Ce].key;isStaticExp(Ne)?Ne.content==="class"?ae=Ce:Ne.content==="style"&&(Re=Ce):Ne.isHandlerKey||(pe=!0)}const he=$.properties[ae],we=$.properties[Re];pe?$=createCallExpression(a.helper(NORMALIZE_PROPS),[$]):(he&&!isStaticExp(he.value)&&(he.value=createCallExpression(a.helper(NORMALIZE_CLASS),[he.value])),we&&(K||we.value.type===4&&we.value.content.trim()[0]==="["||we.value.type===17)&&(we.value=createCallExpression(a.helper(NORMALIZE_STYLE),[we.value])));break;case 14:break;default:$=createCallExpression(a.helper(NORMALIZE_PROPS),[createCallExpression(a.helper(GUARD_REACTIVE_PROPS),[$])]);break}return{props:$,directives:Z,patchFlag:se,dynamicPropNames:ge,shouldUseBlock:le}}function dedupeProperties(u){const a=new Map,s=[];for(let v=0;v<u.length;v++){const x=u[v];if(x.key.type===8||!x.key.isStatic){s.push(x);continue}const M=x.key.content,I=a.get(M);I?(M==="style"||M==="class"||isOn(M))&&mergeAsArray(I,x):(a.set(M,x),s.push(x))}return s}function mergeAsArray(u,a){u.value.type===17?u.value.elements.push(a.value):u.value=createArrayExpression([u.value,a.value],u.loc)}function buildDirectiveArgs(u,a){const s=[],v=directiveImportMap.get(u);v?s.push(a.helperString(v)):(a.helper(RESOLVE_DIRECTIVE),a.directives.add(u.name),s.push(toValidAssetId(u.name,"directive")));const{loc:x}=u;if(u.exp&&s.push(u.exp),u.arg&&(u.exp||s.push("void 0"),s.push(u.arg)),Object.keys(u.modifiers).length){u.arg||(u.exp||s.push("void 0"),s.push("void 0"));const M=createSimpleExpression("true",!1,x);s.push(createObjectExpression(u.modifiers.map(I=>createObjectProperty(I,M)),x))}return createArrayExpression(s,u.loc)}function stringifyDynamicPropNames(u){let a="[";for(let s=0,v=u.length;s<v;s++)a+=JSON.stringify(u[s]),s<v-1&&(a+=", ");return a+"]"}function isComponentTag(u){return u==="component"||u==="Component"}const transformSlotOutlet=(u,a)=>{if(isSlotOutlet(u)){const{children:s,loc:v}=u,{slotName:x,slotProps:M}=processSlotOutlet(u,a),I=[a.prefixIdentifiers?"_ctx.$slots":"$slots",x,"{}","undefined","true"];let B=2;M&&(I[2]=M,B=3),s.length&&(I[3]=createFunctionExpression([],s,!1,!1,v),B=4),a.scopeId&&!a.slotted&&(B=5),I.splice(B),u.codegenNode=createCallExpression(a.helper(RENDER_SLOT),I,v)}};function processSlotOutlet(u,a){let s='"default"',v;const x=[];for(let M=0;M<u.props.length;M++){const I=u.props[M];I.type===6?I.value&&(I.name==="name"?s=JSON.stringify(I.value.content):(I.name=camelize(I.name),x.push(I))):I.name==="bind"&&isStaticArgOf(I.arg,"name")?I.exp&&(s=I.exp):(I.name==="bind"&&I.arg&&isStaticExp(I.arg)&&(I.arg.content=camelize(I.arg.content)),x.push(I))}if(x.length>0){const{props:M,directives:I}=buildProps(u,a,x,!1,!1);v=M,I.length&&a.onError(createCompilerError(36,I[0].loc))}return{slotName:s,slotProps:v}}const fnExpRE=/^\s*([\w$_]+|(async\s*)?\([^)]*?\))\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,transformOn$1=(u,a,s,v)=>{const{loc:x,modifiers:M,arg:I}=u;!u.exp&&!M.length&&s.onError(createCompilerError(35,x));let B;if(I.type===4)if(I.isStatic){let Z=I.content;Z.startsWith("vue:")&&(Z=`vnode-${Z.slice(4)}`);const oe=a.tagType!==0||Z.startsWith("vnode")||!/[A-Z]/.test(Z)?toHandlerKey(camelize(Z)):`on:${Z}`;B=createSimpleExpression(oe,!0,I.loc)}else B=createCompoundExpression([`${s.helperString(TO_HANDLER_KEY)}(`,I,")"]);else B=I,B.children.unshift(`${s.helperString(TO_HANDLER_KEY)}(`),B.children.push(")");let U=u.exp;U&&!U.content.trim()&&(U=void 0);let j=s.cacheHandlers&&!U&&!s.inVOnce;if(U){const Z=isMemberExpression(U.content),oe=!(Z||fnExpRE.test(U.content)),le=U.content.includes(";");(oe||j&&Z)&&(U=createCompoundExpression([`${oe?"$event":"(...args)"} => ${le?"{":"("}`,U,le?"}":")"]))}let te={props:[createObjectProperty(B,U||createSimpleExpression("() => {}",!1,x))]};return v&&(te=v(te)),j&&(te.props[0].value=s.cache(te.props[0].value)),te.props.forEach(Z=>Z.key.isHandlerKey=!0),te},transformBind=(u,a,s)=>{const{exp:v,modifiers:x,loc:M}=u,I=u.arg;return I.type!==4?(I.children.unshift("("),I.children.push(') || ""')):I.isStatic||(I.content=`${I.content} || ""`),x.includes("camel")&&(I.type===4?I.isStatic?I.content=camelize(I.content):I.content=`${s.helperString(CAMELIZE)}(${I.content})`:(I.children.unshift(`${s.helperString(CAMELIZE)}(`),I.children.push(")"))),s.inSSR||(x.includes("prop")&&injectPrefix(I,"."),x.includes("attr")&&injectPrefix(I,"^")),!v||v.type===4&&!v.content.trim()?(s.onError(createCompilerError(34,M)),{props:[createObjectProperty(I,createSimpleExpression("",!0,M))]}):{props:[createObjectProperty(I,v)]}},injectPrefix=(u,a)=>{u.type===4?u.isStatic?u.content=a+u.content:u.content=`\`${a}\${${u.content}}\``:(u.children.unshift(`'${a}' + (`),u.children.push(")"))},transformText=(u,a)=>{if(u.type===0||u.type===1||u.type===11||u.type===10)return()=>{const s=u.children;let v,x=!1;for(let M=0;M<s.length;M++){const I=s[M];if(isText$1(I)){x=!0;for(let B=M+1;B<s.length;B++){const U=s[B];if(isText$1(U))v||(v=s[M]=createCompoundExpression([I],I.loc)),v.children.push(" + ",U),s.splice(B,1),B--;else{v=void 0;break}}}}if(!(!x||s.length===1&&(u.type===0||u.type===1&&u.tagType===0&&!u.props.find(M=>M.type===7&&!a.directiveTransforms[M.name])&&u.tag!=="template")))for(let M=0;M<s.length;M++){const I=s[M];if(isText$1(I)||I.type===8){const B=[];(I.type!==2||I.content!==" ")&&B.push(I),!a.ssr&&getConstantType(I,a)===0&&B.push("1"),s[M]={type:12,content:I,loc:I.loc,codegenNode:createCallExpression(a.helper(CREATE_TEXT),B)}}}}},seen$1=new WeakSet,transformOnce=(u,a)=>{if(u.type===1&&findDir(u,"once",!0))return seen$1.has(u)||a.inVOnce||a.inSSR?void 0:(seen$1.add(u),a.inVOnce=!0,a.helper(SET_BLOCK_TRACKING),()=>{a.inVOnce=!1;const s=a.currentNode;s.codegenNode&&(s.codegenNode=a.cache(s.codegenNode,!0))})},transformModel$1=(u,a,s)=>{const{exp:v,arg:x}=u;if(!v)return s.onError(createCompilerError(41,u.loc)),createTransformProps();const M=v.loc.source,I=v.type===4?v.content:M,B=s.bindingMetadata[M];if(B==="props"||B==="props-aliased")return s.onError(createCompilerError(44,v.loc)),createTransformProps();const U=!1;if(!I.trim()||!isMemberExpression(I)&&!U)return s.onError(createCompilerError(42,v.loc)),createTransformProps();const j=x||createSimpleExpression("modelValue",!0),te=x?isStaticExp(x)?`onUpdate:${camelize(x.content)}`:createCompoundExpression(['"onUpdate:" + ',x]):"onUpdate:modelValue";let Z;const oe=s.isTS?"($event: any)":"$event";Z=createCompoundExpression([`${oe} => ((`,v,") = $event)"]);const le=[createObjectProperty(j,u.exp),createObjectProperty(te,Z)];if(u.modifiers.length&&a.tagType===1){const se=u.modifiers.map(ce=>(isSimpleIdentifier(ce)?ce:JSON.stringify(ce))+": true").join(", "),ve=x?isStaticExp(x)?`${x.content}Modifiers`:createCompoundExpression([x,' + "Modifiers"']):"modelModifiers";le.push(createObjectProperty(ve,createSimpleExpression(`{ ${se} }`,!1,u.loc,2)))}return createTransformProps(le)};function createTransformProps(u=[]){return{props:u}}const validDivisionCharRE=/[\w).+\-_$\]]/,transformFilter=(u,a)=>{isCompatEnabled("COMPILER_FILTER",a)&&(u.type===5&&rewriteFilter(u.content,a),u.type===1&&u.props.forEach(s=>{s.type===7&&s.name!=="for"&&s.exp&&rewriteFilter(s.exp,a)}))};function rewriteFilter(u,a){if(u.type===4)parseFilter(u,a);else for(let s=0;s<u.children.length;s++){const v=u.children[s];typeof v=="object"&&(v.type===4?parseFilter(v,a):v.type===8?rewriteFilter(u,a):v.type===5&&rewriteFilter(v.content,a))}}function parseFilter(u,a){const s=u.content;let v=!1,x=!1,M=!1,I=!1,B=0,U=0,j=0,te=0,Z,oe,le,se,ve=[];for(le=0;le<s.length;le++)if(oe=Z,Z=s.charCodeAt(le),v)Z===39&&oe!==92&&(v=!1);else if(x)Z===34&&oe!==92&&(x=!1);else if(M)Z===96&&oe!==92&&(M=!1);else if(I)Z===47&&oe!==92&&(I=!1);else if(Z===124&&s.charCodeAt(le+1)!==124&&s.charCodeAt(le-1)!==124&&!B&&!U&&!j)se===void 0?(te=le+1,se=s.slice(0,le).trim()):ce();else{switch(Z){case 34:x=!0;break;case 39:v=!0;break;case 96:M=!0;break;case 40:j++;break;case 41:j--;break;case 91:U++;break;case 93:U--;break;case 123:B++;break;case 125:B--;break}if(Z===47){let K=le-1,X;for(;K>=0&&(X=s.charAt(K),X===" ");K--);(!X||!validDivisionCharRE.test(X))&&(I=!0)}}se===void 0?se=s.slice(0,le).trim():te!==0&&ce();function ce(){ve.push(s.slice(te,le).trim()),te=le+1}if(ve.length){for(le=0;le<ve.length;le++)se=wrapFilter(se,ve[le],a);u.content=se}}function wrapFilter(u,a,s){s.helper(RESOLVE_FILTER);const v=a.indexOf("(");if(v<0)return s.filters.add(a),`${toValidAssetId(a,"filter")}(${u})`;{const x=a.slice(0,v),M=a.slice(v+1);return s.filters.add(x),`${toValidAssetId(x,"filter")}(${u}${M!==")"?","+M:M}`}}const seen=new WeakSet,transformMemo=(u,a)=>{if(u.type===1){const s=findDir(u,"memo");return!s||seen.has(u)?void 0:(seen.add(u),()=>{const v=u.codegenNode||a.currentNode.codegenNode;v&&v.type===13&&(u.tagType!==1&&convertToBlock(v,a),u.codegenNode=createCallExpression(a.helper(WITH_MEMO),[s.exp,createFunctionExpression(void 0,v),"_cache",String(a.cached++)]))})}};function getBaseTransformPreset(u){return[[transformOnce,transformIf,transformMemo,transformFor,transformFilter,transformSlotOutlet,transformElement,trackSlotScopes,transformText],{on:transformOn$1,bind:transformBind,model:transformModel$1}]}function baseCompile(u,a={}){const s=a.onError||defaultOnError,v=a.mode==="module";a.prefixIdentifiers===!0?s(createCompilerError(47)):v&&s(createCompilerError(48));const x=!1;a.cacheHandlers&&s(createCompilerError(49)),a.scopeId&&!v&&s(createCompilerError(50));const M=isString(u)?baseParse(u,a):u,[I,B]=getBaseTransformPreset();return transform(M,extend({},a,{prefixIdentifiers:x,nodeTransforms:[...I,...a.nodeTransforms||[]],directiveTransforms:extend({},B,a.directiveTransforms||{})})),generate(M,extend({},a,{prefixIdentifiers:x}))}const noopDirectiveTransform=()=>({props:[]}),V_MODEL_RADIO=Symbol(""),V_MODEL_CHECKBOX=Symbol(""),V_MODEL_TEXT=Symbol(""),V_MODEL_SELECT=Symbol(""),V_MODEL_DYNAMIC=Symbol(""),V_ON_WITH_MODIFIERS=Symbol(""),V_ON_WITH_KEYS=Symbol(""),V_SHOW=Symbol(""),TRANSITION=Symbol(""),TRANSITION_GROUP=Symbol("");registerRuntimeHelpers({[V_MODEL_RADIO]:"vModelRadio",[V_MODEL_CHECKBOX]:"vModelCheckbox",[V_MODEL_TEXT]:"vModelText",[V_MODEL_SELECT]:"vModelSelect",[V_MODEL_DYNAMIC]:"vModelDynamic",[V_ON_WITH_MODIFIERS]:"withModifiers",[V_ON_WITH_KEYS]:"withKeys",[V_SHOW]:"vShow",[TRANSITION]:"Transition",[TRANSITION_GROUP]:"TransitionGroup"});let decoder;function decodeHtmlBrowser(u,a=!1){return decoder||(decoder=document.createElement("div")),a?(decoder.innerHTML=`<div foo="${u.replace(/"/g,"&quot;")}">`,decoder.children[0].getAttribute("foo")):(decoder.innerHTML=u,decoder.textContent)}const isRawTextContainer=makeMap("style,iframe,script,noscript",!0),parserOptions={isVoidTag,isNativeTag:u=>isHTMLTag(u)||isSVGTag(u),isPreTag:u=>u==="pre",decodeEntities:decodeHtmlBrowser,isBuiltInComponent:u=>{if(isBuiltInType(u,"Transition"))return TRANSITION;if(isBuiltInType(u,"TransitionGroup"))return TRANSITION_GROUP},getNamespace(u,a){let s=a?a.ns:0;if(a&&s===2)if(a.tag==="annotation-xml"){if(u==="svg")return 1;a.props.some(v=>v.type===6&&v.name==="encoding"&&v.value!=null&&(v.value.content==="text/html"||v.value.content==="application/xhtml+xml"))&&(s=0)}else/^m(?:[ions]|text)$/.test(a.tag)&&u!=="mglyph"&&u!=="malignmark"&&(s=0);else a&&s===1&&(a.tag==="foreignObject"||a.tag==="desc"||a.tag==="title")&&(s=0);if(s===0){if(u==="svg")return 1;if(u==="math")return 2}return s},getTextMode({tag:u,ns:a}){if(a===0){if(u==="textarea"||u==="title")return 1;if(isRawTextContainer(u))return 2}return 0}},transformStyle=u=>{u.type===1&&u.props.forEach((a,s)=>{a.type===6&&a.name==="style"&&a.value&&(u.props[s]={type:7,name:"bind",arg:createSimpleExpression("style",!0,a.loc),exp:parseInlineCSS(a.value.content,a.loc),modifiers:[],loc:a.loc})})},parseInlineCSS=(u,a)=>{const s=parseStringStyle(u);return createSimpleExpression(JSON.stringify(s),!1,a,3)};function createDOMCompilerError(u,a){return createCompilerError(u,a)}const transformVHtml=(u,a,s)=>{const{exp:v,loc:x}=u;return v||s.onError(createDOMCompilerError(53,x)),a.children.length&&(s.onError(createDOMCompilerError(54,x)),a.children.length=0),{props:[createObjectProperty(createSimpleExpression("innerHTML",!0,x),v||createSimpleExpression("",!0))]}},transformVText=(u,a,s)=>{const{exp:v,loc:x}=u;return v||s.onError(createDOMCompilerError(55,x)),a.children.length&&(s.onError(createDOMCompilerError(56,x)),a.children.length=0),{props:[createObjectProperty(createSimpleExpression("textContent",!0),v?getConstantType(v,s)>0?v:createCallExpression(s.helperString(TO_DISPLAY_STRING),[v],x):createSimpleExpression("",!0))]}},transformModel=(u,a,s)=>{const v=transformModel$1(u,a,s);if(!v.props.length||a.tagType===1)return v;u.arg&&s.onError(createDOMCompilerError(58,u.arg.loc));const{tag:x}=a,M=s.isCustomElement(x);if(x==="input"||x==="textarea"||x==="select"||M){let I=V_MODEL_TEXT,B=!1;if(x==="input"||M){const U=findProp(a,"type");if(U){if(U.type===7)I=V_MODEL_DYNAMIC;else if(U.value)switch(U.value.content){case"radio":I=V_MODEL_RADIO;break;case"checkbox":I=V_MODEL_CHECKBOX;break;case"file":B=!0,s.onError(createDOMCompilerError(59,u.loc));break}}else hasDynamicKeyVBind(a)&&(I=V_MODEL_DYNAMIC)}else x==="select"&&(I=V_MODEL_SELECT);B||(v.needRuntime=s.helper(I))}else s.onError(createDOMCompilerError(57,u.loc));return v.props=v.props.filter(I=>!(I.key.type===4&&I.key.content==="modelValue")),v},isEventOptionModifier=makeMap("passive,once,capture"),isNonKeyModifier=makeMap("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),maybeKeyModifier=makeMap("left,right"),isKeyboardEvent=makeMap("onkeyup,onkeydown,onkeypress",!0),resolveModifiers=(u,a,s,v)=>{const x=[],M=[],I=[];for(let B=0;B<a.length;B++){const U=a[B];U==="native"&&checkCompatEnabled("COMPILER_V_ON_NATIVE",s)||isEventOptionModifier(U)?I.push(U):maybeKeyModifier(U)?isStaticExp(u)?isKeyboardEvent(u.content)?x.push(U):M.push(U):(x.push(U),M.push(U)):isNonKeyModifier(U)?M.push(U):x.push(U)}return{keyModifiers:x,nonKeyModifiers:M,eventOptionModifiers:I}},transformClick=(u,a)=>isStaticExp(u)&&u.content.toLowerCase()==="onclick"?createSimpleExpression(a,!0):u.type!==4?createCompoundExpression(["(",u,`) === "onClick" ? "${a}" : (`,u,")"]):u,transformOn=(u,a,s)=>transformOn$1(u,a,s,v=>{const{modifiers:x}=u;if(!x.length)return v;let{key:M,value:I}=v.props[0];const{keyModifiers:B,nonKeyModifiers:U,eventOptionModifiers:j}=resolveModifiers(M,x,s,u.loc);if(U.includes("right")&&(M=transformClick(M,"onContextmenu")),U.includes("middle")&&(M=transformClick(M,"onMouseup")),U.length&&(I=createCallExpression(s.helper(V_ON_WITH_MODIFIERS),[I,JSON.stringify(U)])),B.length&&(!isStaticExp(M)||isKeyboardEvent(M.content))&&(I=createCallExpression(s.helper(V_ON_WITH_KEYS),[I,JSON.stringify(B)])),j.length){const te=j.map(capitalize).join("");M=isStaticExp(M)?createSimpleExpression(`${M.content}${te}`,!0):createCompoundExpression(["(",M,`) + "${te}"`])}return{props:[createObjectProperty(M,I)]}}),transformShow=(u,a,s)=>{const{exp:v,loc:x}=u;return v||s.onError(createDOMCompilerError(61,x)),{props:[],needRuntime:s.helper(V_SHOW)}},ignoreSideEffectTags=(u,a)=>{u.type===1&&u.tagType===0&&(u.tag==="script"||u.tag==="style")&&a.removeNode()},DOMNodeTransforms=[transformStyle],DOMDirectiveTransforms={cloak:noopDirectiveTransform,html:transformVHtml,text:transformVText,model:transformModel,on:transformOn,show:transformShow};function compile(u,a={}){return baseCompile(u,extend({},parserOptions,a,{nodeTransforms:[ignoreSideEffectTags,...DOMNodeTransforms,...a.nodeTransforms||[]],directiveTransforms:extend({},DOMDirectiveTransforms,a.directiveTransforms||{}),transformHoist:null}))}const compileCache=Object.create(null);function compileToFunction(u,a){if(!isString(u))if(u.nodeType)u=u.innerHTML;else return NOOP;const s=u,v=compileCache[s];if(v)return v;if(u[0]==="#"){const B=document.querySelector(u);u=B?B.innerHTML:""}const x=extend({hoistStatic:!0,onError:void 0,onWarn:NOOP},a);!x.isCustomElement&&typeof customElements<"u"&&(x.isCustomElement=B=>!!customElements.get(B));const{code:M}=compile(u,x),I=new Function("Vue",M)(runtimeDom);return I._rc=!0,compileCache[s]=I}registerRuntimeCompiler(compileToFunction);let rootCollectionApp;const showProductEvent=new CustomEvent("showproductevent",{detail:{productid:null}}),initCollectionApp=function(){const u=createApp({props:[]},{products:[]});return rootCollectionApp=u,u.component("product",{props:["productData","tileh","tilew","rightmargin","isTile"],data(){return{}},created(){},mounted(){},methods:{getImageSrc(){return"./images/"+this.productData.imagename},getColorText(){const a=this.productData.color.split(",").length;return a==1?"1 Colour":a+" Colours"},showProduct(){showProductEvent.detail.productid=this.productData.id,document.dispatchEvent(showProductEvent)}},template:`
            <div class="productContanier" :style="{'height': tileh, 'width': tilew, 'margin-right':rightmargin}">
                <div class="productImageContainer" @click="showProduct()">
                    <img class="productImage" :src="getImageSrc()"/>
                </div>
                <div class="productInfoContainer">
                    <div class="p-price">&#8377;{{productData.price}}</div>
                    <div class="p-name" @click="showProduct()">{{productData.name}}</div>
                    <div class="p-color" :style="{'display':isTile}">{{getColorText()}}</div> 
                </div>
            </div>
        
        `}),u.component("productviewer",{props:["productData"],data(){return{isLoaded:!1,loadPercentage:0}},created(){},mounted(){this.dom=document.getElementById("viewerScene"),this.initWebGI()},unmounted(){this.viewer!=null&&(this.viewer.renderer.refreshPipeline(),this.viewer.scene.disposeSceneModels(),this.viewer.dispose())},watch:{loadPercentage:function(a){const s=document.getElementById("sceneLoaderBar");s!=null&&(s.style.width=this.loadPercentage+"%"),a===100&&(this.isLoaded=!0)}},methods:{async initWebGI(){this.loadPercentage=15,this.viewer=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("viewerScene"),isAntialiased:!0,useRgbm:!0});const a=new __webpackgi_exports__AssetManagerPlugin;await this.viewer.addPlugin(a),this.viewer.renderer.displayCanvasScaling=Math.min(window.devicePixelRatio,2),await __webpackgi_exports__addBasePlugins(this.viewer),this.viewer.getPlugin(__webpackgi_exports__CameraViewPlugin),this.viewer.renderer.refreshPipeline(),this.viewer.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0;const s={autoScale:!1};await a.addFromPath("./objects/"+this.productData.objModelName,s),this.loadPercentage=80,this.loadPercentage=90,this.controls=this.viewer.scene.activeCamera.controls,this.controls.autoRotate=this.turnTable,this.controls.autoRotateSpeed=.8,this.bigCanvas||(this.controls.zoomOut(1),this.controls.zoomOut(1)),this.loadPercentage=100}},template:`
            <div id="sceneLoader" v-if="!isLoaded">
                <div id="sceneLoaderBar"></div>
            </div>
            <canvas id="viewerScene"></canvas>
        `}),u.component("collections",{props:[],data(){return{rootCmp:rootCollectionApp,colSize:4,showProductMode:!1,activeProductId:null,activeProduct:null}},created(){rootCollectionApp._props.products=products,document.addEventListener("showproductevent",a=>{if(a.detail.productid!=null){this.activeProductId=a.detail.productid;const s=rootCollectionApp._props.products.filter(v=>v.id===this.activeProductId);s.length==1&&(this.activeProduct=s[0],this.showProductMode=!0,document.body.scrollTop=0,document.documentElement.scrollTop=0,document.dispatchEvent(new Event("resetviewer")))}})},mounted(){},methods:{getRowNum(){return Math.ceil(this.rootCmp._props.products.length/this.colSize)},getIndex(a,s){return(a-1)*this.colSize+s},isCellAvailable(a,s){return!(this.getIndex(a,s)>this.rootCmp._props.products.length)},closeViewer(){this.activeProduct=null,this.activeProductId=null,this.showProductMode=!1,document.body.scrollTop=0,document.documentElement.scrollTop=0},getSizeOptions(){return this.activeProduct.size.split(",")},getSuggestedProduct(){return rootCollectionApp._props.products.slice(0,4)}},template:`
            <div id="collectionHeader">
                <nav id="navleft" class="nav js-nav">
                    <ul class="slider-ul">
                    <li class="slider-li">
                    <a class="sliderA" href="/ShopKart/index.html"><span class="navSpan">Home</span></a>
                    </li>
                    <li class="slider-li">
                        <a class="sliderA is-active" href="#"><span class="navSpan">Collections</span></a>
                    </li>
                    <li class="slider-li">
                            <a class="sliderA" href="#"><span class="navSpan">Contact Us</span></a>
                    </li>
                    </ul>
                </nav>
                <figure class="logo">
                    <img src="./images/Diesel_logo.svg">
                </figure>
                <nav id="navright" class="nav">
                    <ul class="slider-ul">
                        <li class="slider-li">
                        <a class="sliderA" href="#">
                            <span>Account</span>
                        </a>
                        </li>
                        <li class="slider-li">
                        <a class="sliderA" href="#">
                            <span>Cart</span>
                            <div class="cart-total">0</div>
                        </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div id="productViewerContainer" v-if="showProductMode">
                <div id="closeViewer" @click="closeViewer()">X</div>
                <div id="productArea">
                    <div id="productViewerBlock">
                        <productviewer :productData=activeProduct></productviewer>
                    </div>
                    <div id="productOptionsContainer">
                        <h1 class="productTitle">{{activeProduct.name}}</h1>
                        <p class="info-price">MRP {{activeProduct.price}}</p>
                        <p class="info-tax">Price inclusive of all taxes</p>
                        <p class="info-price" style="font-size:.875rem">COLOR: <span style="color:#5f5f5f;font-weight:100">{{activeProduct.color}}</span></p>
                        <p class="info-price">CHOOSE SIZE</p>
                        <div class="sizeOptionsBlock">
                            <div class="sizeOptions" v-for="size in getSizeOptions()">
                                {{size}}
                            </div>
                        </div>
                        <div class="cartoptions">
                            <div class="addToCart">ADD TO CART</div>
                            <div class="wishlist"><img style="height:100%;width:100%" src="./images/wishlistheart.svg"/></div>
                        </div>
                        <p class="info-price">DESCRIPTION</p>
                        <div class="detailsText">
                            <ul>
                                <li>{{activeProduct.description}}</li>
                            </ul>
                        </div>
                        <p class="info-price">PRODUCT DETAILS</p>
                        <div class="detailsText">
                            <ul>
                                <li class="detailList" v-for="detail in activeProduct.details.split(',')" >{{detail}}</li>
                            </ul>
                        </div>
                        <p class="info-price">OTHER DETAILS</p>
                        <div class="detailsText">
                            <ul>
                                <li class="detailList" v-for="detail in activeProduct.otherdetails.split(',')" >{{detail}}</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div id="suggestionArea">
                    <h1>YOU MAY ALSO LIKE</h1>
                    <div class="productSuggestionBlock">
                        <product v-for="product in getSuggestedProduct()" :productData=product :tileh="'30vh'" :tilew="'20vw'" :rightmargin="'15px'" :isTile="'none'"></product>
                    </div>
                </div>
            </div>
            <div v-else id="collectionBody">
                <div id="filterContainer">
                    <table id="filterTable">
                        <tr>
                            <td ><span id="filterLabel">Filter By</span></td>
                            <td ><div class="filterColumn">Category <div class="downarrow"></div></div></td>
                            <td ><div class="filterColumn">Size <div class="downarrow"></div></div></td>
                            <td ><div class="filterColumn">Color <div class="downarrow"></div></div></td>
                            <td ><div class="filterColumn">Fabric <div class="downarrow"></div></div></td>
                            <td ><div class="filterColumn">Product Type <div class="downarrow"></div></div></td>
                        </tr>
                    </table>
                </div>
                <div id="collectionResultContainer">
                    <table id="collectionTable">
                        <tr v-for="row in Number(getRowNum())">
                            <td class="productGrid" v-for="col in Number(colSize)">
                                <product v-if="isCellAvailable(row,col)" :productData="rootCmp._props.products[getIndex(row,col)-1]"></product>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="collectionFooter">
                <div id="footerHead">Diesel private limited</div>
            </div>

        `}),u};async function main(){initMainApp().mount("#mainAppContainer"),initCollectionApp().mount("#collectionAppContainer")}main();
